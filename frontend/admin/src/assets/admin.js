import{r as e,_ as t,m as s,w as i,i as a,c as n}from"./riot-2ff62756.js";import{r,c as o,a as l,o as d,b as c,g as p,i as u,u as m,t as h,d as g,e as v,f,h as x,w as b}from"./mobx-85e66a36.js";!function(){var e=["user-blocking","user-visible","background"];class t{constructor(){this.channel_=new MessageChannel,this.sendPort_=this.channel_.port2,this.messages_={},this.nextMessageHandle_=1,this.channel_.port1.onmessage=e=>this.onMessageReceived_(e)}queueCallback(e){var t=this.nextMessageHandle_++;return this.messages_[t]=e,this.sendPort_.postMessage(t),t}cancelCallback(e){delete this.messages_[e]}onMessageReceived_(e){var t=e.data;if(t in this.messages_){var s=this.messages_[t];delete this.messages_[t],s()}}}function s(){return s.instance_||(s.instance_=new t),s.instance_}class i{constructor(e,t,s){void 0===s&&(s=0),this.callback_=e,this.callbackType_=null,this.handle_=null,this.canceled_=!1,this.schedule_(t,s)}isIdleCallback(){return 0===this.callbackType_}cancel(){if(!this.canceled_)switch(this.canceled_=!0,this.callbackType_){case 0:cancelIdleCallback(this.handle_);break;case 1:clearTimeout(this.handle_);break;case 2:s().cancelCallback(this.handle_);break;default:throw new TypeError("Unknown CallbackType")}}schedule_(t,i){if(i&&i>0||"function"!=typeof MessageChannel)return i||(i=0),this.callbackType_=1,void(this.handle_=setTimeout((()=>{this.runCallback_()}),i));if(!e.includes(t))throw new TypeError("Invalid task priority : "+t);"background"===t&&"function"==typeof requestIdleCallback?(this.handle_=requestIdleCallback((()=>{this.runCallback_()})),this.callbackType_=0):(this.handle_=s().queueCallback((()=>{this.runCallback_()})),this.callbackType_=2)}runCallback_(){this.canceled_||this.callback_()}}var a=0;class n{constructor(){this.head_=null,this.tail_=null}isEmpty(){return null==this.head_}push(e){if("object"!=typeof e)throw new TypeError("Task must be an Object");e.tq_sequence_=a++,this.isEmpty()?(e.tq_prev_=null,this.head_=e):(e.tq_prev_=this.tail_,this.tail_.tq_next_=e),e.tq_next_=null,this.tail_=e}takeNextTask(){if(this.isEmpty())return null;var e=this.head_;return this.remove_(e),e}merge(e,t){if("function"!=typeof t)throw new TypeError("Must provide a selector function.");if(null==e)throw new Error("sourceQueue cannot be null");for(var s=this.head_,i=null,a=e.head_;a;){var n=a;if(a=a.tq_next_,t(n)){for(e.remove_(n);s&&s.tq_sequence_<n.tq_sequence_;)i=s,s=s.tq_next_;this.insert_(n,i),i=n}}}toArray(){for(var e=this.head_,t=[];null!==e;)t.push(e),e=e.tq_next_;return t}insert_(e,t){if(t!=this.tail_){var s=t?t.tq_next_:this.head_;e.tq_next_=s,s.tq_prev_=e,e.tq_prev_=t,null!=t?t.tq_next_=e:this.head_=e}else this.push(e)}remove_(e){if(null==e)throw new Error("Expected task to be non-null");e===this.head_&&(this.head_=e.tq_next_),e===this.tail_&&(this.tail_=this.tail_.tq_prev_),e.tq_next_&&(e.tq_next_.tq_prev_=e.tq_prev_),e.tq_prev_&&(e.tq_prev_.tq_next_=e.tq_next_)}}class r extends Event{constructor(t,s){if(!s||!e.includes(s.previousPriority))throw new TypeError("Invalid task priority: '"+s.previousPriority+"'");super(t),this.previousPriority=s.previousPriority}}class o extends AbortController{constructor(t){if(void 0===t&&(t={}),super(),null==t&&(t={}),"object"!=typeof t)throw new TypeError("'init' is not an object");var s,i,a=void 0===t.priority?"user-visible":t.priority;if(!e.includes(a))throw new TypeError("Invalid task priority: '"+a+"'");this.priority_=a,this.isPriorityChanging_=!1,i=(s=this).signal,Object.defineProperties(i,{priority:{get:function(){return s.priority_},enumerable:!0},onprioritychange:{value:null,writable:!0,enumerable:!0}}),i.addEventListener("prioritychange",(e=>{i.onprioritychange&&i.onprioritychange(e)}))}setPriority(t){if(!e.includes(t))throw new TypeError("Invalid task priority: "+t);if(this.isPriorityChanging_)throw new DOMException("","NotAllowedError");if(this.signal.priority!==t){this.isPriorityChanging_=!0;var s=this.priority_;this.priority_=t;var i=new r("prioritychange",{previousPriority:s});this.signal.dispatchEvent(i),this.isPriorityChanging_=!1}}}void 0===self.scheduler&&(self.scheduler=new class{constructor(){this.queues_={},e.forEach((e=>{this.queues_[e]=new n})),this.pendingHostCallback_=null,this.signals_=new WeakMap}postTask(t,s){if(void 0!==(s=Object.assign({},s)).signal){if(null===s.signal||!("aborted"in s.signal)||"function"!=typeof s.signal.addEventListener)return Promise.reject(new TypeError("'signal' is not a valid 'AbortSignal'"));if(s.signal&&s.signal.priority&&!e.includes(s.signal.priority))return Promise.reject(new TypeError("Invalid task priority: '"+s.signal.priority+"'"))}if(void 0!==s.priority&&(null===s.priority||!e.includes(s.priority)))return Promise.reject(new TypeError("Invalid task priority: '"+s.priority+"'"));if(void 0===s.delay&&(s.delay=0),s.delay=Number(s.delay),s.delay<0)return Promise.reject(new TypeError("'delay' must be a positive number."));var i={callback:t,options:s,resolve:null,reject:null,hostCallback:null,abortCallback:null,onTaskCompleted:function(){this.options.signal&&this.abortCallback&&(this.options.signal.removeEventListener("abort",this.abortCallback),this.abortCallback=null)},onTaskAborted:function(){this.hostCallback&&(this.hostCallback.cancel(),this.hostCallback=null),this.options.signal.removeEventListener("abort",this.abortCallback),this.abortCallback=null,this.reject(this.options.signal.reason)},isAborted:function(){return this.options.signal&&this.options.signal.aborted}},a=new Promise(((e,t)=>{i.resolve=e,i.reject=t}));return this.schedule_(i),a}schedule_(e){var t=e.options.signal;if(t){if(t.aborted)return void e.reject(t.reason);e.abortCallback=()=>{e.onTaskAborted()},t.addEventListener("abort",e.abortCallback)}e.options.delay>0?e.hostCallback=new i((()=>{e.hostCallback=null,this.onTaskDelayExpired_(e)}),null,e.options.delay):(this.pushTask_(e),this.scheduleHostCallbackIfNeeded_())}onTaskDelayExpired_(e){this.pushTask_(e),this.pendingHostCallback_&&(this.pendingHostCallback_.cancel(),this.pendingHostCallback_=null),this.schedulerEntryCallback_()}onPriorityChange_(e){var t=this.signals_.get(e);if(void 0===t)throw new Error("Attempting to change priority on an unregistered signal");t!==e.priority&&(this.queues_[e.priority].merge(this.queues_[t],(t=>t.options.signal===e)),this.signals_.set(e,e.priority))}schedulerEntryCallback_(){this.pendingHostCallback_=null,this.runNextTask_(),this.scheduleHostCallbackIfNeeded_()}scheduleHostCallbackIfNeeded_(){var e=this.nextTaskPriority_();null!=e&&("background"!==e&&this.pendingHostCallback_&&this.pendingHostCallback_.isIdleCallback()&&(this.pendingHostCallback_.cancel(),this.pendingHostCallback_=null),this.pendingHostCallback_||(this.pendingHostCallback_=new i((()=>{this.schedulerEntryCallback_()}),e,0)))}pushTask_(t){var s;if(!e.includes(s=t.options.priority?t.options.priority:t.options.signal&&t.options.signal.priority?t.options.signal.priority:"user-visible"))throw new TypeError("Invalid task priority: "+s);if(t.options.signal&&t.options.signal.priority){var i=t.options.signal;this.signals_.has(i)||(i.addEventListener("prioritychange",(()=>{this.onPriorityChange_(i)})),this.signals_.set(i,i.priority))}this.queues_[s].push(t)}runNextTask_(){var e=null;do{var t=this.nextTaskPriority_();if(null==t)return;e=this.queues_[t].takeNextTask()}while(e.isAborted());try{var s=e.callback();e.resolve(s)}catch(t){e.reject(t)}finally{e.onTaskCompleted()}}nextTaskPriority_(){for(var t=0;t<e.length;t++){var s=e[t];if(!this.queues_[s].isEmpty())return s}return null}},self.TaskController=o,self.TaskPriorityChangeEvent=r)}();const y=[],_="ResizeObserver loop completed with undelivered notifications.";let w;!function(e){e.BORDER_BOX="border-box",e.CONTENT_BOX="content-box",e.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"}(w||(w={}));const k=function(){function e(e,t,s,i){return this.x=e,this.y=t,this.width=s,this.height=i,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,Object.freeze(this)}return e.prototype.toJSON=function(){let e=this;return{x:e.x,y:e.y,top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),A=function(e){return e instanceof SVGElement&&"getBBox"in e},E=function(e){if(A(e)){let t=e.getBBox(),s=t.width,i=t.height;return!s&&!i}let t=e,s=t.offsetWidth,i=t.offsetHeight;return!(s||i||e.getClientRects().length)},I=function(e){let t,s;const i=null===(s=null===(t=e)||void 0===t?void 0:t.ownerDocument)||void 0===s?void 0:s.defaultView;return!!(i&&e instanceof i.Element)},C="undefined"!=typeof window?window:{},S=new Map,B=/auto|scroll/,U=/^tb|vertical/,R=/msie|trident/i.test(C.navigator&&C.navigator.userAgent),P=function(e){return parseFloat(e||"0")},H=function(e,t,s){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===s&&(s=!1),Object.freeze({inlineSize:(s?t:e)||0,blockSize:(s?e:t)||0})},j=Object.freeze({devicePixelContentBoxSize:H(),borderBoxSize:H(),contentBoxSize:H(),contentRect:new k(0,0,0,0)}),F=function(e){if(S.has(e))return S.get(e);if(E(e))return S.set(e,j),j;const t=getComputedStyle(e),s=A(e)&&e.ownerSVGElement&&e.getBBox(),i=!R&&"border-box"===t.boxSizing,a=U.test(t.writingMode||""),n=!s&&B.test(t.overflowY||""),r=!s&&B.test(t.overflowX||""),o=s?0:P(t.paddingTop),l=s?0:P(t.paddingRight),d=s?0:P(t.paddingBottom),c=s?0:P(t.paddingLeft),p=s?0:P(t.borderTopWidth),u=s?0:P(t.borderRightWidth),m=s?0:P(t.borderBottomWidth),h=c+l,g=o+d,v=(s?0:P(t.borderLeftWidth))+u,f=p+m,x=r?e.offsetHeight-f-e.clientHeight:0,b=n?e.offsetWidth-v-e.clientWidth:0,y=i?h+v:0,_=i?g+f:0,T=s?s.width:P(t.width)-y-b,w=s?s.height:P(t.height)-_-x,I=T+h+b+v,C=w+g+x+f,$=Object.freeze({devicePixelContentBoxSize:H(Math.round(T*devicePixelRatio),Math.round(w*devicePixelRatio),a),borderBoxSize:H(I,C,a),contentBoxSize:H(T,w,a),contentRect:new k(c,o,T,w)});return S.set(e,$),$},L=function(e,t){let s=F(e),i=s.borderBoxSize,a=s.contentBoxSize,n=s.devicePixelContentBoxSize;switch(t){case w.DEVICE_PIXEL_CONTENT_BOX:return n;case w.BORDER_BOX:return i;default:return a}},N=function(e){const t=F(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=[t.borderBoxSize],this.contentBoxSize=[t.contentBoxSize],this.devicePixelContentBoxSize=[t.devicePixelContentBoxSize]},M=function(e){if(E(e))return 1/0;let t=0,s=e.parentNode;for(;s;)t+=1,s=s.parentNode;return t},D=function(){let e=1/0;const t=[];y.forEach((s=>{if(0===s.activeTargets.length)return;const i=[];s.activeTargets.forEach((t=>{const s=new N(t.target),a=M(t.target);i.push(s),t.lastReportedSize=L(t.target,t.observedBox),a<e&&(e=a)})),t.push((()=>{s.callback.call(s.observer,i,s.observer)})),s.activeTargets.splice(0,s.activeTargets.length)}));for(let e=0,s=t;e<s.length;e++){(0,s[e])()}return e},V=function(e){S.clear(),y.forEach((t=>{t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach((s=>{s.isActive()&&(M(s.target)>e?t.activeTargets.push(s):t.skippedTargets.push(s))}))}))},O=function(){let e=0;for(V(e);y.some((e=>e.activeTargets.length>0));)e=D(),V(e);return y.some((e=>e.skippedTargets.length>0))&&function(){let e;"function"==typeof ErrorEvent?e=new ErrorEvent("error",{message:_}):(e=document.createEvent("Event"),e.initEvent("error",!1,!1),e.message=_),window.dispatchEvent(e)}(),e>0};let z;const q=[],G=function(e){if(!z){const e=document.createTextNode(""),t={characterData:!0};new MutationObserver((()=>q.splice(0).forEach((e=>e())))).observe(e,t),z=function(){e.textContent=""}}q.push(e),z()};let X=0;const K={attributes:!0,characterData:!0,childList:!0,subtree:!0},W=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"];let Z=!1;const Y=new(function(){function e(){const e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return e.prototype.run=function(e){const t=this;var s;Z||(Z=!0,s=()=>{let s=!1;try{s=O()}finally{if(Z=!1,!X)return;s?t.run(60):e?t.run(e-1):t.start()}},G((()=>{requestAnimationFrame(s)})))},e.prototype.schedule=function(){this.stop(),this.run(12)},e.prototype.observe=function(){const e=this,t=function(){return e.observer&&e.observer.observe(document.body,K)};document.body?t():C.addEventListener("DOMContentLoaded",t)},e.prototype.start=function(){const e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),W.forEach((t=>C.addEventListener(t,e.listener,!0))))},e.prototype.stop=function(){const e=this;this.stopped||(this.observer&&this.observer.disconnect(),W.forEach((t=>C.removeEventListener(t,e.listener,!0))),this.stopped=!0)},e}()),J=function(e){!X&&e>0&&Y.start(),X+=e,!X&&Y.stop()},Q=function(){function e(e,t){this.target=e,this.observedBox=t||w.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){const e=L(this.target,this.observedBox);var t;return t=this.target,A(t)||function(e){switch(e.tagName){case"INPUT":if("image"!==e.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1}(t)||"inline"!==getComputedStyle(t).display||(this.lastReportedSize=e),this.lastReportedSize.inlineSize!==e.inlineSize||this.lastReportedSize.blockSize!==e.blockSize},e}(),ee=function(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t},te=new Map,se=function(e,t){for(let s=0;s<e.length;s+=1)if(e[s].target===t)return s;return-1},ie=function(){function e(){}return e.connect=function(e,t){const s=new ee(e,t);y.push(s),te.set(e,s)},e.observe=function(e,t,s){if(te.has(e)){const i=te.get(e);se(i.observationTargets,t)<0&&(i.observationTargets.push(new Q(t,s&&s.box)),J(1),Y.schedule())}},e.unobserve=function(e,t){if(te.has(e)){const s=te.get(e),i=se(s.observationTargets,t);i>=0&&(s.observationTargets.splice(i,1),J(-1))}},e.disconnect=function(e){if(te.has(e)){const t=te.get(e);y.splice(y.indexOf(t),1),te.delete(e),J(-t.observationTargets.length)}},e}(),ae=function(){function e(e){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof e)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");ie.connect(this,e)}return e.prototype.observe=function(e,t){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!I(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");ie.observe(this,e,t)},e.prototype.unobserve=function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!I(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");ie.unobserve(this,e)},e.prototype.disconnect=function(){ie.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}();let ne={},re=ne,oe=Math.random();window.addEventListener&&window.addEventListener("message",(function(e){if(e.data!=oe)return;ne=ne.next;let t=ne.func;delete ne.func,t()}));const le=function(){const e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},s=function(e){const t=function(e){const t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)};return function(e){const i=this,a=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");let n=arguments[1];if(void 0!==n){if(n=arguments.length>1?arguments[1]:void 0,!t(n))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(T=arguments[2])}const r=s(a.length),o=t(i)?Object(new i(r)):new Array(r);let l,d=0;for(;d<r;)l=a[d],o[d]=n?"undefined"==typeof T?n(l,d):n.call(T,l,d):l,d+=1;return o.length=r,o}}();Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");const t=Object(e);for(let e=1;e<arguments.length;e++){const s=arguments[e];if(null==s)continue;const i=Object.keys(Object(s));for(let e=0,a=i.length;e<a;e++){const a=i[e],n=Object.getOwnPropertyDescriptor(s,a);void 0!==n&&n.enumerable&&(t[a]=s[a])}}return t}}),Object.values||Object.defineProperty(Object,"values",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return"string"==typeof e?e.split(""):Array.isArray(e)?e:"object"!=typeof e?[]:Object.keys(e).map((t=>e[t]))}}),Object.entries||(Object.entries=function(e){const t=[];for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push([s,e[s]]);return t}),Object.fromEntries||(Object.fromEntries=function(e){return[...e].reduce(((e,[t,s])=>(e[t]=s,e)),{})}),Array.prototype.findIndex||(Array.prototype.findIndex=function(e){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");const t=Object(this),s=t.length>>>0,i=arguments[1];let a;for(let n=0;n<s;n++)if(a=t[n],e.call(i,a,n,t))return n;return-1}),Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(e,t){for(let s=this.length-1;s>=0;s--)if(e.call(t,this[s],s,this))return s;return-1}),Array.from||(Array.prototype.from=le),Array.prototype.fill||(Array.prototype.fill=function(e){if(null==this)throw new TypeError("this is null or not defined");const t=Object(this),s=t.length>>>0,i=arguments[1]>>0;let a=i<0?Math.max(s+i,0):Math.min(i,s);const n=arguments[2],r=void 0===n?s:n>>0,o=r<0?Math.max(s+r,0):Math.min(r,s);for(;a<o;)t[a]=e,a++;return t}),Array.prototype.at||(Array.prototype.at=function(e){return e>=0?this[e]:this[this.length+e]}),Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{enumerable:!1,configurable:!0,writable:!0,value:function(e=1){return(e=isNaN(e)?0:Math.floor(e))<1?this.slice():[].concat(...e<2?this:this.map((t=>Array.isArray(t)?t.flat(e-1):t)))}}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return Array.prototype.map.apply(t||this,arguments).flat()}}),Array.prototype.includes||(Array.prototype.includes=function(e){const t=Object(this),s=parseInt(t.length,10)||0;if(0===s)return!1;const i=parseInt(arguments[1],10)||0;let a;for(i>=0?a=i:(a=s+i,a<0&&(a=0));a<s;){const s=t[a];if(e===s||e!=e&&s!=s)return!0;a++}return!1}),"ResizeObserver"in window&&"ResizeObserverEntry"in window||(window.ResizeObserver=ae,window.ResizeObserverEntry=N),window.setImmediate||(window.setImmediate=function(e){re=re.next={func:e},window.postMessage(oe,"*")}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,s){let i=atob(this.toDataURL(t,s).split(",")[1]),a=i.length,n=new Uint8Array(a);for(let e=0;e<a;e++)n[e]=i.charCodeAt(e);e(new Blob([n],{type:t||"image/png"}))}}),"randomUUID"in crypto||(crypto.randomUUID=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))});const de={css:null,exports:{setup(e){this.state={get tabOptions(){return e.props.tabOptions||{}},get scrollable(){return this.tabOptions.scrollable},get flexbeScrollable(){return this.tabOptions.flexbeScrollable}}}},template:(e,t,s,i)=>e('<div expr663="expr663" is="flexbe-scrollable"></div><template expr665="expr665"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-modal-data ",e.classNames({"scrollable-content":e.state.scrollable&&!e.state.flexbeScrollable})].join("")}]},{type:s.IF,evaluate:e=>e.state.flexbeScrollable,redundantAttribute:"expr663",selector:"[expr663]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-scrollable",slots:[{id:"default",html:'<slot expr664="expr664"></slot>',bindings:[{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr664",selector:"[expr664]"}]}],attributes:[]}])},{type:s.IF,evaluate:e=>!e.state.flexbeScrollable,redundantAttribute:"expr665",selector:"[expr665]",template:e('<slot expr666="expr666"></slot>',[{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr666",selector:"[expr666]"}])}]),name:"flexbe-modal-data"};e(de.name,de);const ce={css:null,exports:{setup(e,{initMobx:t,inject:s}){t(),this.modal=s("modal"),this.state={get list(){let t=e.props.actions||[];return t=t.filter((e=>!e.hide&&(e.icon||e.text||e.isCustomAction))),t=t.map((e=>(null==e.iconSize&&(e.iconSize=16),e))),t}},this.watch={"state.list":()=>this.update()}},applyAction(e,t){null==e.action||e.action(this.modal,e,t.target.closest(".flexbe-button"))}},template:(e,t,s,i)=>e('<div expr951="expr951" class="flexbe-modal-action-item"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-modal-actions ",e.props.class].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e('<div expr952="expr952" is="flexbe-tooltip" type="custom"></div><div expr956="expr956"></div>',[{type:s.IF,evaluate:e=>!e.action.isCustomAction,redundantAttribute:"expr952",selector:"[expr952]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[{id:"default",html:'<svg expr953="expr953"></svg><div expr955="expr955" class="flexbe-text"></div>',bindings:[{type:s.IF,evaluate:e=>e.action.icon,redundantAttribute:"expr953",selector:"[expr953]",template:e('<use expr954="expr954"/>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-icon size-",e.action.iconSize].join("")}]},{redundantAttribute:"expr954",selector:"[expr954]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.action.icon}]}])},{type:s.IF,evaluate:e=>e.action.text,redundantAttribute:"expr955",selector:"[expr955]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.action.text].join("")}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.action.tip},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button tooltipstered ",e.action.class].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>t=>e.applyAction(e.action,t)},{type:t.ATTRIBUTE,name:null,evaluate:e=>e.action.attr}]}])},{type:s.IF,evaluate:e=>e.action.isCustomAction,redundantAttribute:"expr956",selector:"[expr956]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>e.action.component,slots:[],attributes:[{type:t.ATTRIBUTE,name:"modal",evaluate:e=>e.modal},{type:t.ATTRIBUTE,name:null,evaluate:e=>e.action.props}]}])}]),redundantAttribute:"expr951",selector:"[expr951]",itemName:"action",indexName:null,evaluate:e=>e.state.list}]),name:"flexbe-modal-actions"};e(ce.name,ce);const pe=(e,t,s,i=!0)=>((e,t,s,i=!0)=>{const a=Symbol("empty"),n=i?[...e]:e,r=t.map((e=>n[e])),o=t.length;return n.splice(s,0,...r),t.forEach((e=>{n[e<s?e:e+o]=a})),n.filter((e=>e!==a))})(e,[t],s>t?s+1:s,i),ue=(e,t)=>e.length>t?[e.slice(0,t),...ue(e.slice(t),t)]:[e],me=e=>{const t=new Map,s=[],i=e.length;let a=0;for(let n=0;n<i;n++){const i=e[n];t.has(i)||(t.set(i,1),s[a++]=i)}return t.clear(),s},he=(e,t)=>Array.isArray(e)&&t?e.reduce(((s,i,a)=>(s[t(i,a,e)]=i,s)),{}):null,ge=(e,t)=>{if(!Array.isArray(e))return e;const s=(e,t,s)=>"string"==typeof e&&"string"==typeof t?((e,t,s)=>"DESC"===s?String(t).localeCompare(String(e)):String(e).localeCompare(String(t)))(e,t,s):Number.isNaN(e)||Number.isNaN(t)?0:((e,t,s)=>"DESC"===s?t-e:e-t)(e,t,s);return e=e.sort(((e,i)=>{if("object"!=typeof e){const a=/desc/i.test(t)?"DESC":"ASC";return s(e,i,a)}if("object"==typeof t)for(const a in t)if(t.hasOwnProperty(a)){const n=/desc/i.test(t[a])?"DESC":"ASC",r=s(e[a],i[a],n);if(r)return r}return 0}))};async function ve(e,t,s){if(s){const s=[];for(const[i,a]of e.entries())s.push(await t(a,i,e));return Promise.resolve(s)}return Promise.all(e.map(t))}const fe=new Map,xe=async(e,t)=>{const s=e.map((async e=>{if(!fe.has(e)){const t=new Promise(((t,s)=>{const i=document.createElement("link");i.onerror=s,i.onload=t,i.rel="stylesheet",i.href=e,document.body.appendChild(i)}));fe.set(e,t)}return fe.get(e)})),i=await Promise.all(s);return"function"==typeof t&&t(i),i},be=async(e,t)=>{const s=e.map((async e=>{if(!fe.has(e)){const t=new Promise(((t,s)=>{$.ajax({url:e,dataType:"script",cache:!0}).done(t).fail(s)}));fe.set(e,t)}return fe.get(e)})),i=await Promise.all(s);return"function"==typeof t&&t(i),i},ye=(e,t)=>{let s=$.param(e);return t&&(s=decodeURIComponent(s)),s},_e=(e,t=!0)=>{const s={},i={true:!0,false:!1,null:null};return e?(e.replace(/^\?/,"").replace(/\+/g," ").split("&").forEach((e=>{const a=e.split("=");let n,r=decodeURIComponent(a[0]),o=s,l=0,d=r.split("]["),c=d.length-1;if(/\[/.test(d[0])&&/]$/.test(d[c])?(d[c]=d[c].replace(/]$/,""),d=d.shift().split("[").concat(d),c=d.length-1):c=0,2===a.length)if(n=decodeURIComponent(a[1]),t&&(n=n&&!isNaN(n)&&""+ +n===n?+n:"undefined"===n?void 0:void 0!==i[n]?i[n]:n),c)for(;l<=c;l++)r=""===d[l]?o.length:d[l],o=o[r]=l<c?o[r]||(d[l+1]&&Number.isNaN(Number(d[l+1]))?{}:[]):n;else"[object Array]"===Object.prototype.toString.call(s[r])?s[r].push(n):!{}.hasOwnProperty.call(s,r)?s[r]=n:s[r]=[s[r],n];else r&&(s[r]=t?void 0:"")})),s):s},Te=(e,t,s)=>!(!Array.isArray(t)||!Array.isArray(s)||t.length!==s.length)&&t.every(((t,i)=>e?s.includes(t):s[i]===t));Te.bind(null,!0),Te.bind(null,!1);const we=(e,t,s=94608e3,i="/")=>{const a=(new Date).getTime()+1e3*s;document.cookie=`${e}=${escape(t)}; path=${i}; domain=.${document.location.hostname};  expires=${new Date(a)}`},ke=e=>{const t=Re(e);return t&&[3,6,8].includes(t.length)};function Ae(e){return/^\s*(?:linear-gradient|repeat-linear-gradient|radial-gradient)\(.*\)/i.test(e)}function Ee(e){return!Ae(e)&&(Se(e)||$e(e)||Ce(e)||Ie(e))}function Ie(e){return/^rgba\((?:\s*0*(?:\d{1,2}(?:\.\d+)?(?:\s*%)?|\.\d+\s*%|100(?:\.0*)?\s*%|(?:1\d{2}|2[0-4]\d|25[0-5])(?:\.\d+)?)\s*,){3}\s*0*(?:\.\d+|1?)\s*\)$/.test(e)}function Ce(e){return/^rgb\((?:\s*0*(?:\d{1,2}(?:\.\d+)?(?:\s*%)?|\.\d+\s*%|100(?:\.0*)?\s*%|(?:1\d{2}|2[0-4]\d|25[0-5])(?:\.\d+)?)\s*,?){3}\)$/.test(e)}function Se(e){return!Ce(e)&&!Ie(e)&&(e=Re(e),!!ke(e)&&/^#?([\da-f]{3}|[\da-f]{6})$/i.test(e))}function $e(e){return!Ce(e)&&!Ie(e)&&(e=Ue(e),!!ke(e)&&/^#?[\da-f]{8}$/i.test(e))}function Be(e){const t=e.map((e=>function(e,t=!0){var s;let i=null;if(Se(e)||$e(e))i=He(e,!0);else{if(!Ie(e)&&!Ce(e))return 0;{const s=(e=e.replace(/^rgb\(/,"").replace(/^rgba\(/,"").replace(/\)$/,"")).split(","),a=t?+s[3]:null;i={r:+s[0],g:+s[1],b:+s[2]},a&&(i.a=a)}}return(.2126*i.r/255+.7152*i.g/255+.0722*i.b/255)*(null!=(s=i.a)?s:1)}(e))),s=t.reduce(((e,t)=>t<e?t:e),1);let i=t.findIndex((e=>e===s));return i=-1!==i?i:0,e[i]}function Ue(e=""){return"string"!=typeof e?e:String(e).replace(/[^\da-f]/gi,"").slice(0,8)}function Re(e,t=!1){return"string"!=typeof e?e:(3===(e=Ue(e)).length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),7===e.length&&(e+=e[6]),8===e.length&&/ff$/i.test(e)&&(e=e.slice(0,6)),t?`#${e}`:e)}function Pe(e,t="#000000",s="#FFFFFF",i=.484){const a={white:t,black:s,light:t,dark:s};if(!e)return t;if(void 0!==a[e])return a[e];i=Number(i);let n={r:null,g:null,b:null};if(Ae(e)&&(e=function(e){if(Ae(e)){const t=Ne(e),s=Array(t.fillability.length).fill(0);s[0]=parseFloat(t.fillability[0]),s[s.length-1]=100-parseFloat(t.fillability[t.fillability.length-1]);const i=t.fillability.reduce(((e,t,s,i)=>{if(void 0===i[s+1])return e;const a=(parseFloat(i[s+1])-parseFloat(t))/2;return e[s]=parseFloat(e[s])+a,e[s+1]=parseFloat(e[s+1])+a,e}),s);let a;if(i.reduce(((e,t,s,i)=>{const a=Math.abs(i[s+1]-t);return a>e?a:e}),0)<10)a=Be(t.colors);else{const e=i.reduce(((e,t,s,i)=>t>i[e]?s:e),0);a=t.colors[e]}return a}return null}(e)),Se(e)||$e(e)){let t=e.replace(/^#/,"");3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),n={r:parseInt(t.slice(0,2),16)/255,g:parseInt(t.slice(2,4),16)/255,b:parseInt(t.slice(4,6),16)/255},Object.keys(n).forEach((e=>{const t=n[e];n[e]=t<=.03928?t/12.92:((t+.055)/1.055)**2.4}))}else if(Ie(e)||Ce(e)){const t=(e=e.replace(/^rgba\(/,"").replace(/^rgb\(/,"").replace(/\)$/,"")).split(",");n={r:Number(t[0])/255,g:Number(t[1])/255,b:Number(t[2])/255}}return.2126*n.r+.7152*n.g+.0722*n.b<i?s:t}function He(e,t=!1){const s={type:"rgb",r:0,g:0,b:0};if(!e)return{};e=Re(e);const i=/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i.exec(e);if(i){let e=Oe(parseInt(i[4],16)/255);s.r=parseInt(i[1],16),s.g=parseInt(i[2],16),s.b=parseInt(i[3],16),Number.isNaN(e)||(e=parseFloat(e.toFixed(3)),s.a=e,s.type="rgba")}if(!t){let e=`${s.type}(`;return e+=`${s.r}, ${s.g}, ${s.b}`,"rgba"===s.type&&(e+=`, ${s.a}`),e+=")",e}return s}function je(e){if(Se(e))return e;let t,s,i,a,n=e;if("string"==typeof e&&(n=e.trim().replace(/(^rgba?\(|\)$)/g,"").replace(/\s/g,"").split(",").map((e=>+e))),t=De(0,+n[0],255),s=De(0,+n[1],255),i=De(0,+n[2],255),a=De(0,Math.round(255*+n[3]),255),Number.isNaN(t)||Number.isNaN(s)||Number.isNaN(i))return"";t=t.toString(16),s=s.toString(16),i=i.toString(16),t=1===t.length?`0${t}`:t,s=1===s.length?`0${s}`:s,i=1===i.length?`0${i}`:i;let r=`#${t}${s}${i}`;return Number.isNaN(a)||(a=a.toString(16),a=1===a.length?`0${a}`:a,r+=a),r}function Fe(e=[],t=1){if(!Array.isArray(e))return null;const s=document.createElement("canvas"),i=s.getContext("2d");s.width=1,s.height=1,i.globalCompositeOperation="source-over",i.globalAlpha=t,(e=e.filter((e=>e&&"transparent"!==e))).forEach((e=>{const t=document.createElement("canvas"),s=t.getContext("2d");t.width=1,t.height=1,s.rect(0,0,1,1),s.fillStyle=e,s.fill("nonzero"),i.drawImage(t,0,0,1,1),t.remove()}));const a=Re(je(i.getImageData(0,0,1,1).data),!0);return s.remove(),a}function Le(e,t,s="source"){if(Ae(e)){const s=Ne(e);return s.colors=s.colors.map((e=>Le(e,t,"rgb"))),Me(s)}if(Ee(e)){let i=De(0,Math.round(255*+t),255);Number.isNaN(t)&&(t=255),i=i.toString(16),i=2===i.length?i:`0${i}`;const a=!(!Ce(e)&&!Ie(e))&&e;let n=Se(e)||$e(e)?Re(e,!0):"";if(!a&&!Se(n))return null;a&&(n=je(a)),n=n.length>7?n.slice(0,7):n;const r=`${n}${i}`;return"source"===s&&(s=a?"rgb":"hex"),/^rgb/.test(s)?He(r):r}return e}function Ne(e){var t;const s=null==(t=String(e).match(/linear|radial/))?void 0:t[0];if(!s)return null;e=function(e){return Object.entries({"to top":"0deg","to right":"90deg","to bottom":"180deg","to left":"270deg","to right top":"45deg","to top right":"45deg","to right bottom":"135deg","to bottom right":"135deg","to left bottom":"225deg","to bottom left":"225deg","to left top":"315deg","to top left":"315deg"}).reduce(((e,[t,s])=>e.includes(t)?e.replace(t,s):e),e)}(e=e.trim().replace(";",""));const[i,a,n]=e.match(/gradient\((?:(-?\d+\.?\d*)(?:deg)?\s*,)?(.*)\)$/),r=Number.isNaN(parseFloat(a))?180:parseFloat(a),o=Array.from(n.matchAll(/(#(?:[\dA-Fa-f]{8}|[\dA-Fa-f]{6}|[\dA-Fa-f]{3})|rgba?\([^)]+\)|[a-z]+)\s*([\d.-]*(?:%|px|em))?/g)),l=[],d=[],c=[];o.forEach((([e,t,s],i)=>{if(null==s){s=100/(o.length-1)*i+"%"}/^\d+$/.test(s)&&(s=`${s}%`),d.push(t),c.push(s),l.push(`${t} ${s}`)}));const p={type:s,angle:r,matches:l,colors:d,fillability:c};return{...p,value:Me(p)}}function Me({colors:e,angle:t,fillability:s,type:i}){var a,n,r,o;i=null!=(a=i)?a:"linear",t=null!=(n=t)?n:180,e=null!=(r=e)?r:[],s=null!=(o=s)?o:["0%","100%"];const l=e.map(((e,t)=>`${e} ${s[t]}`)).join(", ");return"radial"===i?`radial-gradient(${l})`:`linear-gradient(${t}deg, ${l})`}function De(e,t,s){return Math.max(e,Math.min(t,s))}function Ve([e,t],[s,i]){return Math.sqrt((s-e)**2+(i-t)**2)}const Oe=e=>Math.round(100*(e+Number.EPSILON))/100;function ze(e){return"number"!=typeof e||Number.isNaN(e)}const qe=e=>"number"==typeof e&&e<10?`0${e}`:e,Ge=(e=6,{exclude:t=[],prefix:s="",suffix:i="",radix:a=10}={})=>{let n="";for(let t=0;t<e;t++){const e=(r=0===t?1:0,o=a-1,Math.floor(Math.random()*(o-r+1)+r));n+=e.toString(a).toUpperCase()}var r,o;return n=s+n+i,t.find((e=>e==n))?Ge(e,{exclude:t,prefix:s,suffix:i,radix:a}):n},Xe=(e,t="d.m.y h:i:s")=>{if("Invalid Date"===(e=new Date(e)).toString())return null;const s={d:qe(e.getDate()),m:qe(e.getMonth()+1),y:e.getFullYear(),h:qe(e.getHours()),i:qe(e.getMinutes()),s:qe(e.getSeconds())};t=(t=t.toLowerCase()).replace(/[^\s().:[\\\/]_dhimsy{}-]/g,"");for(const e in s)t=t.replace(e,s[e]);return t},Ke=(e,t)=>{const s=Ye(t),i=e.split(s);t=t.replace(/d+/i,"date").replace(/m+/i,"month").replace(/y+/i,"year");const a={date:0,month:0,year:0};return t.split(s).forEach(((e,t)=>{a[e]=i[t]||""})),a},We=e=>"string"==typeof e?new Date(e.slice(0,19).replace("T"," ")):e,Ze=({date:e,timezone:t,format:s="date"})=>{if(!e||!t)return null;const i=new Date(We(e)),a=new Date,n=new Date(a.toLocaleString("en-US",{timeZone:t}));a.setMilliseconds(0),n.setMilliseconds(0);const r=a.getTime()-n.getTime(),o=i.getTime()-r;return"milliseconds"===s?o:new Date(o)},Ye=e=>{const t=e.match(/[^\w\s]/g);return t&&t.length>0?t[0]:"."},Je=e=>{const t=e.split(/[- :.]/),s=parseInt(t[0]),i=parseInt(t[1])-1,a=parseInt(t[2]),n=parseInt(t[3]),r=parseInt(t[4]),o=parseInt(t[5]);return Date.UTC(s,i,a,n,r,o)};const Qe=()=>!!window.getSelection&&(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges(),!0),et=e=>Object.entries(e).reduce(((e,t)=>{const[s,i]=t;return i?[...e,s]:e}),[]).join(" ");function tt(e,t){const s=[e,...$(e).parents().toArray()],i=Array.isArray(t)?t:[t];let a=null;return s.some((e=>i.some((t=>!!$(e).is(t)&&(a=e,!0))))),a}function st(e,t=!1){if(!e||"string"!=typeof e)return e;return[["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"]].forEach((([s,i])=>{const a=t?i:s,n=t?s:i;e=e.replace(new RegExp(a,"g"),n)})),e}const it=(e,t=[],s=null)=>"function"==typeof e?e.apply(s,t):e,at=(e,t="editor")=>`/_s/images/${t}/${e}.svg?${"object"==typeof flexbe?flexbe.vars.versionId:0}`,nt={avif:null,webp:null};function rt(){var e;const t="object"==typeof flexbe_cli&&(null==(e=flexbe_cli.vars)?void 0:e._group.images)||{};return{lazy:!0,lazy_priority:!1,avif:!1,webp:!1,avif_support:nt.avif||t.avif_support,webp_support:nt.webp||t.webp_support,slow_network:!1,quality_map:{jpg:70,webp:70,avif:55}}}async function ot(e){try{const t=new Image;return"decode"in t?(t.src=e,await t.decode(),!0):await new Promise((s=>{const i=t;i.onload=()=>s(!0),i.onerror=()=>s(!1),i.src=e}))}catch(e){return!1}}async function lt(e){return new Promise(((t,s)=>{const i=new Image,a=()=>{t(i),setTimeout((()=>{"function"==typeof i.remove&&i.remove()}),10)};"decode"in i&&!/\.svg/.test(e)?(i.src=e,i.decode().then(a).catch(s)):(i.onerror=s,i.onload=a,i.src=e)}))}function dt(e,t=null,s=null){var i;s={...rt(),...s};const{id:a,ext:n}=e;if(!a)return"";t||"webp"!==e.ext||s.webp_support||(t=Math.min(e.width||2160,2160));const r=null!=(i=e.animated)?i:"gif"===n,o=`/img/${a}.${n}`;if(!t||r||"svg"===n)return o;const l=function(e,t){const s=t.avif_support,i=t.webp_support,a=t.avif,n=t.webp;let r=e.ext;return s&&a?r="avif":i&&n?r="webp":"webp"===e.ext&&(r=i?"webp":e.transparent?"png":"jpg"),r}(e,s),d=s.slow_network&&"4g"!==((null==(c=navigator.connection)?void 0:c.effectiveType)||"4g");var c;let p=s.quality_map;switch(d&&(p={jpg:50,webp:50,avif:45}),l){case"png":return`/img/${a}_${t}.png`;case"avif":case"webp":case"jpg":return`/img/${a}_${t}_q${p[l]}.${l}`;case"gif":default:return o}}function ct(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)return e;e=e.replace(/(\/img\/[\d_q]+)\/[\w-]+(\.\w{3,4})/i,"$1$2");let[,t,s,i,a]=e.match(/\/img\/(\d+)_?(\d+)?_?q?(\d+)?\.(\w{3,4})/i)||[];return s=s?+s:0,i=i?+i:"none",{id:t,ext:a,name:`${t}.${a}`,size:s,quality:i}}(e)),!e||"object"!=typeof e)return{};let t=e.img_ext||e.ext;const s=e.img_id||e.id,i=e.img_name||e.name;t&&"false"!==t||(t=i?function(e){const t=String(e).match(/\.(jpg|jpeg|png|gif|svg|bmp|webp)$/i);return t&&t[1]?t[1]:""}(i):"jpg");const a=e.img_border||e.border;return{id:s,ext:t,average:function(e){return"transparent"!==e?e:"#000000"}(e.img_average||e.average),preview:e.img_preview||e.preview||"",width:e.img_width||e.width||0,height:e.img_height||e.height||0,proportion:+(+e.img_proportion||+e.proportion||0).toFixed(2),border:a,animated:e.img_animated||e.animated||"gif"===t,transparent:e.img_transparent||e.transparent||!1}}function pt(e,t=0,s){return dt(ct(e),"number"==typeof t?Math.round(t):t,s)}function ut(e,t=2){const s=(e=String(e).replace(/,/g,".").replace(/ /g,"").replace(/(?!^)\-/g,"").replace(/^\./g,"0.")).replace(/[^\d\.]/g,"");let i=((s.match(new RegExp("\\.\\d{1,"+t+"}$"))||[])[0]||"").replace(/\D/g,""),a=s.replace(new RegExp("\\."+i+"$"),"");a=parseInt(a.replace(/[^\d-]/g,""),10)||0,parseInt(i,10)||(i="");const n=parseFloat(i?`${a}.${i}`:a);return/^-/.test(e)?-n:n}function mt(e,t=flexbe.vars.group.currency_format,s=flexbe.vars.group.currency){e=parseFloat(e),t=Object.assign({t:".",d:",",str:":symbol:value",d_force:!1},t),s=Object.assign({decimals:2,symbol:""},s);const i=t.str,a=t.d,n=Math.abs(e)>=1e4?t.t:"",r=t.d_force||parseInt(e,10)!==e?s.decimals:0,o=ht(Math.abs(e),r,a,n);let l=i.replace(":value",o).replace(":symbol",s.symbol);return e<0&&(l=`-${l}`),l.trim()}function ht(e,t=2,s=",",i="."){let a,n;isNaN(t=Math.abs(t))&&(t=2),a=parseInt(e=(+e||0).toFixed(t),10)+"",(n=a.length)>3?n%=3:n=0;return(n?a.substr(0,n)+i:"")+a.substr(n).replace(/(\d{3})(?=\d)/g,"$1"+i)+(t?s+Math.abs(e-a).toFixed(t).replace(/-/,0).slice(2):"")}const gt=e=>{if(null==e)return[];if(Array.isArray(e))e=e.flat(99).join(".").split(".");else if("string"==typeof e){if(e.startsWith("/"))return e.substring(1).split("/").map((e=>e.replace(/~1/g,"/").replace(/~0/g,"~")));e=e.replace(/\[(\d+)]/g,".$1").split(/\.|\//).flat(9)}return e=e.filter((e=>null!=e&&""!==e))},vt=(...e)=>[...e].reduce(((e,t)=>"object"==typeof t?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):e)),ft=(e,...t)=>{if(!t.length)return e;const s=e=>e&&"object"==typeof e&&!Array.isArray(e),i=t.shift();if(s(e)&&s(i))for(const t in i)s(i[t])?(e[t]||Object.assign(e,{[t]:{}}),ft(e[t],i[t])):Object.assign(e,{[t]:i[t]});return ft(e,...t)},xt=(e,t=[],s=!1)=>(t=gt(t))&&t.length?"object"!=typeof e?e:t.reduce(((e,t)=>{if(!("object"!=typeof e||null==e||Array.isArray(e)&&"number"==typeof+t&&(+t<0||+t>e.length-1)))return s?it(e[t],null,e):e[t]}),e):e,bt=e=>{if("object"!=typeof e||null==e)return e;const t=Array.isArray(e)?[...e]:{...e};let s;for(s in t)t.hasOwnProperty(s)&&(t[s]=bt(t[s]));return t},yt=(e,t,s=!1)=>{if(null==e||null==t||"object"!=typeof e||"object"!=typeof t)return t;if(Array.isArray(e)&&Array.isArray(t))e.splice(0,e.length,...t);else{for(const s in e)void 0===t[s]&&delete e[s];for(const i in t)s?e[i]=yt(e[i],t[i],s):e[i]!==t[i]&&(e[i]=t[i])}return e},_t=(e,t,s,i=!0)=>{if("object"!=typeof e||"string"!=typeof t&&!Array.isArray(t))return null;if(!(t=gt(t)).length)return"object"==typeof s?(yt(e,s),e):null;const a=t.splice(t.length-1,1)[0],n=t.reduce(((e,s,n)=>{if(i){const i="object"==typeof e[s],r=Array.isArray(e[s])&&!e[s].length;if(!i||r){const i=String(t[n+1]||a);e[s]="0"===i?[]:{}}}return e&&"object"==typeof e[s]?e[s]:void 0}),e);return"object"==typeof n&&(n[a]=s),e},Tt=(e,t,s,i={})=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:s,set(s){Object.defineProperty(e,t,{value:s,configurable:!0,enumerable:!0,writable:!0})},...i})},wt=(e,t,s)=>{const i=Object.getOwnPropertyDescriptor(e,t)||{};Object.defineProperty(e,t,{...i,...s})};class kt{on(e,t){return this}one(e,t){return this}off(e,t){return this}trigger(e,...t){return this}emit(e,...t){return this}constructor(){At(this)}}function At(e){const t=$({}),s=new WeakMap;null==e&&(e={});const i=(e,t)=>(s,...i)=>(e.triggerHandler(s,i),e.triggerHandler("*",[s,...i]),t),a=i;return Object.defineProperties(e,Object.entries({on:(e,t)=>(i,a)=>{const n=(e,...s)=>a.call(t,...s,...s);return s.set(a,n),e.on(i,n),t},off:(e,t)=>(i="*",a)=>("*"===i?e.off():e.off(i,s.get(a)),t),one:(e,t)=>(i,a)=>{const n=(e,...s)=>a.call(t,...s,...s);return s.set(a,n),e.one(i,n),t},emit:a,trigger:i}).reduce(((s,[i,a])=>(s[i]={value:a(t,e),enumerable:!1,writable:!1,configurable:!1},s)),{})),e}let Et,It=!1;const Ct=e=>{Et.size?(requestAnimationFrame(Ct),Array.from(Et).forEach((([t,s])=>{if(s.last>=e)return;const i="function"==typeof s.fps?s.fps():s.fps;(!i||e-s.last>=1e3/i)&&(s.last=e,t(e))}))):It=!1};function St(e,t=0){return Et||(Et=new Map),Et.set(e,{last:0,fps:t}),It||requestAnimationFrame(Ct),()=>{Et.delete(e)}}function $t(e,t=""){const s=String(e).trim().match(/\d+(\D+)$/);return s&&s[1]?s[1].trim():t}function Bt(e,t){const s=function(e){return parseFloat(String(e).replace(/[^\d+.-]+/g,""))}(e);return[ze(s)?e:s,$t(e,t)]}const Ut=()=>{const e=navigator.userAgent;let t,s=e.match(/(opera|chrome|safari|yabrowser|firefox|msie|edge|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(s[1])?(t=/\brv[ :]+(\d+)/g.exec(e)||[],{name:"IE",version:t[1]||""}):"Chrome"===s[1]&&(t=e.match(/\bEdge\/(\d+)/),null!==t)?{name:"Edge",version:t[1]}:(s=s[2]?[s[1],s[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(t=e.match(/version\/([0-9]*\.?[0-9]+)/i))&&s.splice(1,1,t[1]),{name:s[0],version:+s[1]})},Rt=(e,t)=>{const s=String(e).split(".").map(Number),i=String(t).split(".").map(Number);if(!e||!t)return!1;for(let e=0;e<Math.max(s.length,i.length);e++){const t=s[e]||0,a=i[e]||0;if(t<a)return!1;if(t>a)return!0}return!0},Pt={css:null,exports:{components:{"flexbe-modal-actions":ce},setup(e,{initMobx:t}){t(),this.sprite=at("adaptive"),this.state={get options(){return e.props.options},get tabOptions(){return e.props.tabOptions},get tabs(){return e.props.tabs},get activeTabId(){return this.tabOptions.id},get actions(){return this.tabOptions.modalActions||[]},get icon(){let e=this.options.icon;return this.tabs&&1===this.tabs.length&&(e=this.tabs[0].icon),e},get title(){var e,t;let s=this.options.title;return(null!=(e=!s)?e:null==(t=this.tabs)?void 0:t.length)&&(s=this.tabs[0].title),!!s&&tr(s)},get className(){const t=[e.props.class||""];return t.push(this.options.handle?"draggable":"nodraggable"),t.join(" ")},get showActions(){return!!this.actions.length},get showTitle(){return this.title&&!this.showTabs},get showTabs(){return this.tabs&&this.tabs.length>1},get responsiveMode(){let t=e.props.responsiveMode;return this.responsiveModesList.find((e=>e.value===t))||(t="all"),t},get responsiveModesList(){return this.tabOptions&&this.tabOptions.adaptive?Object.keys(this.tabOptions.adaptive).map((e=>({value:e,iconSize:"all"===e?18:14,icon:"all"===e?"all-14":`${e}-14`,tip:"all"===e?tr("editor::layout::toggle_adaptive_view::all"):tr(`editor::layout::toggle_adaptive_view::${e}`)}))):[]},get showAdaptiveToggle(){return this.responsiveModesList.length>=2}}},pointerDown(e){if($(e.target).closest(".flexbe-modal-tab").length){const{pageX:t,pageY:s}=e;this.initialCoords={pageX:t,pageY:s}}},pointerUp(e){const t=$(e.target).closest(".flexbe-modal-tab");if(t.length&&this.initialCoords){const{pageX:s,pageY:i}=e;+Ve([s,i],[this.initialCoords.pageX,this.initialCoords.pageY]).toFixed(0)<=35&&this.props.onTabSelect(t.attr("data-id")),this.initialCoords=null}flexbe.trigger("closeDropdown")},toggleResponsiveMode({value:e}){this.props.onToggleResponsiveMode(e),flexbe.tip.hideAll()}},template:(e,t,s,i)=>e('<template expr667="expr667"></template><div expr671="expr671" class="flexbe-modal-tabs-list"></div><div expr675="expr675" is="flexbe-modal-actions"></div><div expr676="expr676" is="flexbe-switch" class="flexbe-modal-responsive-toggle"></div><a expr677="expr677"></a>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-modal-title ",e.state.className].join("")},{type:t.EVENT,name:"onpointerup",evaluate:e=>e.pointerUp},{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.pointerDown},{type:t.ATTRIBUTE,name:"data-layers-events",evaluate:e=>"ignore"}]},{type:s.IF,evaluate:e=>e.state.showTitle,redundantAttribute:"expr667",selector:"[expr667]",template:e('<svg expr668="expr668" class="flexbe-icon size-16"></svg><span expr670="expr670" class="title-text"></span>',[{type:s.IF,evaluate:e=>e.state.icon,redundantAttribute:"expr668",selector:"[expr668]",template:e('<use expr669="expr669"/>',[{redundantAttribute:"expr669",selector:"[expr669]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.icon}]}])},{type:s.IF,evaluate:e=>e.state.title,redundantAttribute:"expr670",selector:"[expr670]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.title].join("")}]}])}])},{type:s.IF,evaluate:e=>e.state.showTabs,redundantAttribute:"expr671",selector:"[expr671]",template:e('<span expr672="expr672"></span>',[{type:s.EACH,getKey:null,condition:null,template:e('<span expr673="expr673" is="flexbe-icon"></span><span expr674="expr674" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-modal-tab ",e.classNames({notify:e.tab.notify,active:e.tab.id===e.state.activeTabId})].join("")},{type:t.ATTRIBUTE,name:"data-id",evaluate:e=>e.tab.id}]},{type:s.IF,evaluate:e=>e.tab.icon,redundantAttribute:"expr673",selector:"[expr673]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.tab.icon}]}])},{redundantAttribute:"expr674",selector:"[expr674]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr(e.tab.title)}]}]),redundantAttribute:"expr672",selector:"[expr672]",itemName:"tab",indexName:null,evaluate:e=>e.state.tabs}])},{type:s.IF,evaluate:e=>e.state.showActions,redundantAttribute:"expr675",selector:"[expr675]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-modal-actions",slots:[],attributes:[{type:t.ATTRIBUTE,name:"actions",evaluate:e=>e.state.actions}]}])},{type:s.IF,evaluate:e=>e.state.showAdaptiveToggle,redundantAttribute:"expr676",selector:"[expr676]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-switch",slots:[],attributes:[{type:t.ATTRIBUTE,name:"separator",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.responsiveMode},{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.state.responsiveModesList},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite},{type:t.EVENT,name:"onChange",evaluate:e=>e.toggleResponsiveMode}]}])},{type:s.IF,evaluate:e=>e.state.options.closeButton,redundantAttribute:"expr677",selector:"[expr677]",template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.options.closeButtonClass}]}])}]),name:"flexbe-modal-title"};function Ht(e){return"string"==typeof e?e:e&&e.name}function jt(e){if(!e||!e.length)return;const t=$(e),s=$(e).find('input:not([tabindex="-1"]), textarea:not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])');t.attr("data-tab-disabled","true"),s.attr("tabindex",-1).attr("data-tab-disabled","true")}function Ft(e){if(!e||!e.length)return;const t=$(e),s=t.find("[data-tab-disabled][tabindex]");t.removeAttr("data-tab-disabled"),s.attr("tabindex",0).removeAttr("data-tab-disabled")}function Lt(e){const s={},i=e=>{const i=Ht(e),a=function(e){return"string"==typeof e?t.globals.COMPONENTS_IMPLEMENTATION_MAP.get(e):e}(e);return i&&a&&(s[i]=a),s};return i(e.component),e.tabs.forEach((e=>i(e.component))),s}function Nt(){return"object"==typeof uiStore&&uiStore.view.responsiveMode||"desktop"}e(Pt.name,Pt);const Mt={css:null,exports:{components:{"flexbe-modal-title":Pt,"flexbe-modal-data":de},setup(e,{initMobx:t,provide:s}){var i,a;s("modal",e.props.modal),t();const n=e.props.modal,r=1===(null==(i=flexbe.vars)||null==(a=i.page)?void 0:a.responsive)&&"object"==typeof uiStore;this.components={...this.components,...Lt(n.options)},this.modal=n,this.state={tabOptions:{},get modalOptions(){return n.options||{}},get adaptiveOptions(){return this.tabOptions.adaptive?this.tabOptions.adaptive[this.responsiveMode]||this.tabOptions.adaptive.all:{}},get options(){return{...this.modalOptions,...this.tabOptions,...this.adaptiveOptions}},activeTab:null,canRender:!1,allowResponsive:r,initialResponsiveMode:r?Nt():"desktop",responsiveMode:r?Nt():"desktop",get pageResponsiveMode(){return Nt()},get riotComponentName(){return Ht(this.options.component)},get riotOldTagName(){return this.options.riotTag},get componentProps(){return{...this.modalOptions.props||{},...this.tabOptions.props||{},...this.adaptiveOptions.props||{}}},get tabs(){return this.modalOptions.tabs},get defaultTabId(){const e=this.activeTab||this.modalOptions.activeTab;return!(this.tabs&&this.tabs.length)||null!=e&&this.tabs.find((t=>t.id===e))?e:this.tabs[0].id},get disabled(){return n.disabled||!1},get loading(){return n.loading||!1},get className(){const e=this.modalOptions.uiClass;let t=this.modalOptions.class||[];return"string"==typeof t&&(t=[t]),t.push(`flexbe-modal--${this.modalOptions.type}`),this.loading&&t.push("loading"),this.hasTitle||t.push("no-title"),this.tabs.length&&t.push("is-tabs"),this.modalOptions.compact&&t.push("is-compact"),e&&t.push(e),t.join(" ")},get hasTitle(){return this.tabs.length||this.modalOptions.title}},this.watch={"state.disabled":()=>this.update(),"state.loading":()=>this.update(),"state.pageResponsiveMode":e=>this.toggleResponsiveMode(e)}},setOptions(e){const t=this.state.modalOptions;if(this.state.tabs.length){e||(e=this.state.defaultTabId);const s=this.state.tabs.find((t=>t.id===e))||{},i=(null==s||null==s.getOptions?void 0:s.getOptions(this.modal))||{};this.state.activeTab=e,this.state.tabOptions={...t,...s,...i}}else this.state.activeTab=null,this.state.tabOptions={...t};this.modal.options.width=this.state.tabOptions.width,this.modal.options.heigth=this.state.tabOptions.heigth},selectTab(e){var t,s;if(e===this.state.activeTab)return;this.state.canRender=!1,this.update(),this.root.classList.add("noanimate"),this.state.activeTab&&"function"==typeof this.state.tabOptions.onUnmounted&&this.state.tabOptions.onUnmounted(this.state.tabOptions),this.state.canRender=!0,this.setOptions(e),"function"==typeof this.state.tabOptions.onMounted&&this.state.tabOptions.onMounted(this.state.tabOptions);const i=this.state.tabOptions.responsiveMode;this.state.allowResponsive&&uiStore.view.responsiveModes.includes(i)&&(this.state.responsiveMode=i,uiStore.view.setViewport(i)),this.update(),null==(t=(s=this.state.modalOptions).onSelectTab)||t.call(s,e,this.modal),this.modal.updateStyles({width:this.state.options.width,height:this.state.options.height}),requestAnimationFrame((()=>{this.root.classList.remove("noanimate")}))},toggleResponsiveMode(e){e!==this.state.responsiveMode&&(this.root.classList.add("noanimate"),this.state.canRender=!1,this.update(),"all"===e?uiStore.view.setViewport(this.state.initialResponsiveMode):uiStore.view.setViewport(e),this.state.canRender=!0,this.state.responsiveMode=e,this.modal.updateStyles({width:this.state.options.width,height:this.state.options.height}),this.update(),requestAnimationFrame((()=>{this.root.classList.remove("noanimate")})))},onBeforeMount(){this.setOptions(this.state.defaultTabId),this.state.canRender=!0},onMounted(){"function"==typeof this.state.tabOptions.onMounted&&this.state.tabOptions.onMounted(this.state.tabOptions)},onUnmounted(){"function"==typeof this.state.tabOptions.onUnmounted&&this.state.tabOptions.onUnmounted(this.state.tabOptions)}},template:(e,t,s,i)=>e('<div expr49="expr49" is="flexbe-modal-title"></div><a expr50="expr50"></a><div expr51="expr51" is="flexbe-modal-data"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-modal ",e.state.className].join("")},{type:t.ATTRIBUTE,name:"data-name",evaluate:e=>e.state.modalOptions.name},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.disabled}]},{type:s.IF,evaluate:e=>e.state.hasTitle,redundantAttribute:"expr49",selector:"[expr49]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-modal-title",slots:[],attributes:[{type:t.ATTRIBUTE,name:"tabs",evaluate:e=>e.state.tabs},{type:t.ATTRIBUTE,name:"options",evaluate:e=>e.state.modalOptions},{type:t.ATTRIBUTE,name:"tabOptions",evaluate:e=>e.state.tabOptions},{type:t.ATTRIBUTE,name:"responsiveMode",evaluate:e=>e.state.responsiveMode},{type:t.ATTRIBUTE,name:"allowResponsive",evaluate:e=>e.state.allowResponsive},{type:t.EVENT,name:"onTabSelect",evaluate:e=>e.selectTab},{type:t.EVENT,name:"onToggleResponsiveMode",evaluate:e=>e.toggleResponsiveMode}]}])},{type:s.IF,evaluate:e=>!e.state.hasTitle&&e.state.modalOptions.closeButton,redundantAttribute:"expr50",selector:"[expr50]",template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.modalOptions.closeButtonClass}]}])},{type:s.IF,evaluate:e=>e.state.canRender,redundantAttribute:"expr51",selector:"[expr51]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-modal-data",slots:[{id:"default",html:'<div expr52="expr52" is="flexbe-loader" class="flexbe-modal__loader"></div><div expr53="expr53"></div><div expr54="expr54" is="proxy"></div><div expr55="expr55" is="raw"></div>',bindings:[{type:s.IF,evaluate:e=>e.state.loading,redundantAttribute:"expr52",selector:"[expr52]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[]}])},{type:s.IF,evaluate:e=>e.state.riotComponentName,redundantAttribute:"expr53",selector:"[expr53]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>e.state.riotComponentName,slots:[],attributes:[{type:t.ATTRIBUTE,name:null,evaluate:e=>e.state.componentProps}]}])},{type:s.IF,evaluate:e=>e.state.riotOldTagName,redundantAttribute:"expr54",selector:"[expr54]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data-is",evaluate:e=>e.state.riotOldTagName},{type:t.ATTRIBUTE,name:"modal",evaluate:e=>e.modal},{type:t.ATTRIBUTE,name:null,evaluate:e=>e.state.componentProps}]}])},{type:s.IF,evaluate:e=>e.state.tabOptions.$data,redundantAttribute:"expr55",selector:"[expr55]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.state.tabOptions.$data}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"tabOptions",evaluate:e=>e.state.tabOptions},{type:t.ATTRIBUTE,name:"data-name",evaluate:e=>e.state.tabOptions.name}]}])}]),name:"flexbe-modal"};function Dt(e,t,s,i){s&&Object.defineProperty(e,t,{enumerable:s.enumerable,configurable:s.configurable,writable:s.writable,value:s.initializer?s.initializer.call(i):void 0})}function Vt(e,t,s,i,a){var n={};return Object.keys(i).forEach((function(e){n[e]=i[e]})),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=s.slice().reverse().reduce((function(s,i){return i(e,t,s)||s}),n),a&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(a):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(e,t,n),n=null),n}e(Mt.name,Mt);var Ot=0;function zt(e){return"__private_"+Ot+++"_"+e}function qt(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}riot3.tag2("select-template-type",'<div class="flexbe-title text-subtitle mb20" if="{state.title}"> {state.title} </div> <div class="flexbe-card-list"> <div class="flexbe-card-item" each="{data in state.templates}"> <div class="template-item flexbe-white-card shadow rounded hoverable pointer" onclick="{selectItem}"> <virtual if="{data.image}"> <div class="template-item__image" riot-style="background-image: url(\'{data.image}\')"></div> <hr> </virtual> <div class="template-item__text"> <svg class="flexbe-icon" viewbox="0 0 14 14" if="{data.active || state.active === data.value}"> <path d="M1 7L5 11L13 3" fill="none" stroke="#119A22" stroke-width="2"></path> </svg> <span class="flexbe-text"> {data.title} </span> </div> </div> </div> </div>',"",'class="select-template-type flexbe-modal-content {opts.class}"',(function(e){this.state={title:e.title,active:e.active,templates:e.templates??[]},this.selectItem=async function(t){"function"==typeof e.selectItem&&(await e.selectItem(t.item.data),e.modal&&e.modal.close())}.bind(this)})),riot3.tag2("image-preview-modal",'<div data-is="proxy" is="flexbe-loader" if="{!loaded}"></div> <img if="{loaded}" riot-src="{src}">',"",'class="image-preview-modal {opts.class}"',(function(e){this.loaded=!1,this.src=e.src;const t=new Image;t.onload=()=>{this.update({loaded:!0}),e?.modal?.updatePosition()},t.src=this.src})),riot3.tag2("leave-modal",'<svg class="flexbe-icon"> <use riot-xlink:href="{opts.icon}"></use> </svg> <div class="flexbe-title text-m"> {tr(\'editor::modal::leave_editor::title_new\')} </div> <div class="flexbe-buttons-line"> <button data-is="proxy" is="flexbe-button" ref="cancel" class="flexbe-button is-danger bordering coloring" text="{tr(\'editor::modal::leave_editor::button::not_save\')}" tabindex="0" onclick="{onLeave}"></button> <button data-is="proxy" is="flexbe-button" ref="apply" class="is-primary filled {pending: loading, is-success: success}" loading-class="size-small" loading="{success ? \'success\' : (loading ? \'pending\' : false)}" text="{tr(\'main::button::save\')}" tabindex="0" autofocus="{true}" onclick="{onSave}"></button> </div> <div class="flexbe-text text-shade-50 text-s leave-modal-cancel" tabindex="0" onclick="{onCancel}"> {tr(\'editor::modal::leave_editor::button::close\')} </div>',"",'class="leave-modal {opts.class}"',(function(e){this.onSave=async function(){if(!this.loadingLeave&&!this.loading){this.loading=!0;try{await pageStore.save(),this.update({success:!0}),window.location.href=e.href}catch(e){this.update({loading:!1})}}}.bind(this),this.onLeave=function(){this.loadingLeave||this.loading||(this.loadingLeave=!0,"object"==typeof pageStore&&r((()=>{pageStore.utime=pageStore.savedUtime})),window.location.href=e.href,this.loadingLeave=!1)}.bind(this),this.onCancel=function(){this.loadingLeave||this.loading||this.closeModal()}.bind(this),this.closeModal=function(){e.modal.close()}.bind(this)}));const Gt={content:"",contentAsHTML:!0,theme:"dark",animation:"fall",animationDuration:[250,180],delay:[180,100],position:"top",autoClose:!0,hideOnClick:!1,interactive:!1,distance:3,maxWidth:350,updateAnimation:!1,trigger:"custom",triggerOpen:{click:!1,touchstart:!1,mouseenter:!0},triggerClose:{click:!1,originClick:!1,mouseleave:!0,touchleave:!0}};function Xt(e,t={}){var s,i;if(!e)return!1;let a;const n=$(e),r={...Gt,...t,content:null!=(s=null!=(i=t.content)?i:n.attr("data-tip"))?s:e.innerHTML};r.theme=`tooltipster-${(n.attr("data-theme")||r.theme||Gt.theme).replace("tooltipster-","")}`,r.maxWidth=parseInt(n.attr("data-width"),10)||r.maxWidth,r.position=n.attr("data-tip-position")||r.position;try{r.delay=JSON.parse(n.attr("data-tip-delay")||null)||r.delay,r.animationDuration=JSON.parse(n.attr("data-tip-duration")||null)||r.animationDuration}catch(e){}const o=r.content||"";try{a=n.tooltipster("instance")}catch(e){}return a||o?(a?(clearTimeout(a._contentTmt),o&&o!==a.content()?(a.content(o),a.enable()):o||Kt(e)):(e.tooltipstered=!0,n.tooltipster(r),a=n.tooltipster("instance"),a.on("created",(()=>{n.attr("data-tooltipstered","true"),a._$tooltip.addClass("editor-ui"),a._$tooltip.on("pointerdown",(e=>{e.stopPropagation()}))})),a.on("destroy",(()=>{e.tooltipstered=!1,n.removeAttr("data-tooltipstered")})),a.on("ready",(()=>{a.reposition()}))),t.show&&a.open(),a):void 0}function Kt(e){if(!e)return!1;let t;const s=$(e);try{t=s.tooltipster("instance")}catch(e){}t&&(t.destroy(),e.tooltipstered=!1,s.removeAttr("data-tooltipstered"))}function Wt(e,t={}){e||(e="body");const s=$(e);s.find("[data-tooltipstered]:not([data-tip])").each(((e,t)=>{Kt(t)})),s.find(".tip, [data-tip]").each(((e,s)=>{Xt(s,t)}))}function Zt(e){if(!e)return;$(e).find("[data-tooltipstered]").each(((e,t)=>{Kt(t)}))}const Yt={init:Xt,initArea:Wt,destroy:Kt,destroyArea:Zt,hideAll:function(){$document.find(".tooltipster-show").remove()}};var Jt,Qt,es,ts,ss,is,as,ns,rs,os;const ls={excluded:[],debounce:0,throttle:0,allowRepeat:!1,preventDefault:!0,stopPropagation:!0,stopImmediatePropagation:!1,clearHandlers:!1,runFirst:!0},ds=navigator.userAgent.includes("Mac"),cs=ds?"":"Ctrl",ps=ds?"":"Alt",us=ds?"Backspace":"Delete",ms=["input","textarea","[contenteditable]",".fr-element",".flexbe-colorpicker"];function hs(e,{justify:t="center",inline:s=!1}={}){"string"==typeof e&&(e=e.split("_").map((e=>"cmd"===e?cs:"alt"===e?ps:"shift"===e?"Shift":"backslash"===e?"\\":1===e.length?`${e}`.toUpperCase():`${e[0].toUpperCase()}${e.slice(1)}`)));return`<div class="flexbe-hotkeys justify-content-${t}${s?" inline":""}">${e.map((e=>`<span class="hotkey">${e}</span>`)).join("")}</div>`}function gs(){this.register([{options:{preventDefault:!1,stopPropagation:!1,runFirst:!0},hotkeys:["*"],handlerDown:l(((e,{code:t})=>{this.pressed.has(t)||this.pressed.add(t),this.metaKey=e.metaKey,this.shiftKey=e.shiftKey,this.altKey=e.altKey,this.ctrlKey=e.ctrlKey})),handlerUp:l(((e,{code:t})=>{this.pressed.has(t)&&this.pressed.delete(t),this.metaKey=e.metaKey,this.shiftKey=e.shiftKey,this.altKey=e.altKey,this.ctrlKey=e.ctrlKey}))}])}function vs(){$document.on("pointerdown.flexbe-hotkeys",l((e=>{this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.ctrlKey=e.ctrlKey})))}const fs=new(rs=zt("initControlKeys"),os=zt("fixHotkeys"),Qt=Vt((Jt=class{constructor(){Object.defineProperty(this,os,{value:vs}),Object.defineProperty(this,rs,{value:gs}),this.renderHotkeys=hs,this.list={},this.isMac=ds,this.COMMAND_SYMBOL=cs,this.ALT_SYMBOL=ps,this.DEL_SYMBOL=us,this.inited=!1,Dt(this,"isDisabled",Qt,this),Dt(this,"excludeFromDisabled",es,this),Dt(this,"pressed",ts,this),Dt(this,"shiftKey",ss,this),Dt(this,"metaKey",is,this),Dt(this,"altKey",as,this),Dt(this,"ctrlKey",ns,this)}get commandKey(){return this.isMac?this.metaKey:this.ctrlKey}init(){this.inited||(qt(this,rs)[rs](),qt(this,os)[os](),this.inited=!0);const e=e=>{"Alt"===e.key&&e.preventDefault();const t=String(e.key),s=String(e.code).replace(/^Key/,"").toLowerCase(),i=e.metaKey&&!/^meta/.test(s),a=e.ctrlKey&&!/^control/.test(s),n=e.shiftKey&&!/^shift/.test(s),r=e.altKey&&!/^alt/.test(s),o=[i?"meta":null,a?"control":null,n?"shift":null,r?"alt":null].filter((e=>e)),l=o.length?`${o.join("_")}_${s}`:`${s}`,d=this.excludeFromDisabled.includes(l),c=[this.list[l]||[],this.list["*"]||[]].flat(),p=[e,{key:t,code:s,mod:o,name:l,metaKey:i,ctrlKey:a,shiftKey:n,altKey:r}];0!==c.length&&(this.isDisabled&&!d||c.some((({shouldPrevent:t,handlerDown:s,handlerUp:i,handlerPress:a,options:n})=>{var r;const o=null!=(r=n.excluded)?r:[],l=o.length>0&&o.some((t=>$(e.target).closest(t).length)),d="function"==typeof t&&t(e);return!l&&!d&&(!n.allowRepeat&&e.repeat||("keydown"===e.type&&"function"==typeof s&&s(...p),"keypress"===e.type&&"function"==typeof a&&a(...p),"keyup"===e.type&&"function"==typeof i&&i(...p)),n.preventDefault&&e.preventDefault(),n.stopPropagation&&e.stopPropagation(),!!n.stopImmediatePropagation&&(e.stopImmediatePropagation(),!0))})))};$document.each(((t,s)=>{s.addEventListener("keydown",e),s.addEventListener("keypress",e),s.addEventListener("keyup",e)}))}register(e){return Array.isArray(e)||(e=[e]),(e=e.map((e=>{const t=e.id||Ge(10),s=xs(e.hotkeys,this.isMac),i={...ls,...e.options};return i.debounce?this.hangDelay("debounce",e,i.debounce):i.throttle&&this.hangDelay("throttle",e,i.throttle),{...e,id:t,hotkeys:s,options:i}})).filter((e=>e.handlerUp||e.handlerDown||e.handlerPress))).forEach((e=>{const{hotkeys:t,options:s}=e;t.forEach((t=>{(null==this.list[t]||s.clearHandlers)&&(this.list[t]=[]),s.runFirst?this.list[t].unshift(e):this.list[t].push(e)}))})),this.unregister.bind(this,e)}unregister(e=[]){let t=!1;return Array.isArray(e)||(e=[e]),Object.entries(this.list).forEach((([,s])=>{e.forEach((e=>{const i=s.findIndex((t=>{if(e.id)return t.id===e.id;if(e.handlerDown||e.handlerUp||e.handlerPress)return t.handlerDown===e.handlerDown||t.handlerUp===e.handlerUp||t.handlerPress===e.handlerPress;if(e.hotkeys){const s=xs(e.hotkeys,this.isMac);return Te(!0,t.hotkeys,s)}return!1}));i>=0&&(t=!0,s.splice(i,1))}))})),t}loose(){this.pressed.clear(),["ctrlKey","altKey","metaKey","shiftKey"].forEach((e=>{this[e]=!1}))}disable(e={}){var t;const s=xs(null!=(t=e.exclude)?t:[],this.isMac);this.isDisabled=!0,this.excludeFromDisabled.push(...s),this.loose()}enable(){this.isDisabled=!1,this.excludeFromDisabled=[]}hangDelay(e,t,s){["handlerDown","handlerUp","handlerPress"].forEach((i=>{t[i]&&("debounce"===e?t[i]=$.debounce(t[i],s,!0):"throttle"===e&&(t[i]=$.throttle(t[i],s)))}))}}).prototype,"isDisabled",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),es=Vt(Jt.prototype,"excludeFromDisabled",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ts=Vt(Jt.prototype,"pressed",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Set}}),ss=Vt(Jt.prototype,"shiftKey",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),is=Vt(Jt.prototype,"metaKey",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),as=Vt(Jt.prototype,"altKey",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ns=Vt(Jt.prototype,"ctrlKey",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Vt(Jt.prototype,"commandKey",[o],Object.getOwnPropertyDescriptor(Jt.prototype,"commandKey"),Jt.prototype),Vt(Jt.prototype,"loose",[l],Object.getOwnPropertyDescriptor(Jt.prototype,"loose"),Jt.prototype),Vt(Jt.prototype,"disable",[l],Object.getOwnPropertyDescriptor(Jt.prototype,"disable"),Jt.prototype),Vt(Jt.prototype,"enable",[l],Object.getOwnPropertyDescriptor(Jt.prototype,"enable"),Jt.prototype),Jt);function xs(e,t){return Array.isArray(e)||(e=[e]),me(e.map((e=>e.toLowerCase().replace(/ctrl/,"control").replace(/(cmd|command)/,t?"meta":"control"))))}const bs=e=>e.filter((e=>!1!==e.show)),ys={css:null,exports:{setup(){const e=fs.ALT_SYMBOL,t=fs.COMMAND_SYMBOL,s=fs.DEL_SYMBOL;this.hotkeys=[{type:"common",title:tr("editor::hotkeys::common::title"),items:[{title:tr("editor::hotkeys::common::editor::title"),list:bs([{title:tr("editor::hotkeys::common::editor::preservation"),hotkey:[t,"S"]},{title:tr("editor::hotkeys::common::editor::hide_editor"),hotkey:[t,"\\"]},{title:tr("editor::hotkeys::common::editor::preview"),hotkey:[t,"shift","\\"]},{title:tr("editor::hotkeys::common::editor::show_layers"),hotkey:[t,"L"]},{title:tr("editor::hotkeys::common::editor::show_hidden_items"),hotkey:[t,"H"]},{title:tr("editor::hotkeys::common::editor::show_grid"),hotkey:[e,"G"]},{title:tr("editor::hotkeys::common::editor::show_guides"),hotkey:[e,"R"]},{title:tr("editor::hotkeys::common::editor::window_for_adding_elements"),hotkey:[t,"enter"]},{title:tr("editor::hotkeys::common::editor::cancel_action"),hotkey:[t,"Z"]},{title:tr("editor::hotkeys::common::editor::repeat_action"),hotkey:[t,"shift","Z"]},{title:tr("editor::hotkeys::common::editor::zoom_increase"),hotkey:[t,"+"]},{title:tr("editor::hotkeys::common::editor::zoom_decrease"),hotkey:[t,"-"]},{title:tr("editor::hotkeys::common::editor::zoom_reset"),hotkey:[t,"0"]}])},{title:tr("editor::hotkeys::common::element::title"),list:bs([{title:tr("editor::hotkeys::common::element::paste"),hotkey:[t,"V"]},{title:tr("editor::hotkeys::common::element::copy"),hotkey:[t,"C"]},{title:tr("editor::hotkeys::common::element::copy_section"),hotkey:[t,e,"C"]},{title:tr("editor::hotkeys::common::element::paste_style"),hotkey:[t,"shift","V"]},{title:tr("editor::hotkeys::common::element::copy_style"),hotkey:[t,"shift","C"]},{title:tr("editor::hotkeys::common::element::duplicate_element"),hotkey:[t,"D"]},{title:tr("editor::hotkeys::common::element::cut_out"),hotkey:[t,"X"]},{title:tr("editor::hotkeys::common::element::remove"),hotkey:[s]}])}]},{type:"free",title:tr("editor::hotkeys::free::title"),items:[{title:tr("editor::hotkeys::free::element::title"),list:bs([{title:tr("editor::hotkeys::free::element::resize_10px"),hotkey:[t,"shift",tr("editor::hotkeys::arrows")]},{title:tr("editor::hotkeys::free::element::layer_above_below"),hotkey:[t,"bracketleft","bracketright"]},{title:tr("editor::hotkeys::free::element::layer_top_bottom"),hotkey:["bracketleft","bracketright"]},{title:tr("editor::hotkeys::free::element::move"),hotkey:[tr("editor::hotkeys::arrows")]},{title:tr("editor::hotkeys::free::element::move_10px"),hotkey:["shift",tr("editor::hotkeys::arrows")]},{title:tr("editor::hotkeys::free::element::select_all_elements"),hotkey:[t,"A"]},{title:tr("editor::hotkeys::free::element::show_distance"),hotkey:[e]},{title:tr("editor::hotkeys::free::element::blocking"),hotkey:["L"]},{title:tr("editor::hotkeys::free::element::edit_element"),hotkey:["enter"]},{title:tr("editor::hotkeys::free::element::edit_animation"),hotkey:["A"]},{title:tr("editor::hotkeys::free::element::resize"),hotkey:[t,tr("editor::hotkeys::arrows")]}])},{title:tr("editor::hotkeys::free::alignment::title"),list:bs([{title:tr("editor::hotkeys::free::alignment::left"),hotkey:[e,"A"]},{title:tr("editor::hotkeys::free::alignment::center_horizontal"),hotkey:[e,"H"]},{title:tr("editor::hotkeys::free::alignment::right"),hotkey:[e,"D"]},{title:tr("editor::hotkeys::free::alignment::top"),hotkey:[e,"W"]},{title:tr("editor::hotkeys::free::alignment::center_vertical"),hotkey:[e,"V"]},{title:tr("editor::hotkeys::free::alignment::bottom"),hotkey:[e,"S"]}])},{title:tr("editor::hotkeys::free::turn::title"),list:bs([{title:tr("editor::hotkeys::free::turn::rotate"),hotkey:["shift"]},{title:tr("editor::hotkeys::free::dragndrop::inverts_snap_grid"),hotkey:[t]}])},{title:tr("editor::hotkeys::free::dragndrop::title"),list:bs([{title:tr("editor::hotkeys::free::dragndrop::inverts_snap_grid"),hotkey:[t]},{title:tr("editor::hotkeys::free::dragndrop::translation_along_one_axis"),hotkey:["shift"]}])},{title:tr("editor::hotkeys::free::resize::title"),list:bs([{title:tr("editor::hotkeys::free::resize::keep_proportions"),hotkey:["shift"]},{title:tr("editor::hotkeys::free::dragndrop::inverts_snap_grid"),hotkey:[t]},{title:tr("editor::hotkeys::free::resize::resize_center"),hotkey:[e]}])}]}],this.meta={sprite:at("hotkeys"),icons:["","arrow-bottom","arrow-left","arrow-right","arrow-top","bracketleft","bracketright","","Backspace","enter","shift"]}},getTipsContent(e){switch(e){case"":return"Alt (option)";case"shift":return"Shift";case"":return"Command";case"Backspace":return"Backspace";case"enter":return"Enter";default:return!1}},onMounted(){Wt(this.root)}},template:(e,t,s,i)=>e('<div expr15="expr15"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"modal-hotkeys"}]},{type:s.EACH,getKey:null,condition:null,template:e('<div class="modal-hotkeys-column__title"><svg class="flexbe-icon size-16"><use expr16="expr16"/></svg><div expr17="expr17" class="flexbe-text text-m"> </div></div><div class="modal-hotkeys-list-container"><div expr18="expr18" class="modal-hotkeys-list"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["modal-hotkeys-column type-",e.column.type].join("")}]},{redundantAttribute:"expr16",selector:"[expr16]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#",e.column.type].join("")}]},{redundantAttribute:"expr17",selector:"[expr17]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.column.title}]},{type:s.EACH,getKey:null,condition:null,template:e('<div expr19="expr19" class="modal-hotkeys-list__title flexbe-text text-s text-gray"> </div><div class="modal-hotkeys-list__wrap"><div expr20="expr20" class="modal-hotkeys-item"></div></div>',[{redundantAttribute:"expr19",selector:"[expr19]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.list.title}]},{type:s.EACH,getKey:null,condition:null,template:e('<div class="modal-hotkeys-item__wrapper"><div expr21="expr21" class="modal-hotkeys-item__title flexbe-text"> </div><div class="modal-hotkeys-item__icons"><div expr22="expr22" class="modal-hotkeys-item__keys square-hotkey"></div></div></div>',[{redundantAttribute:"expr21",selector:"[expr21]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.title}]},{type:s.EACH,getKey:null,condition:null,template:e('<svg expr23="expr23" class="flexbe-icon size-16"></svg><div expr25="expr25"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.getTipsContent(e.key)}]},{type:s.IF,evaluate:e=>e.meta.icons.includes(e.key),redundantAttribute:"expr23",selector:"[expr23]",template:e('<use expr24="expr24"/>',[{redundantAttribute:"expr24",selector:"[expr24]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#",e.key].join("")}]}])},{type:s.IF,evaluate:e=>!e.meta.icons.includes(e.key),redundantAttribute:"expr25",selector:"[expr25]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.key].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-text text-xs ",e.key.length<=1?"text-container-small":"text-container-large"].join("")}]}])}]),redundantAttribute:"expr22",selector:"[expr22]",itemName:"key",indexName:null,evaluate:e=>e.item.hotkey}]),redundantAttribute:"expr20",selector:"[expr20]",itemName:"item",indexName:null,evaluate:e=>e.list.list}]),redundantAttribute:"expr18",selector:"[expr18]",itemName:"list",indexName:null,evaluate:e=>e.column.items}]),redundantAttribute:"expr15",selector:"[expr15]",itemName:"column",indexName:null,evaluate:e=>e.hotkeys}]),name:"modal-hotkeys"};e(ys.name,ys);const _s={css:null,exports:{setup(e,{initMobx:t,inject:s}){const i=e.props;if(t(),this.fieldSprite=at("fields"),this.sprite=i.sprite||this.fieldSprite,this.modal=s("modal"),this.list=i.list||i.templates||[],i.allowed&&i.allowed.length&&(this.list=this.list.filter((e=>i.allowed.includes(e.type)))),i.denied&&i.denied.length&&(this.list=this.list.filter((e=>!i.denied.includes(e.type)))),i.filter){const e=this.modal.options.height-59;setTimeout((()=>$(this.root).css("min-height",e)),0)}this.state={search:"",inSearch:!1,get activateFirstItem(){return this.search&&this.inSearch},get filteredList(){let t=e.list.filter((e=>{var t;return(null==(t=e.tags)?void 0:t.length)&&e.tags.some((e=>e.includes(this.search)))}));return t.length||(t=e.list.filter((e=>{const t=e.title.trim().toLowerCase(),s=e.type.trim().toLowerCase();return t.startsWith(this.search)||s.startsWith(this.search)}))),t}},this.watch={state:[()=>this.update(),{deep:!0}]}},handleSelect(e){var t;this.modal&&!it(null==(t=this.modal.options.props)?void 0:t.preventClose)&&this.modal.close(),"function"==typeof this.props.onselect&&this.props.onselect(e)},setSearch(e){this.state.search=e.target.value.trim().toLowerCase()},inSearch(e=!0){this.state.inSearch=e},onKeyDown(e,t){!t&&this.state.search&&(t=this.state.filteredList[0]),13===e.keyCode&&t&&this.handleSelect(t)}},template:(e,t,s,i)=>e('<div expr26="expr26" class="select-type-filter-wrapper"></div><div class="flexbe-types-list"><div expr28="expr28" tabindex="0"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["select-type ",e.props.filter?"with-filter":""," ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.props.filter,redundantAttribute:"expr26",selector:"[expr26]",template:e('<label expr27="expr27" is="flexbe-input" class="select-type-filter"></label>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"prefix-icon-size",evaluate:e=>14},{type:t.ATTRIBUTE,name:"prefix-icon",evaluate:e=>[e.fieldSprite,"#search"].join("")},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("main::button::search")},{type:t.EVENT,name:"onselect",evaluate:e=>e=>e.stopPropagation()},{type:t.EVENT,name:"oninput",evaluate:e=>e.setSearch},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.search},{type:t.EVENT,name:"onfocus",evaluate:e=>()=>e.inSearch(!0)},{type:t.EVENT,name:"onblur",evaluate:e=>()=>e.inSearch(!1)},{type:t.EVENT,name:"onkeydown",evaluate:e=>e.onKeyDown}],redundantAttribute:"expr27",selector:"[expr27]"}])},{type:s.EACH,getKey:e=>e.item.type,condition:null,template:e('<svg class="flexbe-icon"><use expr29="expr29"/></svg><span expr30="expr30" class="flexbe-text mx0"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["type-item ",e.classNames({disabled:e.item.disabled,active:0===e.index&&e.state.activateFirstItem})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.handleSelect(e.item)},{type:t.EVENT,name:"onkeydown",evaluate:e=>t=>e.onKeyDown(t,e.item)}]},{redundantAttribute:"expr29",selector:"[expr29]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.sprite,"#",e.item.icon||e.item.type].join("")}]},{redundantAttribute:"expr30",selector:"[expr30]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.title}]}]),redundantAttribute:"expr28",selector:"[expr28]",itemName:"item",indexName:"index",evaluate:e=>e.state.filteredList}]),name:"select-type"};e(_s.name,_s);const Ts={css:null,exports:{modal:null,setup(e,{initMobx:t,inject:s}){t(),this.modal=s("modal"),this.state={loading:!1,toggleChecked:e.props.toggleChecked||!1,get toggleText(){return e.props.toggleText},get showConfirmButton(){var t;return null==(t=e.props.confirmButton)||t},get showCancelButton(){return e.props.cancelButton},get confirmButtonText(){return e.props.confirmButtonText||tr("main::button::confirm")},get cancelButtonText(){return e.props.cancelButtonText||tr("main::button::cancel")},get confirmButtonClass(){return["apply","flexbe-button",e.props.confirmButtonClass||"is-primary filled",this.loading?"loading":null].filter((e=>e)).join(" ")},get cancelButtonClass(){return["cancel","flexbe-button",e.props.cancelButtonClass||"is-default filled"].filter((e=>e)).join(" ")},get icon(){return e.props.icon},get title(){return e.props.title},get text(){return e.props.text}},this.watch={"state.loading":[()=>this.update()]}},onMounted(){const e=this.$(".apply")||this.$(".cancel");e&&setTimeout((()=>e.focus()),100)},toggleCheckbox(e){this.state.toggleChecked=e.target.checked},closeModal(){null!=this.modal&&this.modal.close()},setLoading(e){this.state.loading=e},async confirmHandler(){this.setLoading(!0);try{const e=await this.onConfirm({toggle:this.state.toggleChecked});return this.setLoading(!1),await this.onDone(e),this.closeModal(),e}catch(e){return await this.onError(e),this.setLoading(!1),e}},async cancelHandler(){await this.onCancel(),this.closeModal()},async onConfirm(e){var t,s;return null==(t=(s=this.props).onConfirm)?void 0:t.call(s,e)},async onCancel(){var e,t;return null==(e=(t=this.props).onCancel)?void 0:e.call(t)},async onDone(e){var t,s;return null==(t=(s=this.props).onDone)?void 0:t.call(s,e)},async onError(e){var t,s;return null==(t=(s=this.props).onError)?void 0:t.call(s,e)}},template:(e,t,s,i)=>e('<svg expr31="expr31" class="flexbe-icon"></svg><span expr33="expr33" is="raw" class="flexbe-title"></span><span expr34="expr34" is="raw" class="flexbe-desc"></span><label expr35="expr35" is="flexbe-checkbox" type="toggle" class="mt10"></label><div expr37="expr37" class="flexbe-buttons-line"><button expr38="expr38" tabindex="0"></button><button expr40="expr40" tabindex="0"></button></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["confirm-modal ",e.props.class].join("")},{type:t.ATTRIBUTE,name:"title",evaluate:e=>null}]},{type:s.IF,evaluate:e=>e.state.icon,redundantAttribute:"expr31",selector:"[expr31]",template:e('<use expr32="expr32"/>',[{redundantAttribute:"expr32",selector:"[expr32]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.icon}]}])},{type:s.IF,evaluate:e=>e.state.title,redundantAttribute:"expr33",selector:"[expr33]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.state.title}]}])},{type:s.IF,evaluate:e=>e.state.text,redundantAttribute:"expr34",selector:"[expr34]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.state.text}]}])},{type:s.IF,evaluate:e=>e.state.toggleText,redundantAttribute:"expr35",selector:"[expr35]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr36="expr36" is="raw"></span>',bindings:[{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.state.toggleText}],redundantAttribute:"expr36",selector:"[expr36]"}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.toggleChecked},{type:t.EVENT,name:"onchange",evaluate:e=>e.toggleCheckbox}]}])},{redundantAttribute:"expr37",selector:"[expr37]",expressions:[{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.loading}]},{type:s.IF,evaluate:e=>e.state.showConfirmButton,redundantAttribute:"expr38",selector:"[expr38]",template:e('<span expr39="expr39" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.confirmButtonClass},{type:t.EVENT,name:"onclick",evaluate:e=>e.confirmHandler}]},{redundantAttribute:"expr39",selector:"[expr39]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.confirmButtonText}]}])},{type:s.IF,evaluate:e=>e.state.showCancelButton,redundantAttribute:"expr40",selector:"[expr40]",template:e('<span expr41="expr41" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.cancelButtonClass},{type:t.EVENT,name:"onclick",evaluate:e=>e.cancelHandler}]},{redundantAttribute:"expr41",selector:"[expr41]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.cancelButtonText}]}])}]),name:"confirm-modal"};e(Ts.name,Ts);const ws={css:null,exports:{modal:null,setup(e,{initMobx:t,inject:s}){t(),this.modal=s("modal"),this.state={loading:!1,value:e.props.value||"",error:e.props.error||"",placeholder:e.props.placeholder||"",titleText:e.props.titleText,confirmButtonText:e.props.confirmButtonText||tr("main::button::confirm"),cancelButtonText:e.props.cancelButtonText||tr("main::button::cancel"),get confirmButtonClass(){return["apply","flexbe-button",e.props.confirmButtonClass||"is-primary filled",this.loading?"loading":null].filter((e=>e)).join(" ")},get cancelButtonClass(){return["cancel","flexbe-button",e.props.cancelButtonClass||"is-default filled"].filter((e=>e)).join(" ")}},this.watch={"state.loading":()=>this.update(),"state.error":()=>this.update()}},closeModal(){null!=this.modal&&this.modal.close()},setLoading(e){this.state.loading=e},setValue(e){this.state.value!==e.target.value&&(this.state.error="",this.state.value=e.target.value)},keydownHandler(e){"Enter"===e.key&&setTimeout((()=>this.confirmHandler()),0)},async confirmHandler(){if(!this.state.loading){this.setLoading(!0);try{await this.onConfirm({value:this.state.value}),this.setLoading(!1),this.closeModal()}catch(e){await this.onError(e),this.setLoading(!1)}}},async cancelHandler(){await this.onCancel(),this.closeModal()},async onConfirm(e){var t,s;return null==(t=(s=this.props).onConfirm)?void 0:t.call(s,e)},async onCancel(){var e,t;return null==(e=(t=this.props).onCancel)?void 0:e.call(t)},async onDone(e){var t,s;return null==(t=(s=this.props).onDone)?void 0:t.call(s,e)},async onError(e){var t,s;this.state.error=e.message,this.update(),await(null==(t=(s=this.props).onError)?void 0:t.call(s,e))}},template:(e,t,s,i)=>e('<div class="flexbe-field-group"><div expr42="expr42" class="flexbe-title"></div><div expr43="expr43" is="flexbe-input"></div></div><div expr44="expr44" class="flexbe-buttons-line"><button expr45="expr45" tabindex="0"><span expr46="expr46" class="flexbe-text"> </span></button><button expr47="expr47" tabindex="0"><span expr48="expr48" class="flexbe-text"> </span></button></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["prompt-modal flexbe-modal-content ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.state.titleText,redundantAttribute:"expr42",selector:"[expr42]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.titleText].join("")}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>100},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.state.error},{type:t.ATTRIBUTE,name:"errorTip",evaluate:e=>e.state.error},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.state.placeholder},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.value},{type:t.EVENT,name:"oninput",evaluate:e=>e.setValue},{type:t.EVENT,name:"onchange",evaluate:e=>e.setValue},{type:t.EVENT,name:"onkeydown",evaluate:e=>e.keydownHandler}],redundantAttribute:"expr43",selector:"[expr43]"},{redundantAttribute:"expr44",selector:"[expr44]",expressions:[{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.loading}]},{redundantAttribute:"expr45",selector:"[expr45]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.confirmButtonClass},{type:t.EVENT,name:"onclick",evaluate:e=>e.confirmHandler}]},{redundantAttribute:"expr46",selector:"[expr46]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.confirmButtonText}]},{redundantAttribute:"expr47",selector:"[expr47]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.cancelButtonClass},{type:t.EVENT,name:"onclick",evaluate:e=>e.cancelHandler}]},{redundantAttribute:"expr48",selector:"[expr48]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.cancelButtonText}]}]),name:"prompt-modal"};e(ws.name,ws);const ks=e=>{var t;return Zs.create({name:null!=(t=e.name)?t:"image-preview-modal",overlay:!0,shadow:!0,duplicate:!1,clickOut:!0,riotTag:"image-preview-modal",props:e,...e.width&&{width:e.width}})},As=(e={})=>Zs.create({width:420,shadow:!0,overlay:!0,duplicate:!1,...e,component:Ts});let Es=!1;class Is{static get opened(){return Array.from(this.list)}static get visible(){return this.opened.filter((e=>!e.hidden&&"sidebar"!==e.type))}static create(e={}){var t;Es||(Es=!0,window.addEventListener("popstate",(e=>{var t;if("backward"===e.direction&&null!=(t=e.oldState)&&t.modalId){const t=Array.from(this.list).find((t=>e.oldState.modalId===t.id));t&&t.close(!1)}})));const s=e.type||"window",i="overlay"===s,a="window"===s||i&&e.compact,n="sidebar"===s,r={type:s,handle:i?null:".flexbe-modal-title",closeButtonClass:"flexbe-modal-close",animate:a,duplicate:a,loading:!1,fromModal:null,position:["center","center"],positionFrom:"target",target:null==(t=e.fromModal)?void 0:t.$modal[0],item:null,riotTag:null,component:null,props:null,class:null,uiClass:i?"admin-ui":"editor-ui",tabs:[],name:null,title:null,closeButton:!i||!!e.title,width:null,height:null,padding:null,scrollable:!0,stopEditor:!1,stopEditorOptions:{globalStates:!0,stopInstances:!1},overlay:!1,shadow:!!e.overlay,clickOutExclude:[".tooltipster-base",".context-menu",...e.clickOutExclude||[]],closeOnEscape:!n,clickOut:a,protectClose:n,onInit(){},onOpen(){},onOpened(){},onCancel(){},onClose(){},onShow(){},onHide(){},onToggleRelative(){},...e,limit:{overflow:!0,top:15,left:15,right:15,bottom:15,...e.limit||{}}},o="uiStore"in window?[...uiStore.view.responsiveModes]:[],l="uiStore"in window?uiStore.view.responsiveMode:null;r.tabs=r.tabs.filter((e=>e&&!e.hide)),r.tabs.forEach(((e,t)=>{e.id||(e.id=`tab-${t}`),e.adaptive&&Object.entries(e.adaptive).forEach((([t,s])=>{["all",l,...o].includes(t)&&s||delete e.adaptive[t]}))})),null==r.name&&(r.name=Ht(r.component)||r.riotTag);const d=Array.from(this.list),c=r.id&&d.find((e=>e.id===r.id)),p=r.name&&d.find((e=>e.name===r.name)),u=!c&&(!p||r.duplicate),m=u?new Zs(r):c||p;return u||m.show(),m}}Is.list=new Set;const Cs=At(Is);var Ss,$s,Bs,Us,Rs,Ps,Hs,js,Fs,Ls,Ns,Ms,Ds;function Vs(){const e="disabled",t=this.$modal.find(".flexbe-modal-data")[0]||this.$modal[0];jt(this.$modal.find("[disabled]"));const s=new MutationObserver((e=>{e.forEach((e=>{const t=$(e.target);"attributes"===e.type&&(t.is("[disabled]:not([data-tab-disabled])")?jt(t):Ft(t))}))})),i=new MutationObserver((()=>{jt(this.$modal.find("[disabled]:not([data-tab-disabled])"))}));s.observe(t,{subtree:!0,attributes:!0,attributeFilter:[e]}),i.observe(t,{childList:!0,subtree:!0})}function Os(){const{options:e,$overlay:t,$modal:s}=this;t.on("keydown",(t=>!e.closeOnEscape||"Escape"!==t.key||(this.cancel(),t.preventDefault(),t.stopImmediatePropagation(),!1))),t.off(`pointerdown.${this.id}`).on(`pointerdown.${this.id}`,".flexbe-modal-close, header .close, footer .close",(e=>{const{pageX:t,pageY:s}=e;this.initialCoords={pageX:t,pageY:s}}));const i=()=>{const e=Rs.visible;if(e.length>1){const t=e.findIndex((e=>e.id===this.id));e.slice(t+1).forEach((e=>e.close()))}this.cancel()};if(t.off(`pointerup.${this.id}`).on(`pointerup.${this.id}`,".flexbe-modal-close, header .close, footer .close",(e=>{if(null!=this.initialCoords){const{pageX:t,pageY:s}=e;+Ve([t,s],[this.initialCoords.pageX,this.initialCoords.pageY]).toFixed(0)<=35&&i(),this.initialCoords=null}else i()})),"window"===e.type||"overlay"===e.type&&e.compact){let t,i;this.$overlay.on(`contextmenu.${this.id}`,(e=>{e.target===e.delegateTarget&&e.preventDefault()})),$document.on(`pointerdown.${this.id}`,(s=>{var a;i=s.target,t=0!==s.button||$(i).closest(this.$modal).length>0||(null==(a=e.clickOutExclude)?void 0:a.length)&&$(i).closest(e.clickOutExclude.join(", ")).length>0})),$document.on(`pointerup.${this.id}`,(a=>{if(t||!i)return t=!1,void(i=null);i=null;const n=a.target,r=$(n),o=r.closest(".flexbe-modal-close, header .close, footer .close").length>0,l=!!$("body .dropdown__balloon").length;if(o||l)return;const d=Rs.visible;d[d.length-1]!==this||this.hidden||this._dragging||r.closest(this.$modal).length||(e.clickOut?r.closest("[prevent-modal-close]").length||(!r.closest(".widget-content").length||r.closest(".flexbe-control-bar").length||r.hasClass("close"))&&setTimeout((()=>{this.cancel()}),100):e.overlay&&e.animate&&window.anime({targets:s[0],duration:180,easing:"easeInOutQuad",keyframes:[{scale:1.02,duration:72},{scale:1,delay:36,duration:72}]}))}))}}function zs(){const e=this.options;if(!e.handle)return;const t=this.$overlay,s=this.$modal;t.on(`pointerdown.drag${this.id}`,`${e.handle}`,(i=>{if($(i.target).is("input, textarea"))return;this.focus(),i.preventDefault(),i.stopPropagation();const{clientX:a,clientY:n}=i,r=[];let o=this;for(;o;)r.push({modal:o,top:o._styles.top,left:o._styles.left}),o=o.options.fromModal;r.forEach((({modal:e})=>{e._dragging=!0})),e.overlay||t.addClass("on"),s.addClass("in-move"),$(i.currentTarget).attr("handle","true");let l=0,d=0;$(document).off(`.drag${this.id}`),$(document).on(`pointermove.drag${this.id}`,(t=>{t.preventDefault(),t.stopPropagation();const s="y"!==e.moveAxis?Math.round(t.clientX-a):l,i="x"!==e.moveAxis?Math.round(t.clientY-n):d;i===d&&s===l||(r.forEach((({modal:t,top:s,left:i})=>{const a={position:"absolute",top:s+d,left:i+l};t.updateStyles(a,e.limit.overflow)})),l=s,d=i)})),$(document).one(`pointerup.drag${this.id}`,(i=>{i.preventDefault(),i.stopPropagation(),$(document).off(`.drag${this.id}`),e.overlay||t.removeClass("on"),s.removeClass("in-move"),$(i.currentTarget).removeAttr("handle"),r.forEach((({modal:e})=>{e._dragging=!1}))}))}))}function qs(){const{limits:e}=this._bounds,{top:t,left:s}=this._styles;let i=s,a=t;a<e.minTop?a=e.minTop:a>e.maxTop&&(a=e.maxTop),i<e.minLeft?i=e.minLeft:i>e.maxLeft&&(i=e.maxLeft),this.updateStyles({top:a,left:i})}function Gs(e=this.options.relativeContainer){qt(this,Ms)[Ms](),this.isRelative=!0,this.$overlay.detach(),this.$modal.addClass("is-relative"),$(e).append(this.$modal),this.updateStyles(),qt(this,Ds)[Ds]()}function Xs(){qt(this,Ms)[Ms](),this.isRelative=!1,$("body").append(this.$overlay),this.$modal.removeClass("is-relative"),this.$overlay.append(this.$modal),this.updateStyles(),qt(this,Ds)[Ds]()}function Ks(){this._$scrollableEl=this.$modal.find(".scrollable-content, .flexbe-scrollable-container"),this._$scrollableEl.each(((e,t)=>{t._lastScrollTop=t.scrollTop||0,t._lastScrollLeft=t.scrollLeft||0}))}function Ws(){this._$scrollableEl.each(((e,t)=>{t.scrollTo(t._lastScrollLeft||0,t._lastScrollTop||0)}))}const Zs=(Ps=zt("initMutation"),Hs=zt("bindEvents"),js=zt("initDraggable"),Fs=zt("fixOverflow"),Ls=zt("makeRelative"),Ns=zt("makeAbsolute"),Ms=zt("saveScrollPosition"),Ds=zt("restoreScrollPosition"),Ss=Rs=class e extends Cs{get activeTab(){var e;return null==(e=this.modalComponent)?void 0:e.state.activeTab}get activeTabOptions(){var e;return null==(e=this.modalComponent)?void 0:e.state.tabOptions}constructor(t){super(),Object.defineProperty(this,Ds,{value:Ws}),Object.defineProperty(this,Ms,{value:Ks}),Object.defineProperty(this,Ns,{value:Xs}),Object.defineProperty(this,Ls,{value:Gs}),Object.defineProperty(this,Fs,{value:qs}),Object.defineProperty(this,js,{value:zs}),Object.defineProperty(this,Hs,{value:Os}),Object.defineProperty(this,Ps,{value:Vs}),this.options=void 0,this.name=void 0,this.sprite=void 0,this.id=void 0,this.type="window",this.hidden=!1,this._saved=!0,this._dragging=!1,Dt(this,"disabled",$s,this),Dt(this,"loading",Bs,this),this.$modal=void 0,this.$overlay=void 0,Dt(this,"isRelative",Us,this),this._styles=void 0,this._bounds=void 0,this.closed=void 0,this.initialCoords=void 0,this.modalComponent=void 0,this._$scrollableEl=void 0,this._prevActiveElement=void 0,this._resizeObserver=void 0,this._stopEditorDisposer=void 0,e.list.add(this),this.options=t,this.id=t.id||`flexbe-modal_${Ge(4)}`,this.type=t.type,this.name=t.name||this.id,this.sprite=at("modal","common"),requestAnimationFrame((()=>{t.loading&&this.setLoader(),this.createTemplate(t),this.$overlay.css({zIndex:t.zIndex||""}),this.$modal.css({width:t.width,height:t.height,top:t.padding,left:t.padding,right:t.padding,bottom:t.padding}),qt(this,Hs)[Hs](),qt(this,Ps)[Ps](),qt(this,js)[js](),t.onInit(this),this.open(!0)}))}updateOptions(e){this.options={...this.options,...e}}createTemplate(e){const t=`overlay-area ${e.overlay?" on":""}${e.shadow?" shadow":""}${e.overlayClass||""}`,i=+$(`.${t}`).last().attr("tabindex")+1||0;null!=e.clickOut&&!0!==e.clickOut||(e.clickOut=".overlay-area");const a=$(`<div class="${t}" style="opacity: 0" tabindex="${i}"></div>`),n=$('<div is="flexbe-modal"></div>');a.append(n),this.$overlay=a,this.$modal=n,this.modalComponent=s(n[0],{modal:this},"flexbe-modal")[0]}open(e=!1){const t=this.options,s=()=>{this.triggerEvent("open_editor_modal"),this.$overlay.css({transform:"",opacity:""}),this.$modal.css("opacity",""),this.$modal.css("transform",""),t.onOpened(this)};t.fromModal&&t.fromModal.disable();const i=t.type.includes("overlay");var a;(i&&e&&history.pushState({modalId:this.id},window.document.title,""),$("body").append(this.$overlay),(i||t.overlay)&&$("body").addClass("overflow"),t.animate&&e&&void 0!==window.anime?i?window.anime.timeline({duration:250,complete:s}).add({targets:this.$overlay[0],opacity:[.6,1],duration:150,easing:"easeInQuad"}).add({targets:this.$modal[0],duration:250,easing:"easeOutSine",scale:[.985,1],translateY:[3,0]},0):window.anime.timeline({duration:250,complete:s}).add({targets:this.$overlay[0],opacity:[.6,1],duration:150,easing:"easeInQuad"}).add({targets:this.$modal[0],translateY:[5,0],duration:250,easing:"easeOutSine"},0):(this.$overlay.css({transform:"",opacity:1}),s()),i)||(this.updateBounds(),this.updateStyles(),this.initResizeObserver(),this.updatePosition(),(null!=(a=this.isRelative)?a:t.isRelative)&&this.toggleRelative(!0));t.onOpen(this),this.stopEditor(),this.focus()}close(t=!0){var s,i,a;const n=this.options;this.closed=!0;const r=n.type.includes("overlay");r&&t&&$(window).trigger("popstate"),$(window).off(`resize.${this.id} scroll.${this.id}`),this.startEditor(),"function"==typeof(null==(s=this._resizeObserver)?void 0:s.disconnect)&&this._resizeObserver.disconnect(),null==(i=this.$overlay)||i.find(":focus").trigger("blur"),n.onClose(this),this.triggerEvent("close_editor_modal"),this.modalComponent.unmount(!1),$document.off(`.${this.id}`),null==(a=this.$overlay)||a.remove(),e.list.delete(this),n.fromModal?n.fromModal.enable():(this._prevActiveElement&&this._prevActiveElement.focus(),(r||n.overlay)&&$("body").removeClass("overflow"))}updateBounds(){const{$modal:e,$overlay:t,options:s}=this,i=t[0],a=e[0],n=a.offsetWidth,r=a.offsetHeight,o=i.offsetWidth,l=i.offsetHeight;this._bounds={windowWidth:n,windowHeight:r,overlayWidth:o,overlayHeight:l,limits:{minLeft:s.limit.left,maxLeft:o-n-s.limit.right,minTop:s.limit.top,maxTop:l-r-s.limit.bottom,overflowMinLeft:s.limit.left-n,overflowMaxLeft:o-s.limit.right,overflowMinTop:s.limit.top,overflowMaxTop:l-s.limit.bottom}}}updateStyles(e={},t=!1){var s,i;const{$modal:a,$overlay:n,options:r}=this;if(r.type.includes("overlay"))return;const{overlayWidth:o,overlayHeight:l,limits:d}=this._bounds;let c={position:null,top:0,left:0,width:null!=(s=r.width)?s:"",height:null!=(i=r.height)?i:"",maxWidth:null,maxHeight:null};if(c={...c,...this._styles,...e},this.isRelative)a.css({top:"",left:"",width:"",height:"",maxWidth:"",maxHeight:"",position:""});else{const e=t?d.overflowMinLeft:d.minLeft,s=t?d.overflowMaxLeft:d.maxLeft,i=t?d.overflowMinTop:d.minTop,n=t?d.overflowMaxTop:d.maxTop;c.top=c.top>n?n:c.top<i?i:c.top,c.left=c.left>s?s:c.left<e?e:c.left,c.maxWidth=o-r.limit.left-r.limit.right,c.maxHeight=l-r.limit.top-r.limit.bottom,a.css(c)}this._styles=c,n.triggerHandler("updatePosition",c)}updatePosition(){var e;const{$overlay:t,$modal:s,options:i}=this;if(this.isRelative||!i.position||i.type.includes("overlay"))return;let a,n;const r=$(i.target||i.item||(null==(e=i.fromModal)?void 0:e.$modal))[0],o=s[0],l=t[0],d=document.documentElement.clientWidth,c=document.documentElement.clientHeight,p=l&&l.getBoundingClientRect(),u=r&&r.getBoundingClientRect().toJSON(),m=o&&o.getBoundingClientRect().toJSON();if("undefined"!=typeof uiStore){if($(uiStore.view.body).find(r).length){const e=$(uiStore.view.frame).offset();u.top+=e.top,u.left+=e.left}}const h="target"===i.positionFrom&&u||p;if("target"===i.positionFrom&&!h.width&&!h.height)return;const[g,v]=i.position||["center","center"],f=g.includes("around")?7:0,x=v.includes("around")?7:0,{x:b,y:y}={x:f,y:x,...i.positionOffset},_={start:"end",start_around:"end_around",end:"start",end_around:"start_around",center:"center"},T={start:h.left+b,start_around:h.left-m.width-b,end:h.left+h.width-m.width-b,end_around:h.left+h.width+b,center:h.left+h.width/2-m.width/2+b},w={start:h.top+y,start_around:h.top-m.height-y,end:h.top+h.height-m.height-y,end_around:h.top+h.height+y,center:h.top+h.height/2-m.height/2+y};n=T[g],a=w[v],(n<0&&h.left+m.width+b<d||n+m.width>d&&h.left>m.width+b)&&(n=T[_[g]]),(a<0&&h.bottom+m.height+y<c||a+m.height>c&&h.top-m.height-y>0)&&(a=w[_[v]]),n=De(0,n,d-m.width),a=De(i.limit.top,a,c-m.height),this.updateStyles({position:"absolute",top:a,left:n})}updateView(){this.modalComponent&&this.modalComponent.update()}selectTab(e,t){var s;null==(s=this.modalComponent)||s.selectTab(e,t)}initResizeObserver(){const e=()=>{if(this.hidden||this.isRelative)return;const{windowHeight:e,windowWidth:t}=this._bounds;this.updateBounds(),qt(this,Fs)[Fs]();const{windowHeight:s,windowWidth:i}=this._bounds;var a,n;e===s&&t===i||(null==(a=(n=this.options).onResize)||a.call(n,this))};$(window).on(`resize.${this.id}`,e),this._resizeObserver=new ResizeObserver(e),this.$modal[0]&&this._resizeObserver.observe(this.$modal[0])}setLoader(){this.disable(),this.loading=!0}removeLoader(){this.enable(),this.loading=!1}hide({trigger:e=!0,hideParent:t=!0}={}){this.hidden||(this.hidden=!0,qt(this,Ms)[Ms](),t&&this.options.fromModal&&this.options.fromModal.hide(),this.startEditor(),this.$overlay.hide(),this.$modal.hide(),$("body").removeClass("overflow"),e&&(this.$overlay.trigger("hide"),this.options.onHide(this),this.triggerEvent("hide_editor_modal")))}show({trigger:t=!0,showParent:s=!0}={}){e.list.has(this)&&this.hidden&&(this.hidden=!1,s&&this.options.fromModal&&this.options.fromModal.show(),this.stopEditor(),this.$overlay.show(),this.$modal.show(),$("body").append(this.$overlay),qt(this,Ds)[Ds](),this.focus(),t&&(this.$overlay.trigger("show"),this.options.onShow(this),this.triggerEvent("show_editor_modal")))}focus(){if(this.$modal.find(":focus").length)return;const e=this.$overlay[0];document.activeElement!==e&&(this._prevActiveElement=document.activeElement,e.focus())}shake(e=300){this.$overlay&&(this.$overlay.addClass("shake"),setTimeout((()=>{this.$overlay.removeClass("shake")}),e))}disable(){jt(this.$modal),this.disabled=!0}enable(){Ft(this.$modal),this.disabled=!1,this.focus()}saved(){this._saved=!0}unsaved(){this._saved=!1}triggerEvent(t){e.trigger(t,this)}toggleRelative(e=!this.isRelative){this.isRelative!==e&&(e?qt(this,Ls)[Ls]():qt(this,Ns)[Ns](),this.options.onToggleRelative(e,this))}stopEditor(){var e;this.options.stopEditor&&null!=(e=flexbe)&&e.editor.redactor&&(this._stopEditorDisposer=flexbe.editor.redactor.stop({...this.options.stopEditorOptions,scope:this.id}))}startEditor(){var e;this.options.stopEditor&&null!=(e=flexbe)&&e.editor.redactor&&this._stopEditorDisposer&&(this._stopEditorDisposer(),this._stopEditorDisposer=null)}cancel(){const e=()=>{"function"==typeof this.options.onCancel&&this.options.onCancel(this),this.triggerEvent("cancel_editor_modal"),this.close()};if(this._saved)e();else{this.disable();const t=()=>{this.enable(),e()},s=()=>this.enable(),i=()=>this.enable();As({props:{icon:`${this.sprite}#lost-data`,title:tr("main::modal::confirm::unsaved_changes::title"),text:tr("main::modal::confirm::unsaved_changes::text"),confirmButtonText:tr("main::button::confirm"),confirmButtonClass:"is-danger bordered colored",cancelButton:!0,onConfirm:t,onDone:s},onClose:i,fromModal:this,target:this.$modal[0],clickOut:!0,overlay:!1,shadow:!1})}}},$s=Vt(Ss.prototype,"disabled",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Bs=Vt(Ss.prototype,"loading",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Us=Vt(Ss.prototype,"isRelative",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vt(Ss.prototype,"setLoader",[l],Object.getOwnPropertyDescriptor(Ss.prototype,"setLoader"),Ss.prototype),Vt(Ss.prototype,"removeLoader",[l],Object.getOwnPropertyDescriptor(Ss.prototype,"removeLoader"),Ss.prototype),Vt(Ss.prototype,"hide",[l],Object.getOwnPropertyDescriptor(Ss.prototype,"hide"),Ss.prototype),Vt(Ss.prototype,"show",[l],Object.getOwnPropertyDescriptor(Ss.prototype,"show"),Ss.prototype),Vt(Ss.prototype,"disable",[l],Object.getOwnPropertyDescriptor(Ss.prototype,"disable"),Ss.prototype),Vt(Ss.prototype,"enable",[l],Object.getOwnPropertyDescriptor(Ss.prototype,"enable"),Ss.prototype),Vt(Ss.prototype,"saved",[l],Object.getOwnPropertyDescriptor(Ss.prototype,"saved"),Ss.prototype),Vt(Ss.prototype,"unsaved",[l],Object.getOwnPropertyDescriptor(Ss.prototype,"unsaved"),Ss.prototype),Ss);class Ys{constructor(e){this._rawValues=[],this.update(e)}all(){return this._rawValues}first(e){return this.all().find((t=>t.key===e))}collect(e){return this.all().filter((t=>t.key===e))}isEmpty(){return!this._rawValues.length}update(e=[]){Array.isArray(e)&&(this._rawValues=e.map((e=>({key:e.propertyPath,code:e.code,message:e.message}))))}resetAll(){this._rawValues=[]}reset(e){this._rawValues=this._rawValues.filter((t=>t.key!==e))}}class Js extends Error{constructor(...e){super(...e),this.data=null,this.name="NetworkError"}}class Qs extends Error{constructor(...e){super(...e),this.data=null,this.name="FormError"}}let ei={};const ti={hash:0,abortPrev:!0,dataType:"json",asJson:!1,data:{}},si={codes:{0:tr("main::error::network"),401:tr("main::error::not_authorized"),404:tr("main::error::page_not_found")},statuses:{parsererror:tr("main::error::incorrect_answer"),error:tr("main::error::unknown")}};function ii(e,t){return li("POST",e,t)}function ai(e,t){return li("GET",e,t)}function ni(e,t){return li("DELETE",e,t)}function ri(e,t){return li("PUT",e,t)}function oi(e,t){return li("PATCH",e,t)}function li(e,t,s){e=e?String(e).trim().toUpperCase():"POST";const i={...ti,...s,url:t,type:e};i.asJson&&"object"==typeof i.data&&(i.data=JSON.stringify(i.data)),i.data&&"string"==typeof i.data&&(i.contentType="application/json");const a=`${t}:${i.hash||0}`;return i.abortPrev&&function(e){try{if(e){const t=ei[e];"number"==typeof t&&clearTimeout(t),"object"==typeof t&&(t.abort(),delete ei[e])}else Object.values(ei).forEach((e=>{"object"==typeof e&&e.abort()})),ei={}}catch(e){}}(a),new Promise(((e,t)=>{function s({response:e,payload:s={},statusCode:i,statusText:a="error"}){let n,r=s.message||s.error;return"object"==typeof r&&null!=r.message&&(r=r.message),r||(r=si.codes[i]||si.statuses[a]),401===i&&(window.location.href="https://app.flexbe.com/login/"),s.violations&&Array.isArray(s.violations)?(n=new Qs(r),s.violations=s.violations.map((e=>({...e,name:e.propertyPath.replace(/\[(\w*)]/g,".$1").slice(1)}))),s.violations=he(s.violations,(e=>e.name))):n=new Js(r),n.response=e,n.data=s,t(n)}ei[a]=$.ajax(i).done(((t,i,a)=>{var n;const r=a.status,o=i||a.statusText;null==(n=null==t?void 0:t.status)||n?function({payload:t}){e(t)}({payload:t}):s({response:a,payload:t,statusCode:r,statusText:o})})).fail(((e,t)=>{const i=e.status,a=t||e.statusText,n=e.responseJSON;"abort"!==a&&s({response:e,payload:n,statusCode:i,statusText:a})}))}))}const di=Object.freeze(Object.defineProperty({__proto__:null,DELETE:ni,GET:ai,GET_JSON:async function(e){return new Promise(((t,s)=>{$.getJSON(e,(e=>t(e))).fail((e=>s(e)))}))},PATCH:oi,POST:ii,PUT:ri},Symbol.toStringTag,{value:"Module"})),ci={aac:"audio/aac",abw:"application/x-abiword",ai:"application/postscript",arc:"application/octet-stream",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",dll:"application/octet-stream",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",mid:"audio/midi",midi:"audio/midi",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpa:"video/mpeg",mpe:"video/mpeg",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otf:"font/otf",png:"image/png",pdf:"application/pdf",ppt:"application/vnd.ms-powerpoint",rar:"application/x-rar-compressed",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"application/typescript",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/x-wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff,application/font-woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.ms-excel",xlsx_OLD:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3gp_DOES_NOT_CONTAIN_VIDEO":"audio/3gpp","3gp2":"video/3gpp2","3gp2_DOES_NOT_CONTAIN_VIDEO":"audio/3gpp2","7z":"application/x-7z-compressed"};class pi{static init(e){return new pi(e)}constructor(e){var t,s;if(this.type=void 0,this.extensions=void 0,this.multi=void 0,this.acceptType="*",this.sizeLimit=void 0,this.url=void 0,this.input=void 0,this.uploader=void 0,this.options=void 0,this.totalCount=0,this.options=e,this.input=$(e.input||'<input type="file"/>').get(0),this.multi=e.multi||!1,this.type=null!=(t=e.type)?t:"file",this.extensions=e.extensions,this.sizeLimit=null!=(s=e.sizeLimit)?s:"file"===this.type?104857600:15728640,this.url=e.url||`/admin/api/project/${flexbe.vars.group.id}/file/upload/?type=${this.type}`,null!=e.acceptType)this.acceptType=e.acceptType;else if(this.input.accept)this.acceptType=this.input.accept;else if(this.extensions)this.acceptType=this.extensions.map((e=>ci[e]||`*/${e}`)).join(",");else if("file"!==this.type)switch(this.type){case"image":this.acceptType="image/jpeg,image/png,image/gif,image/webp,image/svg+xml";break;case"svg":this.acceptType="image/svg+xml";break;case"audio":this.acceptType="audio/mpeg,audio/mp4,audio/x-mpegurl,audio/vnd.wav,audio/ogg,audio/*";break;case"video":this.acceptType="video/mp4,video/MP4"}null==this.acceptType&&(this.acceptType="*"),this.initUploader()}initUploader(){this.input.setAttribute("accept",this.acceptType),this.uploader=$(this.input).spacedUpload({url:this.url,multiple:this.multi,limit:!1,onSelectAll:this.onStart.bind(this),onAllComplete:this.onAllComplete.bind(this),onSelect:e=>{if(!this.checkFile(e))return!1;const t=this.addItem({file:e,onProgress:s=>this.onProgress(t,s,e),onComplete:async(s,i,a)=>{try{i=JSON.parse(i)}catch(e){i=null}if(s&&i&&(null==i.status||i.status)){if("image"===this.type&&i.img_id&&!i.img_proportion)try{const e=await lt(pt(i,50));i.img_width=e.naturalWidth,i.img_height=e.naturalHeight,i.img_proportion=i.img_height/i.img_width*100}catch(s){return this.onError(t,{code:415,message:"Wrong image response",data:i},e)}this.onComplete(t,i,e)}else{const s={code:a,message:i&&(i.message||i.errorMessage),data:i};this.onError(t,s,e)}}});return this.onSelect(t,e),!1}})}checkFile(e){if(!e)return!1;if(Array.isArray(this.extensions)&&e.name){const t=e.name.match(/\.(\w{2,5})$/)[1].toLowerCase();if(!this.extensions.includes(t))return this.onSelectError("bad_extension",e),this.input.value="",!1}return e.type&&!this.checkAcceptType(e.type)?(this.onSelectError("bad_extension",e),this.input.value="",!1):!(this.sizeLimit<e.size)||(this.onSelectError("bad_size",e),this.input.value="",!1)}checkAcceptType(e=""){const[t,s]=e.split("/");return this.acceptType.split(",").map((e=>e.trim())).some((e=>{const[i,a]=e.split("/");return"*"===e||!(t!==i&&i&&"*"!==i||a!==s&&a&&"*"!==a&&"*"!==s)}))}setParam(e){return this.uploader.spacedUpload("setParam",e)}addItem(e){return this.uploader.spacedUpload("addItem",e)}startUpload(){return this.uploader.spacedUpload("startUpload")}cancelUpload(e){return this.uploader.spacedUpload("cancel",e)}cancelAllUpload(){return this.uploader.spacedUpload("cancelAll")}onSelect(e,t){if("function"==typeof this.options.onSelect)try{this.options.onSelect(e,t)}catch(t){this.cancelUpload(e)}}onSelectError(e,t){"bad_extension"===e?(this.input.value="",toast.error(tr("main::invalid_file_extension",{file_name:t.name}))):"bad_size"===e&&toast.error(tr("main::invalid_file_size",{size:Math.floor(this.sizeLimit/1024/1024)})),"function"==typeof this.options.onSelectError&&this.options.onSelectError(e,t)}onStart(){"function"==typeof this.options.onStart&&this.options.onStart(this.totalCount)}onProgress(e,t,s){"function"==typeof this.options.onProgress&&this.options.onProgress(e,t,s)}onComplete(e,t,s){"function"==typeof this.options.onComplete&&this.options.onComplete(e,t,s)}onAllComplete(){this.totalCount=0,this.input.value=""}onError(e,t,s){var i;t.message=null!=(i=t.message)?i:tr("main::error::upload_file"),console.warn(t.message,t),"function"==typeof this.options.onError&&this.options.onError(e,t,s)}}const ui={css:null,exports:{setup(e,{initMobx:t}){var s;t();const i=e.props.progressData;this.state={progressText:e.props.text||tr("main::toast::loading_title"),showUploadingCount:null==(s=null==i?void 0:i.showUploadingCount)||s,uploadingCount:(null==i?void 0:i.uploadingCount)||0,uploadedCount:(null==i?void 0:i.uploadedCount)||0,progress:(null==i?void 0:i.progress)||0,autohide:e.props.autohide,id:e.props.id}},setProgress(e,{uploadingCount:t=0,uploadedCount:s=0}){if(this.state.progress=De(0,Math.round(e),100),this.state.uploadingCount=t,this.state.uploadedCount=s,anime({targets:$(this.root).find(".toast-loading__bar-fill")[0],easing:"linear",duration:200,width:`${e}%`,complete:()=>{this.update()}}),100===e&&this.state.autohide){const e=toast.instances.find((e=>e.opts.id===this.state.id));e&&setTimeout((()=>{e.hide()}),500)}},onBeforeUnmount(){"function"==typeof this.props.cancelHandler&&this.state.progress<100&&this.props.cancelHandler()}},template:(e,t,s,i)=>e('<div class="toast-loading__progress"><div class="toast-loading__header"><div expr1073="expr1073" class="toast-loading__progress-title"> </div><div expr1074="expr1074" class="toast-loading__progress-value"> </div></div><div class="toast-loading__bar"><span class="toast-loading__bar-fill"></span></div><div expr1075="expr1075" class="toast-loading__count"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["toast-loading editor-ui ",e.props.class].join("")}]},{redundantAttribute:"expr1073",selector:"[expr1073]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.progressText].join("")}]},{redundantAttribute:"expr1074",selector:"[expr1074]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.progress,"%"].join("")}]},{type:s.IF,evaluate:e=>e.state.showUploadingCount,redundantAttribute:"expr1075",selector:"[expr1075]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::toast::uploading_count",{uploadedCount:e.state.uploadedCount,uploadingCount:e.state.uploadingCount})].join("")}]}])}]),name:"toast-loading"};e(ui.name,ui);class mi{constructor(e={}){this.options=void 0,this.$overlay=void 0,this.progressToastInstance=void 0,this.options=e}errorToast(e){const t=this.options.toastMessages[e];t&&(toast.clear(),toast.error(tr(t)))}doneToast({count:e,uploadedCount:t}){const s=this.options.toastMessages.done;s&&(toast.clear(),toast.done(tr(s,{count:+e,uploadedCount:+t})))}progressToast({progress:e,text:t=null,uploadedCount:s=0,uploadingCount:i=0,cancelHandler:a=(()=>{}),closeButton:n=!0,autohide:r=!0}){const o={delay:999999999,closeButton:n},l={progressData:{progress:e,uploadedCount:s,uploadingCount:i,showUploadingCount:i>1},cancelHandler:a,autohide:r,text:t};toast.clear(),this.progressToastInstance=toast.component(ui,o,l)}setProgress({progress:e,uploadedCount:t=0,uploadingCount:s=0}){this.progressToastInstance&&this.progressToastInstance.component.setProgress(e,{uploadedCount:t,uploadingCount:s})}showOverlay(){const e=$('<div class="uploader-overlay">');$("body").append(e),e.on("pointerdown",(e=>{e.preventDefault(),e.stopPropagation(),this.progressToastInstance&&anime({targets:this.progressToastInstance.toast,scale:[1.07,1],easing:"cubicBezier(0.34, 1.56, 0.64, 1)"})})),this.$overlay=e}hideOverlay(){var e;null==(e=this.$overlay)||e.remove()}hideUI(){var e;this.hideOverlay(),null==(e=this.progressToastInstance)||e.hide()}}class hi{static create(){return this._instance||(this._instance=new hi),this._instance}constructor(){this.imageUploader=void 0,this.fileUploader=void 0,this.imageUploader=pi.init({type:"image"}),this.fileUploader=pi.init({})}async upload(e,t={}){var s,i;t=this.normalizeOptions(t);let a=(e=Array.from(e)).length;const n=[],r=t.types,o=new mi({toastMessages:t.toastMessages}),l=()=>{this.cancelAllUpload(),o.hideUI(),null==t.onCancel||t.onCancel()},d=e=>{null==t.onError||t.onError(e),o.hideUI(),o.errorToast(e)};if(!e.length)return void d("emptyFileList");const c=ve(e,((e,s)=>new Promise(((i,l)=>{let d=this.fileUploader,c=e=>JSON.parse(e);if(/image/.test(e.type)&&r.includes("image")&&t.acceptTypes.image.includes(e.type)){if(t.sizeLimit.image<e.size)return l(new Error("badSize"));d=this.imageUploader,c=e=>ct(JSON.parse(e))}else if(/video/.test(e.type)&&r.includes("video")&&t.acceptTypes.video.includes(e.type)){if(t.sizeLimit.video<e.size)return void l(new Error("badSize"))}else{if(!r.includes("file")||!t.acceptTypes.file.includes(e.type))return a-=1,void i(null);if(t.sizeLimit.file<e.size)return void l(new Error("badSize"))}d.addItem({file:e,onComplete:async(t,s)=>{try{i({data:c(s),initialData:e,mimeType:e.type})}catch(e){l(e)}},onError:e=>{l(e)},onProgress:e=>{n[s]=e,(()=>{const e=n.reduce(((e,t)=>e+t),0)/a,s=n.filter((e=>100===e)).length,i={progress:e,uploadingCount:a,uploadedCount:s};o.setProgress(i),null==t.onProgress||t.onProgress(i)})()}})})))).then((e=>{if(!(e=e.filter((e=>e))).length)throw new Error("notSupportedFiles");return(e=>{const s=e.filter((e=>e.data));null==t.onComplete||t.onComplete(e),o.hideUI(),o.doneToast({count:e.length,uploadedCount:s.length}),s.length!==e.length&&toast.log(tr("main::toast::upload_missed_warning"))})(e),null})).catch((e=>{d(e.message),this.cancelAllUpload()})),p={files:e.map((e=>({data:null,initialData:e,mimeType:e.type}))),cancelUpload:l};var u;return u=p,null==t.onStart||t.onStart(u),o.showOverlay(),o.progressToast({progress:0,uploadingCount:u.files.length,uploadedCount:0,cancelHandler:l}),null==(s=this.imageUploader)||s.startUpload(),null==(i=this.fileUploader)||i.startUpload(),c}cancelAllUpload(){var e,t;null==(e=this.imageUploader)||e.cancelAllUpload(),null==(t=this.fileUploader)||t.cancelAllUpload()}normalizeOptions(e){return{types:["image","video"],...e,toastMessages:{notSupportedFiles:"main::toast::upload_invalid_error",emptyFileList:"main::toast::upload_default_error",badSize:"main::toast::upload_size_error",done:"main::toast::success_upload",...e.toastMessages||{}},acceptTypes:{image:["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"],video:["video/mp4"],file:["text/javascript","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/json","text/plain","text/css","text/html","text/csv"],...e.acceptTypes},sizeLimit:{image:15728640,video:52428800,file:104857600,...e.sizeLimit}}}}hi._instance=void 0;const gi=e=>JSON.stringify(e),vi=e=>"object"===e?null:JSON.parse(e),fi=({name:e="unknown",data:t})=>{const s=document.createElement("flexbe-buffer");return s.setAttribute("data-name",gi(e)),s.setAttribute("data-value",gi(t)),s.outerHTML},xi=e=>{const t=$(e).filter("flexbe-buffer")[0];if(t)try{const e=vi(t.getAttribute("data-name"));return{name:e,data:vi(t.getAttribute("data-value"))}}catch(e){}return null},bi=(e,t="text/plain")=>{try{return localStorage.setItem("f_custom_buffer",JSON.stringify({type:t,value:e})),!0}catch(e){return console.error(e),!1}},yi=async()=>{const e=(()=>{try{const{type:e,value:t}=JSON.parse(localStorage.getItem("f_custom_buffer"));return{type:e,value:t}}catch(e){return null}})();if(!e)return null;const t=new DataTransfer;return t.setData(e.type,e.value),Ti(t.items)},_i=e=>"files"===(null==e?void 0:e.type);async function Ti(e){const t={type:null,value:null,text:null,html:null,files:null},s=[],i=[];e=(await ve(Array.from(e),(async e=>"undefined"!=typeof ClipboardItem&&e instanceof ClipboardItem?(async e=>ve(e.types,(async t=>{const s=await e.getType(t),i=new File([s],"unknown",{type:t});return{type:t,kind:/text\//.test(t)?"string":"file",getAsFile:()=>i,getAsString:async e=>e(await s.text())}})))(e):e))).flat();for(const a of e){const e=new Promise((e=>{"file"===a.kind?(t.type="files",i.push(a.getAsFile()),e(!0)):"text/plain"===a.type?a.getAsString((s=>{t.type="text",t.text=s,e(!0)})):"text/html"===a.type?a.getAsString((s=>{if(t.html=s,(i=s)&&i.includes("<flexbe-buffer")){const{name:e,data:i}=xi(s);t.type=e,t.value=i}var i;e(!0)})):e(!1)}));s.push(e)}return await Promise.all(s),_i(t)&&(t.files=i.map((e=>({data:null,initialData:e,mimeType:e.type})))),Object.entries(t).forEach((([e,s])=>{null==s&&delete t[e]})),t}var wi;function ki(){return Array.from($document).reverse().find((e=>e.hasFocus()))||document}const Ai=e=>!["text","html","files"].includes(e),Ei=!(null==(wi=navigator.clipboard)||!wi.read);var Ii=zt("bindPointerHandler"),Ci=zt("bindCopyHandler"),Si=zt("bindPasteHandler"),$i=zt("initPermissionChecker");function Bi(){$document.off(".flexbe-clipboard-over"),$document.one("pointermove.flexbe-clipboard-over",(e=>{this.pointer=e.originalEvent})),$document.on("pointerover.flexbe-clipboard-over",(e=>{this.pointer=e.originalEvent}))}function Ui(){const e=e=>{if(this.locked)return;const t="copy"===e.type||"cut"===e.type,s="keydown"===e.type||"keyup"===e.type,i="KeyX"===e.code||"cut"===e.type?"cut":"copy",a=this.pointer,n=e.target;(s||t)&&(e.shiftKey&&e.preventDefault(),this.list[i].some((i=>{const{included:r,excluded:o,shift:l,alt:d,useLocalStorage:c}=i.options,p=l&&e.shiftKey,u=d&&e.altKey,m=!r.length||tt(n,r),h=p||u||!l&&!e.shiftKey&&!d&&!e.altKey,g=!o.length||!tt(n,o);if(!(m&&g&&h))return!1;const v=i.handler(a,e.originalEvent);if(!1===v)return!1;if("object"==typeof v&&null!=v.value){const{type:i,value:a}=v;if(s||c)this.setData(a,{type:i,useLocalStorage:c});else if(t){const t="text"===i?"text/plain":"text/html";let s=a;Ai(i)&&(s=fi({name:i,data:a})),e.originalEvent.clipboardData.setData(t,s)}}return e.preventDefault(),!0})))};this.inited||fs.register([{hotkeys:["cmd_c","cmd_x","cmd_shift_c","cmd_alt_c","cmd_shift_x","cmd_alt_x"],handlerDown:e,options:{runFirst:!0,stopImmediatePropagation:!0,preventDefault:!1}}])}function Ri(){const e=async e=>{var t,s;if(this.locked)return;const i=this.pointer,a=this.getActiveElement(i.target||e.target),n=await Ti((null==(t=e.originalEvent)||null==(s=t.clipboardData)?void 0:s.items)||[]);await async function(e,t){for(const s in e){if(!e.hasOwnProperty(s))continue;const i=e[s];if(await t(i,s,e))return!0}return!1}(this.list.paste,(async t=>{const{included:s,excluded:r,shift:o,useLocalStorage:l}=t.options,d=o&&e.shiftKey,c=!s.length||tt(a,s),p=r.length&&tt(a,r),u=d||!o&&!e.shiftKey;if(!c||p||!u)return!1;const m=l?await yi():n;return!1!==await t.handler(m,i,e.originalEvent)}))};$document.off(".flexbe-clipboard-paste"),$document.on("paste.flexbe-clipboard-paste",e),this.inited||fs.register([{hotkeys:["cmd_v","cmd_shift_v"],handlerDown:t=>{t.repeat?t.preventDefault():t.shiftKey&&(t.preventDefault(),e(t))},options:{allowRepeat:!0,runFirst:!0,stopImmediatePropagation:!0,preventDefault:!1,excluded:ms}}])}async function Pi(){if(!this.permissionStatus&&null!=navigator.permissions)try{this.permissionStatus=await navigator.permissions.query({name:"clipboard-read",allowWithoutGesture:!1}),this.permissionStatus.addEventListener("change",(()=>{var e;null==(e=this.permissionModal)||e.close(),"granted"!==this.permissionStatus.state&&toast.error(tr("editor::clipboarder::not_allowed_error"),{preventDuplicates:!0}),localStorage.removeItem("skip_show_permission_denied_modal")}))}catch(e){}}const Hi=new class{constructor(){Object.defineProperty(this,$i,{value:Pi}),Object.defineProperty(this,Si,{value:Ri}),Object.defineProperty(this,Ci,{value:Ui}),Object.defineProperty(this,Ii,{value:Bi}),this.list={copy:[],cut:[],paste:[]},this.locked=void 0,this.inited=!1,this.pointer=void 0,this.permissionStatus=void 0,this.permissionModal=void 0}init(){qt(this,$i)[$i](),qt(this,Ii)[Ii](),qt(this,Ci)[Ci](),qt(this,Si)[Si](),this.inited=!0}register(e){return Array.isArray(e)||(e=[e]),(e=e.map((e=>{var t;const s=null!=(t=e.id)?t:Ge(4),i=e.options||{};return{...e,id:s,options:{excluded:ms,included:[],shift:!1,alt:!1,priority:0,...i,useLocalStorage:i.useLocalStorage}}})).filter((e=>e.handler))).forEach((e=>{const t=e.name;var s,i;null==this.list[t]&&(this.list[t]=[]),this.list[t].push(e),this.list[t]=(s=this.list[t],i=e=>e.options.priority||0,s.map(((e,t)=>({item:e,index:i(e,t)}))).filter((({index:e})=>e>=0)).sort(((e,t)=>e.index-t.index)).map((({item:e})=>e))).reverse()})),this.unregister.bind(this,e)}unregister(e){let t=!1;return Array.isArray(e)||(e=[e]),Object.entries(this.list).forEach((([,s])=>{e.forEach((e=>{const i=s.findIndex((t=>e.id?t.id===e.id:!!e.handler&&t.handler===e.handler));i>=0&&(t=!0,s.splice(i,1))}))})),t}setData(e,t){t={type:"text",useLocalStorage:!1,force:!1,...t};let s=e;if(this.locked&&!t.force)return!1;(Ai(t.type)||"string"!=typeof e)&&(s=fi({name:t.type,data:s}));const i="text"===t.type?"text/plain":"text/html";return Ei||t.useLocalStorage||bi(s,i),t.useLocalStorage?bi(s,i):((e,t="text/plain",s=document)=>{const i=document.createElement("input");i.type="text",i.value="string"==typeof e?e:"Copied from Flexbe",i.contentEditable="true",i.readOnly=!0,s.body.appendChild(i),$(i).on("copy cut",(s=>{s.preventDefault(),s.originalEvent.clipboardData.setData(t,e)})),i.select();const a=s.execCommand("copy");return $(i).remove(),a})(s,i,ki())}async getData(e=!1){return Ei||(e=!0),!e&&this.permissionStatus&&"granted"!==this.permissionStatus.state&&await this.showPermissionModal(this.permissionStatus),e?yi():(async()=>Ti(await navigator.clipboard.read()))()}getActiveElement(e=null){const t=ki().activeElement;return e===t||t.contains(e)?e:t}lock(){this.locked=!0}unlock(){this.locked=!1}async showPermissionModal(e){if("denied"===e.state&&localStorage.getItem("skip_show_permission_denied_modal"))return!1;try{navigator.clipboard.read().catch((e=>e))}catch(e){}return new Promise((t=>{this.permissionModal=Zs.create({handle:null,overlay:!0,title:tr("editor::clipboarder::permission_modal::modal_title"),width:360,stopEditor:!0,component:"buffer-permission-modal",props:{permissionStatus:e},onClose:()=>{this.permissionModal=null,t(!0)}})}))}};const ji=new class{constructor(){this.inited=!1,this.zones=[]}init(){$document.off(".flexbe-dropzone"),$document.on("dragover.flexbe-dropzone",(e=>this.onDragOver(e.originalEvent||e))),$document.on("drop.flexbe-dropzone",(e=>this.onDrop(e.originalEvent||e))),this.inited=!0}bindZone(e,t){const s={uploaderOptions:null,showUI:!0,id:Ge(6),zoneArea:e,...t,unbind:null,hide:null,_dragOvered:!1,_dragEntered:!1,_$area:null,_$dropHere:null,_$loading:null};return s.hide=this.hideDropZone.bind(this,s),s.unbind=this.unbindZone.bind(this,s),(s.onDragEnter||s.onDragLeave||s.onDragOver||s.onDrop)&&this.zones.push(s),t.handlePaste&&(s._unbindClipboarder=Hi.register([{name:"paste",options:{included:[e],priority:9e3},handler:async(e,t)=>{if(!e.files)return!1;const s=new DataTransfer;e.files.map((e=>s.items.add(e.initialData)));const i=new DragEvent("drop",{dataTransfer:s});return this.onDrop(i,t.target),!0}}])),s}unbindZone(e){const t=this.zones.indexOf(e);return e._unbindClipboarder&&e._unbindClipboarder(),t>=0&&(this.zones.splice(t,1),!0)}showDropZone(e){if(e._$dropHere)return e._$dropHere;const t=e._$area,s=$('\n            <div class="drop-zone">\n                <svg class="drop-zone__placeholder-icon" width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M14 19L14 10M14 10L11 13M14 10L17 13" stroke="white" stroke-width="2"/>\n                    <path d="M17 13L14 10L11 13" stroke="white" stroke-width="2" stroke-linecap="round"/>\n                    <circle cx="14" cy="14" r="13" stroke="white" stroke-width="2"/>\n                </svg>\n            </div>\n        ');if(t.innerWidth()>255&&t.innerHeight()>65){const e=$(`\n                <div class="drop-zone__placeholder-text">\n                    ${tr("editor::drop_zone::placeholder_title")}\n                </div>\n            `);s.append(e)}return t.append(s),anime({targets:s[0],easing:"linear",duration:100,opacity:1}),e._$dropHere=s,s}hideDropZone(e){const t=e._$dropHere;e._$dropHere=null,t&&!t.hasClass("removing")&&(t.addClass("removing"),anime({targets:t[0],easing:"linear",duration:100,opacity:[1,0],complete:()=>{t.remove()}}))}createUploadingState(e){if(e._$loading)return;const t=e._$area,s=$('\n            <div class="drop-zone loading">\n                <svg class="drop-zone__loader circular-loader color-inherit" viewBox="25 25 50 50"><circle class="loader-path" cx="50" cy="50" r="20" /></svg>\n            </div>\n        ');e._$loading=s,t.append(s)}removeUploadingState(e){e._$loading&&e._$loading.remove()}getNearestZone(e,t=e.target){let s=null;const i=$(t);return i.parents().add(i).toArray().reverse().some((t=>this.zones.some((i=>{const a=null==i.needLock?void 0:i.needLock(e);if(i.uploaderOptions){const t=i.uploaderOptions.types||[];if(!Array.from(e.dataTransfer.items).some((e=>t.some((t=>e.type.includes(t))))))return!1}return!(!$(t).is(i.zoneArea)||a)&&(i._$area=$(t),s=i,!0)})))),s}onDragEnter(e,t){if(e.stopPropagation(),e.stopImmediatePropagation(),t||(t=this.getNearestZone(e)),t&&!t._dragEntered){t._dragEntered=!0;const s=this.createPointer(e);t._$area&&t._$area.addClass("drag-over"),t.showUI&&this.showDropZone(t),null==t.onDragEnter||t.onDragEnter(s,e)}}onDragLeave(e,t){if(e.stopPropagation(),e.stopImmediatePropagation(),t||(t=this.getNearestZone(e)),t){t._dragEntered=!1;const s=this.createPointer(e);this.hideDropZone(t),t._$area&&t._$area.removeClass("drag-over"),null==t.onDragLeave||t.onDragLeave(s,e)}}onDragOver(e){e.preventDefault();const t=this.getNearestZone(e),s=this.createPointer(e);t&&(e.stopPropagation(),e.stopImmediatePropagation(),t._dragEntered||this.onDragEnter(e,t),t._dragOvered&&clearTimeout(t._dragOvered),t._dragOvered=setTimeout((()=>{t._dragOvered=!1,this.onDragLeave(e,t)}),120),null==t.onDragOver||t.onDragOver(s,e))}async onDrop(e,t=e.target){e.preventDefault();const s=this.getNearestZone(e,t);if(s){e.stopPropagation(),e.stopImmediatePropagation(),s.showUI&&(this.createUploadingState(s),this.hideDropZone(s));const i=this.createPointer({target:t,clientX:e.clientX,clientY:e.clientY});let a=await Ti(e.dataTransfer.items);if("function"==typeof s.onBeforeDrop){const t=await s.onBeforeDrop(a,i,e);t&&(a=t)}s.uploaderOptions&&(a=await async function(e,t={}){return t={types:[],...t},_i(e)&&Array.isArray(e.files)&&e.files.length?new Promise((s=>{const i=hi.create(),a=[],n=[];e.files.forEach((e=>{null==t.types||t.types.some((t=>e.mimeType.includes(t)))?a.push(e.initialData):n.push(e)})),a.length?i.upload(a,{...t,onStart:s=>{null==t.onStart||t.onStart(e,s.cancelUpload)},onComplete:i=>{e.files=[...n,...i],null==t.onComplete||t.onComplete(e),s(e)},onError:i=>{null==t.onError||t.onError(i),s(e)},onCancel:()=>{null==t.onCancel||t.onCancel(),s(e)}}):(null==t.onComplete||t.onComplete(e),s(e))})):(null==t.onComplete||t.onComplete(e),e)}(a,s.uploaderOptions)),"function"==typeof s.onDrop&&await s.onDrop(a,i,e),s.showUI&&this.removeUploadingState(s)}}createPointer({clientX:e,clientY:t,target:s}){return{target:s,x:e,y:t}}},Fi={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={inDropdown:!1,get list(){return e.props.list||[]},get data(){return e.props.data},get name(){return this.data.name},get value(){return this.data.value},get showValue(){var t;return null==(t=e.props.showValue)||t}},this.meta={sprite:at("filters","admin"),get title(){var t;const{list:s,name:i}=e.state;return(null==(t=s.find((e=>e.name===i)))?void 0:t.title)||""},get buttonIcon(){return`icon-${e.state.value}`}},this.watch={"state.data":[()=>this.update(),{deep:!0}],"state.inDropdown":()=>this.update()}},getSortValue(e){return this.state.name===e.name?"asc"===this.state.value?"desc":"asc":this.state.value||"asc"},updateSort(e){var t,s;null==(t=(s=this.props).onUpdate)||t.call(s,{name:e.name,value:this.getSortValue(e)})},onToggleDropdown(e){this.state.inDropdown=e}},template:(e,t,s,i)=>e('<svg expr678="expr678" is="flexbe-icon"></svg><div expr679="expr679" class="flexbe-text"></div><div expr680="expr680" is="proxy" data-is="dropdown" position="center"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["dropdown-sort flexbe-button filled rounded is-secondary ",e.props.class," ",e.classNames({active:e.state.inDropdown,"show-value":e.state.showValue})].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.meta.buttonIcon},{type:t.ATTRIBUTE,name:"size",evaluate:e=>e.state.showValue?16:14}],redundantAttribute:"expr678",selector:"[expr678]"},{type:s.IF,evaluate:e=>e.state.showValue,redundantAttribute:"expr679",selector:"[expr679]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.meta.title].join("")}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="flexbe-list hoverable borderless hoverable-background round-corners"><div expr681="expr681"></div></div>',bindings:[{type:s.EACH,getKey:null,condition:null,template:e('<div class="dropdown-sort__title"><div expr682="expr682"> </div><div expr683="expr683"><svg expr684="expr684" is="flexbe-icon" icon="arrow-desc"></svg><svg expr685="expr685" is="flexbe-icon" icon="arrow-asc"></svg></div></div><svg expr686="expr686" is="flexbe-icon" icon="check"></svg>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list-item ",e.classNames({"active-item":e.item.name===e.state.name})].join("")},{type:t.ATTRIBUTE,name:"date-name",evaluate:e=>e.item.value},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.updateSort(e.item)}]},{redundantAttribute:"expr682",selector:"[expr682]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.item.title].join("")},{type:t.ATTRIBUTE,name:"date-name",evaluate:e=>e.item.value}]},{redundantAttribute:"expr683",selector:"[expr683]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["sort-arrow-content ",e.item.name===e.state.name?e.state.value:""].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr684",selector:"[expr684]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr685",selector:"[expr685]"},{type:s.IF,evaluate:e=>e.item.name===e.state.name,redundantAttribute:"expr686",selector:"[expr686]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>14}]}])}]),redundantAttribute:"expr681",selector:"[expr681]",itemName:"item",indexName:null,evaluate:e=>e.state.list}]}],attributes:[{type:t.ATTRIBUTE,name:"arrow",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!1},{type:t.EVENT,name:"on-open",evaluate:e=>()=>e.onToggleDropdown(!0)},{type:t.EVENT,name:"on-close",evaluate:e=>()=>e.onToggleDropdown(!1)}],redundantAttribute:"expr680",selector:"[expr680]"}]),name:"dropdown-sort"};e(Fi.name,Fi);const Li={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={inDropdown:!1,inAnimation:!1,loadingItemValue:null,get list(){return e.props.list||[]},get value(){return e.props.value}},this.state._lastValue=this.state.value,this.meta={sprite:at("filters","admin"),get title(){var t;const{list:s,value:i}=e.state;return(null==(t=s.find((e=>e.value===i)))?void 0:t.title)||""}},this.watch={"state.inDropdown":()=>this.update(),"state.inAnimation":()=>this.update(),"state.loadingItemValue":()=>this.update()}},updateFilter({value:e}){this.state.loadingItemValue=e,setTimeout((async()=>{var t;e!==this.state.value&&await(null==(t=this.props)?void 0:t.onUpdate(e));this.state.loadingItemValue=null,flexbe.trigger("closeDropdown")}),100)},onToggleDropdown(e){this.state.inDropdown=e},updateWidthValue(){this.state._lastWidth=this.root.clientWidth},onMounted(){this.updateWidthValue()},onBeforeUpdate(){this.updateWidthValue()},onUpdated(){if(this.state.value!==this.state._lastValue&&!this.state.inAnimation){const e=this.$$(".flexbe-text, .flexbe-icon"),t=this.root.getBoundingClientRect().width;anime({targets:e,opacity:[0,1],easing:"easeInOutQuart",duration:400}),anime({targets:this.root,width:[this.state._lastWidth,t],easing:"easeInOutQuad",duration:250,begin:()=>{this.state.inAnimation=!0},complete:()=>{this.root.style.removeProperty("width"),this.state.inAnimation=!1}}),this.state._lastValue=this.state.value}}},template:(e,t,s,i)=>e('<div expr687="expr687" class="flexbe-text text-medium"> </div><svg viewBox="0 0 10 6" class="flexbe-icon size-8"><path d="M5 4L9 -4.37114e-08L10 1L5 6L-4.37114e-08 1L1 -3.93402e-07L5 4Z"/></svg><div expr688="expr688" is="proxy" data-is="dropdown" class="menu-list" balloon-class="dropdown-filter-balloon" position="center"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["dropdown-filter flexbe-button filled rounded is-secondary ",e.props.class," ",e.classNames({active:e.state.inDropdown,"in-animation":e.state.inAnimation})].join("")}]},{redundantAttribute:"expr687",selector:"[expr687]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.meta.title}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="flexbe-list hoverable borderless hoverable-background round-corners"><div expr689="expr689" class="flexbe-list-item justify-content-between"></div></div>',bindings:[{type:s.EACH,getKey:null,condition:null,template:e('<span expr690="expr690" class="flexbe-text"> </span><svg expr691="expr691" is="flexbe-icon" icon="check"></svg><svg expr692="expr692" is="flexbe-loader"></svg>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.updateFilter(e.filter)}]},{redundantAttribute:"expr690",selector:"[expr690]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.filter.title].join("")}]},{type:s.IF,evaluate:e=>!e.state.loadingItemValue&&e.filter.value===e.state.value,redundantAttribute:"expr691",selector:"[expr691]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"size",evaluate:e=>14},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}]}])},{type:s.IF,evaluate:e=>e.filter.value===e.state.loadingItemValue,redundantAttribute:"expr692",selector:"[expr692]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[]}])}]),redundantAttribute:"expr689",selector:"[expr689]",itemName:"filter",indexName:null,evaluate:e=>e.state.list}]}],attributes:[{type:t.ATTRIBUTE,name:"arrow",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!0},{type:t.EVENT,name:"on-open",evaluate:e=>()=>e.onToggleDropdown(!0)},{type:t.EVENT,name:"on-close",evaluate:e=>()=>e.onToggleDropdown(!1)}],redundantAttribute:"expr688",selector:"[expr688]"}]),name:"dropdown-filter"};e(Li.name,Li);const Ni={css:null,exports:i({_hotkeysDisposer:null,setup(e,{initMobx:t}){t({autoUpdate:!0}),this.state={searchInputInFocus:!1,get searchValue(){return e.props.value},get searchCount(){return e.props.searchCount||0}},this.meta={filtersSprite:at("filters","admin"),get searchIcon(){return`${this.filtersSprite}#search`},get resetIcon(){return`${this.filtersSprite}#reset`}},this.onSearchInput=$.throttle(this.onSearchInput,e.props.debounce||300)},eventStopPropagation(e){e.stopPropagation(),e.preventDefault()},onToggleSearchFocus(e){this.state.searchInputInFocus=e},resetSearchValue(e){var t,s;this.eventStopPropagation(e),null==(t=(s=this.props).onSearchInput)||t.call(s,{value:""})},onSearchInput(e){var t,s;null==(t=(s=this.props).onSearchInput)||t.call(s,{value:e.target.value})},onBeforeUpdate(e){const t=e.searchCount||0;if(this.state.searchCount!==t){const e=$(".admin-search-input__result-count span",this.root)[0];if(e){const s={value:this.state.searchCount};anime({targets:s,value:t,easing:"linear",duration:200,update:()=>{e.innerHTML=s.value.toFixed()}})}}},onMounted(){this._hotkeysDisposer=fs.register([{hotkeys:["cmd_f"],options:{preventDefault:!0},handlerDown:()=>{$("input",this.root).trigger("focus")}},{hotkeys:["escape"],handlerDown:()=>{this.state.searchInputInFocus&&$("input",this.root).trigger("blur")}}])},onUnmounted(){var e;null==(e=this._hotkeysDisposer)||e.call(this)}}),template:(e,t,s,i)=>e('<div expr693="expr693" is="flexbe-input"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-search-input ",e.props.class].join("")},{type:t.ATTRIBUTE,name:"data-value",evaluate:e=>e.state.searchValue}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[{id:"default",html:'<div expr694="expr694" class="admin-search-input__result-count"></div><div expr696="expr696" class="flexbe-input__addon flexbe-button style-text small"></div>',bindings:[{type:s.IF,evaluate:e=>"number"==typeof e.state.searchCount&&e.state.searchValue,redundantAttribute:"expr694",selector:"[expr694]",template:e(' <span expr695="expr695"> </span>',[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::filters::found_count")].join("")}]},{redundantAttribute:"expr695",selector:"[expr695]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.searchCount}]}])},{type:s.IF,evaluate:e=>e.state.searchValue,redundantAttribute:"expr696",selector:"[expr696]",template:e('<div expr697="expr697" is="flexbe-icon"></div>',[{expressions:[{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.eventStopPropagation},{type:t.EVENT,name:"onclick",evaluate:e=>e.resetSearchValue}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.meta.resetIcon},{type:t.ATTRIBUTE,name:"size",evaluate:e=>10}],redundantAttribute:"expr697",selector:"[expr697]"}])}]}],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["rounded light ",e.classNames({focus:e.state.searchInputInFocus})].join("")},{type:t.ATTRIBUTE,name:"prefix-icon",evaluate:e=>e.meta.searchIcon},{type:t.ATTRIBUTE,name:"prefix-icon-size",evaluate:e=>14},{type:t.ATTRIBUTE,name:null,evaluate:e=>e.props},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.searchValue},{type:t.EVENT,name:"oninput",evaluate:e=>e.onSearchInput},{type:t.EVENT,name:"onfocus",evaluate:e=>()=>e.onToggleSearchFocus(!0)},{type:t.EVENT,name:"onblur",evaluate:e=>()=>e.onToggleSearchFocus(!1)}],redundantAttribute:"expr693",selector:"[expr693]"}]),name:"admin-search-input"};e(Ni.name,Ni),riot3.tag2("proxy",'<div ref="proxy-slot" if="{showSlot}"><yield></yield></div>',"",'class="{className}"',(function(e){this.mixin("inheritYield"),this.showSlot=!!this.__.innerHTML.trim(),this.className=e.class,this.onMounted=function(){this._mountRiotComponent()}.bind(this),this.onUnmounted=function(){this._unmountRiotComponent()}.bind(this),this.onUpdated=function(){if(!this.component)return;const e=this.opts.component||this.opts.is;this.componentName!==e?(this._unmountRiotComponent(),this._mountRiotComponent()):this._updateRiotComponent()}.bind(this),this._mountRiotComponent=function(){this.showSlot&&$(this.refs["proxy-slot"]).detach();const e=this.opts.component||this.opts.is,s=t.globals.COMPONENTS_IMPLEMENTATION_MAP.get(e);if(!s)return void console.error(`ERROR: Riot component <${e}> not registered`);const i=this.getProps(),a=this.showSlot?[{id:"default",html:'<mark class="default"></mark>'}]:[],n=this.root.style.transition;this.root.style.setProperty("transition","none"),requestAnimationFrame((()=>{this.root.style.setProperty("transition",n)})),this.component=s({props:i,slots:a}).mount(this.root,this),this.componentName=e,this.className=this.root.className,this._replaceSlots()}.bind(this),this._unmountRiotComponent=function(){this.component&&(this.component.unmount(!0),this.component=null)}.bind(this),this._updateRiotComponent=function(){const e=this.getProps();Object.defineProperty(this.component,"props",{value:{...this.component.props,...e},enumerable:!1,writable:!1,configurable:!0}),this.component.update({},this),this.className=this.root.className,this._replaceSlots()}.bind(this),this._replaceSlots=function(){this.showSlot&&this.refs["proxy-slot"]&&$("mark.default",this.root).replaceWith(this.refs["proxy-slot"])}.bind(this),this.getProps=function(){const e={...this.opts};return delete e.component,delete e.is,delete e.dataIs,delete e["data-is"],null!=e.riotValue&&(e.value=e.riotValue),e}.bind(this)})),riot3.tag2("raw","","","",(function(e){this.mixin("inheritYield");const t=()=>{const e=this.opts.content||this.__.innerHTML;this.content!==e&&(this.content=e,this.root.innerHTML=e,this.root.removeAttribute("content"))};this.on("update",(()=>{t()})),this.on("mount",(()=>{t()}))})),riot3.tag2("dropdown",'<div if="{state.showHelper}" class="toggle-helper" data-tip="{!state.showBalloon && state.tipContent}" onclick="{onHelperClick}" oncontextmenu="{onHelperClick}"></div> <div if="{state.show}" class="{meta.balloonClass}" is-show="{state.showBalloon}" animate-hide="{state.inAnimateHide}" ref="balloon" tabindex="0" onkeydown="{onBalloonKeyDown}" data-layers-events="ignore"> <div if="{state.showArrow}" class="arrow" ref="arrow"></div> <div class="{meta.contentClass}" ref="content" riot-style="{meta.contentStyle}"><yield></yield></div> </div>',"",'onmouseenter="{onMouseEnter}" onmouseleave="{onMouseLeave}"',(function(e){let t,s;this.mixin("inheritYield"),this.mixin("initMobx");const i=this;this.editor=i.opts.editor,this.modules=i.opts.modules,this.observer=i.opts.observer,this.state={skipTipInit:i.opts.skipTipInit,get show(){return this.showBalloon||this.inAnimateHide},showBalloon:!1,inAnimateShow:!1,inAnimateHide:!1,dataScope:i.opts.dataScope,showArrow:i.opts.arrow??!0,showHelper:i.opts.helper??!0,theme:i.opts.theme??"default",autofocus:i.opts.autofocus??!1,direction:i.opts.direction||"bottom",forceDirection:i.opts.forceDirection||!1,position:i.opts.position||"center",offsetX:+i.opts.offsetX||+i.opts.offsetLeft||0,offsetY:+i.opts.offsetY||+i.opts.offsetTop||0,appendToBody:i.opts.appendToBody||!1,relativeTo:i.opts.relative,arrowPad:+i.opts.arrowPad||5,positionArrowTo:i.opts.arrowTo||i.opts.positionTo,positionBalloonTo:i.opts.balloonTo||i.opts.positionTo,widthByRelative:i.opts.widthByRelative||!1,triggerType:i.opts.trigger??"click",triggerDelay:i.opts.triggerDelay??300,get autohide(){const e=i.props.autohide;return!0===e?"a, li, .flexbe-list-item":e},get tip(){return i.props.tip||!1},get tipContent(){const e=this.tip;return"string"==typeof e?e:!("object"!=typeof e||!e.content)&&e.content}},this.meta={window:null,document:null,$body:null,$parent:null,$root:null,$balloon:null,$content:null,$arrow:null,$relative:null,$balloonRelative:null,$arrowRelative:null,$scrollable:null,scrollRect:null,scrollOnDoc:!1,directionMap:{top:["top","bottom"],bottom:["bottom","top"],left:["left","right"],right:["right","left"]},get balloonClass(){const e=["dropdown__balloon","balloon",`dropdown__balloon--${i.state.theme}`];return i.state.appendToBody&&e.push("balloon-append-to-body"),i.props.balloonClass&&e.push(i.props.balloonClass),e.flat().join(" ")},get contentClass(){const e=["dropdown__balloon_content","flexbe-balloon-content"];return i.props.contentClass&&e.push(i.props.contentClass),e.flat().join(" ")},get contentStyle(){return i.props.minWidth?`min-width: ${i.props.minWidth}px;`:null}},this.fillRefs=function(){const{positionBalloonTo:e,positionArrowTo:t,relativeTo:s}=this.state,i=this.root.ownerDocument,a=i.defaultView,n=i.body,r=document.documentElement.clientHeight,o=document.documentElement.clientWidth;this.meta.document=i,this.meta.$body=$(n),this.meta.window=a,this.meta.$root=$(this.root),this.meta.$balloon=this.meta.$root.find("[ref=balloon]"),this.meta.$content=this.meta.$root.find("[ref=content]"),this.meta.$arrow=this.meta.$root.find("[ref=arrow]"),this.meta.$scrollable=$(this.opts.scrollable??function(e){const t=(e,s=[])=>null==e.parentNode?s:t(e.parentNode,s.concat([e])),s=e=>{const t=/(auto|scroll)/,s=getComputedStyle(e,null);return["overflow","overflow-y","overflow-x"].some((e=>t.test(s.getPropertyValue(e))))};if(!(e=$(e)[0])||!e.parentNode)return;const i=t(e.parentNode,[]);for(let e=0;e<i.length;e++)if(s(i[e]))return i[e];const a=e.ownerDocument||document;return a.scrollingElement||a.documentElement}(this.root)),this.meta.scrollOnDoc=this.meta.$scrollable[0]===i.documentElement,this.meta.$parent=this.meta.$root.parent(),this.meta.$relative=s&&this.meta.$root.parents(s),this.meta.$balloonRelative=e&&this.meta.$root.closest(e),this.meta.$arrowRelative=t&&this.meta.$root.closest(t),this.meta.$relative&&this.meta.$relative.length?this.meta.$relative=this.meta.$relative.add(this.meta.$parent):this.meta.$relative=this.meta.$parent;const l=this.meta.$relative[0].getBoundingClientRect();this.meta.$balloonRelative&&this.meta.$balloonRelative.length||(this.meta.$balloonRelative=this.meta.$relative.eq(0)),this.meta.$arrowRelative&&this.meta.$arrowRelative.length||(this.meta.$arrowRelative=this.meta.$root),this.meta.scrollOnDoc||this.state.appendToBody?this.meta.scrollRect={top:0,left:0,right:a.innerWidth,bottom:a.innerHeight,height:a.innerHeight,scrollHeight:n.scrollHeight,scrollWidth:n.scrollWidth,width:a.innerWidth}:this.meta.$scrollable[0]&&(this.meta.scrollRect={width:this.meta.$scrollable.outerWidth(),height:this.meta.$scrollable.outerHeight(),scrollHeight:this.meta.$scrollable[0].scrollHeight,scrollWidth:this.meta.$scrollable[0].scrollWidth,...this.meta.$scrollable.offset()}),r-l.bottom>this.meta.$balloon.outerHeight()?this.meta.scrollRect.bottom=this.meta.scrollRect.top+Math.max(this.meta.scrollRect.height,this.meta.scrollRect.scrollHeight):this.meta.scrollRect.bottom=$document.scrollTop()+r,o-l.left>this.meta.$balloon.outerWidth()?this.meta.scrollRect.right=this.meta.scrollRect.left+this.meta.scrollRect.width:this.meta.scrollRect.right=$document.scrollLeft()+o}.bind(this),this.toggleDropdown=function(e){clearTimeout(s);const i=!1===e||!0===e?e:!this.state.showBalloon;if(i===this.state.showBalloon)return;this.state.showBalloon=i,this.state.inAnimateShow=i,this.state.inAnimateHide=!i,this.update(),i&&this.fillRefs();const a=this.meta.$scrollable,n=this.meta.$balloon,r=this.meta.$body,o=this.meta.$root,l=n[0],d=l&&getComputedStyle(l).animationName,c=this.state.autofocus;if(r.css("--dropdownOverflowBottom",""),t&&$document.off(t),l&&d&&"none"!==d?l?.addEventListener("animationend",(()=>{this.state.inAnimateShow=!1,this.state.inAnimateHide=!1,this.update()}),{once:!0}):(this.state.inAnimateShow=!1,this.state.inAnimateHide=!1,this.update()),this.meta.$relative.toggleClass("in-dropdown focus",i),"function"==typeof this._rootRepositionDisposer&&this._rootRepositionDisposer(),i){if(this.onOpen(e),!1!==this.state.position&&this.setPosition(),this.state.appendToBody&&a[0]){let e;this._rootRepositionDisposer=St((()=>{const t={width:o.outerWidth(),height:o.outerHeight(),...o.offset()};t.bottom=t.top+t.height,t.right=t.left+t.width,e||(e=t),!o[0].offsetParent||e.left===t.left&&e.top===t.top&&e.right===t.right&&e.bottom===t.bottom||(e=t,this.setPosition(!0))}),10)}this.state.autohide&&n.off("click.autohide").on("click.autohide",this.state.autohide,(()=>{this.toggleDropdown(!1)})),c&&n.focus(),t=n.clickOut((e=>{if(e.target.closest(".tooltipster-base, .autocomplete-suggestions"))return!1;setTimeout((()=>this.toggleDropdown(!1)))}),$(this.root).find(".toggle-helper"))}else c&&$(this.root).closest("[tabindex]").focus(),$(this.root).off("click.autohide"),this.onClose(e)}.bind(this),this.setPosition=function(e){const t=10,s=this.state.arrowPad,i=this.state.position,a=this.state.direction,n=this.state.offsetX,r=this.state.offsetY,o=this.state.widthByRelative,{$body:l,$balloon:d,$content:c,$arrow:p,$root:u,$arrowRelative:m,$balloonRelative:h}=this.meta;e?(l.css("--dropdownOverflowBottom",""),d.length&&(d[0].style.cssText=""),p.length&&(p[0].style.cssText="")):this.state.appendToBody&&l.append(d),o&&d.css({width:o*h.outerWidth()/100});const g=this.meta.scrollRect,v={width:m.outerWidth(),height:m.outerHeight(),...m.offset()},f={width:h.outerWidth(),height:h.outerHeight(),...h.offset()},x={width:u.outerWidth(),height:u.outerHeight(),...u.offset()};x.bottom=x.top+x.height,x.right=x.left+x.width;const b={width:c.outerWidth(),height:c.outerHeight(),...c.offset()},y={top:b.height+t<x.top-g.top,left:b.width+t<x.left-g.left,bottom:b.height+t<g.top+g.scrollHeight-x.bottom,right:b.width+t<g.left+g.scrollWidth-x.right};let _=!this.state.forceDirection&&this.meta.directionMap[a].find((e=>y[e]))||a;const T=p.outerWidth()||0,w=p.outerHeight()||0,k=this.state.appendToBody?Math.round(f.left):Math.round(f.left-x.left),A=Math.round(k-(b.width-f.width)),E=Math.round((k+A)/2),I=this.state.appendToBody?Math.round(f.top):Math.round(f.top-x.top),C=Math.round(I-(b.height-f.height));let S=E,$=Math.round((I+C)/2);"start"===i?(S=k,$=I):"end"===i&&(S=A,$=C);const B="static"!==l.css("position")?l.offset():{top:0,left:0};if(["top","bottom"].includes(_)){const e=b.left+b.width+S+t,i=b.left+S-t;let a=v.top+v.height-x.top,o=x.bottom-v.top,c=S,u=k-S+(v.left-f.left)+v.width/2-T/2;if(u+T+s>b.width){const e=u-b.width+T+s;u-=e,c+=e}else if(u<s){const e=u-s;u-=e,c+=e}if(e>g.right){const t=b.width-u-T-s,i=Math.round(Math.min(e-g.right,t));u+=i,c-=i}else if(i<0){const e=Math.min(0-i,u-s);u-=e,c+=e}if(a+=r,o+=r,c+=n,u-=n,this.state.appendToBody){$="bottom"===_?Math.round(f.top+f.height):Math.round(f.top-(b.height+s+w));const e=$+b.height+20-g.scrollHeight;"bottom"===_&&e>0&&l.css("--dropdownOverflowBottom",`${e}px`),d.css({top:`${$}px`,bottom:"auto",left:c-B.left+"px",right:"auto"})}else d.css({top:"top"===_?"auto":`${a}px`,bottom:"bottom"===_?"auto":`${o}px`,left:`${c}px`,right:"auto"});p.css("left",`${u}px`)}else if(["right","left"].includes(_)){const e=b.top+$-t,i=b.top+b.height+$+t;let a=v.left+v.width-x.left,o=x.right-v.left,l=$,c=I-$+(v.top-f.top)+v.height/2-w/2;if(c+w+s>b.height){const e=c-b.height+w+s;c-=e,l+=e}else if(c<5){const e=c-5;c-=e,l+=e}if(i>g.bottom){const e=b.height-c-w-20,t=Math.round(Math.max(i-g.bottom,e));c+=t,l-=t}else if(e<g.top){const s=c-t,i=Math.min(g.top-e,s);c-=i,l+=i}a+=n,o+=n,l+=r,c-=r,this.state.appendToBody?(S="left"===_?Math.round(f.left-b.width-t):Math.round(f.left+f.width),d.css({top:l-B.top+"px",left:S-B.left+"px",bottom:"auto",right:"auto"})):d.css({left:"left"===_?"auto":`${a}px`,right:"right"===_?"auto":`${o}px`,top:`${l}px`,bottom:"auto"}),p.css("top",`${c}px`)}d.removeClass(((e,t)=>t.split(" ").filter((e=>e.includes("in-"))).join(" "))),d.addClass(`in-${_}`,!0)}.bind(this),this.onBalloonKeyDown=function(e){return e.preventUpdate=!0,!!this.state.showBalloon&&(27===e.keyCode?(this.toggleDropdown(!1),e.preventDefault(),e.stopImmediatePropagation(),!1):void 0)}.bind(this),this.onHelperClick=function(e){"click"===this.state.triggerType&&(this.toggleDropdown(e),e.target.closest("a")&&e.preventDefault(),"contextmenu"===e.type&&(e.preventDefault(),e.stopPropagation()))}.bind(this),this.onMouseEnter=function(e){e.preventUpdate=!0,"hover"===this.state.triggerType&&this.toggleDropdown(!0)}.bind(this),this.onMouseLeave=function(e){e.preventUpdate=!0,"hover"===this.state.triggerType&&(clearTimeout(s),s=setTimeout((()=>this.toggleDropdown(!1)),this.state.triggerDelay))}.bind(this),this.initTips=function(){const e=$(this.root).find(".toggle-helper");if(e.length&&null!=this.state.tip&&!this.state.skipTipInit){const t="object"==typeof this.state.tip?this.state.tip:{};flexbe.tip.init(e,{position:"bottom",...t})}}.bind(this),this.onOpen=function(e){flexbe.trigger("dropdownOpened",{dropdown:this}),this.observer?.trigger("dropdownOpened",{dropdown:this}),"function"==typeof this.opts.onopen&&this.opts.onopen(e,this)}.bind(this),this.onClose=function(e){flexbe.trigger("dropdownClosed",{dropdown:this}),this.observer?.trigger("dropdownClosed",{dropdown:this}),"function"==typeof this.opts.onclose&&this.opts.onclose(e,this)}.bind(this);const a=e=>{const t=e.dropdown,s=t===this,i=t.state.dataScope===this.state.dataScope;!s&&i&&this.state.showBalloon&&t.state.showBalloon&&this.toggleDropdown(!1)},n=()=>{this.toggleDropdown(!0)},r=()=>{this.toggleDropdown(!1)},o=(e,t)=>{this.toggleDropdown(t)};this.onMounted=function(){this.initTips(),this.on("toggleDropdown",(e=>{this.toggleDropdown(e)})),this.observer&&(this.observer.on("toggleDropdown",o),this.observer.on("openDropdown",n),this.observer.on("closeDropdown",r)),flexbe.on("dropdownOpened",a),flexbe.on("closeDropdown",r)}.bind(this),this.onUpdated=function(){this.initTips()}.bind(this),this.onUnmounted=function(){this.state.showBalloon&&this.toggleDropdown(!1),this.observer&&(this.observer.off("toggleDropdown",o),this.observer.off("openDropdown",n),this.observer.off("closeDropdown",r)),flexbe.off("dropdownOpened",a),flexbe.off("closeDropdown",r)}.bind(this)})),riot3.tag2("user-avatar",'<div if="{imageSource != \'flexbe\'}" class="user-avatar--symbol font-ui"> <div class="background" riot-style="background: {symbolColor}"></div> <span class="symbol">{symbol}</span> </div> <div if="{imageUrl}" class="user-avatar--image" riot-style="background-image: url({imageUrl})"></div>',"",'class="user-avatar {opts.class}"',(function(e){const t={"#9578FF":/[a-e]/i,"#77C476":/[f-k]/i,"#F9C917":/[l-p]/i,"#FF6646":/[q-u]/i,"#3E5FFF":/.*/};let s=e.userMail||flexbe.vars.user.mail||"",i=e.userImage;const a=()=>{if(this.mail=s,this.symbol=String(s).substr(0,1).toUpperCase().replace("Z","N"),this.imageUrl=null,this.imageSource="none",i)if(i.id||i.img_id){this.imageUrl=pt(i,120),this.imageSource="flexbe";const e=new Image;e.onerror=()=>{this.imageUrl=null,this.imageSource="none",this.update()},e.src=this.imageUrl}else i.gravatar_id&&(this.imageUrl=`https://www.gravatar.com/avatar/${i.gravatar_id}?s=120&d=blank`,this.imageSource="gravatar");this.symbolColor=Object.entries(t).find((([e,t])=>!!t.test(this.symbol)&&e))[0],this.update()};this.onBeforeMount=function(){a(),flexbe.on("user-profile-change",((e={})=>{e.userMail&&(s=e.userMail),e.userImage&&(i=e.userImage),a()}))}.bind(this)})),riot3.tag2("flexbe-input",'<input if="{type !== \'textarea\'}" class="{inputClass} {opts.error ? state.errorLevel : \'\'}" type="{type}" checked="{getValue()}" disabled="{opts.disabled || opts.locked}" riot-value="{getValue()}" riot-name="{opts.name}" required="{opts.required}" placeholder="{opts.placeholder}" readonly="{opts.readonly}" autocomplete="{opts.suggestions ? \'off\' : opts.autocomplete}" min="{getMinValue()}" max="{getMaxValue()}" maxlength="{opts.maxLength}" ref="input"> <div if="{state.prefix || state.suffix}" class="flexbe-input__ghost {show: getValue() !== \'\'}"> <span class="affix prefix" if="{state.prefix}">{state.prefix}</span> <span class="affix value">{getValue()}</span> <span class="affix suffix" if="{state.suffix}">{state.suffix}</span> </div> <textarea if="{type === \'textarea\'}" class="{inputClass} {opts.error ? state.errorLevel : \'\'}" riot-name="{opts.name}" placeholder="{opts.placeholder}" autofocus="{opts.autofocus}" rows="{opts.rows}" cols="{opts.cols}" required="{opts.required}" readonly="{opts.readonly}" ref="textarea">{getValue()}</textarea> <span if="{[\'radio\', \'checkbox\', \'toggle\'].includes(type)}" class="{radioClass} {locked: opts.locked}"></span> <yield></yield> <div class="flexbe-input__addon" if="{opts.loading || opts.error && (opts.errorText || opts.errorTip)}"> <span class="error-text flexbe-error" if="{opts.error && opts.errorText}">{opts.errorText}</span> <span class="{state.errorLevel}-tip" data-is="flexbe-tooltip" if="{opts.error && opts.errorTip}" content="{opts.errorTip}"></span> <span if="{opts.loading}" data-is="proxy" is="flexbe-loader" done="{opts.done}"></span> </div>',"","class=\"flexbe-input flexbe-input--{type} {opts.class} {'auto-width': opts.calcMaxWidth}\"",(function(e){const t=Number.MAX_SAFE_INTEGER,s=this;this.mixin("inheritYield"),this.type=("number"===this.opts.type?"text":this.opts.type)||"text",this.inputPaddingWidth=12,this.letterWidth=1.3,this.state={get prefix(){return s.opts.dataPrefix??!1},get suffix(){return s.opts.dataSuffix??!1},get errorLevel(){return s.opts.errorLevel||"error"}},["checkbox","toggle","radio"].includes(this.type)?(this.inputClass=`flexbe-input__${this.type}`,this.radioClass=`flexbe-${this.type}`,"toggle"===this.type&&(this.type="checkbox")):(["textarea"].includes(this.type)?this.inputClass="flexbe-input__textarea":this.inputClass="flexbe-input__text",(e.styled??1)&&(this.inputClass+=" flexbe-input-styled")),Object.defineProperty(this,"value",{configurable:!0,enumerable:!1,get:()=>{const e=this.refs.input||this.refs.textarea;return e?e.value:""},set:e=>{const t=this.refs.input||this.refs.textarea;t&&(t.value=e)}}),this.shake=function(){const e="shake-animation";this.root.classList.remove(e),this.root.offsetWidth,this.root.classList.add(e)}.bind(this),this.focus=function(){const e=this.refs.input||this.refs.textarea;e&&e.focus()}.bind(this),this.getValue=function(){let e=null==this.opts.riotValue?this.opts.initialValue:this.opts.riotValue;return"checkbox"!==this.type&&"radio"!==this.type||(e=this.opts.checked),this.opts.model&&null==e&&(e=xt(this.tag,this.opts.model)),this.opts.htmlspecialchars&&(e=st(e,!0)),e}.bind(this),this.getMinValue=function(){if("number"===this.opts.type)return Number.isNaN(+this.opts.min)?-t:+this.opts.min}.bind(this),this.getMaxValue=function(){if("number"===this.opts.type)return Number.isNaN(+this.opts.max)?t:+this.opts.max}.bind(this),this.updateValue=function(e){let t;if("checkbox"===e.target.type&&"change"===e.type)e.target.value=!!e.target.checked;else{if(t=e.target.value,this.opts.pattern){const e=this.opts.pattern instanceof RegExp?this.opts.pattern:new RegExp(this.opts.pattern,"i"),s=new RegExp(e.source,"gi");t=((t.match(s)||[]).join("").match(e)||[]).join("")}if(this.opts.replace){const e=this.opts.replace instanceof RegExp?this.opts.replace:new RegExp(this.opts.replace,"g");t=t.replace(e,"")}if("function"==typeof this.opts.normalize&&(t=this.opts.normalize(t,e)),e.target.value!==t){const{selectionStart:s,selectionEnd:i}=e.target,a=String(t).length-String(e.target.value).length;this.mask?(this.mask.unmaskedValue=t,this.mask.cursorPos=s+a):(e.target.value=t,e.target.selectionStart=s+a,e.target.selectionEnd=i+a)}n(e.target.value)}}.bind(this),this.bubbleEvent=function(e){const s=e.type.toLowerCase(),i=`on${s}`;if("blur"===s&&"number"===this.opts.type){let s=e.target.value;const i=this.getMinValue(),a=this.getMaxValue(),n=+this.opts.step||1,r=this.opts.allowEmpty&&""===s,o=[t,-t].includes(i)?[t,-t].includes(a)?"":a:i;(!s&&!r||Number.isNaN(+s))&&(s=this.opts.defaultValue?+this.opts.defaultValue:o);const l=+String(s).replace(",",".");if(l<i?s=this.opts.defaultValue?+this.opts.defaultValue:i:l>a&&(s=this.opts.defaultValue?+this.opts.defaultValue:a),this.opts.strictStep&&(s=""===s?i:+(Math.round(s/n)*n).toFixed(3)),!isNaN(s)&&s!==e.target.value){e.target.value=+s;const t=new Event("input",{bubbles:!0,cancelable:!0}),i=new Event("change",{bubbles:!0,cancelable:!0});e.target.dispatchEvent(t),e.target.dispatchEvent(i)}}"function"==typeof this.opts[i]&&this.opts[i](e)}.bind(this),this.keydownHandler=function(e){const t=e.type.toLowerCase(),s=e.key&&e.key.toLowerCase(),i=e.code&&e.code.toLowerCase().replace("key",""),a=[e.metaKey&&"cmd",e.ctrlKey&&"ctrl",e.shiftKey&&"shift"].filter((e=>e)).join("_"),n=a?`on${t}:${a}_${s}`:`on${t}:${s}`,r=a?`on${t}:${a}_${i}`:`on${t}:${i}`,o=this.opts[n]||this.opts[r];if("function"==typeof o&&(o(e),e.preventDefault()),"Enter"===e.key&&"keydown"===t){const t=new Event("enter",{bubbles:!0,cancelable:!0});e.target.dispatchEvent(t)}if("number"===this.opts.type){const i=new Event("input",{bubbles:!0,cancelable:!0}),a=new Event("change",{bubbles:!0,cancelable:!0});if("keydown"!==t||e.ctrlKey||e.metaKey||1!==s.length){if("arrowup"===s||"arrowdown"===s){if(e.preventDefault(),"keyup"===t){const t=+this.opts.step||1,n="arrowup"===s?t:-1*t,r=this.getMinValue(),o=this.getMaxValue(),l=+e.target.value.replace(",","."),d=`${t}`.split(".")[1]?.length,c=`${l}`.split(".")[1]?.length,p=Math.max(d||0,c||0),u=!!p&&10**p,m=u?Math.round((l+n)*u)/u:l+n;+m>=r&&+m<=o&&(e.target.value=m,e.target.dispatchEvent(i),e.target.dispatchEvent(a))}}else if("keyup"===t){const t=e.target.value;e.target.value.includes(",")&&(e.target.value=e.target.value.replace(",",".")),t!==e.target.value&&e.target.dispatchEvent(i)}else if("Enter"===e.code){const t=e.target.value,s=this.getMinValue(),n=this.getMaxValue();Number.isNaN(+e.target.value)||e.target.value<s?e.target.value=s:this.opts.max&&e.target.value>n?e.target.value=n:this.opts.strictStep&&(e.target.value=+(Math.round(e.target.value/this.opts.step)*this.opts.step).toFixed(3)),t!==e.target.value&&(e.target.dispatchEvent(i),e.target.dispatchEvent(a))}}else{const t=!s.match(/[0-9-.,]/),i=!e.target.selectionStart&&!e.target.selectionEnd,a=!e.target.selectionStart&&!!e.target.selectionEnd,n="-"===s,r=!e.target.value.includes("-")||!a,o=[".",","].includes(s)&&(e.target.value.includes(".")||e.target.value.includes(",")||i),l=n&&r&&!i&&!a,d=e.target.value.includes("-")&&i;(t||o||l||d)&&e.preventDefault()}}}.bind(this),this.bindEvents=function(){const e=this.refs.input,t=this.refs.textarea;e&&e.addEventListener&&(e.addEventListener("input",this.updateValue),e.addEventListener("change",this.updateValue),e.addEventListener("keydown",this.keydownHandler),e.addEventListener("keyup",this.keydownHandler),e.addEventListener("focus",this.bubbleEvent),e.addEventListener("blur",this.bubbleEvent)),t&&t.addEventListener&&(t.addEventListener("keydown",this.keydownHandler),t.addEventListener("keyup",this.keydownHandler),t.addEventListener("focus",this.bubbleEvent),t.addEventListener("blur",this.bubbleEvent))}.bind(this),this.unbindEvents=function(){const e=this.refs.input,t=this.refs.textarea;e&&e.removeEventListener&&(e.removeEventListener("input",this.updateValue),e.removeEventListener("change",this.updateValue),e.removeEventListener("keydown",this.keydownHandler),e.removeEventListener("keyup",this.keydownHandler),e.removeEventListener("focus",this.bubbleEvent),e.removeEventListener("blur",this.bubbleEvent)),t&&t.removeEventListener&&(t.removeEventListener("keydown",this.keydownHandler),t.removeEventListener("keyup",this.keydownHandler),t.removeEventListener("focus",this.bubbleEvent),t.removeEventListener("blur",this.bubbleEvent))}.bind(this),this.onBeforeMount=function(){i()}.bind(this),this.onMounted=function(){if(l(),d(),a(),this.bindEvents(),this.opts.autofocus){const e="number"==typeof this.opts.autofocus?this.opts.autofocus:10;setTimeout((()=>{this.isMounted&&this.focus()}),e)}null!==e.tabindex&&$(this.root).find("input, textarea").attr("tabindex",e.tabindex),setTimeout((()=>{this.isMounted&&(r(),o(),n())}),0)}.bind(this),this.onUpdated=function(){this.isMounted&&(a(),n())}.bind(this),this.onBeforeUnmount=function(){this.unbindEvents()}.bind(this);const i=()=>{if(this.opts.maxLength&&this.opts.calcMaxWidth){const e=this.opts.maxLength,t=this.opts.dataPrefix?this.opts.dataPrefix.length:0,s=this.opts.dataSuffix&&this.opts.range?this.opts.dataSuffix.length/2:0;this.root.style=`width: calc(${2*this.inputPaddingWidth+2}px + ${(e+s+t)*this.letterWidth}ex);`}},a=$.debounce((()=>{const e=this.refs.input;if(e&&(i(),["text","email","password","tel","number"].includes(this.type))){const t=this.root.querySelector(".flexbe-input__addon:not(.hide)");e&&(e.style.paddingRight=t?`${t.offsetWidth+16}px`:"")}}),100),n=(e=this.value)=>{if(!this.state.prefix&&!this.state.suffix)return;$(this.root).find(".flexbe-input__ghost").find(".value").text(e)},r=()=>{if(this.state.prefix){const e=$(this.root).find("input"),t=this.root.className.includes("text-right");if(e.closest(".flexbe-color-input").length&&(this.inputPaddingWidth=10),!t){const t=2,s=this.state.prefix.length*this.letterWidth,i=`calc(${this.inputPaddingWidth+t}px + ${s}ex)`;e.css("padding-left",i)}}},o=()=>{if(this.state.suffix){const e=$(this.root).find("input");if(this.root.className.includes("text-right")){const t=$(this.root).find(".flexbe-input__ghost .suffix"),s=2,i=`${this.inputPaddingWidth+s+t.outerWidth()}px`;e.css("padding-right",i)}}},l=()=>{this.opts.mask&&be(["/_s/lib/imask/imask.min.js?v1"],(()=>{const e=this.refs.input;if(e&&this.isMounted){const t=Object.assign({},it(this.opts.mask));this.mask=new window.IMask.InputMask(e,t),e.mask=this.mask,this.opts.maskInit&&this.opts.maskInit(this.mask)}}))},d=()=>{this.opts.suggestions&&be(["/_s/lib/jquery/suggestions/suggestions-19.2.js"],(()=>{const e={token:"8b3ff999288e01d1a7eba18843d41a2aaf0a8468",addon:!1,hint:!1,noSuggestionsHint:!1,triggerSelectOnBlur:!1,minChars:2,geoLocation:"ADDRESS"===this.opts.suggestions.type};$(this.refs.input).suggestions(Object.assign({},e,this.opts.suggestions))}))}})),riot3.tag2("modal-block","<yield></yield>","",'class="modal-block {ui} {opts.class}"',(function(e){this.mixin("inheritYield");const t={onmount:()=>{},onunmount:()=>{},onclose:()=>{},setposition:()=>!0,class:"",...this.opts},s=$(document.body),i=document.createElement("div"),a=this.root,n=this.parent.root;this.params=t,this.overlayEl=i,this.contentEl=a,this.parentEl=n,this.$modal=!!e.modal&&e.modal.$overlay;const r=()=>{const e=$(this.root);let n,r;this.ui=e.closest(".admin-ui, .editor-ui").attr("class").split(" ").filter((e=>/\-ui/.test(e))).join(" "),i.tabIndex=0,i.setAttribute("class","overlay-area on"),i.contains(a)||i.appendChild(a),s.addClass("overflow"),s.append(i),$(i).on("mousedown mouseup pointerdown pointerup",(e=>{e.stopPropagation()})),$(i).on("pointerdown",(e=>{n=e.target===i,n&&e.preventDefault()})),$(i).on("pointerup",(e=>{r=e.target===i,r&&e.preventDefault()})),$(i).on("click",(e=>{n&&r&&(t.onclose(e),e.preventDefault(),e.stopPropagation()),n=!1,r=!1})),$(i).on("keydown",(e=>("function"==typeof t.keydown&&t.keydown(e),27!==e.which||(e.preventDefault(),e.stopImmediatePropagation(),t.onclose(e),!1)))).focus()},o=()=>t.setposition(this);this.onMounted=function(){if(this.on("modal_resized",(()=>{o()})),t.onmount?.(this),r(),o(),this.$modal){const e=`.modal_block_${Ge(5)}`,t=$(this.root);this.$modal.off(e),this.$modal.on(`hide${e}`,(()=>{const e=t.parent();t.hide(),e.removeClass("on")})),this.$modal.on(`show${e}`,(()=>{const e=t.parent();this.$modal.after(e),t.show(),e.addClass("on")})),this.$modal.on("updatePosition",(e=>{o()}))}}.bind(this),this.onUnmounted=function(){if(i){i.remove();const e=s.find(".overlay-area");e.length?e.last().focus():s.removeClass("overflow")}setTimeout((()=>{t.onunmount?.()}),16)}.bind(this)})),riot3.tag2("flexbe-select",'<div class="flexbe-selected {classList} {error: opts.error}" ref="selected" tabindex="0" onclick="{toggleList.bind(null, true)}" onkeydown="{keydownHandle}" riot-style="{selected && selected.style}"> <yield from="selected"></yield> <virtual if="{!isSelectedYield}"> <virtual if="{(opts.prefixIcon == null) ? selected.icon : opts.prefixIcon}"> <svg class="prefix flexbe-icon size-{tag.iconSize || selected.iconSize}" if="{opts.sprite}"> <use riot-xlink:href="{opts.prefixIcon || selected.icon}"></use> </svg> <img class="flexbe-icon size-{tag.iconSize || selected.iconSize}" if="{!opts.sprite}" riot-src="{opts.prefixIcon || selected.icon}" alt=""> </virtual> <virtual if="{!opts.rawValues}"> <span class="flexbe-text" if="{selected.title != null}">{selected.title}</span> <span class="flexbe-desc" if="{selected.desc}">{selected.desc}</span> </virtual> <virtual if="{opts.rawValues}"> <span class="flexbe-text" if="{selected.title != null}" data-is="raw" content="{selected.title}"></span> <span class="flexbe-desc" if="{selected.desc}" data-is="raw" content="{selected.desc}"></span> </virtual> </virtual> <span class="error-tip" data-is="flexbe-tooltip" if="{opts.error && opts.errorTip}" content="{opts.errorTip}"></span> <svg class="show-more" viewbox="0 0 10 6"> <path fill-rule="evenodd" clip-rule="evenodd" d="M5 4L9 0L10 1L5 6L0 1L1 0L5 4Z" fill="currentColor"></path> </svg> <select if="{native}" onchange="{selectNative}"> <option each="{option in this.values}" selected="{selected.value == option.value}" riot-value="{option.value || option.title}">{option.title}</option> </select> </div> <modal-block class="flexbe-select-content {classList} {contentClassList}" if="{!native && show}" ref="modal" list="{this.values}" current="{selected}" sprite="{opts.sprite}" raw-values="{rawValues}" setposition="{setPosition}" onselect="{selectCustom}" onclose="{selectCustom}" keydown="{keydownHandle}"> <ul class="flexbe-select-list scrollable-content" if="{!parent.isOptionsYield}"> <virtual each="{option in opts.list}"> <li data-value="{option.value}" class="flexbe-select-option {active: opts.current.value == option.value}" onclick="{opts.onselect}" riot-style="{option.style}" onpointerenter="{() => tag.opts?.optionHoverIn?.(option)}" onpointerleave="{() => tag.opts?.optionHoverOut?.(option)}"> <svg class="flexbe-icon size-{option.iconSize || tag.iconSize}" if="{opts.sprite && option.icon}"> <use riot-xlink:href="{option.icon}"></use> </svg> <img class="flexbe-icon size-{option.iconSize || tag.iconSize}" if="{!opts.sprite && option.icon}" riot-src="{option.icon}" alt=""> <virtual if="{!opts.rawValues}"> <span class="flexbe-text" if="{option.title != null}">{option.title}</span> <span class="flexbe-desc" if="{option.desc}">{option.desc}</span> </virtual> <virtual if="{opts.rawValues}"> <span class="flexbe-text" if="{option.title != null}" data-is="raw" content="{option.title}"></span> <span class="flexbe-desc" if="{option.desc}" data-is="raw" content="{option.desc}"></span> </virtual> <div data-is="proxy" is="flexbe-info-hover-tip" if="{option.hoverTip}" class="flexbe-select-option__hover-tip" data="{option.hoverTip}"></div> <div class="flexbe-select-option__recommend" if="{option.recommend}"> {tr(\'admin::settings::optimization::other::select::recommend\')} </div> </li> <div if="{option.divider}" class="flexbe-hr"></div> </virtual> </ul> <ul class="flexbe-select-list scrollable-content" if="{parent.isOptionsYield}"> <yield from="options"></yield> </ul> </modal-block>',"",'class="flexbe-select {opts.class}"',(function(e){let t=null;const s=(t="")=>{const s=e.emptyLabel??"";return this.values.find((e=>e.value==t))||{title:s,value:null}},i=i=>{i=i||e.riotValue,e.model&&null==i&&(i=xt(this.tag,e.model)),(null==this.selected||this.selected.value!==i&&null!=i)&&(t=s(i),this.selected=t)},a=()=>{const t=(e.list||[]).slice();this.values=t.filter((e=>e.enabled||null==e.enabled)).map((t=>(t="object"!=typeof t?{value:t}:{...t},e.sprite&&(t.icon||t.title||(t.icon=t.value),t.icon&&!/\.svg/.test(t.icon)&&(t.icon=`${e.sprite}#${t.icon}`)),"string"==typeof t.title&&(t.title=tr(t.title)),t.title||t.icon||(t.title=t.value),t)))};this.mixin("inheritYield"),this.mixin("initMobx"),this.isSelectedYield=/yield to="selected"/.test(this.__.innerHTML),this.isOptionsYield=/yield to="options"/.test(this.__.innerHTML),this.id="flexbe-select",this.show=!1,this.search="",this.selected=null,this.classList=(e.class||"").split(" ").filter((e=>/small|large|shadow|custom/.test(e))).join(" "),this.contentClassList=e.contentClass||"",this.iconSize=e.iconSize??16,this.list=e.list,this.native=e.native||!1,(window.navigator.userAgent.includes("iPad")||window.navigator.userAgent.includes("iPhone"))&&(this.native=!0),this.setPosition=function(e){const t=e.contentEl,s=t.getBoundingClientRect(),i=this.root.getBoundingClientRect(),a=document.body.offsetHeight;let n={width:`${i.width}px`,left:`${i.left}px`},r="";i.top+s.height>a?n.bottom=a-i.bottom+"px":n.top=i.top-5+"px",Object.keys(n).forEach((e=>r+=`${e}: ${n[e]};`)),t.setAttribute("style",r),this.scrollToActive(!0)}.bind(this),this.toggleList=function(e=!this.show){this.show!==e&&(this.show=e,this.update(),this.opts.onToggleList?.(this.show))}.bind(this),this.selectNative=function(e){e.preventDefault(),e.stopPropagation();const t=e.target.value,i=s(t,this.values);i&&(this.changeSelected(i),this.saveSelected(i,e)),this.toggleList(!1)}.bind(this),this.selectCustom=function(e){let t=e.item&&e.item.option;t||"click"!==e.type||(t=this.selected),t&&(this.changeSelected(t),this.saveSelected(t,e)),this.toggleList(!1)}.bind(this),this.keydownHandle=function(e){if(!e.ctrlKey&&!e.metaKey){if([27].includes(e.which))return this.changeSelected(t),this.saveSelected(t,e),!1;if([9].includes(e.which))return this.show&&(this.saveSelected(this.selected),this.toggleList(!1)),!0;if([13,32].includes(e.which))this.search="",this.show&&this.saveSelected(this.selected),this.toggleList(!this.show);else if([38,40].includes(e.which)){const t=38===e.which?-1:1,s=this.values.findIndex((e=>e.value==this.selected.value)),i=Math.max(0,Math.min(this.values.length-1,s+t)),a=this.values[i];this.search="",a&&(this.changeSelected(a),this.show||this.saveSelected(a,e))}else if(e.key&&1===e.key.length){clearTimeout(this.searchTimeout),this.search+=e.key;const t=this.search.replace("+","\\+").replace(".","\\.").replace("*","\\*").replace("/","\\/").replace("|","\\|").replace("\\","\\\\"),s=new RegExp("^"+t,"i"),i=this.values.find((e=>s.test(e.title)||s.test(e.value)));i?(this.changeSelected(i),this.show||this.saveSelected(i,e),this.searchTimeout=setTimeout((()=>{this.search=""}),1500)):this.search=""}else this.search="";this.scrollToActive(!1),e.preventDefault(),e.stopPropagation()}}.bind(this),this.scrollToActive=function(e){const t=this.refs.modal&&this.refs.modal.root;if(!this.show||!t)return;const s=t.querySelector(".scrollable-content"),i=s.querySelector(".active");if(!i)return;const a=i.offsetHeight,n=i.offsetTop,r=n+a,o=s.scrollTop,l=o,d=l+s.offsetHeight;if(e)s.scrollTop=n;else{const e=r-d;n-l<0?s.scrollTop=n:e>0&&(s.scrollTop=o+e)}}.bind(this),this.focus=function(){const e=this.refs.selected;e&&e.focus()}.bind(this),this.changeSelected=function(e){this.update({selected:e})}.bind(this),this.saveSelected=function(s=this.selected,i){t&&s&&t.value===s.value||(t=s,e.model&&_t(this.tag,e.model,s.value),"function"==typeof e.onchange&&e.onchange(s,i))}.bind(this),this.onBeforeMount=function(){a(),i(e.initialValue)}.bind(this),this.onMounted=function(){e.prefixTip&&Xt(this.root.querySelector(".prefix"),{interactive:!1,content:e.prefixTip}),flexbe.on(`closeDropdown.${this.id}`,(()=>this.toggleList(!1)))}.bind(this),this.onBeforeUnmount=function(){Kt(this.root.querySelector(".prefix")),flexbe.off(`closeDropdown.${this.id}`)}.bind(this),this.onBeforeUpdate=function(t){this.list===e.list&&this.list.length===this.values.length||a(),t&&t.selected||i()}.bind(this)})),riot3.tag2("flexbe-tooltip",'<svg if="{showIcon && !opts.icon}" class="tip-icon" viewbox="0 0 14 14"> <path d="M13 7C13 10.3137 10.3137 13 7 13C3.68629 13 1 10.3137 1 7C1 3.68629 3.68629 1 7 1C10.3137 1 13 3.68629 13 7ZM14 7C14 10.866 10.866 14 7 14C3.13401 14 0 10.866 0 7C0 3.13401 3.13401 0 7 0C10.866 0 14 3.13401 14 7ZM7.34234 8.57C7.34234 8.59 7.34234 8.64 7.35234 8.7H6.35234C6.35122 8.68537 6.35009 8.67099 6.34898 8.6568C6.34022 8.54486 6.33234 8.44424 6.33234 8.32C6.33234 7.72 6.56234 7.23 7.14234 6.81L7.60234 6.48C7.93234 6.24 8.07234 5.95 8.07234 5.61C8.07234 5.09 7.72234 4.6 6.99234 4.6C6.25234 4.6 5.86234 5.17 5.86234 5.74C5.86234 5.89 5.88234 6.08 5.92234 6.19L4.79234 6.11C4.75234 5.97 4.73234 5.81 4.73234 5.65C4.73234 4.65 5.48234 3.56 6.99234 3.56C8.47234 3.56 9.27234 4.54 9.27234 5.56C9.27234 6.35 8.85234 6.91 8.27234 7.32L7.84234 7.62C7.51234 7.85 7.34234 8.18 7.34234 8.57ZM6.86234 10.87C6.45234 10.87 6.13234 10.54 6.13234 10.14C6.13234 9.74 6.45234 9.4 6.86234 9.4C7.26234 9.4 7.59234 9.74 7.59234 10.14C7.59234 10.54 7.26234 10.87 6.86234 10.87Z"></path> </svg> <svg if="{showIcon && opts.icon}" class="flexbe-icon size-{opts.size || 14}"> <use riot-xlink:href="{opts.icon}"></use> </svg> <div class="tip-content" ref="content" if="{showYield && showIcon}"> <yield></yield> </div> <virtual if="{showYield && !showIcon}"> <yield></yield> </virtual>',"",'class="flexbe-tooltip {opts.class}"',(function(e){let t;this.mixin("inheritYield"),this.type=e.type||"help",this.showIcon="Q"===this.root.tagName,this.showYield=!this.showIcon||null==e.content&&null==e.dataTip,this.instance=null;const s=()=>{let s=e.content??e.dataTip;null==s&&(s=this.refs.content?.innerHTML),(t||s)&&s!==t&&(t=s,this.instance=flexbe.tip.init(this.root,Object.assign({},e,{content:s})))};this.onMounted=function(){s()}.bind(this),this.onUpdated=function(){s()}.bind(this)})),riot3.tag2("flexbe-button-copy",'<virtual if="{!copied}"> <svg class="flexbe-icon size-{iconSize}" if="{showIcon || opts.showIconCopy}"> <use riot-xlink:href="{sprite}#copy"></use> </svg> <span class="flexbe-text" if="{showText}">{copyText}</span> </virtual> <virtual if="{copied}"> <svg class="flexbe-icon size-{iconSize}" if="{showIcon || opts.showIconDone}"> <use riot-xlink:href="{sprite}#done"></use> </svg> <span class="flexbe-text" if="{showText}">{doneText}</span> </virtual>',"",'onclick="{onClick}" class="{getButtonClass()}" state="{copied ? \'done\' : \'copy\'}"',(function(e){this.animate=!1,this.copied=!1,this.sprite=at("core"),this.showIcon=null==e.showIcon||e.showIcon,this.showText=e.showText,this.copyText=e.copyText||tr("main::button::copy"),this.doneText=e.doneText||tr("main::button::copy_done_state"),this.iconSize=e.showText?14:16,this.getButtonClass=function(){const t="string"!=typeof e.copyClass?"is-secondary filled":e.copyClass,s="string"!=typeof e.doneClass?"is-secondary filled":e.doneClass;return`flexbe-button-copy ${`${e.class||"flexbe-button"} ${this.copied?s:t} ${this.animate?"animate":""}`}`}.bind(this),this.onClick=function(t){if(this.copied)return;const s=e.prepend||"",i=e.append||"",a=e.value||e.riotValue||"";Hi.setData(`${s}${a}${i}`),this.update({copied:!0,animate:!0}),setTimeout((()=>{this.update({copied:!1})}),2e3)}.bind(this),this.onMounted=function(){this.showText||flexbe.tip.init(this.root,{content:this.copyText})}.bind(this)})),riot3.tag2("flexbe-buttons-line",'<span class="flexbe-button {getButtonClass(item)}" each="{item in state.values}" key="value" data-tip="{item.tip}" disabled="{item.disabled}" onclick="{select.bind(this, item)}"> <svg class="flexbe-icon size-{(item.iconWidth || item.iconHeight) ? \'auto\' : (item.iconSize || 16)} {item.color}" riot-width="{item.iconWidth || 16}" riot-height="{item.iconHeight || 16}" if="{item.icon}"> <use riot-xlink:href="{item.icon}"></use> </svg> <span class="flexbe-text" if="{item.title}"> {item.title} </span> <div data-is="flexbe-hover-tip" if="{item.hover}" data="{item.hover}"></div> </span> <span if="{state.hasCustom}" class="flexbe-button custom-settings {getCustomButtonClass()}" data-tip="{tr(\'editor::button_line::settings_tip\')}" onclick="{select.bind(this, { value: \'custom\' })}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#settings"></use> </svg> </span> <div if="{state.hasCustom}" class="flexbe-buttons-line__custom-area {show: state.isCustom}"> <virtual if="{state.isCustom}"> <yield></yield> </virtual> </div>',"","class=\"flexbe-buttons-line role-{state.role} {'has-custom': state.hasCustom} {opts.class}\"",(function(e){this.mixin("inheritYield"),this.mixin("initMobx");const t={tabs:{active:["filled","is-dark","not-hover"],default:["filling","is-light"]},selector:{active:["filled","is-primary"],default:["filled","is-light"]},radio:{active:["filled","is-light"],default:["filling","is-light"]},buttons:{active:["is-light","filled","rounded"],default:["is-light","bordered","rounded"]}},s=this;this.sprite=at("editor_settings"),this.state={_isCustom:!1,hasCustom:e.hasCustom||!1,role:e.role||"radio",get values(){const e=s.props;return bt(e.list).filter((e=>e&&(e.enabled||null==e.enabled))).map((t=>("object"!=typeof t&&(t={value:t}),e.sprite&&(t.icon||t.title||(t.icon=t.value),t.icon&&!/\.svg/.test(t.icon)&&(t.icon=`${e.sprite}#${t.icon}`)),"string"==typeof t.title&&(t.title=tr(t.title)),t.tip=tr(t.tip),t.title||t.icon||(t.title=t.value),t)))},get selected(){return s.props.riotValue??this.values[0].value},get outOfRange(){return!this.values.some((e=>e.value===this.selected))},get isCustom(){return this.hasCustom&&(this._isCustom||"custom"===this.selected||this.outOfRange)||!1}},this.getButtonClass=function(s){let i=[];const a=!this.state.isCustom&&this.state.selected===s.value;let n=t[this.state.role];return a&&e.activeClasses&&(n.active=e.activeClasses),s.hover&&i.push("tooltip-origin"),n&&(a?(i.push(...n.active),i.push("active")):i.push(...n.default)),e.buttonClass&&i.push(e.buttonClass),"right"===s.order&&i.push("order-right"),i.join(" ")}.bind(this),this.getCustomButtonClass=function(){let s=[];const i=this.state.hasCustom&&this.state.isCustom,a=t[this.state.role];return i?(s.push(...a.active),s.push("active")):s.push(...a.default),e.buttonClass&&s.push(e.buttonClass),s.join(" ")}.bind(this),this.select=function(t,s){if(t.disabled)return;if(!e.enableActiveValueSelect&&this.state.selected===t.value&&!this.state.isCustom)return;this.state._isCustom="custom"===t.value;const i=this.opts.onChange??this.opts.onchange;"function"==typeof i&&i(t,s),this.update()}.bind(this),this.onBeforeUpdate=function(){this.state._isCustom=this.state.isCustom}.bind(this),this.onMounted=function(){this.state._isCustom=this.state.isCustom,flexbe.tip.initArea(this.root,{position:"top",...e.tipOptions||{}})}.bind(this)})),riot3.tag2("flexbe-sort-list","<yield></yield>","","",(function(e){this.mixin("inheritYield");const t=e.onstart||e.sortstart||e.sortStart||function(){},s=e.onsort||e.sortmove||e.sortMove||function(){},i=e.onend||e.sortend||e.sortEnd||function(){},a=e.itemSelector||".field-item",n=e.handleSelector||!1,r=Object.assign({item:"field-list__sortable-item",ghost:"field-list__sortable-ghost",drag:"field-list__sortable-drag",chosen:"field-list__sortable-chosen",placeholder:"field-list__sortable-placeholder",sortableActive:"field-list--sortable"},e.classes);this.onMounted=function(){if("undefined"==typeof Sortable)return!1;const o=e.listSelector?this.root.querySelector(e.listSelector):this.root,l=$(o),d=Object.assign({delay:0,scroll:!0,animation:{duration:300,easing:"ease"},ghostAnimation:{duration:180,easing:"ease"},fallbackOpacity:1,fallbackScale:1,fallbackTolerance:1,forceFallback:!0,disableLayerCheck:!0,draggable:a,handle:n,ghostClass:r.ghost,dragClass:r.drag,chosenClass:r.chosen,placeholderClass:r.placeholder,onStart:e=>{const s=l.find(a);l.addClass(r.sortableActive),s.addClass(r.item),this._$modalOverlays=$(".overlay-area:not(.on)").addClass("on"),t(e),Qe()},onUnchoose:e=>{const t=l.find(a);l.removeClass(r.sortableActive),t.removeClass(r.item)},onMoveEnd:e=>{s(e)},onEnd:e=>{this._$modalOverlays&&(this._$modalOverlays.removeClass("on"),delete this._$modalOverlays),i(e)}},e.options);new Sortable(o,d)}.bind(this)})),riot3.tag2("flexbe-button-upload",'<label class="file-select flexbe-button status-{tag.status} {getButtonClasslist()}"> <input if="{isInputAlive}" type="file" class="file-input" ref="fileInput" name="file" disabled="{tag.status === \'pending\'}" onchange="{onFilesChanged}" title=""> <div if="{tag.props.tip && !isInputAlive}" data-is="flexbe-tooltip" interactive="{tag.props.tipInteractive}" delay="{[0, 500]}" content="{tag.props.tip}"> <div class="upload-text {show: (!tag.showLoader || tag.status === \'default\')}"> <svg class="flexbe-icon size-14" if="{tag.showIcon}"> <use riot-xlink:href="{tag.props.icon ? tag.props.icon : \'/_s/images/editor/editor_background.svg#upload\'}"></use> </svg> <span class="flexbe-text">{tag.buttonTitle}</span> </div> </div> <div if="{!tag.props.tip || (tag.props.tip && isInputAlive)}" class="upload-text {show: (!showLoader || tag.status === \'default\')}"> <svg class="flexbe-icon size-14" if="{showIcon}"> <use riot-xlink:href="{tag.props.icon ? tag.props.icon : \'/_s/images/editor/editor_background.svg#upload\'}"></use> </svg> <span class="flexbe-text">{buttonTitle}</span> </div> <div data-is="proxy" is="flexbe-loader" class="upload-loader show" if="{showLoader && (tag.status === \'pending\' || tag.status === \'success\')}" progress="{totalProgress}" show-indicator="{true}" done="{tag.status === \'success\'}"> </div> </label> <q if="{tag.props.tip && isInputAlive}" data-is="flexbe-tooltip" content="{tag.props.tip}"></q>',"",'class="flexbe-button-upload {getOuterClasslist()}"',(function(e){this.mixin("initMobx");const t=this;let s,i={};this.status="default",this.sizeLimit=!!t.props.sizeLimit&&+this.sizeLimit,this.isMulti=!!t.props.multi,this.isInputAlive=!0,this.totalProgress=!1,this.showLoader=void 0===t.props.showLoader||t.props.showLoader,this.showIcon=void 0===t.props.showIcon||+t.props.showIcon,this.buttonTitle=tr(t.props.title||t.props.buttonTitle||"main::button::upload"),this.state={get dropZone(){return t.props.dropZone}},this.watch={"state.dropZone":[()=>this.initDropZone(),{delay:4}]},this.clearStatus=function({force:e}){clearTimeout(s);s=setTimeout((()=>{this.update({status:"default"})}),e?0:1500)}.bind(this),this.getOuterClasslist=function(){return`${t.props.overlayMode?"pos-overlay":""} ${t.props.overlayCentered?"centered":""} ${t.props.class||""}`}.bind(this),this.getButtonClasslist=function(){const e=t.props.commonClass||"filled size-m block",s=t.props.regularClass||"is-primary",i=t.props.successClass||"is-success";return`${e} ${"success"===this.status?i:s}`}.bind(this),this.getTotalProgress=function(){const e=Object.keys(i),t=e.length;if(!t)return!1;const s=e.reduce(((e,t)=>e+i[t]),0);return Math.round(Math.min(100,Math.max(0,s/t)))}.bind(this),this.recreateInput=function(){if(this.reInit)return!1;this.update({isInputAlive:!1}),this.reInit=!0,setTimeout((()=>{this.update({isInputAlive:!0}),this.initUploader(),this.reInit=!1}),50)}.bind(this),this.onFilesChanged=function(){if(this.filesChanged)return!1;this.filesChanged=!0,setTimeout((()=>{this.filesChanged=!1}),100)}.bind(this),this.initUploader=function(){this.uploader=pi.init({input:this.refs.fileInput,multi:this.isMulti,type:t.props.fileType||"image",acceptType:t.props.accept,extensions:t.props.extensions,url:t.props.url,sizeLimit:t.props.sizeLimit,onSelect:(e,s)=>{t.props.onuploadstart&&"function"==typeof t.props.onuploadstart&&t.props.onuploadstart(e,s),this.showLoader&&(this.status="pending",i[e]=0,this.totalProgress=this.getTotalProgress(),this.update())},onProgress:(e,s)=>{s<100&&(t.props.onuploadprogress&&"function"==typeof t.props.onuploadprogress&&t.props.onuploadprogress(e,s),this.showLoader&&(i[e]=s,this.totalProgress=this.getTotalProgress(),this.update()))},onComplete:(e,s,a)=>{$(this.refs.fileInput).val(""),t.props.onupload&&"function"==typeof t.props.onupload&&t.props.onupload(e,s,a),this.showLoader&&(i[e]=100,this.totalProgress=this.getTotalProgress(),this.totalProgress>=100&&(i={},this.status="success",this.update(),this.recreateInput(),this.clearStatus({force:!1})))},onError:(e,s)=>{$(this.refs.fileInput).val(""),t.props.onerror&&"function"==typeof t.props.onerror&&t.props.onerror(e,s),this.showLoader&&(i[e]=100,this.totalProgress=this.getTotalProgress(),this.totalProgress>=100&&(i={},this.status="error",this.update(),this.recreateInput(),this.clearStatus({force:!0})))}})}.bind(this),this.initDropZone=function(){const e=this.state.dropZone;this.dropZoneData&&this.dropZoneData.unbind(),e&&(this.dropZoneData=ji.bindZone(e,{handlePaste:!0,uploaderOptions:!1,needLock:e=>[...e.dataTransfer.items].some((e=>"file"!==e.kind||!this.uploader.checkAcceptType(e.type))),onDrop:e=>{if(!e||!e.files)return!1;const t=new DataTransfer;e.files.forEach((e=>{t.items.add(e.initialData)})),$(this.refs.fileInput).prop("files",t.files).trigger("change")}}))}.bind(this),this.onMounted=function(){this.initUploader(),this.initDropZone()}.bind(this),this.onBeforeUnmount=function(){this.dropZoneData&&this.dropZoneData.unbind()}.bind(this)})),riot3.tag2("flexbe-copyable",'<div data-is="flexbe-input" class="{opts.inputClass || \' \'}" ref="input" type="{type}" checked="{opts.checked}" disabled="{opts.disabled}" autofocus="{opts.autofocus}" riot-value="{opts.riotValue}" name="{opts.name}" error="{opts.error}" error-text="{opts.errorText}" error-tip="{opts.errorTip}" required="{opts.required}" placeholder="{opts.placeholder}" readonly="{opts.readonly}" autocomplete="{opts.autocomplete}" pattern="{opts.pattern}" min="{opts.min}" max="{opts.max}" maxlength="{opts.maxlength}" tabindex="{opts.tabindex}" data-prefix="{opts.prefix}" data-suffix="{opts.suffix}"> <div class="flexbe-input__addon"> <div data-is="flexbe-button-copy" class="flexbe-button small" copy-class="style-text filling" done-class="is-secondary filled" prepend="{tag.opts.prepend}" append="{tag.opts.append}" riot-value="{tag.opts.riotValue || tag.opts.placeholder}" show-text="{false}" show-icon="{true}"></div> </div> </div>',"",'class="flexbe-copyable {opts.class}"',(function(e){})),riot3.tag2("flexbe-hover-tip",'<div class="flexbe-hover-tip-content" if="{isLoaded}"> <img if="{data.image}" riot-src="{data.image}" riot-style="display: block; width: {data.width}px; height: {data.height}px;"> <lottie-player if="{data.lottie}" riot-src="{data.lottie}" background="transparent" speed="1" riot-style="width: {data.width}px; height: {data.height}px;" loop autoplay></lottie-player> <span if="{data.text}">{data.text}</span> </div>',"",'class="flexbe-hover-tip"',(function(e){this.data="object"==typeof e.data?e.data:{image:e.data},this.data={image:!1,lottie:!1,width:160,height:this.data.lottie?100:"auto",position:"top",animation:"fade",theme:"dark",...this.data},this.isLoaded=!1,this.bindTipster=function(){let e=$(this.root).closest(".tooltip-origin");e.length&&(e=$(this.root).parent()),e.tooltipster({contentAsHTML:!0,trigger:"hover",theme:`tooltipster-${this.data.theme}`,position:this.data.position,animation:this.data.animation,functionInit:(e,t)=>{const s=$(this.root).find(".flexbe-hover-tip-content").html();e.content(s)}})}.bind(this),this.on("mount",(()=>{if(this.data.image){const e=new Image;e.onload=()=>{this.update({isLoaded:!0}),e.remove(),setTimeout((()=>{this.bindTipster()}),100)},e.src=this.data.image}else this.update({isLoaded:!0}),this.bindTipster()}))})),riot3.tag2("flexbe-input-range",'<div if="{tag.meta.startMark}" class="legend-mark start mr10"> <virtual if="{tag.meta.startMark.icon}"> <svg class="flexbe-icon size-{tag.meta.startMark.size || \'16\'}"> <use riot-xlink:href="{tag.meta.sprite}#{tag.meta.startMark.icon}"></use> </svg> </virtual> <virtual if="{!tag.meta.startMark.icon}"> {tag.meta.startMark} </virtual> </div> <div class="track track_{tag._riot_id} {\'has-values\': tag.meta.hasValues}" onkeydown="{keyDown}" onpointerover="{pointerOver}" onpointerdown="{pointerDown}" tabindex="0"> <div class="marks" if="{tag.meta.marksList.length}"> <div each="{mark, index in tag.meta.marksList}" key="{mark.value}" class="mark {last: index === (tag.meta.marksList.length - 1)}" riot-style="left: {mark.position}%" data-value="{mark.value}" data-tip="{mark.tip}"> <div if="{mark.showMark}" class="range-mark"></div> <div if="{mark.label}" class="range-label"> {mark.label} </div> </div> </div> <div if="{tag.meta.showRail}" class="rail"></div> <div class="thumb thumb_{tag._riot_id}"> <span class="thumb-circle"></span> </div> </div> <div if="{tag.meta.endMark}" class="legend-mark end ml10"> <virtual if="{tag.meta.endMark.icon}"> <svg class="flexbe-icon size-{tag.meta.endMark.size || \'16\'}"> <use riot-xlink:href="{tag.meta.sprite}#{tag.meta.endMark.icon}"></use> </svg> </virtual> <virtual if="{!tag.meta.endMark.icon}"> {tag.meta.endMark} </virtual> </div> <label data-is="flexbe-input" class="flexbe-input-in-range ml10 light {meta.size || \'small\'}" if="{meta.showInput}" disabled="{meta.disabled}" min="{meta.inputMin}" max="{meta.inputMax}" step="{meta.step}" strict-step="{true}" data-suffix="{meta.suffix}" data-prefix="{meta.prefix}" riot-value="{state.localValue}" max-length="{meta.maxLength}" calc-max-width="{meta.maxLength > 0}" range="{true}" onchange="{inputChange}" type="{\'number\'}"></label>',"",'class="flexbe-input-range {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={localValue:null,get value(){const e=t.props;return Number(e.value??e.riotValue??t.meta.inputMax)}},this.meta={sprite:e.sprite,get opts(){return t.props||{}},get withTransition(){return this.opts.withTransition??!0},get path(){return[...this.opts.path||[]]},get name(){return this.opts.name},get size(){return this.opts.size},get disabled(){return Boolean(this.opts.disabled)||!1},get min(){if(null!=this.opts.min)return+this.opts.min;if(this.marks&&this.marks.length){const e=this.marks[0];return e instanceof Object?+e.value:+e}return 0},get max(){if(null!=this.opts.max)return+this.opts.max;if(this.marks&&this.marks.length){const e=this.marks[this.marks.length-1];return e instanceof Object?+e.value:+e}return 100},get inputMin(){return+this.opts.inputMin||this.min},get inputMax(){return+this.opts.inputMax||this.max},get maxLength(){return+this.opts.maxLength||Math.max(`${this.inputMax}`.length,`${this.inputMin}`.length)||2},get prefix(){return this.opts.prefix||""},get suffix(){return this.opts.suffix||""},get step(){return+this.opts.step||(this.opts.marks?"custom":1)},get showInput(){return Boolean(this.opts.showInput)},get showMarks(){return Boolean(this.opts.showMarks)},get showLabels(){return Boolean(this.opts.showLabels)},get showTips(){return Boolean(this.opts.showTips)},get marks(){return this.opts.marks},get startMark(){return this.opts.startMark},get endMark(){return this.opts.endMark},get commitOnMove(){return Boolean(this.opts.commitOnMove)},get marksList(){let e=this.marks&&this.marks.factor,s=[];if(Array.isArray(this.marks))s=this.marks.map((e=>t.getMarkObj(e)));else if(e||this.showMarks||this.showLabels){e||(e=1);const i=Math.ceil((this.max-this.min)/(this.step*e))+1,a=this.showMarks||this.marks&&this.marks.factor;s=new Array(i).fill(0).map(((s,i)=>{const n=+(+(i*this.step*e).toFixed(3)+this.min).toFixed(3);return t.getMarkObj({value:n,showMark:a})}))}const i=s.every((e=>null!=e.position)),a=s.every((e=>!Number.isNaN(+e.value)));return i||(s=a?s.map((e=>({...e,position:+(100*(e.value-this.min)/(this.max-this.min)).toFixed(2)}))):s.map(((e,t)=>({...e,position:t/(s.length-1)*100})))),s},get availableValuesList(){if("custom"===this.step)return this.marksList.map((e=>({value:e.value,position:e.position})));const e=Math.ceil((this.max-this.min)/this.step)+1;return new Array(e).fill(0).map(((e,t)=>{const s=+(t*this.step).toFixed(3),i=+(100*s/(this.max-this.min)).toFixed(2);return{value:+(s+this.min).toFixed(3),position:i}}))},get extendedValuesList(){if("custom"===this.step)return this.marksList.map((e=>({value:e.value,position:e.position})));const e=Math.ceil((this.inputMax-this.inputMin)/this.step)+1;return new Array(e).fill(0).map(((e,t)=>{const s=+(t*this.step).toFixed(3),i=+(s+this.inputMin).toFixed(3);let a;return a=i<=this.min?0:i>=this.max?100:+(100*(s-(this.min-this.inputMin))/(this.max-this.min)).toFixed(2),{value:i,position:a}}))},get hasValues(){return this.marksList.some((e=>e.label))||this.showLabels},get showRail(){return this.marks&&this.marks instanceof Array?this.marks.some((e=>e.label))&&this.marks.every((e=>!e.showMark)):!this.marks&&!this.showMarks},get renderOnUpdate(){return Boolean(this.opts.renderOnUpdate)}},this.$tooltip=null,this.$thumb=null,this.$track=null,this.$rail=null,this._dragStarted=!1,this._updateTooltipRAF=null,this._dragStartedTimer=null,this._showTipTimer=null,this._eventId=`range_${Ge(5)}`,this.getMarkObj=function(e){e instanceof Object||(e={value:e,showMark:!0});let t={...e};return this.meta.showLabels&&null==t.label&&(t.label=this.getFormattedValue(t.value)),this.meta.showTips&&null==t.tip&&(t.tip=this.getFormattedValue(t.value)),this.meta.showLabels&&t.label===t.tip&&delete t.tip,t}.bind(this),this.updateCoords=function(){const e=this.$track[0].getBoundingClientRect(),t=this.$thumb[0].getBoundingClientRect(),s=Math.floor(e.x),i=Math.floor(e.width),a=Math.floor(t.x),n=Math.floor(t.y),r=Math.floor(t.width),o=Math.floor(t.height);this.trackCoords={trackX:s,trackWidth:i,thumbX:a,thumbY:n,thumbWidth:r,thumbHeight:o}}.bind(this),this.getFormattedValue=function(e=this.state.localValue){let t="",s="";return this.meta.prefix&&(t=`${this.meta.prefix} `),this.meta.suffix&&(s=` ${this.meta.suffix}`),`${t}${e}${s}`}.bind(this),this.getPositionFromValue=function(e){const t=this.meta.availableValuesList.find((t=>t.value===e));return t?t.position:this.findClosestMark({value:e}).position}.bind(this),this.getPositionFromClientX=function(e){const{trackX:t,trackWidth:s}=this.trackCoords;return De(0,(e-t)/s*100,100).toFixed(1)}.bind(this),this.setThumbPosition=function(e){if(!this.isMounted)return;const{trackWidth:t}=this.trackCoords,s=this.getPositionFromValue(e),i=Math.round(s/100*t);this.$thumb.css("transform",`translateX(${i}px)`),this.$rail.css("transform",`scaleX(${s/100})`)}.bind(this),this.findClosestMark=function(e,t=[...this.meta.extendedValuesList]){if(e&&e.event){const s=this.getPositionFromClientX(e.event.clientX);return t.sort(((e,t)=>Math.abs(e.position-s)-Math.abs(t.position-s)))[0]}return e&&e.value?t.sort(((t,s)=>Math.abs(t.value-e.value)-Math.abs(s.value-e.value)))[0]:e&&e.position?t.sort(((t,s)=>Math.abs(t.position-e.position)-Math.abs(s.position-e.position)))[0]:t[0]}.bind(this),this.inputChange=function(e){const t=this.findClosestMark({value:+e.target.value}).value;e.preventUpdate=!0,e.target.value=t,this.updateValues(t),this.commit(t)}.bind(this),this.updateValues=function(e){null!=e&&(this.state.localValue=+e.toFixed(3)),this.isMounted&&($(this.root).find(".flexbe-input__text").val(this.state.localValue),$(this.root).find(".affix.value").text(this.state.localValue),this.setThumbPosition(e))}.bind(this),this.unbindEvents=function(){$document.off(`.${this._eventId}`)}.bind(this),this.keyDown=function(e){if(e.preventUpdate=!0,this.meta.disabled)return;let t,s=this.meta.step,i=this.meta.step;if("custom"===this.meta.step){const e=[...this.meta.availableValuesList],t=e.length-1,a=e.map((e=>e.value)).indexOf(this.state.localValue),n=a>0?a-1:0,r=a<t?a+1:t;s=+Math.abs(e[r].value-this.state.localValue).toFixed(3),i=+Math.abs(e[n].value-this.state.localValue).toFixed(3)}"ArrowLeft"===e.key?t=Math.max(this.meta.min,+(this.state.localValue-i).toFixed(3)):"ArrowRight"===e.key&&this.state.localValue!==this.meta.max?t=Math.min(this.meta.max,+(this.state.localValue+s).toFixed(3)):"Home"===e.key?(e.preventDefault(),t=this.meta.min):"End"===e.key&&(e.preventDefault(),t=this.meta.max),null!=t&&(this.setThumbPosition(t),this.commit(t,e.type))}.bind(this),this.pointerOver=function(e){if(e.preventUpdate=!0,clearTimeout(this._showTipTimer),this.meta.disabled||!this.meta.showTips||this._dragStarted)return;const t=$(e.target).closest(".mark"),s=$(e.target).closest(".thumb");let i,a;if(t.length)i=t,a=t.attr("data-tip");else{if(!s.length)return;i=s,a=this.getFormattedValue}this._showTipTimer=setTimeout((()=>{this.showTooltip(i,a)}),50)}.bind(this),this.pointerDown=function(e){if(e.preventUpdate=!0,e.preventDefault(),clearTimeout(this._showTipTimer),clearTimeout(this._dragStartedTimer),this.meta.disabled||1!==e.which)return;const t=$(e.target).closest(".thumb"),s=$(e.target).closest(".mark"),i=s.length,a=t.length;let n;this.$track.focus(),this.updateCoords(),this._dragStarted=!0,this._dragStartedTimer=setTimeout((()=>{this.$thumb.addClass("active"),this.destroyTooltip(!1),this.showTooltip(this.$thumb,this.getFormattedValue)}),50),n=i?+s.attr("data-value"):this.findClosestMark({event:e},[...this.meta.availableValuesList]).value,a||(this.setThumbPosition(n),this.updateValues(n)),$document.on(`pointermove.${this._eventId}.thumb`,$.throttle((e=>this.pointerDrag(e)),60)),$document.on(`pointerup.${this._eventId}.thumb`,$.throttle((e=>this.pointerUp(e)),60))}.bind(this),this.pointerDrag=function(t){if(t.preventDefault(),!this._dragStarted)return;const s=this.findClosestMark({event:t},[...this.meta.availableValuesList]).value;this.meta.commitOnMove?this.commit(s,"input"):this.updateValues(s),"function"==typeof e.onchange&&e.onchange(s)}.bind(this),this.pointerUp=function(t){t.preventDefault(),$document.off(`.${this._eventId}.thumb`),clearTimeout(this._dragStartedTimer);const s=this.findClosestMark({event:t},[...this.meta.availableValuesList]).value;this._dragStarted=!1,this.$thumb.removeClass("active"),this.destroyTooltip(!1),this.setThumbPosition(s),this.commit(s,"change"),"function"==typeof e.onchange&&e.onchange(s)}.bind(this),this.showTooltip=function(e,t){e&&e.length&&this.meta.showTips&&(this.$tooltip||(this.$tooltip=$('<div class="range-tip"></div>')),this.$tooltip.toggleClass("animated",!this._dragStarted),0===this.$tooltip.closest("body").length&&$("body").append(this.$tooltip),this.updateTooltip(e,t),this.$tooltip.addClass("show"),this._updateTooltipRAF&&this._updateTooltipRAF(),this._updateTooltipRAF=St((()=>{this.updateTooltip(e,t)}),60),$document.on(`pointermove.tip-${this._riot_id}`,(t=>{this._dragStarted||$(t.target).closest(e).length||this.destroyTooltip(!0)})),$(window).on(`blur.tip-${this._riot_id}`,(e=>{this.destroyTooltip(!0)})))}.bind(this),this.updateTooltip=function(e,t=this.getFormattedValue){const{top:s,left:i,width:a,height:n}=e[0].getBoundingClientRect();this.$tooltip.attr("data-tip",it(t));const r=this.$tooltip.innerWidth(),o=this.$tooltip.innerHeight();this.$tooltip.css({left:i-+(r/2).toFixed(0)+ +(a/2).toFixed(0)+"px",top:s-o-+(n/2).toFixed(0)+"px"})}.bind(this),this.destroyTooltip=function(e=!0){$document.off(`pointermove.tip-${this._riot_id}`),$(window).off(`blur.tip-${this._riot_id}`),clearTimeout(this._showTipTimer),this._updateTooltipRAF&&this._updateTooltipRAF(),e?(null!=this.$tooltip&&(this.$tooltip.removeClass("show"),this.$tooltip=null),setTimeout((()=>{$(".range-tip").remove()}),50)):$(".range-tip").remove()}.bind(this),this.commit=function(t,s="change"){this.state.value===t&&"change"!==s||(this.updateValues(t),e.commit?.({value:t,path:this.meta.path,reason:s}))}.bind(this),this.onBeforeUpdate=function(){this.state.value!==this.state.localValue&&this.updateValues(this.state.value)}.bind(this),this.onUpdated=function(){const e=this.trackCoords;requestAnimationFrame((()=>{this.updateCoords(),this.trackCoords.trackWidth===e.trackWidth&&this.trackCoords.trackX===e.trackX||this.setThumbPosition(this.state.localValue)}))}.bind(this),this.onBeforeMount=function(){this.updateValues(this.state.value)}.bind(this),this.onMounted=function(){this.$track=$(this.root).find(`.track_${this._riot_id}`),this.$thumb=$(this.root).find(`.thumb_${this._riot_id}`),this.$rail=this.$track.find(".rail"),this.updateCoords(),this.updateValues(this.state.localValue),setTimeout((()=>{this.updateCoords(),this.updateValues(this.state.localValue),this.meta.withTransition&&this.root.classList.add("range-transition")}),50)}.bind(this),this.onBeforeUnmount=function(){this.unbindEvents(),this.destroyTooltip()}.bind(this)})),riot3.tag2("flexbe-input-tags",'<div class="flexbe-input-tags-wrapper flexbe-input-styled {error: state.error, focus: state.focus}" readonly="{state.readonly}" disabled="{state.disabled}" allow-spaces="{state.allowSpaces}"> <div class="flexbe-tag is-light {opts.tagClass}" each="{item, index in value}" data-id="{index}"> <span class="flexbe-tag--text"> {item} </span> <span class="flexbe-tag--icon flexbe-tag--remove" onclick="{removeTag.bind(tag, index)}" if="{!state.readonly && !state.disabled}"> <span class="flexbe-close bold"></span> </span> </div> <div data-is="flexbe-input" class="{opts.inputClass || \' \'}" ref="input" readonly="{state.readonly}" show="{(value.length < state.maxTags)}" type="{type}" checked="{opts.checked}" disabled="{opts.disabled}" autofocus="{opts.autofocus}" riot-value="{opts.inputValue}" styled="{false}" name="{opts.name}" error="{state.error}" error-text="{opts.errorTip ? false : state.error}" error-tip="{opts.errorTip ? state.error : false}" required="{opts.required}" placeholder="{opts.placeholder}" autocomplete="{opts.autocomplete}" pattern="{opts.pattern}" min="{opts.min}" max="{opts.max}" maxlength="{opts.maxlength}" onkeydown="{addTag}" onblur="{onBlur}" onfocus="{onFocus}"></div> <yield></yield> </div>',"",'class="flexbe-input-tags {opts.class}"',(function(e){this.mixin("inheritYield"),this.extendFromProps={riotValue:{name:"value",formatter:e=>Array.isArray(e)?[...e]:[]}},this.state={readonly:e.readonly??!1,disabled:e.disabled??!1,commaSave:e.commaSave??!1,allowDuplicates:e.allowDuplicates??!1,allowSpaces:e.allowSpaces??!1,maxTags:e.maxTags??1/0,blurAdd:e.blurAdd??!0,error:!1},this.addTag=function(t){t.preventUpdate=!0;const{allowDuplicates:s,allowSpaces:i}=this.state,a=this.refs.input,n=a.value;let r=i?n:n.trim();const o=!n||!r.trim().length,l=this.checkSaveKeys(t),d=o&&8===t.keyCode;this.state.error&&this.setError(!1),d?this.startRemove():(this.undoRemove(),l&&!o&&(!s&&this.value.includes(n)||(e.addHandler?.(r),e.change&&(this.value.push(r),a.value=""),e.change?.(this.value))))}.bind(this),this.startRemove=function(){const e=this.value.length-1,t=this.root.querySelector(`div[data-id="${e}"]`),s=t&&t.classList.contains("start-remove");!t||s?s&&this.removeTag(e):t.classList.add("start-remove")}.bind(this),this.undoRemove=function(){this.root.querySelectorAll(".flexbe-tag").forEach((e=>e.classList.remove("start-remove")))}.bind(this),this.removeTag=function(t,s){"object"==typeof s&&s.stopPropagation();const i=this.value.splice(t,1);e.removeHandler?.({index:t,removed:i[0],list:this.value}),e.change?.(this.value)}.bind(this),this.onFocus=function(t){t.preventUpdate=!0,this.state.focus=!0,this.update(),e.onfocus?.(t)}.bind(this),this.onBlur=function(t){t.preventUpdate=!0,this.state.blurAdd&&this.addTag(t),this.state.focus=!1,this.state.error=!1,this.update(),e.onblur?.(t)}.bind(this),this.setError=function(e){this.state.error=e,this.update()}.bind(this),this.checkSaveKeys=function(e){const{commaSave:t}=this.state,s="blur"===e.type,i=13===e.keyCode,a=t&&","===e.key;return s||i||a}.bind(this)}));const Mi={css:null,exports:{showSlot:!1,isSlotUpdate:!1,onBeforeMount(){this.showSlot=!!this.slots.length},onBeforeUpdate(){this.showSlot=!!this.slots.length},onMounted(){try{this._mountRiotTag()}catch(e){console.error("Can't render riot v3 component",this,{err:e})}},onUnmounted(){this._unmountRiotTag()},onUpdated(){if(!this.tag||this.isSlotUpdate)return;const e=this.props.component||this.props.dataIs;this.componentName!==e?(this._unmountRiotTag(),this._mountRiotTag()):this._updateRiotTag()},_mountRiotTag(){const e=this.getOpts();Array.from(this.root.attributes).forEach((e=>{["class","id","is","style","type"].includes(e.name)||this.root.removeAttributeNode(e)})),this.slot=this.showSlot?this.$('[ref="proxy-slot"]'):null,$(this.slot).before('<mark class="default"></mark>').detach(),this.componentName=this.props.component||this.props.dataIs,this.tag=riot3.mount(this.root,this.componentName,e)[0],this.tag.on("before-mount",(()=>this._updateSlots())),this.tag.on("updated",(()=>this._updateSlots()))},_unmountRiotTag(){this.tag&&(this.tag.unmount(!0),this.tag=null)},_updateRiotTag(){yt(this.tag.opts,this.getOpts()),this.tag.update()},_updateSlots(){if(!this.showSlot||!this.slot)return;const e=$(this.root).find('mark.default, [ref="proxy-slot"]');e.is(this.slot)||e.replaceWith(this.slot),this.isSlotUpdate=!0,this.update(),this.isSlotUpdate=!1},getOpts(){const e={...this.props};return delete e.is,delete e.component,null!=e.value&&(e.riotValue=e.value),e}},template:(e,t,s,i)=>e('<div expr364="expr364" ref="proxy-slot"></div>',[{type:s.IF,evaluate:e=>e.showSlot,redundantAttribute:"expr364",selector:"[expr364]",template:e('<slot expr365="expr365"></slot>',[{type:s.SLOT,attributes:[{type:t.ATTRIBUTE,name:"context",evaluate:e=>e.tag}],name:"default",redundantAttribute:"expr365",selector:"[expr365]"}])}]),name:"proxy"};e(Mi.name,Mi);const Di={css:null,exports:{onBeforeMount(){this.updateContent()},onBeforeUpdate(){this.updateContent()},updateContent(){const e=this.props.content;"object"==typeof e&&null!=e&&(e.jquery||e.nodeType)?($(this.content).is(e)||$(this.root).html(e),this.content=e):this.content!==e&&(this.content=e,this.root.innerHTML=e,Object.entries(this.props).forEach((([e,t])=>{null!==t&&"object"!=typeof t&&"string"==typeof t&&this.root.setAttribute(e,t)})),this.root.removeAttribute("content"))}},template:null,name:"raw"};let Vi;e(Di.name,Di);let Oi=!1;const zi={css:null,exports:i({eventId:`${Date.now()}_${Math.floor(1e3*Math.random())}`,_clickoutEventId:null,menuOverlay:null,menuEl:null,setup(e,{initMobx:t,provide:s}){const i=e.props.observer||At({});t(),s("contextmenu",this),s("observer",i),this.observer=i,this.state={show:!1,component:null,props:null},this.meta={get for(){return e.props.for},get context(){var t;const s=e.props.context||(null==(t=this.for)?void 0:t.ownerDocument)||document;return s.documentElement?s.body:s},get contextOnDocument(){return!!this.context.documentElement||this.context===this.document.body},get document(){return this.context.documentElement?this.context:this.context.ownerDocument},get window(){return this.document.defaultView}}},onBeforeMount(){flexbe.on(`closeDropdown.${this.eventId}`,this.hide.bind(this))},onMounted(){this.meta.for&&this.initArea(this.meta.for,this.props)},onBeforeUnmount(){var e;flexbe.off(`closeDropdown.${this.eventId}`),null==(e=this.$area)||e.off(`contextmenu.${this.eventId}`),this.hide()},initArea(e,{filter:t,prevent:s,onPointerDown:i}){this.$area=$(e),this.$area.on(`pointerdown.${this.eventId}`,(e=>{if(2!==e.button)return;if(!(!this.state.show||!$(e.target).closest(".context-menu-overlay").length&&!$(e.target).closest(this.menuEl).length))return void(Oi=!0);null==i||i(e);if(!1!==(null==t?void 0:t(e))){e.stopPropagation(),e.stopImmediatePropagation(),Oi=!0;(null==s?void 0:s(e))||this.show({event:e,x:e.clientX,y:e.clientY})}})),this.$area.on(`contextmenu.${this.eventId}`,(e=>{Oi&&uiStore.view.mode.isEditor&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),Oi=!1)}))},setPosition({x:e,y:t,from:s="top-left"}){const i=10,a=this.meta.document,n=this.meta.window,r=this.meta.context,o=this.meta.contextOnDocument,l=this.menuEl,d=r.documentElement?a.body:r;d.appendChild(this.menuOverlay),d.appendChild(this.menuEl);const c=d.getBoundingClientRect(),p=l.getBoundingClientRect();switch(s){case"top-center":e-=p.width/2;break;case"top-right":e-=p.width}const u=t-c.y,m=e-c.x,h=Math.min(0,c.width-(m+p.width)-i,o?n.innerWidth-(e+p.width)-i:0),g=Math.min(0,c.height-(u+p.height)-i,o?n.innerHeight-(t+p.height)-i:0);l.style.top=`${Math.max(u+g,i)}px`,l.style.left=`${Math.max(m+h,i)}px`},show({event:e,...t}){if(!(Date.now()-Vi<50))return this.state.component=it(this.props.component,[e]),this.state.props=it(this.props.props,[e]),this.state.show=!0,this.update(),this.menuEl=this.menuEl||this.root.querySelector(".context-menu"),this.menuOverlay=this.menuOverlay||$('<div class="context-menu-overlay"></div>')[0],!!this.menuEl&&(this.setPosition(t),"function"==typeof this.props.onOpen&&this.props.onOpen(e),this.observer.trigger("contextmenuOpened",{contextmenu:this}),this._clickoutEventId=$(this.menuEl).clickOut((e=>{setTimeout((()=>this.hide({event:e})),5)})),this._escDisposer=fs.register([{hotkeys:["ESCAPE"],handlerDown:e=>this.hide(e),options:{preventDefault:!0,stopPropagation:!0,allowRepeat:!1,runFirst:!0}}]),!0)},hide({event:e}={}){return!!this.state.show&&(this._clickoutEventId&&$document.off(this._clickoutEventId),this._escDisposer&&this._escDisposer(),$(this.meta.context).off(`wheel.${this.eventId}`),$(this.menuOverlay).remove(),$(this.menuEl).remove(),this.menuEl=null,this.menuOverlay=null,Qe(),Vi=Date.now(),this.state.show=!1,this.update(),this.observer.trigger("contextmenuClosed",{contextmenu:this}),"function"==typeof this.props.onClose&&this.props.onClose(e),!0)},destroy(){this.unmount()}}),template:(e,t,s,i)=>e('<div expr366="expr366" class="context-menu flexbe-balloon-content"></div>',[{type:s.IF,evaluate:e=>e.state.show,redundantAttribute:"expr366",selector:"[expr366]",template:e('<div expr367="expr367"></div><slot expr368="expr368"></slot>',[{type:s.IF,evaluate:e=>e.state.component,redundantAttribute:"expr367",selector:"[expr367]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>e.state.component,slots:[],attributes:[{type:t.ATTRIBUTE,name:"contextmenu",evaluate:e=>e},{type:t.ATTRIBUTE,name:"observer",evaluate:e=>e.observer},{type:t.ATTRIBUTE,name:null,evaluate:e=>e.state.props}]}])},{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr368",selector:"[expr368]"}])}]),name:"contextmenu"};e(zi.name,zi);const qi={css:null,exports:i({setup(e,{initMobx:t}){t({autoUpdate:!0}),this.state={dropdownOpened:!1,get icon(){return e.props.icon},get iconSize(){return e.props.iconSize},get text(){return e.props.text},get tip(){return e.props.tip},get showLoader(){return"pending"===this.loadingState||"success"===this.loadingState},get showIcon(){return("side"!==this.loadingStyle||!this.showLoader)&&!!this.icon},get showDropdown(){return e.slots.find((e=>"dropdown"===e.id))},get showDropdownArrow(){return this.showDropdown&&!1!==e.props.showArrow},get loadingStyle(){return e.props.loadingStyle||"over"},get loadingClass(){return e.props.loadingClass},get loadingState(){const t=e.props.loading;return!0===t||"pending"===t||"loading"===t?"pending":("done"===t||"success"===t)&&"success"},get loadingProgress(){return e.props.loadingProgress},get className(){return["flexbe-button",this.showLoader?`loading loader-${this.loadingStyle}`:"",this.dropdownOpened?"active":"",e.props.class].join(" ")},get dropdownProps(){return t=e.props,Object.entries(t).reduce(((e,[t,s])=>{if(t.startsWith("dropdown")){const i=t.replace("dropdown-","").replace("dropdown","");e[i.charAt(0).toLowerCase()+i.slice(1)]=s}return e}),{});var t}}},onConnected(){this.props.autofocus&&this.root.focus()},onMounted(){this.updateTip()},onUpdated(){this.updateTip()},onBeforeUnmount(){Kt(this.root)},onOpenDropdown(){var e,t;this.state.dropdownOpened=!0,null==(e=(t=this.props).dropdownOpen)||e.call(t)},onCloseDropdown(){var e,t;this.state.dropdownOpened=!1,null==(e=(t=this.props).dropdownClose)||e.call(t)},updateTip(){const e=this.state.tip||"";if(e){const t=this.root.matches(":hover");Xt(this.root,{show:t,interactive:!1,position:"top",content:e})}else Kt(this.root)},handleKeydown(e){"Enter"!==e.code&&"Space"!==e.code||(this.root.click(),e.preventDefault(),e.stopPropagation())}}),template:(e,t,s,i)=>e('<span expr369="expr369" is="flexbe-loader"></span><svg expr370="expr370" is="flexbe-icon"></svg><span expr371="expr371" class="flexbe-text"></span><slot expr372="expr372" name="default"></slot><svg expr373="expr373" class="dropdown-arrow" viewBox="0 0 10 6"></svg><div expr374="expr374" is="proxy" data-is="dropdown" position="center"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.className},{type:t.EVENT,name:"onkeydown",evaluate:e=>e.handleKeydown}]},{type:s.IF,evaluate:e=>e.state.showLoader,redundantAttribute:"expr369",selector:"[expr369]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.loadingClass},{type:t.ATTRIBUTE,name:"progress",evaluate:e=>e.state.loadingProgress},{type:t.ATTRIBUTE,name:"done",evaluate:e=>"success"===e.state.loadingState}]}])},{type:s.IF,evaluate:e=>e.state.showIcon,redundantAttribute:"expr370",selector:"[expr370]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"size",evaluate:e=>e.state.iconSize},{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.icon}]}])},{type:s.IF,evaluate:e=>e.state.text,redundantAttribute:"expr371",selector:"[expr371]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.text}]}])},{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr372",selector:"[expr372]"},{type:s.IF,evaluate:e=>e.state.showDropdownArrow,redundantAttribute:"expr373",selector:"[expr373]",template:e('<path d="M5 4L9 0L10 1L5 6L0 1L1 0L5 4Z"/>',[])},{type:s.IF,evaluate:e=>e.state.showDropdown,redundantAttribute:"expr374",selector:"[expr374]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<slot expr375="expr375" name="dropdown"></slot>',bindings:[{type:s.SLOT,attributes:[],name:"dropdown",redundantAttribute:"expr375",selector:"[expr375]"}]}],attributes:[{type:t.ATTRIBUTE,name:"autohide",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!0},{type:t.ATTRIBUTE,name:null,evaluate:e=>e.state.dropdownProps},{type:t.EVENT,name:"onopen",evaluate:e=>e.onOpenDropdown},{type:t.EVENT,name:"onclose",evaluate:e=>e.onCloseDropdown}]}])}]),name:"flexbe-button"};e(qi.name,qi);const Gi={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get href(){const{href:t,sprite:s,icon:i}=e.props;return t||`${s}#${i}`},get size(){var t;return null!=(t=e.props.size)?t:16}}}},template:(e,t,s,i)=>e('<use expr376="expr376"/>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-icon ",e.state.size?"size-"+e.state.size:""," ",e.props.class].join("")}]},{redundantAttribute:"expr376",selector:"[expr376]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.href}]}]),name:"flexbe-icon"};e(Gi.name,Gi);const Xi={css:null,exports:i({setup(e,{initMobx:t}){t(),this.state={$input:null,get type(){var t;return null!=(t=e.props.type)?t:"toggle"},get checked(){return!!e.props.checked},get disabled(){return!!e.props.disabled},get locked(){return!!e.props.locked}},this.meta={get className(){return["flexbe-input",`flexbe-input--${e.state.type}`,e.props.class].join(" ")}}},onMounted(){setTimeout((()=>{this.state.$input=$(this.root).find("input")}),0)}}),template:(e,t,s,i)=>e('<input expr377="expr377" type="checkbox"/><span expr378="expr378"></span><slot expr379="expr379"></slot>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.meta.className}]},{redundantAttribute:"expr377",selector:"[expr377]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-input__",e.state.type].join("")},{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.checked},{type:t.VALUE,evaluate:e=>e.state.checked},{type:t.ATTRIBUTE,name:"tabindex",evaluate:e=>e.props.tabindex},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.disabled||e.state.locked}]},{redundantAttribute:"expr378",selector:"[expr378]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-",e.state.type,e.state.locked?" locked":""].join("")}]},{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr379",selector:"[expr379]"}]),name:"flexbe-checkbox"};e(Xi.name,Xi);const Ki={css:null,exports:{setup(e){this.state={get type(){let t=e.props.type;return t=e.props.icon?"icon":"Q"===e.root.tagName?"help":"custom",t}}},initTip(){var e;const t=null!=(e=this.props.content)?e:this.props.tip;"string"==typeof t?this._instance=Xt(this.root,{...this.props,content:t}):Kt(this.root)},shouldUpdate(e,t){var s,i;if("custom"===this.state.type)return!0;return(null!=(s=t.content)?s:t.tip)!==(null!=(i=e.content)?i:e.tip)},onMounted(){this.initTip()},onUpdated(){this.initTip()},onBeforeUnmount(){Kt(this.root)}},template:(e,t,s,i)=>e('<svg expr380="expr380" class="tip-icon" viewBox="0 0 14 14"></svg><svg expr381="expr381"></svg><template expr383="expr383"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-tooltip ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>"help"===e.state.type,redundantAttribute:"expr380",selector:"[expr380]",template:e('<path d="M13 7C13 10.3137 10.3137 13 7 13C3.68629 13 1 10.3137 1 7C1 3.68629 3.68629 1 7 1C10.3137 1 13 3.68629 13 7ZM14 7C14 10.866 10.866 14 7 14C3.13401 14 0 10.866 0 7C0 3.13401 3.13401 0 7 0C10.866 0 14 3.13401 14 7ZM7.34234 8.57C7.34234 8.59 7.34234 8.64 7.35234 8.7H6.35234C6.35122 8.68537 6.35009 8.67099 6.34898 8.6568C6.34022 8.54486 6.33234 8.44424 6.33234 8.32C6.33234 7.72 6.56234 7.23 7.14234 6.81L7.60234 6.48C7.93234 6.24 8.07234 5.95 8.07234 5.61C8.07234 5.09 7.72234 4.6 6.99234 4.6C6.25234 4.6 5.86234 5.17 5.86234 5.74C5.86234 5.89 5.88234 6.08 5.92234 6.19L4.79234 6.11C4.75234 5.97 4.73234 5.81 4.73234 5.65C4.73234 4.65 5.48234 3.56 6.99234 3.56C8.47234 3.56 9.27234 4.54 9.27234 5.56C9.27234 6.35 8.85234 6.91 8.27234 7.32L7.84234 7.62C7.51234 7.85 7.34234 8.18 7.34234 8.57ZM6.86234 10.87C6.45234 10.87 6.13234 10.54 6.13234 10.14C6.13234 9.74 6.45234 9.4 6.86234 9.4C7.26234 9.4 7.59234 9.74 7.59234 10.14C7.59234 10.54 7.26234 10.87 6.86234 10.87Z"/>',[])},{type:s.IF,evaluate:e=>"icon"===e.state.type,redundantAttribute:"expr381",selector:"[expr381]",template:e('<use expr382="expr382"/>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-icon size-",e.props.size||14].join("")}]},{redundantAttribute:"expr382",selector:"[expr382]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.props.icon}]}])},{type:s.IF,evaluate:e=>"custom"===e.state.type,redundantAttribute:"expr383",selector:"[expr383]",template:e('<slot expr384="expr384"></slot>',[{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr384",selector:"[expr384]"}])}]),name:"flexbe-tooltip"};e(Ki.name,Ki);const Wi={css:null,exports:i({setup(e,{initMobx:t}){t(),this.state={isCustom:!1,get selectedValue(){return e.props.value}},this.meta={get hasCustom(){return e.props.hasCustom},get class(){return e.props.class},get role(){var t;return null!=(t=e.props.role)?t:"radio"},get sprite(){return e.props.sprite},get values(){const t=e.props.list.filter((e=>e.enabled||null==e.enabled)).map((e=>("object"!=typeof e&&(e={value:e}),this.sprite&&(e.icon||e.title||(e.icon=e.value),e.icon&&!/\.svg/.test(e.icon)&&(e.icon=`${this.sprite}#${e.icon}`)),"string"==typeof e.title&&(e.title=tr(e.title)),e.tip=tr(e.tip),e.title||e.icon||(e.title=e.value),e)));return this.hasCustom&&t.push({value:"custom",tip:tr("editor::button_line::settings_tip")}),t},get rootStyles(){return null!=e.props.gap?`--buttonsGap: ${+e.props.gap}px`:null},settingSprite:at("editor_settings"),buttonStates:{tabs:{active:["filled","is-dark","not-hover"],default:["filling","is-light"]},selector:{active:["filled","is-primary"],default:["filled","is-light"]},radio:{active:["filled","is-light"],default:["filling","is-light"]},buttons:{active:["is-light","filled","rounded"],default:["is-light","bordered","rounded"]},toggle:{active:["filled","is-light"],default:["filled","is-light"]}},get needInitTip(){return this.values.some((e=>e.tip))}},this.watch={"state.isCustom":()=>this.update()}},onBeforeMount(){this.checkActiveButton()},onMounted(){this.initTooltip()},onUpdated(){this.initTooltip()},select(e,t){var s;const i=null!=(s=this.props.onChange)?s:this.props.onchange;if(!e.disabled){if("custom"===e.value)this.state.isCustom=!0;else if(this.state.isCustom=!1,this.state.selectedValue===e.value)return;"function"==typeof i&&i(e,t)}},onHoverIn(e,t){this.props.onHoverIn&&this.props.onHoverIn(e,t)},onHoverOut(e,t){this.props.onHoverOut&&this.props.onHoverOut(e,t)},getComponentClass(){const e={"has-custom":this.meta.hasCustom};return this.meta.class&&"string"==typeof this.meta.class&&(e[this.meta.class]=!0),"string"==typeof this.meta.role&&(e[`role-${this.meta.role}`]=!0),this.classNames(e)},getIconStyle(e){const t=this.isActive(e)?e.iconColorActive:e.iconColor;return t?`color: ${t}`:""},getIconClass(e){const t=[];let s="size-";return e.color&&t.push(e.color),e.iconWidth||e.iconHeight?s+="auto":s+=e.iconSize||16,t.push(s),t.join(" ")},getButtonClass(e){const t=[],s=this.meta.buttonStates[this.meta.role],i=this.isActive(e);return s&&(i?t.push(...s.active):t.push(...s.default)),this.props.buttonClass&&t.push(this.props.buttonClass),"custom"===e.value&&t.push("custom-settings"),i&&(t.push("active"),this.props.activeButtonClass&&t.push(this.props.activeButtonClass)),"right"===e.order&&t.push("order-right"),e.hover&&t.push("tooltip-origin"),t.join(" ")},isActive(e){let t;return t=null!=e.active?!!e.active:"custom"===e.value?this.state.isCustom:!this.state.isCustom&&this.state.selectedValue===e.value,t},checkActiveButton(){this.state.isCustom||(this.state.isCustom="custom"===this.state.selectedValue||!this.meta.values.find((e=>e.value===this.state.selectedValue)))},initTooltip(){var e;this.meta.needInitTip&&Wt(this.root,{position:"top",...(null==(e=this.props)?void 0:e.tipOptions)||{}})}}),template:(e,t,s,i)=>e('<span expr385="expr385"></span><div expr392="expr392"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-buttons-line ",e.getComponentClass()].join("")},{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.meta.rootStyles}]},{type:s.EACH,getKey:e=>e.item.value,condition:null,template:e('<svg expr386="expr386" class="flexbe-icon size-16"></svg><svg expr388="expr388"></svg><span expr390="expr390" class="flexbe-text"></span><div expr391="expr391" is="flexbe-hover-tip"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button ",e.getButtonClass(e.item)].join("")},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.item.disabled},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.item.tip},{type:t.EVENT,name:"onpointerenter",evaluate:e=>e.onHoverIn.bind(e,e.item)},{type:t.EVENT,name:"onpointerleave",evaluate:e=>e.onHoverOut.bind(e,e.item)},{type:t.EVENT,name:"onclick",evaluate:e=>t=>e.select(e.item,t)}]},{type:s.IF,evaluate:e=>"custom"===e.item.value&&!e.item.icon,redundantAttribute:"expr386",selector:"[expr386]",template:e('<use expr387="expr387"/>',[{redundantAttribute:"expr387",selector:"[expr387]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.settingSprite,"#settings"].join("")}]}])},{type:s.IF,evaluate:e=>e.item.icon,redundantAttribute:"expr388",selector:"[expr388]",template:e('<use expr389="expr389"/>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-icon ",e.getIconClass(e.item)].join("")},{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.getIconStyle(e.item)},{type:t.ATTRIBUTE,name:"width",evaluate:e=>e.item.iconWidth||16},{type:t.ATTRIBUTE,name:"height",evaluate:e=>e.item.iconHeight||16}]},{redundantAttribute:"expr389",selector:"[expr389]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.item.icon}]}])},{type:s.IF,evaluate:e=>e.item.title,redundantAttribute:"expr390",selector:"[expr390]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.item.title].join("")}]}])},{type:s.IF,evaluate:e=>e.item.hover,redundantAttribute:"expr391",selector:"[expr391]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-hover-tip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.item.hover}]}])}]),redundantAttribute:"expr385",selector:"[expr385]",itemName:"item",indexName:null,evaluate:e=>e.meta.values},{type:s.IF,evaluate:e=>e.meta.hasCustom,redundantAttribute:"expr392",selector:"[expr392]",template:e('<template expr393="expr393"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-buttons-line__custom-area ",e.state.isCustom?"show":""].join("")}]},{type:s.IF,evaluate:e=>e.state.isCustom,redundantAttribute:"expr393",selector:"[expr393]",template:e('<slot expr394="expr394"></slot>',[{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr394",selector:"[expr394]"}])}])}]),name:"flexbe-buttons-line"};e(Wi.name,Wi);const Zi={css:null,exports:{sortable:null,sortableList:null,setup(e){this.state={get draggable(){return e.props.itemSelector||".field-item"},get handle(){return e.props.handleSelector||!1},get listSelector(){return e.props.listSelector}},this.meta={classes:{item:"field-list__sortable-item",ghost:"field-list__sortable-ghost",drag:"field-list__sortable-drag",chosen:"field-list__sortable-chosen",placeholder:"field-list__sortable-placeholder",sortableActive:"field-list--sortable",...e.props.classes}}},onMounted(){this.initSortable()},initSortable(){if(!("Sortable"in window))return!1;this.sortableList=this.state.listSelector?this.$(this.state.listSelector):this.root;const e={delay:0,scroll:!0,animation:{duration:300,easing:"ease"},ghostAnimation:{duration:180,easing:"ease"},fallbackOpacity:1,fallbackScale:1,fallbackTolerance:1,forceFallback:!0,disableLayerCheck:!0,draggable:this.state.draggable,handle:this.state.handle,ghostClass:this.meta.classes.ghost,dragClass:this.meta.classes.drag,chosenClass:this.meta.classes.chosen,placeholderClass:this.meta.classes.placeholder,onStart:this.sortStart.bind(this),onUnchoose:this.onUnchoose.bind(this),onMoveEnd:this.sortMove.bind(this),onEnd:this.sortEnd.bind(this),...this.props.options||{}};this.sortable=new window.Sortable(this.sortableList,e)},sortStart(...e){const t=$(this.sortableList),s=t.find(this.state.draggable);t.addClass(this.meta.classes.sortableActive),s.addClass(this.meta.classes.item),this._$modalOverlays=$(".overlay-area:not(.on)").addClass("on"),"function"==typeof this.props.sortStart&&this.props.sortStart(...e),Qe()},sortMove(...e){"function"==typeof this.props.sortMove&&this.props.sortMove(...e)},sortEnd(...e){this._$modalOverlays&&(this._$modalOverlays.removeClass("on"),delete this._$modalOverlays),"function"==typeof this.props.sortEnd&&this.props.sortEnd(...e)},onUnchoose(){const e=$(this.sortableList),t=e.find(this.state.draggable);e.removeClass(this.meta.classes.sortableActive),t.removeClass(this.meta.classes.item)}},template:(e,t,s,i)=>e('<slot expr395="expr395"></slot>',[{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr395",selector:"[expr395]"}]),name:"flexbe-sort-list"};e(Zi.name,Zi);const Yi={css:null,exports:i({setup(e){const t=e.props.type||"text";this.refs={input:null,ghost:null,ghostValue:null,runners:[]},this.state={type:t,inputType:"number"===t?"text":t,snapPositionRunnerX:0,startPositionRunnerX:null,startValueRunner:null,altIsPressed:!1,get inputValue(){const t=e.refs.input||this;return null==t.value||""===t.value?this.placeholder:String(t.value)},get value(){return e.normalizeValue(e.props.value)},get showLoading(){return e.props.loading},get showErrorText(){const{error:t,errorText:s}=e.props;return t&&s},get showErrorTip(){const{error:t,errorTip:s}=e.props;return t&&s},get showInfoAddon(){return this.showLoading||this.showErrorText||this.showErrorTip},get gluedSuffix(){return e.meta.classNames.includes("glued-suffix")},get showPrefix(){return!(!this.prefix&&!this.prefixIcon)},get showSuffix(){return!(!this.gluedSuffix&&this.showInfoAddon)&&!(!this.suffix&&!this.suffixIcon)},get placeholder(){var t;return null!=(t=e.props.placeholder)?t:""},get prefix(){var t;return null!=(t=e.props.prefix)?t:""},get suffix(){return e.props.suffix},get autoselect(){var t;return null!=(t=e.props.autoselect)?t:"number"===this.type},get prefixTip(){return e.props.prefixTip},get prefixIcon(){return e.props.prefixIcon},get prefixIconSize(){return e.props.prefixIconSize||16},get suffixIcon(){return e.props.suffixIcon},get allowArrowRunner(){var t;return null==(t=e.props.allowArrowRunner)||t},get disableRunner(){var t;return null!=(t=e.props.disableRunner)?t:e.props.disabled},get allowRunner(){return"object"==typeof uiStore&&!this.disableRunner&&"number"===this.type},get inputRunning(){return this.altIsPressed&&this.allowRunner},get runner(){return!!this.allowRunner&&(this.showPrefix?"prefix":this.showSuffix?"suffix":!!this.allowArrowRunner&&"arrow")},get runnerSnapMultipleOf(){return e.props.runnerSnapMultipleOf},get runnerSnapValues(){return e.props.runnerSnapValues||[]},get runnerSnapDuration(){return e.props.runnerSnapDuration||3},get inputClassName(){var t;let s=`flexbe-input__${this.inputType}`;return(null==(t=e.props.styled)||t)&&(s+=" flexbe-input-styled"),e.props.error&&(s+=` ${this.errorLevel}`),"textarea"===this.type&&(s+=" scrollable-content"),s},get errorLevel(){return e.props.errorLevel||"error"}},this.meta={get classNames(){const t=["flexbe-input",e.props.class];return t.push(`flexbe-input--${e.state.type}`),e.state.inputRunning&&t.push("cursor-ew-resize"),t.join(" ")},get min(){if("number"!==e.state.type)return;const t=+e.props.min;return Number.isNaN(t)?-Number.MAX_SAFE_INTEGER:t},get max(){if("number"!==e.state.type)return;const t=+e.props.max;return Number.isNaN(t)?Number.MAX_SAFE_INTEGER:t},get step(){return+e.props.step||1},get altStep(){return+e.props.altStep||10*this.step},get runnerFactor(){return+e.props.runnerFactor||2},get strictStep(){var t;return null!=(t=e.props.strict)?t:!!e.props.step},get supportMath(){return"number"===e.state.type&&(e.props.math||!1)},get supportFloat(){return"number"===e.state.type&&(!this.strictStep||this.step%1||this.altStep%1)}}},onMounted(){this.refs.input=this.$("input, textarea"),this.refs.ghost=this.$(".flexbe-input__ghost"),this.refs.ghostValue=this.$(".flexbe-input__ghost .value"),"arrow"===this.state.runner?this.refs.runners.push(this.$(".flexbe-input__runner")):"suffix"===this.state.runner?this.refs.runners.push(this.$(".suffix")):"prefix"===this.state.runner&&this.refs.runners.push(this.$(".prefix")),this.refs.runners.push(this.$(".flexbe-input__border-runner")),this.refs.runners=this.refs.runners.filter((e=>e)),null!==this.props.tabindex&&this.refs.input.setAttribute("tabindex",this.props.tabindex),this.state.prefixTip&&(this.refs.prefix=this.$(".prefix"),Xt(this.refs.prefix,{interactive:!1,content:this.state.prefixTip})),this.setInputValue(this.props.value),this.autoSize(),this.bindEvents()},normalizeValue(e){var t;return e=null!=(t=e)?t:"",this.props.htmlspecialchars&&(e=st(e,!0)),e},onConnected(){const e=this.props.autofocus;this.autoSize(),e&&setTimeout((()=>this.focus()),"number"==typeof e?e:0)},onBeforeUnmount(){this.refs.prefix&&Kt(this.refs.prefix)},onUnmounted(){this.refs.input=null,this.refs.ghostValue=null,this.refs.runners=[],this.refs.prefix=null,this.unbindEvents()},onBeforeUpdate(){this.refs.input&&this.refs.input.value!==String(this.props.value)&&this.setInputValue(this.props.value)},onUpdated(){this.autoSize()},stopEvent(e){e.preventDefault(),e.stopPropagation()},bindEvents(){const{input:e,runners:t}=this.refs;e&&e.addEventListener&&(e.addEventListener("input",this.updateValue),e.addEventListener("change",this.updateValue),e.addEventListener("keydown",this.keydownHandler),e.addEventListener("keyup",this.keydownHandler),e.addEventListener("focus",this.focusHandler)),this.root.addEventListener("pointerdown",(e=>{if(this.state.disableRunner)return;(t.some((t=>$(e.target).closest(t).length))||this.state.inputRunning)&&this.onRunnerDown(e)})),this._hotkeysSaveDisposer=fs.register({hotkeys:["altleft","altright"],handlerDown:()=>{this.state.altIsPressed=!0,this.update()},handlerUp:()=>{this.state.altIsPressed=!1,this.update()}})},unbindEvents(){var e;const t=this.refs.input;t&&t.removeEventListener&&(t.removeEventListener("input",this.updateValue),t.removeEventListener("change",this.updateValue),t.removeEventListener("keydown",this.keydownHandler),t.removeEventListener("keyup",this.keydownHandler),t.removeEventListener("focus",this.focusHandler)),this.root.removeEventListener("pointerdown",this.onRunnerDown),null==(e=this._hotkeysSaveDisposer)||e.call(this)},setInputValue(e=""){const{input:t,ghostValue:s}=this.refs;if((null==e||Number.isNaN(e))&&(e=""),e=this.normalizeValue(String(e)),t&&t.value!==e){const{selectionStart:s,selectionEnd:i}=t,a=String(e).length-String(t.value).length;t.value=e,t.selectionStart=s+a,t.selectionEnd=i+a}if(s){const t=""===e?this.state.inputValue:e;if("textarea"===this.state.type){const e=this.props.rows||1,i=((e=[],t=[])=>e.length>t.length?e.map(((e,s)=>void 0!==t[s]?t[s]:e)):t)(Array.from({length:e},(()=>" ")),t.split("\n")).join("\n");s.innerHTML=`${i} &#8203;`}else s.innerHTML=t}},autoSize(){const{input:e,ghost:t}=this.refs;this.props.autosize&&"textarea"===this.state.type&&e&&t&&(e.style.height=`${Math.floor(t.offsetHeight+1)}px`)},updateValue(e){const{type:t}=this.state,{min:s,max:i,step:a,strictStep:n,supportMath:r,supportFloat:o}=this.meta,l=e.target.value,d=e.isTrusted,c="input"===e.type&&d;let p=(this.props.normalize||(e=>e))(l,e);if("number"===t){p=p.replace(/[,.]+/,".").replace(/^[^\d(+-]/g,"");const t=/\.$/.test(p),d=/[\d -]+([()*+/-])/.test(p),u=""===p,m="-"===p;if(r&&d){p=p.replace(/[^\d ()*+./-]/g,"");try{p=new Function(`return ${p}`)()}catch{p=Number.NaN}}else p=p.replace(/[^\d.-]/g,"").replace(/\.$/,""),p=p.replace(/-/g,((e,t)=>"-"===e&&0===t?"-":""));t||!o||m?c&&t&&(p=`${p}.`):p=parseFloat(p);const h=Number.isNaN(p),g=p<s||p>i;if(c&&(d||u||m||h||g||t))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),void this.setInputValue(l);h&&(p=parseFloat(l)||0),p=n?(Math.floor(1e4*p)-Math.floor(1e4*p)%(1e4*a))/1e4:function(e,t=2,s){return e=Number(e).toFixed(t),s?e:+e}(p,(e=>{var t;return(null==(t=String(e).split(".")[1])?void 0:t.length)||0})(a)),p=De(s,parseFloat(p),i)}this.setInputValue(p)},keydownHandler(e){const t=e.type,s="keyup"===t,i="keydown"===t,a="Enter"===e.key,n="Escape"===e.key,r=e.target,o=e.key&&e.key.toLowerCase();if(i)if(a){const e=new Event("enter",{bubbles:!0,cancelable:!0}),t=new Event("change",{bubbles:!0,cancelable:!0});r.dispatchEvent(e),r.dispatchEvent(t)}else if(n){const e=new Event("escape",{bubbles:!0,cancelable:!0});if(r.dispatchEvent(e),this.props.blurOnEscape){const e=new Event("blur",{bubbles:!0,cancelable:!0});r.dispatchEvent(e)}}if("number"===this.state.type){const t=e.metaKey||e.ctrlKey,a=e.shiftKey,n=/arrow(?:up|down)/.test(o),{min:l,max:d}=this.meta,c=t||a?this.meta.altStep:this.meta.step;if(["enter","esc","delete","shift","control","meta","alt","backspace","arrowleft","arrowright"].includes(o))return;const p=new InputEvent("input",{bubbles:!0,cancelable:!0}),u=new InputEvent("change",{bubbles:!0,cancelable:!0});if(i&&!t&&1===o.length)o.match(/[^\d ()*+./-]/)&&e.preventDefault();else{let t=r.value;if(n){e.preventDefault();const s="arrowup"===o?c:-1*c;let i=parseFloat(t.replace(",","."));i=(1e4*i+1e4*s)/1e4,Number.isNaN(i)||(t=String(De(l,i,d)))}i&&t!==r.value?(this._triggerChangeOnKeyup=!0,r.value=t,r.dispatchEvent(p)):s&&this._triggerChangeOnKeyup&&(this._triggerChangeOnKeyup=!1,r.dispatchEvent(u))}}},focusHandler(){this.state.autoselect&&this.select()},focus(){this.refs.input&&this.refs.input.focus()},select(){this.refs.input&&this.refs.input.select()},onRunnerDown(e){this.stopEvent(e),uiStore.view.setOverlay(document.body),uiStore.cursor.setCursor("ew-resize"),this.focus(),this.select(),this.state.startPositionRunnerX=e.clientX,this.state.startValueRunner=xt(this.state.value),document.addEventListener("pointermove",this.onRunnerMove),document.addEventListener("pointerup",this.onRunnerUp),this._shiftHotkeyReactionDisposer=c((()=>fs.shiftKey),(()=>this.onRunnerMove()))},onRunnerMove(e){let t=this.state._lastRunnerClientX;e&&(this.stopEvent(e),t=e.clientX,this.state._lastRunnerClientX=e.clientX);let s=this.state.startValueRunner;const i=t-this.state.snapPositionRunnerX;if(this.state.snapPositionRunnerX){if(Math.abs(i)<this.state.runnerSnapDuration)return;this.state.startPositionRunnerX+=i<0?-this.state.runnerSnapDuration:this.state.runnerSnapDuration,this.state.snapPositionRunnerX=0}const a=Math.round(t-this.state.startPositionRunnerX);if(t===this.state.startPositionRunnerX)s=this.state.value;else{const t=fs.shiftKey?this.meta.altStep:this.meta.step;s=(1e4*s+1e4*(Math.round(a/this.meta.runnerFactor)*t))/1e4,(this.state.runnerSnapMultipleOf||this.state.runnerSnapValues.length)&&(s%this.state.runnerSnapMultipleOf==0||this.state.runnerSnapValues.includes(s))&&(this.state.snapPositionRunnerX=e.clientX)}s!==this.state.value&&(this.refs.input.value=s,this.refs.input.dispatchEvent(new InputEvent("input",{bubbles:!0,cancelable:!0})))},onRunnerUp(e){var t;this.stopEvent(e),uiStore.view.resetOverlay(),uiStore.cursor.resetCursor(),document.removeEventListener("pointerup",this.onRunnerUp),document.removeEventListener("pointermove",this.onRunnerMove),null==(t=this._shiftHotkeyReactionDisposer)||t.call(this),this.state.snapPositionRunnerX=0,this.refs.input.dispatchEvent(new InputEvent("change",{bubbles:!0,cancelable:!0}))}}),template:(e,t,s,i)=>e('<slot expr396="expr396" name="label"></slot><div expr397="expr397"></div><textarea expr409="expr409"></textarea><div expr410="expr410" class="flexbe-input__ghost"></div><slot expr412="expr412" name="default"></slot><div expr413="expr413" class="flexbe-input__addon"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.meta.classNames}]},{type:s.SLOT,attributes:[],name:"label",redundantAttribute:"expr396",selector:"[expr396]"},{type:s.IF,evaluate:e=>"textarea"!==e.state.type,redundantAttribute:"expr397",selector:"[expr397]",template:e('<div expr398="expr398" class="flexbe-input__runner"></div><div expr399="expr399" class="flexbe-input__border-runner"></div><input expr400="expr400"/><div expr401="expr401"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-input-wrap ",e.classNames({"has-prefix-icon":e.state.prefixIcon})].join("")}]},{type:s.IF,evaluate:e=>"arrow"===e.state.runner,redundantAttribute:"expr398",selector:"[expr398]",template:e('<svg width="12" height="8" viewBox="0 0 12 8"><path d="M4 0L0 4L4 8V5H8V8L12 4L8 0V3H4V0Z"/></svg>',[])},{type:s.IF,evaluate:e=>e.state.allowRunner,redundantAttribute:"expr399",selector:"[expr399]",template:e(null,[])},{redundantAttribute:"expr400",selector:"[expr400]",expressions:[{type:t.ATTRIBUTE,name:"type",evaluate:e=>e.state.inputType},{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.inputClassName},{type:t.ATTRIBUTE,name:"name",evaluate:e=>e.props.name},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.state.placeholder},{type:t.VALUE,evaluate:e=>e.state.value},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>e.props.autofocus},{type:t.ATTRIBUTE,name:"autocomplete",evaluate:e=>{var t;return null!=(t=e.props.autocomplete)?t:"off"}},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.props.disabled},{type:t.ATTRIBUTE,name:"required",evaluate:e=>e.props.required},{type:t.ATTRIBUTE,name:"readonly",evaluate:e=>e.props.readonly},{type:t.ATTRIBUTE,name:"maxlength",evaluate:e=>e.props.maxLength},{type:t.EVENT,name:"onfocus",evaluate:e=>e.props.onfocus},{type:t.EVENT,name:"onblur",evaluate:e=>e.props.onblur}]},{type:s.IF,evaluate:e=>e.state.showPrefix||e.state.showSuffix,redundantAttribute:"expr401",selector:"[expr401]",template:e('<span expr402="expr402"></span><span expr405="expr405" class="affix value"> </span><span expr406="expr406"></span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-input__ghost ",e.classNames({show:""!==e.state.inputValue})].join("")}]},{type:s.IF,evaluate:e=>e.state.showPrefix,redundantAttribute:"expr402",selector:"[expr402]",template:e('<svg expr403="expr403"></svg> ',[{expressions:[{type:t.TEXT,childNodeIndex:1,evaluate:e=>[e.state.prefix].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["affix prefix prefix ",e.classNames({"ew-resize":"prefix"===e.state.runner&&!e.state.disableRunner})].join("")}]},{type:s.IF,evaluate:e=>e.state.prefixIcon,redundantAttribute:"expr403",selector:"[expr403]",template:e('<use expr404="expr404"/>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-icon size-",e.state.prefixIconSize].join("")}]},{redundantAttribute:"expr404",selector:"[expr404]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.prefixIcon}]}])}])},{redundantAttribute:"expr405",selector:"[expr405]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.inputValue}]},{type:s.IF,evaluate:e=>e.state.showSuffix,redundantAttribute:"expr406",selector:"[expr406]",template:e(' <svg expr407="expr407" class="flexbe-icon size-16"></svg>',[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.suffix].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["affix suffix ",e.classNames({"ew-resize":"suffix"===e.state.runner&&!e.state.disableRunner})].join("")}]},{type:s.IF,evaluate:e=>e.state.suffixIcon,redundantAttribute:"expr407",selector:"[expr407]",template:e('<use expr408="expr408"/>',[{redundantAttribute:"expr408",selector:"[expr408]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.suffixIcon}]}])}])}])}])},{type:s.IF,evaluate:e=>"textarea"===e.state.type,redundantAttribute:"expr409",selector:"[expr409]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.value},{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.inputClassName},{type:t.ATTRIBUTE,name:"name",evaluate:e=>e.props.name},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.state.placeholder},{type:t.ATTRIBUTE,name:"rows",evaluate:e=>e.props.rows},{type:t.ATTRIBUTE,name:"cols",evaluate:e=>e.props.cols},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.props.disabled},{type:t.ATTRIBUTE,name:"required",evaluate:e=>e.props.required},{type:t.ATTRIBUTE,name:"readonly",evaluate:e=>e.props.readonly},{type:t.ATTRIBUTE,name:"maxlength",evaluate:e=>e.props.maxLength},{type:t.EVENT,name:"onfocus",evaluate:e=>e.props.onfocus},{type:t.EVENT,name:"onblur",evaluate:e=>e.props.onblur}]}])},{type:s.IF,evaluate:e=>"textarea"===e.state.type,redundantAttribute:"expr410",selector:"[expr410]",template:e('<span expr411="expr411" class="value"> </span>',[{redundantAttribute:"expr411",selector:"[expr411]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.value}]}])},{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr412",selector:"[expr412]"},{type:s.IF,evaluate:e=>e.state.showInfoAddon,redundantAttribute:"expr413",selector:"[expr413]",template:e('<span expr414="expr414" class="error-text flexbe-error"></span><span expr415="expr415" is="flexbe-tooltip"></span><span expr416="expr416" is="flexbe-loader"></span>',[{type:s.IF,evaluate:e=>e.state.showErrorText,redundantAttribute:"expr414",selector:"[expr414]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.props.errorText}]}])},{type:s.IF,evaluate:e=>e.state.showErrorTip,redundantAttribute:"expr415",selector:"[expr415]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>[e.state.errorLevel,"-tip"].join("")},{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.props.errorTip}]}])},{type:s.IF,evaluate:e=>e.state.showLoading,redundantAttribute:"expr416",selector:"[expr416]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[{type:t.ATTRIBUTE,name:"done",evaluate:e=>e.opts.done}]}])}])}]),name:"flexbe-input"};e(Yi.name,Yi);const Ji={css:null,exports:{setup(e,{initMobx:t}){t(),this.$tooltip=null,this.$thumb=null,this.$track=null,this.$rail=null,this._dragStarted=!1,this._updateTooltipRAF=null,this._dragStartedTimer=null,this._showTipTimer=null,this._riot_id=Ge(5),this._eventId=`range_${this._riot_id}`,this.$document=$(this.root.ownerDocument),this.$listeningElement=null,this.state={localValue:null,get value(){var t,s;return Number(null!=(t=null!=(s=e.props.value)?s:e.props.riotValue)?t:e.meta.inputMax)}},this.meta={sprite:e.props.sprite,get props(){return e.props||{}},get withTransition(){var e;return null==(e=this.props.withTransition)||e},get path(){return[...this.props.path||[]]},get name(){return this.props.name},get size(){return this.props.size},get isFocusable(){var e;return null==(e=this.props.focusable)||e},get disabled(){return Boolean(this.props.disabled)||!1},get min(){if(null!=this.props.min)return+this.props.min;if(this.marks&&this.marks.length){const e=this.marks[0];return e instanceof Object?+e.value:+e}return 0},get max(){if(null!=this.props.max)return+this.props.max;if(this.marks&&this.marks.length){const e=this.marks[this.marks.length-1];return e instanceof Object?+e.value:+e}return 100},get inputMin(){return+this.props.inputMin||this.min},get inputMax(){return+this.props.inputMax||this.max},get maxLength(){return+this.props.maxLength||Math.max(`${this.inputMax}`.length,`${this.inputMin}`.length)||2},get prefix(){return this.props.prefix||""},get suffix(){return this.props.suffix||""},get step(){return+this.props.step||(this.props.marks?"custom":1)},get showInput(){return Boolean(this.props.showInput)},get showMarks(){return Boolean(this.props.showMarks)},get showLabels(){return Boolean(this.props.showLabels)},get showTips(){return Boolean(this.props.showTips)},get marks(){return this.props.marks},get marksStyle(){return this.props.marksStyle||"default"},get startMark(){return this.props.startMark},get endMark(){return this.props.endMark},get commitOnMove(){return Boolean(this.props.commitOnMove)},get marksList(){let t=this.marks&&this.marks.factor,s=[];if(Array.isArray(this.marks))s=this.marks.map((t=>e.getMarkObj(t)));else if(t||this.showMarks||this.showLabels){t||(t=1);const i=Math.ceil((this.max-this.min)/(this.step*t))+1,a=this.showMarks||this.marks&&this.marks.factor;s=new Array(i).fill(0).map(((s,i)=>{const n=+(+(i*this.step*t).toFixed(3)+this.min).toFixed(3);return e.getMarkObj({value:n,showMark:a})}))}const i=s.every((e=>null!=e.position)),a=s.every((e=>!Number.isNaN(+e.value)));return i||(s=a?s.map((e=>({...e,position:+(100*(e.value-this.min)/(this.max-this.min)).toFixed(2)}))):s.map(((e,t)=>({...e,position:t/(s.length-1)*100})))),s},get availableValuesList(){if("custom"===this.step)return this.marksList.map((e=>({value:e.value,position:e.position})));const e=Math.ceil((this.max-this.min)/this.step)+1;return new Array(e).fill(0).map(((e,t)=>{const s=+(t*this.step).toFixed(3),i=+(100*s/(this.max-this.min)).toFixed(2);return{value:+(s+this.min).toFixed(3),position:i}}))},get extendedValuesList(){if("custom"===this.step)return this.marksList.map((e=>({value:e.value,position:e.position})));const e=Math.ceil((this.inputMax-this.inputMin)/this.step)+1;return new Array(e).fill(0).map(((e,t)=>{const s=+(t*this.step).toFixed(3),i=+(s+this.inputMin).toFixed(3);let a;return a=i<=this.min?0:i>=this.max?100:+(100*(s-(this.min-this.inputMin))/(this.max-this.min)).toFixed(2),{value:i,position:a}}))},get hasValues(){return this.marksList.some((e=>e.label))||this.showLabels},get showRail(){return!!this.props.showRail||(this.marks&&this.marks instanceof Array?this.marks.some((e=>e.label))&&this.marks.every((e=>!e.showMark)):!this.marks&&!this.showMarks)},get renderOnUpdate(){return Boolean(this.props.renderOnUpdate)}},this.watch={"meta.min":()=>this.setThumbPosition(this.state.value),"meta.max":()=>this.setThumbPosition(this.state.value)}},getMarkObj(e){e instanceof Object||(e={value:e,showMark:!0});let t={...e};return this.meta.showLabels&&null==t.label&&(t.label=this.getFormattedValue(t.value)),this.meta.showTips&&null==t.tip&&(t.tip=this.getFormattedValue(t.value)),this.meta.showLabels&&t.label===t.tip&&delete t.tip,t},updateCoords(){const e=this.$track[0].getBoundingClientRect(),t=this.$thumb[0].getBoundingClientRect(),s=Math.floor(e.x),i=Math.floor(e.width),a=Math.floor(t.x),n=Math.floor(t.y),r=Math.floor(t.width),o=Math.floor(t.height);this.trackCoords={trackX:s,trackWidth:i,thumbX:a,thumbY:n,thumbWidth:r,thumbHeight:o}},getFormattedValue(e=this.state.localValue){let t="",s="";return this.meta.prefix&&(t=`${this.meta.prefix} `),this.meta.suffix&&(s=` ${this.meta.suffix}`),`${t}${e}${s}`},getPositionFromValue(e){const t=this.meta.availableValuesList.find((t=>t.value===e));return t?t.position:this.findClosestMark({value:e}).position},getPositionFromClientX(e){const{trackX:t,trackWidth:s}=this.trackCoords;return De(0,(e-t)/s*100,100).toFixed(1)},getThumbPositionX(e){const{trackWidth:t}=this.trackCoords,s=this.getPositionFromValue(e);return Math.round(s/100*t)},setThumbPosition(e){this.isMounted&&(this.$thumb.css("transform",`translateX(${this.getThumbPositionX(e)}px)`),this.$rail.css("transform",`scaleX(${this.getPositionFromValue(e)/100})`))},findClosestMark(e,t=[...this.meta.extendedValuesList]){if(e&&e.event){const s=this.getPositionFromClientX(e.event.clientX);return t.sort(((e,t)=>Math.abs(e.position-s)-Math.abs(t.position-s)))[0]}return e&&e.value?t.sort(((t,s)=>Math.abs(t.value-e.value)-Math.abs(s.value-e.value)))[0]:e&&e.position?t.sort(((t,s)=>Math.abs(t.position-e.position)-Math.abs(s.position-e.position)))[0]:t[0]},inputChange(e){const t=this.findClosestMark({value:+e.target.value}).value;e.preventUpdate=!0,e.target.value=t,this.updateValues(t),this.commit(t)},updateValues(e){null!=e&&(this.state.localValue=+e.toFixed(3)),this.isMounted&&($(this.root).find(".flexbe-input__text").val(this.state.localValue),$(this.root).find(".affix.value").text(this.state.localValue),this.setThumbPosition(e))},unbindEvents(){$document.off(`.${this._riot_id}`)},keyDown(e){if(e.preventUpdate=!0,this.meta.disabled)return;let t,s=this.meta.step,i=this.meta.step;if("custom"===this.meta.step){const e=[...this.meta.availableValuesList],t=e.length-1,a=e.map((e=>e.value)).indexOf(this.state.localValue),n=a>0?a-1:0,r=a<t?a+1:t;s=+Math.abs(e[r].value-this.state.localValue).toFixed(3),i=+Math.abs(e[n].value-this.state.localValue).toFixed(3)}"ArrowLeft"===e.key?t=Math.max(this.meta.min,+(this.state.localValue-i).toFixed(3)):"ArrowRight"===e.key&&this.state.localValue!==this.meta.max?t=Math.min(this.meta.max,+(this.state.localValue+s).toFixed(3)):"Home"===e.key?(e.preventDefault(),t=this.meta.min):"End"===e.key&&(e.preventDefault(),t=this.meta.max),null!=t&&(this.setThumbPosition(t),this.commit(t,e.type))},pointerOver(e){if(e.preventUpdate=!0,clearTimeout(this._showTipTimer),this.meta.disabled||!this.meta.showTips||this._dragStarted)return;const t=$(e.target).closest(".mark"),s=$(e.target).closest(".thumb");let i,a;if(t.length)i=t,a=t.attr("data-tip");else{if(!s.length)return;i=s,a=this.getFormattedValue}this._showTipTimer=setTimeout((()=>{this.showTooltip(i,a)}),50)},pointerDown(e){var t,s;if(e.preventUpdate=!0,e.preventDefault(),clearTimeout(this._showTipTimer),clearTimeout(this._dragStartedTimer),this.meta.disabled||1!==e.which)return;const i=$(e.target).closest(".thumb"),a=$(e.target).closest(".mark"),n=a.length,r=i.length;let o;this.state.isFocusable&&this.$track.focus(),this.updateCoords(),this._dragStarted=!0,this._dragStartedTimer=setTimeout((()=>{this.$thumb.addClass("active"),this.destroyTooltip(!1),this.showTooltip(this.$thumb,this.getFormattedValue)}),50),o=n?+a.attr("data-value"):this.findClosestMark({event:e},[...this.meta.availableValuesList]).value,r||(this.setThumbPosition(o),this.updateValues(o)),this.$listeningElement=this.$document,"object"==typeof uiStore&&(this.$listeningElement=uiStore.view.setOverlay(document.body,"pointer")),null==(t=this.$listeningElement)||t.on(`pointermove.${this._eventId}.thumb`,$.throttle((e=>this.pointerDrag(e)),10)),null==(s=this.$listeningElement)||s.on(`pointerup.${this._eventId}.thumb`,$.throttle((e=>this.pointerUp(e)),60)),"function"==typeof this.props.onchange&&this.props.onchange(o)},pointerDrag(e){if(e.preventDefault(),!this._dragStarted)return;const t=this.findClosestMark({event:e,value:this.state.localValue},[...this.meta.availableValuesList]).value;this.meta.commitOnMove?this.commit(t,"input"):this.updateValues(t),"function"==typeof this.props.onchange&&this.props.onchange(t)},pointerUp(e){var t;null==e||e.preventDefault(),null==(t=this.$listeningElement)||t.off(`.${this._eventId}.thumb`),this.$listeningElement=null,uiStore.view.resetOverlay(),clearTimeout(this._dragStartedTimer);const s=this.findClosestMark({event:e},[...this.meta.availableValuesList]).value;this._dragStarted=!1,this.$thumb.removeClass("active"),this.destroyTooltip(!1),this.setThumbPosition(s),this.commit(s,"change"),"function"==typeof this.props.onchange&&this.props.onchange(s)},showTooltip(e,t){e&&e.length&&this.meta.showTips&&(this.$tooltip||(this.$tooltip=$('<div class="range-tip"></div>')),this.$tooltip.toggleClass("animated",!this._dragStarted),0===this.$tooltip.closest("body").length&&$("body").append(this.$tooltip),this.updateTooltip(e,t),this.$tooltip.addClass("show"),this._updateTooltipRAF&&this._updateTooltipRAF(),this._updateTooltipRAF=St((()=>{this.updateTooltip(e,t)}),60),this.$document.on(`pointermove.tip-${this._riot_id}`,(t=>{this._dragStarted||$(t.target).closest(e).length||this.destroyTooltip(!0)})),$(window).on(`blur.tip-${this._riot_id}`,(e=>{this.destroyTooltip(!0)})))},updateTooltip(e,t=this.getFormattedValue){const{top:s,left:i,width:a,height:n}=e[0].getBoundingClientRect();this.$tooltip.attr("data-tip",it(t));const r=this.$tooltip.innerWidth(),o=this.$tooltip.innerHeight();this.$tooltip.css({left:i-+(r/2).toFixed(0)+ +(a/2).toFixed(0)+"px",top:s-o-+(n/2).toFixed(0)+"px"})},destroyTooltip(e=!0){this.$document.off(`pointermove.tip-${this._riot_id}`),$(window).off(`blur.tip-${this._riot_id}`),clearTimeout(this._showTipTimer),this._updateTooltipRAF&&this._updateTooltipRAF(),e?(null!=this.$tooltip&&(this.$tooltip.removeClass("show"),this.$tooltip=null),setTimeout((()=>{$(".range-tip").remove()}),50)):$(".range-tip").remove()},commit(e,t="change"){var s,i;this.state.value===e&&"change"!==t||(this.updateValues(e),null==(s=(i=this.props).commit)||s.call(i,{value:e,path:this.meta.path,reason:t}))},onBeforeUpdate(){requestAnimationFrame((()=>{this.state.value!==this.state.localValue&&this.updateValues(this.state.value)}))},onUpdated(){const e=this.trackCoords;requestAnimationFrame((()=>{this.isMounted&&(this.updateCoords(),this.trackCoords.trackWidth===e.trackWidth&&this.trackCoords.trackX===e.trackX||this.setThumbPosition(this.state.localValue))}))},onBeforeMount(){this.updateValues(this.state.value)},onMounted(){this.$track=$(this.root).find(`.track_${this._riot_id}`),this.$thumb=$(this.root).find(`.thumb_${this._riot_id}`),this.$rail=this.$track.find(".rail"),$document.on(`pointerenter.${this._riot_id}`,(e=>{this._dragStarted&&e.target.ownerDocument!==this.$document[0]&&(this.pointerUp(),this.$track.blur())})),this.updateCoords(),this.updateValues(this.state.localValue),setTimeout((()=>{this.isMounted&&(this.updateCoords(),this.updateValues(this.state.localValue),this.meta.withTransition&&this.root.classList.add("range-transition"))}),50)},onBeforeUnmount(){this.unbindEvents(),this.destroyTooltip()}},template:(e,t,s,i)=>e('<div expr417="expr417" class="legend-mark start mr10"></div><div expr422="expr422"><div expr423="expr423" class="rail"></div><div expr424="expr424"></div><div expr428="expr428"><span class="thumb-circle"></span></div></div><div expr429="expr429" class="legend-mark end ml10"></div><label expr434="expr434" is="proxy" data-is="flexbe-input" type="number"></label>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-input-range ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.meta.startMark,redundantAttribute:"expr417",selector:"[expr417]",template:e('<template expr418="expr418"></template><template expr421="expr421"></template>',[{type:s.IF,evaluate:e=>e.meta.startMark.icon,redundantAttribute:"expr418",selector:"[expr418]",template:e('<svg expr419="expr419"><use expr420="expr420"/></svg>',[{redundantAttribute:"expr419",selector:"[expr419]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-icon size-",e.meta.startMark.size||"16"].join("")}]},{redundantAttribute:"expr420",selector:"[expr420]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#",e.meta.startMark.icon].join("")}]}])},{type:s.IF,evaluate:e=>!e.meta.startMark.icon,redundantAttribute:"expr421",selector:"[expr421]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.meta.startMark].join("")}]}])}])},{redundantAttribute:"expr422",selector:"[expr422]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["track track_",e._riot_id," ",e.classNames({"has-values":e.meta.hasValues})].join("")},{type:t.EVENT,name:"onkeydown",evaluate:e=>e.keyDown},{type:t.EVENT,name:"onpointerover",evaluate:e=>e.pointerOver},{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.pointerDown},{type:t.ATTRIBUTE,name:"tabindex",evaluate:e=>e.state.isFocusable?"0":"-1"}]},{type:s.IF,evaluate:e=>e.meta.showRail,redundantAttribute:"expr423",selector:"[expr423]",template:e(null,[])},{type:s.IF,evaluate:e=>e.meta.marksList.length,redundantAttribute:"expr424",selector:"[expr424]",template:e('<div expr425="expr425"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["marks ",e.meta.marksStyle].join("")}]},{type:s.EACH,getKey:e=>e.mark.value,condition:null,template:e('<div expr426="expr426" class="range-mark"></div><div expr427="expr427" class="range-label"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["mark ",e.classNames({last:e.index===e.meta.marksList.length-1})].join("")},{type:t.ATTRIBUTE,name:"style",evaluate:e=>["left: ",e.mark.position,"%"].join("")},{type:t.ATTRIBUTE,name:"data-value",evaluate:e=>e.mark.value},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.mark.tip}]},{type:s.IF,evaluate:e=>e.mark.showMark,redundantAttribute:"expr426",selector:"[expr426]",template:e(null,[])},{type:s.IF,evaluate:e=>e.mark.label,redundantAttribute:"expr427",selector:"[expr427]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.mark.label].join("")}]}])}]),redundantAttribute:"expr425",selector:"[expr425]",itemName:"mark",indexName:"index",evaluate:e=>e.meta.marksList}])},{redundantAttribute:"expr428",selector:"[expr428]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["thumb thumb_",e._riot_id].join("")}]},{type:s.IF,evaluate:e=>e.meta.endMark,redundantAttribute:"expr429",selector:"[expr429]",template:e('<template expr430="expr430"></template><template expr433="expr433"></template>',[{type:s.IF,evaluate:e=>e.meta.endMark.icon,redundantAttribute:"expr430",selector:"[expr430]",template:e('<svg expr431="expr431"><use expr432="expr432"/></svg>',[{redundantAttribute:"expr431",selector:"[expr431]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-icon size-",e.meta.endMark.size||"16"].join("")}]},{redundantAttribute:"expr432",selector:"[expr432]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#",e.meta.endMark.icon].join("")}]}])},{type:s.IF,evaluate:e=>!e.meta.endMark.icon,redundantAttribute:"expr433",selector:"[expr433]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.meta.endMark].join("")}]}])}])},{type:s.IF,evaluate:e=>e.meta.showInput,redundantAttribute:"expr434",selector:"[expr434]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-input-in-range ml10 light ",e.meta.size||"small"].join("")},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.meta.disabled},{type:t.ATTRIBUTE,name:"min",evaluate:e=>e.meta.inputMin},{type:t.ATTRIBUTE,name:"max",evaluate:e=>e.meta.inputMax},{type:t.ATTRIBUTE,name:"step",evaluate:e=>e.meta.step},{type:t.ATTRIBUTE,name:"strict-step",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"data-suffix",evaluate:e=>e.meta.suffix},{type:t.ATTRIBUTE,name:"data-prefix",evaluate:e=>e.meta.prefix},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.localValue},{type:t.ATTRIBUTE,name:"max-length",evaluate:e=>e.meta.maxLength},{type:t.ATTRIBUTE,name:"calc-max-width",evaluate:e=>e.meta.maxLength>0},{type:t.ATTRIBUTE,name:"range",evaluate:e=>!0},{type:t.EVENT,name:"onchange",evaluate:e=>e.inputChange}]}])}]),name:"flexbe-input-range"};e(Ji.name,Ji);const Qi={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={localValue:0,get min(){return e.props.min||0},get max(){return e.props.min||100},get value(){return e.props.value||this.min},get unit(){return e.props.unit||""},get roundProgressValue(){return e.props.roundProgressValue}}},onMounted(){this.rangeTrackEl=this.$(".flexbe-input-range .track"),this.updateProgressValuePosition()},onUpdated(){this.updateProgressValuePosition()},getPositionFromValue(e){const{min:t,max:s}=this.state;return(e-t)/(s-t)*100},updateProgressValuePosition(e=this.state.value){const t=this.$(".progress-value");if(t){const{min:s,max:i}=this.state,a=this.rangeTrackEl.offsetWidth,n=this.getPositionFromValue(e),r=this.state.roundProgressValue?Math.round(e):e;t.innerText=`${De(s,r,i)}${this.state.unit}`;const o=t.offsetWidth,l=De(0,n*a/100-o/2,a-o);t.style.setProperty("transform",`translateX(${l}px)`)}},commit(e,...t){var s,i;this.updateProgressValuePosition(e.value),null==(s=(i=this.props).commit)||s.call(i,e,...t)}},template:(e,t,s,i)=>e('<div class="progress-value"></div><div expr435="expr435" is="flexbe-input-range"></div><div expr436="expr436" class="edge-values"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>{var t;return["flexbe-progress-range ",e.classNames({"show-edge-values":null==(t=e.props.showEdgeValues)||t})," ",e.props.class].join("")}}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input-range",slots:[],attributes:[{type:t.ATTRIBUTE,name:null,evaluate:e=>e.props},{type:t.ATTRIBUTE,name:"with-transition",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.value},{type:t.ATTRIBUTE,name:"show-tips",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"commit-on-move",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"commit",evaluate:e=>e.commit}],redundantAttribute:"expr435",selector:"[expr435]"},{type:s.IF,evaluate:e=>{var t;return null==(t=e.props.showEdgeValues)||t},redundantAttribute:"expr436",selector:"[expr436]",template:e('<div expr437="expr437" class="from-value"> </div><div expr438="expr438" class="to-value"> </div>',[{redundantAttribute:"expr437",selector:"[expr437]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>`${e.state.min}${e.state.unit}`}]},{redundantAttribute:"expr438",selector:"[expr438]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>`${e.state.max}${e.state.unit}`}]}])}]),name:"flexbe-progress-range"};e(Qi.name,Qi);const ea={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get pureValue(){var t;return String(null!=(t=e.props.value)?t:"").toLowerCase()},get units(){return(e.props.units||[]).map((e=>"string"==typeof e?{title:e.toUpperCase(),value:e}:e))},get defaultUnit(){return e.props.defaultUnit||""},get suffix(){var t,s;return this.units.length>1||null!=(t=e.props.showSuffix)&&!t?"":null!=(s=e.props.suffix)?s:this.selectedUnit.title},get runner(){return e.props.runner?e.props.runner:this.units.length>1?"none":null},get placeholder(){return e.props.placeholder},get autoKey(){return(e.props.autoKey||"auto").toLowerCase()},get parsedValue(){return Bt(this.pureValue,this.defaultUnit)},get isAuto(){return this.pureValue===this.autoKey},get autoDisabled(){var t;return null==(t=e.props.autoDisabled)||t},get disabled(){var t;return null!=(t=e.props.disabled)&&t},get displayValue(){var t;let s=this.parsedValue[0];const i=null!=(t=e.props.autoValue)?t:e.props.autovalue;return s===this.autoKey&&null!=i&&(s=i),s},get selectedUnit(){const t=this.isAuto,s=this.parsedValue[1]||"";let i=this.units.find((e=>t?e.auto:[e.value,e.title.toLowerCase()].includes(s)));if(!i){const t=this.units[0]||{title:"",value:"",step:1};if(this.isAuto){var a;const t=null!=(a=e.props.autoUnit)?a:e.props.autounit;i={title:t,value:t}}i=s?{title:s,value:s}:t}return i}}},onMounted(){Wt(this.root)},onUpdated(){Wt(this.root)},onBeforeUnmount(){Zt(this.root)},stopEvent(e){e.preventDefault(),e.stopPropagation()},normalizeUnits:([e,t])=>[e,t],onChangeValue(e){const t=+e.target.value,s=this.state.selectedUnit;this.changeValue(t,s,e)},onChangeUnit(e){this.stopEvent(e);const t=e.target.value,s=this.state.units[t];let i=this.state.displayValue;if("selectValue"in s)i=it(s.selectValue,[s,this.state.selectedUnit,this.state.displayValue]);else if(this.props.selectValue){var a;i=null!=(a=it(this.props.selectValue,[s,this.state.selectedUnit,this.state.displayValue]))?a:this.state.displayValue}this.changeValue(i,s,e)},changeValue(e,t,s){const i=e===this.state.autoKey||t.auto?this.state.autoKey:`${e}${t.value}`,a=this.state.displayValue,n=this.state.selectedUnit;this.props.changeValue({result:i,value:e,unit:t,oldUnit:n,oldValue:a,event:s})}},template:(e,t,s,i)=>e('<div expr439="expr439" is="flexbe-input" type="number"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-number-input ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[{id:"default",html:'<div expr440="expr440" class="flexbe-number-input-units"></div>',bindings:[{type:s.IF,evaluate:e=>e.state.units.length>1,redundantAttribute:"expr440",selector:"[expr440]",template:e('<div expr441="expr441" class="flexbe-number-input-units__value"> </div><select expr442="expr442" class="flexbe-number-input-units__select" tabindex="-1"><option expr443="expr443"></option></select>',[{redundantAttribute:"expr441",selector:"[expr441]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.selectedUnit.title}]},{redundantAttribute:"expr442",selector:"[expr442]",expressions:[{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>1===e.state.units.length||e.state.disabled},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.state.selectedUnit.tip},{type:t.EVENT,name:"oninput",evaluate:e=>e.stopEvent},{type:t.EVENT,name:"onchange",evaluate:e=>e.onChangeUnit}]},{type:s.EACH,getKey:null,condition:null,template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.unit.title},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.index},{type:t.ATTRIBUTE,name:"selected",evaluate:e=>e.unit===e.state.selectedUnit}]}]),redundantAttribute:"expr443",selector:"[expr443]",itemName:"unit",indexName:"index",evaluate:e=>e.state.units}])}]}],attributes:[{type:t.ATTRIBUTE,name:"math",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"step",evaluate:e=>e.state.selectedUnit.step},{type:t.ATTRIBUTE,name:null,evaluate:e=>e.props},{type:t.ATTRIBUTE,name:"suffix",evaluate:e=>e.state.suffix},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.displayValue},{type:t.ATTRIBUTE,name:"allow-arrow-runner",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.state.placeholder},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.disabled||e.state.isAuto&&e.state.autoDisabled},{type:t.EVENT,name:"oninput",evaluate:e=>e.onChangeValue},{type:t.EVENT,name:"onchange",evaluate:e=>e.onChangeValue}],redundantAttribute:"expr439",selector:"[expr439]"}]),name:"flexbe-number-input"};e(ea.name,ea);const ta={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={progressTotal:124.853,loader:e.props.loader||(null==this.progress?"infinite":"progress"),showIndicator:e.props.showIndicator&&null!=this.progress,get done(){return+e.props.done},get progress(){return+e.props.progress},get currentProgress(){const e=this.progressTotal;return e-e*((this.progress||0)/100)},get className(){let t=`flexbe-loader ${e.props.class||""}`;return this.done&&(t+=" done"),t}}}},template:(e,t,s,i)=>e('<template expr457="expr457"></template><svg expr461="expr461" class="done-loader" viewBox="0 0 25 19"></svg><span expr462="expr462" class="percents-indicator"></span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.className}]},{type:s.IF,evaluate:e=>!e.state.done,redundantAttribute:"expr457",selector:"[expr457]",template:e('<svg expr458="expr458" class="circular-loader infinite" viewBox="25 25 50 50"></svg><svg expr459="expr459" class="circular-loader progress" viewBox="25 25 50 50"></svg>',[{type:s.IF,evaluate:e=>"infinite"===e.state.loader,redundantAttribute:"expr458",selector:"[expr458]",template:e('<circle class="circular-loader--path" cx="50" cy="50" r="19"/>',[])},{type:s.IF,evaluate:e=>"progress"===e.state.loader,redundantAttribute:"expr459",selector:"[expr459]",template:e('<circle class="circular-loader--bg" cx="50" cy="50" r="20"/><circle expr460="expr460" class="circular-loader--path" cx="50" cy="50" r="20" ransform="rotate(-90 50 50)"/>',[{redundantAttribute:"expr460",selector:"[expr460]",expressions:[{type:t.ATTRIBUTE,name:"stroke-dasharray",evaluate:e=>e.state.progressTotal},{type:t.ATTRIBUTE,name:"stroke-dashoffset",evaluate:e=>e.state.currentProgress}]}])}])},{type:s.IF,evaluate:e=>e.state.done,redundantAttribute:"expr461",selector:"[expr461]",template:e('<path class="done-loader--arrow" d="M1 9l8 7L23 1"/>',[])},{type:s.IF,evaluate:e=>e.state.showIndicator,redundantAttribute:"expr462",selector:"[expr462]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[Math.max(0,Math.min(100,e.state.progress)),"%"].join("")},{type:t.ATTRIBUTE,name:"hide",evaluate:e=>e.state.done}]}])}]),name:"flexbe-loader"};e(ta.name,ta);const sa=["#E15241","#6140B0","#53B9D1","#D0DB59","#EC6237"],ia=["linear-gradient(90deg, #f6d365 0%, #fda085 100%)","linear-gradient(90deg, #fbc2eb 0%, #a6c1ee 100%)","linear-gradient(85deg, #8fd3f4 5%, #84fab0 95%)","linear-gradient(90deg, #ffecd2 0%, #fcb69f 100%)","linear-gradient(90deg, #9796f0 0%, #fbc7d4 100%)"],aa=["#FFFFFF","#000000"],na=["linear-gradient(90deg, #2193b0 0%, #6dd5ed 100%)","linear-gradient(135deg, #ee9ae5 0%, #5961f9 92%)"],ra={color:[["#FCECEE","#F7CFD3","#E39E9C","#D67976","#DD5E56","#E15241","#D3483E","#C23F38","#B63831","#A82E26"],["#F8E5EC","#EFBDCF","#E694B0","#DF6C92","#DA507A","#D63964","#C63461","#B22E5B","#9F2857","#7C1E4E"],["#F1E5F4","#DBC0E4","#C596D4","#AF6EC3","#9F50B6","#9036AA","#8332A4","#712B9C","#612694","#441E87"],["#ECE7F5","#CFC4E6","#AF9FD7","#9078C7","#785CBC","#6140B0","#583BAB","#4C33A2","#402D9A","#2D218C"],["#E8EAF5","#C6CAE6","#A1A9D6","#7B87C6","#5F6DBA","#4253AF","#3B4CA5","#324299","#2A388E","#1B2679"],["#E6F2FC","#C2DDF8","#9CC9F5","#77B4F0","#5DA4EF","#4896EC","#4188DE","#3776CB","#2F65BA","#1F489B"],["#E4F6F9","#BEE9F1","#97DCE8","#73CDDE","#5FC3D7","#53B9D1","#4CA9BE","#4195A5","#38818D","#285E63"],["#E3F1F1","#BBDEDB","#91C9C4","#6AB4AC","#52A49A","#429488","#3B877B","#34776B","#2C675C","#1E4C40"],["#EAF5EA","#CEE5CB","#AFD4AB","#91C48A","#7BB872","#67AC5B","#5D9D52","#508B46","#457A3B","#2F5C28"],["#F9FBE9","#F1F3C8","#E7EDA5","#DEE684","#D6E06D","#D0DB59","#C2C951","#B0B347","#9E9C3D","#80762C"],["#FDF3E2","#FAE0B7","#F7CD8B","#F4B961","#F2AA47","#F19C38","#EC9135","#E58231","#DF732C","#D55A26"],["#F8EAE7","#F7CEBF","#F3AF96","#F08F6D","#EE7850","#EC6237","#E25C33","#D5552E","#C84D29","#B04021"],["#EEEBE9","#D5CCC9","#B9ABA5","#9D8980","#886F65","#74574A","#684D43","#594139","#4A352F","#3B2824"],["#FAFAFA","#F5F5F5","#EEEEEE","#E0E0E0","#BDBDBD","#9E9E9E","#757575","#616161","#424242","#212121"],["#EDEFF1","#D1D8DB","#B3BEC4","#94A3AD","#7D8F9B","#667C89","#596D79","#495963","#3A474E","#283237"]],gradient:{linear:["linear-gradient(90deg, #f6d365 0%, #fda085 100%)","linear-gradient(90deg, #fbc2eb 0%, #a6c1ee 100%)","linear-gradient(85deg, #8fd3f4 5%, #84fab0 100%)","linear-gradient(90deg, #ffecd2 0%, #fcb69f 100%)","linear-gradient(90deg, #9796f0 0%, #fbc7d4 100%)","linear-gradient(95deg, #c2e9fb 0%, #a1c4fd 100%)","linear-gradient(90deg, #2193b0 0%, #6dd5ed 100%)","linear-gradient(135deg, #ee9ae5 0%, #5961f9 100%)","linear-gradient(90deg, #4776e6 0%, #8e54e9 100%)","linear-gradient(90deg, #c24f9b 0%, #fd5668 100%)","linear-gradient(90deg, #ff4563 0%, #ff804b 100%)","linear-gradient(90deg, #3bc5fe 0%, #008ee0 100%)","linear-gradient(90deg, #ddd6f3 0%, #faaca8 100%)","linear-gradient(90deg, #b993d6 0%, #8ca6db 100%)","linear-gradient(90deg, #d1913c 0%, #ffd194 100%)","linear-gradient(90deg, #00b09b 0%, #96c93d 100%)","linear-gradient(90deg, #ffe259 0%, #ffa751 100%)","linear-gradient(90deg, #fbd231 0%, #d52e8c 100%)","linear-gradient(90deg, #8ffc99 0%, #6cd7fa 100%)","linear-gradient(90deg, #216bea 0%, #1d157d 100%)","linear-gradient(95deg, #7f59c6 0%, #c3d3f4 100%)","linear-gradient(90deg, #ff0485 0%, #f464fd 100%)","linear-gradient(90deg, #06e4ae 0%, #9ae15e 100%)","linear-gradient(90deg, #00dbde 0%, #fc00ff 100%)","linear-gradient(90deg, #fccf31 0%, #f55555 100%)","linear-gradient(90deg, #ee0979 0%, #ff6a00 100%)","linear-gradient(90deg, #edff20 0%, #3cd500 100%)","linear-gradient(90deg, #a9c9ff 0%, #ffbbec 100%)","linear-gradient(90deg, #5924f9 0%, #ffcadd 100%)","linear-gradient(90deg, #b40542 0%, #f40a4c 100%)"],radial:["radial-gradient(#f6d365 0%, #fda085 100%)","radial-gradient(#fbc2eb 0%, #a6c1ee 100%)","radial-gradient(#8fd3f4 5%, #84fab0 100%)","radial-gradient(#ffecd2 0%, #fcb69f 100%)","radial-gradient(#9796f0 0%, #fbc7d4 100%)","radial-gradient(#c2e9fb 0%, #a1c4fd 100%)","radial-gradient(#2193b0 0%, #6dd5ed 100%)","radial-gradient(#ee9ae5 0%, #5961f9 100%)","radial-gradient(#4776e6 0%, #8e54e9 100%)","radial-gradient(#c24f9b 0%, #fd5668 100%)","radial-gradient(#ff4563 0%, #ff804b 100%)","radial-gradient(#3bc5fe 0%, #008ee0 100%)","radial-gradient(#ddd6f3 0%, #faaca8 100%)","radial-gradient(#b993d6 0%, #8ca6db 100%)","radial-gradient(#d1913c 0%, #ffd194 100%)","radial-gradient(#00b09b 0%, #96c93d 100%)","radial-gradient(#ffe259 0%, #ffa751 100%)","radial-gradient(#fbd231 0%, #d52e8c 100%)","radial-gradient(#8ffc99 0%, #6cd7fa 100%)","radial-gradient(#216bea 0%, #1d157d 100%)","radial-gradient(#7f59c6 0%, #c3d3f4 100%)","radial-gradient(#ff0485 0%, #f464fd 100%)","radial-gradient(#06e4ae 0%, #9ae15e 100%)","radial-gradient(#00dbde 0%, #fc00ff 100%)","radial-gradient(#fccf31 0%, #f55555 100%)","radial-gradient(#ee0979 0%, #ff6a00 100%)","radial-gradient(#edff20 0%, #3cd500 100%)","radial-gradient(#a9c9ff 0%, #ffbbec 100%)","radial-gradient(#5924f9 0%, #ffcadd 100%)","radial-gradient(#b40542 0%, #f40a4c 100%)"]}},oa={color:[...ra.color.map((e=>{const t=e[e.length-3];return[.2,.3,.4,.5,.6,.7,.8,.9].map((e=>Le(t,e,"rgb")))}))],gradient:{linear:["linear-gradient(90deg, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0) 100%)","linear-gradient(90deg, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0) 100%)","linear-gradient(90deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 100%)","linear-gradient(90deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 100%)","linear-gradient(0deg, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0) 100%)","linear-gradient(0deg, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0) 100%)","linear-gradient(0deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 100%)","linear-gradient(0deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 100%)",...ra.gradient.linear.map((e=>Le(e,.5)))],radial:["radial-gradient(rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.5) 100%)","radial-gradient(rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.6) 100%)","radial-gradient(rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.7) 100%)","radial-gradient(rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.8) 100%)",...ra.gradient.radial.map((e=>Le(e,.5)))]}},la=[[{s:50,b:50},{s:100,b:100}],[{s:0,b:50},{s:49,b:100}],[{s:0,b:0},{s:49,b:49}],[{s:50,b:0},{s:100,b:49}]],da=(e,t=!1)=>{let s=(e=>String(e).toLowerCase().split(":")[0].replace(/[^\da-f]/gi,""))(e);return s&&(3===s.length||6===s.length||t&&8===s.length)?(3===s.length&&(s=s[0]+s[0]+s[1]+s[1]+s[2]+s[2]),s):""},ca=e=>{let t=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];return t=t.map((e=>1===e.length?`0${e}`:e)),t.join("")},pa=e=>{const t=parseInt(da(e),16);return{r:t>>16,g:(65280&t)>>8,b:255&t}},ua=e=>{const t=(e=>{const t={h:0,s:0,b:0},s=Math.min(e.r,e.g,e.b),i=Math.max(e.r,e.g,e.b),a=i-s;return t.b=i,t.s=0!==i?255*a/i:0,0!==t.s?e.r===i?t.h=(e.g-e.b)/a:e.g===i?t.h=2+(e.b-e.r)/a:t.h=4+(e.r-e.g)/a:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t.h=+t.h.toFixed(),t.s=+t.s.toFixed(),t.b=+t.b.toFixed(),t})(pa(e));return 0===t.s&&(t.h=360),t},ma=e=>ca((e=>{const t={};let s=Math.round(e.h);const i=Math.round(255*e.s/100),a=Math.round(255*e.b/100);if(0===i)t.r=a,t.g=a,t.b=a;else{const e=a,n=(255-i)*a/255,r=s%60*(e-n)/60;360===s&&(s=0),s<60?(t.r=e,t.b=n,t.g=n+r):s<120?(t.g=e,t.b=n,t.r=e-r):s<180?(t.g=e,t.r=n,t.b=n+r):s<240?(t.b=e,t.r=n,t.g=e-r):s<300?(t.b=e,t.g=n,t.r=n+r):s<360?(t.r=e,t.g=n,t.b=e-r):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}})(e)),ha=e=>+String(e)==+e&&+e>=0&&+e<=1,ga=e=>void 0!==e&&(e=String(e).toLowerCase().split(":")[0],/\((\d*),\s?(\d*),\s?(\d*),?\s?(.*)?\)$/.test(e)),va=e=>{if("object"==typeof e||ga(e))return!1;const t=da(e);return!(!t||t.length<3||t.length>6)&&/^#?([\da-f]{3}|[\da-f]{6})$/i.test(t)},fa=e=>"object"!=typeof e&&!ga(e)&&/^#?[\da-f]{8}$/i.test(e),xa=e=>!!e&&(e=e.replace(";",""),/^\s*linear-gradient|radial-gradient\(.*\)\s*$/i.test(e)),ba=e=>!xa(e)&&(va(e)||fa(e)||ga(e)),ya=e=>/auto|contrast/.test(e),_a=(e,t=!1)=>{var s;if("object"==typeof e&&null!=(s=e)&&s.h)return ma(e);if(e=String(e).toLowerCase().trim(),va(e)||fa(e))return da(e,t);if(e.indexOf("rgb")>-1){const t=/\((\d*),\s?(\d*),\s?(\d*),?\s?(.*)?\)$/.exec(e);if(null!==t&&t.hasOwnProperty("1")&&t.hasOwnProperty("2")&&t.hasOwnProperty("3")){const e={};return e.r=parseInt(t[1],10),e.g=parseInt(t[2],10),e.b=parseInt(t[3],10),e.r=Math.max(0,Math.min(255,e.r)),e.g=Math.max(0,Math.min(255,e.g)),e.b=Math.max(0,Math.min(255,e.b)),ca(e)}}return""},Ta=e=>{let t=1;if(e=String(e).toLowerCase().trim(),ga(e)){const s=/\((\d*),\s?(\d*),\s?(\d*),?\s?(.*)?\)$/.exec(e);null!==s&&s.hasOwnProperty("4")&&!Number.isNaN(Number(s[4]))&&(t=parseFloat(s[4]))}else{const s=e.split(":");t=void 0===s[1]?1:parseInt(s[1],10)/100}return t=Math.max(0,Math.min(1,t)),t},wa=(e,t)=>{const s=_a(e);if(1===(t=ha(t)?+t.toFixed(2):1))return`#${s}`;const i=pa(s);return`rgba(${i.r}, ${i.g}, ${i.b}, ${t})`},ka=(e="")=>"string"!=typeof e?e:String(e).replace(/[^\da-f]/gi,"").slice(0,8),Aa=e=>(e=ka(e),+(parseInt(e.slice(6,8),16)/255).toFixed(2)),Ea=e=>{if(fa(e)){const t=ka(e).slice(0,6);return va(t)?t:""}return e},Ia=e=>!!e&&(0===e.hsb.s||0===e.hsb.b),Ca=e=>!!e&&e.some((e=>Ia(e))),Sa=(e,t,s=!1)=>{var i,a;let n;const r=_a(e),o=(e=>"object"==typeof e&&e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("b"))(e)?e:ua(r),l=pa(r);return t=parseFloat(null==(i=t)?void 0:i.toString()),1!==(t=+De(0,t=Number.isNaN(t)?null!=(a=Ta(e))?a:1:t,1).toFixed(2))?(n=`rgba(${l.r}, ${l.g}, ${l.b}, ${t})`,l.a=t):n=s?"auto":`#${r}`,{value:n,opacity:t,hex:r,hsb:o,rgb:l}};function $a(e,t=0){var s;const i=null==(s=String(e).match(/linear|radial/))?void 0:s[0];if(!i)return null;e=function(e){return Object.entries({"to top":"0deg","to right":"90deg","to bottom":"180deg","to left":"270deg","to right top":"45deg","to top right":"45deg","to right bottom":"135deg","to bottom right":"135deg","to left bottom":"225deg","to bottom left":"225deg","to left top":"315deg","to top left":"315deg"}).reduce(((e,[t,s])=>e.includes(t)?e.replace(t,s):e),e)}(e=e.trim().replace(";",""));const[a,n,r]=e.match(/gradient\((?:(-?\d+\.?\d*)(?:deg)?\s*,)?(.*)\)$/),o=Number.isNaN(parseFloat(n))?180:parseFloat(n),l=Array.from(r.matchAll(/(#(?:[\dA-Fa-f]{8}|[\dA-Fa-f]{6}|[\dA-Fa-f]{3})|rgba?\([^)]+\)|[a-z]+)\s*([\d.-]*(?:%|px|em))?/g)),d=[],c=[];l.forEach((([e,t,s],i)=>{if(null==s){s=100/(l.length-1)*i+"%"}d.push(Sa(t)),c.push(parseFloat(s))}));const p={value:e,activeColorIndex:t,type:i,angle:o,colors:d,fillability:c};return p.value=Ba(p),p}function Ba({colors:e,angle:t,fillability:s,type:i}){var a,n,r,o;i=null!=(a=i)?a:"linear",t=null!=(n=t)?n:180,e=null!=(r=e)?r:[],s=null!=(o=s)?o:[0,100];const l=e.map(((e,t)=>`${e.value} ${s[t]}%`)).join(", ");return"radial"===i?`radial-gradient(${l})`:`linear-gradient(${t}deg, ${l})`}const Ua=(e,t=25)=>{const s=_a(e),i=Ta(e),a=ua(s),n=a;let r=null;switch(la.some(((e,t)=>{const s=e[0],i=e[1];return s.s<=a.s&&i.s>=a.s&&s.b<=a.b&&i.b>=a.b&&(r=t+1,!0)})),r){case 1:n.s-=t,n.b+=t/2;break;case 2:0===a.s||0===a.b?n.b-=t:(n.s+=t,n.b+=t/2);break;case 3:0===a.s||0===a.b||(n.s+=t),n.b+=t;break;case 4:n.s-=t,n.b+=t}return n.h=De(0,n.h+t,360),n.s=De(0,n.s,100),n.b=De(0,n.b,100),wa(ma(n),i)},Ra=(e=!1,t="color",s="last")=>{if(!["color","gradient"].includes(t)||!["saved","last"].includes(s))return;let i=JSON.parse(localStorage.getItem(`f_${s}_${t}s`)||"[]");if("last"===s){let s=[],a=[];"color"===t?(s=sa,a=aa,s=s.filter((e=>(va(e)||ga(e))&&!i.includes(e.toLowerCase()))),s=s.map((e=>va(e)&&!/#/.test(e)?`#${e}`:e)),e||(i=i.filter((e=>!e.includes("rgba"))))):"gradient"===t&&(s=ia,a=na,s=s.filter((e=>xa(e)&&!i.includes(e.toLowerCase()))),e||(i=i.filter((e=>!/rgba/.test(e))))),i=i.concat(s).slice(0,5),i=i.map((e=>e.toLowerCase())),i=i.concat(a)}else"saved"===s&&("color"===t?e||(i=i.filter((e=>!e.includes("rgba")))):"gradient"===t&&(e||(i=i.filter((e=>!/rgba/.test(e))))));return i},Pa={css:null,exports:{setup(e,{inject:t}){this.colorpicker=t("colorpicker"),this.state={isCorrect:!0,inFocused:!1,get data(){var t;return(null==(t=e.props)?void 0:t.data)||{}},get type(){return e.props.type},get value(){var t;return null!=(t=e.props.value)?t:this.data[this.type]},get step(){return e.props.step||1},get upDownChange(){return e.props.upDownChange},get inputType(){return["opacity","angle"].includes(this.type)?"number":"text"}},this.meta={is:"input",min:+e.props.min,max:+e.props.max,loop:e.props.loop,oldValue:e.props.value,get validKey(){const t=[8,9,16,46,37,39];return e.state.upDownChange?t.push(38,40):t}}},onUpdated(){const e=$(this.root).find("input").val();if("opacity"===this.state.type&&e<this.meta.min)return this.state.isCorrect=!0,$(this.root).find("input").val(this.meta.min),void this.commitValue(this.meta.min);$(this.root).find("input").val(this.state.value),this.meta.oldValue=this.state.value},onMounted(){this.normalizeValue()},focus(e){var t,s;null==(t=(s=this.props).onfocus)||t.call(s,e),this.state.inFocused=!0,$(this.root).addClass("focused"),this.update()},blur(e){var t,s;null==(t=(s=this.props).onblur)||t.call(s,e),this.state.inFocused=!1,$(this.root).removeClass("focused"),this.update()},updateValue(e){this.normalizeValue(e),this.commitValue(e)},commitValue(e){var t,s;let i=null!=(t=null==e||null==(s=e.target)?void 0:s.value)?t:e;if(this.state.isCorrect&&i!==this.meta.oldValue){if("hex"===this.state.type){var a,n;let t=null;fa(i)&&(this.colorpicker.options.showOpacity&&(t=Aa(i)),i=Ea(i),e.target.value=i),null==(a=(n=this.props).onUpdateValue)||a.call(n,{value:i,opacity:t},this.meta.is)}else if("opacity"===this.state.type){var r,o;null==(r=(o=this.props).onUpdateValue)||r.call(o,{opacity:i/100},this.meta.is)}else{var l,d;null==(l=(d=this.props).onUpdateValue)||l.call(d,i)}this.state.oldValue=i,$(this.root).removeClass("error")}},normalizeValue(e){const t=(null==e?void 0:e.target)||$(this.root).find("input"),s=(null==e?void 0:e.type)||"change";let i;"input"===s&&(i=e.inputType);const a="change"===s,n="keydown"===s,r="paste"===s||"insertFromPaste"===i,o=["deleteContentForward","deleteContentBackward"].includes(i);let l=t.value;if(this.state.type&&"hex"===this.state.type){if(r||o||a){if(r||a){if(l){var d;va(l)&&fa(l)||l===this.state.value||(l=l.replace(this.state.value,""));const e=l.split(" "),t=null!=(d=e[1])?d:e[0];t&&/[\da-f]/gi.test(t)&&(l=t)}fa(l)||(l="string"==typeof(c=l)&&va(c)?(3===(c=ka(c)).length&&(c=c[0]+c[0]+c[1]+c[1]+c[2]+c[2]),7===c.length&&(c+=c[6]),c):c)}}else l=ka(l),l=l.slice(0,6);if(t.value=l,!(va(l)||fa(l)&&r))return void this.inputError()}var c;if("number"===this.state.inputType){if((r||o)&&(l<this.meta.min||l>this.state.max||Number.isNaN(l)))return void this.inputError();if(l=(e=>{const t=String(e).replace(/[^\d.]/gi,"");return""!==e&&(+e<0?-t:+(+t).toFixed())})(l),!1===l)return t.value="",void this.inputError();if(l<this.meta.min)if(this.meta.loop&&this.meta.min-l==1)l=this.meta.max;else{if(!n)return void this.inputError();l=this.meta.min}else l>this.meta.max&&(l=this.meta.loop&&l-this.meta.max==1?this.meta.min:this.meta.max);t.value=l}this.state.isCorrect=!0,this.update()},upDownChange(e){if(""!==e.target.value&&!Number.isNaN(e.target.value)&&this.state.upDownChange&&[38,40].includes(e.keyCode)){if("keydown"===e.type){let t=+e.target.value;38===e.keyCode?t+=1:40===e.keyCode&&(t-=1),e.target.value=t,this.normalizeValue(e)}else"keyup"===e.type&&this.commitValue(e);e.preventDefault(),e.target.select()}},inputError(){this.state.isCorrect=!1,$(this.root).addClass("error"),$(this.root).trigger("error.colorpicker-input",{from:this.state.type})},shouldUpdate(){return!this.state.inFocused},triggerFocus(e){$(e.target).is("input")||$(this.root).find("input").trigger("focus").select()}},template:(e,t,s,i)=>e('<div expr1227="expr1227" class="colorpicker-input-wrap"><span expr1228="expr1228" class="colorpicker-prefix"></span><input expr1229="expr1229" type="text"/><span expr1230="expr1230" class="colorpicker-suffix"></span></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-input ",e.props.class," ",e.classNames({bordered:e.props.bordered})].join("")}]},{redundantAttribute:"expr1227",selector:"[expr1227]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.triggerFocus}]},{type:s.IF,evaluate:e=>e.props.prefix,redundantAttribute:"expr1228",selector:"[expr1228]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.props.prefix}]}])},{redundantAttribute:"expr1229",selector:"[expr1229]",expressions:[{type:t.VALUE,evaluate:e=>e.state.value},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.props.disabled},{type:t.EVENT,name:"onfocus",evaluate:e=>e.focus},{type:t.EVENT,name:"onblur",evaluate:e=>e.blur},{type:t.EVENT,name:"onkeydown",evaluate:e=>e.upDownChange},{type:t.EVENT,name:"onkeyup",evaluate:e=>e.upDownChange},{type:t.EVENT,name:"oninput",evaluate:e=>e.updateValue},{type:t.EVENT,name:"onpaste",evaluate:e=>e.updateValue},{type:t.EVENT,name:"onchange",evaluate:e=>e.normalizeValue}]},{type:s.IF,evaluate:e=>e.props.suffix,redundantAttribute:"expr1230",selector:"[expr1230]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.props.suffix}]}])}]),name:"colorpicker-input"};e(Pa.name,Pa);const Ha={css:null,exports:{setup(e,{inject:t}){const s=t("colorpicker");this.state={oldColorValue:"",get data(){return e.props.data},get color(){return this.data.hex},get opacity(){return Math.round(100*this.data.opacity)},get showOpacity(){return e.props.showOpacity},get previewStyle(){const e=pa(this.color),t=this.opacity/100,s=`rgba(${e.r}, ${e.g}, ${e.b}, 1)`,i=`rgba(${e.r}, ${e.g}, ${e.b}, ${t})`;return`background: linear-gradient(90deg,\n                    ${s} 0%,\n                    ${s} 50%,\n                    ${i} 50%,\n                    ${i} 100%);`},get lastUpdateFrom(){return e.props.lastUpdateFrom},get isContrastColor(){return ya(this.data.value)}},this.meta={is:"color-input",isFocused:!1,opacityError:!1,hexError:!1,get minOpacity(){return s.options.minOpacity},get maxOpacity(){return s.options.maxOpacity},get isError(){return this.hexError||this.opacityError}},this.colorpicker=s},onMounted(){$(this.root).find(".colorpicker-input").on("error.colorpicker-input",((e,{from:t})=>{e.stopPropagation(),t&&(this.meta[`${t}Error`]=!0,this.update())}))},onUpdated(){this.meta.hexError=!1,this.meta.opacityError=!1},commitColor({value:e,opacity:t}){var s,i;this.meta.hexError=!1,null==(s=(i=this.props).onUpdateValue)||s.call(i,{color:e,opacity:t},`${this.meta.is}.hex`)},commitOpacity({opacity:e}){var t,s;this.meta.opacityError=!1,null==(t=(s=this.props).onUpdateValue)||t.call(s,{opacity:e},`${this.meta.is}.opacity`)},click(){this.state.isContrastColor&&this.$(".colorpicker-color-input-color input").select()},updateActiveColor(e){var t,s;null==(t=(s=this.props).onUpdateActiveColor)||t.call(s,`${this.meta.is}.${$(e.target).closest(".colorpicker-input").attr("type")}`)},focus(e){var t,s;this.meta.isFocused=!0,this.updateActiveColor(e),null==(t=(s=this.props).onfocus)||t.call(s,e),this.update()},blur(e){var t,s;this.meta.isFocused=!1,null==(t=(s=this.props).onblur)||t.call(s,e),this.update()}},template:(e,t,s,i)=>e('<div class="colorpicker-color-input-wrap"><div class="colorpicker-color-input-color"><div expr1222="expr1222" class="colorpicker-preview"><span expr1223="expr1223"></span></div><div expr1224="expr1224" is="colorpicker-input" type="hex"></div></div><div expr1225="expr1225" class="colorpicker-color-input-opacity"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-color-input ",e.props.class," ",e.classNames({focused:e.meta.isFocused,error:e.meta.isError,"contrast-color":e.state.isContrastColor})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.click}]},{redundantAttribute:"expr1222",selector:"[expr1222]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.updateActiveColor}]},{redundantAttribute:"expr1223",selector:"[expr1223]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.state.previewStyle}]},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.isContrastColor?"auto":e.state.color},{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.state.data},{type:t.EVENT,name:"onfocus",evaluate:e=>e.focus},{type:t.EVENT,name:"onblur",evaluate:e=>e.blur},{type:t.EVENT,name:"onUpdateValue",evaluate:e=>e.commitColor}],redundantAttribute:"expr1224",selector:"[expr1224]"},{type:s.IF,evaluate:e=>e.state.showOpacity&&!e.state.isContrastColor,redundantAttribute:"expr1225",selector:"[expr1225]",template:e('<div expr1226="expr1226" is="colorpicker-input" type="opacity" suffix="%"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.state.data},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.opacity},{type:t.ATTRIBUTE,name:"min",evaluate:e=>100*e.meta.minOpacity},{type:t.ATTRIBUTE,name:"max",evaluate:e=>100*e.meta.maxOpacity},{type:t.ATTRIBUTE,name:"upDownChange",evaluate:e=>!0},{type:t.EVENT,name:"onfocus",evaluate:e=>e.focus},{type:t.EVENT,name:"onblur",evaluate:e=>e.blur},{type:t.EVENT,name:"onUpdateValue",evaluate:e=>e.commitOpacity}],redundantAttribute:"expr1226",selector:"[expr1226]"}])}]),name:"colorpicker-color-input"};e(Ha.name,Ha);const ja={css:null,exports:{setup(e){this.meta={get sprite(){return`/_s/images/editor/colorpicker.svg#${e.props.icon}`}}}},template:(e,t,s,i)=>e(' <svg expr1231="expr1231" class="colorpicker-icon"></svg><slot expr1233="expr1233"></slot>',[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.props.text].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-button ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.props.icon,redundantAttribute:"expr1231",selector:"[expr1231]",template:e('<use expr1232="expr1232"/>',[{redundantAttribute:"expr1232",selector:"[expr1232]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.meta.sprite}]}])},{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr1233",selector:"[expr1233]"}]),name:"colorpicker-button"};e(ja.name,ja);const Fa={css:null,exports:{setup(e,{inject:t}){const s=t("colorpicker");this.state={_activeIndex:"fillability"===e.props.type?s.colorState.gradient.activeColorIndex:0,get data(){return e.props.data},get type(){return e.props.type},get spectrumHsb(){return e.props.spectrumHsb},get value(){return"spectrum"===this.type?this.data.hsb:"opacity"===this.type?this.data.opacity:null},get gradient(){return s.colorState.gradient},get colors(){return this.gradient.colors},get fillability(){return this.gradient.fillability},get activeIndex(){return this._activeIndex},get lastUpdateFrom(){return e.props.lastUpdateFrom},get style(){if("opacity"===this.type){return`background: linear-gradient(90deg, ${wa(this.data.hex,e.meta.minOpacity)}, ${wa(this.data.hex,e.meta.maxOpacity)});`}if("fillability"===this.type){const e=this.colors[this.activeIndex].value;return`background: ${Ba({...s.colorState.gradient,angle:90,type:"linear"})}; --activeColor: ${e}`}return""},get needAnimate(){return["view","favorite-list","color-input","color-input.hex","color-input.opacity","color-input.auto","pipette"].includes(this.lastUpdateFrom)}},this.meta={is:`range.${e.props.type}`,dotSize:10,rangePadding:2,rangeWidth:200,animationTime:70,dotPosition:[0],stickingDistance:4,get minOpacity(){return s.options.minOpacity},get maxOpacity(){return s.options.maxOpacity},get rangeIndent(){return this.dotSize/2+this.rangePadding},get step(){return"opacity"===e.props.type?this.rangeWidth/(100*(this.maxOpacity-this.minOpacity)):1}},this.colorpicker=s},onBeforeMount(){$(window).on(`pointermove.range-${this.state.type}`,(e=>{this.inMove&&this.move(e)})),$(window).on(`pointerup.range-${this.state.type}`,(()=>{this.inMove&&(this.inMove=!1)}))},onBeforeUnmount(){$(window).off(`.range-${this.state.type}`)},onMounted(){"fillability"===this.state.type&&(this.meta.dotPosition=this.getPositionFromValue()),this.updateView("mount")},onBeforeUpdate(){"fillability"===this.state.type&&(this.state._activeIndex=this.state.gradient.activeColorIndex),["spectrum","range.spectrum","range.opacity"].includes(this.state.lastUpdateFrom)||this.inMove||this.updateView("update")},onUpdated(){this.updateIndexes()},startMove(e){if("fillability"===this.state.type&&$(e.target).length){if($(e.target).hasClass("colorpicker-range"))return;const t=+$(e.target).attr("index");t!==this.state.activeColorIndex&&this.colorpicker.updateGradient({color:{index:t}},!0,!0,!1)}this.inMove=!0,this.updateIndexes(),this.updateRect();const t=e.pageX-this.meta.rangeLeft;this.updatePosition(t),this.checkFillPosition()},move(e){e.preventDefault(),e.stopPropagation();const t=e.pageX-this.meta.rangeLeft;this.updatePosition(t,!0,!1,!0),this.checkFillPosition()},keydown(e){e.preventDefault();let t=this.meta.dotPosition[this.state.activeIndex];if(e.key.includes("Arrow")){const s=e.shiftKey&&"fillability"!==this.state.type?10*this.meta.step:this.meta.step;switch(e.key){case"ArrowLeft":t-=s;break;case"ArrowRight":t+=s}}else if("Home"===e.key)t=0;else{if("End"!==e.key)return["Backspace","Delete"].includes(e.key)?void(this.state.colors.length>2&&this.removeDot()):void 0;t=this.meta.rangeWidth}this.updatePosition(t),this.checkFillPosition()},updateView(e){setTimeout((()=>{this.updateRect();const t="range.fillability"!==this.state.lastUpdateFrom,s=this.getPositionFromValue(t?null:this.state.fillability[this.state.activeIndex]);this.updatePosition(s,!1,"update"===e)}),10)},updatePosition(e,t=!0,s=!1,i=!1){if(Array.isArray(e))e.forEach(((e,t)=>{e=De(0,e,this.meta.rangeWidth);const i=$(this.root).find(`.colorpicker-dot[index="${t}"]`)[0],a=`${e+this.meta.rangePadding}px`;anime({targets:i,left:a,duration:this.state.needAnimate&&s?this.meta.animationTime:0,easing:"easeInOutSine"}),i.style.setProperty("--offset",a)})),this.meta.dotPosition=e;else{if(e=De(0,e,this.meta.rangeWidth),i&&"fillability"===this.state.type){const{position:t,difference:s}=this.getNearestDot(e);s<this.meta.stickingDistance&&(e=t)}const t=$(this.root).find(`.colorpicker-dot[index="${this.state.activeIndex}"]`)[0],a=`${e+this.meta.rangePadding}px`;anime({targets:t,left:a,duration:this.state.needAnimate&&s?this.meta.animationTime:0,easing:"easeInOutSine"}),t.style.setProperty("--offset",a),this.meta.dotPosition[this.state.activeIndex]=e}t&&this.commit()},removeDot(){var e,t;if("fillability"!==this.state.type)return;const s=this.state.fillability.filter(((e,t)=>t!==this.state.activeIndex)),i=this.state.colors.filter(((e,t)=>t!==this.state.activeIndex)),a=this.meta.dotPosition.filter(((e,t)=>t!==this.state.activeIndex)),n=De(0,this.state.activeIndex,s.length-1);null==(e=(t=this.props).onremove)||e.call(t,s,i,n,this.meta.is),this.updatePosition(a,!1,!0,!0),this.checkFillPosition()},addDot(e){var t,s;if("fillability"!==this.state.type||this.state.colors.length>=7||$(e.target).hasClass("colorpicker-dot"))return;const i=e.pageX-this.meta.rangeLeft,a=[...this.meta.dotPosition,i].sort(((e,t)=>e-t)),n=a.indexOf(i),r=[...this.state.colors.slice(0,n),null,...this.state.colors.slice(n)],o=this.getValueFromPosition(a),l=n-1,d=n+1,c=r[l],p=r[d];let u=c||p;if(c&&p){const e=(i-a[l])/(a[d]-a[l]),t=p.opacity*e;u=Fe([c.value,wa(p.hex,t)],1),u=Sa(wa(u,(m=c.opacity,h=p.opacity,m*(1-(g=e))+h*g)))}var m,h,g;r[n]=u,null==(t=(s=this.props).onadd)||t.call(s,o,r,n,this.meta.is),this.updatePosition(a,!1,!0,!0),this.checkFillPosition()},getNearestDot(e){if(this.meta.dotPosition.length<=1)return null;const t=this.meta.dotPosition.filter(((e,t)=>t!==this.state._activeIndex)).map((t=>Math.abs(t-e))),s=t.indexOf(Math.min(...t));return{index:s,difference:t[s],position:this.meta.dotPosition[s]}},updateRect(){const e=this.root.getBoundingClientRect(),t=(e.width-2*this.meta.rangeIndent)/e.width;this.meta.rangeLeft=e.left+this.meta.rangePadding+this.meta.dotSize/2,this.meta.rangeWidth=e.width*t,this.meta.rangeFactor=t},getPositionFromValue(e){const t=this.meta.rangeWidth;if("spectrum"===this.state.type){const e=this.state.spectrumHsb;let s=t*(e.h/360);return s=De(0,t,s),s=0===s?t:s,s}if("opacity"===this.state.type){let e=(this.state.value-this.meta.minOpacity)*(1/(this.meta.maxOpacity-this.meta.minOpacity))*t;return e=De(0,t,e),e}if("fillability"===this.state.type)return null!=e?De(0,t,e*t/100):this.state.fillability.map((e=>De(0,e*t/100,t)))},getValueFromPosition(e){const t=this.meta.rangeWidth;if("spectrum"===this.state.type){const s=this.state.value;let i=Math.round(e/t*360);return i=De(.25,i,360),s.h=i,{color:s}}if("opacity"===this.state.type){return{opacity:(e/t).toFixed(2)*(this.meta.maxOpacity-this.meta.minOpacity)+this.meta.minOpacity}}if("fillability"===this.state.type){return(Array.isArray(e)?e:this.meta.dotPosition).map((e=>+(e/t*100).toFixed(2))).sort(((e,t)=>e-t))}},updateIndexes(){$(this.root).find(".colorpicker-dot").removeClass("active"),$(this.root).find(`[index="${this.state.activeIndex}"]`).addClass("active")},checkFillPosition(){if("fillability"!==this.state.type)return;const e=this.meta.dotPosition[this.state.activeIndex],t=this.state.activeIndex;this.meta.dotPosition.forEach(((s,i)=>{if(i!==t&&(e<s&&t>i||e>s&&t<i)){this.colorpicker.sortGradientColors({oldIndex:t,newIndex:i},!0),this.meta.dotPosition.splice(i,0,this.meta.dotPosition.splice(t,1)[0]);const e=$(this.root).find(`[index="${t}"]`),s=$(this.root).find(`[index="${i}"]`);e.attr("index",i).addClass("active"),s.attr("index",t).removeClass("active"),this.state._activeIndex=i,this.update()}}))},commit(){var e,t;const s=this.getValueFromPosition(this.meta.dotPosition[this.state.activeIndex]);null==(e=(t=this.props).onmove)||e.call(t,s,this.meta.is)}},template:(e,t,s,i)=>e('<template expr1234="expr1234"></template><template expr1235="expr1235"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-range ",e.props.class," ",e.state.type," ",e.classNames({"bg-tile":"opacity"===e.state.type})].join("")},{type:t.ATTRIBUTE,name:"tabindex",evaluate:e=>"-1"},{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.startMove},{type:t.EVENT,name:"onkeydown",evaluate:e=>e.keydown},{type:t.EVENT,name:"onclick",evaluate:e=>e.addDot},{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.state.style}]},{type:s.IF,evaluate:e=>"opacity"===e.state.type||"spectrum"===e.state.type,redundantAttribute:"expr1234",selector:"[expr1234]",template:e('<i class="colorpicker-dot" tabindex="-1" index="0"></i>',[])},{type:s.IF,evaluate:e=>"fillability"===e.state.type,redundantAttribute:"expr1235",selector:"[expr1235]",template:e('<i expr1236="expr1236" tabindex="-1"></i>',[{type:s.EACH,getKey:null,condition:null,template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-dot fill ",e.classNames({active:e.state.activeIndex===e.index})].join("")},{type:t.ATTRIBUTE,name:"index",evaluate:e=>e.index}]}]),redundantAttribute:"expr1236",selector:"[expr1236]",itemName:"color",indexName:"index",evaluate:e=>e.state.colors}])}]),name:"colorpicker-range"};e(Fa.name,Fa);const La={css:null,exports:{setup(e){this.state={get data(){return e.props.data},get hsb(){return this.data.hsb},get spectrumHsb(){return e.props.spectrumHsb},get value(){return this.data.hex},get lastUpdateFrom(){return e.props.lastUpdateFrom},get style(){return`background-color: #${ma({h:this.spectrumHsb.h,s:100,b:100})}`},get needAnimate(){return["view","favorite-list","color-input","color-input.hex","color-input.opacity","color-input.auto","pipette"].includes(this.lastUpdateFrom)}},this.meta={is:"spectrum",animationTime:70,dotPosition:{x:0,y:0}}},onBeforeMount(){this.bindEvents()},onMounted(){this.updateView("mount")},onBeforeUnmount(){$(window).off(".colorpicker")},onUpdated(){["range.spectrum","range.opacity"].includes(this.state.lastUpdateFrom)||this.updateView("update")},bindEvents(){$(window).on("pointermove.colorpicker",(e=>{this.inMove&&this.move(e)})),$(window).on("pointerup.colorpicker",(()=>{this.inMove&&(this.inMove=!1)}))},startMove(e){this.inMove=!0,this.updateRect();const t={x:e.clientX-this.spectrumRect.left,y:e.clientY-this.spectrumRect.top};this.updatePosition(t,!0)},move(e){e.preventDefault(),e.stopPropagation();const t={x:e.clientX-this.spectrumRect.left,y:e.clientY-this.spectrumRect.top};this.updatePosition(t)},keydown(e){if(e.key.includes("Arrow")){const t=this.meta.dotPosition,s=e.shiftKey?20:1;switch(e.key){case"ArrowUp":t.y-=s;break;case"ArrowDown":t.y+=s;break;case"ArrowLeft":t.x-=s;break;case"ArrowRight":t.x+=s}this.updatePosition(t)}},updateView(e){setTimeout((()=>{this.updateRect();const t=ua(this.state.value),s=this.getPositionFromHSB(t);if("update"===e){if(Math.max(Math.abs(this.meta.dotPosition.x-s.x),Math.abs(this.meta.dotPosition.y-s.y))<3)return}this.updatePosition(s,!1,"update"===e)}),10)},updateRect(){this.spectrumRect=this.root.getBoundingClientRect()},updatePosition(e,t=!0,s=!1){e.x>this.spectrumRect.width?e.x=this.spectrumRect.width:e.x<0?e.x=0:e.y>this.spectrumRect.height?e.y=this.spectrumRect.height:e.y<0&&(e.y=0),e.x=De(0,this.spectrumRect.width,e.x),e.y=De(0,this.spectrumRect.height,e.y),anime({targets:this.$(".colorpicker-dot"),top:`${e.y}px`,left:`${e.x}px`,duration:this.state.needAnimate&&s?this.meta.animationTime:0,easing:"easeInOutSine"}),this.meta.dotPosition=e,t&&this.commit()},getPositionFromHSB(e){const t=this.spectrumRect.width,s=this.spectrumRect.height;let i=Math.round(e.s/(100/t)),a=s-Math.round(e.b/(100/s));return i=De(0,t,i),a=De(0,s,a),{x:i,y:a}},getValue({x:e,y:t}){let s=Math.round(e*(100/this.spectrumRect.width));s=De(0,100,s);let i=100-Math.round(t*(100/this.spectrumRect.height));i=De(0,100,i);const a=this.state.spectrumHsb;return a.s=s,a.b=i,ma(a)},commit(){var e,t;const s=this.getValue(this.meta.dotPosition);null==(e=(t=this.props).onmove)||e.call(t,{color:s},this.meta.is)},shouldUpdate(e){return!(this.inMove||"spectrum"===e.lastUpdateFrom)}},template:(e,t,s,i)=>e('<i class="colorpicker-dot large"></i>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"colorpicker-spectrum"},{type:t.ATTRIBUTE,name:"tabindex",evaluate:e=>"-1"},{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.startMove},{type:t.EVENT,name:"onkeydown",evaluate:e=>e.keydown},{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.state.style}]}]),name:"colorpicker-spectrum"};e(La.name,La);const Na={css:null,exports:{_editingTimeout:null,setup(e,{provide:t}){const s=e.props.colorpicker,i=s.getActiveColorState();t("colorpicker",s),this.state={_activeData:i,_spectrumHsb:i.hsb,inEditing:!1,inMove:!1,get options(){return s.options},get data(){return s.colorState},get activeData(){return this._activeData},get activeValue(){return this.data.value},get activeColorValue(){return this.activeData.value},get activeOpacity(){return this.activeData.opacity},get activeHsb(){return this.activeData.hsb},get activeSpectrumHsb(){return this._spectrumHsb},get isAutoColor(){return ya(this.activeValue)},get type(){return this.data.type},get gradientState(){return this.data.gradient},get activeGradientValue(){return this.gradientState.value},get gradientColors(){return this.gradientState.colors},get isRadialGradient(){return"radial"===this.gradientState.type},get gradientAngle(){return this.isRadialGradient?0:0===this.gradientState.angle?360:this.gradientState.angle},get gradientActiveIndex(){return this.gradientState.activeColorIndex},get contrast(){return this.activeOpacity<.3?"dark":Pe(this.activeValue,"dark","light")}},this.meta={lastUpdateFrom:null,titleText:s.getLocale("title"),doneButtonText:s.getLocale("doneButton"),colorTabText:s.getLocale("tab","color"),gradientTabText:s.getLocale("tab","gradient"),activeGradientDot:0,editorSelectors:".colorpicker-spectrum, .colorpicker-range, .colorpicker-input input",angleValues:[{name:"bottom",value:180,invertedValue:360},{name:"right",value:90,invertedValue:270},{name:"right-bottom",value:135,invertedValue:315},{name:"left-bottom",value:225,invertedValue:45}],get colorList(){return Ra(s.options.showOpacity,e.state.type)},get favoriteList(){return this.colorStoreSupported?colorStore.getList(e.state.type):[]},get displayFavoriteList(){return this.favoriteList.slice(0,6)},get showAddedItem(){return!!("color"===e.state.type&&ba(e.state.activeValue)||"gradient"===e.state.type&&xa(e.state.activeValue))&&!this.favoriteList.includes(e.state.activeValue)},get showPalette(){return s.options.showPalette},get showOpacity(){return s.options.showOpacity},get showGradient(){return s.options.showGradient},get addedItemStyle(){return"gradient"===e.state.type?`background: ${e.state.activeGradientValue}`:`background: ${e.state.activeColorValue}`},get needAnimateAddedItem(){return this.favoriteList.length<=5},get colorStoreSupported(){return"object"==typeof colorStore},get eyeDropperSupport(){return!/Opera|OPR\//.test(navigator.userAgent)&&"function"==typeof EyeDropper}},this.colorpicker=s},onBeforeMount(){this.colorpicker.on("action:updateUiState",(({force:e})=>{!e&&this.state.inEditing||(this.state._activeData=this.colorpicker.getActiveColorState()),this.state.inEditing||(this.meta.lastUpdateFrom="view")})),"gradient"===this.state.type&&Ca(this.state.gradientColors)&&(Ia(this.state.activeData)?this.state.gradientColors.forEach((e=>{Ia(e)||(this.state._spectrumHsb=e.hsb)})):this.state._spectrumHsb=this.state.activeData.hsb),$(document).on("pointerup.colorpicker",this.pointerup)},onMounted(){this._hotkeysDisposer=fs.register([{hotkeys:["i"],options:{excluded:[],preventDefault:!0},handlerDown:()=>{this.showPicker()}}]),setTimeout((()=>{this.$(".colorpicker-spectrum").focus()}),50)},onBeforeUnmount(){var e;null==(e=this._hotkeysDisposer)||e.call(this),((e,t=!1,s="last")=>{if(!["saved","last"].includes(s)||ya(e))return;let i="";if(xa(e))i="gradient";else{if(!ba(e))return;i="color"}let a=Ra(t,i,s);a.includes(e.toLowerCase())||(a.unshift(e),a=a.splice(0,5),localStorage.setItem(`f_${s}_${i}s`,JSON.stringify(a)))})(this.state.activeValue,this.state.activeOpacity),$(document).off(".colorpicker"),$(window).off(".colorpicker")},onBeforeUpdate(){["tab","spectrum","range.opacity","color-input.opacity","color-input.auto"].includes(this.meta.lastUpdateFrom)||("range.spectrum"!==this.meta.lastUpdateFrom&&"gradient"===this.state.type&&Ca(this.state.gradientColors)?Ia(this.state.activeData)?this.state.gradientColors.forEach((e=>{Ia(e)||(this.state._spectrumHsb=e.hsb)})):this.state._spectrumHsb=this.state.activeData.hsb:this.state._spectrumHsb=((e,t=null,s=!1)=>(0===e.s||0===e.b)&&e.h===t.h&&t||s&&(e.s!==t.s||e.b!==t.b)?t:e)(this.state.activeHsb,this.state.activeSpectrumHsb));const e=$(this.root).attr("tab"),t=$(this.root).find(".colorpicker-list-shot .colorpicker-color-item:not(.add-color)");e===this.state.type&&t.length<this.meta.favoriteList.length&&(this.meta.isAddedColor=!0)},onUpdated(){this.meta.isAddedColor&&(this.animateItem(),this.meta.isAddedColor=!1)},pointerdown(e){const t=$(e.target).closest(".colorpicker-tabs-list"),s=$(e.target).closest(".palette-button");if(t.length||s.length){const{pageX:t,pageY:s}=e;this.initialCoords={pageX:t,pageY:s}}this.state.inMove=!0,this.colorpicker.closeAccessoryModals(),this.changeFocusState(e)},pointerup(e){const t=$(e.target).closest(".colorpicker-tabs-list"),s=$(e.target).closest(".palette-button");if(this.initialCoords){if(t.length&&!this.modalWasMovement(e)){const t=$(e.target).attr("name");t&&t!==this.state.type&&(this.editingProcess(),this.meta.lastUpdateFrom="tab",this.colorpicker.setType(t))}else s.length&&!this.modalWasMovement(e)&&this.colorpicker.openPalette();this.initialCoords=null}this.state.inMove=!1},changeFocusState(e,t){const s=this.meta.editorSelectors;if(t)return $(s).blur().removeClass("focused"),void(this.state.inEditing=!1);const i=$(e.target);i.is(".colorpicker")||i.closest(".colorpicker-head").length||(this.state.inEditing=!0,i.is("input")||e.stopPropagation(),i.hasClass("focused")||($(s).blur().removeClass("focused"),i.is(s)?i.focus().addClass("focused"):i.closest(s).length?i.closest(s).focus().addClass("focused"):this.state.inEditing=!1))},applyFromFavorite(e){const t=$(e.target).closest("[color]").attr("color");if(t)if("color"===this.state.type&&this.state.activeColorValue!==t){const e=ga(t)&&this.meta.showOpacity?Ta(t):1;this.updateColor({color:t,opacity:e},"favorite-list")}else if("gradient"===this.state.type&&this.state.activeGradientValue!==t){const e=this.meta.showOpacity?t:Le(t,1);this.updateColor({gradient:e},"favorite-list")}},setGradientType(e){this.updateGradient({type:e})},moveFillabilityItem(e,t){this.updateGradient({fromComponent:t,fillability:e})},removeFillabilityItem(e,t,s,i){this.updateGradient({fromComponent:i,fillability:e,colors:t,activeColorIndex:s})},addFillabilityItem(e,t,s,i){this.updateGradient({fromComponent:i,fillability:e,colors:t,activeColorIndex:s})},updateGradient(e){const{fromComponent:t,...s}=e;this.editingProcess(),this.meta.lastUpdateFrom=t,this.colorpicker.updateGradient(s,!0,!0,!0)},handleAngle(e){let t=e.value;this.state.gradientAngle===t&&(t=(t+180)%360),0===t&&(t=360),this.updateAngle(t)},updateAngle(e){this.editingProcess(),this.meta.lastUpdateFrom="angle-editor",this.colorpicker.updateGradient({angle:e,type:"linear"},!0,!0,!0)},isAngleActive(e){return[e.value,e.invertedValue].includes(this.state.gradientAngle)},getAngleIcon(e){const t=this.state.gradientAngle===e.invertedValue;return`arrow-${e.name}${t?"-invert":""}`},updateColor({color:e,opacity:t,gradient:s},i,a=!0,n=!0){i&&(this.meta.lastUpdateFrom=i),e=e||this.state.activeColorValue,t=ha(t)?+t:"view"===i?Ta(e):this.state.activeOpacity;const r=wa(e,t),o="gradient"===this.state.type?this.state.activeGradientValue!==s:this.state.activeColorValue!==r,l=a&&o;this.editingProcess(),"color"===this.state.type?this.colorpicker.updateColor({color:e,opacity:t},n,!0,l):"gradient"===this.state.type&&this.colorpicker.updateGradient({gradientValue:s,color:{value:e,opacity:t}},n,!0,l)},addToFavorite(e){const t=$(e.target).attr("color");this.meta.isAddedColor=!0,this.colorpicker.addToFavorite(t)},toggleContrast(){const e=this.state.isAutoColor?"#969696":"auto";this.updateColor({color:e,opacity:1},"color-input.auto")},animateItem(){if(!this.meta.needAnimateAddedItem)return;const e=$(this.root).find(".colorpicker-color-item.added"),t=$(this.root).find(".colorpicker-color-item.add-color"),s=e.position(),i=t.position();s&&i&&anime({targets:e[0],left:[i.left-s.left-5,0],duration:250,easing:"easeInOutSine"})},editingProcess(e=200){this.state.inEditing=!0,clearTimeout(this._editingTimeout),this._editingTimeout=setTimeout((()=>{this.state.inEditing=this.state.inMove,this.update()}),e)},updateActiveColor(e,t){"gradient"===this.state.type&&(t&&(this.meta.lastUpdateFrom=t),this.colorpicker.updateGradient({color:{index:e}},!0,!0,!1))},modalWasMovement(e){const{pageX:t,pageY:s}=e;return+Math.sqrt((t-this.initialCoords.pageX)**2+(s-this.initialCoords.pageY)**2).toFixed(0)>=35},close(){this.colorpicker.close()},async showPicker(){if(this.meta.eyeDropperSupport){const e=new EyeDropper;this.state.pipetteActive=!0,this.update();try{const{sRGBHex:t}=await e.open();$("input",this.root).trigger("blur"),this.updateColor({color:t,opacity:1},"pipette")}catch(e){}this.state.pipetteActive=!1,this.update()}}},template:(e,t,s,i)=>e('<div class="colorpicker-head"><div expr1237="expr1237" class="colorpicker-tabs-list"></div><div expr1240="expr1240" class="colorpicker-title"></div><div class="button-line"><template expr1241="expr1241"></template><div expr1244="expr1244" is="colorpicker-button" icon="palette"></div></div></div><div expr1245="expr1245" is="colorpicker-spectrum"></div><div class="ranges-line"><div expr1246="expr1246" is="colorpicker-range" type="spectrum"></div><div expr1247="expr1247" is="colorpicker-range" type="opacity"></div></div><div expr1248="expr1248" class="color-tab"></div><div expr1253="expr1253" class="gradient-tab"></div><div expr1261="expr1261"></div><div expr1267="expr1267" class="colorpicker-colors"></div><div expr1270="expr1270" is="colorpicker-button" class="apply-button"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-colorpicker ",e.classNames({on:e.state.inEditing,"not-draggable":"modal"!==e.state.options.container})].join("")},{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.pointerdown},{type:t.ATTRIBUTE,name:"tab",evaluate:e=>e.state.type}]},{type:s.IF,evaluate:e=>e.meta.showGradient,redundantAttribute:"expr1237",selector:"[expr1237]",template:e('<div expr1238="expr1238" is="colorpicker-button" name="color"></div><div expr1239="expr1239" is="colorpicker-button" name="gradient"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["tab ",e.classNames({active:"color"===e.state.type})].join("")},{type:t.ATTRIBUTE,name:"text",evaluate:e=>e.meta.colorTabText}],redundantAttribute:"expr1238",selector:"[expr1238]"},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["tab ",e.classNames({active:"gradient"===e.state.type})].join("")},{type:t.ATTRIBUTE,name:"text",evaluate:e=>e.meta.gradientTabText}],redundantAttribute:"expr1239",selector:"[expr1239]"}])},{type:s.IF,evaluate:e=>!e.meta.showGradient,redundantAttribute:"expr1240",selector:"[expr1240]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.meta.titleText}]}])},{type:s.IF,evaluate:e=>"gradient"===e.state.type,redundantAttribute:"expr1241",selector:"[expr1241]",template:e('<div expr1242="expr1242" is="colorpicker-button" title="Linear"></div><div expr1243="expr1243" is="colorpicker-button" title="Radial"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[{id:"default",html:'<svg class="colorpicker-icon" viewBox="0 0 16 16" fill="none"><path d="M1 1H15V15H1V1Z" fill="url(#linear-gradient-icon)"/><defs><lineargradient id="linear-gradient-icon" x1="8" y1="-1" x2="8" y2="17" gradientUnits="userSpaceOnUse"><stop stop-color="#30343B"/><stop offset="1" stop-color="#30343B" stop-opacity="0"/></lineargradient></defs></svg>',bindings:[]}],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["icon-button fill hover-border small small-icon not-disable ",e.state.isRadialGradient?"":"active"].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.setGradientType("linear")}],redundantAttribute:"expr1242",selector:"[expr1242]"},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[{id:"default",html:'<svg class="colorpicker-icon" viewBox="0 0 16 16" fill="none"><path d="M0 0H16V16H0V0Z" fill="url(#radial-gradient-icon)"/><defs><radialgradient id="radial-gradient-icon" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(8 8) rotate(90) scale(8)"><stop stop-color="#30343B"/><stop offset="1" stop-color="#30343B" stop-opacity="0"/></radialgradient></defs></svg>',bindings:[]}],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["icon-button fill hover-border small small-icon not-disable ",e.state.isRadialGradient?"active":""].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.setGradientType("radial")}],redundantAttribute:"expr1243",selector:"[expr1243]"}])},{type:s.IF,evaluate:e=>e.meta.showPalette,redundantAttribute:"expr1244",selector:"[expr1244]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["palette-button small small-icon bordered ",e.colorpicker._paletteIsOpen?"disabled":""].join("")}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-spectrum",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.state.activeData},{type:t.ATTRIBUTE,name:"spectrumHsb",evaluate:e=>e.state.activeSpectrumHsb},{type:t.ATTRIBUTE,name:"lastUpdateFrom",evaluate:e=>e.meta.lastUpdateFrom},{type:t.EVENT,name:"onmove",evaluate:e=>e.updateColor}],redundantAttribute:"expr1245",selector:"[expr1245]"},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-range",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.state.activeData},{type:t.ATTRIBUTE,name:"spectrumHsb",evaluate:e=>e.state.activeSpectrumHsb},{type:t.ATTRIBUTE,name:"lastUpdateFrom",evaluate:e=>e.meta.lastUpdateFrom},{type:t.EVENT,name:"onmove",evaluate:e=>e.updateColor}],redundantAttribute:"expr1246",selector:"[expr1246]"},{type:s.IF,evaluate:e=>e.meta.showOpacity,redundantAttribute:"expr1247",selector:"[expr1247]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-range",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.state.activeData},{type:t.ATTRIBUTE,name:"lastUpdateFrom",evaluate:e=>e.meta.lastUpdateFrom},{type:t.EVENT,name:"onmove",evaluate:e=>e.updateColor}]}])},{type:s.IF,evaluate:e=>"color"===e.state.type,redundantAttribute:"expr1248",selector:"[expr1248]",template:e('<div class="input-line"><div expr1249="expr1249" is="colorpicker-color-input"></div><div expr1250="expr1250" class="button-line"></div></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-color-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.state.activeData},{type:t.ATTRIBUTE,name:"showOpacity",evaluate:e=>e.meta.showOpacity},{type:t.EVENT,name:"onUpdateValue",evaluate:e=>e.updateColor}],redundantAttribute:"expr1249",selector:"[expr1249]"},{type:s.IF,evaluate:e=>e.state.options.showAutocolor||e.meta.eyeDropperSupport,redundantAttribute:"expr1250",selector:"[expr1250]",template:e('<div expr1251="expr1251" is="colorpicker-button" icon="auto-color" title="Auto"></div><div expr1252="expr1252" is="colorpicker-button" icon="pipette"></div>',[{type:s.IF,evaluate:e=>e.state.options.showAutocolor,redundantAttribute:"expr1251",selector:"[expr1251]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>[e.state.isAutoColor?"active":""," not-disable"].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.toggleContrast}]}])},{type:s.IF,evaluate:e=>e.meta.eyeDropperSupport,redundantAttribute:"expr1252",selector:"[expr1252]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>[e.state.pipetteActive?"active":""," not-disable"].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.showPicker}]}])}])}])},{type:s.IF,evaluate:e=>"gradient"===e.state.type,redundantAttribute:"expr1253",selector:"[expr1253]",template:e('<div class="input-line"><div expr1254="expr1254" is="colorpicker-color-input"></div><div expr1255="expr1255" class="button-line"></div></div><div expr1257="expr1257" is="colorpicker-range" type="fillability"></div><div expr1258="expr1258" class="gradient-params"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-color-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.state.gradientColors[e.state.gradientActiveIndex]},{type:t.ATTRIBUTE,name:"lastUpdateFrom",evaluate:e=>e.meta.lastUpdateFrom},{type:t.ATTRIBUTE,name:"showOpacity",evaluate:e=>e.meta.showOpacity},{type:t.EVENT,name:"onUpdateValue",evaluate:e=>e.updateColor},{type:t.EVENT,name:"onUpdateActiveColor",evaluate:e=>e.updateActiveColor.bind(null,e.index)}],redundantAttribute:"expr1254",selector:"[expr1254]"},{type:s.IF,evaluate:e=>e.meta.eyeDropperSupport,redundantAttribute:"expr1255",selector:"[expr1255]",template:e('<div expr1256="expr1256" is="colorpicker-button" icon="pipette"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>[e.state.pipetteActive?"active":""," not-disable"].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.showPicker}],redundantAttribute:"expr1256",selector:"[expr1256]"}])},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-range",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.state.activeData},{type:t.ATTRIBUTE,name:"spectrumHsb",evaluate:e=>e.state.activeSpectrumHsb},{type:t.ATTRIBUTE,name:"lastUpdateFrom",evaluate:e=>e.meta.lastUpdateFrom},{type:t.EVENT,name:"onmove",evaluate:e=>e.moveFillabilityItem},{type:t.EVENT,name:"onremove",evaluate:e=>e.removeFillabilityItem},{type:t.EVENT,name:"onadd",evaluate:e=>e.addFillabilityItem}],redundantAttribute:"expr1257",selector:"[expr1257]"},{type:s.IF,evaluate:e=>!e.state.isRadialGradient,redundantAttribute:"expr1258",selector:"[expr1258]",template:e('<div class="gradient-params-direction"><div expr1259="expr1259" is="colorpicker-button"></div></div><div class="gradient-params-angle"><div expr1260="expr1260" is="colorpicker-input" type="angle" min="0" max="360" suffix=""></div></div>',[{type:s.EACH,getKey:null,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["fill ",e.classNames({active:e.isAngleActive(e.angle)})].join("")},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.getAngleIcon(e.angle)},{type:t.EVENT,name:"onclick",evaluate:e=>e.handleAngle.bind(null,e.angle)}]}]),redundantAttribute:"expr1259",selector:"[expr1259]",itemName:"angle",indexName:null,evaluate:e=>e.meta.angleValues},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.gradientAngle},{type:t.ATTRIBUTE,name:"loop",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"upDownChange",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"bordered",evaluate:e=>!0},{type:t.EVENT,name:"onUpdateValue",evaluate:e=>e.updateAngle}],redundantAttribute:"expr1260",selector:"[expr1260]"}])}])},{type:s.IF,evaluate:e=>e.meta.colorStoreSupported,redundantAttribute:"expr1261",selector:"[expr1261]",template:e('<div class="colorpicker-list-shot"><div expr1262="expr1262"></div><div class="colorpicker-favorite-control"><div expr1264="expr1264"><span expr1265="expr1265"></span><div class="colorpicker-color-item-icon"><svg width="12" height="12" viewBox="0 0 8 8" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 1C4.5 0.723858 4.27614 0.5 4 0.5C3.72386 0.5 3.5 0.723858 3.5 1V3.5H1C0.723857 3.5 0.5 3.72386 0.5 4C0.5 4.27614 0.723857 4.5 1 4.5H3.5V7C3.5 7.27614 3.72386 7.5 4 7.5C4.27614 7.5 4.5 7.27614 4.5 7V4.5H7C7.27614 4.5 7.5 4.27614 7.5 4C7.5 3.72386 7.27614 3.5 7 3.5H4.5V1Z" fill="currentColor"/></svg></div></div><div expr1266="expr1266" is="colorpicker-button" class="colorpicker-favorite-button bordered" icon="more"></div></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-colors ",e.classNames({full:e.meta.displayFavoriteList.length>=6})].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e('<span expr1263="expr1263"></span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-color-item ",e.state.activeValue===e.color.toLowerCase()?"active":""," ",e.meta.isAddedColor&&e.index===e.meta.favoriteList.length-1&&e.meta.needAnimateAddedItem?"added":""].join("")},{type:t.ATTRIBUTE,name:"color",evaluate:e=>e.color.toLowerCase()},{type:t.EVENT,name:"onpointerup",evaluate:e=>e.applyFromFavorite}]},{redundantAttribute:"expr1263",selector:"[expr1263]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["background: ",e.color].join("")}]}]),redundantAttribute:"expr1262",selector:"[expr1262]",itemName:"color",indexName:"index",evaluate:e=>e.meta.displayFavoriteList},{redundantAttribute:"expr1264",selector:"[expr1264]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-color-item add-color ",e.state.contrast," ",e.meta.showAddedItem?"":"hide"].join("")},{type:t.ATTRIBUTE,name:"color",evaluate:e=>e.state.activeValue},{type:t.EVENT,name:"onpointerup",evaluate:e=>e.addToFavorite}]},{redundantAttribute:"expr1265",selector:"[expr1265]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.meta.addedItemStyle}]},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.EVENT,name:"onclick",evaluate:e=>e.colorpicker.openFavoriteColors.bind(e.colorpicker)}],redundantAttribute:"expr1266",selector:"[expr1266]"}])},{type:s.IF,evaluate:e=>!e.meta.colorStoreSupported,redundantAttribute:"expr1267",selector:"[expr1267]",template:e('<div class="colorpicker-list-shot"><div expr1268="expr1268"></div></div>',[{type:s.EACH,getKey:null,condition:null,template:e('<span expr1269="expr1269"></span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-color-item ",e.state.activeValue===e.color.toLowerCase()?"active":""].join("")},{type:t.ATTRIBUTE,name:"color",evaluate:e=>e.color},{type:t.EVENT,name:"onpointerup",evaluate:e=>e.applyFromFavorite}]},{redundantAttribute:"expr1269",selector:"[expr1269]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["background: ",e.color].join("")}]}]),redundantAttribute:"expr1268",selector:"[expr1268]",itemName:"color",indexName:null,evaluate:e=>e.meta.colorList}])},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"text",evaluate:e=>e.meta.doneButtonText},{type:t.EVENT,name:"onclick",evaluate:e=>e.close}],redundantAttribute:"expr1270",selector:"[expr1270]"}]),name:"colorpicker"};e(Na.name,Na);const Ma={css:null,exports:{setup(e){const t=e.props.colorpicker;this.state={get activeData(){return t.colorState},get type(){return this.activeData.type},get gradientType(){return this.activeData.gradient.type},get activeValue(){return this.activeData.value}},this.meta={get paletteList(){return"gradient"===e.state.type?t.options.palette[e.state.type][e.state.gradientType].flat():t.options.palette.color.flat()},get titleText(){return t.getLocale("paletteTitle",e.state.type)},get keepOpacity(){return t.options.keepOpacity}},this.updateColor=$.throttle(this.updateColor,300),this.colorpicker=t},getContrast:e=>xa(e)?"light":Pe(e,"dark","light",.7)||"light",updateColor(e){if("color"===this.state.type){const{hex:t,opacity:s}=Sa(e);this.colorpicker.updateColor({color:`#${t}`,opacity:s},!0,!0,!0)}else if("gradient"===this.state.type){let t=e;if(this.meta.keepOpacity){const s=$a(e),i=this.state.activeData.gradient;s.colors=s.colors.map(((e,t)=>Sa(e.value,i.colors[t].opacity))),t=s.value}this.colorpicker.updateGradient({gradientValue:t},!0,!0,!0)}},close(){this.colorpicker.paletteModal.close()}},template:(e,t,s,i)=>e('<div class="colorpicker-head"><div expr1271="expr1271" class="colorpicker-title"> </div><div expr1272="expr1272" is="colorpicker-button" class="small small-icon" icon="close"></div></div><div expr1273="expr1273"><div expr1274="expr1274"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-palette ",e.state.type," ",e.props.class].join("")}]},{redundantAttribute:"expr1271",selector:"[expr1271]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.meta.titleText}]},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.EVENT,name:"onclick",evaluate:e=>e.close}],redundantAttribute:"expr1272",selector:"[expr1272]"},{redundantAttribute:"expr1273",selector:"[expr1273]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-palette-list ","gradient"===e.state.type?"scrollable-content":""].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e('<div expr1275="expr1275" class="colorpicker-palette-item"></div><div class="colorpicker-palette-item-overlay"></div><svg width="17" height="13" viewBox="0 0 17 13"><path d="M2 6L1 7L6 12L16 2L15 1L6 10L2 6Z"/><path d="M2.35355 5.64645C2.15829 5.45118 1.84171 5.45118 1.64645 5.64645L0.646447 6.64645C0.451184 6.84171 0.451184 7.15829 0.646447 7.35355L5.64645 12.3536C5.84171 12.5488 6.15829 12.5488 6.35355 12.3536L16.3536 2.35355C16.5488 2.15829 16.5488 1.84171 16.3536 1.64645L15.3536 0.646447C15.1583 0.451184 14.8417 0.451184 14.6464 0.646447L6 9.29289L2.35355 5.64645Z" stroke="black" stroke-opacity="0.1" stroke-linecap="round" stroke-linejoin="round"/></svg>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-palette-item-wrapper ",e.getContrast(e.item)," ",e.item.toLowerCase()===e.state.activeValue.toLowerCase()?"selected":""].join("")},{type:t.ATTRIBUTE,name:"data-color",evaluate:e=>e.item},{type:t.EVENT,name:"onclick",evaluate:e=>e.updateColor.bind(null,e.item)},{type:t.EVENT,name:"ondblclick",evaluate:e=>e.close}]},{redundantAttribute:"expr1275",selector:"[expr1275]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["background: ",e.item].join("")}]}]),redundantAttribute:"expr1274",selector:"[expr1274]",itemName:"item",indexName:null,evaluate:e=>e.meta.paletteList}]),name:"colorpicker-palette"};e(Ma.name,Ma);const Da={css:null,exports:{setup(e,{initMobx:t}){const s=e.props.colorpicker;t({keepAlive:!1}),this.state={get activeData(){return s.colorState},get activeValue(){return this.activeData.value},get isAutoColor(){return ya(this.activeValue)},get contrast(){return this.activeOpacity<.3?"dark":Pe(this.activeValue,"dark","light")},get type(){return s.colorState.type},get loading(){var e;return null!=(e=colorStore.loading)&&e},get favoriteList(){return colorStore.getList(this.type)},get displayFavoriteList(){const t=this.favoriteList;return"color"===this.type?t.map((t=>({value:t,hex:ka(_a(t)),opacity:Ta(t),removeble:!e.meta.nonRemovableColors.includes(t)}))):"gradient"===this.type?t.map((t=>({value:t,hex:$a(t).colors.map((e=>e.hex)),removeble:!e.meta.nonRemovableColors.includes(t)}))):[]}},this.meta={nonRemovableColors:["#ffffff","#000000"],get showAddedItem(){return!this.isMaxLength&&(!!("color"===e.state.type&&ba(e.state.activeData.value)||"gradient"===e.state.type&&xa(e.state.activeData.value))&&!e.state.favoriteList.includes(e.state.activeData.value))},get addedItemStyle(){return`background: ${e.state.isAutoColor?"transparent":e.state.activeValue}`},get showOpacity(){return s.options.showOpacity},get isMaxLength(){return e.state.favoriteList.length>=10},get titleText(){return s.getLocale("favoriteTitle",e.state.type)},get addButtonText(){return s.getLocale("addButton",e.state.type)},get maxTipText(){return s.getLocale("maxTip",e.state.type)}},this.watch={"state.loading":[()=>{this.update()}]},this.colorpicker=s},applyColor(e,t){if(!$(t.target).closest(".colorpicker-favorite-draggable").length&&e!==this.state.activeValue){if("color"===this.state.type){const t=_a(e),s=ga(e)&&this.meta.showOpacity?Ta(e):1;this.colorpicker.updateColor({color:t,opacity:s},!0,!0)}else if("gradient"===this.state.type){const t=this.meta.showOpacity?e:Le(e,1);this.colorpicker.updateGradient({gradientValue:t},!0,!0)}this.close()}},removeFromFavorite(e,t){t.stopPropagation(),this.colorpicker.removeFromFavorite(e)},addToFavorite(){this.meta.showAddedItem&&(setTimeout((()=>{this.colorpicker.addToFavorite(this.state.activeValue)}),100),this.colorpicker.favoriteModal.close())},sortFavoriteList({oldIndex:e,newIndex:t}){this.colorpicker.sortFavorite({oldIndex:e,newIndex:t}),this.meta.destroyList=!0,this.update(),this.meta.destroyList=!1,this.update()},close(){this.colorpicker.favoriteModal.close()},onMounted(){flexbe&&flexbe.tip.initArea(this.root)},onUpdated(){flexbe&&flexbe.tip.initArea(this.root)}},template:(e,t,s,i)=>e('<div class="colorpicker-head"><div expr1276="expr1276" class="colorpicker-title"> </div><div expr1277="expr1277" is="flexbe-loader" class="loader"></div><div expr1278="expr1278" is="colorpicker-button" class="small small-icon" icon="close"></div></div><div expr1279="expr1279" is="flexbe-sort-list" class="colorpicker-favorite-list" handle-selector=".colorpicker-favorite-draggable" item-selector=".colorpicker-favorite-item"></div><hr/><div class="colorpicker-favorite-footer"><div expr1295="expr1295" data-width="210" data-item=".colorpicker-color-item"><div expr1296="expr1296"><span expr1297="expr1297"></span><div class="colorpicker-color-item-icon"><svg width="12" height="12" viewBox="0 0 8 8" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 1C4.5 0.723858 4.27614 0.5 4 0.5C3.72386 0.5 3.5 0.723858 3.5 1V3.5H1C0.723857 3.5 0.5 3.72386 0.5 4C0.5 4.27614 0.723857 4.5 1 4.5H3.5V7C3.5 7.27614 3.72386 7.5 4 7.5C4.27614 7.5 4.5 7.27614 4.5 7V4.5H7C7.27614 4.5 7.5 4.27614 7.5 4C7.5 3.72386 7.27614 3.5 7 3.5H4.5V1Z" fill="currentColor"/></svg></div></div><div expr1298="expr1298" class="colorpicker-favorite-add-text"> </div></div><div class="colorpicker-favorite-control"><div expr1299="expr1299" is="colorpicker-button" class="colorpicker-favorite-button active fill bordered not-disable" icon="more"></div></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"colorpicker-favorite"}]},{redundantAttribute:"expr1276",selector:"[expr1276]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.meta.titleText}]},{type:s.IF,evaluate:e=>e.state.loading,redundantAttribute:"expr1277",selector:"[expr1277]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[]}])},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.EVENT,name:"onclick",evaluate:e=>e.close}],redundantAttribute:"expr1278",selector:"[expr1278]"},{type:s.IF,evaluate:e=>!e.meta.destroyList,redundantAttribute:"expr1279",selector:"[expr1279]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-sort-list",slots:[{id:"default",html:'<div expr1280="expr1280"></div><div expr1287="expr1287"></div>',bindings:[{type:s.EACH,getKey:null,condition:e=>"color"===e.state.type,template:e('<div class="colorpicker-favorite-draggable"><div expr1281="expr1281"><span expr1282="expr1282"></span></div></div><div class="colorpicker-color-preview"><span class="colorpicker-prefix">#</span><span expr1283="expr1283" class="colorpicker-text"> </span></div><div expr1284="expr1284" class="colorpicker-opacity-preview"></div><div expr1286="expr1286" is="colorpicker-button" class="remove-color" icon="close"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-favorite-item ",e.classNames({active:e.state.activeData.value===e.item.value})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.applyColor.bind(null,e.item.value)}]},{redundantAttribute:"expr1281",selector:"[expr1281]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-color-item ",e.classNames({active:e.state.activeData.value===e.item.value})].join("")}]},{redundantAttribute:"expr1282",selector:"[expr1282]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["background: ",e.item.value].join("")}]},{redundantAttribute:"expr1283",selector:"[expr1283]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.hex}]},{type:s.IF,evaluate:e=>e.item.opacity<1,redundantAttribute:"expr1284",selector:"[expr1284]",template:e('<span expr1285="expr1285" class="colorpicker-text"> </span><span class="colorpicker-suffix">%</span>',[{redundantAttribute:"expr1285",selector:"[expr1285]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>(100*e.item.opacity).toFixed()}]}])},{type:s.IF,evaluate:e=>e.item.removeble,redundantAttribute:"expr1286",selector:"[expr1286]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.EVENT,name:"onclick",evaluate:e=>e.removeFromFavorite.bind(null,e.item.value)}]}])}]),redundantAttribute:"expr1280",selector:"[expr1280]",itemName:"item",indexName:"index",evaluate:e=>e.state.displayFavoriteList},{type:s.EACH,getKey:null,condition:e=>"gradient"===e.state.type,template:e('<div class="colorpicker-favorite-draggable"><div expr1288="expr1288"><span expr1289="expr1289"></span></div></div><template expr1290="expr1290"></template><div expr1293="expr1293" class="colorpicker-color-preview"></div><div expr1294="expr1294" is="colorpicker-button" class="remove-color" icon="close"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-favorite-item ",e.classNames({active:e.state.activeData.value===e.item.value})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.applyColor.bind(null,e.item.value)}]},{redundantAttribute:"expr1288",selector:"[expr1288]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-color-item ",e.classNames({active:e.state.activeData.value===e.item.value})].join("")}]},{redundantAttribute:"expr1289",selector:"[expr1289]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["background: ",e.item.value].join("")}]},{type:s.IF,evaluate:e=>e.item.hex.length<=2,redundantAttribute:"expr1290",selector:"[expr1290]",template:e('<div class="colorpicker-color-preview"><span class="colorpicker-prefix">#</span><span expr1291="expr1291" class="colorpicker-text"> </span></div><svg width="8" height="6" viewBox="0 0 8 6" fill="none"><path d="M0.5 3H7.5M7.5 3L5.5 1M7.5 3L5.5 5" stroke="#30343B" stroke-opacity="0.5" stroke-linecap="round" stroke-linejoin="round"/></svg><div class="colorpicker-color-preview"><span expr1292="expr1292" class="colorpicker-text"> </span></div>',[{redundantAttribute:"expr1291",selector:"[expr1291]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.hex[0]}]},{redundantAttribute:"expr1292",selector:"[expr1292]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.hex[1]}]}])},{type:s.IF,evaluate:e=>e.item.hex.length>2,redundantAttribute:"expr1293",selector:"[expr1293]",template:e('<span class="colorpicker-text">Gradient</span>',[])},{type:s.IF,evaluate:e=>e.item.removeble,redundantAttribute:"expr1294",selector:"[expr1294]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.EVENT,name:"onclick",evaluate:e=>e.removeFromFavorite.bind(null,e.item.value)}]}])}]),redundantAttribute:"expr1287",selector:"[expr1287]",itemName:"item",indexName:"index",evaluate:e=>e.state.displayFavoriteList}]}],attributes:[{type:t.ATTRIBUTE,name:"sort-end",evaluate:e=>e.sortFavoriteList}]}])},{redundantAttribute:"expr1295",selector:"[expr1295]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-favorite-add ",e.classNames({disabled:!e.meta.showAddedItem})].join("")},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.meta.isMaxLength?e.meta.maxTipText:null},{type:t.EVENT,name:"onclick",evaluate:e=>e.addToFavorite}]},{redundantAttribute:"expr1296",selector:"[expr1296]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["colorpicker-color-item add-color ",e.state.contrast].join("")},{type:t.ATTRIBUTE,name:"color",evaluate:e=>e.state.activeValue}]},{redundantAttribute:"expr1297",selector:"[expr1297]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.meta.addedItemStyle}]},{redundantAttribute:"expr1298",selector:"[expr1298]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.meta.addButtonText}]},{type:s.TAG,getComponent:i,evaluate:e=>"colorpicker-button",slots:[],attributes:[{type:t.EVENT,name:"onclick",evaluate:e=>e.close}],redundantAttribute:"expr1299",selector:"[expr1299]"}]),name:"colorpicker-favorite"};function Va(e){return function(e){return m((()=>{const t=Object.getOwnPropertyDescriptors(e);return Object.keys(t).map((t=>p(e,t))).filter((e=>u(e)&&!e.keepAlive&&!e.keepAlive_))}))}(e).forEach((e=>{e.keepAlive=!0,e.keepAlive_=!0})),Oa.bind(this,e)}function Oa(e){const t=Object.getOwnPropertyDescriptors(e);return Object.keys(t).forEach((t=>{!function(e,t){const s=p(e,t);!!u(s)&&(s.keepAlive=!1,s.keepAlive_=!1,s.suspend())}(e,t)}))}function za(e,t){const s=[];return"object"==typeof e&&Object.entries(e).forEach((([e,i])=>{let a,n={delay:0,deep:!1};if(Array.isArray(i)?(n={...n,...i[1]||{}},a=i[0]):a=i,"function"!=typeof a)return;n.delay&&(a=$.debounce(a,n.delay),delete n.delay);const r=gt(e),o=c((()=>{let e=xt(t,r);return u(e)&&(e=e.get()),n.deep?h(e):e}),((...e)=>setImmediate((()=>{!1!==t.isMounted&&a(...e)}))),n);s.push(o)})),()=>s.forEach((e=>e()))}e(Da.name,Da);const qa=[["before-mount","onBeforeMount"],["mount","onMounted"],["update","onBeforeUpdate"],["updated","onUpdated"],["before-unmount","onBeforeUnmount"],["unmount","onUnmounted"]],Ga=At({});let Xa=!1;const Ka=[["before-mount","onBeforeMount"],["mount","onMounted"],["update","onBeforeUpdate"],["updated","onUpdated"],["before-unmount","onBeforeUnmount"],["unmount","onUnmounted"]];function Wa(){Xa||(Xa=!0,riot3.mixin({init(){this.tag=this,this.main=this.parent?this.parent.main||this.parent:this}}),riot3.mixin("inheritYield",{init(){this.tag=this.parent?this.parent.tag||this.parent:this,this.main=this.parent?this.parent.main||this.parent:this}}),riot3.mixin({init(){this.on("before-mount",(()=>{if("object"!=typeof this.extendFromProps)return;const e=this.extendFromProps,t=Array.isArray(e)?e:Object.keys(e);t.length&&(console.warn("FLEXBE: this.extendFromProps is DEPRECATED in riot3 components. Please dont use it."),t.forEach((t=>{let s,i;const a="string"==typeof e[t]?{name:e[t]}:e[t]||{},n=a.name||t;Object.defineProperty(this,n,{configurable:!0,enumerable:!0,get:()=>{let e=this.opts[t];return null==s||s!==e?(s=e,null==e&&a.default&&(e=it(a.default)),"function"==typeof a.formatter&&(e=a.formatter.call(this,e)),i=e,e):i}})}))),delete this.extendFromProps}))}}),riot3.mixin("initMobx",{init(){const e={},t=[];this.props=d(this.opts),this.on("before-mount",(()=>{["state","meta"].forEach((e=>{"object"==typeof this[e]&&(this[e]=g(this[e])?this[e]:d(this[e]))})),["state","meta"].forEach((e=>{"object"==typeof this[e]&&t.push(Va(this[e]))})),this.watch&&t.push(za(this.watch,this)),Object.entries(Object.getOwnPropertyDescriptors(this)).filter((([e,t])=>t.writable&&"function"==typeof this[e]&&!/^\s*class\s+/.test(this[e].toString()))).forEach((([e])=>{this[e]=l(this[e]).bind(this)}))})),this.on("update",l((()=>{Object.keys(this.opts).forEach((t=>{const s=this.opts[t];s!==e[t]&&(g(this.props)&&!(t in this.props)?v(this.props,{[t]:s}):this.props[t]=s,e[t]=s)}))}))),this.on("unmount",(()=>{t.forEach((e=>e()))}))}}),riot3.mixin({init(){const e=(e,...t)=>{if("function"==typeof this[e])return this[e].call(this,...t)};this.on("mount",(()=>{Ga.trigger("mount",this)})),this.on("update",(()=>{Ga.trigger("update",this)})),this.on("unmount",(()=>{Ga.trigger("unmount",this)})),this.on("before-mount",((...t)=>{e("onBeforeMount",...t),Ka.forEach((([t,s])=>{const i=(...a)=>{"function"==typeof this[s]?e(s,a):this.off(t,i)};this.on(t,i)}))}))}}))}const Za=new Set,Ya=e=>{Za.delete(e),e.isConnected=!0,e.onConnected&&e.onConnected.apply(e)};function Ja(){a((e=>{const{shouldUpdate:t,onMounted:s,onUnmounted:i}=e;return e.isMounted=!1,e.isConnected=!1,e.onConnected=e.onConnected||function(){},e.onDisconnected=e.onDisconnected||function(){},e.onMounted=(...t)=>{e.isMounted=!0,e.root.isConnected?Ya(e):Za.add(e),s.apply(e,t),"function"==typeof e.props.onMounted&&e.props.onMounted(e)},e.onUnmounted=(...t)=>{Za.delete(e),e.isMounted=!1,e.isConnected=!1,i.apply(e,t),e.onDisconnected.apply(e),"function"==typeof e.props.onUnmounted&&e.props.onUnmounted(e)},e.shouldUpdate=(...s)=>!!e.isMounted&&(!t||t.apply(e,s)),e}))}new MutationObserver(((e,t)=>{Za.forEach((e=>{e.root.isConnected&&Ya(e)}))})).observe(document,{childList:!0,subtree:!0});const{PROPS_KEY:Qa}=t.globals,en=Symbol("mobxProps");function tn(e,t={}){let s=[];t={targets:["state","meta"],deep:!1,keepAlive:!0,bindActions:!0,autoUpdate:!1,...t},e.on("before-mount",(()=>{if(e[en]=d(e[Qa],{},{deep:!1,name:`${e.name}:${Qa}`}),wt(e,Qa,{value:e[en]}),t.targets.forEach((s=>{"object"==typeof e[s]&&(e[s]=d(e[s],{},{deep:t.deep,name:`${e.name}:${s}`}))})),t.keepAlive&&t.targets.forEach((t=>{"object"==typeof e[t]&&s.push(Va(e[t]))})),"object"==typeof e.watch&&s.push(za(e.watch,e)),t.bindActions){const t=Object.entries(Object.getOwnPropertyDescriptors(e)),s=["update","mount","unmount","setup"];t.filter((([e])=>"function"==typeof this[e]&&!s.includes(e)&&!/^\s*class\s+/.test(this[e].toString()))).forEach((([t,s])=>{s.writable&&(e[t]=l(e[t]).bind(e))}))}t.autoUpdate&&e.state&&Object.getOwnPropertyNames(e.state).map((t=>{s.push(c((()=>e.state[t]),(()=>e.update()),{equals:f.shallow}))}))})),e.on("update",l((t=>{wt(e,Qa,{value:e[en]}),yt(e[en],t)}))),e.on("before-unmount",(()=>{s.forEach((e=>{"function"==typeof e&&e()})),s=[]}))}const{TEMPLATE_KEY_SYMBOL:sn}=t.globals;let an=null;function nn(e){const{onBeforeUpdate:t,onUpdated:s}=e,i=e[sn].update;e.onBeforeUpdate=(...s)=>{an||(an=e),null==t||t.call(e,...s)},e.onUpdated=(...t)=>{null==s||s.call(e,...t),an===e&&(an=null)},wt(e[sn],"update",{value(t,s){if(an.root===e.root)return i.apply(this,[t,s])}})}const{PARENT_KEY_SYMBOL:rn}=t.globals,on=Symbol("provide"),ln=(e,t,s)=>{null==e[on]&&(e[on]=new Map),e[on].set(t,s)},dn=(e,t,s)=>{var i;let a,n=e[rn];for(;null==a&&n;){var r;null!=(r=n[on])&&r.has(t)&&(a=n[on].get(t)),n=n[rn]}return null!=(i=a)?i:s},cn=new Map;let pn=0;function un(e){const{update:t}=e;wt(e,"_update",{value(...s){null==t||t.apply(e,s)}}),wt(e,"update",{value:(...s)=>(cn.set(e,(()=>null==t?void 0:t.apply(e,s))),pn||(pn=requestAnimationFrame((()=>(()=>{for(;cn.size>0;){const e=Array.from(cn.values());cn.clear(),e.forEach((e=>e()))}pn=0})()))),e)})}let mn=!1;function hn(){mn||(mn=!0,a((e=>("function"==typeof tr&&(e.tr=tr),e.classNames=et,e))),a((e=>{const t=At(e);return qa.forEach((([e,s])=>{const i=t[s];t[s]=(...s)=>{i.call(t,...s),t.trigger(e,...s),Ga.trigger(e,t)}})),t})),Ja(),a((e=>{if("function"!=typeof e.setup)return e;const{onBeforeMount:t}=e;return e.onBeforeMount=(...s)=>{const i={initMobx:tn.bind(e,e),provide:ln.bind(e,e),inject:dn.bind(e,e),onlySelfUpdate:nn.bind(e,e),updateInRaf:un.bind(e,e)};e.setup.call(e,e,i),t.call(e,...s)},e})))}function gn(){Wa(),hn()}class vn extends kt{constructor(e,t={}){super(),this.component=void 0,this.data=void 0,this.modal=void 0,this.paletteModal=void 0,this.favoriteModal=void 0,this.options=void 0,this.colorState=void 0,this._clickoutEventId=void 0,this._paletteIsOpen=void 0,this._colorpickerIsOpen=void 0,gn(),e={value:"#FFFFFF",...e},t={showOpacity:!0,showAutocolor:!1,showGradient:!0,showPalette:!0,minOpacity:0,maxOpacity:1,keepOpacity:!1,outclick:!0,container:"modal",modalPosition:["center","center"],modalItem:null,stopEditor:!1,palette:t.overlayMode?oa:ra,...t,locale:{title:"editor::colorpicker::title",doneButton:"editor::colorpicker::done",color:{paletteTitle:"editor::colorpicker::palette::color_title",favoriteTitle:"editor::colorpicker::favorite::color_title",addButton:"editor::colorpicker::add_color",tab:"editor::colorpicker::color_tab",maxTip:"editor::colorpicker::color_max_tip"},gradient:{paletteTitle:"editor::colorpicker::palette::gradient_title",favoriteTitle:"editor::colorpicker::favorite::gradient_title",addButton:"editor::colorpicker::add_gradient",tab:"editor::colorpicker::gradient_tab",maxTip:"editor::colorpicker::gradient_max_tip"},...t.locale}},this.colorState={type:"color",color:Sa("#71BBE7"),gradient:{type:"linear",value:"",angle:90,fillability:[0,100],colors:[Sa("#71BBE7"),Sa("#5961F9")],activeColorIndex:0}},xa(e.value)&&(this.colorState={...this.colorState,color:this.colorState.gradient.colors[this.colorState.gradient.activeColorIndex]},t.showGradient||(e.value=$a(e.value).colors[0].value)),this._paletteIsOpen=!1,this._colorpickerIsOpen=!1,this.updateState(e,t),this.commit=$.debounce(this.commit,100)}render(){this.modal=Zs.create({handle:".flexbe-modal-data",width:230,overlay:!0,shadow:!1,scrollable:!1,name:"colorpicker",component:"colorpicker",class:"only-pointer-disabled",props:{colorpicker:this},duplicate:!1,clickOut:this.options.outclick,position:this.options.modalPosition,item:this.options.modalItem,closeButton:!1,stopEditor:this.options.stopEditor,onOpen:()=>{this._colorpickerIsOpen=!0,this.trigger("open")},onClose:()=>{this._colorpickerIsOpen=!1,this.trigger("close",this.colorState),this.off("*")},onInit:()=>{this.component=this.modal.modalComponent}})}setType(e){if(this.colorState.type=e,"color"===e){const{colors:e,activeColorIndex:t}=this.colorState.gradient;let{value:s,opacity:i}=e[t];this.options.overlayMode&&1===i&&(i=.5),this.updateColor({color:s,opacity:i},!0,!0,!0)}else if("gradient"===e){const{colors:e,activeColorIndex:t}=this.colorState.gradient,s={gradientValue:null,colors:null,fillability:null,angle:null,activeColorIndex:null};e.length>=2&&e[t].value===this.colorState.color.value?s.colors=e.map((e=>e.value)):ya(this.colorState.value)?s.gradientValue=this.options.palette.gradient.linear[0]:(s.colors=[this.colorState.value,this.options.overlayMode?wa(this.colorState.value,0):Ua(this.colorState.value)],s.fillability=[0,100],s.angle=90,s.activeColorIndex=0),this.updateGradient(s,!0,!0,!0)}}getActiveColorState(){if("gradient"===this.colorState.type){const e=this.colorState.gradient.activeColorIndex;return this.colorState.gradient.colors[e]}return this.colorState.color}updateState(e,t={}){this.data={...this.data||{},...e,opacity:ha(e.opacity)?e.opacity:Ta(e.value)},this.options={...this.options,...t},ya(this.data.value)?(this.colorState.type="color",this.updateColor({color:"auto",opacity:1},!0,!1,!1)):ba(this.data.value)?(this.colorState.type="color",this.updateColor({color:this.data.value,opacity:this.data.opacity},!0,!1,!1)):xa(this.data.value)&&(this.colorState.type="gradient",this.updateGradient({gradientValue:this.data.value},!0,!0,!1))}updateColor({color:e,opacity:t},s=!0,i=!1,a=!0){var n,r;e=null!=(n=e)?n:this.colorState.color.value,t=null!=(r=t)?r:this.colorState.color.opacity;const o=ya(e),l=Sa(o?"#969696":e,t,o);this.colorState={...this.colorState,color:{...this.colorState.color,...l},value:l.value,opacity:l.opacity},this.trigger("action:updateUiState",{force:i}),s&&this.updateView(),a&&this.commit()}updateGradient({colors:e,color:t,angle:s,fillability:i,gradientValue:a,activeColorIndex:n,type:r},o=!0,l=!1,d=!0){if(a&&xa(a)){const e=$a(a);e.activeColorIndex=De(0,this.colorState.gradient.activeColorIndex,e.colors.length-1),e.fillability=e.fillability.map((e=>parseFloat(String(e)))),this.colorState.gradient=e}else{if(e&&(this.colorState.gradient.colors=e.map((e=>Sa("object"==typeof e?e.value:e)))),i&&(this.colorState.gradient.fillability=i.map((e=>parseFloat(String(e))))),r&&(this.colorState.gradient.type=r),t){var c;const e=null!=(c=t.index)?c:this.colorState.gradient.activeColorIndex;var p,u;if(t.fill&&(this.colorState.gradient.fillability[e]=t.fill),this.colorState.gradient.activeColorIndex=e,t.value||t.opacity)this.colorState.gradient.colors[e]=Sa(null!=(p=t.value)?p:this.colorState.gradient.colors[e].value,null!=(u=t.opacity)?u:this.colorState.gradient.colors[e].opacity)}null!=n&&(this.colorState.gradient.activeColorIndex=n),this.colorState.gradient.angle=+(+(null!=s?s:this.colorState.gradient.angle)).toFixed()}const m=Ba(this.colorState.gradient);this.colorState={...this.colorState,gradient:{...this.colorState.gradient,value:m},value:m,opacity:null},this.trigger("action:updateUiState",{force:l}),o&&this.updateView(),d&&this.commit()}updateView(){var e;null==(e=this.component)||e.update(),this.paletteModal&&this.paletteModal.modalComponent.update(),this.favoriteModal&&(this.favoriteModal.modalComponent.update(),this.favoriteModal.updatePosition())}openPalette(){const e="gradient"===this.colorState.type?240:28*this.options.palette.color[0].length;this.closeAccessoryModals(),this.paletteModal=Zs.create({handle:".colorpicker-head",width:e,height:400,overlay:!1,shadow:!1,scrollable:!1,name:"colorpicker-palette",component:"colorpicker-palette",closeButton:!1,props:{colorpicker:this},duplicate:!1,position:["end_around","start"],fromModal:this.modal,onOpen:()=>{this._paletteIsOpen=!0,this.updateView()},onClose:()=>{this._paletteIsOpen=!1,this.updateView()}})}openFavoriteColors(){const e=$(this.modal.modalComponent.root).find(".colorpicker-favorite-button");this.closeAccessoryModals(),this.favoriteModal=Zs.create({handle:".colorpicker-head",width:"color"===this.colorState.type?200:220,stopEditor:!1,overlay:!1,shadow:!1,scrollable:!1,name:"colorpicker-favorite",component:"colorpicker-favorite",props:{colorpicker:this},duplicate:!1,position:["end","end"],positionOffset:{x:-15,y:-15},closeButton:!1,animate:!1,target:e[0],fromModal:this.modal})}closeAccessoryModals(){var e,t;null==(e=this.paletteModal)||e.close(),null==(t=this.favoriteModal)||t.close()}sortGradientColors({oldIndex:e,newIndex:t},s=!0){const i=this.colorState.gradient.activeColorIndex;this.colorState.gradient.colors.splice(t,0,this.colorState.gradient.colors.splice(e,1)[0]),s&&[e,t].includes(i)&&(this.colorState.gradient.activeColorIndex=i===e?t:e),this.updateGradient({},!0,!0,!0)}sortFavorite({oldIndex:e,newIndex:t}){var s;"object"==typeof window.colorStore&&window.colorStore.sort(this.colorState.type,{oldIndex:e,newIndex:t}),null==(s=this.component)||s.update()}addToFavorite(e){"object"==typeof window.colorStore&&window.colorStore.add(this.colorState.type,e),this.updateView()}removeFromFavorite(e){"object"==typeof window.colorStore&&window.colorStore.delete(this.colorState.type,e),this.updateView()}commit(){this.data.value=this.colorState.value,this.data.opacity=this.colorState.opacity;let e={};"color"===this.colorState.type?e=this.colorState.color:"gradient"===this.colorState.type&&(e=this.colorState.gradient),this.trigger("apply_color",this.colorState.value,this.colorState.type,e)}close(){this.modal?this.modal.close():this.trigger("close",this.colorState)}getLocale(e,t){const s=t?this.options.locale[t][e]:this.options.locale[e];return s&&"function"==typeof tr?tr(s):s}}const fn={color2hex:_a,color2opacity:Ta,hex2rgb:pa,hexa2opacity:Aa,hexa2hex:Ea,parseColor:Sa},{color2hex:xn,color2opacity:bn,hex2rgb:yn,hexa2opacity:_n,hexa2hex:Tn,parseColor:wn}=fn,kn=e=>Pe(e,"dark","light"),An={css:null,exports:{colorpicker:null,setup(e,{initMobx:t}){t(),this.state={_displayValue:"",inFocus:!1,get value(){const t=e.props.valueOpacity;let s=e.props.value||e.props.active||"#969696";return"dark"===s&&(s="#1B1B1B"),"light"===s&&(s="#FFFFFF"),"number"==typeof t&&!Number.isNaN(+t)&&t<1&&!Ae(s)?Le(s,+t,"rgb"):s},get hex(){return this.isAutoColor?"#969696":xn(this.value)},get opacity(){return this.isAutoColor?1:bn(this.value)},get contrast(){const e=this.isAutoColor?"#969696":this.value;return kn(e)},get isAutoColor(){return/auto|contrast/i.test(this.value)},get isGradient(){return Ae(this.value)},get parsedGradient(){return this.isGradient?Ne(this.value):null},get displayOpacity(){return+(100*this.opacity).toFixed()},get displayValue(){return this.isAutoColor?"AUTO":this.isGradient?"GRADIENT":this.inFocus?this._displayValue:this.hex},get previewStyle(){if(this.isGradient)return`background: ${this.value}`;const e=yn(this.hex),t=this.opacity,s=`rgba(${e.r}, ${e.g}, ${e.b}, 1)`,i=`rgba(${e.r}, ${e.g}, ${e.b}, ${t})`;return`background: linear-gradient(90deg,\n                    ${s} 0%,\n                    ${s} 50%,\n                    ${i} 50%,\n                    ${i} 100%);`}},this.meta={sprite:at("colorpicker"),get className(){let t=e.props.class||[];return"string"==typeof t&&(t=[t]),e.state.inFocus&&t.push("focus"),(e.state.isAutoColor||e.state.isGradient)&&t.push("only-value","not-selectable"),e.meta.showOpacity&&t.push("has-opacity"),t.push(e.meta.onlyButton?"only-button":"flexbe-input-styled"),t.join(" ")},get onlyButton(){return e.props.onlyButton||!1},get showAutocolor(){return e.props.autocolor},get showOpacity(){return e.props.opacity||0===e.props.opacity},get showGradient(){var t;return null==(t=e.props.gradient)||t},get minOpacity(){var t;return De(0,null!=(t=e.props.minOpacity)?t:0,.99)},get maxOpacity(){var t;return De(.01,null!=(t=e.props.maxOpacity)?t:1,1)},get overlayMode(){return e.props.overlayMode},get colorpickerOptions(){return{...e.props.colorpickerOptions,showAutocolor:this.showAutocolor,showOpacity:this.showOpacity,showGradient:this.showGradient,minOpacity:this.minOpacity,maxOpacity:this.maxOpacity,overlayMode:this.overlayMode,modalItem:e.root}},get eyeDropperSupport(){return!/Opera|OPR\//.test(navigator.userAgent)&&"function"==typeof EyeDropper}},this.watch={"state.value":[e=>{var t;null==(t=this.colorpicker)||t.updateState({value:e})}]},this.state._displayValue=this.state.hex},onMounted(){flexbe.tip.initArea(this.root)},onUpdated(){flexbe.tip.initArea(this.root)},showPickerOnDown(e){"KeyI"===e.code&&(e.preventDefault(),this.showPipette())},setColor({value:e,normalize:t},s){let i,a;const n=/auto|contrast/i.test(e);if(Ie(e)||n||Ae(e))i=e;else{const s=t?Re(e):Ue(e);$e(s)?i=yn(s):Se(s)&&!Ie(s)&&(i=`#${s}`)}if(i&&i!==this.state.value){const{opaque:t,alpha:r}=n?{}:function(e){if(!Ee(e))return null;(Ce(e)||Ie(e))&&(e=je(e));const t=`#${(e=Re(e)).slice(0,6)}`,s=+De(0,parseInt(e.slice(6,8),16)/255,1).toFixed(3);return{opaque:t,alpha:Number.isNaN(s)?1:+s.toFixed(2)}}(i);a=!n&&kn(i),"function"==typeof this.props.update&&this.props.update({color:i,contrast:a,opaque:t,alpha:r},"color",s||wn(e))}},setGradient(e,t){if(e){const s=kn(e),i=Le(e,1),a=1;"function"==typeof this.props.update&&this.props.update({color:e,contrast:s,opaque:i,alpha:a},"gradient",t)}},updateValue(e){let t=e.target.value,s=this.state.opacity;const i=e.type,a="change"===i,n="paste"===i||"input"===i&&"insertFromPaste"===e.inputType,r=Re(t),o=/auto|contrast/i.test(t),l=Ee(r);if(n&&!o&&$e(r)&&(s=_n(r),t=Tn(r)),o){if(!this.meta.showAutocolor)return;t="auto"}else a&&(t=l?n?Ue(t):r:this.state.isAutoColor?"auto":this.state.isGradient?"gradient":this.state.hex),(Se(r)||$e(r))&&(t=t.replace("#","").slice(0,6));if(this.state._displayValue=t.toUpperCase(),e.target.value!==this.state._displayValue&&(e.target.value=this.state._displayValue),this.meta.showOpacity&&l&&s>=0&&s<1){const e=yn(r);t=`rgba(${e.r}, ${e.g}, ${e.b}, ${s})`}"gradient"!==t&&this.setColor({value:t})},updateOpacity(e){const t="change"===e.type,s=""===e.target.value,i=xn(this.state.value);let a=i,n=e.target.value;if(!(n<100*this.meta.minOpacity||n>100*this.meta.maxOpacity||s)||t){if(n=s?this.state.opacity:De(100*this.meta.minOpacity,e.target.value,100*this.meta.maxOpacity),n<100){const e=yn(i);a=`rgba(${e.r}, ${e.g}, ${e.b}, ${n/100})`}this.setColor({value:a}),e.target.value=n}},showPicker(e){e.stopPropagation(),this.colorpicker=new vn({value:this.state.value},this.meta.colorpickerOptions),this.colorpicker.on("apply_color",((e,t,s)=>{"color"===t?this.setColor({value:e,normalize:!0},s):"gradient"===t&&this.setGradient(e,s)})),this.colorpicker.render()},click(e){this.props.pickerOnly&&this.showPicker(e),(this.state.isAutoColor||this.state.isGradient)&&$(this.root).find(".flexbe-color-input__color input").trigger("select")},focus(){this.state.inFocus=!0,this.state._displayValue=this.state.hex,this.update()},blur(){this.state.inFocus=!1,this.state._displayValue=this.state.hex,this.update()},async showPipette(){if(this.meta.eyeDropperSupport){const e=new EyeDropper;try{const{sRGBHex:t}=await e.open();$("input",this.root).trigger("blur"),this.setColor({value:je(t)})}catch(e){}}}},template:(e,t,s,i)=>e('<div expr444="expr444"><span expr445="expr445"></span><svg viewBox="0 0 10 10" class="flexbe-icon size-10"><g fill="none"><path d="M0 0h10v10H0z"/><path d="M10 4V0H5L2 3V0H0v4h10zM0 5v2h4v2a1 1 0 0 0 2 0V7h4V5H0z" fill="currentColor" fill-rule="nonzero"/></g></svg></div><div expr446="expr446" class="flexbe-color-input__color" is="flexbe-input"></div><div expr447="expr447" class="flexbe-color-input__opacity" is="flexbe-input" type="number" suffix="%"></div><svg expr448="expr448" class="flexbe-color-input__tip flexbe-icon size-16" data-width="180"></svg>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-color-input ",e.meta.className].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.click}]},{redundantAttribute:"expr444",selector:"[expr444]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-color-input__preview ",e.state.contrast].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.showPicker}]},{redundantAttribute:"expr445",selector:"[expr445]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.state.previewStyle}]},{type:s.IF,evaluate:e=>!e.meta.onlyButton,redundantAttribute:"expr446",selector:"[expr446]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.displayValue},{type:t.EVENT,name:"onkeydown",evaluate:e=>e.showPickerOnDown},{type:t.EVENT,name:"oninput",evaluate:e=>e.updateValue},{type:t.EVENT,name:"onchange",evaluate:e=>e.updateValue},{type:t.EVENT,name:"onfocus",evaluate:e=>e.focus},{type:t.EVENT,name:"onblur",evaluate:e=>e.blur}]}])},{type:s.IF,evaluate:e=>e.meta.showOpacity&&!e.state.isAutoColor&&!e.state.isGradient&&!e.meta.onlyButton,redundantAttribute:"expr447",selector:"[expr447]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.displayOpacity},{type:t.ATTRIBUTE,name:"min",evaluate:e=>100*e.meta.minOpacity},{type:t.ATTRIBUTE,name:"max",evaluate:e=>100*e.meta.maxOpacity},{type:t.ATTRIBUTE,name:"runnerFactor",evaluate:e=>5},{type:t.EVENT,name:"onchange",evaluate:e=>e.updateOpacity},{type:t.EVENT,name:"oninput",evaluate:e=>e.updateOpacity},{type:t.EVENT,name:"onfocus",evaluate:e=>e.focus},{type:t.EVENT,name:"onblur",evaluate:e=>e.blur}]}])},{type:s.IF,evaluate:e=>e.state.isAutoColor,redundantAttribute:"expr448",selector:"[expr448]",template:e('<use expr449="expr449"/>',[{expressions:[{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.tr("editor::color_input::auto_color_tip")}]},{redundantAttribute:"expr449",selector:"[expr449]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#auto-color"].join("")}]}])}]),name:"flexbe-color-input"};e(An.name,An);const En={css:null,exports:{setup(e){var t,s,i,a,n;this.state={dateMask:null!=(t=e.props.dateMask)?t:"d.m.y",dateDivider:Ye(null!=(s=e.props.dateMask)?s:"d.m.y")||".",dividerPositions:[],lastInputValue:"",valid:!0,maxLength:10,parsedDate:{date:null,month:null,year:null},dateOptions:{date:{min:1,max:31,normalize:!0,...null==(i=e.props.dateOptions)?void 0:i.date},month:{min:1,max:12,normalize:!0,...null==(a=e.props.dateOptions)?void 0:a.month},year:{min:1990,max:2999,nomalize:!0,...null==(n=e.props.dateOptions)?void 0:n.year}},get value(){return this.lastInputValue},get parseReturnValue(){return e.props.parseReturnValue},get error(){return!this.valid||e.props.error},get inFocus(){return!!e.$("input:focus")}}},initMask(){let{dateMask:e}=this.state;e=e.replace(/d+/i,"DD").replace(/m+/i,"MM").replace(/y+/i,"YYYY");const t=[{subject:"date",position:e.search(/D/)},{subject:"month",position:e.search(/M/)},{subject:"year",position:e.search(/Y/)}].sort(((e,t)=>e.position-t.position)).filter((e=>e.position>=0));this.state.defaultDateOrder=t,this.state.dateOrder=t},normalizeParsedDate(e,t,s){const{dateOptions:i}=this.state;return this.state.dateOrder.some(((a,n)=>{const r=this.state.dateOrder[n+1],o=i[null==r?void 0:r.subject],l=e[a.subject],d=i[a.subject],c=String(d.max).length,p=1===l.length&&+l<10&&+l>0,u=l>String(d.max),m=l.length>c;if(l&&m&&d.normalize&&(r||"year"===a.subject)){e[a.subject]=e[a.subject].slice(0,c);const t="year"===(null==r?void 0:r.subject),s=l[c],i=s>String(o.max);return e[r.subject]=i&&!t?`0${s}`:s,!0}return l&&d.normalize&&(p&&t||u)?e[a.subject]=`0${l[0]}`:"year"===a.subject?e[a.subject]=((e,t,s,i)=>{const a=String(s.min),n=String(s.max);e=String(e).slice(0,4);for(let s=1;s<=e.length;s++){const r=e.slice(0,s);if(r>n.slice(0,s)&&(e=i?n:t),r<a.slice(0,s)){e=i?a:t;break}}return e})(l,this.state.parsedDate.year,d,s):e[a.subject]=l,!1})),e},getParsedDate(e,t,s){const{defaultDateOrder:i,dateDivider:a}=this.state,n={date:"",month:"",year:"",...this.state.parsedDate},r=[...e.matchAll(new RegExp(`[${a}]`,"g"))],o=new Array(2).fill(null).map(((e,t)=>{var s,a;return null!=(s=null==(a=r[t])?void 0:a.index)?s:i[t+1].position-1}));return this.state.dateOrder=this.state.dateOrder.map(((e,t)=>({...e,position:t>0?o[t-1]+1:0}))),this.state.dividerPositions=o,this.state.dateOrder.forEach(((t,s)=>{var i;const a=this.state.dateOrder[s+1],r=null!=(i=o[s])?i:a&&a.position-1||e.length;n[t.subject]=e.slice(t.position,r)})),this.normalizeParsedDate(n,t,s)},getDateString(e){const{dateOrder:t,dateDivider:s,dateOptions:i}=this.state;e={date:"",month:"",year:"",...e};let a="";return t.forEach(((n,r)=>{var o;const l=null==(o=t[r+1])?void 0:o.subject,d=l?e[l]:null,c=e[n.subject],p=String(i[n.subject].max).length,u=d||""===d&&(null==c?void 0:c.length)===p;a+=`${qe(c)}${u?s:""}`})),a},parseDate(e){e.stopPropagation();const t=["deleteContentForward","deleteContentBackward"].includes(e.inputType),s="change"===e.type,{dateDivider:i,lastInputValue:a,maxLength:n}=this.state,r=e.target,o=r.selectionStart;let l=r.value.replace(new RegExp(`[^0-9${i}]`,"g"),"");const d=[...l.matchAll(new RegExp(`[${i}]`,"g"))].map((e=>e.index)),c=[...a.matchAll(new RegExp(`[${i}]`,"g"))].map((e=>e.index)),p=t&&a.length-l.length==1&&c.includes(o);if(2===d.length&&d[1]-d[0]==1&&d[0]<=1)return void this.setValue({date:"",month:"",year:""});if(c[1]-c[0]==1&&p)l=l.slice(0,o),this.fixCursorPosition(o);else if(l.length>n||d.length>2||p)return this.setValue(this.state.parsedDate),void(p&&this.fixCursorPosition(o));const u=s||e.data===i,m="insertFromPaste"===e.inputType;this.setValue(this.getParsedDate(l,u,m)),t&&this.state.lastInputValue.length===a.length&&this.fixCursorPosition(o)},setValue(e,t=!0,s=!0){const i=this.getDateString(e);this.checkValid(i,e),this.state.lastInputValue=i,this.state.parsedDate=e,s&&this.state.valid&&this.commit({date:+e.date||null,month:+e.month||null,year:+e.year||null,value:i}),t&&(this.$("input").value=i,this.update())},checkValid(e,t){const s=Object.keys(t).every((e=>{const s=t[e],i=this.state.dateOptions[e];return+s>=i.min&&+s<=i.max&&s.length===String(i.max).length}));this.state.valid=s||""===e},keydown(e){const t=38===e.keyCode,s=40===e.keyCode;if(t||s){e.preventDefault();const s=e.target.selectionStart,{dateOrder:i,maxLength:a,parsedDate:n,dateOptions:r}=this.state;i.some(((e,o)=>{const l=e.position,d=(i[o+1]&&i[o+1].position)-1||a+1;if(s>l-1&&s<=d){const s=+n[e.subject],i=r[e.subject],a=t?s+1:s-1;if(a>=i.min&&a<=i.max){const t=this.getDateString({...n,[e.subject]:String(qe(a))}),s=this.getParsedDate(t);this.setValue(s)}return this.setSelect(e.subject),!0}return!1}))}},setSelect(e){const{dateOrder:t,maxLength:s}=this.state;t.forEach(((i,a)=>{if(i.subject===e){const e=i.position,n=(t[a+1]&&t[a+1].position)-1||s+1;this.$("input").setSelectionRange(e,n)}}))},fixCursorPosition(e){setTimeout((()=>{this.$("input").setSelectionRange(e,e)}),0)},commit(e){this.props.onchange(e)},onBeforeMount(){this.initMask();const e="string"==typeof this.props.value?Ke(this.props.value,this.state.dateMask):this.props.value;e.date&&e.month&&e.year?this.setValue(this.normalizeParsedDate(e,!0,!0),!1,!1):this.setValue({date:"",month:"",year:""},!1,!1)},onBeforeUpdate(){const e=this.getDateString("string"==typeof this.props.value?Ke(this.props.value,this.state.dateMask):this.props.value);e!==this.state.lastInputValue&&!this.state.inFocus&&this.state.valid&&this.setValue(this.getParsedDate(e,!0,!0),!1,!1)}},template:(e,t,s,i)=>e('<div expr450="expr450" is="flexbe-input"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-date-input"}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:null,evaluate:e=>e.props},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.value},{type:t.ATTRIBUTE,name:"error",evaluate:e=>!e.state.inFocus&&e.state.error},{type:t.EVENT,name:"oninput",evaluate:e=>e.parseDate},{type:t.EVENT,name:"onchange",evaluate:e=>e.parseDate},{type:t.EVENT,name:"onkeydown",evaluate:e=>e.keydown}],redundantAttribute:"expr450",selector:"[expr450]"}]),name:"flexbe-date-input"};e(En.name,En);const In={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={isLoaded:!1,get data(){const t="object"==typeof e.props.data?e.props.data:{image:e.props.data};return{image:!1,lottie:!1,width:150,height:t.lottie?100:"auto",position:"top",animation:"fade",theme:"dark",...t}}},this.meta={get imgStyle(){return`\n                    display: block;\n                    width: ${e.state.data.width}px;\n                    height: ${e.state.data.height}px;\n                `},get lottieStyle(){return`\n                    width: ${e.state.data.width}px;\n                    height: ${e.state.data.height}px;\n                `}},this.watch={"state.isLoaded":()=>this.update()}},bindTipster(){let e=$(this.root).closest(".tooltip-origin");const t=[`tooltipster-${this.state.data.theme}`],{position:s,animation:i,lottie:a}=this.state.data;a&&t.push("tooltipster-lottie"),e.length&&(e=$(this.root).parent()),e.tooltipster({contentAsHTML:!0,trigger:"hover",theme:t,position:s,animation:i,functionInit:e=>{const t=$(this.root).find(".flexbe-hover-tip-content").html();e.content(t)}})},onMounted(){if(this.state.data.image){const e=new Image;e.onload=()=>{this.state.isLoaded=!0,e.remove(),setTimeout((()=>{this.bindTipster()}),100)},e.src=this.state.data.image}else this.state.isLoaded=!0,setTimeout((()=>{this.bindTipster()}),100)}},template:(e,t,s,i)=>e('<div expr451="expr451" class="flexbe-hover-tip-content"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-hover-tip ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.state.isLoaded,redundantAttribute:"expr451",selector:"[expr451]",template:e('<img expr452="expr452"/><lottie-player expr453="expr453" background="transparent" speed="1" loop autoplay></lottie-player><span expr454="expr454" class="flexbe-text"></span>',[{type:s.IF,evaluate:e=>e.state.data.image,redundantAttribute:"expr452",selector:"[expr452]",template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"src",evaluate:e=>e.state.data.image},{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.meta.imgStyle}]}])},{type:s.IF,evaluate:e=>e.state.data.lottie,redundantAttribute:"expr453",selector:"[expr453]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"lottie-player",slots:[],attributes:[{type:t.ATTRIBUTE,name:"src",evaluate:e=>e.state.data.lottie},{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.meta.lottieStyle}]}])},{type:s.IF,evaluate:e=>e.state.data.text,redundantAttribute:"expr454",selector:"[expr454]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.data.text].join("")}]}])}])}]),name:"flexbe-hover-tip"};e(In.name,In);const Cn={css:null,exports:{setup(e){this.state={get data(){return e.props.data}},this.meta={sprite:at("tip")}}},template:(e,t,s,i)=>e('<svg expr455="expr455" is="flexbe-icon" icon="tip"></svg><div expr456="expr456" is="flexbe-hover-tip"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-info-hover-tip tooltip-origin ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>14}],redundantAttribute:"expr455",selector:"[expr455]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-hover-tip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.state.data}],redundantAttribute:"expr456",selector:"[expr456]"}]),name:"flexbe-info-hover-tip"};e(Cn.name,Cn);const Sn={css:null,exports:i({setup(e,{initMobx:t}){t(),this.state={get size(){return e.props.size||"default"},get theme(){return e.props.theme||"default"},get value(){return e.props.value},get values(){return e.props.list||[]},get className(){const t=e.props.class||"",s=!1===e.props.separator?"":"separator";return`${t} size-${this.size} theme-${this.theme} ${s}`}},this.meta={sprite:e.props.sprite}},onMounted(){this.updateToggle(!1),this.initTooltips(),requestAnimationFrame((()=>{this.updateToggle(!1)}))},onUpdated(){this.updateToggle(!0)},updateToggle(e=!0){const t=this.root,s=this.$(".switch-toggle"),i=this.$(".switch-item.active");if(!s||!i)return s.style.left=0,void(s.style.width=0);s.style.display=i?"":"none";const{offsetLeft:a,offsetWidth:n}=i;e?anime({targets:s,left:a,width:n,easing:"easeOutQuad",duration:De(150,2*t.offsetWidth,350)}):(s.style.left=`${a}px`,s.style.width=`${n}px`)},initTooltips(){this.state.values.some((e=>e.tip))&&Wt(this.root,{position:"top",...this.props.tipOptions||{}})},onChange(e){"function"==typeof this.props.onChange&&this.props.onChange(e)}}),template:(e,t,s,i)=>e('<div expr463="expr463"></div><div class="switch-toggle"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-switch ",e.state.className].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e('<svg expr464="expr464"></svg><span expr466="expr466" class="flexbe-text"></span><div expr467="expr467" is="flexbe-hover-tip"></div><div expr468="expr468" is="raw" class="switch-tag"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["switch-item ",e.classNames({active:e.item.value===e.state.value,"tooltip-origin":e.item.hoverTip})].join("")},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.item.tip},{type:t.ATTRIBUTE,name:"data-value",evaluate:e=>e.item.value},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.onChange(e.item)}]},{type:s.IF,evaluate:e=>e.item.icon,redundantAttribute:"expr464",selector:"[expr464]",template:e('<use expr465="expr465"/>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-icon size-",e.item.iconWidth||e.item.iconHeight?"auto":e.item.iconSize||16].join("")}]},{redundantAttribute:"expr465",selector:"[expr465]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.item.sprite||e.meta.sprite,"#",e.item.icon].join("")}]}])},{type:s.IF,evaluate:e=>e.item.title,redundantAttribute:"expr466",selector:"[expr466]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.title}]}])},{type:s.IF,evaluate:e=>e.item.hoverTip,redundantAttribute:"expr467",selector:"[expr467]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-hover-tip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.item.hoverTip}]}])},{type:s.IF,evaluate:e=>e.item.children,redundantAttribute:"expr468",selector:"[expr468]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.item.children}]}])}]),redundantAttribute:"expr463",selector:"[expr463]",itemName:"item",indexName:null,evaluate:e=>e.state.values}]),name:"flexbe-switch"};e(Sn.name,Sn);const $n={css:null,exports:i({setup(e,{initMobx:t}){t(),this.state={_lastIsOpen:!!e.props.isOpen,inDropdownIndex:null,get isOpen(){return!!e.props.isOpen},get type(){return e.props.type||"block"},get duration(){var t;return null!=(t=e.props.duration)?t:200},get actions(){return e.props.actions||[]},get iconSize(){return e.props.iconSize||14},get clickableHeader(){var t;return null!=(t=e.props.clickableHeader)?t:"block"===this.type},get stickyHeader(){return e.props.stickyHeader},get showSwitch(){var t;return null==(t=e.props.showSwitch)||t},get showActions(){return e.props.showActionsOnClose||this.isOpen},get spoilerStyle(){return`--duration: ${this.duration/1e3}s`}},this.meta={innerSprite:at("core")},this.watch={"state.inDropdownIndex":()=>this.update(),"state.isOpen":()=>this.animateSpoiler()}},onOpenDropdown(e){this.state.inDropdownIndex=e},onCloseDropdown(){this.state.inDropdownIndex=null},onMounted(){if(!this.state.isOpen){this.$(".flexbe-spoiler-body").style.setProperty("height",0)}},animateSpoiler(){const{isOpen:e,_lastIsOpen:t,duration:s}=this.state;if(!!e!=!!t){const t=this.$(".flexbe-spoiler-body"),i=t.scrollHeight;anime({targets:t,height:e?[0,i]:[i,0],opacity:e?[.3,1]:[1,0],scale:e?[.99,1]:[1,.99],duration:s,easing:"easeInOutQuart",complete:()=>{e&&t.style.removeProperty("height")}}),this.state._lastIsOpen=e}},toggleSpoiler(e){var t,s;null==e.preventDefault||e.preventDefault(),null==e.stopPropagation||e.stopPropagation(),null==(t=(s=this.props).onToggle)||t.call(s,!this.state.isOpen)},onAction(e,t){null==t.preventDefault||t.preventDefault(),null==t.stopPropagation||t.stopPropagation(),null==e.action||e.action(e,t)}}),template:(e,t,s,i)=>e('<div expr469="expr469"><div expr470="expr470"><span expr471="expr471" class="flexbe-text"> </span><q expr472="expr472" is="flexbe-tooltip"></q></div><div class="flexbe-spoiler-header__controls"><div class="flexbe-spoiler-header__actions"><div expr473="expr473" is="flexbe-tooltip" type="custom"></div><div expr480="expr480" class="flexbe-spoiler-header__switch flexbe-button is-secondary filling borderless scale-onclick"></div></div></div></div><div expr483="expr483"><div expr484="expr484"><slot expr485="expr485"></slot></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-spoiler flexbe-field-block paddingless ",`${e.state.type}-style`," ",e.props.class," ",e.classNames({opened:e.state.isOpen})].join("")},{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.state.spoilerStyle}]},{redundantAttribute:"expr469",selector:"[expr469]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-spoiler-header flexbe-field-block borderless ",e.props.headerClass," ",e.classNames({clickable:e.state.clickableHeader,sticky:e.state.stickyHeader})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.state.clickableHeader?e.toggleSpoiler:null}]},{redundantAttribute:"expr470",selector:"[expr470]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-spoiler-header__title flexbe-title ",e.props.titleClass].join("")}]},{redundantAttribute:"expr471",selector:"[expr471]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.props.spoilerTitle}]},{type:s.IF,evaluate:e=>e.props.tip,redundantAttribute:"expr472",selector:"[expr472]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.props.tip}]}])},{type:s.EACH,getKey:null,condition:e=>e.state.showActions,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[{id:"default",html:'<svg expr474="expr474" is="flexbe-icon"></svg><div expr475="expr475" is="proxy" data-is="dropdown" balloon-class="flexbe-spoiler-header__balloon" data-layers-events="ignore"></div>',bindings:[{type:s.IF,evaluate:e=>e.action.icon,redundantAttribute:"expr474",selector:"[expr474]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.action.icon},{type:t.ATTRIBUTE,name:"size",evaluate:e=>e.state.iconSize}]}])},{type:s.IF,evaluate:e=>e.action.dropdown&&e.action.dropdown.length,redundantAttribute:"expr475",selector:"[expr475]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div expr476="expr476" data-layers-events="ignore"><div expr477="expr477" class="flexbe-list-item"></div></div>',bindings:[{redundantAttribute:"expr476",selector:"[expr476]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list vertical-gaps borderless hoverable hoverable-background ",e.action.dropdownClass||""].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e('<div expr478="expr478" class="item-icon" is="flexbe-icon"></div><div expr479="expr479" class="item-name flexbe-text"> </div>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>t=>null==e.item.action?void 0:e.item.action(e.action,t)}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.item.icon},{type:t.ATTRIBUTE,name:"size",evaluate:e=>e.item.iconSize||16}],redundantAttribute:"expr478",selector:"[expr478]"},{redundantAttribute:"expr479",selector:"[expr479]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.text}]}]),redundantAttribute:"expr477",selector:"[expr477]",itemName:"item",indexName:null,evaluate:e=>e.action.dropdown}]}],attributes:[{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"arrow",evaluate:e=>!1},{type:t.EVENT,name:"onopen",evaluate:e=>()=>e.onOpenDropdown(e.index)},{type:t.EVENT,name:"onclose",evaluate:e=>()=>e.onCloseDropdown()},{type:t.ATTRIBUTE,name:"min-width",evaluate:e=>180}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.action.tip},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button tooltipstered flexbe-button is-secondary filling borderless scale-onclick ",e.action.class," ",e.classNames({active:e.action.active||e.index===e.state.inDropdownIndex})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>t=>e.onAction(e.action,t)}]}]),redundantAttribute:"expr473",selector:"[expr473]",itemName:"action",indexName:"index",evaluate:e=>e.state.actions},{type:s.IF,evaluate:e=>e.state.showSwitch,redundantAttribute:"expr480",selector:"[expr480]",template:e('<div expr481="expr481" is="flexbe-icon"></div><div expr482="expr482" is="flexbe-icon"></div>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.toggleSpoiler}]},{type:s.IF,evaluate:e=>"block"===e.state.type,redundantAttribute:"expr481",selector:"[expr481]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.state.isOpen?"move-up":"move-down"},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.innerSprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>e.state.iconSize}]}])},{type:s.IF,evaluate:e=>"group"===e.state.type,redundantAttribute:"expr482",selector:"[expr482]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.state.isOpen?"minus-light":"plus-light"},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.innerSprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>e.state.iconSize}]}])}])},{redundantAttribute:"expr483",selector:"[expr483]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-spoiler-body ",e.props.bodyClass].join("")}]},{redundantAttribute:"expr484",selector:"[expr484]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-field-block borderless ",e.classNames({paddingless:"block"===e.state.type})].join("")}]},{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr485",selector:"[expr485]"}]),name:"flexbe-spoiler"};e($n.name,$n);const Bn={css:null,exports:{_raf:null,setup(){this.state={scrollHeight:0,barHeight:0,barTop:0}},onMounted(){this.scrollbar=this.$(".scrollbar"),this.scrollContainer=this.$(".flexbe-scrollable-container"),this.bindEvents()},onBeforeUnmount(){clearInterval(this._raf)},bindEvents(){this.scrollbar.addEventListener("pointerdown",(e=>{e.preventDefault(),e.stopPropagation(),this.startDrag(e),this.toggleDrag(!0),$document.off("pointermove.flexbe-scrollable").on("pointermove.flexbe-scrollable",(e=>{this.processDrag(e)})),$document.off("pointerup.flexbe-scrollable").on("pointerup.flexbe-scrollable",(e=>{$document.off(".flexbe-scrollable"),this.processDrag(e),this.endDrag(e),this.toggleDrag(!1)}))})),this._raf=setInterval((()=>{this.scrollContainer.scrollHeight!==this.state.scrollHeight&&this.draw()}),100)},draw(){this.state.scrollHeight=this.scrollContainer.scrollHeight,this.state.barHeight=this.scrollContainer.clientHeight/this.state.scrollHeight*100,this.state.barTop=this.scrollContainer.scrollTop/this.state.scrollHeight*100,this.toggleShowScrollbar(this.state.barHeight<100),this.scrollbar.style.setProperty("--ms-thumb-offset",`${this.state.barTop}%`),this.scrollbar.style.setProperty("--ms-thumb-length",`${this.state.barHeight}%`)},onScroll(e){var t,s;this.draw(),null==(t=(s=this.props).onscroll)||t.call(s,e)},startDrag(e){e.preventDefault(),e.stopPropagation();const t=this.scrollContainer.offsetHeight,s=this.scrollContainer.scrollTop,i=this.scrollContainer.scrollHeight,a=e.screenY;this.dragMeta={fromScrollOffset:s,fromScrollSize:i,fromOffset:a,totalDistance:t}},processDrag(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=e.screenY,{fromOffset:s,fromScrollOffset:i,fromScrollSize:a,totalDistance:n}=this.dragMeta,r=(t-s)/n;this.scrollContainer.scrollTop=i+a*r},endDrag(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()},toggleShowScrollbar(e){this.root.classList.toggle("show-scrollbar",e)},toggleHover(e){this.root.classList.toggle("hover",e)},toggleDrag(e){this.root.classList.toggle("in-drag",e)}},template:(e,t,s,i)=>e('<div expr486="expr486"><slot expr487="expr487"></slot></div><div class="scrollbar"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-scrollable ",e.props.class].join("")},{type:t.EVENT,name:"onpointerenter",evaluate:e=>()=>e.toggleHover(!0)},{type:t.EVENT,name:"onpointerleave",evaluate:e=>()=>e.toggleHover(!1)}]},{redundantAttribute:"expr486",selector:"[expr486]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-scrollable-container ",e.props.containerClass].join("")},{type:t.EVENT,name:"onscroll",evaluate:e=>e.onScroll}]},{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr487",selector:"[expr487]"}]),name:"flexbe-scrollable"};e(Bn.name,Bn);const Un={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get sprite(){const t=e.props.sprite;return/\//.test(t)?t:at(t)},get list(){return e.props.list.map((e=>(e.sprite&&!/\//.test(e.sprite)&&(e.sprite=at(e.sprite)),e)))},get onlyIcons(){return this.list.some((e=>!e.title&&e.icon))},get class(){const t=this.onlyIcons?"flexbe-icon-list":"flexbe-list hoverable hoverable-background";return e.props.class||t},get listContainerStyles(){let t=e.props.maxHeight;return t?("number"==typeof t&&(t=`${t}px`),t?`max-height: ${t}`:""):""}},this.watch={"state.list":[()=>this.update()]}},onMounted(){this.initTooltips()},onUpdated(){this.initTooltips()},initTooltips(){Wt(this.root)}},template:(e,t,s,i)=>e('<div expr488="expr488" is="flexbe-scrollable"></div><template expr493="expr493"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.state.class}]},{type:s.IF,evaluate:e=>!e.state.onlyIcons,redundantAttribute:"expr488",selector:"[expr488]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-scrollable",slots:[{id:"default",html:'<div expr489="expr489"></div>',bindings:[{type:s.EACH,getKey:null,condition:null,template:e('<svg expr490="expr490" class="flexbe-icon"></svg><div expr492="expr492" class="flexbe-text"> </div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list-item ",e.classNames({active:e.item.active})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.props.onSelect(e.item)}]},{type:s.IF,evaluate:e=>e.item.icon,redundantAttribute:"expr490",selector:"[expr490]",template:e('<use expr491="expr491"/>',[{redundantAttribute:"expr491",selector:"[expr491]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.item.sprite||e.state.sprite,"#",e.item.icon].join("")}]}])},{redundantAttribute:"expr492",selector:"[expr492]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.title}]}]),redundantAttribute:"expr489",selector:"[expr489]",itemName:"item",indexName:null,evaluate:e=>e.state.list}]}],attributes:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>[e.state.listContainerStyles,";"].join("")}]}])},{type:s.IF,evaluate:e=>e.state.onlyIcons,redundantAttribute:"expr493",selector:"[expr493]",template:e('<div expr494="expr494" data-tip-duration="[180, 0]"></div>',[{type:s.EACH,getKey:null,condition:null,template:e('<svg expr495="expr495" class="flexbe-icon size-16"></svg>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-icon-list__item ",e.classNames({active:e.item.active})].join("")},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.item.tip},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.props.onSelect(e.item)}]},{type:s.IF,evaluate:e=>e.item.icon,redundantAttribute:"expr495",selector:"[expr495]",template:e('<use expr496="expr496"/>',[{redundantAttribute:"expr496",selector:"[expr496]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.item.sprite||e.state.sprite,"#",e.item.icon].join("")}]}])}]),redundantAttribute:"expr494",selector:"[expr494]",itemName:"item",indexName:null,evaluate:e=>e.state.list}])}]),name:"flexbe-list"};e(Un.name,Un);const Rn={css:null,exports:{setup(e,{initMobx:t}){var s;t(),this.input=null,this.button=null,this.dropdown=null,this.observer=At({}),this.state={inDropdown:!1,autofocus:null!=(s=e.props.autofocus)&&s,isHide:!0,get error(){return e.props.error||!1},get list(){var t;return null!=(t=e.props.list)?t:[]},get value(){var t;return null!=(t=e.props.value)?t:""}},this.meta={sprite:at("settings","admin")},this.watch={"state.inDropdown":[()=>this.update()],"state.isHide":[()=>this.update()],"state.error":[()=>this.update()]}},addVarInText(e){var t;const s=null!=(t=$(e.target).attr("data-value"))?t:"",i=this.insertSubstr(s),a=Number(this.input.selectionStart)+Number(s.length);this.props.commit(i),requestAnimationFrame((()=>{this.input.setSelectionRange(a,a)}))},insertSubstr(e){const t=this.state.value.split("");return t.splice(this.input.selectionStart,0,e),t.join("")},onOpen(){this.state.inDropdown=!0,this.dropdown=this.$(".dropdown__balloon"),this.dropdown&&this.dropdown.addEventListener("pointerdown",(e=>{e.preventDefault(),e.stopPropagation()}))},onClose(){this.state.inDropdown=!1},onMounted(){this.input=this.$(`${this.props.type}`),this.button=this.$(".flexbe-button"),this.input.addEventListener("focus",(()=>{this.state.isHide=!1})),this.input.addEventListener("blur",(()=>{this.state.isHide=!0,setTimeout((()=>{this.state.isHide&&this.observer.trigger("closeDropdown")}),60)})),this.input.addEventListener("pointerdown",(e=>{e.stopPropagation()})),this.button.addEventListener("pointerdown",(e=>{e.preventDefault(),e.stopPropagation()}))}},template:(e,t,s,i)=>e('<div expr497="expr497" is="flexbe-input"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-input-dropdown"}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[{id:"default",html:'<div expr498="expr498"><svg expr499="expr499" is="flexbe-icon" size="16" icon="book"></svg><div expr500="expr500" is="proxy" data-is="dropdown" relative=".flexbe-input-dropdown" balloon-class="input-dropdown-component" position="center" direction="bottom" trigger="click" position-to=".flexbe-input-dropdown"></div></div>',bindings:[{redundantAttribute:"expr498",selector:"[expr498]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button filled is-light ",e.classNames({active:e.state.inDropdown,hide:e.state.isHide})].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr499",selector:"[expr499]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="flexbe-list borderless"><span expr501="expr501" class="flexbe-desc flexbe-list-title"> </span><label expr502="expr502" class="flexbe-list-item"></label></div>',bindings:[{redundantAttribute:"expr501",selector:"[expr501]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.props.title}]},{type:s.EACH,getKey:null,condition:null,template:e('<span expr503="expr503" class="flexbe-text text-s blue-button"> </span><span expr504="expr504" class="flexbe-text text-s"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"data-value",evaluate:e=>e.item.value},{type:t.EVENT,name:"onclick",evaluate:e=>t=>e.addVarInText(t)}]},{redundantAttribute:"expr503",selector:"[expr503]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.value}]},{redundantAttribute:"expr504",selector:"[expr504]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.desc}]}]),redundantAttribute:"expr502",selector:"[expr502]",itemName:"item",indexName:null,evaluate:e=>e.state.list}]}],attributes:[{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"width-by-relative",evaluate:e=>100},{type:t.ATTRIBUTE,name:"autohide",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"arrow",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"scrollable",evaluate:e=>!1},{type:t.EVENT,name:"onopen",evaluate:e=>e.onOpen},{type:t.EVENT,name:"onclose",evaluate:e=>e.onClose},{type:t.ATTRIBUTE,name:"observer",evaluate:e=>e.observer}],redundantAttribute:"expr500",selector:"[expr500]"}]}],attributes:[{type:t.ATTRIBUTE,name:"type",evaluate:e=>e.props.type},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.props.placeholder},{type:t.EVENT,name:"oninput",evaluate:e=>e.props.oninput},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.value},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>e.state.autofocus},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.state.error},{type:t.ATTRIBUTE,name:"htmlspecialchars",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.classNames({"show-btn":!e.state.isHide})}],redundantAttribute:"expr497",selector:"[expr497]"}]),name:"flexbe-input-dropdown"};e(Rn.name,Rn);var Pn=zt("get"),Hn=zt("set"),jn=zt("remove");function Fn(e,t=localStorage){return t.getItem(e)}function Ln(e,t,s=localStorage){s.setItem(e,t)}function Nn(e,t=localStorage){t.removeItem(e)}const Mn=new class{constructor(){Object.defineProperty(this,jn,{value:Nn}),Object.defineProperty(this,Hn,{value:Ln}),Object.defineProperty(this,Pn,{value:Fn})}get(e){var t;const s=JSON.parse(null!=(t=qt(this,Pn)[Pn](e,sessionStorage))?t:qt(this,Pn)[Pn](e,localStorage));return s&&"object"==typeof s&&"expire"in s&&"value"in s?s.expire>Date.now()?s.value:null:s}set(e,t,s){this.remove(e),"session"!==s?("string"==typeof s&&(s=(e=>{const t=e.slice(-1),s=parseInt(e.slice(0,-1),10);switch(t){case"d":return 24*s*60*60*1e3;case"h":return 60*s*60*1e3;case"m":return 60*s*1e3;default:return 0}})(s)),s&&"number"==typeof s?qt(this,Hn)[Hn](e,JSON.stringify({value:t,expire:Date.now()+s})):qt(this,Hn)[Hn](e,JSON.stringify(t))):qt(this,Hn)[Hn](e,JSON.stringify(t),sessionStorage)}remove(e){qt(this,jn)[jn](e,sessionStorage),qt(this,jn)[jn](e,localStorage)}},Dn=Ut(),Vn=`https://cdn.jsdelivr.net/npm/monaco-editor@${"Safari"===Dn.name&&!Rt(Dn.version,"13.2")?"0.31.1":"0.43.0"}/min/vs`,On=["https://cdn.jsdelivr.net/npm/monaco-editor-ex/dist/monaco-editor-ex.iife.min.js","https://cdn.jsdelivr.net/npm/emmet-monaco-es/dist/emmet-monaco.min.js","/_s/lib/monaco-editor/html-linter/monaco-html-linter.min.js?2",`${Vn}/basic-languages/less/less.js`],zn={gray:{colors:{"editor.lineHighlightBackground":"#30343b08","editor.background":"#f5f5f5"}},dark:{colors:{"editor.lineHighlightBackground":"#ffffff0d"}},light:{colors:{"editor.lineHighlightBackground":"#30343b08"}}},qn={css:null,exports:{setup(e,{initMobx:t,inject:s}){var i;t(),this.modal=s("modal"),this.state={id:Ge(6),theme:Mn.get("f_monaco_editor_theme")||"vs",language:e.props.language||"html",fullscreenMode:!1,monacoInstance:null,visibleModalList:[],readOnly:(null==(i=e.props)?void 0:i.readonly)||!1,get value(){var t;return null!=(t=e.props.value)?t:e.props.riotValue},get loading(){return!this.monacoInstance||e.props.loading},get settings(){return{lineNumbers:"on",lineDecorationsWidth:0,lineNumbersMinChars:3,autoClosingBrackets:"always",fixedOverflowWidgets:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,padding:{top:12,bottom:12},readOnly:this.readOnly,smoothScrolling:!0,matchBrackets:"always",overviewRulerLanes:0,overviewRulerBorder:!1,showFoldingControls:"mouseover",tabSize:2,autoIndent:!0,formatOnPaste:!1,formatOnType:!0,unicodeHighlight:{ambiguousCharacters:!1},...e.props.settings,theme:this.theme,language:this.language,value:this.value,scrollbar:{horizontalScrollbarSize:6,verticalScrollbarSize:6}}}},this.meta={sprite:at("core"),spriteEditor:at("monaco-editor")},this.watch={"state.value":[()=>this.update()],"state.theme":[()=>this.update()],"state.fullscreenMode":[()=>this.update()]}},async onMounted(){this.initEventChangeMonacoTheme(),await this.initMonaco()},onConnected(){this.updatePlaceholder()},async onUpdated(){if(!this.state.monacoInstance)return;this.isUpdating=!0;const e=this.state.value||"",t=this.state.monacoInstance.getValue();e&&t!==e&&this.state.monacoInstance.setValue(e),this.isUpdating=!1},onUnmounted(){flexbe.off(`changeMonacoTheme.${this.state.id}`)},initEventChangeMonacoTheme(){flexbe.off(`changeMonacoTheme.${this.state.id}`).on(`changeMonacoTheme.${this.state.id}`,(()=>{this.state.theme=Mn.get("f_monaco_editor_theme"),monaco.editor.setTheme(this.state.theme)}))},async initMonaco(){await Promise.all([xe([`${Vn}/editor/editor.main.min.css`]),be([`${Vn}/loader.js`])]),require.config({paths:{vs:Vn}}),"en"!==flexbe.vars.user.lang&&require.config({"vs/nls":{availableLanguages:{"*":`${flexbe.vars.user.lang}`}}}),require(["vs/editor/editor.main"],(async()=>{await be(On);const e=$(this.root);MonacoEditorEx.useMonacoEx(monaco);const t=monaco.editor.create(this.root,{...this.state.settings,value:this.state.value});if(emmetMonaco.emmetHTML(),this.defineTheme("vs",this.props.themeGray?zn.gray:zn.light),this.defineTheme("vs-dark",zn.dark),this.props.onrun&&this.registerAction(t,"onrun",[monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter],this.props.onrun),this.props.onsave&&this.registerAction(t,"onsave",[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyS],this.props.onsave),this.registerAction(t,"onclose",[monaco.KeyCode.Escape],this.closeEditor),t.onDidFocusEditorWidget((()=>{this.props.onfocus&&this.props.onfocus()})),t.onDidBlurEditorWidget((()=>{this.props.onblur&&this.props.onblur()})),t.onDidContentSizeChange((()=>{this.updateLayout(t)})),t.onDidChangeModelContent((()=>{this.isUpdating||this.props.oninputchange({value:t.getValue()}),e.find(".overflow-guard").toggleClass("error",!!this.props.error),this.props.onlint&&this.linterResponse(t)})),this.updateLayout(t),this.props.onlint){new HTMLMonacoLinter(t,monaco).watch(),this.linterResponse(t)}this.state.monacoInstance=t,this.update(),this.props.autofocus&&this.state.monacoInstance.focus()}))},linterResponse(e){const t=e.getValue(),s=new HTMLMonacoMarks(t).getLinterResponse();t!==this.state.value&&this.props.onlint(s)},updatePlaceholder(){const e=this.root.querySelector(".flexbe-placeholder"),t=this.root.querySelector(".flexbe-input__textarea");$(e).css("height",`${t.scrollHeight}px`),$(t).hide(),this.update()},updateLayout(e){const t=this.root.querySelector(".flexbe-monaco-editor__hittest");t&&($(t).width(e.getContentWidth()),$(t).height(e.getContentHeight()),e.layout({width:t.offsetWidth,height:t.offsetHeight}))},registerAction(e,t,s,i){e.addAction({id:t,label:t,keybindings:s,run:()=>{i()}})},defineTheme(e,t){monaco.editor.defineTheme(e,{base:e,inherit:!0,rules:[{background:"EDF9FA"}],...t})},setValue(e){this.state.monacoInstance.setValue(e)},changeScreenMode(){this.state.fullscreenMode?this.closeFullscreen():this.openFullscreen(),this.state.fullscreenMode=!this.state.fullscreenMode},closeFullscreen(){const e=$(this.root);$(".monaco-editor-placeholder").replaceWith(e),$(".full-screen-editor-overlay").remove(),this.changeVisibleModalList(!0),this.updateScreen()},openFullscreen(){const e=$(this.root);this.changeVisibleModalList(!1),$("body").append('<div class="full-screen-editor-overlay"></div>'),e.replaceWith('<div class="monaco-editor-placeholder"></div>'),$(".full-screen-editor-overlay").append(e),this.updateScreen()},changeVisibleModalList(e){e?(this.state.visibleModalList.forEach((e=>{null==e||e.show()})),this.state.visibleModalList=[]):(this.state.visibleModalList=flexbe.modal.visible,this.state.visibleModalList.forEach((e=>{null==e||e.hide()})))},updateScreen(){const{monacoInstance:e}=this.state;this.updateLayout(e),setTimeout((()=>{this.isMounted&&e.focus()}),20)},closeEditor(){this.state.fullscreenMode?(this.closeFullscreen(),this.state.fullscreenMode=!this.state.fullscreenMode):(document.activeElement.blur(),setTimeout((()=>{var e;return null==(e=this.modal)?void 0:e.cancel()}),60))},changeMonacoTheme(){const{monacoInstance:e}=this.state,t=Mn.get("f_monaco_editor_theme");Mn.set("f_monaco_editor_theme","vs"===t?"vs-dark":"vs"),flexbe.trigger("changeMonacoTheme"),setTimeout((()=>{this.isMounted&&e.focus()}),20)}},template:(e,t,s,i)=>e('<textarea expr505="expr505" class="flexbe-input-styled flexbe-input__textarea overflow-y"></textarea><div expr506="expr506" class="flexbe-placeholder"></div><div expr507="expr507"></div><div expr514="expr514" class="flexbe-input__addon"></div><span class="flexbe-monaco-editor__hittest"></span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-monaco-editor ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>!e.state.monacoInstance,redundantAttribute:"expr505",selector:"[expr505]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.value},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>!0}]}])},{type:s.IF,evaluate:e=>e.state.loading,redundantAttribute:"expr506",selector:"[expr506]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.state.loading,redundantAttribute:"expr507",selector:"[expr507]",template:e('<div expr508="expr508"><svg expr509="expr509" is="flexbe-icon" icon="theme-dark" size="14"></svg><svg expr510="expr510" is="flexbe-icon" icon="theme-light" size="14"></svg></div><div expr511="expr511"><svg expr512="expr512" is="flexbe-icon" icon="fullscreen-open"></svg><svg expr513="expr513" is="flexbe-icon" icon="fullscreen-close"></svg></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["monaco-button-group ",e.state.theme].join("")}]},{redundantAttribute:"expr508",selector:"[expr508]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button small filled ","vs"===e.state.theme?"is-light":"is-dark"].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.changeMonacoTheme}]},{type:s.IF,evaluate:e=>"vs"===e.state.theme,redundantAttribute:"expr509",selector:"[expr509]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.spriteEditor}]}])},{type:s.IF,evaluate:e=>"vs-dark"===e.state.theme,redundantAttribute:"expr510",selector:"[expr510]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.spriteEditor}]}])},{redundantAttribute:"expr511",selector:"[expr511]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button small filled ","vs"===e.state.theme?"is-light":"is-dark"].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.changeScreenMode}]},{type:s.IF,evaluate:e=>!e.state.fullscreenMode,redundantAttribute:"expr512",selector:"[expr512]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.spriteEditor}]}])},{type:s.IF,evaluate:e=>e.state.fullscreenMode,redundantAttribute:"expr513",selector:"[expr513]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.spriteEditor}]}])}])},{type:s.IF,evaluate:e=>e.props.error,redundantAttribute:"expr514",selector:"[expr514]",template:e('<span expr515="expr515" class="flexbe-error error-text shadow"></span><span expr516="expr516" class="error-tip" is="flexbe-tooltip"></span>',[{type:s.IF,evaluate:e=>e.props.error&&e.props.errorText,redundantAttribute:"expr515",selector:"[expr515]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.props.errorText].join("")}]}])},{type:s.IF,evaluate:e=>e.props.error&&e.props.errorTip,redundantAttribute:"expr516",selector:"[expr516]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.props.errorTip}]}])}])}]),name:"flexbe-monaco-editor"};e(qn.name,qn);const Gn={css:null,exports:{setup(e,{initMobx:t}){t(),this.sprite=at("core"),this.state={get text(){return e.props.text||tr("editor::presets::presets_text")},get buttonText(){return e.props.buttonText||tr("editor::presets::presets_button")},get icon(){return e.props.icon}}}},template:(e,t,s,i)=>e('<div class="presets-info"><svg expr517="expr517" is="flexbe-icon" size="34"></svg><div expr518="expr518" class="flexbe-text"> </div></div><div expr519="expr519" class="flexbe-button filled is-secondary"><svg expr520="expr520" is="flexbe-icon" size="14" icon="preset"></svg><div expr521="expr521" class="flexbe-text"> </div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-presets-banner ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.state.icon,redundantAttribute:"expr517",selector:"[expr517]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.icon}]}])},{redundantAttribute:"expr518",selector:"[expr518]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.text}]},{redundantAttribute:"expr519",selector:"[expr519]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.props.onOpen}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr520",selector:"[expr520]"},{redundantAttribute:"expr521",selector:"[expr521]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.buttonText].join("")}]}]),name:"flexbe-presets-banner"};e(Gn.name,Gn);const Xn=/^xn--/,Kn=/[\x2E\u3002\uFF0E\uFF61]/g,Wn={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Zn=Math.floor;function Yn(e){throw new RangeError(Wn[e])}const Jn=function(e,t,s){let i=0;for(e=s?Zn(e/700):e>>1,e+=Zn(e/t);e>455;i+=36)e=Zn(e/35);return Zn(i+36*e/(e+38))},Qn=function(e){return function(e,t){const s=e.split("@");let i="";s.length>1&&(i=s[0]+"@",e=s[1]);const a=function(e,t){const s=[];let i=e.length;for(;i--;)s[i]=t(e[i]);return s}((e=e.replace(Kn,".")).split("."),t).join(".");return i+a}(e,(function(e){return Xn.test(e)?function(e){const t=[],s=e.length;let i=0,a=128,n=72,r=e.lastIndexOf("-");r<0&&(r=0);for(let s=0;s<r;++s)e.charCodeAt(s)>=128&&Yn("not-basic"),t.push(e.charCodeAt(s));for(let l=r>0?r+1:0;l<s;){let r=i;for(let t=1,a=36;;a+=36){l>=s&&Yn("invalid-input");const r=(o=e.charCodeAt(l++))-48<10?o-22:o-65<26?o-65:o-97<26?o-97:36;(r>=36||r>Zn((2147483647-i)/t))&&Yn("overflow"),i+=r*t;const d=a<=n?1:a>=n+26?26:a-n;if(r<d)break;const c=36-d;t>Zn(2147483647/c)&&Yn("overflow"),t*=c}const d=t.length+1;n=Jn(i-r,d,0==r),Zn(i/d)>2147483647-a&&Yn("overflow"),a+=Zn(i/d),i%=d,t.splice(i++,0,a)}var o;return String.fromCodePoint(...t)}(e.slice(4).toLowerCase()):e}))},er=e=>!!e.match(/^((https?:\/\/)?[\w+.---]+)\.([\da-z--]*|xn--[\da-z]*)$/gi),sr=e=>!!e.match(/^((https?:\/\/)?[\w+.---]+)\.([\da-z--]*|xn--[\da-z]*)\/?$/gi),ir=(e,t={})=>{if(!e||e.length<1)return!1;if("http://"===(e=String(e)).substr(0,7)||"https://"===e.substr(0,8))try{const t=new URL(e);return er(t.hostname)}catch(e){return!1}return!t.fullLink},ar=e=>/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z--\-0-9]+\.)+[a-zA-Z--]{2,}))$/.test(e),nr=(e,t,s)=>("_"===(e=(e=$.trim(e)).replace(/ +/g,"_")).substr(0,1)&&(e=e.substr(1,e.length-1)),"_"===e.substr(e.length-1,1)&&(e=e.substr(0,e.length-1)),e=e.replace(new RegExp("[^a-z-0-9/._-]","gi"),""),s&&(e=or(e,!1)),e=e.substr(0,250),t?("/"!==e.substr(0,1)&&(e=`/${e}`),"/"!==e.substr(e.length-1,1)&&(e+="/"),e=e.replace(new RegExp("/{2,}","g"),"/")):e=e.replace(new RegExp("^/|/$","g"),""),e=e.toLowerCase(),e=$.trim(e)),rr=(e,{location:t=window.location,relativeHostname:s=!0,relativePathname:i=!1,leadingSlash:a=null}={})=>{e=(e=(e=(e=e.replace(/^[hpt]{2,4}(s{0,2}):{1,2}\/{1,3}/,"http$1://")).replace(/^[eflnot]{2,8}:/,"tel:")).replace(/^[ailmot]{3,7}:/,"mailto:")).replace(/(\\)$/,"/");try{e=decodeURI(e)}catch(e){}if(!/^(http|mailto:|tel:)/.test(e)){const s="https://",i=e.split("/");""===i[0]?e=`${s}${t.hostname}${e}`:er(i[0])&&(e=`${s}${e}`)}if(s||i){const s=/[\d._--]{1,40}[a-z]*.[-]{2,6}', 'i'/.test(e)?Qn(t.hostname):t.hostname,i=new RegExp(`https?://${s}($|/)`);i.test(e)&&(e=e.replace(i,"/"))}if(i){const s=t.pathname.replace(/\/$/,"");e=e.replace(new RegExp(`^${s}/?`),"")}if(null!=a&&e){e=/\/?[#?]/.test(e)?e.replace(/\/?(\?|#)/,a?"/$1":"$1"):e.replace(/\/?$/,a?"/":"")}return e},or=(e,t=!0)=>{const s=[["","a"],["","b"],["","v"],["","g"],["","d"],["","e"],["","yo"],["","zh"],["","z"],["","i"],["","y"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","r"],["","s"],["","t"],["","u"],["","f"],["","h"],["","c"],["","ch"],["","sh"],["","shch"],["",""],["","y"],["",""],["","e"],["","yu"],["","ya"],["","A"],["","B"],["","V"],["","G"],["","D"],["","E"],["","Yo"],["","Zh"],["","Z"],["","I"],["","Y"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","R"],["","S"],["","T"],["","U"],["","F"],["","H"],["","C"],["","Ch"],["","Sh"],["","Shch"],["",""],["","Y"],["",""],["","E"],["","Yu"],["","Ya"],t?[" "," "]:[" ","_"]];return e.split("").map((e=>{const[t,i]=s.find((t=>t[0]===e))||[];return t===e?i:e})).join("").replace(/_{2,}/gim,"_")};riot3.tag2("flexbe-input-link",'<div class="flexbe-field-group is-inline"> <div data-is="flexbe-input" error="{isError()}" error-level="{opts.errorLevel}" error-tip="{opts.errorTip}" placeholder="{opts.placeholder}" name="{opts.name}" autocomplete="off" riot-value="{opts.riotValue}" onchange="{onChange}" oninput="{onInput}" ref="flexbeInput"></div> <div if="{tag.links.length > 1}" class="show-hide-links"> <div class="flexbe-button {opts.buttonClass}"> <svg class="flexbe-icon size-18" viewbox="0 0 18 4"> <path transform="rotate(-90 2 2)" d="M4 2a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm0 7a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm-2 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path> </svg> </div> <dropdown position="end" arrow="{false}" autohide="true"> <ul class="flexbe-list borderless hoverable hoverable-background opacify"> <li class="flexbe-list-item" each="{item in tag.links}" onclick="{item.action}"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{\'/_s/images/editor/actions.svg?1#\' + (item.value || \'none\')}"></use> </svg> <span class="flexbe-text"> {item.title} </span> </li> </ul> </dropdown> </div> <div if="{tag.links.length === 1}" onclick="{tag.links[0].action}" class="flexbe-button noshrink {opts.buttonClass}"> <svg if="{opts.buttonIcon}" class="flexbe-icon size-14"> <use riot-xlink:href="{opts.buttonIcon}"></use> </svg> <span class="flexbe-text"> {tag.links[0].title} </span> </div> <div if="{isError() && opts.errorText}" class="flexbe-error w100 mt-5"> {opts.errorText} </div> </div>',"",'class="flexbe-input-link {opts.class}"',(function(e){let t;this.isChanged=!!e.riotValue,this.relativeHostname=e.relativeHostname??!0,this.leadingSlash=e.leadingSlash??null;let s=[];const i=[{title:tr("editor::input_link::site_select"),action:function(){const e=flexbe.modals.pages.selectPage({onSelect:(t,s)=>{if("object"==typeof t&&"object"==typeof s){const i=s.group_id===flexbe.vars.group.id;let a=flexbe.page.formatUrl(s.domain,t.uri,i);a=i?a:`http://${a}`,e.close(),this.linkChange(a)}}})}.bind(this),value:"pages"},{title:tr("editor::input_link::section_select"),action:function(){this.hideModal(),t=flexbe.editor.redactor.stop({globalStates:!0,stopInstances:!1,scope:"select-anchor",states:["in-select-anchor","hide-fixed-widgets","hide-modals-list","hide-fixed-widgets"]});const e=uiStore.view.$body,s=$('<div class="inner-anchor-overlay"></div>'),i=".b_block:not([data-ref-page])";$document.on("keydown.editor_menu_anchor",(e=>{if(27===e.which)return this.showModal(),s.remove(),e.preventDefault(),e.stopImmediatePropagation(),!1})).focus(),e.on("mouseenter.select-anchor",i,(e=>{$(e.currentTarget).append(s)})),e.one("click.select-anchor",i,(t=>{e.off("mouseenter.select-anchor");const i=$(t.currentTarget).attr("data-id"),a=pageStore.getEntity(i,"block"),n=a&&a.data;let r=`#${n&&n._anchor||i}`;this.linkChange(r),this.showModal(),s.remove()}))}.bind(this),value:"anchor"},{title:tr("editor::input_link::modal_select"),action:function(){flexbe.editor.modal.showModalsUI({preview:!0,fromModal:e.modal,onselect:e=>{let t=st(`#${e}`);this.update(),this.linkChange(t)}})}.bind(this),value:"modal"},{title:tr("editor::input_link::project_select"),action:function(){const e=flexbe.modals.pages.selectDomain({gId:flexbe.vars.group.id,onSelect:t=>{"string"==typeof t&&(e.close(),this.linkChange(t))}})}.bind(this),value:"project"}];this.links=[],e.links&&(this.links=i.filter((t=>e.links.includes(t.value)))),this.isError=function(){return!(!(this.isChanged||e.riotValue||e.error)||!1===e.showError)&&(!e.skipAnchorCheck||e.error?e.error||function(e){if(!ir(e))return"link_is_wrong";if(/^(?:#|\.\/#)/.test(e)){let t=e.replace(/^(?:#{1,2}|\.\/#{1,2})/,"");t=t.replace(/\/+$/,"");const s=`#${t}, ._anchor[name=${t}], [data-id=${t}]`;try{if(pageStore.modals.map((e=>e.id)).filter((e=>e)).includes(t))return!1;if(pageStore.list.map((e=>e.data._anchor)).filter((e=>e)).includes(t))return!1;if(!t||!uiStore.view.$document.find(s).length)throw new Error}catch(e){return"anchor_is_wrong"}}return!1}(e.riotValue):void 0)}.bind(this),this.onChange=function(t){t.target.value=rr(t.target.value,{relativeHostname:this.relativeHostname,relativePathname:1===e.links.length&&"anchor"===e.links[0],leadingSlash:this.leadingSlash}),this.isChanged=!0,this.update()}.bind(this),this.hideModal=function(){s=Zs.visible,s.forEach((e=>e.hide())),flexbe_cli.scroll.scrollLock.unlock()}.bind(this),this.showModal=function(){$document.off("keydown.editor_menu_anchor"),t&&(t(),t=null),s.forEach((e=>e.show()))}.bind(this),this.linkChange=function(e){const t=this.refs.flexbeInput;if(t&&t.value!==e){t.value=e;const s=new Event("change",{bubbles:!0,cancelable:!0});t.root.children[0].dispatchEvent(s)}}.bind(this)})),riot3.tag2("flexbe-text-color",'<div class="is-group" data-is="flexbe-buttons-line" role="radio" riot-value="{opts.active}" list="{colors}" sprite="{meta.sprite}" has-custom="{hasCustom}" onchange="{setColor}"> <div data-is="proxy" is="flexbe-color-input" riot-value="{tag.lastCustom}" apply-if-valid="{true}" opacity="{tag.meta.opacity}" gradient="{tag.meta.gradient}" update="{tag.setCustomColor.bind(tag)}"></div> </div>',"",'class="flexbe-text-color {opts.class}"',(function(e){this.meta={sprite:at("editor_settings"),get opacity(){return e.opacity??!1},get gradient(){return e.gradient??!0}},this.getColors=function(){return(e.colors||["contrast","light","dark"]).filter((e=>"custom"!==e)).map((e=>({value:e,icon:`color_${e}`,tip:"custom"===e?tr("editor::button_line::settings_tip"):tr(`editor::background::color::${e}_tip`)})))}.bind(this),this.setColor=function(e){this.onChange({color:"custom"!==e.value?e.value:this.lastCustom})}.bind(this),this.setCustomColor=function({color:e,contrast:t}){this.onChange({color:e||this.lastCustom,contrast:t})}.bind(this),this.onChange=function({color:t,contrast:s}){t&&"function"==typeof e.update&&(/#|rgba/.test(t)&&(this.lastCustom=t),s=s||Pe(t,"dark","light"),e.update({color:t,contrast:s}),this.update())}.bind(this),this.onBeforeMount=function(){this.lastCustom=/#|rgba/.test(e.active)?e.active:"#FFFFFF",this.colors=this.getColors(),this.hasCustom=e.hasCustom??e.colors?.includes("custom")??!1}.bind(this),this.onMounted=function(){flexbe.tip.initArea(this.root)}.bind(this)})),riot3.tag2("flexbe-group-checkbox",'<label data-is="flexbe-input" class="{parent.opts.inputClass}" type="{type}" each="{item in values}" riot-value="{item.value}" name="{parent.opts.name}" checked="{valueState[item.value]}" disabled="{item.disabled}" onchange="{select.bind(parent, item)}"> <svg class="flexbe-icon size-16" if="{item.icon}"><use riot-xlink:href="{item.icon}"></use></svg> <span class="flexbe-text" if="{item.title}">{item.title}</span> <q data-is="flexbe-tooltip" if="{item.tooltip}" content="{item.tooltip}"></q> </label>',"",'class="flexbe-group-checkbox flexbe-field-group {opts.class}"',(function(e){this.extendFromProps={list:{name:"values",formatter:(t=[])=>$.extend(!0,[],t).filter((e=>e.enabled||null==e.enabled)).map((t=>("object"!=typeof t&&(t={value:t}),e.sprite&&(t.icon||t.title||(t.icon=t.value),t.icon&&!/\.svg/.test(t.icon)&&(t.icon=`${e.sprite}#${t.icon}`)),"string"==typeof t.title&&(t.title=tr(t.title)),t.title||t.icon||(t.title=t.value),t.tooltip&&"string"==typeof t.tooltip&&(t.tooltip=tr(t.tooltip)),t)))},type:{name:"type",default:"checkbox"}};const t=()=>{let t=e.riotValue;e.model&&(t=xt(this.tag,e.model)),t=((e=null)=>{if(!e||null===e||!Object.keys(e).length)return e;const t=Object.entries(e).map((([e,t])=>[e,1*t]));return Object.fromEntries(t)})(t),null==t&&(t=this.values.reduce(((e,t)=>(e[t.value]=0,e)),{})),this.valueState!==t&&(this.valueState=t)};this.mixin("inheritYield"),this.select=function(t,s){const i=s.target.checked?1:0,a=bt(this.valueState);a[t.value]=i,"function"==typeof e.onchange&&e.onchange(a,t,i),e.model&&_t(this.tag,e.model,a),s.preventDefault(),s.stopPropagation()}.bind(this),this.on("before-mount",(()=>{t()})),this.on("update",(()=>{t()}))})),riot3.tag2("flexbe-group-radio",'<label data-is="flexbe-input" type="radio" each="{item in list}" riot-value="{item.value}" class="{parent.opts.inputClass || \' \'}" name="{parent.opts.name}" checked="{parent.selected == item.value}" disabled="{item.disabled}" onchange="{select.bind(parent, item)}"> <svg class="flexbe-icon size-16" if="{item.icon}"><use riot-xlink:href="{item.icon}"></use></svg> <span class="flexbe-text" if="{item.title}">{item.title}</span> </label>',"",'class="flexbe-group-radio flexbe-field-group {opts.class}"',(function(e){this.extendFromProps={list:{formatter:t=>bt(t).filter((e=>e.enabled||null==e.enabled)).map((t=>("object"!=typeof t&&(t={value:t}),e.sprite&&(t.icon||t.title||(t.icon=t.value),t.icon&&!/\.svg/.test(t.icon)&&(t.icon=`${e.sprite}#${t.icon}`)),"string"==typeof t.title&&(t.title=tr(t.title)),t.title||t.icon||(t.title=t.value),t)))}};const t=()=>{let t=e.riotValue;e.model&&(t=xt(this.tag,e.model)),this.selected=t,null==this.selected&&(this.selected=this.list[0].value)};this.mixin("inheritYield"),this.select=function(t,s){this.selected=t.value,"function"==typeof e.onchange&&e.onchange(t),e.model&&_t(this.tag,e.model,this.selected),s.preventDefault(),s.stopPropagation()}.bind(this),this.on("before-mount",(()=>{t()})),this.on("update",(()=>{t()}))})),riot3.tag2("flexbe-media-block",'<div class="flexbe-media-block__image flexbe-white-card"> <svg if="{state.icon}"> <use riot-xlink:href="{state.icon}"></use> </svg> <img if="{state.image}" riot-src="{state.image}" width="{state.imageWidth}"> </div> <div class="flexbe-media-block__content"> {state.description} </div> <div class="flexbe-media-block__action"> <div class="flexbe-button is-secondary filled block" onclick="{opts.buttonHandler}"> <svg class="flexbe-icon size-14" if="{state.buttonIcon}"> <use riot-xlink:href="{state.buttonIcon}"></use> </svg> <span class="flexbe-text"> {state.buttonText} </span> </div> </div>',"",'class="flexbe-media-block {opts.class}"',(function(e){const t=at("editor_settings");this.state={get icon(){return e.icon},get image(){return e.image},get imageWidth(){return e.imageWidth},get description(){return e.text},get buttonText(){return e.buttonText??tr("main::button::settings")},get buttonIcon(){return e.buttonIcon??`${t}#settings`}}})),riot3.tag2("flexbe-media-upload",'<yield></yield> <div data-is="flexbe-button-upload" hide="{inUpload}" url="{url}" file-type="{opts.type}" onuploadstart="{uploadStart}" onupload="{uploadDone}" onerror="{uploadError}" drop-zone="{opts.dropZone || this.root}" multi="{opts.multi}" show-icon="{false}" show-loader="{false}" accept="{opts.accept}"></div> <div class="overlay"> <svg class="icon-big" viewbox="0 0 28 22" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <path fill-rule="evenodd" d="M5.887 9.772l-1.462.283A3.002 3.002 0 0 0 5 16h2v2H5a5 5 0 0 1-.955-9.91A9 9 0 0 1 21.488 6H22a6 6 0 0 1 0 12h-3v-2h3a4 4 0 0 0 0-8h-1.927l-.47-1.334A7 7 0 0 0 6.035 8.29l-.15 1.482zm7.853-2.445a1 1 0 0 0-1.48 0l-5 5.5 1.48 1.346L12 10.587V22h2V10.587l3.26 3.586 1.48-1.346-5-5.5z"></path> </svg> <svg class="icon-small" width="16" height="13" viewbox="0 0 16 13" xmlns="http://www.w3.org/2000/svg"> <circle fill="none" stroke="currentcolor" stroke-width="2" cx="8" cy="7" r="2"></circle> <path d="M3.83 1.106A2 2 0 0 1 5.617 0h4.764a2 2 0 0 1 1.79 1.106l.446.894H14a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1.382l.447-.894zM10.38 2H5.618l-.724 1.447A1 1 0 0 1 4 4H2v7h12V4h-2a1 1 0 0 1-.894-.553L10.382 2z"></path> </svg> </div> <div if="{inUpload}" class="overlay-loader"> <span data-is="proxy" is="flexbe-loader" class="color-inherit"></span> </div> <svg class="flexbe-icon size-14 flexbe-remove-item" if="{opts.showRemove && !inUpload}" onclick="{opts.onRemove}"> <use riot-href="{controlsSprite}#remove"></use> </svg>',"","class=\"flexbe-media-upload flexbe-remove-item-container {opts.class} {'loading': inUpload} {'show-overlay': opts.showOverlay}\"",(function(e){this.mixin("inheritYield"),this.controlsSprite=at("controls"),this.inUpload=!1,this.url=e.url??`/admin/api/project/${flexbe.vars.group.id}/file/upload/?type=${e.type}`,this.uploadStart=function(t,s){"function"==typeof e.onUploadStart&&e.onUploadStart(t,s),this.update({inUpload:!0})}.bind(this),this.uploadDone=function(t,s){e.onUploaded(t,s),this.update({inUpload:!1})}.bind(this),this.uploadError=function(t,s){"function"==typeof e.onUploadedError&&e.onUploadedError(t,s),this.update({inUpload:!1}),toast.error(tr("main::error::upload_file"))}.bind(this)})),riot3.tag2("flexbe-opacity-toggle",'<div class="col col-6 inline-box"> <label data-is="flexbe-input" type="toggle" checked="{state.opacityEnabled}" onchange="{setOpacityToggle}"> <span if="{tag.opts.mode === \'opacity\'}">{tr(\'editor::background::color::opacity_toggle\')}</span> <span if="{tag.opts.mode !== \'opacity\'}">{tr(\'editor::background::color::fogging_toggle\')}</span> </label> </div> <div class="col col-6 inline-box" if="{state.showRange}"> <div data-is="flexbe-input-range" step="{opacity.step}" min="{opacity.min}" max="{opacity.max}" check-old-value="{true}" commit-on-move="{true}" show-input="{true}" suffix="{\'%\'}" max-length="{3}" riot-value="{opacity.value}" commit="{setOpacity}"></div> </div>',"",'class="flexbe-opacity-toggle row {opts.class}"',(function(e){const t=this,s=t=>"opacity"===e.mode?100-t:t;this.opacity={step:e.step||1,min:"opacity"===e.mode?s(e.max||100):e.min||0,max:"opacity"===e.mode?s(e.min||0):e.max||100,get value(){return s(e.riotValue??0)}},this.state={_rangeUiState:t.opacity.value>0,_oldValue:t.opacity.value,get opacityEnabled(){return t.opacity.value>0},get showRange(){return this.opacityEnabled||this._rangeUiState}},this.setOpacityToggle=function(e){e.preventUpdate=!0;const t=e.target.checked;this.state._rangeUiState=t,t?this.setOpacity({value:this.state._oldValue||50}):this.setOpacity({value:0})}.bind(this),this.setOpacity=function(t){let i=t.value;this.state._oldValue=i,i=s(i),"function"==typeof e.update&&e.update(i)}.bind(this)})),riot3.tag2("flexbe-toggle-range",'<div class="col col-6 inline-box"> <label data-is="flexbe-input" type="toggle" checked="{state.toggleEnabled}" onchange="{changeToggle}"> <span>{tr(tag.opts.toggleTitle)}</span> </label> </div> <div class="col col-6 inline-box my-10" if="{state.showRange}"> <div data-is="flexbe-input-range" step="{opts.step}" min="{opts.min}" max="{opts.max}" commit-on-move="{true}" show-input="{true}" suffix="{opts.suffix}" max-length="{3}" riot-value="{state.value}" commit="{setValue}"></div> </div>',"",'class="flexbe-toggle-range row {opts.class}"',(function(e){this.state={get value(){return e.riotValue},get toggleEnabled(){return!1!==this.value},get showRange(){return this.toggleEnabled},get toggleTitle(){return e.toggleTitle}},this.changeToggle=function(t){t.preventUpdate=!0;t.target.checked?this.setValue({value:e.defaultValue??20,eventType:"toggle"}):this.setValue({value:!1,eventType:"toggle"})}.bind(this),this.setValue=function(t){const s=t.value,i=t.eventType;"function"==typeof e.update&&e.update({value:s,type:i})}.bind(this),this.onMounted=function(){console.warn("[dev] Kill me please")}.bind(this)})),riot3.tag2("flexbe-color-list",'<div class="main-bar {inline: inline}"> <virtual if="{showPicker}"> <div class="color color-custom"> <a onclick="{openPicker}" riot-style="color: {tag.selected.color}"> <svg viewbox="0 0 16 16"> <path d="M1.478 13.34a2.09 2.09 0 0 1 .473-2.246L8.776 4.27 8 3.496l.584-.583A.817.817 0 0 1 9.75 2.91l.267.266L12.61.584a1.982 1.982 0 0 1 2.81 0 1.987 1.987 0 0 1 0 2.807l-2.593 2.592.27.27c.32.32.31.85-.003 1.164L12.51 8l-.778-.777-6.826 6.826c-.61.608-1.495.768-2.247.473a1.333 1.333 0 1 1-1.18-1.18zm8.255-8.007l.934.935-6.872 6.876a.665.665 0 0 1-.93-.002.653.653 0 0 1-.004-.933l6.873-6.877z" fill="currentColor" fill-rule="evenodd"></path> </svg> </a> </div> </virtual> <virtual if="{showColors}"> <div class="color" data-title="{color.desc}" each="{color in colors.slice(0, barLength)}" no-reorder> <a data-color="{color.asString}" class="{selected: (color.color === tag.selected.color)}" riot-style="{color.style}" onclick="{tag.selectColor.bind(main, color)}"></a> </div> <div if="{showMoreBar}" class="show-more-button {active: flags.moreBarOpen}" onclick="{toggleMoreBar}"></div> </virtual> </div> <div class="more-bar {show: flags.moreBarOpen}" if="{showColors && showMoreBar}"> <div class="color" data-title="{color.desc}" each="{color in colors.slice(barLength, colors.length)}" no-reorder> <a data-color="{color.asString}" class="{selected: (color.asString === tag.selected.asString)}" riot-style="{color.style}" onclick="{tag.selectColor.bind(main, color)}"></a> </div> </div>',"",'class="flexbe-color-list {opts.class}"',(function(e){const t=+flexbe.vars.page.themeId,s=()=>{if(1===t)return[];let e=localStorage.getItem("colorset");try{e=JSON.parse(e)}catch(t){e=[]}return e||[]},i=e=>{if(!e||1===t)return[];const i=s();i.unshift(e),i.splice(5,i.length-1),localStorage.setItem("colorset",JSON.stringify(i))},a=e=>{if(!e)return!1;let[t,s]=String(e).split(":");const i=/^#/.test(t),a=/^rgb/.test(t),n=i||a,r=void 0!==s,o=r&&i?`${t}:${s}`:t,l={};return t||(t="#000000"),i?(t=String(t).replace(/^#/,"").slice(0,6),t=6===t.length?t:t[0]+t[0]+t[1]+t[1]+t[2]+t[2],t=`#${t.toUpperCase()}`):t=String(t).toLowerCase(),n&&(l.background=t),s=r?+s:100,{asString:o,color:t,opacity:s,style:l,desc:undefined,isHex:i,isRgb:a,isColor:n,hasOpacity:r}},n=(t=!0)=>{if(this.colors=e.colors||[],this.showUserColors){let e=s();Array.isArray(e)&&(this.colors=[...e,...this.colors])}const i=[];this.colors=this.colors.map(a).filter((e=>!(!e||i.includes(e.asString))&&(i.push(e.asString),!0))),this.selected=a(e.active||e.riotValue)||this.colors[0],this.showMoreBar=this.showColors&&this.colors.length>this.barLength,t&&this.update()};this.colors=[],this.selected=!1,this.flags={moreBarOpen:!1},this.showColors=t>1||!e.custom,this.inline=!!e.inline,this.showPicker=!!e.custom,this.showUserColors=!!e.custom,this.showMoreBar=!1,this.barLength=this.inline?1/0:(e.length||6)-Number(!!e.custom),this.onChange=e.update||e.onchange||function(){},this.toggleMoreBar=function(){this.flags.moreBarOpen=!this.flags.moreBarOpen,this.flags.moreBarOpen&&setTimeout((()=>{$("body").off("click.toggleMoreBar").on("click.toggleMoreBar",(e=>{$(e.target).closest(".more-bar").length||$(e.target).is(".show-more-button")||($("body").off("click.toggleMoreBar"),this.flags.moreBarOpen=!1,this.update())}))}),300)}.bind(this),this.selectColor=function(e,t=!0){"object"!=typeof e&&(e=a(e)),this.selected=e,this.onChange(e.color),t&&e.isColor&&i(e.color)}.bind(this),this.openPicker=function(){const e=new vn({value:this.selected.color},{showOpacity:!1,showGradient:!1});e.on("apply_color",((e,t,s)=>{this.selectColor("#"+s.hex,!1),i("#"+s.hex),n(),this.update()})),e.render()}.bind(this),this.onBeforeMount=function(){n(!1),this.selected=a(e.active||e.riotValue)}.bind(this),this.onBeforeUpdate=function(){this.selected=a(e.active||e.riotValue)}.bind(this)}));const lr={css:null,exports:{input:null,setup(e,{initMobx:t}){t(),this.observer=e.props.observer||At({}),this.state={addonPadding:0,get showSave(){return e.props.showSave||!1},get error(){return e.props.error||!1}}},async onSave(e){const t=await this.props.onSave(e);return this.state.addonPadding=0,t},async onDone(e){const t=await this.props.onDone(e);return this.state.addonPadding=0,t},async onError(e){const t=await this.props.onError(e);return this.state.addonPadding=0,t},onUpdated(){const e=$(this.root).find(".flexbe-input__addon"),t=$(this.root).find(".flexbe-input__addon:not(.save-button)");if(!e.hasClass("hide")||!!t.length){const s=e.hasClass("hide")?void 0:e[0],i=(null!=s?s:t[0]).offsetWidth;this.state.addonPadding=`${i+20}px`}},triggerSave(){this.state.showSave&&!this.state.error&&this.observer.trigger("save")},focus(){const e=this.input;e&&e.focus()},onMounted(){this.input=this.$("input"),this._hotkeysDisposer=fs.register([{hotkeys:["cmd_s","enter"],handlerDown:()=>this.triggerSave()}])},onBeforeUnmount(){this._hotkeysDisposer&&this._hotkeysDisposer()}},template:(e,t,s,i)=>e('<div expr522="expr522" is="flexbe-input"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["save-input ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[{id:"default",html:'<div expr523="expr523" is="save-button" type="submit"></div>',bindings:[{type:s.TAG,getComponent:i,evaluate:e=>"save-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-input__addon ",!e.state.showSave||e.state.error?"hide":""].join("")},{type:t.ATTRIBUTE,name:"show-save",evaluate:e=>!0},{type:t.EVENT,name:"on-save",evaluate:e=>e.onSave},{type:t.EVENT,name:"on-done",evaluate:e=>e.onDone},{type:t.EVENT,name:"on-error",evaluate:e=>e.onError},{type:t.ATTRIBUTE,name:"observer",evaluate:e=>e.observer}],redundantAttribute:"expr523",selector:"[expr523]"}]}],attributes:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["--addonPadding: ",e.state.addonPadding].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.props.inputClass},{type:t.ATTRIBUTE,name:"type",evaluate:e=>e.props.type},{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.props.checked},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.props.disabled},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>e.props.autofocus},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.props.value},{type:t.ATTRIBUTE,name:"name",evaluate:e=>e.props.name},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.props.error},{type:t.ATTRIBUTE,name:"error-text",evaluate:e=>e.props.errorText},{type:t.ATTRIBUTE,name:"error-tip",evaluate:e=>e.props.errorTip},{type:t.ATTRIBUTE,name:"required",evaluate:e=>e.props.required},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.props.placeholder},{type:t.ATTRIBUTE,name:"readonly",evaluate:e=>e.props.readonly},{type:t.ATTRIBUTE,name:"autocomplete",evaluate:e=>e.props.autocomplete},{type:t.ATTRIBUTE,name:"pattern",evaluate:e=>e.props.pattern},{type:t.ATTRIBUTE,name:"min",evaluate:e=>e.props.min},{type:t.ATTRIBUTE,name:"max",evaluate:e=>e.props.max},{type:t.ATTRIBUTE,name:"maxlength",evaluate:e=>e.props.maxlength},{type:t.ATTRIBUTE,name:"tabindex",evaluate:e=>e.props.tabindex},{type:t.EVENT,name:"onblur",evaluate:e=>e.props.onblur},{type:t.ATTRIBUTE,name:"prefix",evaluate:e=>e.props.prefix}],redundantAttribute:"expr522",selector:"[expr522]"}]),name:"save-input"};e(lr.name,lr);const dr={css:null,exports:{setup(e,{initMobx:t}){t(),this.observer=e.props.observer||At({}),this.state={isSaving:!1,isLoading:!1,isCheck:!1,get hasEditButton(){return e.props.editMode||e.props.showEdit},get showEditButton(){return e.props.showEdit&&!this.isSaving},get showSaveBlock(){return e.props.showCancel||e.props.showSave||this.isSaving},get showCancel(){return e.props.showCancel&&!this.isSaving},get showSave(){return e.props.showSave||this.isSaving},get saveClasses(){return[!this.isCheck&&"is-primary",this.isCheck&&"is-success",this.isCheck&&"check",this.isLoading&&"loading"].filter((e=>e)).join(" ")}}},editHandler(){this.props.onEdit&&this.props.onEdit()},cancelHandler(){this.props.onCancel&&this.props.onCancel()},async saveHandler(...e){if(this.state.isSaving||!this.state.showSave)return;this.state.isSaving=!0,this.state.isLoading=!0,this.update();const t=await this.props.onSave(e);if(this.state.isLoading=!1,this.update(),t instanceof Error||t instanceof Js)return this.state.isSaving=!1,this.update(),void(this.props.onError&&this.props.onError(t));this.state.isCheck=!0,this.update(),setTimeout((()=>{this.props.onDone&&this.props.onDone(t),setTimeout((()=>{this.state.isSaving=!1,this.state.isCheck=!1,this.update()}),350)}),1e3)},onMounted(){this.observer.on("save",this.saveHandler),this.observer.on("cancel",this.cancelHandler),this._hotkeysDisposer=fs.register([{hotkeys:["cmd_s"],handlerDown:()=>this.saveHandler()}])},onBeforeUnmount(){this.observer.off("save",this.saveHandler),this.observer.off("cancel",this.cancelHandler),this._hotkeysDisposer&&this._hotkeysDisposer()}},template:(e,t,s,i)=>e('<div expr524="expr524"></div><div expr527="expr527"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["save-button ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.state.hasEditButton,redundantAttribute:"expr524",selector:"[expr524]",template:e('<div expr525="expr525" class="flexbe-button small filled edit-button is-secondary"><span expr526="expr526" class="flexbe-text"> </span></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["edit-block ",e.state.showEditButton?"show":""].join("")}]},{redundantAttribute:"expr525",selector:"[expr525]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.editHandler}]},{redundantAttribute:"expr526",selector:"[expr526]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.props.editText||e.tr("main::button::edit")}]}])},{type:s.IF,evaluate:e=>e.state.showCancel||e.state.showSave,redundantAttribute:"expr527",selector:"[expr527]",template:e('<div expr528="expr528" class="flexbe-button small filled is-secondary"></div><div expr530="expr530"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["save-block ",e.state.showSaveBlock?"show":""].join("")}]},{type:s.IF,evaluate:e=>e.state.showCancel,redundantAttribute:"expr528",selector:"[expr528]",template:e('<span expr529="expr529" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.cancelHandler}]},{redundantAttribute:"expr529",selector:"[expr529]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.props.cancelText||e.tr("main::button::cancel")}]}])},{type:s.IF,evaluate:e=>e.state.showSave,redundantAttribute:"expr530",selector:"[expr530]",template:e('<span expr531="expr531" class="flexbe-text"> </span><span class="flexbe-check text-s is-check"></span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button small filled ",e.state.saveClasses].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.saveHandler}]},{redundantAttribute:"expr531",selector:"[expr531]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.props.saveText||e.tr("main::button::save")}]}])}])}]),name:"save-button"};e(dr.name,dr);const cr={css:null,exports:{_intersectionObserver:null,_resizeObserver:null,setup(e,{initMobx:t}){t(),this.preventUpdate=!1,this.arr=[],this.state={currentIndex:0,get maxHeightBy(){return e.props.maxHeightBy},get list(){return e.props.list},get commonTitle(){return this.list.title},get content(){return this.list.content.filter((e=>e.show))},get fixTitle(){var e,t;return null!=(e=null==(t=this.content[this.currentIndex])?void 0:t.title)?e:""},get addition(){var e,t;return null!=(e=null==(t=this.content[this.currentIndex])?void 0:t.addition)?e:""},get buttons(){return this.list.buttons}}},selectGroup(e,t=300){if(!this.$('[ref="content"]'))return;const s=$(this.$('[ref="content"]')),i=s.find(`[data-content-id=${e}]`);if(!i[0])return;this.state.currentIndex=e,this.update();const a=i[0].offsetTop,n=a>0?55:0;this.preventUpdate=!0,s.animate({scrollTop:n+a},t,(()=>{this.preventUpdate=!1}))},initResizeObserver(){const e=$(this.root).find('[ref="content"]'),t=this.state.maxHeightBy,s=[...this.root.querySelectorAll(".fixed-block")];if(t){if(this._resizeObserver)this._resizeObserver.disconnect();else{const i=()=>{e.css("max-height","");const i=t.offsetHeight,a=s.reduce(((e,t)=>e+t.offsetHeight),0);e.css("max-height",i-a+"px")};this._resizeObserver=new ResizeObserver(i),$(window).on("resize",(()=>requestAnimationFrame(i)))}this._resizeObserver.observe(t)}},initIntersectionObserver(){if(this.arr=this.root.querySelectorAll(".content-item"),this._intersectionObserver)this._intersectionObserver.disconnect();else{const e={root:this.$('[ref="content"]'),threshold:[0,1],rootMargin:"0px"};this._intersectionObserver=new IntersectionObserver((e=>{e.forEach((e=>{if(!this.preventUpdate){const t=e.target.dataset.contentId,s=e.intersectionRatio,i=e.boundingClientRect,a=e.intersectionRect;0!==s||a.top?s<1&&i.top<a.top&&r((()=>{this.state.currentIndex=+t})):this.state.currentIndex===+t&&r((()=>{this.state.currentIndex=+t+1})),this.update()}}))}),e)}this.arr.forEach((e=>{this._intersectionObserver.observe(e)}))},onMounted(){requestAnimationFrame((()=>{this.initResizeObserver(),this.initIntersectionObserver()}))},onUnmounted(){this._intersectionObserver.disconnect(),this._resizeObserver.disconnect()}},template:(e,t,s,i)=>e('<div class="scrollable-menu scrollable-content"><div expr532="expr532" class="flexbe-text text-xxl text-medium p30"> </div><ul class="flexbe-list hoverable opacify borderless hoverable-background"><li expr533="expr533"></li></ul></div><div class="content"><div class="fixed-block fixed-block-title"><span expr535="expr535" class="flexbe-text text-xxl text-medium"> </span><div expr536="expr536"></div><a class="flexbe-modal-close"></a></div><div class="content-list scrollable-content" ref="content"><div expr537="expr537"></div></div><div class="fixed-block fixed-block-button"><div expr541="expr541" is="flexbe-button"></div></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["block-scrollable_menu ",e.props.class].join("")}]},{redundantAttribute:"expr532",selector:"[expr532]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.commonTitle}]},{type:s.EACH,getKey:null,condition:null,template:e('<span expr534="expr534" class="flexbe-text text-m text-medium"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"group-index",evaluate:e=>e.index},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list-item ",e.index===e.state.currentIndex?"active hover":""].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>t=>e.selectGroup(e.index,300,t)}]},{redundantAttribute:"expr534",selector:"[expr534]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.title}]}]),redundantAttribute:"expr533",selector:"[expr533]",itemName:"item",indexName:"index",evaluate:e=>e.state.content},{redundantAttribute:"expr535",selector:"[expr535]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.fixTitle}]},{type:s.IF,evaluate:e=>e.state.addition,redundantAttribute:"expr536",selector:"[expr536]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>e.state.addition,slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.props.store},{type:t.ATTRIBUTE,name:"loader",evaluate:e=>e.props.loader},{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.props.data},{type:t.ATTRIBUTE,name:"modal",evaluate:e=>e.props.modal}]}])},{type:s.EACH,getKey:null,condition:null,template:e('<div class="content-block-title"><div expr538="expr538" class="flexbe-text text-xxl text-medium"> </div><div expr539="expr539"></div></div><div expr540="expr540" class="content-block"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"data-content-id",evaluate:e=>e.gId},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["content-item ",e.gId===e.state.currentIndex?"active":""].join("")}]},{redundantAttribute:"expr538",selector:"[expr538]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.group.title}]},{type:s.IF,evaluate:e=>e.group.addition,redundantAttribute:"expr539",selector:"[expr539]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>e.group.addition,slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.props.store},{type:t.ATTRIBUTE,name:"loader",evaluate:e=>e.props.loader},{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.props.data},{type:t.ATTRIBUTE,name:"modal",evaluate:e=>e.props.modal}]}])},{type:s.TAG,getComponent:i,evaluate:e=>e.group.block,slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.props.store},{type:t.ATTRIBUTE,name:"loader",evaluate:e=>e.props.loader},{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.props.data},{type:t.ATTRIBUTE,name:"modal",evaluate:e=>e.props.modal},{type:t.ATTRIBUTE,name:"commit",evaluate:e=>e.props.commit}],redundantAttribute:"expr540",selector:"[expr540]"}]),redundantAttribute:"expr537",selector:"[expr537]",itemName:"group",indexName:"gId",evaluate:e=>e.state.content},{type:s.EACH,getKey:null,condition:e=>!e.button.hide,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.button.class},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.button.disabled},{type:t.ATTRIBUTE,name:"text",evaluate:e=>e.button.title},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.button.icon},{type:t.ATTRIBUTE,name:"loading",evaluate:e=>e.button.loading},{type:t.ATTRIBUTE,name:"iconSize",evaluate:e=>e.button.iconSize},{type:t.EVENT,name:"onclick",evaluate:e=>e.button.handler}]}]),redundantAttribute:"expr541",selector:"[expr541]",itemName:"button",indexName:null,evaluate:e=>e.state.buttons}]),name:"block-scrollable_menu"};e(cr.name,cr);const pr={css:null,exports:{setup(e){this.state={isLoading:!1,get previewStyles(){const{image:t}=e.props,s=null==t?void 0:t.preview;return"background-image: "+(s?`url(data:image/png;base64,${s})`:"none")},get croppedImageName(){const{image:t}=e.props;if(!t)return tr("editor::background::image_placeholder");const s=`${t.id}.${t.ext}`;return s.length>13?`${s.substring(0,5)}...${s.substring(s.length-5,s.length)}`:s}},this.meta={sprite:at("core")}},fakeInputHandler(){this.$(".file-input").click()},onStart(){this.state.isLoading=!0,this.update()},onComplete(e){this.state.isLoading=!1;const t=ct(e);this.props.onupload(t),this.update()},onError(){this.state.isLoading=!1,toast.error("Image Upload Error"),this.update()},initUploader(){pi.init({input:this.$(".file-input"),multi:!1,type:"image",onComplete:(e,t)=>this.onComplete(t),onError:(e,t)=>this.onError()})},onMounted(){this.initUploader()}},template:(e,t,s,i)=>e('<input expr542="expr542" style="display: none;" type="file" name="file" class="file-input"/><div class="flexbe-image-uploader__left-wrap"><div expr543="expr543" class="flexbe-image-uploader__preview"></div><div expr544="expr544" class="flexbe-image-uploader__file-name"> </div></div><div class="flexbe-image-uploader__right-wrap"><div expr545="expr545" class="flexbe-image-uploader__settings-button"></div><div expr548="expr548" class="flexbe-image-uploader__remove-button"></div><div expr551="expr551" is="flexbe-loader" class="flexbe-image-uploader__upload-loader"></div><div expr552="expr552" class="flexbe-image-uploader__upload-button"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-image-uploader"}]},{redundantAttribute:"expr542",selector:"[expr542]",expressions:[{type:t.EVENT,name:"onchange",evaluate:e=>()=>e.onStart()}]},{redundantAttribute:"expr543",selector:"[expr543]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.state.previewStyles}]},{redundantAttribute:"expr544",selector:"[expr544]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.croppedImageName].join("")}]},{type:s.IF,evaluate:e=>e.props.image,redundantAttribute:"expr545",selector:"[expr545]",template:e('<button expr546="expr546"><svg class="flexbe-icon size-14"><use expr547="expr547"/></svg></button>',[{redundantAttribute:"expr546",selector:"[expr546]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.props.openSettings()}]},{redundantAttribute:"expr547",selector:"[expr547]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#button-settings"].join("")}]}])},{type:s.IF,evaluate:e=>e.props.image,redundantAttribute:"expr548",selector:"[expr548]",template:e('<button expr549="expr549"><svg class="flexbe-icon size-14"><use expr550="expr550"/></svg></button>',[{redundantAttribute:"expr549",selector:"[expr549]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.props.removeImage()}]},{redundantAttribute:"expr550",selector:"[expr550]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#button-remove"].join("")}]}])},{type:s.IF,evaluate:e=>e.state.isLoading,redundantAttribute:"expr551",selector:"[expr551]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[]}])},{type:s.IF,evaluate:e=>!e.props.image&&!e.state.isLoading,redundantAttribute:"expr552",selector:"[expr552]",template:e('<button expr553="expr553"></button>',[{type:s.IF,evaluate:e=>!e.state.isLoading,redundantAttribute:"expr553",selector:"[expr553]",template:e('<svg class="flexbe-icon size-14"><use expr554="expr554"/></svg>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.fakeInputHandler}]},{redundantAttribute:"expr554",selector:"[expr554]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#button-upload"].join("")}]}])}])}]),name:"flexbe-image-uploader"};e(pr.name,pr);const ur={css:null,exports:{setup(e,{initMobx:t}){t();const s=at("core"),i=e.props.value;this.state={_lastValue:i,_showControls:!e.props.showToggle||!!i,get showControls(){return this._showControls||!!this.value},get value(){return e.props.value},get selectedMode(){return"object"==typeof this.value?"multiple":"single"},get hasRange(){return e.meta.showRange&&"single"===this.selectedMode}},this.meta={sprite:s,get showToggle(){return e.props.showToggle||!1},get showRange(){return e.props.showRange||!1},get default(){return e.props.default||10},get min(){return e.props.min||0},get max(){return e.props.max||500},get inputMax(){return e.props.inputMax||this.max},get inputRunnerFactor(){return e.props.inputRunnerFactor||10},get unit(){return e.props.unit},get disableMultiple(){return e.props.disableMultiple},get disableMultipleTip(){return tr("editor::common::disable_multiple_border_radius_tip")},get modes(){return[{icon:"radius-single",value:"single"},{icon:"radius-multiple",value:"multiple",disabled:this.disableMultiple,tip:this.disableMultiple&&this.disableMultipleTip?this.disableMultipleTip:null}]},multipleInputs:[{icon:`${s}#radius-top-left`,key:0},{icon:`${s}#radius-top-right`,key:1},{icon:`${s}#radius-bottom-right`,key:2},{icon:`${s}#radius-bottom-left`,key:3}]}},async toggleRadius(e){const t=this.state._lastValue||this.meta.default,s=e.target.checked;s||(this.state._lastValue=this.state.value),this.state._showControls=s,await this.commit({reason:"change",value:s?t:0})},toggleMode(e){const t=this.state.selectedMode,s=this.state.value;if(t!==e.value){let t;return t="single"===e.value?s.find((e=>e))||this.meta.min:[s,s,s,s],this.commit({reason:"change",value:t})}},setSingleValue(e){var t,s;const i=null!=(t=e.value)?t:+e.target.value,a=null!=(s=e.reason)?s:e.type;return this.commit({value:i,reason:a})},setMultipleValue(e,t){const s=[...this.state.value];s[t]=+e.target.value,this.commit({value:s,reason:e.type})},commit({value:e,reason:t}){return this.props.commit({value:e,reason:t})},onMounted(){flexbe.tip.initArea(this.root)},onUpdated(){flexbe.tip.initArea(this.root)}},template:(e,t,s,i)=>e('<label expr555="expr555" is="flexbe-checkbox" class="flexbe-border-radius__toggle" type="toggle"></label><div expr557="expr557"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-border-radius ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.meta.showToggle,redundantAttribute:"expr555",selector:"[expr555]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr556="expr556" class="flexbe-text inline-box"> </span>',bindings:[{redundantAttribute:"expr556",selector:"[expr556]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::common::border_radius_toggle")].join("")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.showControls},{type:t.EVENT,name:"onchange",evaluate:e=>e.toggleRadius}]}])},{type:s.IF,evaluate:e=>e.state.showControls,redundantAttribute:"expr557",selector:"[expr557]",template:e('<div expr558="expr558" is="flexbe-buttons-line" class="is-group" role="radio"></div><div expr559="expr559" is="flexbe-input" class="flexbe-border-radius__single-input" type="number"></div><div expr560="expr560" is="proxy" data-is="flexbe-input-range"></div><div expr561="expr561" class="flexbe-border-radius__multiple-input flexbe-field-group is-group"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-border-radius__controls ",e.classNames({"has-range":e.state.hasRange})].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-buttons-line",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.selectedMode},{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.modes},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.EVENT,name:"onchange",evaluate:e=>e.toggleMode}],redundantAttribute:"expr558",selector:"[expr558]"},{type:s.IF,evaluate:e=>"single"===e.state.selectedMode,redundantAttribute:"expr559",selector:"[expr559]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"min",evaluate:e=>e.meta.min},{type:t.ATTRIBUTE,name:"max",evaluate:e=>e.meta.inputMax},{type:t.ATTRIBUTE,name:"runner-factor",evaluate:e=>e.meta.inputRunnerFactor},{type:t.ATTRIBUTE,name:"suffix",evaluate:e=>e.meta.unit},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.value},{type:t.EVENT,name:"oninput",evaluate:e=>e.setSingleValue},{type:t.EVENT,name:"onchange",evaluate:e=>e.setSingleValue}]}])},{type:s.IF,evaluate:e=>e.state.hasRange,redundantAttribute:"expr560",selector:"[expr560]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"step",evaluate:e=>1},{type:t.ATTRIBUTE,name:"min",evaluate:e=>e.meta.min},{type:t.ATTRIBUTE,name:"max",evaluate:e=>e.meta.max},{type:t.ATTRIBUTE,name:"commit-on-move",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"show-input",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.value},{type:t.ATTRIBUTE,name:"commit",evaluate:e=>e.setSingleValue}]}])},{type:s.IF,evaluate:e=>"multiple"===e.state.selectedMode,redundantAttribute:"expr561",selector:"[expr561]",template:e('<div expr562="expr562" is="flexbe-input" class="flexbe-field-item" type="number"></div>',[{type:s.EACH,getKey:null,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"min",evaluate:e=>0},{type:t.ATTRIBUTE,name:"max",evaluate:e=>e.meta.inputMax},{type:t.ATTRIBUTE,name:"suffix",evaluate:e=>e.meta.unit},{type:t.ATTRIBUTE,name:"runner-factor",evaluate:e=>e.meta.inputRunnerFactor},{type:t.ATTRIBUTE,name:"prefixIcon",evaluate:e=>e.item.icon},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.value[e.item.key]},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.setMultipleValue(t,e.item.key)},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.setMultipleValue(t,e.item.key)}]}]),redundantAttribute:"expr562",selector:"[expr562]",itemName:"item",indexName:null,evaluate:e=>e.meta.multipleInputs}])}])}]),name:"flexbe-border-radius"};e(ur.name,ur);const mr={css:null,exports:i({setup(e){this.state={showDropdown:e.slots.find((e=>"default"===e.id))}}}),template:(e,t,s,i)=>e('<svg expr563="expr563"><use expr564="expr564"/></svg><span expr565="expr565" class="flexbe-text"></span><div expr566="expr566" is="proxy" data-is="dropdown"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-control-button ",e.props.text?"text-type":""," ",e.props.class].join("")},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>!e.state.showDropdown&&e.props.tip}]},{redundantAttribute:"expr563",selector:"[expr563]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-icon size-",e.props.iconSize||16].join("")}]},{redundantAttribute:"expr564",selector:"[expr564]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.props.icon}]},{type:s.IF,evaluate:e=>e.props.text,redundantAttribute:"expr565",selector:"[expr565]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.props.text].join("")}]}])},{type:s.IF,evaluate:e=>e.state.showDropdown,redundantAttribute:"expr566",selector:"[expr566]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<slot expr567="expr567"></slot>',bindings:[{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr567",selector:"[expr567]"}]}],attributes:[{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>{var t;return null==(t=e.props.dropdownToBody)||t}},{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.props.dropdownClass},{type:t.ATTRIBUTE,name:"position",evaluate:e=>e.props.dropdownPosition||"center"},{type:t.ATTRIBUTE,name:"position-to",evaluate:e=>e.props.dropdownPositionTo},{type:t.ATTRIBUTE,name:"relative",evaluate:e=>e.props.dropdownRelative},{type:t.ATTRIBUTE,name:"scrollable",evaluate:e=>e.props.dropdownScrollable},{type:t.ATTRIBUTE,name:"balloon-class",evaluate:e=>e.props.balloonClass},{type:t.ATTRIBUTE,name:"content-class",evaluate:e=>e.props.contentClass},{type:t.ATTRIBUTE,name:"tip",evaluate:e=>e.props.tip},{type:t.ATTRIBUTE,name:"skip-tip-init",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"observer",evaluate:e=>e.props.observer},{type:t.EVENT,name:"onopen",evaluate:e=>e.props.onopen},{type:t.EVENT,name:"onclose",evaluate:e=>e.props.onclose}]}])}]),name:"flexbe-control-button"};e(mr.name,mr);const hr={css:null,exports:i({setup(e,{initMobx:t}){t(),this.sprite=at("adaptive"),this.state={get value(){var t,s;return null!=(t=null!=(s=e.props.value)?s:xt(this.data,this.path))?t:this.defaultValue},get data(){return e.props.data||{}},get path(){return gt(e.props.path||[])},get defaultValue(){var t;return null!=(t=e.props.defaultValue)?t:"inherit"},get isInherited(){return this.defaultValue===this.value},get tip(){return this.isInherited?tr("editor::override_mobile_settings::inherited_tip"):tr("editor::override_mobile_settings::changed_tip")},get icon(){return this.isInherited?"desktop-12":"mobile-12"},get iconSize(){return this.isInherited,12}},this.watch={"state.value":()=>this.update()}},resetSettings(e){var t,s,i,a;e.stopPropagation(),e.preventDefault(),null==(t=(s=this.props).onreset)||t.call(s,e),null==(i=(a=this.props).commit)||i.call(a,{value:this.state.defaultValue,path:this.state.path})},onMounted(){Wt(this.root)},onUpdated(){Wt(this.root)},onBeforeUnmount(){Zt(this.root)}}),template:(e,t,s,i)=>e('<svg expr568="expr568" is="flexbe-icon"></svg><div expr569="expr569" class="reset-button"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-reset-adaptive ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["info-icon ",e.state.isInherited?"inherited":"overridden"].join("")},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.state.tip},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.state.icon},{type:t.ATTRIBUTE,name:"size",evaluate:e=>e.state.iconSize}],redundantAttribute:"expr568",selector:"[expr568]"},{type:s.IF,evaluate:e=>!e.state.isInherited,redundantAttribute:"expr569",selector:"[expr569]",template:e('<svg expr570="expr570" is="flexbe-icon" size="8" icon="reset"></svg>',[{expressions:[{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.tr("editor::override_mobile_settings::reset_tip")},{type:t.EVENT,name:"onclick",evaluate:e=>e.resetSettings}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr570",selector:"[expr570]"}])}]),name:"flexbe-reset-adaptive"};e(hr.name,hr);const gr={css:null,exports:{setup(e,{inject:t}){this.modal=t("modal"),this.state={imagesDirectory:"/_s/images/editor/buffer/",get permissionStatus(){return e.props.permissionStatus},get permissionsState(){return this.permissionStatus.state},get currentBrowser(){return/OPR/.test(navigator.userAgent)?"opera":/yabrowser/i.test(navigator.userAgent)?"yandex":"chrome"},get isYandexDenied(){return"yandex"===this.currentBrowser&&"denied"===this.permissionsState}},this.meta={modalWidths:{chrome:{prompt:360,denied:360},opera:{prompt:360,denied:410},yandex:{prompt:472,denied:360}},get modalWidth(){var t,s;const{state:i}=e;return null!=(t=null==(s=this.modalWidths[i.currentBrowser])?void 0:s[i.permissionsState])?t:360},get imageSrc(){var t;const{state:s}=e,i=window.devicePixelRatio>1?"_2x":"";return`/_s/images/editor/buffer/permission/${null!=(t=flexbe.vars.user.lang)?t:"ru"}/${s.currentBrowser}/${s.permissionsState}${i}.png`},get infoText(){const{state:t}=e;return tr(`editor::clipboarder::permission_modal::${t.permissionsState}_text`)}}},skipShowPermissionDeniedModal(){localStorage.setItem("skip_show_permission_denied_modal","1"),this.closeModal()},updateModalPosition(){this.modal.updatePosition()},closeModal(){this.modal.close()},onBeforeMount(){this.modal.updateOptions({width:this.meta.modalWidth}),this.modal.updatePosition()}},template:(e,t,s,i)=>e('<img expr571="expr571"/><div expr572="expr572" class="buffer-permission-modal__title flexbe-text text-l text-bold text-center"> </div><div expr573="expr573" class="buffer-permission-modal__info flexbe-text text-s text-normal text-center"> </div><template expr574="expr574"></template><template expr576="expr576"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"buffer-permission-modal flexbe-modal-content"}]},{type:s.IF,evaluate:e=>!e.state.isYandexDenied,redundantAttribute:"expr571",selector:"[expr571]",template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"src",evaluate:e=>e.meta.imageSrc},{type:t.ATTRIBUTE,name:"alt",evaluate:e=>e.state.permissionsState},{type:t.EVENT,name:"onload",evaluate:e=>e.updateModalPosition}]}])},{redundantAttribute:"expr572",selector:"[expr572]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::clipboarder::permission_modal::title")].join("")}]},{redundantAttribute:"expr573",selector:"[expr573]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.meta.infoText].join("")}]},{type:s.IF,evaluate:e=>"prompt"===e.state.permissionsState,redundantAttribute:"expr574",selector:"[expr574]",template:e('<div expr575="expr575" class="flexbe-button bordered block"> </div>',[{redundantAttribute:"expr575",selector:"[expr575]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::button::close")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.closeModal}]}])},{type:s.IF,evaluate:e=>"denied"===e.state.permissionsState,redundantAttribute:"expr576",selector:"[expr576]",template:e('<span expr577="expr577" class="buffer-permission-modal__link flexbe-text text-s text-normal"> </span>',[{redundantAttribute:"expr577",selector:"[expr577]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::clipboarder::permission_modal::hide_forever_link")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.skipShowPermissionDeniedModal}]}])}]),name:"buffer-permission-modal"};e(gr.name,gr);const vr={x:7,y:7};let fr,xr;const br={css:null,exports:i({setup(e,{initMobx:t}){t(),this.state={eventId:Ge(),lastOverType:null,visibleDropdown:!1,get balloonWidth(){return`${e.props.width||300}px`},get addon(){return e.props.addon},get textAddon(){var e;return null==(e=this.addon)?void 0:e.text},get arrowAddon(){var e;return null==(e=this.addon)?void 0:e.arrow},get iconArrowAddon(){var e;return null==(e=this.arrowAddon)?void 0:e.icon},get sizeArrowAddon(){var e;return null!=(e=this.arrowAddon)&&e.size?+this.arrowAddon.size:16},get overflow(){return{...vr,...e.props.overflow}}}},onMounted(){flexbe.on("dropdownClosed",this.closeSubmenu)},onUpdated(){this.isMounted&&this.reposition()},onBeforeUnmount(){this.killLeaveEvents()},pointerOver(e){const t=e.target.closest("[type]"),s=(null==t?void 0:t.getAttribute("type"))||"item";this.state.lastOverType!==s&&(this.state.lastOverType=s,"item"!==s||this.state.showDropdown||(clearTimeout(xr),clearTimeout(fr),this.initLeaveEvents(),fr=setTimeout((()=>{"item"===this.state.lastOverType&&this.openSubmenu()}),150)))},async openSubmenu(){this.state.showDropdown=!0,this.props.onOpen&&await this.props.onOpen(),this.update()},async closeSubmenu(){this.state.showDropdown=!1,this.props.onClose&&await this.props.onClose(),this.update(),this.killLeaveEvents()},reposition(){if(!this.state.showDropdown)return;let e="right",t=this.state.overflow.y,s=this.state.overflow.x;const i=$(this.root).find(".submenu__popup"),a=this.root.ownerDocument.body.offsetWidth,n=this.root.ownerDocument.defaultView.innerHeight,r=this.root.getBoundingClientRect(),o=i[0].getBoundingClientRect(),l=o.width+10,d=o.height+10,c=a-r.right,p=c>=l,u=r.left>=l;d>n-r.top+t&&(t=o.height-(n-r.top)+10),p||(u?e="left":s=l+this.state.overflow.x-c),i.attr("direction",e),i.css({"--balloonOverflowY":-1*t+"px","--balloonOverflowX":-1*s+"px"})},initLeaveEvents(){const e=this.root,t=e.closest(".flexbe-balloon-content")||e.parentElement;this.killLeaveEvents(),$document.on(["pointermove","pointerover","pointerup"].map((e=>`${e}.submenu.${this.state.eventId}`)).join(" "),(s=>{const i=!!e.querySelector("input:focus, textarea:focus, [contenteditable]:focus"),a=this.state.lastOverType,n=$(s.target).closest(e).length>0,r=$(s.target).closest(".submenu").length>0,o=!n&&$(s.target).closest(t).length>0,l=o||!n&&!o&&"item"===a;i&&l&&!r||(n||(this.state.lastOverType=null),l&&(xr=setTimeout((()=>{this.state.lastOverType||this.closeSubmenu()}),150)))}))},killLeaveEvents(){$document.off(`.submenu.${this.state.eventId}`)}}),template:(e,t,s,i)=>e('<slot expr578="expr578" name="item"><svg expr579="expr579" is="flexbe-icon" class="item-icon"></svg><span expr580="expr580" class="flexbe-text item-name"> <q expr581="expr581" is="flexbe-tooltip"></q></span><div class="item-addon"><slot expr582="expr582" name="addon"></slot><span expr583="expr583" class="item-addon__value"></span><svg expr584="expr584" is="flexbe-icon"></svg><svg expr585="expr585" class="item-addon__arrow" width="10" height="10" viewBox="0 0 10 10"></svg></div></slot><div expr586="expr586" type="popup"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["submenu ",e.state.showDropdown?" hover show-dropdown":""," ",e.props.class].join("")},{type:t.EVENT,name:"onpointerover",evaluate:e=>e.pointerOver}]},{type:s.SLOT,attributes:[{type:t.ATTRIBUTE,name:"submenuActive",evaluate:e=>e.state.showDropdown}],name:"item",redundantAttribute:"expr578",selector:"[expr578]"},{type:s.IF,evaluate:e=>e.props.icon,redundantAttribute:"expr579",selector:"[expr579]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.props.icon}]}])},{redundantAttribute:"expr580",selector:"[expr580]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.props.name].join("")}]},{type:s.IF,evaluate:e=>e.props.tip,redundantAttribute:"expr581",selector:"[expr581]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.props.tip}]}])},{type:s.SLOT,attributes:[],name:"addon",redundantAttribute:"expr582",selector:"[expr582]"},{type:s.IF,evaluate:e=>e.state.textAddon,redundantAttribute:"expr583",selector:"[expr583]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.textAddon].join("")}]}])},{type:s.IF,evaluate:e=>e.state.iconArrowAddon,redundantAttribute:"expr584",selector:"[expr584]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"size",evaluate:e=>e.state.sizeArrowAddon},{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.iconArrowAddon}]}])},{type:s.IF,evaluate:e=>!e.state.iconArrowAddon,redundantAttribute:"expr585",selector:"[expr585]",template:e('<path d="M6 5L2 1L3 -4.37114e-08L8 5L3 10L2 9L6 5Z"/>',[])},{type:s.IF,evaluate:e=>e.state.showDropdown,redundantAttribute:"expr586",selector:"[expr586]",template:e('<slot expr587="expr587" name="default"></slot>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-balloon-content submenu__popup ",e.props.popupClass].join("")},{type:t.ATTRIBUTE,name:"style",evaluate:e=>["width: ",e.state.balloonWidth].join("")}]},{type:s.SLOT,attributes:[],name:"default",redundantAttribute:"expr587",selector:"[expr587]"}])}]),name:"submenu"};e(br.name,br);const yr={css:null,exports:{setup(e,{initMobx:t,inject:s}){t(),this.modal=s("modal"),this.state={swiper:null,swipeInited:!1,activeSlideIndex:0,get update(){return e.props.update},get slides(){var e;const t=Array.isArray(this.update.images)?this.update.images:Object.values(null!=(e=this.update.images)?e:{});return t.length?t.map((e=>{var t;const s="transparent"===e.image_data.img_average?"#ffffff":e.image_data.img_average,i=null==e||null==(t=e.video_data)?void 0:t.video_url;return{...e,type:i?"video":"image",videoSrc:i,imageSrc:pt(e.image_data,950),contrast:Pe(s,"dark","light"),averageColor:s}})):[{title:"",description:"",type:"image",videoSrc:null,imageSrc:this.update.image_retina,contrast:"dark",averageColor:"#ffffff"}]},get activeSlide(){return this.slides[this.activeSlideIndex]},get activeContrast(){return this.activeSlide.contrast||"dark"},get currentTitle(){return this.activeSlide.title||this.update.title},get currentDescription(){return this.activeSlide.description||this.update.text},get needInitSlider(){return this.slides.length>1}},this.meta={sprite:at("core")},this.watch={"state.activeSlideIndex":()=>this.update(),"state.swipeInited":()=>this.update(),"state.currentTitle":()=>this.updateTitleContent(),"state.currentDescription":()=>this.updateDescriptionContent()}},animateContent(e,t,s=.2){const i=.6*s;e.style.setProperty("transition",`opacity ${s}s ease, height ${i}s ease`),e.style.setProperty("opacity",0),setTimeout((()=>{const a=`${e.clientHeight}px`;e.innerHTML=t;const n=`${e.clientHeight}px`;e.style.removeProperty("transition"),e.style.setProperty("height",a),requestAnimationFrame((()=>{e.style.setProperty("transition",`opacity ${s}s ease, height ${i}s ease`),e.style.setProperty("height",n),e.style.removeProperty("opacity"),setTimeout((()=>{e.style.removeProperty("height"),e.style.removeProperty("transition")}),1e3*s)}))}),1e3*s)},updateTitleContent(){this.titleEl.innerText!==this.state.currentTitle&&this.animateContent(this.titleEl,this.state.currentTitle)},updateDescriptionContent(){this.descEl.innerText!==this.state.currentDescription&&this.animateContent(this.descEl,this.state.currentDescription)},setDefaultContent(){this.titleEl.innerHTML=this.state.update.title,this.descEl.innerHTML=this.state.update.text},onClose(){this.modal.close()},replayVideo(e){var t,s,i,a,n;const r=null!=(t=null==(s=this.swiper)||null==(i=s.slides)?void 0:i[null==(a=this.swiper)?void 0:a.activeIndex])?t:this.root;(e=null!=(n=e)?n:r.querySelector("video"))&&(e.pause(),e.currentTime=0,e.play())},onKeyDown(e){this.swiper&&("ArrowLeft"===e.key&&this.swiper.slidePrev(),"ArrowRight"===e.key&&this.swiper.slideNext())},async onMounted(){setTimeout((()=>{this.root.focus()}),100),this.state.needInitSlider&&(await be(["/_s/lib/swiper8/dist/swiper-bundle.min.js?v847"]),await xe(["/_s/lib/swiper8/dist/swiper-bundle.min.css?v847"]),requestAnimationFrame((()=>{this.swiper=new Swiper(this.$(".update-notification-slider-container"),{allowTouchMove:!1,loop:!0,navigation:{nextEl:this.$(".navigation-button_next"),prevEl:this.$(".navigation-button_prev")},pagination:{el:this.$(".swiper-pagination"),clickable:!0},on:{init:()=>{this.state.swipeInited=!0,setTimeout((()=>{this.updateTitleContent(),this.updateDescriptionContent()}))},slideChange:e=>{this.replayVideo(),this.state.activeSlideIndex=e.realIndex}}})}))),this.titleEl=this.root.querySelector(".update-notification-modal__description .flexbe-title"),this.descEl=this.root.querySelector(".update-notification-modal__description .flexbe-text"),this.setDefaultContent()}},template:(e,t,s,i)=>e('<div expr588="expr588"><div class="swiper-wrapper"><div expr589="expr589"></div></div><div expr593="expr593"><div class="flexbe-button filled rounded bordered medium"><svg expr594="expr594" is="flexbe-icon" icon="arrow-left"></svg></div></div><div class="swiper-pagination"></div><div expr595="expr595"><div class="flexbe-button filled rounded bordered medium"><svg expr596="expr596" is="flexbe-icon" icon="arrow-right"></svg></div></div></div><div class="update-notification-modal-content"><div class="update-notification-modal__description"><div class="flexbe-title text-l">&#160;</div><div class="flexbe-text">&#160;</div></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["update-notification-modal-data swiper-container ",e.props.class].join("")},{type:t.ATTRIBUTE,name:"tabindex",evaluate:e=>"1"},{type:t.EVENT,name:"onkeydown",evaluate:e=>e.onKeyDown}]},{redundantAttribute:"expr588",selector:"[expr588]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["update-notification-slider-container ",e.state.activeContrast].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e('<div expr590="expr590" class="update-notification-image-outer"><img expr591="expr591"/><video expr592="expr592" loop muted autoplay preload="1"></video></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["update-notification-slide swiper-slide ",e.classNames({"has-video":e.slide.videoSrc})].join("")}]},{redundantAttribute:"expr590",selector:"[expr590]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>`background: ${e.slide.averageColor}`}]},{redundantAttribute:"expr591",selector:"[expr591]",expressions:[{type:t.ATTRIBUTE,name:"src",evaluate:e=>e.slide.imageSrc},{type:t.ATTRIBUTE,name:"alt",evaluate:e=>e.slide.title||e.state.update.title}]},{type:s.IF,evaluate:e=>e.slide.videoSrc,redundantAttribute:"expr592",selector:"[expr592]",template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"src",evaluate:e=>e.slide.videoSrc}]}])}]),redundantAttribute:"expr589",selector:"[expr589]",itemName:"slide",indexName:"index",evaluate:e=>e.state.slides},{redundantAttribute:"expr593",selector:"[expr593]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["navigation-button navigation-button_prev ",e.classNames({hide:!e.state.swipeInited})].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>12}],redundantAttribute:"expr594",selector:"[expr594]"},{redundantAttribute:"expr595",selector:"[expr595]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["navigation-button navigation-button_next ",e.classNames({hide:!e.state.swipeInited})].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>12}],redundantAttribute:"expr596",selector:"[expr596]"}]),name:"update-notification-modal-data"};e(yr.name,yr);const _r={css:null,exports:{_hotkeysDisposer:null,setup(e,{initMobx:t}){t(),this.state={get projectsStore(){return e.props.projectsStore||adminStore.getModule("projects")},get projects(){return this.projectsStore.getters.publishedPersonalProjects},get drafts(){return this.projectsStore.getters.draftPersonalProjects},get loading(){var e;return null==(e=this.projectsStore.state)?void 0:e.loading},get showToggle(){return e.props.showToggle},get selectedProjects(){return e.props.selectedProjects||[]},get list(){var t,s;return[{title:tr("admin::projects::tag::sites"),projects:this.projects,show:null==(t=e.props.showPublished)||t},{title:tr("admin::projects::tag::drafts"),projects:this.drafts,show:null==(s=e.props.showDrafts)||s}]},get fullListIds(){return[...this.projects,...this.drafts].map((e=>e.project_id))},get limit(){return e.props.limit},get multiple(){var t;return null==(t=e.props.multiple)||t}},this.meta={sprite:at("projects","admin")},this.watch={"state.loading":e=>{this.update(),e||this.scrollToActiveItem()},"state.selectedProjects":()=>this.update()}},checkLoading(){return this.state.loading},async onBeforeMount(){this._hotkeysDisposer=fs.register([{hotkeys:["cmd_a"],options:{preventDefault:!0},handlerDown:()=>this.setAllProjects()}])},onBeforeUnmount(){var e;null==(e=this._hotkeysDisposer)||e.call(this)},isChecked(e){return this.state.selectedProjects.find((t=>t==e))},setAllProjects(){var e,t;if(!this.state.multiple)return;const s=this.state.fullListIds.every((e=>this.state.selectedProjects.includes(e)));null==(e=(t=this.props).onChange)||e.call(t,s?[]:this.state.fullListIds,this.state.fullListIds)},toggleHandler(e,t){var s,i;const a=e.target?e.target.checked:e;var n,r;this.state.multiple?null==(s=(i=this.props).onChange)||s.call(i,a?[...this.state.selectedProjects,t.project_id]:this.state.selectedProjects.filter((e=>e!==t.project_id)),this.state.fullListIds):null==(n=(r=this.props).onChange)||n.call(r,[t.project_id],this.state.fullListIds)},scrollToActiveItem(){setTimeout((()=>{const e=this.root.querySelector(".flexbe-list-item.active-item");e&&e.scrollIntoView({block:"center",behavior:"smooth"})}),100)}},template:(e,t,s,i)=>e('<template expr597="expr597"></template><template expr601="expr601"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["select-projects scrollable-content ",e.props.class," ",e.checkLoading()?"loading":""].join("")}]},{type:s.IF,evaluate:e=>e.state.loading,redundantAttribute:"expr597",selector:"[expr597]",template:e('<div class="flexbe-list flexbe-field-group"><div class="flexbe-title inline-box"><div expr598="expr598" class="flexbe-text"> </div><div expr599="expr599" is="flexbe-loader" class="size-xsmall"></div></div><div expr600="expr600" class="flexbe-list-item"></div></div>',[{redundantAttribute:"expr598",selector:"[expr598]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.list[0].title].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[],redundantAttribute:"expr599",selector:"[expr599]"},{type:s.EACH,getKey:null,condition:null,template:e('<div class="site-preview"><div class="preview-image"></div></div>',[]),redundantAttribute:"expr600",selector:"[expr600]",itemName:"item",indexName:null,evaluate:e=>[0,0,0,0,0,0,0,0,0]}])},{type:s.IF,evaluate:e=>!e.state.loading,redundantAttribute:"expr601",selector:"[expr601]",template:e('<div class="select-projects__actions"><div class="select-projects__actions-inner"><span expr602="expr602" class="flexbe-button style-text text-xs"></span><div expr603="expr603"></div></div></div><div expr606="expr606" class="flexbe-list flexbe-field-group"></div>',[{type:s.IF,evaluate:e=>!e.state.limit&&e.state.multiple,redundantAttribute:"expr602",selector:"[expr602]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::members::edit::projects_select_all")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.setAllProjects}]}])},{type:s.IF,evaluate:e=>e.state.limit,redundantAttribute:"expr603",selector:"[expr603]",template:e('<svg expr604="expr604" is="flexbe-icon" icon="project"></svg><div expr605="expr605" class="flexbe-text"> </div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-desc inline-box mr5 ",e.classNames({"flexbe-error":e.state.selectedProjects.length>e.state.limit})].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr604",selector:"[expr604]"},{redundantAttribute:"expr605",selector:"[expr605]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.selectedProjects.length,"/",e.state.limit].join("")}]}])},{type:s.EACH,getKey:null,condition:e=>e.item.projects.length&&e.item.show,template:e('<div class="flexbe-title"><span expr607="expr607" class="flexbe-text"> </span></div><label expr608="expr608"></label>',[{redundantAttribute:"expr607",selector:"[expr607]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.item.title].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e('<div class="site-preview"><div expr609="expr609" class="preview-image"></div></div><span expr610="expr610" class="flexbe-text project-domain"> </span><div expr611="expr611" is="proxy" data-is="flexbe-input" class="project-toggle"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list-item ",e.classNames({"cursor-pointer":e.state.showToggle,"active-item":e.isChecked(e.project.project_id)})].join("")},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.toggleHandler(t,e.project)}]},{redundantAttribute:"expr609",selector:"[expr609]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["background-image: url('/img/",e.project.img_id,"_120.jpg')"].join("")}]},{redundantAttribute:"expr610",selector:"[expr610]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.project.name||e.project.domain_title].join("")}]},{type:s.IF,evaluate:e=>e.state.showToggle,redundantAttribute:"expr611",selector:"[expr611]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"type",evaluate:e=>e.state.multiple?"toggle":"radio"},{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.isChecked(e.project.project_id)}]}])}]),redundantAttribute:"expr608",selector:"[expr608]",itemName:"project",indexName:null,evaluate:e=>e.item.projects}]),redundantAttribute:"expr606",selector:"[expr606]",itemName:"item",indexName:null,evaluate:e=>e.state.list}])}]),name:"select-projects"};e(_r.name,_r);const Tr={1:"user",2:"support",3:"app"},wr={support:"Support",app:"System"},kr=new Map;class Ar{constructor(e){if(this.raw=void 0,this.id=void 0,this.isNew=void 0,this.kind=void 0,this.type=void 0,this.avatar=void 0,this.name=void 0,this.image=void 0,this.file=void 0,this.text=void 0,this.raw=e,this.isNew=e.isNew||!1,this.id=e.id,this.kind=Object.keys(e.msg||{})[0]||"text",this.type=Tr[e.msg_type],this.image=e.msg.image&&ct(e.msg.image),this.file=e.msg.file,this.text=e.msg.text,"text"===this.kind){let e=this.text;/```[^`]*```/g.test(e)&&(e=e.replace(/```([^`]*)```/g,'<code class="scrollable block"><pre>$1</pre></code>')),/`[^`]*`/g.test(e)&&(e=e.replace(/`([^`]+)`/g,'<code class="line">$1</code>')),"app"!==this.type||/</g.test(e)||(e=st(e,!0)),e=e.replace(/[^>](\n)/g,((e,t)=>`${e.replace(t,"")}<br />`)),e=function(e="",t=!0){const s=t?' target="_blank"':"";return e.replace(/(<a\b[^>]*>)?(https?:\/\/[^\s<>"']+[^\s<>"]|www\.[^\s<>"']+[^\s<>"])(?![^<]*<\/a>)/gi,((e,t,i)=>t?e:`<a href="${i}"${s}>${i}</a>`))}(e),this.text=e}e.msg_data??=kr.get(e.admin_id),e.msg_data?("app"===this.type?(this.avatar=e.msg_data.app.icon,this.name=e.msg_data.app.title||e.msg_data.app.name||wr[this.type]):(this.avatar=e.msg_data.admin_avatar||`/_s/images/support/avatar/${e.admin_id}.png`,this.name=e.msg_data.admin_name||wr[this.type]),kr.set(e.admin_id,e.msg_data)):e.admin_id&&(this.avatar=`/_s/images/support/avatar/${e.admin_id}.png`,this.name=wr[this.type])}}riot3.tag2("support-message",'<div class="avatar" if="{dto.type !== \'user\'}" riot-style="background-image: url({dto.avatar})"></div> <div class="name" if="{dto.type !== \'user\'}">{dto.name}</div> <div data-is="raw" class="bubble text" if="{dto.kind === \'text\'}" content="{dto.text}"></div> <div class="bubble image" if="{dto.kind === \'image\'}" onclick="{showImage}"> <img riot-src="{getImageUrl(dto.image, 560)}" riot-style="aspect-ratio: {dto.image.width} / {dto.image.height}" draggable="false"> </div> <a class="bubble file" if="{dto.kind === \'file\'}" riot-href="{dto.file.url}" target="_blank"> <svg viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <g fill="none" fill-rule="evenodd"> <path d="M0 0h30v30H0z"></path> <path d="M14 21V11c0-.997.496-2 1.5-2s1.5 1.005 1.5 2v10c0 2.002-1.776 3-3 3s-3-1-3-3V11c0-3.005 1.99-5 4.5-5S20 8.002 20 11.002V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> </g> </svg> <span class="text">{dto.file.name}</span> </a>',"","class=\"support-message from-{dto.type} {isNew ? 'new' : ''}\"",(function(e){this.dto=new Ar(e.data),this.isNew=this.dto.isNew,this.getImageUrl=pt,this.showImage=function(){const e=this.dto.image,t=e.width>e.height?`width: ${e.width}px`:`height: ${e.height}px`,s=pt(e,560),i=pt(e,0);$("body").append(`<div class="overlay-support-preview"><img src="${s}" style="${t}"/></div>`),lt(i).then((()=>{const e=$(".overlay-support-preview img").get(0);e&&(e.src=i)})),setTimeout((()=>{$(".overlay-support-preview").addClass("show")}),25),$(".overlay-support-preview").on("click",(()=>{$(".overlay-support-preview").removeClass("show"),setTimeout((()=>{$(".overlay-support-preview").remove()}),250)}))}.bind(this),this.onMounted=function(){this.isNew&&setTimeout((()=>{this.isNew=!1,this.update()}),30)}.bind(this)})),riot3.tag2("support-chat",'<div class="out-click fade" onclick="{hideChat}"></div> <div class="chat-wrapper admin-ui"> <div class="header"> <span class="flexbe-title">{tr(\'admin::support::title\')}</span> <span class="flexbe-text">{tr(\'admin::support::subtitle\')}</span> <div class="close"> <svg viewbox="0 0 12 12" onclick="{hideChat}"> <g fill="none" fill-rule="evenodd"> <path d="M0 0h12v12H0z"></path> <g transform="translate(1 1)" stroke="#FFF" stroke-width="2"> <path d="M10 0L0 10M0 0l10 10"></path> </g> </g> </svg> </div> </div> <div class="scrollable-content" ref="messages" onscroll="{loadOldMessages}"> <div each="{messages in dates}"> <div class="date"> {messages[0].time_day} </div> <support-message each="{message in messages}" data="{message}"></support-message> </div> <div class="loader own" each="{value, loader in loaders}"> <div class="progress-bar"> <div data-is="proxy" is="flexbe-loader" class="size-medium"></div> </div> <div class="cancel" onclick="{cancelUpload}"> <svg viewbox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"> <g transform="translate(1 1)" stroke="#FFF" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"> <path d="M12 0L0 12M0 0l12 12"></path> </g> </svg> </div> </div> <virtual if="{isWorkTime}"> <div class="help no-message {flexbe.vars.user.lang}" if="{!Object.keys(dates).length}"> {tr(\'admin::support::greetings_text\')} </div> <div class="help answer-delay" if="{isWorkTime}"> {tr(\'admin::support::answer_delay\')} </div> </virtual> <div class="help work-off" if="{!isWorkTime}"> {tr(\'admin::support::out_of_service_text\')} </div> </div> <div class="chat {input: refs.editor && refs.editor.value.length}"> <textarea class="scrollable-content" placeholder="{tr(\'admin::support::placeholder\')}" oninput="{textChange}" onkeydown="{keyPressed}" rows="1" ref="editor"></textarea> <div class="button file"> <input type="file" name="file"> <svg viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <g fill="none" fill-rule="evenodd"> <path d="M0 0h30v30H0z"></path> <path d="M14 21V11c0-.997.496-2 1.5-2s1.5 1.005 1.5 2v10c0 2.002-1.776 3-3 3s-3-1-3-3V11c0-3.005 1.99-5 4.5-5S20 8.002 20 11.002V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> </g> </svg> </div> <div class="button post" onclick="{sendMessage}"> <svg viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <g fill="none" fill-rule="evenodd"> <path d="M0 0h30v30H0z"></path> <path d="M8.268 16.114c-.14 1.265-.545 2.93-1.218 4.993a1 1 0 0 0 1.338 1.232l14.746-6.21a1 1 0 0 0 0-1.843L8.388 8.077A1 1 0 0 0 7.05 9.31c.673 2.064 1.08 3.73 1.218 4.993l9.054.906-9.054.904z" fill="#0051FF"></path> </g> </svg> </div> </div> </div>',"",'class="support-chat {show: show}"',(function(e){const t=flexbe.support,s=t.socket;let i,a,n;this.dates=[],this.show=e.show,this.connect=s.readyState===s.OPEN,this.isWaitAnswer=!1,this.showSmiles=!1,this.loaders={},this.isWorkTime=!1,this.lastMessage={},this.cache={},this.loadOldMessages=function(e){e.target.scrollTop||t.offlineRequest({last_id:n}).done((e=>{if(e.list.reverse(),e.list.forEach(((e,t)=>{let s=this.cache[e.time_day];s||(s=this.cache[e.time_day]=[],this.dates.unshift(s)),s.unshift(e)})),e.list.length){const t=this.refs.messages,s=t.scrollHeight-t.scrollTop;this.update(),n=e.list[e.list.length-1].id,t.scrollTop=t.scrollHeight-s}}))}.bind(this),this.scrollDown=function(){const e=this.refs.messages;e.scrollTop=e.scrollHeight}.bind(this),this.requestHandler=function(e){e.list.forEach((e=>{let t=this.cache[e.time_day];t||(t=this.cache[e.time_day]=[],this.dates.push(t)),t.push(e)})),!n&&e.list.length&&(n=e.list[0].id),this.lastMessage=e.list[e.list.length-1]||this.lastMessage||{},this.isWaitAnswer=Boolean(e.is_wait_answer),this.isWorkTime=!e.is_not_working}.bind(this),this.offlineLoad=function(){return setInterval((()=>{t.offlineRequest({skip_msg_id:this.lastMessage.id,start_time:this.lastMessage.time}).done((e=>{this.requestHandler(e),this.update(),e.list.length&&(t.playNotify(),this.show&&(t.readAll(),this.scrollDown()))}))}),1e4)}.bind(this),this.cancelUpload=function(e){const t=e.item.loader;i.cancelUpload(t),delete this.loaders[t]}.bind(this),this.toggleShowSmiles=function(){this.showSmiles=!this.showSmiles}.bind(this),this.insertSmile=function(e){const t=e.item.smile,s=this.refs.editor,i=s.value;s.value=i.substring(0,s.selectionStart)+t+i.substring(s.selectionStart,i.length),this.update({showSmiles:!1}),s.focus()}.bind(this),this.hideChat=function(){t.toggleChat(!1)}.bind(this),this.textChange=function(){this.connect&&(a||s.send("support_start_typing",{to:"support"}),clearTimeout(a),a=setTimeout((()=>{s.send("support_stop_typing",{to:"support"}),a=void 0}),1e3))}.bind(this),this.keyPressed=function(e){const t=this.refs.editor,s=t.value,i=13==e.keyCode,a=e.ctrlKey||e.metaKey,n=e.shiftKey;!i||a||n||(this.sendMessage(),e.preventDefault()),a&&i&&(t.value=s.substring(0,t.selectionStart)+"\n"+s.substring(t.selectionStart,s.length)),setTimeout((()=>{t.style.height="auto",t.style.height=`${Math.min(t.scrollHeight,150)}px`}),30)}.bind(this),this.sendMessage=function(){const e=this.refs.editor,s=e.value.trim();s.length&&(flexbe.support.sendMessage(s).done((e=>{this.connect?(this.isWaitAnswer=!!e.is_wait_answer,this.isWorkTime=!e.is_not_working,e.list.forEach((e=>{t.addMessage(e)}))):(this.requestHandler(e),this.update(),this.scrollDown(),t.readAll())})).fail((e=>{console.warn(e)})),e.value="",e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}.bind(this),flexbe.on("toggleSupport",(({show:e}={})=>{null==e&&(e=!this.show),this.show=e,this.showSmiles=!1,this.update()})),this.on("before-mount",(()=>{t.offlineRequest({skip_msg_id:this.lastMessage.id,start_time:this.lastMessage.time}).done(this.requestHandler).then((()=>{this.isMounted&&(this.update(),this.scrollDown())})).fail((e=>{console.warn(e)})),this.connect||(t.offlineInterval=this.offlineLoad()),$(document).on("keydown.tip_modal",(e=>{this.showSmiles?this.update({showSmiles:!1}):27===e.keyCode&&this.update({show:!1})}))})),this.on("mount",(function(){i=pi.init({url:"/admin/api/support/upload/",multi:!0,type:"file",input:this.root.querySelector("input[type=file]"),onStart:()=>{i.setParam({data:{skip_msg_id:this.lastMessage.id,start_time:this.lastMessage.time,msg_data:t.getMessageMetadata()}})},onSelect:e=>{this.loaders[e]=0,this.update(),this.scrollDown()},onProgress:(e,t)=>{this.loaders[e]=t,this.update()},onComplete:(e,s)=>{delete this.loaders[e],this.connect?s.data.list.forEach((e=>{t.addMessage(e)})):this.requestHandler(s.data),this.update()},onError:e=>{delete this.loaders[e],this.update(),toast.error(tr("main::error::upload_file"))}})})),this.on("mount",this.scrollDown)})),riot3.tag2("support-nps-message",'<div class="nps-wrapper"> <a class="flexbe-modal-close" onclick="{onClose}"></a> <div class="nps-block score-block" if="{state.view === \'score\'}"> <img class="score-image" src="/_s/images/emoji/hand_hello.png"> <div class="flexbe-text text-subtitle"> {tr(\'admin::nps::score::title\')} </div> <div class="scores-list text-s font-ui"> <div class="score-value {active: state.score === score.value}" data-value="{score.value}" each="{score in meta.scores}" onclick="{setScore}"> <span class="flexbe-text"> {score.value} </span> </div> </div> <div class="scores-legend"> <div class="flexbe-desc left"> {tr(\'admin::nps::score::legend_below_label\')} </div> <div class="flexbe-desc right"> {tr(\'admin::nps::score::legend_above_label\')} </div> </div> </div> <div class="nps-block mention-block" if="{state.view === \'mention\'}"> <div class="flexbe-text text-subtitle"> {tr(\'admin::nps::mention::title\')} </div> <div class="mention-area" data-is="flexbe-input" type="textarea" placeholder="{tr(\'admin::nps::mention::comment_placeholder\')}" riot-value="{state.mention}" autofocus="{true}" oninput="{setMention}" onkeydown:ctrl_enter="{submitMentionAction}" onkeydown:cmd_enter="{submitMentionAction}"></div> <div class="flexbe-buttons-line"> <div class="flexbe-button large filled rounded is-primary {loading: state.mentionSending}" onclick="{submitMentionAction}"> <span class="flexbe-text"> {tr(\'admin::nps::mention::submit_button\')} </span> </div> <div class="flexbe-button large bordered rounded" onclick="{onClose}"> <span class="flexbe-text"> {tr(\'admin::nps::mention::close_button\')} </span> </div> </div> </div> <div class="nps-block done-block" if="{state.view === \'done\'}"> <img class="done-image" src="/_s/images/emoji/clapping_hands.png"> <div class="flexbe-text text-subtitle"> {tr(\'admin::nps::done::title\')} </div> </div> </div>',"",'class="support-nps-message admin-ui {show: state.show}"',(function(e){this.state={show:!1,view:"score",score:0,mention:"",mentionSending:!1,sended:!1},this.meta={scores:[{value:1},{value:2},{value:3},{value:4},{value:5},{value:6},{value:7},{value:8},{value:9},{value:10}]},this.setMention=function(e){const t=e.target.value;this.state.mention=t}.bind(this),this.setScore=function(e){const t=e.item.score.value;this.state.score=t,this.state.view="mention"}.bind(this),this.submitMentionAction=async function(e){this.state.mentionSending=!0,this.update(),await this.sendData(),this.state.mentionSending=!1,this.state.view="done",this.update(),setTimeout(this.onClose,1500,this)}.bind(this),this.onClose=function(e){e&&(e.preventUpdate=!0),this.state.show=!1,this.update(),this.state.sended||this.sendData()}.bind(this),this.sendData=async function(e={}){if(!this.state.sended){this.state.sended=!0;try{return await ii("/admin/api/poll/nps/",{data:{score:this.state.score,comment:this.state.mention},...e})}catch(e){return"NetworkError"===e.name?console.warn("sendData NetworkError: ",e.message):console.error(e),e}}}.bind(this),flexbe.on("toggleNps",(({show:e}={})=>{null==e&&(e=!this.state.show),this.state.show=e,e&&(this.state.view="score"),this.update()}))}));const Er={css:null,exports:{setup(e,{initMobx:t}){t(),this.sprite=e.props.sprite,this.state={toastWrapper:null,get file(){return e.props.file},get leadCount(){const e=+this.file.count_lead;return tr("admin::lead::export::lead_count",{count:e})},get isToast(){return e.props.isToast||!1},get isPlaceholder(){return"placeholder"===this.file.id},get status(){return this.file.status},get statusSuccess(){return"success"===this.status},get statusError(){return"error"===this.status},get statusLoading(){return!this.status||"await"===this.status||"progress"===this.status},get downloadLink(){return`/admin/api/project/${flexbe.vars.group.id}/lead/export/${this.file.id}/`},get linkAttributes(){return this.statusSuccess?{target:"_blank",href:this.downloadLink,download:!0}:{}}}},getFileName(){const e=`${flexbe.vars.user.lang}-${flexbe.vars.user.country}`,t=new Date(Je(this.state.file.created_at.date)),s=t.toLocaleDateString(e,{year:"numeric",month:"numeric",day:"numeric",timeZone:flexbe.vars.group.timezone});return`${t.toLocaleTimeString(e,{hour:"numeric",minute:"numeric",timeZone:flexbe.vars.group.timezone})}, ${s}`},stopEvent(e){e.stopPropagation(),e.preventDefault()},onMounted(){this.state.isToast&&setTimeout((()=>{this.state.toastWrapper=this.root.closest(".toast-wrapper"),this.state.toastWrapper.addEventListener("pointerdown",this.stopEvent)}),0)},onUnmounted(){this.state.toastWrapper&&this.state.toastWrapper.removeEventListener("pointerdown",this.stopEvent)}},template:(e,t,s,i)=>e('<div expr3="expr3" class="lead-list-item-placeholder"></div><template expr4="expr4"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list-item lead-list-export-item ",e.props.class].join("")},{type:t.ATTRIBUTE,name:null,evaluate:e=>e.state.linkAttributes}]},{type:s.IF,evaluate:e=>e.state.isPlaceholder,redundantAttribute:"expr3",selector:"[expr3]",template:e('<div class="flexbe-placeholder lead-icon-placeholder"></div><div class="lead-text-placeholder"><div class="flexbe-placeholder lead-status-placeholder"></div><div class="flexbe-placeholder lead-info-placeholder"></div></div>',[])},{type:s.IF,evaluate:e=>!e.state.isPlaceholder,redundantAttribute:"expr4",selector:"[expr4]",template:e('<svg class="flexbe-icon file-icon m0"><use expr5="expr5"/></svg><div class="file-name"><div expr6="expr6" class="flexbe-text"></div><div expr7="expr7" class="flexbe-error"></div><div expr8="expr8" class="flexbe-text"></div><div expr9="expr9" class="flexbe-desc"> <span></span> </div></div><div expr10="expr10" is="flexbe-loader" class="item-addon"></div><div expr11="expr11" class="item-addon flexbe-button style-text p0"></div><div expr13="expr13" class="item-addon file-download-toast"></div>',[{redundantAttribute:"expr5",selector:"[expr5]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.sprite,"#",`file-${e.state.file.file_type}`].join("")}]},{type:s.IF,evaluate:e=>e.state.statusSuccess,redundantAttribute:"expr6",selector:"[expr6]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::export::file_success")}]}])},{type:s.IF,evaluate:e=>e.state.statusError,redundantAttribute:"expr7",selector:"[expr7]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::export::file_error")}]}])},{type:s.IF,evaluate:e=>e.state.statusLoading,redundantAttribute:"expr8",selector:"[expr8]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::export::file_progress")}]}])},{redundantAttribute:"expr9",selector:"[expr9]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.getFileName()},{type:t.TEXT,childNodeIndex:2,evaluate:e=>e.state.leadCount}]},{type:s.IF,evaluate:e=>e.state.statusLoading,redundantAttribute:"expr10",selector:"[expr10]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[]}])},{type:s.IF,evaluate:e=>e.state.statusSuccess&&!e.state.isToast,redundantAttribute:"expr11",selector:"[expr11]",template:e('<svg class="flexbe-icon size-16 p0 m0 ml-auto"><use expr12="expr12"/></svg>',[{redundantAttribute:"expr12",selector:"[expr12]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.sprite,"#file-download"].join("")}]}])},{type:s.IF,evaluate:e=>e.state.statusSuccess&&e.state.isToast,redundantAttribute:"expr13",selector:"[expr13]",template:e('<a expr14="expr14" class="flexbe-button style-text small borderless weight-medium" target="_blank" download> </a>',[{redundantAttribute:"expr14",selector:"[expr14]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::export::download")},{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.downloadLink}]}])}])}]),name:"lead-list-export-item"};e(Er.name,Er);class Ir extends kt{static create(e="wss://ws.flexbe.com:3130"){if(this.instances.has(e))return this.instances.get(e);const t=new Ir(e);return this.instances.set(e,t),t}get isOpen(){return this.websocket.readyState===this.websocket.OPEN}constructor(e){super(),this.websocket=void 0,this.connect(e)}connect(e){const t=new WebSocket(e,"echo-protocol");this.websocket=t,t.onopen=e=>{this.send("connect"),this.trigger("open",e)},t.onclose=t=>{t.wasClean||setTimeout((()=>{this.connect(e)}),5e3),this.trigger("close",t)},t.onmessage=e=>{const t=JSON.parse(e.data);this.trigger("message",t)},t.onerror=e=>{this.trigger("error",e)}}send(e,t={}){if(this.isOpen)return this.websocket.send(JSON.stringify({event:e,socketsig:flexbe.vars.user.socketsig,...t}));console.warn(`Can't send event [${e}] to websocket, websocket not open`)}}let Cr;Ir.instances=new Map;const Sr={unread:0,sumCounter:0,offlineInterval:null,init(){this.inited||(this.inited=!0,this.socket=Ir.create(),this.socket.on("open",(()=>{Cr&&(clearInterval(this.offlineInterval),this.offlineInterval=null,Cr.connect=!0)})),this.socket.on("close",(()=>{Cr&&!this.offlineInterval&&(this.offlineInterval=Cr.offlineLoad()),Cr&&(Cr.connect=!1)})),this.socket.on("message",(e=>{if("leads_unread_cnt"===e.event&&parseInt(e.site.group_id,10)===parseInt(flexbe.vars.group.id,10)?this.playNotify():["support_message","app_message"].includes(e.event)&&this.addMessage(e),"generate_file"===e.event&&parseInt(e.site.group_id,10)===parseInt(flexbe.vars.group.id,10)){if("success"===e.msg_data.status&&"visible"===document.visibilityState&&"lead"===e.msg_data.type){const t={delay:0},s={file:e.msg_data,class:"lead-list-export-item--toast",sprite:at("lead","admin"),isToast:!0};toast.component(Er,t,s)}}})),this.socket.on("error",(()=>{Cr&&(Cr.connect=!1)})),flexbe.vars.user.can_vote&&setTimeout((()=>{this.toggleNps(!0)}),500))},toggleChat(e){Cr||($("body").append('<div data-is="support-chat"></div>'),Cr=riot3.mount("support-chat",{support:this})[0]),setTimeout((()=>{$("body").toggleClass("overflow",!!e),flexbe.trigger("toggleSupport",{show:e}),e&&this.readAll()}),15)},toggleNps(e){this._npsInited||(this._npsInited=!0,$("body").append('<div data-is="support-nps-message"></div>'),riot3.mount("support-nps-message",{support:this})),setTimeout((()=>{flexbe.trigger("toggleNps",{show:e})}),15)},async playNotify(){if((()=>{const e=document.createElement("audio");return!(!e.canPlayType||!e.canPlayType("audio/mpeg;").replace(/no/,""))})())try{if(void 0===this.notify&&(this.notify=new Audio,this.notify.src="/_s/files/notify.mp3"),"function"==typeof this.notify.pause)try{await this.notify.pause()}catch(e){}this.notify.currentTime=0,"function"==typeof this.notify.play&&await this.notify.play()}catch(e){console.warn("Play Notify error: ",e)}},addMessage(e){if(2==+e.msg_type&&this.playNotify(),Cr&&Cr.show&&this.readAll(),Cr){e.time_day=e.time_day||Cr.lastMessage.time_day||"Today";let t=Cr.cache[e.time_day];t||(t=[],Cr.cache[e.time_day]=t,Cr.dates.push(t)),e.isNew=!0,e.msg_text&&(e.msg={text:e.msg_text}),e.id&&!t.find((t=>t.id===e.id))&&(Cr.lastMessage=e,t.push(e)),Cr.update(),Cr.scrollDown()}},getMessages(){var e,t;return null==(e=Cr)||null==(t=e.dates)?void 0:t.flat()},getMessageMetadata:()=>({url:window.location.href,sign:`${flexbe.vars.user.id}_${(new Date).getTime()}`,browser:navigator.userAgent,screen:{screen:{width:window.screen.width,height:window.screen.height},window:{width:$(window).width(),height:$(window).height()}}}),offlineRequest:e=>$.ajax({url:"/admin/api/support/load/",type:"POST",dataType:"json",data:e}),sendMessage(e){return $.ajax({url:"/admin/api/support/send/",type:"POST",dataType:"json",data:{msg_data:this.getMessageMetadata(),msg:e}})},readAll(){$.ajax({url:"/admin/api/support/read/",type:"GET",dataType:"json",data:{}}),this.socket.send("support_read_msg",{broadcast:!0})}},$r={css:null,exports:{sprite:"",setup(e,{initMobx:t}){var s,i,a;t(),this.sprite=at("panel"),this.state={isMac:fs.isMac,showHotkeys:e.props.showHotkeys,unreadUpdates:+(null==(s=flexbe.unreads)?void 0:s.updates)||0,unreadSupport:+(null==(i=flexbe.unreads)?void 0:i.support)||0,unreadLeads:+(null==(a=flexbe.unreads)?void 0:a.leads)||0,temporaryList:null,temporaryListLoaded:!1,get user(){return flexbe.vars.user},get bill(){return flexbe.bill},get helpLink(){return"ru"===this.user.lang?"https://help.flexbe.ru/":"https://help.flexbe.com/"}}},onMounted(){this.update(),Wt(this.root,{position:"bottom",interactive:!1}),Sr.socket.on("message",(e=>{"leads_unread_cnt"===e.event&&parseInt(e.site.group_id,10)===parseInt(flexbe.vars.group.id,10)&&(this.state.unreadLeads=e.msg_data.leads_unread_cnt),["support_message","app_message"].includes(e.event)&&e.admin_id&&(Sr.getMessages()&&!Sr.getMessages().find((t=>t.id===e.id))?this.state.unreadSupport+=1:this.state.temporaryList||this.state.temporaryListLoaded?this.state.temporaryList&&!this.state.temporaryList.find((t=>t.id===e.id))&&(this.state.unreadSupport+=1,this.state.temporaryList.push(e)):(this.state.temporaryListLoaded=!0,Sr.offlineRequest().done((e=>{this.state.temporaryList=(e.list||[]).flat()})),this.state.unreadSupport+=1)),"support_read_msg"===e.event&&(this.state.unreadSupport=0),this.update()}))},toggleSupport(){Sr.toggleChat(!0)},toggleUpdates(){this.state.unreadUpdates=0,this.update(),ii("/admin/api/updates/get_user_updates/",{data:{limit:10}})},showHotkeysHelp(){((e={})=>{flexbe.trigger("closeDropdown"),Zs.create({title:tr("editor::hotkeys::title"),width:940,handle:"",duplicate:!1,overlay:!0,shadow:!0,clickOut:!0,stopEditor:!0,stopEditorOptions:{globalStates:!0,stopInstances:!0},...e,component:"modal-hotkeys"})})()}},template:(e,t,s,i)=>e('<a href="/admin/sites/" class="flexbe-button on-dark projects-button"><svg expr56="expr56" is="flexbe-icon" icon="domain"></svg><span expr57="expr57" class="flexbe-text"> </span></a><div class="project-actions"><a class="link item-pages" href="/admin/pages/"><svg expr58="expr58" is="flexbe-icon" icon="pages" size="18"></svg><span expr59="expr59" class="flexbe-text"> </span></a><a class="link item-ecommerce" href="/admin/ecommerce/"><svg expr60="expr60" is="flexbe-icon" icon="ecommerce" size="18"></svg><span expr61="expr61" class="flexbe-text"> </span></a><a class="link item-lead" href="/admin/lead/"><svg expr62="expr62" is="flexbe-icon" icon="leads" size="18"></svg><span expr63="expr63" class="flexbe-text"> </span><em expr64="expr64" class="unread-cnt"></em></a><a expr65="expr65" class="link item-stat" href="/admin/stat/"></a><a expr68="expr68" class="link item-settings" href="/admin/settings/general/"></a></div><div class="user-actions"><template expr71="expr71"></template><div class="link"><span expr74="expr74"> </span><em expr75="expr75" class="support-action-mark"></em><div expr76="expr76" is="proxy" data-is="dropdown" class="actions-popup support-popup" position="center" autohide=".flexbe-list-item"></div></div><div class="user-info"><div class="user-pic"><div expr98="expr98" is="proxy" data-is="user-avatar"></div></div><div expr99="expr99" is="proxy" data-is="dropdown" class="actions-popup user-popup" position="end" autohide=".flexbe-list-item"></div></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-panel-project ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr56",selector:"[expr56]"},{redundantAttribute:"expr57",selector:"[expr57]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::projects")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr58",selector:"[expr58]"},{redundantAttribute:"expr59",selector:"[expr59]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::pages")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr60",selector:"[expr60]"},{redundantAttribute:"expr61",selector:"[expr61]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::ecommerce")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr62",selector:"[expr62]"},{redundantAttribute:"expr63",selector:"[expr63]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::leads")}]},{type:s.IF,evaluate:e=>e.state.unreadLeads,redundantAttribute:"expr64",selector:"[expr64]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.unreadLeads].join("")}]}])},{type:s.IF,evaluate:e=>"manager"!=e.state.user.role,redundantAttribute:"expr65",selector:"[expr65]",template:e('<svg expr66="expr66" is="flexbe-icon" icon="stat" size="18"></svg><span expr67="expr67" class="flexbe-text"> </span>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr66",selector:"[expr66]"},{redundantAttribute:"expr67",selector:"[expr67]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::analytics")}]}])},{type:s.IF,evaluate:e=>"manager"!=e.state.user.role,redundantAttribute:"expr68",selector:"[expr68]",template:e('<svg expr69="expr69" is="flexbe-icon" icon="settings" size="18"></svg><span expr70="expr70" class="flexbe-text"> </span>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr69",selector:"[expr69]"},{redundantAttribute:"expr70",selector:"[expr70]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::settings")}]}])},{type:s.IF,evaluate:e=>"owner"===e.state.user.role,redundantAttribute:"expr71",selector:"[expr71]",template:e('<a expr72="expr72" href="/admin/user/pay/"></a><a class="link pay-btn" href="/admin/user/pay/"><span expr73="expr73"> </span></a>',[{type:s.IF,evaluate:e=>e.state.bill.daysToLock<=14&&(!e.state.bill.autoPay||e.state.bill.isLocked),redundantAttribute:"expr72",selector:"[expr72]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.bill.isLocked?e.tr("menu::user_is_locked"):e.tr("menu::user_left_n_days",e.state.bill.daysToLock)].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["pay-expire ",e.state.bill.daysToLock<=7?"warning":""].join("")},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>[e.state.bill.isPaid?e.tr("menu::user_pay_till"):e.tr("menu::user_trial_till")," ",e.state.bill.paidFor].join("")}]}])},{redundantAttribute:"expr73",selector:"[expr73]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::pay")}]}])},{redundantAttribute:"expr74",selector:"[expr74]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::help")}]},{type:s.IF,evaluate:e=>e.state.unreadSupport||e.state.unreadUpdates,redundantAttribute:"expr75",selector:"[expr75]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.unreadSupport+e.state.unreadUpdates].join("")}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="flexbe-list hoverable hoverable-background round-corners-top"><a expr77="expr77" class="flexbe-list-item" target="_blank"><svg expr78="expr78" is="flexbe-icon" icon="help-flexbe"></svg><span expr79="expr79" class="flexbe-text"> </span></a><a expr80="expr80" class="flexbe-list-item"></a><template expr83="expr83"></template><div expr88="expr88" class="flexbe-list-item support-btn"><svg expr89="expr89" is="flexbe-icon" icon="chat"></svg><span expr90="expr90" class="flexbe-text"> </span><span expr91="expr91" class="mark notification"></span></div></div><div expr92="expr92" class="footer"></div>',bindings:[{redundantAttribute:"expr77",selector:"[expr77]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.helpLink}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr78",selector:"[expr78]"},{redundantAttribute:"expr79",selector:"[expr79]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::help")}]},{type:s.IF,evaluate:e=>e.state.showHotkeys,redundantAttribute:"expr80",selector:"[expr80]",template:e('<svg expr81="expr81" is="flexbe-icon" icon="hotkeys"></svg><span expr82="expr82" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.showHotkeysHelp}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr81",selector:"[expr81]"},{redundantAttribute:"expr82",selector:"[expr82]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("editor::hotkeys::title")}]}])},{type:s.IF,evaluate:e=>"ru"===e.state.user.lang,redundantAttribute:"expr83",selector:"[expr83]",template:e('<a class="flexbe-list-item" href="https://academy.flexbe.ru/" target="_blank"><svg expr84="expr84" is="flexbe-icon" icon="academy"></svg><span class="flexbe-text"> Flexbe</span></a><a expr85="expr85" class="flexbe-list-item" href="https://help.flexbe.ru/updates/" target="_blank"><svg expr86="expr86" is="flexbe-icon" icon="updates"></svg><span class="flexbe-text"> Flexbe</span><span expr87="expr87" class="mark notification"></span></a>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr84",selector:"[expr84]"},{redundantAttribute:"expr85",selector:"[expr85]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.toggleUpdates}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr86",selector:"[expr86]"},{type:s.IF,evaluate:e=>e.state.unreadUpdates,redundantAttribute:"expr87",selector:"[expr87]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.unreadUpdates].join("")}]}])}])},{redundantAttribute:"expr88",selector:"[expr88]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.toggleSupport}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr89",selector:"[expr89]"},{redundantAttribute:"expr90",selector:"[expr90]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::help_chat")}]},{type:s.IF,evaluate:e=>e.state.unreadSupport,redundantAttribute:"expr91",selector:"[expr91]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.unreadSupport].join("")}]}])},{type:s.IF,evaluate:e=>"ru"===e.state.user.lang,redundantAttribute:"expr92",selector:"[expr92]",template:e('<template expr93="expr93"></template><span class="footer-desc">  </span><div class="panel-soc-network"><a href="https://vk.com/flexbe" target="_blank" class="social-panel social-vk"><svg expr94="expr94" is="flexbe-icon" class="panel-soc-icon" icon="vk"></svg></a><a href="https://facebook.com/flexbe.russia/" target="_blank" class="social-panel social-fb"><svg expr95="expr95" is="flexbe-icon" class="panel-soc-icon" icon="fb"></svg></a><a href="https://instagram.com/flexbe.ru/" target="_blank" class="social-panel social-instagram"><svg expr96="expr96" is="flexbe-icon" class="panel-soc-icon" icon="insta"></svg></a><a href="https://www.youtube.com/channel/UC3Ye-TP1WKe6fuVvlyfW5vw" target="_blank" class="social-panel social-yt"><svg expr97="expr97" is="flexbe-icon" class="panel-soc-icon" icon="yt"></svg></a></div>',[{type:s.IF,evaluate:e=>"RU"===e.state.user.country,redundantAttribute:"expr93",selector:"[expr93]",template:e('<span class="footer-desc">  ( 10  21 )</span><span class="flexbe-text footer-phone">8 (800) 555-45-12</span>',[])},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr94",selector:"[expr94]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr95",selector:"[expr95]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr96",selector:"[expr96]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr97",selector:"[expr97]"}])}]}],attributes:[],redundantAttribute:"expr76",selector:"[expr76]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"user-mail",evaluate:e=>e.state.user.mail},{type:t.ATTRIBUTE,name:"user-image",evaluate:e=>e.state.user.avatar}],redundantAttribute:"expr98",selector:"[expr98]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="header"><span expr100="expr100" class="flexbe-title"> </span></div><div class="flexbe-list hoverable hoverable-background round-corners-bottom scrollable-content"><a class="flexbe-list-item" href="/admin/user/profile/"><span expr101="expr101" class="flexbe-text"> </span></a><template expr102="expr102"></template><a expr106="expr106" class="flexbe-list-item"><span expr107="expr107"> </span></a></div>',bindings:[{redundantAttribute:"expr100",selector:"[expr100]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.user.mail}]},{redundantAttribute:"expr101",selector:"[expr101]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::profile")}]},{type:s.IF,evaluate:e=>"owner"===e.state.user.role,redundantAttribute:"expr102",selector:"[expr102]",template:e('<a class="flexbe-list-item" href="/admin/user/pay/"><span expr103="expr103"> </span></a><a class="flexbe-list-item" href="/admin/user/pay/plan/"><span expr104="expr104"> </span></a><a class="flexbe-list-item" href="/admin/user/members/"><span expr105="expr105"> </span></a>',[{redundantAttribute:"expr103",selector:"[expr103]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::pay")}]},{redundantAttribute:"expr104",selector:"[expr104]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::pay_plan")}]},{redundantAttribute:"expr105",selector:"[expr105]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::account_members")}]}])},{redundantAttribute:"expr106",selector:"[expr106]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>["https://app.flexbe.com/admin/logout/?id=",e.state.user.id].join("")}]},{redundantAttribute:"expr107",selector:"[expr107]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::logout")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"tip",evaluate:e=>e.tr("menu::avatar_note")}],redundantAttribute:"expr99",selector:"[expr99]"}]),name:"flexbe-panel-project"};e($r.name,$r);const Br={css:null,exports:function(){return this},template:(e,t,s,i)=>e('<div expr0="expr0" is="flexbe-panel-project"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-panel flexbe-admin-panel admin-ui ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-panel-project",slots:[],attributes:[{type:t.ATTRIBUTE,name:"unreadUpdates",evaluate:e=>e.props.unreadUpdates},{type:t.ATTRIBUTE,name:"unreadSupport",evaluate:e=>e.props.unreadSupport},{type:t.ATTRIBUTE,name:"unreadLeads",evaluate:e=>e.props.unreadLeads}],redundantAttribute:"expr0",selector:"[expr0]"}]),name:"flexbe-admin-panel"};e(Br.name,Br),riot3.tag2("admin-breadcrumbs",'<virtual each="{route, deph in state.routes}" if="{deph <= state.index}"> <a class="style-link-ignore breadcrumb {first: (deph == 0), last: (deph && deph == (state.routes.length - 1)), sub: (deph > 0), active: (deph == state.index)}" href="{getHref(route)}" onclick="{onClick}"> {route.title} </a> <span class="delimiter" if="{(deph < state.index)}"> <svg class="flexbe-icon size-10" viewbox="0 0 10 10"> <path d="M6 5L2 1L3 0L8 5L3 10L2 9L6 5Z"></path> </svg> </span> </virtual>',"",'class="admin-breadcrumbs {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={oldRoutes:null,get routes(){return[...t.props.routes].filter((e=>e.title)).map((e=>({...e,title:it(e.title)})))},get index(){return null!=t.props.index?t.props.index:this.routes.length-1},get route(){return this.routes[this.index]}},this.watch={"state.routes":[s=>{const i=t.state.oldRoutes||s;(e.animate??!0)&&!Te(!1,i.map((e=>e.title)),s.map((e=>e.title)))&&(t.root.classList.remove("animate"),t.root.offsetHeight,t.root.classList.add("animate")),t.state.oldRoutes=s},{fireImmediately:!0}]},this.getHref=function(t){const s=e.base?e.base+t.path:t.path;return!!s&&s.replace(/\/{2,}/,"/")}.bind(this),this.onClick=function(t){t.preventUpdate=!0;const s=t.item.deph,i=this.state.routes[s];"function"==typeof i.onClick&&i.onClick(t,s,i),s!==this.state.index&&"function"==typeof e.onroute&&e.onroute(t,s,i)}.bind(this)})),riot3.tag2("page-progress-loader",'<div class="page-progress-bar" riot-style="width: {progress}%"></div>',"",'class="page-progress-loader state-{loading} {opts.class}"',(function(e){let t,s=!1,i=null;const a=this;function n(){const i=e.loading;clearTimeout(t),clearInterval(t),t=setTimeout((()=>{"progress"===i?(s=!0,a.setState("hide",0),t=setInterval((()=>{const e=Math.min(80,a.progress+80/15);a.setState("progress",e),e>=80&&clearInterval(t)}),100)):"done"===i&&s?(s=!1,a.setState("progress",90),t=setTimeout((()=>{a.setState("done",100)}),30)):(s=!1,a.setState("hide",0))}),50)}this.loading=e.loading,this.progress=0,this.setState=function(e,t){t=Math.ceil(t),this.update({progress:t,loading:e})}.bind(this),this.on("before-mount",(()=>{n()})),this.on("update",(()=>{i!==e.loading&&(i=e.loading,n())}))})),riot3.tag2("admin-save-text",'<div class="status-{currentStatus}"> <span class="saved-text">{opts.savedText}</span> <span class="saving-text">{opts.savingText || tr(\'main::save_text::saving\')}</span> <span class="success-text flexbe-success">{opts.successText || tr(\'main::save_text::success\')}</span> <span class="error-text flexbe-error">{opts.errorText || tr(\'main::error::default\')}</span> </div>',"",'class="admin-save-text {opts.class}"',(function(e){let t;this.lastStatus=e.status,this.currentStatus=e.status||"saved",this.on("update",(()=>{this.lastStatus!==e.status&&(clearTimeout(t),this.lastStatus=e.status,this.currentStatus=e.status||"saved","success"==e.status&&(t=setTimeout((()=>{this.update({currentStatus:"saved"})}),1500)))}))}));const Ur={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get currentValue(){return e.props.value},get list(){return e.props.list||[]},get currentItem(){return this.list.filter((e=>e.value===this.currentValue))[0]},get classNameStatus(){var t;return`flexbe-tag clickable ${null!=(t=e.props.class)?t:""}`},get styleStatus(){const e=this.currentItem.color;return`--tagBackground:${e};--tagBackgroundHover:${e};--tagColor: ${this.currentItem.textColor}`},get disabled(){return e.props.disabled||!1},get titleText(){return this.disabled?e.props.disabledText:this.currentValue}}},changeValue(e){this.props.action(e.value)}},template:(e,t,s,i)=>e('<div expr108="expr108"><span expr109="expr109" class="flexbe-text"> </span><svg class="flexbe-icon size-8 arrow-down" viewBox="0 0 8 5"><path d="M4 3L7 0L8 1L4 5L0 1L1 0L4 3Z"/></svg><div expr110="expr110" is="proxy" data-is="dropdown" position="center" trigger="click"></div></div>',[{redundantAttribute:"expr108",selector:"[expr108]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["status-tag ",e.state.classNameStatus].join("")},{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.state.styleStatus}]},{redundantAttribute:"expr109",selector:"[expr109]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.titleText}]},{type:s.IF,evaluate:e=>!e.state.disabled,redundantAttribute:"expr110",selector:"[expr110]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div expr111="expr111" class="dropdown-header mb10"></div><div class="flexbe-list borderless hoverable hoverable-background py5"><div expr113="expr113" class="flexbe-list-item"></div></div>',bindings:[{type:s.IF,evaluate:e=>e.props.title,redundantAttribute:"expr111",selector:"[expr111]",template:e('<div expr112="expr112" class="flexbe-title"> </div>',[{redundantAttribute:"expr112",selector:"[expr112]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.props.title}]}])},{type:s.EACH,getKey:null,condition:null,template:e('<span expr114="expr114" class="status-tag-label"></span><span expr115="expr115" class="flexbe-text ml10"> </span><q expr116="expr116" is="proxy" data-is="flexbe-tooltip"></q><svg expr117="expr117" class="flexbe-icon size-14" width="14" height="14" viewBox="0 0 14 14" fill="none" style="fill: none;margin-left: auto;" xmlns="http://www.w3.org/2000/svg"></svg>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.changeValue(e.item)}]},{redundantAttribute:"expr114",selector:"[expr114]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["color: ",e.item.color].join("")}]},{redundantAttribute:"expr115",selector:"[expr115]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.text}]},{type:s.IF,evaluate:e=>e.item.tipContent,redundantAttribute:"expr116",selector:"[expr116]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.item.tipContent}]}])},{type:s.IF,evaluate:e=>e.state.currentValue===e.item.value,redundantAttribute:"expr117",selector:"[expr117]",template:e('<path d="M12.3334 3L5.00002 10.3333L1.66669 7" stroke="#119A22" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>',[])}]),redundantAttribute:"expr113",selector:"[expr113]",itemName:"item",indexName:null,evaluate:e=>e.state.list}]}],attributes:[{type:t.ATTRIBUTE,name:"relative",evaluate:e=>e.root},{type:t.ATTRIBUTE,name:"position-to",evaluate:e=>e.root},{type:t.ATTRIBUTE,name:"autohide",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"min-width",evaluate:e=>243}]}])}]),name:"status-tag"};e(Ur.name,Ur);const Rr={css:null,exports:{setup(e,{initMobx:t}){t(),this.sprite=at("pages","admin")},changePlan(){flexbe.modals.bill.showPlanChange()}},template:(e,t,s,i)=>e('<div class="flexbe-bar rounded w100"><div class="upgrade-tariff-warning-bar__icon"><svg expr118="expr118" is="flexbe-icon" icon="locked"></svg></div><span expr119="expr119" is="raw" class="upgrade-tariff-warning-bar__content"></span><div expr120="expr120" class="flexbe-button filled is-dark large rounded upgrade-tariff-warning-bar__button"><span expr121="expr121" class="flexbe-text"> </span></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.props.class}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr118",selector:"[expr118]"},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::upgrade_tariff_warning::content_text")}],redundantAttribute:"expr119",selector:"[expr119]"},{redundantAttribute:"expr120",selector:"[expr120]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.changePlan}]},{redundantAttribute:"expr121",selector:"[expr121]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::upgrade_tariff_warning::button_text")}]}]),name:"upgrade-tariff-warning-bar"};e(Rr.name,Rr),riot3.tag2("admin-lead-actions-list",'<div class="status-list flexbe-list borderless hoverable hoverable-background"> <div class="flexbe-list-item" each="{status in statuses}" onclick="{selectAction.bind(null, status)}"> <span class="lead-status-label code-{status.value}"></span> <span class="flexbe-text">{status.title}</span> </div> </div> <hr class="flexbe-hr"> <div class="actions-list flexbe-list borderless" if="{actions.length}"> <div class="flexbe-list-item" each="{action in actions}" onclick="{selectAction.bind(null, action)}"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{tag.sprite}#{action.icon}"></use> </svg> <span class="flexbe-text">{action.title}</span> </div> </div>',"",'class="admin-lead-actions-list {opts.class}"',(function(e){const t=this.parent?this.parent.main||this.parent:this;this.tag=this,this.main=t,this.sprite=at("lead","admin"),this.statuses=Object.values(flexbe.admin.lead.statuses||[]),this.statuses=this.statuses.filter((e=>11!==e.value)),this.statuses=this.statuses.map((e=>Object.assign({action:"status",field:"lead_status"},e))),this.actions=[],e.readAction&&this.actions.push({action:"read",icon:"show",title:tr("admin::lead::actions::mark_read"),field:"lead_is_read",value:1}),e.unreadAction&&this.actions.push({action:"read",icon:"hide",title:tr("admin::lead::actions::mark_unread"),field:"lead_is_read",value:0}),e.removeAction&&this.actions.push({action:"remove",icon:"remove",title:tr("admin::lead::actions::delete"),field:"lead_status",value:11}),this.selectAction=function(t){t=Object.assign({},t),"function"==typeof e.onselect&&e.onselect(t)}.bind(this)})),riot3.tag2("admin-lead-status-tag",'<span class="flexbe-text">{statuses[lead.lead_status] && statuses[lead.lead_status].title || \'\'}</span> <svg if="{opts.editable}" class="flexbe-icon size-8 arrow-down" viewbox="0 0 8 5"> <path d="M4 3L7 0L8 1L4 5L0 1L1 0L4 3Z"></path> </svg> <dropdown if="{opts.editable}" position="center" autohide="{true}" append-to-body="{true}" onopen="{main.dropdownOpen}" onclose="{main.dropdownClose}" ref="dropdown"> <div class="dropdown-header lead-submenu-dropdown-header"> <div class="flexbe-title">{tr(\'admin::lead::actions::title\')}</div> </div> <div data-is="admin-lead-actions-list" read-action="{!tag.lead.lead_is_read}" unread-action="{tag.lead.lead_is_read}" view-action="{true}" remove-action="{tag.lead.lead_status !== 11}" onselect="{tag.setStatus}"> </div> </dropdown>',"",'class="flexbe-tag admin-lead-list-status lead-status-tag code-{lead.lead_status} {clickable: opts.editable}"',(function(e){const t=this.parent?this.parent.main||this.parent:this;this.tag=this,this.main=t,this.lead=e.lead,this.products=e.lead.lead_products,this.settings=e.lead.lead_products.settings||{},this.status=e.lead.lead_status,this.statuses=flexbe.admin.lead.statuses,this.setStatus=async function(e){if(!e||null==e.value)return;this.closeDropdown();"status"===e.action&&this.status!==e.value?await this.manageStatusChange(e):await this.updateLead(e),this.status=e.value}.bind(this),this.manageStatusChange=async function(t){if(2===this.status&&10===t.value){const s=1===this.settings.reserve?.enabled??!1,i=this.products.list.filter((e=>e.reservation&&e.reservation.quantity));s&&i.length?Zs.create({width:450,title:tr("admin::lead::actions::confirm_cancel::title"),clickOut:!0,cancel:!0,overlay:!0,riotTag:"admin-lead-status-confirm-cancelation-modal",props:{list:i},onClose:async s=>{await this.updateLead(t),"function"==typeof e.updateReservation&&e.updateReservation({id:item.reservation,quantity:s})}}):await this.updateLead(t)}else await this.updateLead(t)}.bind(this),this.updateLead=async function(s){const i={};i[s.field]=s.value;try{const a=this.lead.id||this.lead.lead_id,n=await flexbe.admin.lead.editLeads([a],i),r=n.data?.lead.lead_products||{};this.lead[s.field]=n.data.lead[s.field],t.update(),"function"==typeof e.setAction&&e.setAction(s),"function"==typeof e.updateLeadReserveStatus&&(e.updateLeadReserveStatus({inReserve:r.in_reserve,products:r.list}),this.products.list=r.list)}catch(e){if(e.message)return void toast.error(e.message);console.error(result)}}.bind(this),this.closeDropdown=function(){this.refs.dropdown.trigger("toggleDropdown",!1)}.bind(this)})),riot3.tag2("admin-lead-list",'<header> <div class="flexbe-title text-title"> {tr(\'admin::lead::list::title\')} </div> <div data-is="proxy" is="admin-lead-list-filters" sprite="{sprite}" params="{tag.state.params}" loaddata="{loadData}"></div> <div data-is="proxy" is="admin-lead-list-export" dropdown-open="{dropdownOpen}" dropdown-close="{dropdownClose}" params="{state.params}" sprite="{sprite}"></div> <div class="flexbe-separator"></div> <div data-is="admin-lead-list-counter" class="counter-block inline-box" clear-caches="{clearCaches}" load-data="{loadData}" page="{currentPage}" current="{state.params.limit}"></div> <div data-is="admin-lead-list-pagination" class="pagination-block inline-box ml10" page="{currentPage}" total="{totalPages}" load-data="{loadData}"></div> </header> <section class="lead-list"> <div class="lead-list--head"> <div class="tr"> <div class="th select"> <label data-is="flexbe-input" type="checkbox" disabled="{!leadList.length}" checked="{leadList.length && (selectedCount > 0)}" onchange="{selectAll}"></label> </div> <div if="{th.show}" class="th th-center {th.className}" riot-style="{getArrowStyle(th.id)}" date-name="{th.id}" each="{th in thList}" onmouseenter="{hover}" onmouseleave="{unhover}" onclick="{changeSort}"> <span class="arrow-wrap"> {th.text} <div if="{th.showArrow}" class="arrow-content {th.id === state.currentSort.name ? state.currentSort.value : \'\'}"> <svg data-is="proxy" is="flexbe-icon" size="10" sprite="{sprite}" icon="arrow-desc"></svg> <svg data-is="proxy" is="flexbe-icon" size="10" sprite="{sprite}" icon="arrow-asc"></svg> </div> </span> </div> </div> </div> <div class="lead-list--loading" if="{loading}"> <div class="loading-container"> <div data-is="proxy" is="flexbe-loader" class="size-large"></div> <div class="flexbe-text mx0 mt20">{tr(\'admin::lead::list::loading\')}</div> </div> </div> <div class="lead-list--empty" if="{!leadList.length && !loading}"> <span class="flexbe-text" if="{!hasFilter}">{tr(\'admin::lead::list::empty\')}</span> <virtual if="{hasFilter}"> <div class="flexbe-text mt20 mb10">{tr(\'admin::lead::list::not_found\')}</div> <div class="flexbe-button filled is-secondary small px15" onclick="{resetFilter}"> {tr(\'admin::lead::list::filter::reset\')} </div> </virtual> </div> <div class="lead-list--body" if="{leadList.length}"> <a class="tr lead-item {is-unread: !lead.lead_is_read, checked: lead.checked}" tabindex="0" each="{lead, index in leadList}" href="/admin/lead/view/?id={lead.id}" onclick="{clickLead}" onmousedown="{clickLead}" onmouseup="{clickLead}"> <span class="{lead-bg: true,                     unread: !lead.lead_is_read,                     first-unread: !lead.lead_is_read && (!leadList[index - 1] || leadList[index - 1].lead_is_read),                     last-unread: !lead.lead_is_read && (!leadList[index + 1] || leadList[index + 1].lead_is_read)}"> </span> <span class="td select"> <label data-is="flexbe-input" class="lead-check contrast" type="checkbox" checked="{lead.checked}" onclick="{selectItem}"></label> <span class="lead-id">{lead.lead_num}</span> </span> <span class="td status"> <span data-is="admin-lead-status-tag" lead="{lead}" editable="{true}" set-action="{setLeadAction}"></span> </span> <span class="td pay" if="{showPayColumn}"> <span data-is="admin-lead-list-pay" if="{lead.lead_pay.pay_id}" pay="{lead.lead_pay}" sprite="{sprite}"></span> <span if="{!lead.lead_pay.pay_id}"></span> </span> <span class="td customer">{lead.lead_client_name || \'\'}</span> <span class="td contact">{lead.lead_client_phone || lead.lead_client_email || \'\'}</span> <span class="td products" if="{showProductColumn}"> <span data-is="admin-lead-list-products" if="{lead.lead_products && lead.lead_products.list.length}" sprite="{sprite}" prevent-event="{preventEvent}" products="{lead.lead_products}" currency-data="{lead.lead_currency}"></span> </span> <span class="td source"> <span class="mr20">{lead.lead_form_name || \'\'}</span> <span class="text-shade-45 text-medium"> {htmlspecialchars(lead.page_title, true) || \'\'} </span> </span> <span class="td date" title="{lead.lead_time_full}">{lead.lead_time_text || \'\'}</span> </a> </div> <div class="lead-list--footer" if="{leadList.length}"> <div data-is="admin-lead-list-pagination" if="{+totalPages > 1}" class="pagination-block inline-box" page="{currentPage}" total="{totalPages}" load-data="{loadData}"></div> </div> </section> <footer data-is="admin-lead-list-actionbar" class=" {show: selectedCount}" dropdown-open="{dropdownOpen}" dropdown-close="{dropdownClose}" lead-list="{leadList}" set-lead-action="{setLeadAction}" select-all="{selectAll}" sprite="{sprite}"></footer>',"",'class="admin-content admin-lead-list container fluid fade-in-animation {loading: loading, overlayed: dropdownOpened, has-selected: selectedCount}"',(function(e){this.mixin("initMobx");const t=this,s=new Map;this.tag=t,this.main=this,this.sprite=at("lead","admin"),this.filtersSprite=at("filters","admin"),this.htmlspecialchars=st,this.loading=!0,this.leadList=[],this.showPayColumn=0,this.showProductColumn=0,this.leadStart=1,this.totalLeads=0,this.selectedCount=0,this.state={params:null,currentSort:{name:"",value:""}},this.thList=[{id:"LeadStatus",className:"status",text:tr("admin::lead::column::status"),show:!0,showArrow:!1},{id:"PaymentStatus",className:"pay",text:tr("admin::lead::column::payment"),show:t.showPayColumn,showArrow:!1},{id:"ClientName",className:"customer",text:tr("admin::lead::column::customer"),show:!0,showArrow:!1},{id:"",className:"contact",text:tr("admin::lead::column::contact"),show:!0,showArrow:!1},{id:"",className:"products",text:"",show:t.showProductColumn,showArrow:!1},{id:"",className:"source",text:`${tr("admin::lead::column::form")} / ${tr("admin::lead::column::page")}`,show:!0,showArrow:!1},{id:"Date",className:"date",text:tr("admin::lead::column::date"),show:!0,showArrow:!1}],this.watch=[{"state.currentSort.name":[()=>this.update()],"state.currentSort.value":[()=>this.update()]}],this.getArrowStyle=function(e){return e?"cursor: pointer":""}.bind(this),this.hover=function(e){const t=$(e.target).attr("date-name");t&&(this.thlist=this.thList.map((e=>(e.id===t&&(e.showArrow=!0),e))))}.bind(this),this.unhover=function(e){const t=$(e.target).attr("date-name");t&&(this.thlist=this.thList.map((e=>(e.id===t&&e.id!==this.state.currentSort.name&&(e.showArrow=!1),e))))}.bind(this),this.changeSort=async function(e){const t=$(e.target),s=t.attr("date-name"),i=t.find(".arrow-content").hasClass("desc")?"asc":"desc";s&&(this.state.currentSort={name:s,value:i},this.thlist=this.thList.map((e=>(e.id!==s&&(e.showArrow=!1),e))),await this.loadData({page:1,sorting:{[s]:i}}),this.update())}.bind(this),this.updateSelectedCount=function(){this.update({selectedCount:this.leadList.filter((e=>e.checked)).length})}.bind(this);let i,a=0;this.selectAll=function(e){const t="object"==typeof e?e.target.checked:!!e;this.leadList.forEach((e=>{e.checked=t})),this.updateSelectedCount()}.bind(this),this.selectItem=function(e,t){e&&e.item&&(e=(t=e).item.lead),t instanceof Event&&(t.preventDefault(),t.stopPropagation());const s=t&&t.shiftKey,i=this.leadList.indexOf(e),n=s?a:i,r=Math.min(i,n),o=Math.max(i,n),l=!e.checked;this.leadList.filter(((e,t)=>t>=r&&t<=o)).forEach((e=>{e.checked=l})),a=i,this.updateSelectedCount()}.bind(this),this.loadData=async function(e,t,s=!0){const i=$.extend(!0,{},this.state.params),a=$.extend(!0,{},{limit:this.state.params.limit,...e});this.setParams(a,t),s&&this.update({loading:!0});const n=await flexbe.admin.lead.loadList(this.state.params);n?(this.setState(n),this.updateSelectedCount()):this.setParams(i,t),s&&(this.loading=!1),this.update()}.bind(this),this.resetFilter=async function(){await this.loadData({filter:{}})}.bind(this),this.clearCaches=function(){s.clear()}.bind(this),this.setLeadAction=function(){this.clearCaches(),this.update()}.bind(this),this.setParams=function(e,t,s="replace"){if(this.state.params=Object.assign({},t?{}:this.state.params,e),this.state.params.page||(this.state.params.page=1),this.state.params.limit||(this.state.params.limit=25),this.currentPage=this.state.params.page,this.hasFilter=this.state.params.filter&&Object.values(this.state.params.filter).some((e=>e&&e.length)),s){const e=ye(this.state.params,!0),t=`${location.pathname}?${e}`;"push"===s?history.pushState(null,"",t):history.replaceState(null,"",t)}}.bind(this),this.setState=function(e){this.loading=!1,this.totalLeads=e.lead_list.length||0,this.totalPages=e.lead_pages_total,this.leadList=e.lead_list,this.showPayColumn=e.show_payment_column||this.leadList.some((e=>e.lead_pay&&e.lead_pay.pay_id)),this.showProductColumn=e.show_product_column||this.leadList.some((e=>e.lead_products&&e.lead_products.count)),this.thList[1].show=this.showPayColumn,this.thList[4].show=this.showProductColumn,this.update()}.bind(this),this.dropdownOpen=function(e){clearTimeout(i),this.update({dropdownOpened:!0})}.bind(this),this.dropdownClose=function(e){clearTimeout(i),i=setTimeout((()=>{this.update({dropdownOpened:!1})}),100)}.bind(this);let n,r,o,l,d=!1;this.clickLead=function(e){if(!e.target.closest(".lead-check"))if(e.target.closest(".toggle-helper"))this.preventEvent(e);else if("click"===e.type){const t=this.dropdownOpened,s=this.selectedCount;if((d||t||s)&&(d=!1,this.preventEvent(e)),s){const t=e.item.lead;this.selectItem(t,{shiftKey:e.shiftKey})}}else"mousedown"===e.type?(n=e.x,r=e.y,d=!1):"mouseup"===e.type&&(o=e.x,l=e.y,d=Math.sqrt((o-n)**2+(l-r)**2)>7)}.bind(this),this.preventEvent=function(e){e.preventDefault()}.bind(this);const c=async()=>{1===this.currentPage&&await this.loadData(this.state.params,!1,!1)};this.onBeforeMount=async function(){if(this.setParams(_e(location.search)),e.dataJson){const t=JSON.parse(e.dataJson),i=JSON.stringify(this.state.params);s.set(i,t),this.setState(t)}else await this.loadData();this.syncSorting()}.bind(this),this.onUpdated=function(){this.syncSorting()}.bind(this),this.syncSorting=function(){if(this.state.params.sorting&&Object.keys(this.state.params.sorting).length){const e=this.state.params.sorting;Object.entries(e).forEach((([e,t])=>{this.state.currentSort.name=e,this.state.currentSort.value=t})),this.thList.map((e=>(e.showArrow=e.id===this.state.currentSort.name,e)))}else this.thList.map((e=>(e.showArrow=!1,e))),this.state.currentSort.name="",this.state.currentSort.value=""}.bind(this),this.onMounted=function(){this.socket=Ir.create(),this.root.removeAttribute("data-json"),this.socket.on("message",(e=>{"leads_unread_cnt"===e.event&&parseInt(e.site.group_id,10)===parseInt(flexbe.vars.group.id,10)&&c()})),fs.register([{hotkeys:["escape"],handlerDown:()=>this.selectAll(!1)}])}.bind(this)})),riot3.tag2("admin-lead-list-actionbar",'<div class="actions-button"> <span class="flexbe-text">{tr(\'admin::lead::actions::title\')}</span> <svg class="flexbe-icon size-10"> <use riot-xlink:href="{opts.sprite}#select"></use> </svg> <dropdown position="center" direction="top" autohide="{true}" onopen="{opts.dropdownOpen}" onclose="{opts.dropdownClose}"> <div class="dropdown-header"> <div class="flexbe-title">{tr(\'admin::lead::actions::title\')}</div> </div> <div data-is="admin-lead-actions-list" read-action="{tag.showAction(\'read\')}" unread-action="{tag.showAction(\'unread\')}" remove-action="{tag.showAction(\'remove\')}" onselect="{tag.setAction}"> </div> </dropdown> </div> <div class="flexbe-button large rounded is-primary" onclick="{closeBar}"> <span class="flexbe-text">{tr(\'main::button::close\')}</span> </div>',"",'class="admin-lead-list-actionbar {opts.class}"',(function(e){this.tag=this,this.showAction=function(t){const s=e.leadList.filter((e=>e.checked));return"read"==t?s.some((e=>!e.lead_is_read)):"unread"==t?s.some((e=>e.lead_is_read)):"remove"!=t||!s.every((e=>11==e.lead_status))}.bind(this),this.setAction=function(t){const s=t.field,i=t.value,a={[s]:i},n=e.leadList.filter((e=>e.checked)),r=n.map((e=>e.id));n.forEach((e=>{e[`${s}_bak`]=e[s],e[s]=i})),flexbe.admin.lead.editLeads(r,a).then((t=>{toast.success(tr("admin::lead::list::changes_saved")),e.setLeadAction()})).catch((t=>{toast.error(t.message),n.forEach((e=>{e[s]=e[`${s}_bak`],delete e[`${s}_bak`]})),e.setLeadAction()}))}.bind(this),this.closeBar=function(){e.selectAll(!1)}.bind(this)})),riot3.tag2("admin-lead-list-counter",'<div class="flexbe-button filled rounded is-secondary"> <div class="flexbe-text text-medium">{opts.current}</div> <svg viewbox="0 0 10 6" class="flexbe-icon size-8"> <path d="M5 4L9 -4.37114e-08L10 1L5 6L-4.37114e-08 1L1 -3.93402e-07L5 4Z"></path> </svg> <div data-is="dropdown" class="menu-list" position="center" arrow="{false}" append-to-body="{false}"> <div class="flexbe-list hoverable borderless hoverable-background round-corners"> <div class="flexbe-list-item justify-content-between" each="{count in tag.meta.list}" onclick="{tag.counterHandle.bind(tag, count.value)}"> <span class="flexbe-text"> {count.title} </span> <svg if="{count.value === tag.opts.current}" class="flexbe-icon size-14" width="14" height="14" viewbox="0 0 14 14" fill="none" style="fill: none" xmlns="http://www.w3.org/2000/svg"> <path d="M12.3334 3L5.00002 10.3333L1.66669 7" stroke="#119A22" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </div> </div> </div> </div>',"",'class="admin-lead-list-counter {opts.class}"',(function(e){this.meta={get list(){return[{value:25,title:25},{value:100,title:100},{value:250,title:250}]}},this.counterHandle=function(t){if(t==e.current)return;const s=e.current,i=e.page*s-s+1,a=t,n=Math.ceil(i/a);e.clearCaches(),e.loadData({page:n,limit:a})}.bind(this)}));const Pr=async()=>{const e=`/admin/api/project/${flexbe.vars.group.id}/lead/export/list/`;return await ai(e)},Hr=async e=>{const t=`/admin/api/project/${flexbe.vars.group.id}/lead/export/`;return await ii(t,{asJson:!0,data:e})},jr={id:"placeholder"},Fr={css:null,exports:{setup(e,{initMobx:t}){t(),this.sprite=e.props.sprite,this.state={files:[],contentTip:tr("admin::lead::export::tip"),get hasFiles(){return this.files.length>0}},this.watch={"state.files":()=>this.update(),"state.hasFiles":()=>this.update()}},async createFile(e){const{params:t}=this.props,s=this.root.querySelector(".lead-export-types");try{s.style.pointerEvents="none",this.addFile(jr);const i=await Hr({type:e,filter:t.filter,sorting:t.sorting});this.addFile(i,!0)}catch(e){toast.error(e.message),console.error(e)}finally{s.style.pointerEvents="all"}},async openDropdown(){this.toggleHoverClassBtn(!0),this.state.files=[],await this.loadFiles(),this.props.dropdownOpen()},closeDropdown(){this.toggleHoverClassBtn(!1),this.props.dropdownClose()},toggleHoverClassBtn(e){const t=this.root.querySelector(".flexbe-button.is-secondary");this.state.contentTip=e?"":tr("admin::lead::export::tip"),t.classList.toggle("hover",e)},async loadFiles(){try{let e=await Pr();this.state.files=this.getSortedFiles(e)}catch(e){toast.error(e.message),console.error(e)}},addFile(e,t=!1){let s;if(s=this.state.files.some((t=>t.id===e.id))?this.state.files.map((t=>t.id===e.id?{...t,...e}:t)):[e,...this.state.files],t){const e=s.findIndex((e=>"placeholder"===e.id));-1!==e&&s.splice(e,1)}this.state.files=this.getSortedFiles(s)},getSortedFiles(e){return[...e.filter((e=>"placeholder"===e.id)),...ge(e.filter((e=>"placeholder"!==e.id&&this.isCorrectTime(e))),{id:"DESC"})]},isCorrectTime:e=>(Ze({date:new Date,timezone:flexbe.vars.group.timezone})-Ze({date:new Date(Je(e.created_at.date)),timezone:flexbe.vars.group.timezone}))/36e5<24,onUpdated(){Wt(this.root)},async onMounted(){Wt(this.root),this.socket=Ir.create(),this.root.removeAttribute("data-json"),this.socket.on("message",(e=>{"generate_file"===e.event&&parseInt(e.site.group_id,10)===parseInt(flexbe.vars.group.id,10)&&"lead"===e.msg_data.type&&("success"===e.msg_data.status&&this.addFile(e.msg_data,!0),this.update())}))}},template:(e,t,s,i)=>e('<div expr698="expr698" class="flexbe-button filled is-secondary rounded"><svg expr699="expr699" is="flexbe-icon" class="m0" size="16" icon="file-download"></svg><div expr700="expr700" is="proxy" data-is="dropdown" position="center"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-lead-list-export ",e.props.class].join("")}]},{redundantAttribute:"expr698",selector:"[expr698]",expressions:[{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.state.contentTip}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr699",selector:"[expr699]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="dropdown-header"><div expr701="expr701" class="flexbe-title"> </div><div expr702="expr702" class="flexbe-desc"> </div></div><div expr703="expr703"><div expr704="expr704" class="flexbe-list-item type-xlsx"><span expr705="expr705" class="flexbe-text"> </span></div><div expr706="expr706" class="flexbe-list-item"><span expr707="expr707" class="flexbe-text"> </span></div></div><div expr708="expr708" class="flexbe-title pt15 px20"></div><div expr709="expr709" is="flexbe-scrollable"></div>',bindings:[{redundantAttribute:"expr701",selector:"[expr701]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::export::title")}]},{redundantAttribute:"expr702",selector:"[expr702]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::export::desc_filter")}]},{redundantAttribute:"expr703",selector:"[expr703]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list opacify hoverable hoverable-background lead-export-types ",e.state.hasFiles?"last-item-underline":""].join("")}]},{redundantAttribute:"expr704",selector:"[expr704]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.createFile("xlsx")}]},{redundantAttribute:"expr705",selector:"[expr705]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::export::to_xls")}]},{redundantAttribute:"expr706",selector:"[expr706]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.createFile("csv")}]},{redundantAttribute:"expr707",selector:"[expr707]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::export::to_csv")}]},{type:s.IF,evaluate:e=>e.state.hasFiles,redundantAttribute:"expr708",selector:"[expr708]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::export::last_export")}]}])},{type:s.IF,evaluate:e=>e.state.hasFiles,redundantAttribute:"expr709",selector:"[expr709]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-scrollable",slots:[{id:"default",html:'<div class="flexbe-list file-list hoverable hoverable-background"><a expr710="expr710" is="lead-list-export-item"></a></div>',bindings:[{type:s.EACH,getKey:null,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"lead-list-export-item",slots:[],attributes:[{type:t.ATTRIBUTE,name:"file",evaluate:e=>e.file},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}]}]),redundantAttribute:"expr710",selector:"[expr710]",itemName:"file",indexName:null,evaluate:e=>e.state.files}]}],attributes:[]}])}]}],attributes:[{type:t.EVENT,name:"onopen",evaluate:e=>e.openDropdown},{type:t.EVENT,name:"onclose",evaluate:e=>e.closeDropdown},{type:t.ATTRIBUTE,name:"autohide",evaluate:e=>!1}],redundantAttribute:"expr700",selector:"[expr700]"}]),name:"admin-lead-list-export"};e(Fr.name,Fr),riot3.tag2("admin-lead-list-pagination",'<div class="flexbe-button is-secondary filled rounded" disabled="{opts.page <= 1}" onclick="{paginationHandle.bind(null, \'prev\')}"> <svg class="flexbe-icon size-10" viewbox="0 0 6 10"> <path d="M2 5L6 1L5 0L0 5L5 10L6 9L2 5Z"></path> </svg> </div> <span class="flexbe-title caption"> {tr(\'admin::lead::products::pagination\', {             page: Math.max(1, opts.page),             pages: Math.max(1, opts.total)         })} </span> <div class="flexbe-button is-secondary filled rounded" disabled="{opts.page >= opts.total}" onclick="{paginationHandle.bind(null, \'next\')}"> <svg class="flexbe-icon size-10" viewbox="0 0 6 10"> <path d="M4 5L0 1L1 0L6 5L1 10L0 9L4 5Z"></path> </svg> </div>',"",'class="admin-lead-list-pagination {opts.class}"',(function(e){this.paginationHandle=function(t){$("html, body").scrollTop(0),e.loadData({page:"next"==t?e.page+1:e.page-1})}.bind(this)})),riot3.tag2("admin-lead-list-pay",'<svg class="flexbe-icon size-20"> <use riot-xlink:href="{opts.sprite}#pay-status-{tag.state.payStatus}"></use> </svg> <span class="flexbe-text">{opts.pay.pay_sum_text || \'\'}</span>',"",'class="admin-lead-list-pay pay-status-{tag.state.payStatus}"',(function(e){this.tag=this,this.state={get payStatus(){return 1==+e.pay.pay_status?0:e.pay.pay_status||0}}})),riot3.tag2("admin-lead-list-products",'<svg class="flexbe-icon size-20"> <use riot-xlink:href="{opts.sprite}#cart"></use> </svg> <dropdown data-scope="products" position="center" trigger="hover" onclick="{opts.preventEvent}"> <div class="dropdown-header"> <div class="flexbe-title">{tr(\'admin::lead::products::title\')}</div> </div> <div class="flexbe-list spaceless px20"> <div class="flexbe-list-item" each="{product in tag.products.list}"> <div class="base-info"> <span class="flexbe-text product-title"> {product.title} </span> <span class="flexbe-text product-price"> {(product.count !== 1 ? product.count + \'&nbsp;x&nbsp;\' : \'\') + tag.getFormattedPrice(product.price)} </span> </div> <div if="{product.optionsValues?.length}" class="product-options"> <virtual each="{value, index in product.optionsValues}"> <span if="{value.color && value.color !== \'false\'}" class="product-options-color" riot-style="background-color: {value.color}"></span> {value.name}<virtual if="{index !== product.optionsValues.length - 1}">,</virtual> </virtual> </div> </div> </div> <div class="dropdown-footer inline-box text-medium"> <span class="products-summary">{tr(\'admin::lead::products::in_total_label\')}</span> <span class="products-price">{tag.products.sum_text}</span> </div> </dropdown>',"",'class="admin-lead-list-products {opts.class}"',(function(e){this.products=e.products,this.currencyFormat=Object.assign({},flexbe.vars.group.currency_format),this.getFormattedPrice=function(t){return mt(t,this.currencyFormat,e.currencyData)}.bind(this)}));const Lr={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={sortList:[],showResetSort:!1,get props(){return e.props},get params(){return this.props.params||{}},get filterCount(){return me(this.sortList).length},get showResetFilter(){return this.filterCount>0}},this.meta={get sprite(){return e.props.sprite},get filterList(){return[{component:"admin-lead-submenu-list",data:this.leadStatus},{component:"admin-lead-submenu-list",data:this.read},{component:"admin-lead-submenu-list",data:this.paymentStatus},{component:"admin-lead-submenu-number-amount",data:this.numberLead},{component:"admin-lead-submenu-date",data:this.date},{component:"admin-lead-submenu-number-amount",data:this.sum},{component:"admin-lead-submenu-name-email-phone",data:this.clientName},{component:"admin-lead-submenu-name-email-phone",data:this.clientPhone},{component:"admin-lead-submenu-name-email-phone",data:this.clientEmail}]},get numberLead(){return{name:tr("admin::lead::list::filter::number"),id:"number",icon:`${this.sprite}#Number`}},get sum(){return{name:tr("admin::lead::list::filter::amount"),id:"amount",icon:`${this.sprite}#Amount`}},get clientName(){return{name:tr("admin::lead::list::filter::client_name"),id:"ClientName",icon:`${this.sprite}#ClientName`,inputProps:{type:"text","max-length":100,placeholder:tr("admin::lead::list::filter::client_name_placeholder")}}},get clientEmail(){return{name:tr("admin::lead::list::filter::client_email"),id:"ClientEmail",icon:`${this.sprite}#ClientEmail`,inputProps:{type:"text","max-length":100,placeholder:tr("admin::lead::list::filter::client_email_placeholder")}}},get clientPhone(){return{name:tr("admin::lead::list::filter::client_phone"),id:"ClientPhone",icon:`${this.sprite}#ClientPhone`,inputProps:{"max-length":15,placeholder:tr("admin::lead::list::filter::client_phone_placeholder")}}},get date(){return{name:tr("admin::lead::list::filter::date"),id:"Date",icon:`${this.sprite}#Date`}},get read(){return{name:tr("admin::lead::list::filter::read::name"),id:"Read",icon:`${this.sprite}#Read`,list:[{value:0,title:tr("admin::lead::list::filter::read::not_viewed")},{value:1,title:tr("admin::lead::list::filter::read::viewed")}]}},get leadStatus(){return{name:tr("admin::lead::list::filter::lead_status::name"),id:"LeadStatus",icon:`${this.sprite}#LeadStatus`,list:Object.values(flexbe.admin.lead.statuses).map((e=>Object.assign({},e)))}},get paymentStatus(){return{name:tr("admin::lead::list::filter::payment_status::name"),id:"PaymentStatus",icon:`${this.sprite}#PaymentStatus`,list:[{value:0,title:tr("admin::lead::list::filter::payment_status::not_need")},{value:1,title:tr("admin::lead::list::filter::payment_status::wait")},{value:2,title:tr("admin::lead::list::filter::payment_status::paid")},{value:3,title:tr("admin::lead::list::filter::payment_status::error")}]}},get sort(){return{name:tr("admin::lead::list::filter::sorting::name"),id:"sorting",icon:`${this.sprite}#sorting`,list:[{value:"empty",title:tr("admin::lead::list::filter::sorting::not_chosen"),showArrow:!1},{value:"LeadStatus",title:tr("admin::lead::list::filter::lead_status::name"),showArrow:!1},{value:"PaymentStatus",title:tr("admin::lead::list::filter::payment_status::name"),showArrow:!1},{value:"ClientName",title:tr("admin::lead::list::filter::client_name"),showArrow:!1},{value:"Amount",title:tr("admin::lead::list::filter::amount"),showArrow:!1},{value:"Date",title:tr("admin::lead::list::filter::date"),showArrow:!1}]}}},this.watch={"state.showResetFilter":()=>this.update(),"state.showResetSort":()=>this.update()}},async resetFilter(){var e;const t=null==(e=this.state.params)?void 0:e.filter;t&&Object.keys(t).length&&await this.state.props.loaddata({filter:{}})},updateSortCount(e,t){t?this.state.sortList.push(e):this.state.sortList=this.state.sortList.filter((t=>t!==e))},updateSortList(){const{filter:e}=_e(location.search);let t=e?Object.keys(e):[];e&&e.DateFrom&&e.DateTo&&(t=t.filter((e=>"DateTo"!==e))),e&&e.amountMin&&e.amountMax&&(t=t.filter((e=>"amountMax"!==e))),e&&e.numberMin&&e.numberMax&&(t=t.filter((e=>"numberMax"!==e))),this.state.sortList=t},onUpdated(){const{params:e}=this.state;this.updateSortList(),this.state.showResetSort=!(null==e||!e.sorting)&&Object.keys(e.sorting).length},onBeforeMount(){this.updateSortList()}},template:(e,t,s,i)=>e('<div class="flexbe-button is-secondary filled rounded"><svg expr711="expr711" is="flexbe-icon" icon="filter-lead"></svg><span expr712="expr712" class="flexbe-text text-medium"> </span><span expr713="expr713" class="flexbe-desc ml5"></span><div expr714="expr714" is="proxy" data-is="dropdown" balloon-class="lead-list-filters-dropdown" position="end"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-lead-list-filters ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.props.sprite}],redundantAttribute:"expr711",selector:"[expr711]"},{redundantAttribute:"expr712",selector:"[expr712]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::list::filter::name")}]},{type:s.IF,evaluate:e=>e.state.filterCount>0,redundantAttribute:"expr713",selector:"[expr713]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>["(",e.state.filterCount,")"].join("")}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="flexbe-list hoverable hoverable-background borderless vertical-gaps"><div expr715="expr715" is="admin-lead-submenu-sort"></div><hr class="flexbe-hr filter-hr-gaps"/><div class="flexbe-list-item"><span expr716="expr716" class="flexbe-title"> </span><div expr717="expr717" class="flexbe-desc item-addon"></div></div><div expr718="expr718"></div></div>',bindings:[{type:s.TAG,getComponent:i,evaluate:e=>"admin-lead-submenu-sort",slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.meta.sort},{type:t.ATTRIBUTE,name:"params",evaluate:e=>e.state.params},{type:t.ATTRIBUTE,name:"loadData",evaluate:e=>e.props.loaddata},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.props.sprite},{type:t.ATTRIBUTE,name:"updateSortCount",evaluate:e=>e.updateSortCount}],redundantAttribute:"expr715",selector:"[expr715]"},{redundantAttribute:"expr716",selector:"[expr716]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::list::filter::name")}]},{type:s.IF,evaluate:e=>e.state.showResetFilter,redundantAttribute:"expr717",selector:"[expr717]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::lead::list::filter::dropping")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.resetFilter}]}])},{type:s.EACH,getKey:null,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>e.filter.component,slots:[],attributes:[{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.filter.data},{type:t.ATTRIBUTE,name:"params",evaluate:e=>e.props.params},{type:t.ATTRIBUTE,name:"loadData",evaluate:e=>e.props.loaddata},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.props.sprite},{type:t.ATTRIBUTE,name:"updateSortCount",evaluate:e=>e.updateSortCount}]}]),redundantAttribute:"expr718",selector:"[expr718]",itemName:"filter",indexName:null,evaluate:e=>e.meta.filterList}]}],attributes:[{type:t.ATTRIBUTE,name:"arrow",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"relative",evaluate:e=>e.root},{type:t.ATTRIBUTE,name:"position-to",evaluate:e=>e.root},{type:t.ATTRIBUTE,name:"min-width",evaluate:e=>240}],redundantAttribute:"expr714",selector:"[expr714]"}]),name:"admin-lead-list-filters"};e(Lr.name,Lr),riot3.tag2("admin-lead-view",'<header> <div data-is="admin-breadcrumbs" class="pages-breadcrumbs text-title" routes="{meta.breadcrumbs}" animate="{false}"></div> <div data-is="admin-lead-pagination" prev-lead-id="{state.prevLeadId}" next-lead-id="{state.nextLeadId}"></div> <div data-is="admin-lead-status-tag" lead="{state.lead}" editable="{true}" set-action="{setLeadAction}" update-lead-reserve-status="{updateLeadReserveStatus}"></div> <span class="flexbe-desc text-s lead-time"> {state.timeFormat} </span> </header> <div class="row gap-dynamic"> <div class="col main-area group-list"> <div class="group-item" data-is="admin-lead-view-form" if="{state.showForm}" lead="{state.lead}" sprite="{meta.sprite}" edit-field="{editField}"></div> <div class="group-item" data-is="admin-lead-view-products" if="{state.showProducts}" lead="{state.lead}" products="{state.productsList}" lead-in-reserve="{state.leadInReserve}" currency-format="{state.currencyFormat}" currency-data="{state.currencyData}" sprite="{meta.sprite}" edit-field="{editField}" update-lead-reserve-status="{updateLeadReserveStatus}"></div> <div class="group-item" data-is="proxy" is="admin-lead-view-delivery" if="{state.showDelivery}" lead="{state.lead}" sprite="{meta.sprite}"></div> <div class="group-item" data-is="admin-lead-view-note" lead="{state.lead}" edit-field="{editField}"></div> <div class="group-item" data-is="admin-lead-view-utm" if="{state.showUtmSource}" utm="{state.utmData}"></div> </div> <div class="col side-area group-list"> <div class="group-item" data-is="admin-lead-view-total" if="{state.showTotal}" lead="{state.lead}" edit-field="{editField}" edit-promotion="{editPromotion}" remove-promotion="{removePromotion}"></div> <div class="group-item" data-is="admin-lead-view-pay" if="{state.showPayment}" pay="{state.pay}" sprite="{meta.sprite}" edit-field="{editField}"></div> <div class="group-item" data-is="admin-lead-view-source" if="{state.leadSource}" source="{state.leadSource}" sprite="{meta.sprite}"></div> </div> </div>',"",'class="admin-lead-view admin-content container wide"',(function(e){this.mixin("initMobx");const t=this;this.state={lead:{},productsList:[],leadInReserve:!1,prevLeadId:null,nextLeadId:null,currencyFormat:{...flexbe.vars.group.currency_format},get leadStatus(){return this.lead.lead_status},get currencyData(){return this.lead.lead_currency},get leadSource(){return this.lead.lead_source},get timeFormat(){return this.lead.lead_time_format_full||this.lead.lead_time_format||""},get utmData(){return this.lead.utm_data},get pay(){return this.lead.lead_pay},get promotions(){return Object.values(this.lead.lead_promotions||{})},get showForm(){return this.lead.lead_contacts.length||this.lead.lead_data.length},get showPayment(){return this.pay&&this.pay.pay_id},get showTotal(){return!!this.lead.lead_products.count},get showProducts(){return this.lead.lead_products&&this.lead.lead_products.list&&this.showPayment},get delivery(){return this.lead.lead_shipping},get showDelivery(){return!!(Array.isArray(this.delivery)?this.delivery.length:this.delivery)},get showUtmSource(){return this.utmData&&this.utmData.length}},this.meta={sprite:at("lead","admin"),breadcrumbs:[{title:tr("admin::lead::list::title"),path:"/admin/lead/"},{get title(){return`#${t.state.lead.lead_num}`}}]},this.watch=[{"state.leadStatus":[()=>this.update(),{delay:4}]}],this.editField=async function(e,t){const s="object"==typeof e?e:{[e]:t};let i;try{i=await flexbe.admin.lead.editLeads([this.state.lead.lead_id],s)}catch(e){i=e}return i instanceof Error?i:(this.setData(i.data),i.data)}.bind(this),this.removePromotion=async function(e){const t=this.state.promotions.findIndex((t=>t.type===e));return await flexbe.admin.lead.removePromotion(this.state.lead.lead_id,e),this.state.lead.lead_promotions.splice(t,1),this.recalculateTotalAmount(),this.state.lead.lead_promotions}.bind(this),this.editPromotion=async function(e){const{data:t}=await flexbe.admin.lead.editPromotion(this.state.lead.lead_id,e);return t&&(this.state.lead.lead_promotions=Object.values(t),this.recalculateTotalAmount()),t}.bind(this),this.setLeadAction=function(e){this.update(),["remove","read"].includes(e.action)&&(location.href="/admin/lead/")}.bind(this),this.setData=function(e){null!=e&&null!=e.lead&&(this.state.lead={...this.state.lead,...e.lead},this.state.productsList=this.state.lead.lead_products.list,this.state.leadInReserve=this.state.lead.lead_products.in_reserve,this.state.prevLeadId=e.prev_lead_id,this.state.nextLeadId=e.next_lead_id,this.update())}.bind(this),this.updateLeadReserveStatus=function({inReserve:e,products:t}){this.state.productsList=t,this.state.leadInReserve=e,this.update()}.bind(this),this.updateReservation=async function({id:e,quantity:t}){try{await PUT(`/admin/api/project/${flexbe.vars.group.id}/reservations/${this.state.product.reservation.id}/`)}catch(e){if(e.message)return void toast.error(e.message);console.error(e)}}.bind(this),this.recalculateTotalAmount=function(){const e=+this.state.delivery.price;if(this.state.promotions){const t=+this.state.lead.lead_products.sum;let s=this.state.promotions.length?this.state.promotions.reduce(((e,s)=>{const i=+s.discountAmount||+s.discount_amount;return e-("percent"===s.discountType?Math.round(t*i)/100:i)}),t):t;s=De(0,s+e,1/0),this.setData({lead:{lead_pay:{...this.state.pay,pay_sum:s,pay_sum_text:mt(s)}}})}}.bind(this),this.loadData=async function(){try{const e=await flexbe.admin.lead.loadList(this.params);e.data&&this.setData(e.data)}catch(e){if(e.message)return void toast.error(e.message);console.error(result)}}.bind(this),this.onBeforeMount=async function(){if(e.dataJson){const t=JSON.parse(e.dataJson);t.lead.lead_is_read=!0,this.setData(t)}else await this.loadData()}.bind(this),this.onMounted=function(){this.root.removeAttribute("data-json")}.bind(this)})),riot3.tag2("admin-lead-view-form",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text lead-name">{lead.lead_form_name || tr(\'admin::lead::default_form_name\')}</span> <div data-is="proxy" is="save-button" edit-mode="{true}" edit-text="{tr(\'admin::lead::view::contacts_edit_button\')}" show-edit="{!editMode}" show-save="{hasChanges}" show-cancel="{editMode}" on-edit="{toggleEdit}" on-save="{onSave}" on-cancel="{onCancel}" on-done="{onDone}" on-error="{onError}" observer="{saveObserver}"></div> </div> <div class="flexbe-white-box shadow flexbe-table"> <div class="tbody"> <div each="{contact in lead.lead_contacts}" if="{contact}" class="tr contact-item {collapsed: !contact.value && !editMode}"> <div class="th contact-name"> <span class="flexbe-text" data-is="flexbe-tooltip" type="{contact.type}" content="{contact.orig_name !== tag.fieldTitles[contact.type] ? contact.orig_name : false}"> {tag.fieldTitles[opts.type]} </span> </div> <virtual if="{!editMode}"> <div class="td contact-value"> <div class="flexbe-text"> {contact.value} </div> </div> <div class="td contact-link"> <virtual if="{contact.value}"> <a if="{contact.type === \'phone\'}" href="tel:{contact.value.replace(/[^\\d]/g, \'\')}" data-is="flexbe-tooltip" content="{tr(\'admin::lead::view::contact_call\')}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{opts.sprite}#call"></use> </svg> </a> <a if="{contact.type === \'email\' && contact.value.includes(\'@\')}" href="mailto:{contact.value}" target="_blank" data-is="flexbe-tooltip" content="{tr(\'admin::lead::view::contact_mail\')}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{opts.sprite}#mail"></use> </svg> </a> </virtual> </div> </virtual> <virtual if="{editMode}"> <div class="td contact-value"> <div data-is="flexbe-input" class="text-inherit" riot-value="{contact.value || \'\'}" disabled="{isSaving}" placeholder="{fieldPlaceholder[contact.type]}" oninput="{setField.bind(tag, contact, \'value\')}" onchange="{setField.bind(tag, contact, \'value\')}" onenter="{triggerSave}"></div> </div> </virtual> </div> <div each="{field in state.formData}" if="{field}" class="tr field-item"> <div class="th"> <div class="flexbe-text">{field.name}</div> </div> <div class="td"> <div if="{![\'checkbox\', \'file\', \'textarea\'].includes(field.type)}" class="flexbe-text"> {getFieldValue(field) || \'\'} </div> <pre if="{field.type === \'textarea\'}" class="flexbe-text">{getFieldValue(field) || \'\'}</pre> <div if="{field.type === \'checkbox\'}" class="flexbe-text">{getFieldValue(field) || \'\'}</div> <virtual if="{field.type === \'file\'}"> <ul if="{field.value && field.value.length}"> <li each="{file, index in field.value}"> <a class="flexbe-text" href="{file}" target="_blank" download> {tr(\'admin::lead::view::download_file_button\')} {index ? (index + 1) : \'\'} </a> </li> </ul> <div if="{!field.value || !field.value.length}" class="flexbe-text"> {tr(\'admin::lead::products::fail_not_upload_value\')} </div> </virtual> </div> </div> </div> </div>',"",'class="admin-lead-view-form {opts.class}"',(function(e){const t=this;this.lead=e.lead,this.state={get leadData(){return t.lead.lead_data??[]},get isNewDelivery(){return t.lead.lead_shipping??!1},get formData(){return this.isNewDelivery?this.leadData.filter((e=>"99999"!==e.id&&!String(e.id).includes("external"))):this.leadData}},this.editMode=!1,this.hasChanges=!1,this.isSaving=!1,this.saveObserver=At({}),this.fieldTitles={name:tr("editor::form::type_name_option"),email:tr("editor::form::type_email_option"),phone:tr("editor::form::type_phone_option"),text:tr("editor::form::type_text_option"),image:tr("editor::form::type_image_option"),textarea:tr("editor::form::type_textarea_option"),checkbox:tr("editor::form::type_checkbox_option"),select:tr("editor::form::type_select_option"),radio:tr("editor::form::type_radio_option"),file:tr("editor::form::type_file_option")},this.fieldPlaceholder={name:tr("admin::lead::products::name_placeholder"),email:tr("admin::lead::products::email_placeholder"),phone:tr("admin::lead::products::phone_placeholder")},this.setInitialContacts=function(){this.initialContacts=[],this.lead.lead_contacts.forEach((e=>{this.initialContacts.push({...e})}))}.bind(this),this.toggleEdit=function(){this.update({editMode:!this.editMode})}.bind(this),this.getFieldValue=function(e){let t=e.value;return"checkbox"===e.type?([!0,"on","true","yes",""].includes(e.value)?t=tr("admin::lead::products::checkbox_value_yes"):e.value&&!["off","false","no",""].includes(e.value)||(t=tr("admin::lead::products::checkbox_value_no")),t):t}.bind(this),this.setField=function(e,t,s){const i=e[t];let a=s.target?.value??"";e[t]=a,i!==a&&(this.hasChanges=!0)}.bind(this),this.onCancel=function(){this.lead.lead_contacts=[],this.initialContacts.forEach((e=>{this.lead.lead_contacts.push({...e})})),this.hasChanges=!1,this.editMode=!1,this.update()}.bind(this),this.onSave=async function(){if(!this.hasChanges)return this.lead;this.update({isSaving:!0});const t=$.extend(!0,[],this.lead.lead_contacts);return await e.editField("lead_contacts",t)}.bind(this),this.onDone=function(){this.editMode=!1,this.isSaving=!1,this.hasChanges=!1,this.setInitialContacts(),this.update()}.bind(this),this.onError=function(e){e.message?toast.error(e.message):console.error(e)}.bind(this),this.triggerSave=function(){this.hasChanges&&($("input").trigger("blur"),this.saveObserver.trigger("save"))}.bind(this),this.triggerCancel=function(){this.hasChanges&&($("input").trigger("blur"),this.saveObserver.trigger("cancel"))}.bind(this),this.onBeforeMount=function(){this.setInitialContacts()}.bind(this),this.onMounted=function(){this._hotkeysSaveDisposer=fs.register([{hotkeys:["cmd_s"],handlerDown:()=>t.triggerSave()}]),this._hotkeysCancelDisposer=fs.register([{hotkeys:["cmd_z"],handlerDown:()=>t.triggerCancel()}])}.bind(this),this.onUnmounted=function(){this._hotkeysSaveDisposer&&this._hotkeysSaveDisposer(),this._hotkeysCancelDisposer&&this._hotkeysCancelDisposer()}.bind(this)})),riot3.tag2("admin-lead-view-note",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::lead::view::notes::title\')}</span> <span class="flexbe-desc" data-is="admin-save-text" status="{saveState}"></span> </div> <div data-is="flexbe-input" type="textarea" rows="5" class="large shadow" placeholder="{tr(\'admin::lead::view::notes::placeholder\')}" riot-value="{htmlspecialchars(lead.lead_note, true)}" oninput="{onInput}" onchange="{onChange}"> </div>',"",'class="admin-lead-view-note {opts.class}"',(function(e){let t,s=e.lead.lead_note;this.lead=e.lead,this.htmlspecialchars=st,this.saveState="saved",this.onInput=function(e){this.saveNote(e.target.value,1e3)}.bind(this),this.onChange=function(e){this.saveNote(e.target.value,0)}.bind(this),this.saveNote=function(i,a=0){clearTimeout(t),i!=s||a?this.update({saveState:"saving"}):this.update({saveState:"success"}),t=setTimeout((()=>{i!=s?e.editField("lead_note",i).then((e=>{s=i,this.update({saveState:"success"})})).catch((e=>{this.update({saveState:"error"})})):this.update({saveState:"success"})}),a)}.bind(this)})),riot3.tag2("admin-lead-pagination",'<a class="flexbe-button is-secondary {filled: state.nextURL} rounded" disabled="{!state.nextURL}" href="{state.nextURL}"> <svg class="flexbe-icon size-10" viewbox="0 0 6 10"> <path d="M2 5L6 1L5 0L0 5L5 10L6 9L2 5Z"></path> </svg> </a> <a class="flexbe-button is-secondary {filled: state.prevURL} rounded" disabled="{!state.prevURL}" href="{state.prevURL}"> <svg class="flexbe-icon size-10" viewbox="0 0 6 10"> <path d="M4 5L0 1L1 0L6 5L1 10L0 9L4 5Z"></path> </svg> </a>',"",'class="admin-lead-pagination {opts.class}"',(function(e){this.state={prevURL:e.prevLeadId?`/admin/lead/view/?id=${e.prevLeadId}`:null,nextURL:e.nextLeadId?`/admin/lead/view/?id=${e.nextLeadId}`:null}})),riot3.tag2("admin-lead-view-pay",'<div class="flexbe-title text-subtitle">{tr(\'admin::lead::view::pay::title\')}</div> <div class="flexbe-white-card shadow rounded status-{state.payStatus || 0}"> <div class="lead-info-list"> <div class="lead-info-item {\'hoverable\': summInEdit}"> <div class="lead-info-item__title">{tr(\'admin::lead::view::pay::total_title\')}</div> <div class="lead-info-item__value">{state.pay.pay_sum_text || state.pay.pay_sum}</div> </div> <div class="lead-info-item" if="{!state.isFree}"> <div class="lead-info-item__title">{tr(\'admin::lead::view::pay::method\')}</div> <div class="lead-info-item__value"> {state.pay.pay_method_name || tr(\'admin::lead::view::pay::not_selected_info\')} </div> </div> <div class="lead-info-item" if="{!state.isFree && state.pay.pay_link}"> <div class="lead-info-item__title">{tr(\'admin::lead::view::pay::copy_title\')}</div> <div class="lead-info-item__value"> <div data-is="flexbe-button-copy" copy-class="transparent" done-class="transparent" if="{state.pay.pay_link}" riot-value="{state.pay.pay_link}" show-icon="{true}" show-icon-done="{true}" show-text="{true}" copy-text="{tr(\'admin::lead::view::pay::copy_button\')}"></div> </div> </div> </div> <div class="pay-status status-{state.payStatus} {editable: !state.isFree}"> <div class="pay-status-button"> <span class="flexbe-text">{state.pay.pay_statuses[state.payStatus]}</span> <svg class="flexbe-icon arrow-down" viewbox="0 0 8 5"> <path d="M4 3L7 0L8 1L4 5L0 1L1 0L4 3Z"></path> </svg> </div> <dropdown class="pay-status-dropdown" position="center" autohide="{true}"> <div class="dropdown-header"> <div class="flexbe-title">{tr(\'admin::lead::view::pay::set_status_title\')}</div> </div> <div class="flexbe-list opacify hoverable hoverable-background round-corners"> <div class="flexbe-list-item pay-status-{status} {active: (tag.state.payStatus == status)}" each="{status in [0, 2]}" onclick="{tag.applyStatus.bind(tag, status)}"> <svg class="flexbe-icon size-20"> <use riot-xlink:href="{tag.state.sprite}#pay-status-{status}"></use> </svg> <span class="flexbe-text">{tag.state.pay.pay_statuses[status]}</span> </div> </div> </dropdown> </div> </div>',"",'class="admin-lead-view-pay {opts.class}"',(function(e){let t=e.pay.pay_status;this.state={pay:e.pay,sprite:e.sprite,get payStatus(){return this.isFree?2:this.pay.pay_status||0},get currentSumm(){return parseFloat(this.pay.pay_sum)},get isFree(){return 0==+this.pay.pay_sum}},this.toggleSumm=function(e){const t="boolean"==typeof e?e:!this.summInEdit;t&&2==this.state.pay.pay_status||(this.update({summInEdit:t,currentSumm:parseFloat(this.state.pay.pay_sum)}),t&&setTimeout((()=>{$(this.root).find(".edit-summ input").trigger("focus")}),100))}.bind(this),this.editSumm=function(e){const t=e.target.value||"";this.update({currentSumm:t})}.bind(this),this.keydownHandle=function(e){13==e.which?this.applySumm():27==e.which&&this.toggleSumm(!1)}.bind(this),this.applySumm=function(){const t=parseFloat(e.pay.pay_sum),s=ut(this.state.currentSumm);s!=t?(this.update({summInSave:!0}),e.editField("lead_pay",{summ:s}).catch((e=>{toast.error(e.message)})).finally((()=>{this.update({summInSave:!1,summInEdit:!1})}))):this.toggleSumm(!1)}.bind(this),this.applyStatus=function(s){t!=s&&(this.state.pay.pay_status=s,this.update({summInEdit:!1}),e.editField("lead_pay",{status:s}).then((e=>{t=s})).catch((e=>{toast.error(e.message),this.state.pay.pay_status=t,this.update()})))}.bind(this),this.on("update",(()=>{this.state.pay!==e.pay&&(this.state.pay=e.pay)}))})),riot3.tag2("admin-lead-view-total",'<div class="flexbe-title text-subtitle inline-box total-title"> <span class="flexbe-text">{tr(\'admin::lead::view::total::title\')}</span> <div class="add-discount" if="{state.showAddPromotionButton && state.canEdit}"> <div class="flexbe-text add-discount-button">{tr(\'admin::lead::promotion::add_discount_link\')}</div> <dropdown position="center" autohide="{true}"> <div class="flexbe-list opacify hoverable hoverable-background round-corners"> <div class="flexbe-list-item" if="{tag.state.showAddPromocodeButton}" onclick="{tag.promocodeModal.bind(this, \'add\')}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.paySprite}#promocode"></use> </svg> <span class="flexbe-text">{tr(\'admin::lead::promotion::promocode::title\')}</span> </div> <div class="flexbe-list-item" if="{tag.state.showAddDiscountButton}" onclick="{tag.discountModal.bind(this, \'add\')}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.paySprite}#discount"></use> </svg> <span class="flexbe-text">{tr(\'admin::lead::promotion::discount::title\')}</span> </div> </div> </dropdown> </div> </div> <div class="flexbe-white-card shadow rounded"> <div class="lead-info-list"> <div class="lead-info-item"> <div class="lead-info-item__title">{tr(\'admin::lead::view::total::product::title\')}</div> <div class="lead-info-item__value">{state.productSumDisplayValue}</div> </div> <div class="lead-info-item {\'free-delivery\': state.isFreeDelivery}" if="{state.showDeliveryItem}"> <div class="lead-info-item__title">{tr(\'admin::lead::view::total::delivery::title\')}</div> <div class="lead-info-item__value">{state.deliverySumDisplayValue}</div> </div> <div class="lead-info-item" if="{state.discount}"> <div class="lead-info-item__title"> {tr(\'admin::lead::promotion::discount::title\')} <div class="promotion-value"> <span>{state.discountDisplayValue}</span> </div> </div> <div class="lead-info-item__value {\'editable hoverable\': state.canEdit}" onclick="{tag.discountModal.bind(this, \'edit\')}"> {state.discountCurrencyAmount} </div> </div> <div class="lead-info-item column promocode-amount" if="{state.promocode}"> <div class="lead-info-item__line"> <div class="lead-info-item__title" data-tip="{state.promocodeCode}"> {tr(\'admin::lead::promotion::promocode::title\')} <div class="promotion-value"> <span>{state.promocodeDisplayValue}</span> </div> </div> <div class="lead-info-item__value promocode-code {\'editable hoverable\': state.canEdit}" onclick="{tag.promocodeModal.bind(this, \'edit\')}"> <div class="promotion-value"> {state.promocodeCurrencyAmount} </div> </div> </div> <div class="lead-info-item__messege error" if="{tag.state.showPromocodeAmountError}"> {meta.promocodeAmountErrorText} </div> </div> <div class="lead-info-divider"></div> <div class="lead-info-item total"> <div class="lead-info-item__title">{tr(\'admin::lead::view::total::summary::title\')}</div> <div class="lead-info-item__value">{state.totalSumDisplayValue}</div> </div> </div> </div>',"",'class="admin-lead-view-total {opts.class}"',(function(e){this.paySprite=flexbe.lib.getSprite("pay","admin"),this.ecommerceSprite=flexbe.lib.getSprite("settings.ecommerce","admin");const t=this;this.state={get lead(){return e.lead},get promotions(){return Object.values(this.lead.lead_promotions)||[]},get discount(){return this.promotions.find((e=>"discount"===e.type))},get discountType(){return this.discount?.discount_type||this.discount?.discountType},get discountAmount(){return+(this.discount?.discount_amount||this.discount?.discountAmount||0)},get isPercentDiscount(){return"percent"===this.discountType},get discountDisplayValue(){return this.isPercentDiscount?`${this.discountAmount}%`:""},get discountCurrencyAmount(){return`- ${mt(this.isPercentDiscount?Math.round(this.productSum*this.discountAmount)/100:this.discountAmount,flexbe.vars.group.currency_format,this.leadCurrency)}`},get promocode(){return this.promotions.find((e=>"promocode"===e.type))},get promocodeType(){return this.promocode?.discount_type||this.promocode?.discountType},get promocodeAmount(){return+(this.promocode?.discount_amount||this.promocode?.discountAmount||0)},get isPercentPromocode(){return"percent"===this.promocodeType},get isCurrencyPromocode(){return"money"===this.promocodeType},get isDeliveryPromocode(){return"delivery"===this.promocodeType},get promocodeHasFreeDelivery(){return this.isDeliveryPromocode||this.promocode.delivery_free||this.promocode.deliveryFree},get promocodeCurrencyAmount(){return`- ${mt(this.isPercentPromocode?Math.round(this.productSum*this.promocodeAmount)/100:this.promocodeAmount,flexbe.vars.group.currency_format,this.leadCurrency)}`},get promocodeCode(){return this.promocode?.code||""},get promocodeDisplayValue(){return this.isPercentPromocode?`${this.promocodeAmount}%`:""},get delivery(){return this.lead.lead_shipping||this.lead.lead_products.list.find((e=>e.id.includes("delivery")))},get deliverySum(){return this.delivery?this.delivery.price:0},get productSum(){return this.lead.lead_products.sum},get productSumDisplayValue(){return this.lead.lead_products.sum_text},get leadCurrency(){return this.lead.lead_currency},get isFreeDelivery(){return this.delivery&&!Number(this.deliverySum)},get deliverySumDisplayValue(){return this.isFreeDelivery?tr("admin::lead::view::total::free_title"):mt(this.deliverySum,flexbe.vars.group.currency_format,this.leadCurrency)},get totalSumDisplayValue(){return this.lead.lead_pay.pay_sum_text},get showDeliveryItem(){return!!this.delivery},get showAddDiscountButton(){return!this.discount},get showAddPromocodeButton(){return!this.promocode},get showAddPromotionButton(){return(this.showAddDiscountButton||this.showAddPromocodeButton)&&0!==flexbe.vars.plans.ecommerce},get showPromocodeAmountError(){const e=+this.promocode?.activeFrom||0;return t.state.productSum<e},get canEdit(){return 0===this.lead.lead_pay.pay_status}},this.meta={get promocodeAmountErrorText(){const e=t.state.promocode?.activeFrom;return tr("admin::lead::promotion::amount_error",{amount:mt(e)})}},this.promocodeModal=function(e="add",t){if(!this.state.canEdit)return;const s=$(t.target).closest(".lead-info-item__value"),i=$(this.root).find(".lead-info-list");Zs.create({width:420,title:tr(`admin::lead::promotion::${e}_promocode::title`),clickOut:!0,cancel:!0,overlay:!0,shadow:!0,position:["center","center"],positionOffset:{x:20},target:i,component:"admin-lead-promotion-add-promocode-modal",props:{mode:e,code:this.state.promocodeCode,onSave:async e=>{const t=await ai(`/admin/api/project/${flexbe.vars.group.id}/ecommerce/promotion/code/${e}`);if(!t?.id)throw new Error("promocode_not_found");return await this.opts.editPromotion({...t,code:e,type:"promocode",active:!0})},onRemove:async()=>{await this.opts.removePromotion("promocode")}},onOpen:()=>{s.addClass("focus")},onClose:()=>{s.removeClass("focus")}})}.bind(this),this.discountModal=function(e,t){if(!this.state.canEdit)return;const s=$(t.target).closest(".lead-info-item__value"),i=$(this.root).find(".lead-info-list");Zs.create({width:420,title:tr(`admin::lead::promotion::${e}_discount::title`),clickOut:!0,cancel:!0,overlay:!0,shadow:!0,position:["center","center"],positionOffset:{x:20},target:i,component:"admin-lead-promotion-add-discount-modal",props:{mode:e,discountAmount:this.state.discountAmount,discountType:this.state.discountType,maxCurrencyAmount:this.state.productSum,onSave:async e=>await this.opts.editPromotion({...e,active:!0}),onRemove:async()=>{await this.opts.removePromotion("discount")}},onOpen:()=>{s.addClass("focus")},onClose:()=>{s.removeClass("focus")}})}.bind(this),this.onUpdated=function(){flexbe.tip.initArea(this.root)}.bind(this),this.onMounted=function(){flexbe.tip.initArea(this.root)}.bind(this)})),riot3.tag2("admin-lead-view-products",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::lead::products::title\')}</span> <div class="button-group"> <div data-is="admin-lead-view-reservation-button" if="{state.showReservationButtons && !state.inEdit}" show-add="{state.showAddReservationButton}" show-remove="{state.showRemoveReservationButton}" onadd="{addReservation}" onremove="{removeReservation}" ondone="{onReservationDone}" onerror="{onError}"></div> <div data-is="proxy" is="save-button" if="{state.statusAllowsEdit}" show-cancel="{state.hasChanges || state.inEdit}" show-save="{state.hasChanges || state.inEdit}" show-edit="{!state.inEdit && !state.hasChanges && !state.isSaving}" on-cancel="{onCancel}" on-save="{onSave}" on-edit="{setEditState}" on-done="{onDone}" on-error="{onError}" observer="{saveObserver}"></div> </div> </div> <div class="flexbe-white-box shadow p0"> <div class="products-head text-shade-45"> <div class="td photo">{tr(\'admin::lead::products::image_label\')}</div> <div class="td name">{tr(\'admin::lead::products::item_name\')}</div> <div class="td reservation" if="{state.settingsAllowReservation}"> {tr(\'admin::lead::products::reserve\')} </div> <div class="td count">{tr(\'admin::lead::products::qty_label\')}</div> <div class="td price"> {tr(\'admin::lead::products::price_label\')} </div> </div> <div class="products-table"> <virtual each="{product, index in state.productsList}"> <div data-is="admin-lead-view-products-item" product="{product}" currency-data="{tag.state.currencyData}" currency-format="{tag.state.currencyFormat}" lead-id="{tag.state.leadId}" lead-status="{tag.state.leadStatus}" lead-in-reserve="{tag.state.leadInReserve}" allow-edit="{tag.state.statusAllowsEdit && state.inEdit}" allow-reservation="{tag.state.settingsAllowReservation}" allow-preorder="{tag.state.settingsAllowPreorder}" show-remove-button="{tag.state.showRemoveButton}" has-changes="{tag.state.hasChanges}" in-edit="{state.inEdit}" on-set-changes="{setChanges.bind(tag)}" on-edit-product="{editProduct.bind(tag, product)}" on-save="{updateReserve.bind(tag, product)}" on-remove-product="{removeProduct.bind(tag, product)}" has-remove-product="{(state.productsList.length > 1)}" save-changes="{triggerSave}"></div> </virtual> <div if="{state.addingProduct}" data-is="proxy" is="flexbe-loader" class="size--small"></div> </div> <div class="products-footer font-ui"> <div class="td action {\'has-reservation\': state.settingsAllowReservation}"> <div if="{state.statusAllowsEdit}" data-is="proxy" is="admin-lead-view-products-add" on-add="{addProducts}"></div> <span if="{!state.settingsAllowReservation}" class="flexbe-text"> {tr(\'admin::lead::products::in_total_label\')}: </span> </div> <div class="td reservation text-right" if="{state.settingsAllowReservation}"> <span class="flexbe-text"> {tr(\'admin::lead::products::in_total_label\')}: </span> </div> <div class="td count"> {state.totalCount} </div> <div class="td price"> {state.totalPrice} </div> </div> </div>',"",'class="admin-lead-view-products {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.saveObserver=At({}),this.state={inEdit:!1,hasChanges:!1,isSaving:!1,addingProduct:!1,productsList:[],initialProductsList:[],get props(){return t.props},get products(){return this.props.products||{}},get currencyData(){return this.props.currencyData},get currencyFormat(){return this.props.currencyFormat},get lead(){return this.props.lead},get leadInReserve(){return this.props.leadInReserve},get leadId(){return this.lead.lead_id},get settings(){return this.lead.lead_products.settings||{}},get leadStatus(){return this.lead.lead_status},get payStatus(){return this.lead.lead_pay.pay_status},get totalCount(){return this.productsList.reduce(((e,t)=>e+Math.max(+t.count||0,0)),0)},get totalPrice(){return mt(this.productsList.reduce(((e,t)=>e+(+t.price*+t.count||0)),0),this.currencyFormat,this.currencyData)},get settingsAllowReservation(){return this.settings.reserve?.enabled??!1},get settingsAllowPreorder(){return"allow_preorder"===this.settings.out_of_stock_action??!1},get statusAllowsEdit(){return[0,1].includes(this.leadStatus)&&2!==this.payStatus},get statusAllowsReserve(){return[0,1,2].includes(this.leadStatus)},get showRemoveButton(){return this.statusAllowsReserve&&this.productsList.length>0&&2!==this.leadStatus},get showReservationButtons(){return this.statusAllowsReserve&&this.settingsAllowReservation&&!this.hasChanges&&!this.isSaving&&!this.inEdit&&this.productsList.some((e=>e.product?.id&&e.variant?.id&&!e.variant?.deleted_at))},get showAddReservationButton(){return!this.leadInReserve},get showRemoveReservationButton(){return this.leadInReserve}},this.watch={"state.leadStatus":[()=>this.update(),{deep:!0}],"state.products":[()=>this.syncData(),{deep:!0}]},this.getProductIndex=function(e){return this.state.productsList.findIndex((t=>t.id===e))}.bind(this),this.addProducts=async function(e,t){if("custom"===e)this.state.productsList.push(...t),this.setEditState(!0),this.setChanges(),$(this.root).find(".product-item__title input").last().focus();else{this.state.addingProduct=t.find((({productId:e,variantId:t})=>-1===this.getProductIndex(`product_${e}:${t}`))),this.setEditState(!0);const e=t.map((({variantId:e})=>e));(await this.loadEcommerceProduct(e)).forEach((e=>{const t=this.getProductIndex(e.id);-1===t?this.state.productsList.push(e):this.state.productsList[t]={...e,count:this.state.productsList[t].count+1}})),this.state.addingProduct=!1,this.update()}}.bind(this),this.loadEcommerceProduct=async function(e){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product_variant/list/`;return(await ii(t,{asJson:!0,data:{variants:e}})).map((e=>{const t=e.product,s=e.variant;return{id:`product_${t.id}:${s.id}`,product_id:t.id,variant_id:s.id,product:t,variant:s,count:1,title:t.name,price:s.price,options:t.options,reservation:null,images:this.getImage(e),price_text:mt(s.price),optionsValues:this.getOptionsValues(e)}}))}.bind(this),this.getImage=function(e){return"variant"===e.product.display_image?e.variant.images||[]:e.product.images||[]}.bind(this),this.getOptionsValues=function(e){const t=e.product.options,s=e.variant.option_values;return t&&s?s.map((e=>{const s=t.find((t=>t.id===e.option_id)),i=s.values.find((t=>t.id===e.value_id));if(!s||!i||!i.data)return;const a={name:i.name};return"color"===s.data?.type&&(a.color=i.data.color.toUpperCase()),a})).filter((e=>e)):[]}.bind(this),this.setEditState=function(e=!0){this.state.inEdit=!!e,this.update()}.bind(this),this.editProduct=function(e){const t=this.getProductIndex(e.id);this.state.productsList[t]=e,this.setChanges()}.bind(this),this.updateReserve=async function(e){const t=this.getProductIndex(e.id);this.state.productsList[t]=e,await this.onSave(),this.state.isSaving=!1,this.update()}.bind(this),this.removeProduct=function(e){const t=this.getProductIndex(e.id);this.state.productsList.splice(t,1),this.setChanges()}.bind(this),this.addReservation=async function(){if(!this.hasChanges)try{return await ii(`/admin/api/project/${flexbe.vars.group.id}/lead/${this.state.leadId}/reservations/`)}catch(e){this.onError(e)}}.bind(this),this.removeReservation=async function(){if(!this.state.hasChanges)try{return await ni(`/admin/api/project/${flexbe.vars.group.id}/lead/${this.state.leadId}/reservations/remove/`)}catch(e){this.onError(e)}}.bind(this),this.setChanges=function(){this.state.hasChanges||(this.state.hasChanges=!0),this.update()}.bind(this),this.syncData=function(e=this.state.products){this.state.isSaving=!1,this.state.productsList=[],this.state.initialProductsList=[],e.forEach((e=>{const t={...e};null!=t.product&&null!=t.variant&&(t.img=this.getImage(e),t.optionsValues=this.getOptionsValues(e)),this.state.productsList.push(t),this.state.initialProductsList.push(t)})),this.update()}.bind(this),this.onCancel=function(){this.state.productsList=[],this.state.initialProductsList.forEach((e=>this.state.productsList.push({...e}))),this.state.hasChanges=!1,this.setEditState(!1),this.update()}.bind(this),this.onSave=async function(){try{return this.state.isSaving=!0,this.setEditState(!1),await e.editField("products",this.state.productsList.length?this.state.productsList:"empty"),this.state.hasChanges=!1,!0}catch(e){this.setEditState(!0),this.onError(e)}}.bind(this),this.onDone=function(){this.syncData(),setTimeout((()=>{this.setEditState(!1)}),350)}.bind(this),this.onReservationDone=function(t){t.products&&t.products.length?(this.state.isSaving=!1,this.update(),this.syncData(t.products),e.updateLeadReserveStatus({inReserve:t.in_reserve,products:t.products})):this.onError(new Error("Products list is empty"))}.bind(this),this.onError=function(e){this.state.isSaving=!1,this.update(),e.message?toast.error(e.message):console.error(e)}.bind(this),this.triggerSave=function(){this.state.hasChanges&&!this.state.isSaving&&($("input").trigger("blur"),this.saveObserver.trigger("save"))}.bind(this),this.triggerCancel=function(){this.state.hasChanges&&!this.state.isSaving&&($("input").trigger("blur"),this.saveObserver.trigger("cancel"))}.bind(this),this.onBeforeMount=function(){this.syncData()}.bind(this),this.onMounted=function(){this._hotkeysSaveDisposer=fs.register([{hotkeys:["cmd_s"],handlerDown:()=>t.triggerSave()}]),this._hotkeysCancelDisposer=fs.register([{hotkeys:["cmd_z"],handlerDown:()=>t.triggerCancel()}])}.bind(this),this.onUnmounted=function(){this._hotkeysSaveDisposer&&this._hotkeysSaveDisposer(),this._hotkeysCancelDisposer&&this._hotkeysCancelDisposer()}.bind(this)})),riot3.tag2("admin-lead-view-products-item",'<div class="td photo"> <div class="product-image"> <span class="real-img" if="{state.imageUrl}" riot-style="background-image: url({state.imageUrl})"></span> <svg class="placeholder-img flexbe-icon size-22" if="{!state.imageUrl && !state.fromDelivery}"> <use riot-xlink:href="{meta.leadSprite}#placeholder-product"></use> </svg> <svg class="placeholder-img flexbe-icon size-22" if="{!state.imageUrl && state.fromDelivery}"> <use riot-xlink:href="{meta.leadSprite}#placeholder-delivery"></use> </svg> </div> </div> <div class="td name font-ui"> <div class="product-item__vendor" if="{state.vendorCode || state.reservationDeletedProduct}"> <span if="{state.vendorCode}" class="product-item__vendor-code"> {state.vendorCode} </span> <span class="product-item__deleted flexbe-tag is-bordered medium" if="{state.reservationDeletedProduct}"> {tr(\'admin::lead::products::detele_product_tip\')} </span> </div> <div data-is="flexbe-input" if="{getFieldEditable(\'name\')}" class="product-item__title block light" riot-value="{state.item.title}" placeholder="{tr(\'admin::lead::products::title_placehodler\')}" oninput="{setField.bind(tag, \'title\')}" onchange="{setField.bind(tag, \'title\')}" onenter="{saveChanges}" required="{true}"></div> <div class="product-item__title" if="{!getFieldEditable(\'name\')}"> {state.item.title} </div> <div if="{state.optionsValues.length}" class="product-item__options"> <virtual each="{value, index in state.optionsValues}"> <span if="{value.color && value.color !== \'false\'}" class="product-item__option-color" riot-style="background: {value.color}"></span> {value.name}<virtual if="{index !== state.optionsValues.length - 1}">,</virtual> </virtual> </div> </div> <div class="td reservation" if="{state.showReservation}"> <div class="product-item__reservation font-ui" if="{!state.reservationIcon}"> <div class="product-item__reservation-text error" data-tip="{state.reservationQuantityTip}"> {state.reservationQuantity} </div> <div class="flexbe-button small" if="{state.showReservationUpdateButton}" data-tip="{tr(\'admin::lead::products::update_reserve_tip\', { count: state.addReservationQuantity })}" data-tip-position="bottom" onclick="{updateReservation}"> <span class="flexbe-text">{tr(\'admin::lead::products::update_reserve\')}</span> </div> </div> <svg class="flexbe-icon size-24" if="{state.reservationIcon}" data-tip="{state.reservationIconTip}"> <use riot-xlink:href="{meta.reservationSprite}#{state.reservationIcon}"></use> </svg> </div> <div class="td count" data-tip="{state.countFieldErrorTip}"> <div class="product-item__count {\'error\': state.countFieldError}" if="{getFieldEditable(\'count\')}"> <div data-is="flexbe-input" class="block light" riot-value="{state.count}" min="1" oninput="{setField.bind(tag, \'count\')}" onchange="{setField.bind(tag, \'count\')}" onenter="{saveChanges}" required="{true}" type="{\'number\'}"></div> <div class="product-item__count--available {this.state.inEdit ? \'show\' : \'\'}" if="{state.fromEcommerce && !state.variantIsUnlimited && !state.reservationDeletedProduct}"> {tr(\'admin::lead::products::available\')}: {state.availableQuantity} </div> </div> <div class="product-item__count font-ui" if="{!getFieldEditable(\'count\')}"> {state.count} </div> </div> <div class="td price" data-tip="{state.priceFieldErrorTip}"> <div data-is="flexbe-input" if="{getFieldEditable(\'price\')}" class="product-item__price block text-center light" min="0" maxlength="6" pattern="-?\\d\\{0,8\\}[\\.,]?\\d\\{0,2\\}" riot-value="{state.price}" oninput="{setField.bind(tag, \'price\')}" onchange="{setField.bind(tag, \'price\')}" onenter="{saveChanges}" required="{true}" type="{\'number\'}"></div> <div if="{!getFieldEditable(\'price\')}" class="product-item__price font-ui"> {state.priceText} </div> <div class="product-item__price--differ {\'show\': state.priceFieldError}"> {tr(\'admin::lead::products::price_error\')} </div> </div> <div class="td remove" if="{state.showRemoveButton && state.allowEdit && state.hasRemoveProduct}"> <div class="flexbe-close" onclick="{removeProduct}"></div> </div>',"",'class="admin-lead-view-products-item product-item {opts.class}" data-id="{state.id}" data-product-id="{state.productData && state.productData.id}" data-variant-id="{state.variantData && state.variantData.id}"',(function(e){this.mixin("initMobx");const t=this;this.state={hasChanges:e.hasChanges??!1,get props(){return t.props??{}},get currencyData(){return this.props.currencyData},get currencyFormat(){return this.props.currencyFormat},get item(){return this.props.product},get id(){return this.item.id},get title(){return this.item.title},get count(){return this.item.count||1},get price(){return+this.item.price||0},get img(){if("product"===this.productData?.display_image||this.item.product&&!this.optionsValues?.length){if(this.variantData.default_image_id){return this.item.images.find((e=>String(e.unq_id)===String(this.variantData.default_image_id)))??this.item.images[0]??{}}return this.item.images[0]??{}}return"variant"===this.item.product?.display_image?this.variantData.images[0]??{}:this.item.img&&!this.productData?this.item.img:{}},get imageUrl(){return pt(this.img,400)||""},get productData(){return this.item.product},get variantData(){return this.item.variant},get reservationData(){return this.item.reservation},get optionsValues(){return this.item.optionsValues||[]},get hasRemoveProduct(){return this.props.hasRemoveProduct??!0},get fromEcommerce(){return null!=this.productData&&null!=this.variantData},get fromDelivery(){return/delivery/.test(this.item.id)},get variantIsAvailable(){return!this.fromEcommerce||this.variantData.visible},get variantIsUnlimited(){return function({quantity:e}){return-1===e||e===1/0}({quantity:this.quantity})},get vendorCode(){return this.variantData?.vendor_code??null},get priceText(){return mt(this.price,this.currencyFormat,this.currencyData)},get quantity(){const e=this.fromEcommerce?+this.variantData.quantity:-1;return-1===e?1/0:e},get reservationQuantity(){return this.reservationData?.quantity??null},get availableQuantity(){return!this.fromEcommerce||this.variantIsUnlimited?1/0:this.variantIsAvailable?this.reservationQuantity?this.quantity+this.reservationQuantity:this.quantity:0},get addReservationQuantity(){const e=this.count-this.reservationQuantity;return e>=this.quantity?this.quantity:e<this.quantity?e:void 0},get reservationId(){return this.reservationData?.id??null},get leadId(){return this.props.leadId},get leadStatus(){return this.props.leadStatus},get allowEdit(){return this.props.allowEdit??!1},get showReservation(){return this.props.allowReservation??!1},get allowPreorder(){return this.props.allowPreorder??!1},get showRemoveButton(){return this.props.showRemoveButton??!1},get leadInReserve(){return this.props.leadInReserve},get minAllowedReservation(){return!(!this.showReservation||!this.fromEcommerce||this.variantIsUnlimited)&&Math.min(this.count,this.availableQuantity)},get showReservationUpdateButton(){return!(this.hasChanges||!this.allowEdit||!this.fromEcommerce||this.variantIsUnlimited)&&(null!=this.reservationQuantity&&this.reservationQuantity<this.minAllowedReservation)},get reservationCanBeAdded(){return!(null!=this.reservationData&&0===this.reservationQuantity&&0===this.quantity)},get reservationDeletedProduct(){return this.fromEcommerce&&this.variantData.deleted_at},get reservationIcon(){return!this.showReservationUpdateButton&&((!this.reservationQuantity||!this.countFieldError)&&(!!this.reservationCanBeAdded&&(!this.fromEcommerce||this.reservationDeletedProduct?"unknown":this.variantIsUnlimited?"unlimited":this.reservationQuantity&&10!==this.leadStatus?2===this.leadStatus?"written_off":this.reservationQuantity<this.count?"in_reserve_items":"in_reserve":"not_reserved")))},get reservationIconTip(){const e=this.reservationIcon;return e?["in_reserve","in_reserve_items"].includes(e)?tr(t.meta.iconsTipsList[e],{count:this.reservationQuantity}):tr(t.meta.iconsTipsList[e]):""},get reservationQuantityTip(){if(!this.fromEcommerce||this.variantIsUnlimited)return null;if(!this.reservationCanBeAdded)return tr("admin::lead::products::reserve_zero_error_tip");if(this.availableQuantity<this.count){const e=this.count-this.availableQuantity;return tr("admin::lead::products::count_error_tip",{count:this.reservationQuantity,needed:e})}return null},get countFieldError(){return!this.variantIsAvailable||!(!this.fromEcommerce||this.variantIsUnlimited)&&this.availableQuantity<this.count},get countFieldErrorTip(){return this.countFieldError?tr("admin::lead::products::available_error_tip",{count:this.availableQuantity}):null},get priceFieldError(){return!!(this.allowEdit&&this.fromEcommerce&&t.getFieldEditable("price"))&&this.price!==(+this.variantData.price||0)},get priceFieldErrorTip(){return this.priceFieldError&&this.fromEcommerce?tr("admin::lead::products::price_error_tip",{value:mt(this.variantData.price)}):null},get inEdit(){return this.props.inEdit}},this.meta={leadSprite:at("lead","admin"),reservationSprite:at("reserve","admin"),iconsTipsList:{unknown:"admin::lead::products::reserve_icon::unknown_tip",unlimited:"admin::lead::products::reserve_icon::unlimited_tip",written_off:"admin::lead::products::reserve_icon::written_off_tip",not_reserved:"admin::lead::products::reserve_icon::not_reserved_tip",in_reserve:"admin::lead::products::reserve_icon::in_reserve_tip",in_reserve_items:"admin::lead::products::reserve_icon::in_reserve_items_tip"}},this.getFieldEditable=function(e){return!!this.state.allowEdit&&(!this.state.fromEcommerce||["price","count"].includes(e))}.bind(this),this.setField=function(t,s){s.preventUpdate=!0;let i=s.target.value;"price"===t?i=ut(i||0):"count"===t&&(i=+i),this.state.item[t]=i,e.onEditProduct(this.state.item),this.setChanges()}.bind(this),this.setChanges=function(){this.state.hasChanges||(this.state.hasChanges=!0,e.onSetChanges()),this.update()}.bind(this),this.removeProduct=function(){e.onRemoveProduct()}.bind(this),this.updateReservation=async function(){if(!this.state.hasChanges)try{await ri(`/admin/api/project/${flexbe.vars.group.id}/reservations/${this.state.reservationId}/`),e.onSave()}catch(e){if(e.message)return void toast.error(e.message);console.error(e)}}.bind(this),this.saveChanges=function(){this.opts.saveChanges?.()}.bind(this),this.initTooltips=function(){Yt.initArea(this.root)}.bind(this),this.onMounted=function(){this.initTooltips()}.bind(this),this.onUpdated=function(){this.initTooltips()}.bind(this)})),riot3.tag2("admin-lead-view-reservation-button",'<div class="flexbe-button small filled {meta.saveClasses}" onclick="{saveHandler}"> <span class="flexbe-text">{meta.buttonText}</span> <span class="flexbe-check text-s is-check"></span> </div>',"",'class="admin-lead-view-reservation-button {opts.class}"',(function(e){const t=this;this.isSaving=!1,this.isLoading=!1,this.isCheck=!1,this.meta={get saveClasses(){return[!t.isCheck&&"is-secondary",t.isCheck&&"is-success",t.isCheck&&"check",t.isLoading&&"loading"].filter((e=>e)).join(" ")},get buttonText(){return t.opts.showAdd?tr("admin::lead::products::add_reserve"):tr("admin::lead::products::remove_reserve")}},this.saveHandler=async function(){if(this.isSaving||!e.onadd||!e.onremove)return;this.update({isSaving:!0,isLoading:!0});const t=e.showAdd?await e.onadd():await e.onremove();if(this.update({isLoading:!1}),t instanceof Error)return this.update({isSaving:!1}),void(e.onerror&&e.onerror(t));this.update({isCheck:!0}),setTimeout((()=>{this.update({isSaving:!1,isCheck:!1}),e.ondone&&e.ondone(t)}),1e3)}.bind(this)})),riot3.tag2("admin-lead-view-source",'<div class="flexbe-title text-subtitle">{tr(\'admin::lead::view::source_title\')}</div> <div class="flexbe-white-card shadow rounded p0 font-ui"> <a class="page-preview" href="{source.page.uri}" target="_blank" riot-style="background-image: url(\'/img/{source.page.img_id}.jpg\')"></a> <div class="page-title flexbe-title font-content">{htmlspecialchars(source.page.title, true)}</div> <div class="page-uri"> <a href="{source.page.uri}" target="_blank"> <span class="domain">{source.domain}</span><span class="uri">{source.page.uri || \'/\'}</span> </a> </div> <div class="page-data"> <div class="source-location"> <div class="city" if="{tag.locationText}" data-is="flexbe-tooltip" content="{tag.locationTip}" interactive="{true}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#geo"></use> </svg> <span class="flexbe-text">{tag.locationText}</span> </div> <div class="ip" if="{!tag.locationText}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.sprite}#ip"></use></svg> <span class="flexbe-text">{tag.source.ip}</span> </div> </div> <div class="source-device" data-is="flexbe-tooltip" content="{source.browser}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.sprite}#{tag.deviceType}"></use></svg> <span class="flexbe-text">{tr(\'admin::lead::view::device::\' + tag.deviceType)}</span> </div> </div> </div>',"",'class="admin-lead-view-source {opts.class}"',(function(e){this.htmlspecialchars=st,this.tag=this,this.sprite=e.sprite,this.source=e.source,"mobile"===this.source.type?/iPhone|iPod/gi.test(this.source.browser)?this.deviceType="iphone":/Android/gi.test(this.source.browser)?this.deviceType="android":this.deviceType="mobile":this.deviceType="desktop",this.source.location&&this.source.location.city_name&&(flexbe.vars.group.country===this.source.location.country_code?this.locationText=`${this.source.location.city_name}`:this.locationText=`${this.source.location.city_name}, ${this.source.location.country_name}`,this.locationTip=[`IP: ${this.source.ip}`,`: ${this.source.location.city_name}, ${this.source.location.region_name}, ${this.source.location.country_name}`].join("<br>"))})),riot3.tag2("admin-lead-view-utm",'<div class="flexbe-title text-subtitle">{tr(\'admin::lead::view::utm::title\')}</div> <div class="flexbe-white-box shadow flexbe-table"> <div class="tbody"> <div class="tr" each="{utm in opts.utm}"> <div class="th">{utm.name}</div> <div class="td">{utm.value || \'\'}</div> </div> </div> </div>',"",'class="admin-lead-view-utm {opts.class}"',(function(e){}));const Nr={css:null,exports:{setup(e){this.state={get lead(){var t;return null!=(t=e.props.lead)?t:{}},get leadData(){var e;return null!=(e=this.lead.lead_data)?e:[]},get deliveryForm(){return this.leadData.filter((e=>"99999"===e.id||e.id&&String(e.id).includes("external")))},get delivery(){return this.lead.lead_shipping},get deliverySum(){return this.delivery.price},get isFreeDelivery(){return!this.delivery.price_without_fraction},get deliverySumDisplayValue(){return this.isFreeDelivery?tr("admin::lead::view::total::free_title"):mt(this.deliverySum)}}},getFieldValue(e){let t=e.value;return"checkbox"===e.type?([!0,"on","true","yes",""].includes(e.value)?t=tr("admin::lead::products::checkbox_value_yes"):e.value&&!["off","false","no",""].includes(e.value)||(t=tr("admin::lead::products::checkbox_value_no")),t):t}},template:(e,t,s,i)=>e('<div class="flexbe-title text-subtitle inline-box"><span expr719="expr719" class="flexbe-text"> </span></div><div class="flexbe-white-box shadow flexbe-table"><div class="tbody"><div expr720="expr720" class="tr field-item"></div><div class="tr field-item"><div class="th"><div expr730="expr730" class="flexbe-text"> </div></div><div class="td"><pre expr731="expr731" class="flexbe-text"> </pre></div></div></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-lead-view-delivery ",e.props.class].join("")}]},{redundantAttribute:"expr719",selector:"[expr719]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::delivery::title")}]},{type:s.EACH,getKey:null,condition:e=>e.field,template:e('<div class="th"><div expr721="expr721" class="flexbe-text"> </div></div><div class="td"><div expr722="expr722" class="flexbe-text"></div><pre expr723="expr723" class="flexbe-text"></pre><div expr724="expr724" class="flexbe-text"></div><virtual expr725="expr725"></virtual></div>',[{redundantAttribute:"expr721",selector:"[expr721]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.field.name}]},{type:s.IF,evaluate:e=>!["checkbox","file","textarea"].includes(e.field.type),redundantAttribute:"expr722",selector:"[expr722]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.getFieldValue(e.field)||""].join("")}]}])},{type:s.IF,evaluate:e=>"textarea"===e.field.type,redundantAttribute:"expr723",selector:"[expr723]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.getFieldValue(e.field)||""}]}])},{type:s.IF,evaluate:e=>"checkbox"===e.field.type,redundantAttribute:"expr724",selector:"[expr724]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.getFieldValue(e.field)||""}]}])},{type:s.IF,evaluate:e=>"file"===e.field.type,redundantAttribute:"expr725",selector:"[expr725]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"virtual",slots:[{id:"default",html:'<ul expr726="expr726"></ul><div expr729="expr729" class="flexbe-text"></div>',bindings:[{type:s.IF,evaluate:e=>e.field.value&&e.field.value.length,redundantAttribute:"expr726",selector:"[expr726]",template:e('<li expr727="expr727"></li>',[{type:s.EACH,getKey:null,condition:null,template:e('<a expr728="expr728" class="flexbe-text" target="_blank" download> </a>',[{redundantAttribute:"expr728",selector:"[expr728]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::lead::view::download_file_button")," ",e.index?e.index+1:""].join("")},{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.file}]}]),redundantAttribute:"expr727",selector:"[expr727]",itemName:"file",indexName:"index",evaluate:e=>e.field.value}])},{type:s.IF,evaluate:e=>!e.field.value||!e.field.value.length,redundantAttribute:"expr729",selector:"[expr729]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::lead::products::fail_not_upload_value")].join("")}]}])}]}],attributes:[]}])}]),redundantAttribute:"expr720",selector:"[expr720]",itemName:"field",indexName:null,evaluate:e=>e.state.deliveryForm},{redundantAttribute:"expr730",selector:"[expr730]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::delivery::price")}]},{redundantAttribute:"expr731",selector:"[expr731]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.deliverySumDisplayValue}]}]),name:"admin-lead-view-delivery"};e(Nr.name,Nr);const Mr={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get selectedIds(){var t;return null!=(t=e.props.selectedIds)?t:[]},get variant(){var t;return null!=(t=e.props.variant)?t:{}},get variantOption(){var e;return null!=(e=this.variant.option_values)?e:[]},get options(){var t;return null!=(t=e.props.options)?t:[]},get count(){const e=this.variant.quantity;return-1===e?tr("admin::select_product::not_limited"):+e?tr("admin::select_product::quantity",{count:e}):tr("admin::select_product::not_available")},get price(){return mt(this.variant.price)},get optionsData(){return this.variantOption.map(((e,t)=>{const s=this.options[t];return{name:s.name,type:s.data.type,value:s.values.filter((t=>String(t.id)===String(e.value_id)))[0]}}))},get addedProduct(){return this.selectedIds.some((({variantId:e})=>String(e)===String(this.variant.id)))}},this.watch={"state.selectedIds":()=>this.update()}},addProduct(){this.state.variant.visible&&this.props.addProduct({productId:this.props.productId,variantId:this.state.variant.id})}},template:(e,t,s,i)=>e('<div class="variant-element--info"><span expr1367="expr1367" class="element--article"></span><div class="variant-element--options"><span expr1368="expr1368" class="variant-element--option"></span></div></div><div expr1371="expr1371" class="variant-element--hide"></div><div expr1372="expr1372" class="element--count"></div><div expr1373="expr1373" class="element--price"></div><label expr1374="expr1374" is="flexbe-checkbox" type="checkbox"></label><div expr1375="expr1375" class="element--action action-cart tooltipstered" is="flexbe-tooltip"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-select-variant-element ",e.classNames({"hide-variant":!e.state.variant.visible})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.addProduct}]},{type:s.IF,evaluate:e=>e.state.variant.vendor_code,redundantAttribute:"expr1367",selector:"[expr1367]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.variant.vendor_code.toUpperCase()}]}])},{type:s.EACH,getKey:null,condition:null,template:e('<i expr1369="expr1369"></i> <template expr1370="expr1370"></template>',[{expressions:[{type:t.TEXT,childNodeIndex:1,evaluate:e=>[e.option.value.name].join("")},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>[e.option.name,": ",e.option.value.name].join("")}]},{type:s.IF,evaluate:e=>"color"===e.option.type,redundantAttribute:"expr1369",selector:"[expr1369]",template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["background-color: ",e.option.value.data.color].join("")}]}])},{type:s.IF,evaluate:e=>e.index!==e.state.optionsData.length-1,redundantAttribute:"expr1370",selector:"[expr1370]",template:e(",",[])}]),redundantAttribute:"expr1368",selector:"[expr1368]",itemName:"option",indexName:"index",evaluate:e=>e.state.optionsData},{type:s.IF,evaluate:e=>!e.state.variant.visible,redundantAttribute:"expr1371",selector:"[expr1371]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::ecommerce::variants::not_order")].join("")}]}])},{type:s.IF,evaluate:e=>e.state.variant.visible,redundantAttribute:"expr1372",selector:"[expr1372]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.count}]}])},{type:s.IF,evaluate:e=>e.state.variant.visible,redundantAttribute:"expr1373",selector:"[expr1373]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.price}]}])},{type:s.IF,evaluate:e=>e.props.massAddProducts,redundantAttribute:"expr1374",selector:"[expr1374]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[],attributes:[{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>!e.state.variant.visible},{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.addedProduct},{type:t.EVENT,name:"onchange",evaluate:e=>()=>e.addProduct()}]}])},{type:s.IF,evaluate:e=>!e.props.massAddProducts,redundantAttribute:"expr1375",selector:"[expr1375]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[{id:"default",html:'<svg class="flexbe-icon size-16"><use expr1376="expr1376"/></svg>',bindings:[{redundantAttribute:"expr1376",selector:"[expr1376]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.props.sprite,"#",e.state.variant.visible?"link":"un-link"].join("")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.state.variant.visible?e.tr("admin::select_product::connect"):e.tr(" ")},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>!e.state.variant.visible},{type:t.EVENT,name:"onclick",evaluate:e=>e.addProduct}]}])}]),name:"flexbe-select-variant-element"};function Dr({defId:e,displayImage:t,productMedia:s,variantMedia:i}){let a="product"===t?null!=s?s:[]:null!=i?i:[];if(a&&(a=a.filter((e=>e))),!a.length)return[];if(e){const t=a.filter((t=>t.unq_id===e));if(t.length)return t}return[a[0]]}function Vr(e,t){if(e.f_name_info)return"/_s/images/admin/ecommerce/placeholder_video.png";return pt(ct(e),t)}e(Mr.name,Mr);const Or={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={sprite:at("add-product","common"),openVariants:!1,get linkOnProductPage(){return`${ye({product:this.product.id})}`},get selectedIds(){var t;return null!=(t=e.props.selectedIds)?t:[]},get settings(){var t;return null!=(t=e.props.settings)?t:{}},get product(){var t;return null!=(t=e.props.product)?t:{}},get variants(){var e;return null!=(e=this.product.variants)?e:[]},get needVariants(){var e;return null!=(e=this.settings.needVariants)&&e},get massAddProducts(){var e;return null!=(e=this.settings.massAddProducts)&&e},get connectionProduct(){var e;return null!=(e=this.settings.connectionProduct)&&e},get addedProduct(){return this.selectedIds.some((({productId:e})=>String(e)===String(this.product.id)))},get hasVariants(){return this.variants.length>1},get showVariants(){return this.hasVariants&&this.needVariants},get count(){if(this.hasVariants){const e=this.variants.filter((e=>e.visible));return tr("admin::select_product::quantity_variants",{count:e.length})}const e=this.variants[0].quantity;return-1===e?tr("admin::select_product::not_limited"):+e?tr("admin::select_product::quantity",{count:e}):tr("admin::select_product::not_available")},get options(){return this.product.options},get isOptions(){return this.options.length},get displayImage(){return this.isOptions?this.product.display_image:"product"},get defaultVariantId(){var e;return null!=(e=this.product.default_variant_id)?e:null},get defaultVariant(){const e=this.variants.filter((e=>e.id===this.defaultVariantId));return null!=e?e:[]},get images(){var e,t;return Dr({defId:null!=(e=null==(t=this.defaultVariant[0])?void 0:t.default_image_id)?e:null,displayImage:this.displayImage,productMedia:this.product.images,variantMedia:this.defaultVariant[0].images})},get media(){return this.images.length?Vr(this.images[0],120):""},get price(){if(this.needVariants)return mt(this.variants[0].price);if(!this.product.price.min&&!this.product.price.max)return tr("admin::ecommerce::product::price_null");const e=this.product.price.min?mt(this.product.price.min):0,t=mt(this.product.price.max);return e===t?t:`${e}  ${t}`}},this.watch={"state.selectedIds":[()=>this.update()]}},openVariants(e){this.state.showVariants&&(e.preventDefault(),e.stopPropagation(),this.state.openVariants=!this.state.openVariants,this.update())},addProduct(){this.props.addProduct({productId:this.state.product.id,variantId:this.state.connectionProduct?"default":this.state.variants[0].id})},onClickElement(e){return this.state.showVariants&&!this.state.connectionProduct?this.openVariants(e):this.addProduct()}},template:(e,t,s,i)=>e('<div expr1300="expr1300" class="product-element--content"><div class="product-element--image"><svg expr1301="expr1301" class="flexbe-icon size-16"></svg><div expr1303="expr1303" class="product-element--image-item"></div></div><div expr1304="expr1304"><span expr1305="expr1305" class="element--article"></span> <a expr1306="expr1306" class="product-element--link tooltipstered" target="_blank" is="flexbe-tooltip"></a></div><div expr1308="expr1308"></div><div expr1309="expr1309"></div><label expr1310="expr1310" is="flexbe-checkbox" type="checkbox"></label><div expr1311="expr1311" is="flexbe-tooltip"></div></div><div expr1314="expr1314" is="flexbe-select-variant-element"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-select-product-element ",e.classNames({open:e.state.openVariants})].join("")}]},{redundantAttribute:"expr1300",selector:"[expr1300]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.onClickElement}]},{type:s.IF,evaluate:e=>!e.state.images.length,redundantAttribute:"expr1301",selector:"[expr1301]",template:e('<use expr1302="expr1302"/>',[{redundantAttribute:"expr1302",selector:"[expr1302]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#not_image"].join("")}]}])},{type:s.IF,evaluate:e=>e.state.images.length,redundantAttribute:"expr1303",selector:"[expr1303]",template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["background-image: url('",e.state.media,"')"].join("")}]}])},{redundantAttribute:"expr1304",selector:"[expr1304]",expressions:[{type:t.TEXT,childNodeIndex:1,evaluate:e=>[e.state.product.title].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["product-element--title ",e.classNames({"need-variants":e.state.needVariants})].join("")}]},{type:s.IF,evaluate:e=>!e.state.hasVariants&&e.state.needVariants&&e.state.variants[0].vendor_code,redundantAttribute:"expr1305",selector:"[expr1305]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.variants[0].vendor_code.toUpperCase()}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[{id:"default",html:'<svg class="flexbe-icon size-12"><use expr1307="expr1307"/></svg>',bindings:[{redundantAttribute:"expr1307",selector:"[expr1307]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#link-product"].join("")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>["/admin/ecommerce/?",e.state.linkOnProductPage].join("")},{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::select_product::link_in_product")},{type:t.EVENT,name:"onclick",evaluate:e=>e=>e.stopPropagation()}],redundantAttribute:"expr1306",selector:"[expr1306]"},{type:s.IF,evaluate:e=>e.state.needVariants,redundantAttribute:"expr1308",selector:"[expr1308]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.count].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["element--count ",e.classNames({connect:e.state.connectionProduct&&e.state.hasVariants})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.openVariants}]}])},{type:s.IF,evaluate:e=>!e.state.hasVariants||!e.state.needVariants,redundantAttribute:"expr1309",selector:"[expr1309]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.price},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["element--price ",e.classNames({products:!e.state.needVariants})].join("")}]}])},{type:s.IF,evaluate:e=>!e.state.showVariants&&e.state.massAddProducts,redundantAttribute:"expr1310",selector:"[expr1310]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.addedProduct},{type:t.EVENT,name:"onchange",evaluate:e=>()=>e.addProduct()}]}])},{type:s.IF,evaluate:e=>e.state.showVariants||e.state.connectionProduct,redundantAttribute:"expr1311",selector:"[expr1311]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[{id:"default",html:'<svg expr1312="expr1312"><use expr1313="expr1313"/></svg>',bindings:[{redundantAttribute:"expr1312",selector:"[expr1312]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-icon size-",e.state.showVariants&&!e.state.connectionProduct?"12":"16"].join("")}]},{redundantAttribute:"expr1313",selector:"[expr1313]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#",e.state.showVariants&&!e.state.connectionProduct?"arrow":"link"].join("")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["element--action ",e.classNames({active:e.state.openVariants&&!e.state.connectionProduct})," ",e.state.showVariants&&!e.state.connectionProduct?"action-arrow":"action-cart tooltipstered"].join("")},{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.state.showVariants&&!e.state.connectionProduct?"":e.tr("admin::select_product::connect")},{type:t.EVENT,name:"onclick",evaluate:e=>!e.state.showVariants||e.state.connectionProduct?e.addProduct:""}]}])},{type:s.EACH,getKey:e=>e.variant.id,condition:e=>e.state.openVariants,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-select-variant-element",slots:[],attributes:[{type:t.ATTRIBUTE,name:"variant",evaluate:e=>e.variant},{type:t.ATTRIBUTE,name:"product-id",evaluate:e=>e.state.product.id},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.state.sprite},{type:t.ATTRIBUTE,name:"mass-add-products",evaluate:e=>e.state.massAddProducts},{type:t.ATTRIBUTE,name:"add-product",evaluate:e=>e.props.addProduct},{type:t.ATTRIBUTE,name:"selected-ids",evaluate:e=>e.state.selectedIds},{type:t.ATTRIBUTE,name:"options",evaluate:e=>e.state.options}]}]),redundantAttribute:"expr1314",selector:"[expr1314]",itemName:"variant",indexName:null,evaluate:e=>e.state.variants}]),name:"flexbe-select-product-element"};e(Or.name,Or);const zr={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={sprite:at("add-product","common"),get item(){return e.props.item},get index(){return e.props.index},get needVariants(){var t;return null!=(t=e.props.settings.needVariants)&&t},get getImage(){var e;const t=this.item.product.options?this.item.product.display_image:"product",s=Dr({defId:null!=(e=this.item.variant.default_image_id)?e:null,displayImage:t,productMedia:this.item.product.images,variantMedia:this.item.variant.images});return s.length?Vr(s[0],120):""}},this.watch={"state.products":()=>this.update()}},deleteProduct(e){this.props.deleteProduct(e)}},template:(e,t,s,i)=>e('<div class="flexbe-selected-element--image-block"><svg expr1315="expr1315" class="flexbe-icon size-30"></svg><div expr1317="expr1317" class="flexbe-selected-element--image"></div></div><div class="flexbe-selected-element--info"><span expr1318="expr1318" class="flexbe-selected-element--title"> </span><span expr1319="expr1319" class="flexbe-selected-element--options"></span></div><span expr1320="expr1320" class="flexbe-close"></span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-selected-element"}]},{type:s.IF,evaluate:e=>!e.state.getImage,redundantAttribute:"expr1315",selector:"[expr1315]",template:e('<use expr1316="expr1316"/>',[{redundantAttribute:"expr1316",selector:"[expr1316]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#not_image"].join("")}]}])},{type:s.IF,evaluate:e=>e.state.getImage,redundantAttribute:"expr1317",selector:"[expr1317]",template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["background-image: url('",e.state.getImage,"')"].join("")}]}])},{redundantAttribute:"expr1318",selector:"[expr1318]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.item.product.name}]},{type:s.IF,evaluate:e=>e.state.needVariants&&e.state.item.product.options.length,redundantAttribute:"expr1319",selector:"[expr1319]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.item.variant.name.join(", ")}]}])},{redundantAttribute:"expr1320",selector:"[expr1320]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.deleteProduct(e.state.index)}]}]),name:"flexbe-selected-block"};e(zr.name,zr);const qr={css:null,exports:{setup(e,{initMobx:t,inject:s}){var i,a;t(),this.modal=s("modal"),this.state={massAddProducts:e.props.settings.massAddProducts,selectedIds:[...null!=(i=e.props.settings.selectedIds)?i:[]],hideNonVisible:null!=(a=e.props.settings.hideNonVisible)&&a,selectedProducts:[],allProducts:0,countCurrentProduct:0,categories:[],products:[],loading:!0,loadingProducts:!1,addLoading:!1,currentId:0,page:1,search:""},this.watch={"state.loadingProducts":()=>this.update(),"state.addLoading":()=>this.update(),"state.products":()=>this.update()}},addProduct({productId:e,variantId:t}){const s=this.state.selectedIds.findIndex((s=>`${s.productId}_${s.variantId}`==`${e}_${t}`));this.props.settings.massAddProducts?-1===s?this.state.selectedIds=[...this.state.selectedIds,{productId:e,variantId:t}]:(this.state.selectedIds.splice(s,1),this.state.selectedIds=[...this.state.selectedIds]):this.state.selectedIds=[{productId:e,variantId:t}],this.update(),this.props.settings.massAddProducts||this.addProducts()},addProducts(){this.props.addProducts(this.state.selectedIds),this.modal.close()},deleteProduct(e){this.state.selectedIds.splice(e,1),this.state.selectedProducts.splice(e,1),this.update()},cleanProducts(){this.state.selectedIds=[],this.state.selectedProducts=[],this.update()},async selectCategory(e){if(this.state.currentId!==e){if(this.state.loadingProducts=!0,this.state.page=1,"selected"===e)this.state.currentId="selected",this.update(),this.state.selectedProducts=await this.getSelectedProductList();else{var t;this.state.currentId=e?e.id:0,this.state.countCurrentProduct=e?e.countProducts:this.state.allProducts,this.state.search="",this.update();const s=await this.getProductList();this.state.products=null!=(t=null==s?void 0:s.items)?t:[]}this.state.loadingProducts=!1}},async searchInput(e){this.state.search=e.target.value,this.state.loadingProducts=!0,clearTimeout(this.timer),this.timer=setTimeout((async()=>{await this.searchData()}),1e3)},async cleanInput(){this.state.search="",this.state.loadingProducts=!0,await this.searchData()},async searchData(){var e,t;this.state.page=1;const s=await this.getProductList();this.state.products=null!=(e=null==s?void 0:s.items)?e:[],this.state.countCurrentProduct=null!=(t=null==s?void 0:s.totalCount)?t:0,this.state.loadingProducts=!1,this.update()},async getProductList(){try{const e=[`page=${this.state.page}`,"countOnPage=25"];this.state.currentId&&e.push(`categories=${this.state.currentId}`),this.state.search&&e.push(`searchQuery=${this.state.search}`),this.state.hideNonVisible&&e.push("visible=1");return(await ai(`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/list/?${e.join("&")}`)).data}catch(e){return{}}},async getSelectedProductList(){try{const e=this.state.selectedIds.map((({variantId:e})=>e)),t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product_variant/list/`;return e.length?await ii(t,{asJson:!0,data:{variants:e}}):[]}catch(e){return{}}},scrollUpload(){const e=$(this.root).find(".flexbe-select-product-list"),t=$(this.root).find(".flexbe-select-product-conteiner");e.on("scroll",(async e=>{const s=e.currentTarget.scrollTop+e.currentTarget.offsetHeight,i=t[0].offsetHeight,a=this.state.products.length===+this.state.countCurrentProduct,n=this.state.addLoading||this.state.loadingProducts;if(s+300>i&&!n&&!a&&"selected"!==this.state.currentId){var r;this.state.addLoading=!0,this.state.page+=1;const e=await this.getProductList(),t=null!=(r=null==e?void 0:e.items)?r:[];this.state.products=[...this.state.products,...t],this.state.addLoading=!1}}))},async onBeforeMount(){try{var e,t,s,i;let a="";this.state.hideNonVisible&&(a="?visible=1");const n=await ai(`/admin/api/project/${flexbe.vars.group.id}/ecommerce/${a}`);this.state.categories=(null==(e=n.data.categories)?void 0:e.items)||[],this.state.products=(null==(t=n.data.products)?void 0:t.items)||[],this.state.allProducts=null!=(s=n.data.categories.allProductsCount)?s:0,this.state.countCurrentProduct=null!=(i=n.data.categories.allProductsCount)?i:0}catch(e){this.state.categories=[],this.state.products=[]}this.state.loading=!1,this.update(),this.scrollUpload()}},template:(e,t,s,i)=>e('<div expr1076="expr1076" is="flexbe-loader" class="size--small"></div><div expr1077="expr1077" class="select-product--menu sidebar scrollable-content"></div><div expr1087="expr1087" class="select-product--content"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-select-product"}]},{type:s.IF,evaluate:e=>e.state.loading,redundantAttribute:"expr1076",selector:"[expr1076]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[]}])},{type:s.IF,evaluate:e=>!e.state.loading,redundantAttribute:"expr1077",selector:"[expr1077]",template:e('<ul class="flexbe-list borderless hoverable opacify active-background hoverable-background"><li expr1078="expr1078"></li><li expr1081="expr1081"><span expr1082="expr1082" class="flexbe-text"> </span><div expr1083="expr1083" class="category-products-count"> </div></li><li expr1084="expr1084"></li></ul>',[{type:s.IF,evaluate:e=>e.state.massAddProducts,redundantAttribute:"expr1078",selector:"[expr1078]",template:e('<svg class="flexbe-icon size-16" width="16" height="16" viewBox="0 0 16 16"><path d="M10 2C10.5523 2 11 1.55228 11 1C11 0.447715 10.5523 0 10 0H2C0.895431 0 0 0.895431 0 2V14C0 15.1046 0.895431 16 2 16H14C15.1046 16 16 15.1046 16 14V10C16 9.44771 15.5523 9 15 9C14.4477 9 14 9.44771 14 10V14H2V2H10ZM15.7071 3.70711C16.0976 3.31658 16.0976 2.68342 15.7071 2.29289C15.3166 1.90237 14.6834 1.90237 14.2929 2.29289L8 8.58579L5.70711 6.29289C5.31658 5.90237 4.68342 5.90237 4.29289 6.29289C3.90237 6.68342 3.90237 7.31658 4.29289 7.70711L7.29289 10.7071C7.68342 11.0976 8.31658 11.0976 8.70711 10.7071L15.7071 3.70711Z" fill="currentColor"/></svg><span expr1079="expr1079" class="flexbe-text"> </span><div expr1080="expr1080" class="category-products-count"> </div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list-item flexbe-list-item--selected ",e.classNames({active:"selected"===e.state.currentId})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.selectCategory.bind(e.tag,"selected")}]},{redundantAttribute:"expr1079",selector:"[expr1079]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::select_product::selected")}]},{redundantAttribute:"expr1080",selector:"[expr1080]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.selectedIds.length].join("")}]}])},{redundantAttribute:"expr1081",selector:"[expr1081]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list-item ",e.classNames({active:!e.state.currentId})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.selectCategory.bind(e.tag,0)}]},{redundantAttribute:"expr1082",selector:"[expr1082]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::select_product::category::all_products")}]},{redundantAttribute:"expr1083",selector:"[expr1083]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.allProducts].join("")}]},{type:s.EACH,getKey:e=>e.category.id,condition:null,template:e('<span expr1085="expr1085" class="flexbe-text"> </span><div expr1086="expr1086" class="category-products-count"> </div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list-item ",e.classNames({active:e.category.id===e.state.currentId})].join("")},{type:t.ATTRIBUTE,name:"title",evaluate:e=>e.category.name.length>21?e.category.name:""},{type:t.EVENT,name:"onclick",evaluate:e=>e.selectCategory.bind(e.tag,e.category)}]},{redundantAttribute:"expr1085",selector:"[expr1085]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.category.name}]},{redundantAttribute:"expr1086",selector:"[expr1086]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.category.countProducts}]}]),redundantAttribute:"expr1084",selector:"[expr1084]",itemName:"category",indexName:null,evaluate:e=>e.state.categories}])},{type:s.IF,evaluate:e=>!e.state.loading,redundantAttribute:"expr1087",selector:"[expr1087]",template:e('<div expr1088="expr1088" class="search-block"></div><div expr1092="expr1092" class="flexbe-selected-element--clean-block"></div><div expr1095="expr1095"><div expr1096="expr1096" class="flexbe-select-product-conteiner"></div><div expr1099="expr1099" class="select-product--content-empty flexbe-desc text-content"></div><div expr1100="expr1100" is="flexbe-loader" class="size--small"></div></div><div expr1101="expr1101" class="select-product--block-button"></div>',[{type:s.IF,evaluate:e=>"selected"!==e.state.currentId,redundantAttribute:"expr1088",selector:"[expr1088]",template:e('<div expr1089="expr1089" is="flexbe-input"></div><div expr1091="expr1091" class="select-product--search-count"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[{id:"default",html:'<span expr1090="expr1090" class="select-product--search-clean"></span>',bindings:[{type:s.IF,evaluate:e=>e.state.search,redundantAttribute:"expr1090",selector:"[expr1090]",template:e(null,[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.cleanInput}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::select_product::search_products")},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.search},{type:t.EVENT,name:"oninput",evaluate:e=>e.searchInput}],redundantAttribute:"expr1089",selector:"[expr1089]"},{type:s.IF,evaluate:e=>e.state.search&&!e.state.loadingProducts,redundantAttribute:"expr1091",selector:"[expr1091]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::select_product::search_count",{count:e.state.countCurrentProduct})].join("")}]}])}])},{type:s.IF,evaluate:e=>"selected"===e.state.currentId,redundantAttribute:"expr1092",selector:"[expr1092]",template:e('<div expr1093="expr1093" class="flexbe-button style-text p0"><span expr1094="expr1094" class="flexbe-text text-s"> </span></div>',[{redundantAttribute:"expr1093",selector:"[expr1093]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.cleanProducts}]},{redundantAttribute:"expr1094",selector:"[expr1094]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::select_product::delete_all")}]}])},{redundantAttribute:"expr1095",selector:"[expr1095]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-select-product-list scrollable-content ",e.classNames({"selected-block":"selected"===e.state.currentId})," ",e.classNames({"selected-block-mass":!e.state.massAddProducts})].join("")}]},{type:s.IF,evaluate:e=>!e.state.loadingProducts,redundantAttribute:"expr1096",selector:"[expr1096]",template:e('<div expr1097="expr1097" is="flexbe-select-product-element"></div><div expr1098="expr1098" is="flexbe-selected-block"></div>',[{type:s.EACH,getKey:e=>e.product.id,condition:e=>"selected"!==e.state.currentId,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-select-product-element",slots:[],attributes:[{type:t.ATTRIBUTE,name:"add-product",evaluate:e=>e.addProduct},{type:t.ATTRIBUTE,name:"settings",evaluate:e=>e.props.settings},{type:t.ATTRIBUTE,name:"page",evaluate:e=>e.state.page},{type:t.ATTRIBUTE,name:"product",evaluate:e=>e.product},{type:t.ATTRIBUTE,name:"selected-ids",evaluate:e=>e.state.selectedIds}]}]),redundantAttribute:"expr1097",selector:"[expr1097]",itemName:"product",indexName:null,evaluate:e=>e.state.products},{type:s.EACH,getKey:e=>e.item.product.id,condition:e=>e.state.selectedProducts.length&&"selected"===e.state.currentId,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-selected-block",slots:[],attributes:[{type:t.ATTRIBUTE,name:"settings",evaluate:e=>e.props.settings},{type:t.ATTRIBUTE,name:"item",evaluate:e=>e.item},{type:t.ATTRIBUTE,name:"index",evaluate:e=>e.index},{type:t.ATTRIBUTE,name:"delete-product",evaluate:e=>e.deleteProduct}]}]),redundantAttribute:"expr1098",selector:"[expr1098]",itemName:"item",indexName:"index",evaluate:e=>e.state.selectedProducts}])},{type:s.IF,evaluate:e=>!e.state.loadingProducts&&!e.state.products.length||"selected"===e.state.currentId&&!e.state.selectedIds.length,redundantAttribute:"expr1099",selector:"[expr1099]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.search?e.tr("admin::select_product::not_search"):e.state.selectedIds.length||"selected"!==e.state.currentId?e.tr("admin::select_product::not_products"):e.tr("admin::select_product::not_selected")].join("")}]}])},{type:s.IF,evaluate:e=>e.state.loadingProducts||e.state.addLoading,redundantAttribute:"expr1100",selector:"[expr1100]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[]}])},{type:s.IF,evaluate:e=>e.state.massAddProducts,redundantAttribute:"expr1101",selector:"[expr1101]",template:e('<div expr1102="expr1102" class="flexbe-button is-secondary filled mr10"><span expr1103="expr1103" class="flexbe-text"> </span></div><div expr1104="expr1104" class="flexbe-button is-primary filled"><span expr1105="expr1105" class="flexbe-text"> </span></div>',[{redundantAttribute:"expr1102",selector:"[expr1102]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.modal.close()}]},{redundantAttribute:"expr1103",selector:"[expr1103]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::cancel")}]},{redundantAttribute:"expr1104",selector:"[expr1104]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.addProducts}]},{redundantAttribute:"expr1105",selector:"[expr1105]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::done")}]}])}])}]),name:"flexbe-select-product"};e(qr.name,qr);const Gr={css:null,exports:{setup(e){this.sprite=at("lead","admin"),this.state={addButtonList:[{id:"ecommerce",title:tr("admin::lead::products::add_product_button")},{id:"custom",title:tr("admin::lead::products::add_hand_button")}]}},addProduct(e){flexbe.trigger("closeDropdown"),"custom"===e.id?this.addCustomProduct():this.showEcommerceProductSelect()},addCustomProduct(){const e={count:1,price:0,id:`admin_${Ge(10)}`,title:""};this.props.onAdd("custom",[e])},showEcommerceProductSelect(){!function({modalOptions:e,settings:t,addProducts:s}){Zs.create({width:740,height:530,title:tr("admin::select_product::title"),component:"flexbe-select-product",overlay:!0,shadow:!0,scrollable:!1,uiClass:"editor-ui",fromModal:t.modal,...e,props:{settings:{needVariants:!1,massAddProducts:!1,connectionProduct:!1,...t},addProducts:s}})}({settings:{needVariants:!0,massAddProducts:!0},addProducts:async e=>{this.props.onAdd("products",e)}})}},template:(e,t,s,i)=>e('<div expr732="expr732" is="flexbe-button" class="flexbe-button-dropdown is-secondary filled medium" dropdown-position="center"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-lead-view-products-add ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-button",slots:[{id:"dropdown",html:'<div expr733="expr733" slot="dropdown" is="flexbe-list" class="flexbe-list hoverable hoverable-background borderless vertical-gaps"></div>',bindings:[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-list",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.state.addButtonList},{type:t.EVENT,name:"onSelect",evaluate:e=>e.addProduct}],redundantAttribute:"expr733",selector:"[expr733]"}]}],attributes:[{type:t.ATTRIBUTE,name:"text",evaluate:e=>e.tr("admin::lead::products::add_product_button")},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>[e.sprite,"#plus"].join("")},{type:t.ATTRIBUTE,name:"icon-size",evaluate:e=>12},{type:t.ATTRIBUTE,name:"show-arrow",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"dropdown-arrow",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"dropdown-autohide",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"dropdown-append-to-body",evaluate:e=>!0}],redundantAttribute:"expr732",selector:"[expr732]"}]),name:"admin-lead-view-products-add"};e(Gr.name,Gr),riot3.tag2("admin-lead-status-confirm-cancelation-modal",'<div class="flexbe-modal-content"> <div class="flexbe-list"> <div class="flexbe-list-item product-item" each="{product in list}"> <div class="product-item__image"> <span class="image" if="{product.img.id}" riot-style="background-image: url({getImg(product.img.id, product.images)})"></span> <svg class="flexbe-icon size-22" if="{!product.img.id}"> <use riot-xlink:href="{sprite}#placeholder-product"></use> </svg> </div> <div class="product-item__title"> <div class="vendor-code" if="{product.variant && product.variant.vendor_code}"> {product.variant.vendor_code} </div> <div class="title"> {product.title} </div> <div class="options-info"> <div if="{product.optionFormat.length}" class="options" product="{product}" each="{option, index  in product.optionFormat}"> <span if="{option.data.type === \'color\'}" class="option-color" riot-style="background: {option.values.data.color}"></span> <span>{option.values.name}</span> <virtual if="{index !== product.optionFormat.length - 1}">,</virtual> </div> </div> <div class="error" if="{getError(product)}"> {getError(product)} </div> </div> <div class="product-item__subtracted"> <div data-is="flexbe-input" class="transparent small" min="0" max="{+product.initial_subtracted}" max-length="{(product.initial_subtracted + \'\').length}" riot-value="{product.subtracted_quantity}" oninput="{tag.setSubtracted.bind(tag, product)}" type="{\'number\'}"></div> </div> </div> </div> </div> <div class="flexbe-modal-footer"> <div class="flexbe-button is-primary filled" onclick="{confirmCancelation}"> <span class="flexbe-text">{tr(\'admin::lead::actions::confirm_cancel::confirm\')}</span> </div> <div class="flexbe-button filled" onclick="{closeModal}"> <span class="flexbe-text">{tr(\'admin::lead::actions::confirm_cancel::cancel\')}</span> </div> </div>',"",'class="admin-lead-status-confirm-cancelation-modal {opts.class}"',(function(e){this.sprite=at("lead","admin"),this.list=[],this.getOption=function(e,t){if(!t.options.length)return!1;return t.options.map((t=>{if(t.id===e.option_id)return{...t,values:t.values.filter((t=>t.id===e.value_id))[0]}})).filter((e=>e))[0]}.bind(this),this.getImg=function(e,t){return pt(t.filter((t=>t.id===e))[0],120)}.bind(this),this.getError=function(e){return e.subtracted_quantity!==e.count?tr("admin::lead::actions::confirm_cancel::error_text",{count:e.count}):null}.bind(this),this.setSubtracted=function(e,t){const s=+t.target.value;e.subtracted_quantity!==s&&(e.subtracted_quantity=s)}.bind(this),this.closeModal=function(){e.modal.close()}.bind(this),this.confirmCancelation=function(){e.modal.productsList=this.list,e.modal.close()}.bind(this),this.onBeforeMount=function(){e.list.forEach((e=>{this.list.push({...e,count:+e.count,optionFormat:e.variant.option_values.length?e.variant.option_values.map((t=>this.getOption(t,e))):[],subtracted_quantity:+e.count,initial_subtracted:+e.variant.quantity})}))}.bind(this)}));const Xr={css:null,exports:{setup(e,{inject:t}){var s,i,a,n;this.modal=t("modal"),this.state={discountAmount:null!=(s=null==(i=e.props)?void 0:i.discountAmount)?s:"",discountType:null!=(a=null==(n=e.props)?void 0:n.discountType)?a:"money",lastDiscountAmount:{},saving:!1,removing:!1,get mode(){return e.props.mode},get maxDiscountAmount(){var t,s;return null!=(t=null==(s=e.props)?void 0:s.maxCurrencyAmount)?t:1/0}},this.meta={get discountTypeSymbols(){return{money:flexbe.vars.group.currency.symbol,percent:"%"}},get discountSuffix(){return this.discountTypeSymbols[e.state.discountType]},get discountTypeList(){return Object.entries(this.discountTypeSymbols).map((([e,t])=>({value:e,title:t})))}}},setDiscountAmount(e){const t=+e.target.value;this.state.discountAmount=t,this.state.error="percent"===this.state.discountType&&t>100||"money"===this.state.discountType&&t>this.state.maxDiscountAmount,this.update()},setDiscountType(e){const t=e.value,s=this.state.discountAmount;this.state.discountType!==t&&(this.state.discountAmount=this.state.lastDiscountAmount[t],this.state.lastDiscountAmount[this.state.discountType]=s,this.state.discountType=t,this.update()),$(this.root).find(".discount-amount-input input").trigger("focus")},async removeDiscount(){var e,t;this.state.removing=!0,this.update(),await(null==(e=(t=this.props).onRemove)?void 0:e.call(t)),this.state.removing=!1,this.modalClose()},async saveDiscount(e){var t,s,i,a;const n=null!=(t=null==(s=e.target)?void 0:s.value)?t:this.state.discountAmount,r=this.state.discountType;this.state.error||(n?(this.state.saving=!0,this.update(),await(null==(i=(a=this.props).onSave)?void 0:i.call(a,{type:"discount",discountAmount:n.toString(),discountType:r})),this.state.saving=!1,this.modalClose()):"edit"===this.state.mode?this.removeDiscount():this.modalClose())},modalClose(){this.modal.close()}},template:(e,t,s,i)=>e('<div expr734="expr734" class="flexbe-title"> </div><div class="flexbe-field-group row"><div expr735="expr735" is="flexbe-input" class="col col-7 discount-amount-input" type="number"></div><div expr736="expr736" is="flexbe-buttons-line" class="is-group not-equal col col-5" role="radio"></div></div><div class="flexbe-buttons-line"><div expr737="expr737"><span expr738="expr738" class="flexbe-text"> </span></div><div expr739="expr739" class="flexbe-button filled default"><span expr740="expr740" class="flexbe-text"> </span></div><div expr741="expr741" class="remove-promotion"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"admin-lead-promotion-add-discount-modal flexbe-modal-content"}]},{redundantAttribute:"expr734",selector:"[expr734]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::lead::promotion::discount::amount_title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"max-length",evaluate:e=>21},{type:t.ATTRIBUTE,name:"min",evaluate:e=>0},{type:t.ATTRIBUTE,name:"suffix",evaluate:e=>e.meta.discountSuffix},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.discountAmount},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.state.error},{type:t.ATTRIBUTE,name:"error-tip",evaluate:e=>e.tr("admin::lead::promotion::amount_more_sum_error")},{type:t.EVENT,name:"oninput",evaluate:e=>e.setDiscountAmount},{type:t.EVENT,name:"onchange",evaluate:e=>e.setDiscountAmount},{type:t.EVENT,name:"onenter",evaluate:e=>e.saveDiscount},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0}],redundantAttribute:"expr735",selector:"[expr735]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-buttons-line",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.discountTypeList},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.discountType},{type:t.EVENT,name:"onchange",evaluate:e=>e.setDiscountType}],redundantAttribute:"expr736",selector:"[expr736]"},{redundantAttribute:"expr737",selector:"[expr737]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button filled is-primary ",e.classNames({loading:e.state.saving})].join("")},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.removing||e.state.error},{type:t.EVENT,name:"onclick",evaluate:e=>e.saveDiscount}]},{redundantAttribute:"expr738",selector:"[expr738]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::button::apply")].join("")}]},{redundantAttribute:"expr739",selector:"[expr739]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.modalClose}]},{redundantAttribute:"expr740",selector:"[expr740]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::button::cancel")].join("")}]},{type:s.IF,evaluate:e=>"edit"===e.state.mode,redundantAttribute:"expr741",selector:"[expr741]",template:e('<div expr742="expr742" is="flexbe-loader"></div><span expr743="expr743" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.removeDiscount},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.saving}]},{type:s.IF,evaluate:e=>e.state.removing,redundantAttribute:"expr742",selector:"[expr742]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[]}])},{redundantAttribute:"expr743",selector:"[expr743]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::promotion::remove_discount")}]}])}]),name:"admin-lead-promotion-add-discount-modal"};e(Xr.name,Xr);const Kr={css:null,exports:{setup(e,{inject:t}){var s,i,a;this.modal=t("modal"),this.state={initialCode:null==(s=e.props)?void 0:s.code,code:null!=(i=null==(a=e.props)?void 0:a.code)?i:"",saving:!1,removing:!1,get mode(){return e.props.mode}},this.meta={sprite:at("lead","admin"),adminPromocodesHref:"/admin/settings/ecommerce/promotion/#promocode"}},setPromocode(e){this.state.code=e.target.value.toUpperCase(),this.state.error=null,this.update()},setDiscountType(e){const t=e.value,s=this.state.discountAmount;this.state.discountType!==t&&(this.state.discountAmount=this.state.lastDiscountAmount[t],this.state.lastDiscountAmount[this.state.discountType]=s,this.state.discountType=t,this.update())},async removePromcoode(){var e,t;this.state.removing=!0,this.update(),await(null==(e=(t=this.props).onRemove)?void 0:e.call(t)),this.state.removing=!1,this.modalClose()},async savePromocode(){const{code:e}=this.state;if(!this.state.error)if(e)if(this.state.initialCode!==e){this.state.saving=!0,this.update();try{var t,s;await(null==(t=(s=this.props).onSave)?void 0:t.call(s,e)),this.modalClose(),this.state.error=null}catch(e){"promocode_not_found"===e.message?this.state.error=tr("admin::lead::promotion::notfound_error"):this.state.error=tr("admin::lead::promotion::default_error")}this.state.saving=!1,this.update()}else this.modalClose();else"edit"===this.state.mode?this.removePromcoode():this.modalClose()},modalClose(){this.modal.close()}},template:(e,t,s,i)=>e('<div class="flexbe-title"><span expr744="expr744" class="flexbe-text"> </span><a expr745="expr745" class="promocode-link" target="_blank"><svg class="flexbe-icon size-14"><use expr746="expr746"/></svg><span expr747="expr747" class="flexbe-text"> </span></a></div><div class="flexbe-field-group"><div expr748="expr748" is="flexbe-input" class="promocode-input" type="text"></div><span expr749="expr749" class="flexbe-text promocode-error"></span></div><div class="flexbe-buttons-line"><div expr750="expr750"><span expr751="expr751" class="flexbe-text"> </span></div><div expr752="expr752" class="flexbe-button filled default"><span expr753="expr753" class="flexbe-text"> </span></div><div expr754="expr754" class="remove-promotion"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"admin-lead-promotion-add-promocode-modal flexbe-modal-content"}]},{redundantAttribute:"expr744",selector:"[expr744]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::promotion::promocode::title")}]},{redundantAttribute:"expr745",selector:"[expr745]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.meta.adminPromocodesHref}]},{redundantAttribute:"expr746",selector:"[expr746]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#promocode-link"].join("")}]},{redundantAttribute:"expr747",selector:"[expr747]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::promotion::promocode_link")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"max-length",evaluate:e=>30},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.state.error},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.code},{type:t.ATTRIBUTE,name:"pattern",evaluate:e=>/[a-zA-Z--_.-\d]/g},{type:t.EVENT,name:"onchange",evaluate:e=>e.setPromocode},{type:t.EVENT,name:"oninput",evaluate:e=>e.setPromocode},{type:t.EVENT,name:"onenter",evaluate:e=>e.savePromocode},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0}],redundantAttribute:"expr748",selector:"[expr748]"},{type:s.IF,evaluate:e=>e.state.error,redundantAttribute:"expr749",selector:"[expr749]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.error}]}])},{redundantAttribute:"expr750",selector:"[expr750]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button filled is-primary ",e.classNames({loading:e.state.saving})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.savePromocode},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.removing||e.state.error}]},{redundantAttribute:"expr751",selector:"[expr751]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::button::apply")].join("")}]},{redundantAttribute:"expr752",selector:"[expr752]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.modalClose}]},{redundantAttribute:"expr753",selector:"[expr753]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::button::cancel")].join("")}]},{type:s.IF,evaluate:e=>"edit"===e.state.mode,redundantAttribute:"expr754",selector:"[expr754]",template:e('<div expr755="expr755" is="flexbe-loader"></div><span expr756="expr756" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.removePromcoode},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.saving}]},{type:s.IF,evaluate:e=>e.state.removing,redundantAttribute:"expr755",selector:"[expr755]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[]}])},{redundantAttribute:"expr756",selector:"[expr756]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::promotion::remove_promocode")}]}])}]),name:"admin-lead-promotion-add-promocode-modal"};e(Kr.name,Kr);const Wr=(e,t=[])=>{const s={...e};return t.forEach((t=>{e[t]&&delete s[t]})),s},Zr={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={value:"Contains",valueMin:"",valueMax:"",valueInput:"",get showIndicator(){return Object.keys(this.filterParams).some((t=>t.includes(e.meta.id)))},get filterParams(){return e.props.params.filter||{}},get nameHeader(){return e.props.data.name},get isContains(){return"Contains"===this.value},get addon(){return this.showIndicator?this.arrow:""},get arrow(){return{arrow:{icon:`${e.props.sprite}#indicator`,size:6}}},get overflow(){return{x:0}}},this.meta={get id(){return e.props.data.id},get nameMin(){return`${this.id}Min`},get nameMax(){return`${this.id}Max`},get list(){return[{value:"Contains",icon:"range",tip:tr("admin::lead::list::filter::tip::range")},{value:"Equals",icon:"equal",tip:tr("admin::lead::list::filter::tip::equal")}]}},this.watch={"state.value":[()=>this.update()],"state.valueMin":[()=>this.update()],"state.valueMax":[()=>this.update()],"state.valueInput":[()=>this.update()],"state.showIndicator":[()=>this.update()]}},normalizeInputValue:e=>e.replace(/\D/g,""),setListItem(e){this.state.value=e.value},setInputValue(e,t){this.state[t]=e.target.value},onMounted(){this.syncFilters()},onUpdated(){this.props.updateSortCount(this.meta.id,this.state.showIndicator)},setFilters(){const{nameMin:e,nameMax:t,id:s}=this.meta,{valueInput:i,valueMin:a,valueMax:n,value:r}=this.state,o=this.state.filterParams,l=Wr(o,[e,t,s]);switch(r){case"Contains":let r;if(!a&&!n&&!o.hasOwnProperty(e)&&!o.hasOwnProperty(t)||a===o[e]&&n===o[t])return;r=a||n||!o.hasOwnProperty(e)&&!o.hasOwnProperty(t)?a?n?{[e]:a,[t]:n}:{[e]:a}:{[t]:n}:{},this.props.loadData({page:1,filter:{...l,...r}});break;case"Equals":if(!i&&!o.hasOwnProperty(s)||i===o[s])return;const d=i?{[s]:this.state.valueInput}:{};this.props.loadData({page:1,filter:{...l,...d}})}},resetFilter(){const{nameMin:e,nameMax:t,id:s}=this.meta,i=this.state.filterParams,a=Wr(i,[e,t,s]);this.props.loadData({page:1,filter:a}),this.state.valueMin="",this.state.valueMax="",this.state.valueInput=""},syncFilters(){const{nameMin:e,nameMax:t,id:s}=this.meta,i=this.state.filterParams;this.state.valueMax=(null==i?void 0:i[t])||"",this.state.valueMin=(null==i?void 0:i[e])||"",this.state.valueInput=(null==i?void 0:i[s])||""}},template:(e,t,s,i)=>e('<submenu expr757="expr757" class="flexbe-list-item"></submenu>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.props.class}]},{type:s.TAG,getComponent:i,evaluate:e=>"submenu",slots:[{id:"default",html:'<div class="dropdown-header lead-submenu-dropdown-header"><span expr758="expr758" class="flexbe-title"> </span><span expr759="expr759" class="flexbe-desc"></span></div><div class="p15"><div class="flexbe-field-group"><div expr760="expr760" is="flexbe-switch" class="stretched"></div></div><div expr761="expr761" class="flexbe-field-group row"></div><div expr766="expr766" class="flexbe-field-group"></div><div expr768="expr768" class="flexbe-button is-secondary filled w100"><span expr769="expr769" class="weight-medium"> </span></div></div>',bindings:[{redundantAttribute:"expr758",selector:"[expr758]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.nameHeader}]},{type:s.IF,evaluate:e=>e.state.showIndicator,redundantAttribute:"expr759",selector:"[expr759]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::lead::list::filter::dropping")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.resetFilter}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-switch",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.list},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.value},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.props.sprite},{type:t.EVENT,name:"onChange",evaluate:e=>e.setListItem}],redundantAttribute:"expr760",selector:"[expr760]"},{type:s.IF,evaluate:e=>e.state.isContains,redundantAttribute:"expr761",selector:"[expr761]",template:e('<div class="col col-6 pr5"><span expr762="expr762" class="flexbe-title"> </span><div expr763="expr763" is="flexbe-input"></div></div><div class="col col-6 pl5"><span expr764="expr764" class="flexbe-title"> </span><div expr765="expr765" is="flexbe-input"></div></div>',[{redundantAttribute:"expr762",selector:"[expr762]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::lead::list::filter::number_amount::from")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"max-length",evaluate:e=>15},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>2e3},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.valueMin},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.setInputValue(t,"valueMin")},{type:t.EVENT,name:"onenter",evaluate:e=>e.setFilters},{type:t.ATTRIBUTE,name:"normalize",evaluate:e=>e.normalizeInputValue}],redundantAttribute:"expr763",selector:"[expr763]"},{redundantAttribute:"expr764",selector:"[expr764]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::lead::list::filter::number_amount::to")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"max-length",evaluate:e=>15},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>3500},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.valueMax},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.setInputValue(t,"valueMax")},{type:t.EVENT,name:"onenter",evaluate:e=>e.setFilters},{type:t.ATTRIBUTE,name:"normalize",evaluate:e=>e.normalizeInputValue}],redundantAttribute:"expr765",selector:"[expr765]"}])},{type:s.IF,evaluate:e=>!e.state.isContains,redundantAttribute:"expr766",selector:"[expr766]",template:e('<div expr767="expr767" is="flexbe-input"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"max-length",evaluate:e=>15},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>2e3},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.valueInput},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.setInputValue(t,"valueInput")},{type:t.EVENT,name:"onenter",evaluate:e=>e.setFilters},{type:t.ATTRIBUTE,name:"normalize",evaluate:e=>e.normalizeInputValue}],redundantAttribute:"expr767",selector:"[expr767]"}])},{redundantAttribute:"expr768",selector:"[expr768]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.setFilters}]},{redundantAttribute:"expr769",selector:"[expr769]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::list::filter::apply")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"name",evaluate:e=>e.state.nameHeader},{type:t.ATTRIBUTE,name:"width",evaluate:e=>240},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.props.data.icon},{type:t.ATTRIBUTE,name:"addon",evaluate:e=>e.state.addon},{type:t.ATTRIBUTE,name:"overflow",evaluate:e=>e.state.overflow}],redundantAttribute:"expr757",selector:"[expr757]"}]),name:"admin-lead-submenu-number-amount"};e(Zr.name,Zr);const Yr={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={value:"Contains",valueInput:"",get showIndicator(){return Object.keys(this.filterParams).some((t=>t.includes(e.meta.id)))},get filterParams(){return e.props.params.filter||{}},get headerName(){return e.props.data.name},get isEmpty(){return"empty"===this.value},get addon(){return this.showIndicator?this.arrow:""},get arrow(){return{arrow:{icon:`${e.props.sprite}#indicator`,size:6}}},get overflow(){return{x:0}}},this.meta={get id(){return e.props.data.id},get Equals(){return`${this.id}Equals`},get Contains(){return`${this.id}Contains`},get NotContains(){return`${this.id}NotContains`},get list(){return[{value:"Contains",icon:"contains",tip:tr("admin::lead::list::filter::tip::contains")},{value:"NotContains",icon:"not-contains",tip:tr("admin::lead::list::filter::tip::not_contains")},{value:"empty",icon:"empty",tip:tr("admin::lead::list::filter::tip::empty")}]}},this.watch={"state.value":[()=>this.update()],"state.valueInput":[()=>this.update()],"state.showIndicator":[()=>this.update()]}},setListItem(e){this.state.value=e.value},setInputValue(e){this.state.valueInput=e.target.value},onUpdated(){this.props.updateSortCount(this.meta.id,this.state.showIndicator)},onMounted(){this.syncFilters()},onSave(){const{valueInput:e,value:t,filterParams:s}=this.state,i=`${this.meta.id}${this.state.value}`,{Equals:a,Contains:n,NotContains:r}=this.meta,o=Wr(this.state.filterParams,[a,n,r]);if(e||"empty"===t)this.setFilters();else{if(!e&&!s.hasOwnProperty(i)||e===s[i])return;this.props.loadData({page:1,filter:o})}},setFilters(){const e=`${this.meta.id}${this.state.value}`,{valueInput:t,filterParams:s}=this.state,{Equals:i,Contains:a,NotContains:n}=this.meta,r=Wr(this.state.filterParams,[i,a,n]);"empty"!==this.state.value?t!==s[e]&&this.props.loadData({page:1,filter:{...r,[e]:this.state.valueInput}}):this.props.loadData({page:1,filter:{...r,[i]:"empty"}})},resetFilter(){const{Equals:e,Contains:t,NotContains:s}=this.meta,i=this.state.filterParams,a=Wr(i,[e,t,s]);this.props.loadData({page:1,filter:a}),this.state.valueInput=""},syncFilters(){const{filterParams:e}=this.state,{Equals:t,Contains:s,NotContains:i}=this.meta;"empty"===e[t]?this.state.value="empty":e[t]?(this.state.value="Equals",this.state.valueInput=e[t]):e[s]?(this.state.value="Contains",this.state.valueInput=e[s]):e[i]&&(this.state.value="NotContains",this.state.valueInput=e[i])}},template:(e,t,s,i)=>e('<submenu expr770="expr770" class="flexbe-list-item"></submenu>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-lead-submenu-name-email-phone ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"submenu",slots:[{id:"default",html:'<div class="dropdown-header lead-submenu-dropdown-header"><span expr771="expr771" class="flexbe-title"> </span><span expr772="expr772" class="flexbe-desc"></span></div><div class="p15"><div class="flexbe-field-group"><div expr773="expr773" is="flexbe-switch" class="stretched"></div></div><div expr774="expr774" class="flexbe-field-group"></div><div expr776="expr776" class="flexbe-button is-secondary filled w100"><span expr777="expr777" class="weight-medium"> </span></div></div>',bindings:[{redundantAttribute:"expr771",selector:"[expr771]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.headerName}]},{type:s.IF,evaluate:e=>e.state.showIndicator,redundantAttribute:"expr772",selector:"[expr772]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::lead::list::filter::dropping")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.resetFilter}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-switch",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.list},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.value},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.props.sprite},{type:t.EVENT,name:"onChange",evaluate:e=>e.setListItem}],redundantAttribute:"expr773",selector:"[expr773]"},{type:s.IF,evaluate:e=>!e.state.isEmpty,redundantAttribute:"expr774",selector:"[expr774]",template:e('<div expr775="expr775" is="flexbe-input"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:null,evaluate:e=>e.props.data.inputProps},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"required",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.valueInput},{type:t.EVENT,name:"onenter",evaluate:e=>e.onSave},{type:t.EVENT,name:"oninput",evaluate:e=>e.setInputValue}],redundantAttribute:"expr775",selector:"[expr775]"}])},{redundantAttribute:"expr776",selector:"[expr776]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.onSave}]},{redundantAttribute:"expr777",selector:"[expr777]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::list::filter::apply")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"name",evaluate:e=>e.state.headerName},{type:t.ATTRIBUTE,name:"width",evaluate:e=>240},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.props.data.icon},{type:t.ATTRIBUTE,name:"addon",evaluate:e=>e.state.addon},{type:t.ATTRIBUTE,name:"overflow",evaluate:e=>e.state.overflow}],redundantAttribute:"expr770",selector:"[expr770]"}]),name:"admin-lead-submenu-name-email-phone"};e(Yr.name,Yr);const Jr={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get list(){const t=e.props.data.list||[],s=this.filterParams[this.id]||[];return t.forEach((e=>{e.checked=Array.from(s).includes(e.value)})),t},get showIndicator(){var e;return!(null==(e=this.filterParams[this.id])||!e.length)},get id(){return e.props.data.id},get filterParams(){return e.props.params.filter||{}},get addon(){return this.showIndicator?this.arrow:""},get arrow(){return{arrow:{icon:`${e.props.sprite}#indicator`,size:6}}},get overflow(){return{x:0}}},this.watch={"state.showIndicator":[()=>this.update()],"state.list":[()=>this.update(),{deep:!0}]}},onUpdated(){const{id:e,showIndicator:t}=this.state;this.props.updateSortCount(e,t)},addFilter(e,t){const{filterParams:s,id:i}=this.state;t.item.checked=e.target.checked;const a=this.state.list.filter((e=>e.checked)).map((e=>e.value));this.props.loadData({page:1,filter:{...s,[i]:a}})},resetFilter(){var e;const{filterParams:t,id:s}=this.state;if(null==t||null==(e=t[s])||!e.length)return;const i=Object.keys(t).some((e=>e===s));if(this.state.list.map((e=>e.checked=!1)),i){const e=Wr(t,[s]);this.props.loadData({page:1,filter:e})}}},template:(e,t,s,i)=>e('<submenu expr778="expr778" class="flexbe-list-item"></submenu>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-lead-submenu-list ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"submenu",slots:[{id:"default",html:'<div class="dropdown-header lead-submenu-dropdown-header"><span expr779="expr779" class="flexbe-title"> </span><div expr780="expr780" class="flexbe-desc"></div></div><div class="flexbe-list hoverable hoverable-background borderless vertical-gaps"><label expr781="expr781" is="flexbe-checkbox" class="flexbe-list-item" type="checkbox"></label></div>',bindings:[{redundantAttribute:"expr779",selector:"[expr779]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.props.data.name}]},{type:s.IF,evaluate:e=>e.state.showIndicator,redundantAttribute:"expr780",selector:"[expr780]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::lead::list::filter::dropping")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.resetFilter}]}])},{type:s.EACH,getKey:null,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr782="expr782"> </span><span expr783="expr783"></span>',bindings:[{redundantAttribute:"expr782",selector:"[expr782]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.title}]},{type:s.IF,evaluate:e=>"LeadStatus"===e.state.id,redundantAttribute:"expr783",selector:"[expr783]",template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["lead-status-label code-",e.item.value," ml-auto"].join("")}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.item.checked},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.addFilter(t,e)}]}]),redundantAttribute:"expr781",selector:"[expr781]",itemName:"item",indexName:null,evaluate:e=>e.state.list}]}],attributes:[{type:t.ATTRIBUTE,name:"name",evaluate:e=>e.props.data.name},{type:t.ATTRIBUTE,name:"width",evaluate:e=>240},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.props.data.icon},{type:t.ATTRIBUTE,name:"addon",evaluate:e=>e.state.addon},{type:t.ATTRIBUTE,name:"overflow",evaluate:e=>e.state.overflow}],redundantAttribute:"expr778",selector:"[expr778]"}]),name:"admin-lead-submenu-list"};e(Jr.name,Jr);const Qr={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={value:"Contains",dateFrom:"",dateTo:"",valueInput:"",dateMask:flexbe.vars.user.date_format.date||"d.m.Y",get showIndicator(){const t=Object.keys(this.filterParams),{dateToName:s,dateFromName:i}=e.meta;return t.some((e=>e.includes(s)||e.includes(i)))},get displayDateFormat(){let e=this.dateMask;return e=e.replace(/d+/i,"DD"),e=e.replace(/m+/i,"MM"),e=e.replace(/y+/i,"YYYY"),e},get filterParams(){return e.props.params.filter||{}},get headerName(){return e.props.data.name},get icon(){return e.props.data.icon},get isContains(){return"Contains"===this.value},get addon(){return this.showIndicator?this.arrow:""},get arrow(){return{arrow:{icon:`${e.props.sprite}#indicator`,size:6}}},get overflow(){return{x:0}}},this.meta={dateToName:`${e.props.data.id}To`,dateFromName:`${e.props.data.id}From`,get list(){return[{value:"Contains",icon:"range",tip:tr("admin::lead::list::filter::tip::range")},{value:"Equals",icon:"equal",tip:tr("admin::lead::list::filter::tip::equal")}]}},this.watch={"state.value":[()=>this.update()],"state.dateFrom":[()=>this.update()],"state.dateTo":[()=>this.update()],"state.valueInput":[()=>this.update()],"state.showIndicator":[()=>this.update()]}},onBeforeMount(){this.syncFilters()},onUpdated(){this.props.updateSortCount(this.props.data.id,this.state.showIndicator)},setListItem(e){this.state.value=e.value},setInputValue(e,t){"string"==typeof e.value&&(this.state[t]=e.value)},parsedDateValue(e){const{date:t,month:s,year:i}=Ke(e,this.state.dateMask);return`${t}.${s}.${i}`},unparsedDateValue(e){const{date:t,month:s,year:i}=Ke(e,"d.m.y");return Xe(`${+i}/${+s}/${+t}`,this.state.dateMask)},setFilters(){const{dateToName:e,dateFromName:t}=this.meta,{dateTo:s,dateFrom:i,valueInput:a,value:n,filterParams:r}=this.state,o=Wr(r,[t,e]);switch(n){case"Contains":let n;if(!i&&!s&&!r.hasOwnProperty(t)&&!r.hasOwnProperty(e)||i===r[t]&&s===r[e])return;n=i||s||!r.hasOwnProperty(t)&&!o.hasOwnProperty(e)?i?s?{[t]:this.parsedDateValue(i),[e]:this.parsedDateValue(s)}:{[t]:this.parsedDateValue(i)}:{[e]:this.parsedDateValue(s)}:{},this.props.loadData({page:1,filter:{...o,...n}});break;case"Equals":if(!a&&!r.hasOwnProperty(e)||a===r[e])return;const l=a?{[e]:this.parsedDateValue(this.state.valueInput),[t]:this.parsedDateValue(this.state.valueInput)}:{};this.props.loadData({page:1,filter:{...o,...l}})}},resetFilter(){const{dateToName:e,dateFromName:t}=this.meta,s=this.state.filterParams,i=Wr(s,[t,e]);this.props.loadData({page:1,filter:i}),this.state.dateTo="",this.state.dateFrom="",this.state.valueInput=""},syncFilters(){const{dateToName:e,dateFromName:t}=this.meta,s=this.state.filterParams;s[e]&&(this.state.dateTo=this.unparsedDateValue(String(s[e]))||""),s[t]&&(this.state.dateFrom=this.unparsedDateValue(s[t])||""),s[t]&&(this.state.valueInput=this.unparsedDateValue(s[t])||"")}},template:(e,t,s,i)=>e('<submenu expr784="expr784" class="flexbe-list-item"></submenu>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.props.class}]},{type:s.TAG,getComponent:i,evaluate:e=>"submenu",slots:[{id:"default",html:'<div class="dropdown-header lead-submenu-dropdown-header"><span expr785="expr785" class="flexbe-title"> </span><span expr786="expr786" class="flexbe-desc"></span></div><div class="p15"><div class="flexbe-field-group"><div expr787="expr787" is="flexbe-switch" class="stretched"></div></div><div expr788="expr788" class="flexbe-field-group row"></div><div expr793="expr793" class="flexbe-field-group"></div><div expr795="expr795" class="flexbe-button is-secondary filled w100"><span expr796="expr796" class="weight-medium"> </span></div></div>',bindings:[{redundantAttribute:"expr785",selector:"[expr785]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.headerName}]},{type:s.IF,evaluate:e=>e.state.showIndicator,redundantAttribute:"expr786",selector:"[expr786]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::lead::list::filter::dropping")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.resetFilter}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-switch",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.list},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.value},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.props.sprite},{type:t.EVENT,name:"onChange",evaluate:e=>e.setListItem}],redundantAttribute:"expr787",selector:"[expr787]"},{type:s.IF,evaluate:e=>e.state.isContains,redundantAttribute:"expr788",selector:"[expr788]",template:e('<div class="col col-6 pr5"><span expr789="expr789" class="flexbe-title"> </span><div expr790="expr790" is="flexbe-date-input"></div></div><div class="col col-6 pl5"><span expr791="expr791" class="flexbe-field-group flexbe-title"> </span><div expr792="expr792" is="flexbe-date-input"></div></div>',[{redundantAttribute:"expr789",selector:"[expr789]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::list::filter::number_amount::from")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-date-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.state.displayDateFormat},{type:t.ATTRIBUTE,name:"date-mask",evaluate:e=>e.state.dateMask},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.dateFrom},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.setInputValue(t,"dateFrom")},{type:t.EVENT,name:"onenter",evaluate:e=>e.setFilters}],redundantAttribute:"expr790",selector:"[expr790]"},{redundantAttribute:"expr791",selector:"[expr791]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::list::filter::number_amount::to")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-date-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.state.displayDateFormat},{type:t.ATTRIBUTE,name:"date-mask",evaluate:e=>e.state.dateMask},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.dateTo},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.setInputValue(t,"dateTo")},{type:t.EVENT,name:"onenter",evaluate:e=>e.setFilters}],redundantAttribute:"expr792",selector:"[expr792]"}])},{type:s.IF,evaluate:e=>!e.state.isContains,redundantAttribute:"expr793",selector:"[expr793]",template:e('<div expr794="expr794" is="flexbe-date-input"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-date-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.state.displayDateFormat},{type:t.ATTRIBUTE,name:"date-mask",evaluate:e=>e.state.dateMask},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.valueInput},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.setInputValue(t,"valueInput")},{type:t.EVENT,name:"onenter",evaluate:e=>e.setFilters}],redundantAttribute:"expr794",selector:"[expr794]"}])},{redundantAttribute:"expr795",selector:"[expr795]",expressions:[{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.setFilters}]},{redundantAttribute:"expr796",selector:"[expr796]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::lead::list::filter::apply")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"name",evaluate:e=>e.state.headerName},{type:t.ATTRIBUTE,name:"width",evaluate:e=>240},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.state.icon},{type:t.ATTRIBUTE,name:"addon",evaluate:e=>e.state.addon},{type:t.ATTRIBUTE,name:"overflow",evaluate:e=>e.state.overflow}],redundantAttribute:"expr784",selector:"[expr784]"}]),name:"admin-lead-submenu-date"};e(Qr.name,Qr);const eo={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={list:e.props.data.list,currentSort:{name:"",value:""},get showIndicator(){const{name:e}=this.currentSort;return!!e&&"empty"!==e},get sortingParams(){return e.props.params.sorting||{}},get name(){return e.props.data.name},get addon(){return this.showIndicator?this.arrow:""},get arrow(){return{arrow:{icon:`${e.props.sprite}#indicator`,size:6}}},get nameCurrentSort(){let e;return this.list.forEach((t=>{t.value===this.currentSort.name&&(e=t.title)})),e},get overflow(){return{x:0}}},this.watch={"state.currentSort":[()=>this.update(),{deep:!0}],"state.showIndicator":[()=>this.update()]}},onBeforeMount(){this.syncFilters()},onUpdated(){this.syncFilters()},changeSort(e){const t=$(e.target),s=t.attr("date-name"),i=t.find(".arrow-content").hasClass("desc")?"asc":"desc";this.state.currentSort={name:s,value:i},this.addFilter(s,i)},hover(e){const t=$(e.target).attr("date-name");this.state.list.map((e=>(e.value===t&&"empty"!==t&&(e.showArrow=!0),e))),this.update()},unhover(e){const t=$(e.target).attr("date-name");this.state.list.map((e=>(e.value===t&&e.value!==this.state.currentSort.name&&(e.showArrow=!1),e)))},addFilter(e,t){this.state.list.map((t=>(t.value!==e&&(t.showArrow=!1),t))),"empty"===e?this.props.loadData({page:1,sorting:{}}):this.props.loadData({page:1,sorting:{[e]:t}})},syncFilters(){var e,t,s,i;const{list:a,sortingParams:n}=this.state,r=null==(e=Object.entries(n))||null==(t=e[0])?void 0:t[0],o=null==(s=Object.entries(n))||null==(i=s[0])?void 0:i[1];a.map((e=>(Object.keys(n).length&&r===e.value?(this.state.currentSort.name=e.value,this.state.currentSort.value=o,e.showArrow=!0):e.showArrow=!1,e)));a.filter((e=>e.showArrow)).length||(this.state.currentSort.name="",this.state.currentSort.value="")}},template:(e,t,s,i)=>e('<submenu expr797="expr797" class="flexbe-list-item"></submenu>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-lead-submenu-sort ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"submenu",slots:[{id:"default",html:'<div class="flexbe-list hoverable hoverable-background borderless vertical-gaps"><div expr798="expr798" class="flexbe-list-item"></div></div>',bindings:[{type:s.EACH,getKey:null,condition:null,template:e('<div expr799="expr799"> </div><div expr800="expr800"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"date-name",evaluate:e=>e.item.value},{type:t.EVENT,name:"onmouseenter",evaluate:e=>e.hover},{type:t.EVENT,name:"onmouseleave",evaluate:e=>e.unhover},{type:t.EVENT,name:"onclick",evaluate:e=>e.changeSort}]},{redundantAttribute:"expr799",selector:"[expr799]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.item.title},{type:t.ATTRIBUTE,name:"date-name",evaluate:e=>e.item.value}]},{type:s.IF,evaluate:e=>e.item.showArrow,redundantAttribute:"expr800",selector:"[expr800]",template:e('<svg expr801="expr801" is="flexbe-icon" size="10" icon="arrow-desc"></svg><svg expr802="expr802" is="flexbe-icon" size="10" icon="arrow-asc"></svg>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["arrow-content ",e.item.value===e.state.currentSort.name?e.state.currentSort.value:""].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.props.sprite}],redundantAttribute:"expr801",selector:"[expr801]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.props.sprite}],redundantAttribute:"expr802",selector:"[expr802]"}])}]),redundantAttribute:"expr798",selector:"[expr798]",itemName:"item",indexName:null,evaluate:e=>e.state.list}]}],attributes:[{type:t.ATTRIBUTE,name:"name",evaluate:e=>e.state.name},{type:t.ATTRIBUTE,name:"width",evaluate:e=>240},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.props.data.icon},{type:t.ATTRIBUTE,name:"addon",evaluate:e=>e.state.addon},{type:t.ATTRIBUTE,name:"overflow",evaluate:e=>e.state.overflow}],redundantAttribute:"expr797",selector:"[expr797]"}]),name:"admin-lead-submenu-sort"};e(eo.name,eo),riot3.tag2("admin-pages-page-item-actions",'<svg class="flexbe-icon size-18 dots"> <use riot-xlink:href="{sprite}#dots"></use> </svg> <dropdown class="dropdown-parent" data-scope="parent" autohide=".action" position="end" arrow-to=".admin-pages-page-item-actions" offset-x="{10}" relative=".admin-pages-page-item" onopen="{tag.onOpenDropdown}" onclose="{tag.onCloseDropdown}"> <div class="flexbe-list borderless opacify hoverable hoverable-background round-corners"> <div class="flexbe-list-item action" onclick="{tag.pageSettings}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#settings"></use> </svg> <span class="flexbe-text">{tr(\'admin::pages::dropdown::settings\')}</span> </div> <div class="flexbe-list-item action" onclick="{tag.pageCopy}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#copy"></use> </svg> <span class="flexbe-text">{tr(\'main::button::duplicate\')}</span> </div> <div class="flexbe-list-item action" onclick="{tag.pageLinkCopy}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#copy-link"></use> </svg> <span class="flexbe-text">{tr(\'admin::pages::dropdown::copy_link::link\')}</span> </div> <virtual if="{!tag.isMain}"> <div class="flexbe-list-item action" onclick="{tag.setHomePage}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#set-home"></use> </svg> <span class="flexbe-text">{tr(\'admin::pages::dropdown::make_homepage\')}</span> </div> <hr class="flexbe-hr m0"> <div class="flexbe-list-item"> <div class="inline-box between"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#move-to-folder"></use> </svg> <span class="flexbe-text">{tr(\'admin::pages::dropdown::move_to_folder\')}</span> <svg class="flexbe-icon size-10"> <use riot-xlink:href="{tag.sprite}#arrow-right"></use> </svg> </div> <dropdown class="dropdown-children" data-scope="children" offset-x="{-10}" position="start" direction="right" trigger="hover"> <div class="flexbe-list borderless opacify hoverable hoverable-background round-corners"> <div class="flexbe-list-item action" each="{folder in main.foldersList}" if="{folder.id && folder.id !== main.currentFolderId}" onclick="{tag.pageMove.bind(tag, folder.id)}"> <svg class="flexbe-icon size-18"> <use riot-xlink:href="{tag.sprite}#folder"></use> </svg> <span class="flexbe-text">{folder.title}</span> </div> <hr class="flexbe-hr m0" if="{main.foldersList.length > 1}"> <div class="flexbe-list-item action" onclick="{main.folderAdd.bind(this, tag.page.id)}"> <svg class="flexbe-icon size-12"> <use riot-xlink:href="{tag.sprite}#plus-small"></use> </svg> <span class="flexbe-text">{tr(\'admin::pages::dropdown::add_folder\')}</span> </div> </div> </dropdown> </div> <div if="{main.currentFolderId}" class="flexbe-list-item action" onclick="{tag.pageMove.bind(tag, 0)}"> <svg class="flexbe-icon size-18"> <use riot-xlink:href="{tag.sprite}#move-to-root"></use> </svg> <span class="flexbe-text">{tr(\'admin::pages::dropdown::remove_from_folder\')}</span> </div> <hr class="flexbe-hr m0"> <div class="flexbe-list-item action" onclick="{tag.pageDelete}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#delete"></use> </svg> <span class="flexbe-text">{tr(\'admin::pages::dropdown::delete_page\')}</span> </div> </virtual> </div> </dropdown>',"",'class="admin-pages-page-item-actions {opts.class}"',(function(e){const t=this.parent,s=this.parent?this.parent.main?this.parent.main:this.parent:this;this.tag=t,this.main=s,this.sprite=e.sprite})),riot3.tag2("admin-pages-page-item",'<div class="flexbe-white-card shadow hoverable {hover: inDropdown}"> <a class="page-preview-wrap" href="http://{flexbe.page.formatUrl(group.domain, page.uri)}" onclick="{main.selectPage.bind(this, tag.page)}"> <div class="page-preview" riot-style="background-color: #FFF; background-image: url({previewImage})"></div> <div class="page-data"> <div class="page-title"> <span if="{tag.isMain}" class="home-page flexbe-icon size-16" data-is="flexbe-tooltip" content="{tr(\'admin::pages::add::homepage\')}"> <svg><use riot-xlink:href="{tag.sprite}#home-page"></use></svg> </span> <span class="flexbe-text {no-title: !tag.page.title}"> {htmlspecialchars(tag.page.title || tr(\'admin::pages::empty_title\'), true)} </span> </div> <div class="page-url" data-is="raw" content="{flexbe.page.formatUrl(tag.group.domain, tag.page.uri, false, true)}"></div> <div if="{main.isPageUI && main.allowEdit}" data-is="admin-pages-page-item-actions" sprite="{sprite}" onclick="{preventEvent}"></div> </div> </a> <div class="page-select" if="{main.isOverlayUI}"> <div class="flexbe-button bordered rounded is-primary large filling" onclick="{main.selectPage.bind(this, tag.page)}"> <span class="flexbe-text">{tr(\'admin::pages::add::select_button\')}</span> </div> </div> </div>',"",'class="admin-pages-page-item"',(function(e){const t=this,s=this.parent?this.parent.main?this.parent.main:this.parent:this;this.htmlspecialchars=st,this.tag=t,this.main=s,this.page=e.page,this.group=e.group,this.isMain="/"===this.page.uri,this.previewImage=!!this.page.img_id&&`/img/${this.page.img_id}.jpg`,this.sprite=at("pages","admin"),this.inDropdown=!1,this.preventEvent=function(e){e.preventDefault()}.bind(this),this.onOpenDropdown=function(){this.inDropdown=!0,this.update()}.bind(this),this.onCloseDropdown=function(){this.inDropdown=!1,this.update()}.bind(this),this.pageDelete=function(){"/"===this.page.uri?alert("Not allowed"):As({props:{icon:`${this.sprite}#delete-page-confirm`,title:tr("admin::pages::delete::title"),text:tr("admin::pages::delete::text_content"),toggleText:tr("admin::pages::delete::toggle_text"),confirmButtonText:tr("main::button::confirm"),cancelButton:!0,onConfirm:async({toggle:e})=>{if(e){const e=window.adminStore.getModule("settings/redirect"),t={enabled:!0,regular_from_page:!1,from_page:this.page.uri,to_page:"/",redirect_type:301,save_query:!0,from_all_pages:!1};await e.dispatch("createRedirect","standard",t)}return await flexbe.page.removePage({id:this.page.id})},onDone:()=>{toast.success(tr("admin::pages::delete::success_notify"))},onError:e=>{toast.error(e.message)}},clickOut:!0})}.bind(this),this.pageCopy=function(){const e=t.page.id,i=t.page.uri,a=t.page.title,n=s.currentFolderId;flexbe.page.getPages().then((()=>{flexbe.modals.pages.copyPages({copyId:e,fId:n,url:i,title:a})}))}.bind(this),this.pageLinkCopy=function(){const e=`${document.location.protocol}//${flexbe.page.formatUrl(t.group.domain,t.page.uri)}`;Hi.setData(e),toast.success(tr("admin::pages::dropdown::copy_link::success"))}.bind(this),this.pageMove=function(e){let t=!1;const i=this.page.id,a=()=>{$(this.root).closest(".page-item").hide(),s.pageMove(i,e)};s.pagesList.length>100?a():anime({targets:this.root,keyframes:[{scale:1.03,opacity:1,duration:180,easing:"easeOutSine"},{scale:.98,opacity:0,easing:"easeOutExpo",duration:350}],update:e=>{e.progress>=65&&!t&&(t=!0,a())}})}.bind(this),this.pageSettings=function(){flexbe.modals.pages.showPageSettings(t.page.id)}.bind(this),this.setHomePage=async function(){const e=t.page.id,s=await flexbe.page.findPageByUri({uri:"/"}),i=s?`${tr("admin::pages::homepage::confirm::text")} ${flexbe.vars.group.domain}/${s.id}`:"";As({props:{text:i,title:tr("admin::pages::homepage::confirm::title"),icon:`${this.sprite}#home-page-confirm`,confirmButtonText:tr("main::button::confirm"),onConfirm:async()=>await flexbe.page.setHomePage({pId:e}),onDone:()=>{toast.success(tr("admin::pages::homepage::changed_notify"))},onError:e=>{toast.error(e.message)}},clickOut:!0})}.bind(this)})),riot3.tag2("admin-pages-folder-item",'<a class="flexbe-white-card shadow rounded hoverable {hover: inHover || inRename}" href="{inRename ? false : \'?f=\' + folder.id}" onclick="{openFolder}" onmouseenter="{cardHover}" onmouseleave="{cardHover}"> <div class="folder-line inline-box"> <svg class="flexbe-icon size-18"> <use fill="#56b157" riot-href="{tag.sprite}#folder"></use> </svg> <div class="folder-title {in-edit: inRename}"> <div class="folder-title-text inline-box"> <span class="flexbe-text"> {folder.title} </span> <span class="action-icon {show: inHover}" onclick="{toggleRename}" if="{main.allowEdit}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#rename"></use> </svg> </span> </div> <div class="folder-title-rename flexbe-field-group is-inline" if="{main.allowEdit}"> <div data-is="flexbe-input" disabled="{saving}" class="input-folder text-inherit" error="{error}" error-tip="{errorText}" riot-value="{folderTitle}" oninput="{changeTitle}" onkeydown="{keydownHandle}"> </div> <div class="flexbe-button filled is-light noshrink {loading: saving}" onclick="{renameApply}"> <span class="flexbe-check"></span> </div> </div> </div> </div> <div class="folder-line inline-box"> <span class="folder-count flexbe-desc"> {tr(\'admin::pages::count\', folder.list.length)} </span> <span if="{main.allowEdit}" hide="{inRename}" class="action-icon delete-icon {show: inHover}" onclick="{removeFolder}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#delete"></use> </svg> </span> </div> </a>',"",'class="admin-pages-folder-item {in-focus: inDropdown, in-rename: inRename} {opts.class}"',(function(e){const t=this.parent?this.parent.main?this.parent.main:this.parent:this;this.tag=this,this.main=t,this.folder=e.folder,this.sprite=e.sprite,this.errorText="",this.error=!1,this.saving=!1,this.folderTitle=this.folder.title,this.inHover=!1,this.inRename=!1,this.cardHover=function(e){this.update({inHover:"mouseenter"===e.type})}.bind(this),this.openFolder=function(e){e.stopPropagation(),this.inRename||t.isPageUI&&e.metaKey||e.ctrlKey||(e.preventDefault(),t.isPageUI&&flexbe.routing?flexbe.routing.go(`/admin/pages/?f=${this.folder.id}`):t.openFolder(this.folder.id))}.bind(this),this.changeTitle=function(e){const t=e.target.value||"";this.update({folderTitle:t,error:!1})}.bind(this),this.removeFolder=function(e){e.preventDefault(),e.stopPropagation(),flexbe.modals.pages.removeFolder({fId:this.folder.id})}.bind(this),this.toggleRename=function(e){"boolean"!=typeof e&&(e.preventDefault(),e.stopPropagation());const t="boolean"==typeof e?e:!this.inRename;t&&this.error||(this.update({inRename:t}),t?(this.clickoutId=$(this.root).find(".flexbe-white-card").clickOut((()=>{this.renameApply()})),setTimeout((()=>{$(this.root).find("input").focus()}),50)):$(document).off(`mousedown${this.clickoutId} touchstart${this.clickoutId}`))}.bind(this),this.renameApply=function(e){e&&(e.preventDefault(),e.stopPropagation());const t=st(this.folderTitle,!0).trim(),s=this.folder.title,i=flexbe.page.findFolderByTitle({title:t});if(t.trim().toLowerCase()==s.trim().toLowerCase())return this.toggleRename(!1);t.length?i?this.update({error:!0,errorText:tr("admin::pages::folder::error_folder_exist")}):(this.update({error:!1,saving:!0}),flexbe.page.renameFolder({fId:this.folder.id,title:t}).then((()=>{this.toggleRename(!1)})).catch((e=>{toast.error(e.message)})).finally((()=>{this.update({saving:!1})}))):this.update({error:!0,errorText:tr("admin::pages::folder::error_name_required")})}.bind(this),this.keydownHandle=function(e){13==e.which?this.renameApply(e):27==e.which&&(this.folderTitle=this.folder.title,this.toggleRename(!1))}.bind(this)})),riot3.tag2("admin-pages-list",'<header class="fade-in-animation {isOverlayUI ? \'flexbe-modal-title\' : \'group-title\'}"> <div data-is="admin-breadcrumbs" class="pages-breadcrumbs text-title" index="{currentFolderId ? 1 : 0}" routes="{breadcrumbs}"></div> <div class="flexbe-buttons-line" if="{allowEdit}"> <div class="{meta.buttonClass}" if="{!tag.currentFolderId}" onclick="{folderAdd.bind(tag, 0)}"> <span class="flexbe-text">{tr(\'admin::pages::add_folder_button\')}</span> </div> <div class="flexbe-button large rounded filled is-primary add-page" onclick="{pageAdd}"> <span class="flexbe-text">{tr(\'admin::pages::add_page_button\')}</span> </div> </div> <a class="flexbe-modal-close" if="{isOverlayUI}"></a> </header> <div ref="content" class="content slide-down-animation {isOverlayUI ? \'scrollable-content\' : \'\'}" show="{showList}"> <div class="folders-list" if="{!currentFolderId && foldersList.length > 1}" ref="folders"> <div class="folder-item" each="{folder in foldersList}" if="{folder.id}" hide="{isOverlayUI && !folder.list.length}"> <div data-is="admin-pages-folder-item" folder="{folder}" sprite="{tag.meta.sprite}"></div> </div> </div> <div class="pages-list" if="{pagesList.length}" ref="pages"> <div class="page-item" each="{page in pagesList}"> <div data-is="admin-pages-page-item" page="{page}" group="{meta.group}"></div> </div> </div> <div class="load-more" ref="more"></div> <div class="pages-list--empty" if="{!loading && currentFolderId && !pagesList.length}"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{meta.sprite}#empty-folder"></use> </svg> <div class="flexbe-text text-subtitle mt20"> {tr(\'admin::pages::folder::empty\')} </div> </div> <div class="pages-list--loading" if="{loading}"> <div data-is="proxy" is="flexbe-loader" class="page-settings-loader"></div> </div> </div>',"","class=\"admin-pages-list {isOverlayUI ? '' : 'scrollable-content'} {opts.class}\"",(function(e){let t=20;const s=this;this.mixin("initMobx"),this.meta={sprite:at("pages","admin"),group:flexbe.vars.group,get buttonClass(){let e="flexbe-button large rounded bordered is-primary add-folder";return!s.currentFolderId&&(s.foldersList.length>1||s.pagesList.length>3)&&(e+=" show"),e}};const i=e=>{const t=this.foldersList.find((t=>t.id===+e))||this.foldersList[0],s=t&&t.id||0;this.currentFolderId=s,this.currentFolder=t,this.breadcrumbs=[{title:tr("admin::pages::title"),path:"/admin/pages/",onClick:e=>{this.isOverlayUI&&(this.openFolder(0),e.preventDefault(),e.stopPropagation())}},{title:t?.title}]},a=()=>{const e=this.currentFolder,s=e&&e.list||[];this.update({pagesTotal:s.length,pagesList:s.slice(0,t)})},n=e=>{const t=$(this.refs.content);t.addClass("hide"),t.removeClass("slide-down-animation"),setTimeout((()=>{t.removeClass("hide"),t.addClass("slide-down-animation"),e&&e()}),80)};this.tag=s,this.main=this,this.isOverlayUI="overlay"===e.type,this.isPageUI=!this.isOverlayUI,this.allowEdit=this.isPageUI&&"manager"!==flexbe.vars.user.role,this.loading=!0,this.showList=!0,this.foldersList=[],this.pagesList=[],this.currentFolder={},this.currentFolderId=null,this.breadcrumbs=[],this.selectPage=function(t,s){if("function"==typeof e.onselect)return e.onselect(t,this.meta.group),s.preventDefault(),!1}.bind(this),this.pageAdd=function(){flexbe.modals.pages.create({projectId:this.meta.group.id,folderId:this.currentFolderId})}.bind(this),this.folderAdd=function(e){flexbe.modals.pages.addFolder({pId:e,gId:this.meta.group.id})}.bind(this),this.openFolder=function(e){const s=String(this.currentFolderId)!==String(e);s&&(t=20),i(e),a(),s&&n()}.bind(this),this.pageMove=function(e,t=0){return flexbe.page.movePage({pId:e,fId:t}).then((e=>{toast.success(tr("admin::pages::folder::success_move_notify"))})).catch((e=>{toast.error(e.message)}))}.bind(this),this.loadMore=function(){t<this.pagesTotal&&(t+=20,a())}.bind(this),this.initObserver=function(){this.observer=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&this.loadMore()}))}),{threshold:0,rootMargin:"0px 0px 100px"}),this.observer.observe(this.refs.more),$(document).on("keydown.pages",(e=>{70===e.keyCode&&(e.ctrlKey||e.metaKey)&&(t=this.pagesTotal,a())}))}.bind(this),this.initPages=function(){flexbe.on("pageList",(({gId:e,list:t})=>{if(e!==this.meta.group.id)return;let s=0;this.isPageUI&&flexbe.routing&&(s=flexbe.routing.query.f||0),this.update({showList:!1}),this.update({foldersList:t,loading:!1,showList:!0}),this.openFolder(s)}));try{const t=JSON.parse(e.dataJson);flexbe.page.setPages({gId:this.meta.group.id,list:t})}catch(e){flexbe.page.getPages({force:!0})}}.bind(this),flexbe.routing&&flexbe.routing.on("route",(({query:e})=>{this.openFolder(e.f||0)})),this.onBeforeMount=function(){this.initPages()}.bind(this),this.onMounted=function(){this.root.removeAttribute("data-json"),this.initObserver()}.bind(this),this.onUnmounted=function(){flexbe.off("pageList"),$(document).on("keydown.pages"),this.observer&&this.observer.disconnect()}.bind(this)})),riot3.tag2("admin-page-folder-add",'<div class="flexbe-title"> <span class="flexbe-text"> {tr(\'admin::pages::folder::add::name_label\')} </span> <span class="flexbe-error" if="{error && errorText}"> {errorText} </span> </div> <form class="flexbe-field-group is-inline" onsubmit="{addFolder}"> <div data-is="flexbe-input" autofocus="{true}" riot-value="{title}" oninput="{changeTitle}" class="flexbe-input grow" error="{error}"> </div> <button type="submit" class="flexbe-button filled is-primary {loading: loading}"> <span class="flexbe-text">{tr(\'main::button::create\')}</span> </button> </form>',"",'class="admin-page-folder-add flexbe-modal-content"',(function(e){const t=e.gId||flexbe.vars.group.id,s=e.pId||"";this.loading=!1,this.error=!1,this.errorText="",this.title=e.title||tr("admin::pages::folder::add::default_name"),this.folders=[],flexbe.page.getPages({gId:t}).then((e=>{this.folders=e})),this.changeTitle=function(e){this.title=e.target.value,this.error=!1,this.errorText=""}.bind(this),this.addFolder=function(t){t.preventDefault(),t.stopPropagation();const i=st(this.title,!0).trim(),a=flexbe.page.findFolderByTitle({title:i});i.length?a?this.update({error:!0,errorText:tr("admin::pages::folder::error_folder_exist")}):(this.update({loading:!0}),flexbe.page.addFolder({title:i}).then((e=>{if(s){const t=e.id;return flexbe.page.movePage({pId:s,fId:t})}return e})).then((()=>{toast.success(tr("admin::pages::folder::add::success_notify")),e.modal.close()})).catch((e=>{toast.error(e.message)})).finally((()=>{this.update({loading:!1})}))):this.update({error:!0,errorText:tr("admin::pages::folder::error_name_required")})}.bind(this),this.on("mount",(()=>{setTimeout((()=>{$(this.root).find("input")[0].focus()}),300)}))})),riot3.tag2("admin-page-folder-delete",'<svg class="flexbe-icon size-28 mb20"> <use riot-xlink:href="{sprite}#remove-folder-confirm"></use> </svg> <div class="flexbe-title mb20"> {tr(\'admin::pages::folder::delete::title\', { name: folder.title })} </div> <label if="{tag.folder.list.length}" onchange="{tag.toggleDeletePage}" class="mb20" data-is="flexbe-input" checked="{tag.needDeletePages}" type="toggle"> <span data-is="raw" content="{tr(\'admin::pages::folder::delete::text\', tag.folder.list.length)}"></span> </label> <div class="flexbe-buttons-line"> <div class="flexbe-button is-primary filled {loading: loading}" onclick="{confirmHandler}"> <span class="flexbe-text">{tr(\'main::button::confirm\')}</span> </div> <div class="flexbe-button filled" onclick="{cancelHandler}"> <span class="flexbe-text">{tr(\'main::button::cancel\')}</span> </div> </div>',"",'class="admin-page-folder-delete flexbe-modal-content display-block"',(function(e){this.folder=e.folder,this.loading=!1,this.needDeletePages=!1,this.sprite=flexbe.lib.getSprite("pages","admin"),this.toggleDeletePage=function(e){this.needDeletePages=e.target.checked}.bind(this),this.confirmHandler=function(){this.update({loading:!0}),flexbe.page.removeFolder({fId:this.folder.id,deletePages:this.needDeletePages}).then((()=>{toast.success(tr("admin::pages::folder::delete::success_notify")),e.modal&&e.modal.close()})).catch((e=>{toast.error(e.message)})).finally((()=>{this.update({loading:!1})}))}.bind(this),this.cancelHandler=function(){e.modal&&e.modal.close()}.bind(this)}));const to={};let so=[],io={};const ao={getCopyName({uri:e,gId:t=flexbe.vars.group.id}={}){if((e=e.replace(/^\/+/g,"").replace(/\/+$/g,""))&&"/"!==e&&!this.findPageByUri({uri:e,gId:t}))return nr(e,!!e);const s=e.match(/_copy(\d*)$/);if(s){const t=s[1];e=e.replace(new RegExp(`${t}$`),(+t||0)+1)}else e?e+="_copy":e="page_copy";return this.findPageByUri({uri:e,gId:t})?this.getCopyName({uri:e,gId:t}):nr(e,!!e)},formatUrl(e="",t="",s=!1,i=!1){t=nr(t,!1),e="string"==typeof e?e.replace(/^https?:\/\//g,"").replace(/\/.$/,""):"";const a=t.match(/\/?subdomain\/(.*)/);return a?(t=`${a[1].replace(/\//g,"")}.`,i?`<span class="uri">${t}</span><span class="domain">${e}</span>`:t+e):(t=t&&`/${t}/`||"/",s?i?`<span class="uri">${t}</span>`:t:i?`<span class="domain">${e}</span><span class="uri">${t}</span>`:e+t)},findFolderById({fId:e,gId:t=flexbe.vars.group.id}={}){const s=to[t]||[];return e?s.find((t=>t.id===e)):s[0]},findFolderByTitle({title:e,gId:t=flexbe.vars.group.id}={}){const s=to[t]||[];if(e&&"string"!=typeof e)e=String(e);else if(!e)return;return s.find((t=>t.title&&t.title.toLowerCase()===e.toLowerCase()))},findPageById({pId:e,gId:t=flexbe.vars.group.id}={}){return{...this.getPagesFlat({gId:t}).find((t=>t.id===e))}},findPageByUri({uri:e,gId:t=flexbe.vars.group.id}={}){e=nr(e,!!e);return this.getPagesFlat({gId:t}).find((t=>t.uri===e))||!1},getPagesFlat({gId:e=flexbe.vars.group.id}={}){const t=to[e]||[];return Object.values(t).reduce(((e,t)=>[...e,...t.list||[]]),[])},getProjects:({force:e}={})=>so&&so.length&&!e?Promise.resolve(so):ai("/admin/api/project/list/").then((e=>{const t=e.data;return so=t,flexbe.trigger("projectList",{list:t}),t})),loadTemplates:async e=>Object.entries(io).length&&!e?Promise.resolve(io):(io=await ai(`/admin/api/project/${flexbe.vars.group.id}/page/config/`),io),setPages({gId:e=flexbe.vars.group.id,list:t=[]}={}){t=ge(t,{title:"ASC"}),to[e]=t,flexbe.trigger("pageList",{gId:e,list:t})},getPages({gId:e=flexbe.vars.group.id,force:t=!1}={}){return"new"===e?Promise.resolve({list:[]}):to[e]&&to[e].length&&!t?Promise.resolve(to[e]):ai(`/admin/api/project/${e}/page/list/`).then((t=>{const s=t.data.list;return this.setPages({gId:e,list:s}),s}))},copyPage({gId:e,fId:t,pId:s,url:i,title:a}){const n={group_id:e,src_p_id:s,folder_id:t,uri:i,title:a,type:this.findPageById({gId:e,pId:s}).type};return this.getPages({gId:e}).then((()=>this.createPage(n))).then((e=>(e.domain&&e.uri&&(document.location=`${document.location.protocol}//${e.domain}${e.uri}`),e)))},createPage:e=>ii(`/admin/api/project/${flexbe.vars.group.id}/page/add/`,{data:e}).then((e=>e.data)),removePage({id:e}){const t=flexbe.vars.group.id,s=to[t],i=s&&s.find((t=>t.list.find((t=>String(t.id)===String(e))))),a=i&&i.list.find((t=>String(t.id)===String(e)));return ni(`/admin/api/project/${flexbe.vars.group.id}/page/${e}/remove/`).then((e=>(a&&i.list.splice(i.list.indexOf(a),1),flexbe.trigger("pageList",{gId:t,list:s}),e)))},addFolder({title:e}){const t=flexbe.vars.group.id,s=to[t];return ii(`/admin/api/project/${t}/folder/add/`,{data:{title:e}}).then((e=>{const i=e.data;return s.push(i),this.setPages({gId:t,list:s}),i}))},renameFolder({title:e,fId:t}){const s=flexbe.vars.group.id,i=to[s],a=i.find((e=>e.id===t));return ii(`/admin/api/project/${flexbe.vars.group.id}/folder/${t}/rename/`,{data:{title:e}}).then((()=>(a.title=e,flexbe.trigger("pageList",{gId:s,list:i}),a)))},removeFolder({fId:e,deletePages:t}){const s=flexbe.vars.group.id,i=to[s],a=i.find((t=>t.id===e)),n=i.indexOf(a),r=a.list;return ii(`/admin/api/project/${flexbe.vars.group.id}/folder/${e}/remove/`,{data:{force:t?1:0}}).then((e=>(i.splice(n,1),t||(i[0].list=i[0].list.concat(r)),flexbe.trigger("pageList",{gId:s,list:i}),e.data)))},movePage({pId:e,fId:t}){const s=flexbe.vars.group.id,i=to[s],{oldFolder:a,oldIndex:n}=r(e,t);return ii(`/admin/api/project/${flexbe.vars.group.id}/folder/${t}/move_page/`,{data:{page_id:e}}).then((e=>e.data)).catch((t=>(r(e,a.id,n),t)));function r(e,t,a){let n;const r=i.find((t=>t.list.find((t=>t.id===e)))),o=i.find((e=>e.id===t))||i[0],l=r.list.findIndex((t=>t.id===e));return r&&(n=r.list.splice(l,1)[0]),o&&n&&(void 0===a&&(a=o.list.length),o.list.splice(a,0,n)),flexbe.trigger("pageList",{gId:s,list:i}),{oldFolder:r,newFolder:o,oldIndex:l,newIndex:a}}},setHomePage({pId:e}){const t=flexbe.vars.group.id;return ii(`/admin/api/project/${flexbe.vars.group.id}/page/${e}/set_main/`,{data:{p_id:e}}).then((e=>{const s=e.data.list;return this.setPages({gId:t,list:s}),s}))},settingsLoad:({pId:e}={})=>ai(`/admin/api/project/${flexbe.vars.group.id}/page/${e}/settings_load/`).then((e=>("Landing"===e.data.p_data.meta_desc&&(e.data.p_data.meta_desc=""),"Landing"===e.data.p_data.meta_keywords&&(e.data.p_data.meta_keywords=""),e))),settingsSave:e=>e&&e.p_id?ii(`/admin/api/project/${flexbe.vars.group.id}/page/${e.p_id}/settings_save/`,{data:{data:JSON.stringify(e)}}).then((e=>e.data)):Promise.reject(new Error("No data passed")),versionsPage:({pId:e})=>ai(`/admin/api/project/${flexbe.vars.group.id}/page/${e}/versions/`).then((e=>{var t;return(null!=(t=e.data)?t:[]).reverse()})),restorePage:({pId:e,vId:t})=>ii(`/admin/api/project/${flexbe.vars.group.id}/page/${e}/versions/restore/`,{data:{v_id:t}})};var no;riot3.tag2("admin-project-select-item",'<div class="flexbe-white-card shadow hoverable controled" onclick="{main.selectProject.bind(main, group.project_id, group.domain_title)}"> <div class="page-preview group-page-preview"> <div class="preview-image" riot-style="{getStyle()}"></div> </div> <div class="p20"> <div class="admin-content-title"> <img if="{group.favicon}" class="favicon mr10" riot-src="{meta.favicon}"> <img if="{!group.favicon}" class="favicon mr10" src="/_s/images/favicon.png"> <span if="{!opts.forceUrl && !group.domain_is_reg}" class="text-content flexbe-text flexbe-desc">{tr(\'admin::projects::domain_not_connected_state\')}</span> <span if="{opts.forceUrl || group.domain_is_reg}" class="text-content flexbe-text {group.domain_is_reg ? \'text-dark\' : \'flexbe-desc\'}">{group.domain_title}</span> </div> <div class="flexbe-button page-group-button large rounded is-primary {loading: (main.selected == group.project_id), filled: (main.gId == group.project_id)}"> <span class="flexbe-text">{(group.project_id == main.gId) ? tr(\'admin::pages::copy::selected_button\') : tr(\'main::button::select\')}</span> </div> </div> </div>',"",'class="admin-project-select-item {opts.class}"',(function(e){const t=this;this.meta={get favicon(){return"string"==typeof t.group.favicon?`${t.group.domain_link}${t.group.favicon}`:pt(t.group.favicon)}},this.getStyle=function(){const e=this.group.img_id;return!(!e||!this.onScreen)&&`background-image: url(/img/${e}_800.jpg)`}.bind(this),this.onMounted=function(){this.observer=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&(this.update({onScreen:!0}),this.observer.disconnect())}))}),{threshold:0,rootMargin:"0px 0px 200px 0px"}),this.observer.observe(this.root)}.bind(this)})),riot3.tag2("admin-project-select",'<header class="group-title"> <div class="flexbe-title text-title"> {tr(\'admin::pages::copy::select_project_title\')} </div> <div class="display-flex align-items-center ml-auto"> <div if="{!loading && tag.state.showCreateButton}" disabled="{selected}" class="flexbe-button filled rounded large is-primary mr30" onclick="{selectProject.bind(tag, \'new\')}"> <span>{tr(\'admin::pages::copy::create_project_button\')}</span> </div> <a class="close flexbe-modal-close"></a> </div> </header> <div if="{loading}" class="sites-loading"> <div data-is="proxy" is="flexbe-loader"></div> </div> <div class="sites-domains-wrapper scrollable-content slide-down-animation" if="{!loading}"> <div class="sites-domains" if="{state.list.length}"> <div data-is="admin-project-select-item" class="page-item {active: (domainCheck === group.project_id)}" force-url="{techUrlShow}" each="{group in state.list}"></div> </div> <div class="sites-domains" if="{state.shared.length}"> <div class="projects-header group-title"> <svg class="flexbe-icon size-28"><use riot-xlink:href="{tag.sprite}#group-shared"></use></svg> <div class="flexbe-text text-subtitle">{tr(\'admin::projects::shared_title\')}</div> </div> <div data-is="admin-project-select-item" class="page-item {active: (domainCheck === group.project_id)}" force-url="{techUrlShow}" each="{group in state.shared}"> </div> </div> </div>',"",'class="admin-project-select {opts.class}"',(function(e){const t=this;this.tag=this,this.main=this.parent?this.parent.main?this.parent.main:this.parent:this,this.sprite=flexbe.lib.getSprite("projects","admin"),this.projects={},this.loading=!0,this.selected=!1,this.techUrlShow=!1,this.state={role:flexbe.vars.user.role,get showCreateButton(){return["owner","admin"].includes(this.role)},get list(){return t.projects.list??[]},get shared(){return t.projects.shared??[]}},this.gId=e.gId,this.selectProject=async function(t,s=""){if(!this.selected){if(this.update({selected:t,gId:t}),"new"===t)flexbe.trigger("adminCopyPageDomain",{gId:t,domain:s,data:[]}),e.modal.close();else try{const i=await flexbe.page.getPages({gId:t});flexbe.trigger("adminCopyPageDomain",{gId:t,domain:s,data:i}),e.modal.close()}catch(e){"NetworkError"===e.name?toast.error(e.message):console.error(e),this.update({selected:!1})}"function"==typeof e.onSelect&&e.onSelect(s)}}.bind(this),this.onBeforeMount=async function(){try{this.projects=await flexbe.page.getProjects(),this.loading=!1,this.update()}catch(t){"NetworkError"===t.name?toast.error(t.message):console.error(t),e.modal.close()}}.bind(this),this.onMounted=function(){$(document).on("keydown.project-select",(e=>{70===e.keyCode&&(e.ctrlKey||e.metaKey)&&(this.update({techUrlShow:!0}),$(document).off("keydown.project-select"))}))}.bind(this),this.onBeforeUnmount=function(){$(document).off("keydown.project-select")}.bind(this)}));const ro=["settings/code","ecommerce/common","ecommerce/delivery","settings/notification/visitor","settings/redirects"];let oo=(Vt((no=class extends kt{get state(){if(!(!this.parentStore||!this._moduleName)){const e=this._moduleName.split("/");return xt(this.rootStore.state,e)}return x(this._state)?this._state.get():this._state}set state(e){const t=this.normalizeState(e),s=this.parentStore&&!!this._moduleName;if(x(this._state)?this._state.set(t):this._state=d.box(t),s){const e=this._moduleName.split("/");_t(this.rootStore.state,e,this._state.get())}}get meta(){if(this.parentStore&&!!this._moduleName){const e=this._moduleName.split("/");return xt(this.rootStore.meta,e)}return x(this._meta)?this._meta.get():this._meta}set meta(e){const t=this.parentStore&&!!this._moduleName;if(x(this._meta)?this._meta.set(e):this._meta=d.box(e),t){const e=this._moduleName.split("/");_t(this.rootStore.meta,e,this._meta.get())}}constructor(e,t){super(),this.mutations={},this.getters={},this.actions={},this.helpers={},this.modules={},this.rootStore=this,this.loadStateRoute=null,this.loadMetaRoute=null,this.expirePeriod=2e3,this.skipNextUpdate=void 0,this.parentStore=void 0,this._state=void 0,this._meta=void 0,this._modules={},this._moduleName=void 0,this._lastUpdate=0,this._lastPath=void 0,this.normalizeState=e=>e,this.parentStore=e||null,this.rootStore=(null==e?void 0:e.rootStore)||this,this._moduleName=t||null}init(){var e;this.onBeforeInit(),function(e){const t=void 0!==e._state&&it(e._state)||{},s=void 0!==e._meta&&it(e._meta)||{};e.state=null!=s?ft(t,e.state):t,e.meta=null!=s?ft(s,e.meta):s}(this),e=this,Object.entries(e._modules).forEach((([t,s])=>{"function"==typeof s&&co(e,t,s)})),function(e){Object.keys(e.getters).forEach((t=>{const s=Object.getOwnPropertyDescriptor(e.getters,t),i=s.get||s.value;if("function"==typeof i){const s=o(i,{keepAlive:!0,context:e.getters});Object.defineProperty(e.getters,t,{configurable:!0,enumerable:!0,get:()=>s.get()})}}))}(this),function(e){Object.entries(e.mutations).forEach((([t,s])=>{if("function"!=typeof s)return!1;e.mutations[t]=l(t,s)}))}(this),this.onAfterInit()}getModule(e){return"string"==typeof e&&(e=e.split("/")),e.reduce(((e,t)=>e&&e.modules&&e.modules[t]),this)}commit(e,...t){"string"==typeof e&&(e=e.split("/"));const s=e.pop(),i=this.getModule(e);if(!i)throw new Error(`Store ${e.join("/")} not found!`);const a=i.mutations[s],n=null==a?void 0:a(...t);return i.trigger("commit",e,...t),n}async dispatch(e,...t){"string"==typeof e&&(e=e.split("/"));const s=e.pop(),i=this.getModule(e);if(!i)throw new Error(`Store ${e.join("/")} not found!`);const a=i.actions[s],n=await(null==a?void 0:a(...t));return this.trigger("dispatch",e,...t),n}async getState(e){const t=!this._lastUpdate,s=Date.now()-this._lastUpdate>this.expirePeriod||lo()!==this._lastPath;return(t||s&&!this.skipNextUpdate)&&await this.loadState(e),this.skipNextUpdate=!1,this.state}async loadState(e={}){var t;const s={...e.routeArgs&&e.routeArgs.query||flexbe.routing.query,...e.data||{}},i=(null==(t=e.routeArgs)?void 0:t.path)&&ro.some((t=>e.routeArgs.path.includes(t))),a=it(this.loadStateRoute,[e],this),n=it(this.loadMetaRoute,[e],this);let[r,o]=await Promise.all([a&&ai(a,{data:s}),n&&ai(n,{data:s})]);var l,d;i||(o=null==(l=r)?void 0:l.meta,r=null==(d=r)?void 0:d.data);this.onBeforeUpdate(),o&&this.extendMeta(o,!1),r&&this.extendState(r,!1),this.onAfterUpdate(),this.trigger("updateState")}extendState(e,t=!0){return this.state={...this.state,...e},this._lastUpdate=Date.now(),this._lastPath=lo(),t&&this.trigger("extendState",this.state),this.state}extendMeta(e,t=!0){return this.meta={...this.meta,...e},t&&this.trigger("extendMeta",this.meta),this.meta}onBeforeUpdate(){}onAfterUpdate(){}onBeforeInit(){}onAfterInit(){}}).prototype,"state",[o],Object.getOwnPropertyDescriptor(no.prototype,"state"),no.prototype),Vt(no.prototype,"meta",[o],Object.getOwnPropertyDescriptor(no.prototype,"meta"),no.prototype),Vt(no.prototype,"extendState",[l],Object.getOwnPropertyDescriptor(no.prototype,"extendState"),no.prototype),Vt(no.prototype,"extendMeta",[l],Object.getOwnPropertyDescriptor(no.prototype,"extendMeta"),no.prototype),no);function lo(){const e=window.location;return e.pathname+e.search+e.hash}function co(e,t,s){return Object.defineProperty(e.modules,t,{configurable:!0,enumerable:!0,get:()=>{const i=e._moduleName?`${e._moduleName}/${t}`:t,a=new s(e,i);return a.init(),a instanceof oo?(Object.defineProperty(e.modules,t,{value:a,configurable:!0,enumerable:!0,writable:!0}),a):(console.warn("Module must be instance of Store!",{name:t,Module:s}),null)}}),!0}var po,uo,mo;let ho=(uo=Vt((po=class extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/redirects/`,Dt(this,"isChanged",uo,this),Dt(this,"hasError",mo,this),this.prefixId=void 0,this.normalizeState=e=>Object.values(e||[]),this.getters={redirectList:()=>this.state.filter((e=>"standard"===e.type)),geoRedirectList:()=>this.state.filter((e=>"geo"===e.type))},this.helpers={getRedirectById:e=>this.state.filter((t=>t.id===e))[0],getOmitData:e=>"standard"===e.type?{regular_from_page:e.regular_from_page,from_page:e.from_page,to_page:e.to_page,redirect_type:e.redirect_type,save_query:e.save_query}:"geo"===e.type?{regular_from_page:e.regular_from_page,from_page:e.from_page,to_page:e.to_page,save_query:e.save_query,country:e.country,language:e.language}:{},getNormalizeStandardList:()=>this.getters.redirectList.map((e=>{if("string"==typeof e.id&&e.id.includes(this.prefixId)){const{id:t,...s}=e;return s}return e})),parseQueryString:e=>{const t=new URLSearchParams(e),s={};return t.forEach(((e,t)=>{s[t]=e})),s},needRedirectForPage:(e,t,s=!1)=>{if(!new RegExp(`^${e.split("?")[0].replace(/\{([a-z_0-9]+)}|\*/g,"(.*)")}$`,"g").test(t.split("?")[0]))return!1;const i=this.helpers.parseQueryString(e.split("?")[1]),a=this.helpers.parseQueryString(t.split("?")[1]);if(a.hasOwnProperty("mode")&&"preview"===a.mode&&delete a.mode,Object.keys(i).length<1)return!0;return Object.keys(a).length>0&&Object.keys(i).every((e=>a.hasOwnProperty(e)))}},this.mutations={addItem:(e,t)=>{this.state.push({type:e,...t}),this.isChanged=!0},updateItem:(e,t)=>{this.state=this.state.map((s=>s.id===e?{...s,...t}:s)),this.isChanged=!0},removeItem:e=>{this.state=this.state.filter((t=>t.id!==e)),this.isChanged=!0},sortStandardList:(e,t)=>{const s=pe(this.getters.redirectList,e,t,!0);this.state=[...s,...this.getters.geoRedirectList],this.isChanged=!0}},this.actions={saveStandardList:async()=>{let e;try{const t=this.helpers.getNormalizeStandardList();e=await this.api.saveStandardList(t),this.isChanged=!1,this.hasError=!1}catch(t){e=t,this.hasError=!0,this.isChanged=!0}return e},createRedirect:async(e,t)=>{await this.api.create(e,t)}},this.api={async create(e,t){const s=`/admin/api/project/${flexbe.vars.group.id}/settings/redirects/${e}/`,i=await ii(s,{asJson:!0,data:t});return null==i?void 0:i.id},async saveStandardList(e){const t=`/admin/api/project/${flexbe.vars.group.id}/settings/redirects/standard/handle/`;return await ii(t,{asJson:!0,data:e})}}}}).prototype,"isChanged",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mo=Vt(po.prototype,"hasError",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),po);var go,vo,fo,xo,bo,yo,_o;let To=(vo=Vt((go=class{get uriError(){return!this.pageMarkedAsMain&&this.uriExists||null==this.uri||""===this.uri}get titleHelpText(){return tr("admin::pages::settings::base::title_note")}get uriHelpText(){return this.root.pageId==this.root.mainPageData.id?"":this.pageMarkedAsMain?tr("admin::pages::settings::base::uri_homepage_warn",{domain:this.root.settings.domain,page:`${this.root.settings.p_id}/`}):this.uriExists?tr("admin::pages::error::uri_exist"):tr("admin::pages::settings::base::uri_note")}get uriIsDisabled(){return this.root.mainPageData.id==this.root.pageId}constructor(e){this.root=null,Dt(this,"title",vo,this),Dt(this,"uri",fo,this),Dt(this,"language",xo,this),Dt(this,"uriExists",bo,this),Dt(this,"pType",yo,this),Dt(this,"pageMarkedAsMain",_o,this),this.root=e}bindPageData(){this.title=this.root.settings.p_data.title,this.language=this.root.settings.p_data.language,this.uri=this.root.settings.p_uri,this.pType=Boolean(Number(this.root.settings.p_type))}setTitle(e){this.title=e,this.root.setHasChanges(!0)}makeMain(){this.root.hasChanges=!0,this.pageMarkedAsMain=!0,this.uri="/"}fixUri(){this.uri=nr(this.uri,!!this.uri)}async setUri(e){const t=e,s=await ao.findPageByUri({uri:t});r((()=>{this.uriExists=!!s&&s.id!==this.root.settings.p_id,this.uri=t})),this.root.setHasChanges(!0),r((()=>{this.pageMarkedAsMain="/"===e}))}setLanguage(e){this.language=e,this.root.setHasChanges(!0)}}).prototype,"title",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),fo=Vt(go.prototype,"uri",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),xo=Vt(go.prototype,"language",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),bo=Vt(go.prototype,"uriExists",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yo=Vt(go.prototype,"pType",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_o=Vt(go.prototype,"pageMarkedAsMain",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vt(go.prototype,"uriError",[o],Object.getOwnPropertyDescriptor(go.prototype,"uriError"),go.prototype),Vt(go.prototype,"titleHelpText",[o],Object.getOwnPropertyDescriptor(go.prototype,"titleHelpText"),go.prototype),Vt(go.prototype,"uriHelpText",[o],Object.getOwnPropertyDescriptor(go.prototype,"uriHelpText"),go.prototype),Vt(go.prototype,"uriIsDisabled",[o],Object.getOwnPropertyDescriptor(go.prototype,"uriIsDisabled"),go.prototype),Vt(go.prototype,"bindPageData",[l],Object.getOwnPropertyDescriptor(go.prototype,"bindPageData"),go.prototype),Vt(go.prototype,"setTitle",[l],Object.getOwnPropertyDescriptor(go.prototype,"setTitle"),go.prototype),Vt(go.prototype,"makeMain",[l],Object.getOwnPropertyDescriptor(go.prototype,"makeMain"),go.prototype),Vt(go.prototype,"fixUri",[l],Object.getOwnPropertyDescriptor(go.prototype,"fixUri"),go.prototype),Vt(go.prototype,"setLanguage",[l],Object.getOwnPropertyDescriptor(go.prototype,"setLanguage"),go.prototype),go);var wo,ko,Ao,Eo,Io;let Co=(ko=Vt((wo=class{get descriptionError(){return/[<>]/.test(this.description)}get keywordsError(){return/[<>]/.test(this.keywords)}get keywordsHelpText(){return this.keywordsError?tr("admin::pages::settings::seo::error_meta_tag"):tr("admin::pages::settings::seo::meta_keywords_note")}constructor(e){this.root=null,Dt(this,"description",ko,this),Dt(this,"showKeywords",Ao,this),Dt(this,"noindex",Eo,this),Dt(this,"keywords",Io,this),this.root=e}bindPageData(){var e;this.description=this.root.settings.p_data.meta_desc,this.keywords=this.root.settings.p_data.meta_keywords,this.showKeywords=null!=(e=this.root.settings.p_data.show_meta_keywords)&&e,this.noindex=this.root.settings.p_data.noindex||!1}setDescription(e){this.root.hasChanges=!0,this.description=e}toggleShowKeywords(){this.root.hasChanges=!0,this.showKeywords=!this.showKeywords}toggleNoindex(){this.root.hasChanges=!0,this.noindex=!this.noindex}setKeywords(e){this.root.hasChanges=!0,this.keywords=e}}).prototype,"description",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ao=Vt(wo.prototype,"showKeywords",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Eo=Vt(wo.prototype,"noindex",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Io=Vt(wo.prototype,"keywords",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Vt(wo.prototype,"descriptionError",[o],Object.getOwnPropertyDescriptor(wo.prototype,"descriptionError"),wo.prototype),Vt(wo.prototype,"keywordsError",[o],Object.getOwnPropertyDescriptor(wo.prototype,"keywordsError"),wo.prototype),Vt(wo.prototype,"keywordsHelpText",[o],Object.getOwnPropertyDescriptor(wo.prototype,"keywordsHelpText"),wo.prototype),Vt(wo.prototype,"bindPageData",[l],Object.getOwnPropertyDescriptor(wo.prototype,"bindPageData"),wo.prototype),Vt(wo.prototype,"setDescription",[l],Object.getOwnPropertyDescriptor(wo.prototype,"setDescription"),wo.prototype),Vt(wo.prototype,"toggleShowKeywords",[l],Object.getOwnPropertyDescriptor(wo.prototype,"toggleShowKeywords"),wo.prototype),Vt(wo.prototype,"toggleNoindex",[l],Object.getOwnPropertyDescriptor(wo.prototype,"toggleNoindex"),wo.prototype),Vt(wo.prototype,"setKeywords",[l],Object.getOwnPropertyDescriptor(wo.prototype,"setKeywords"),wo.prototype),wo);var So,$o,Bo,Uo,Ro,Po;let Ho=($o=Vt((So=class{constructor(e){this.root=null,Dt(this,"title",$o,this),Dt(this,"description",Bo,this),Dt(this,"pageImage",Uo,this),Dt(this,"pageScreenshot",Ro,this),Dt(this,"domain",Po,this),this.root=e}get imageUploadHelpText(){return tr("admin::pages::settings::social::upload_note",{uri:`https://developers.facebook.com/tools/debug/sharing/?q=${this.root.generalStore.uri+this.domain}`})}get metaImage(){return this.pageImage?`background-image: url('${this.pageImage}')`:this.pageScreenshot?`background-image: url('/img/${this.pageScreenshot}_1200.jpg')`:""}bindPageData(){this.title=this.root.settings.p_data.og_title,this.description=this.root.settings.p_data.og_desc,this.pageImage=this.root.settings.p_data.meta_img,this.pageScreenshot=this.root.settings.img_id,this.domain=this.root.settings.domain}setTitle(e){this.title=e,this.root.setHasChanges(!0)}setDescription(e){this.description=e,this.root.setHasChanges(!0)}uploadImageDone(e,t){if(!t||!t.img_id)return toast.error(tr("main::error::upload_image"));this.root.setHasChanges(!0),this.pageImage=`/img/${t.img_id}_1200/${String(t.img_name).replace(/.*\.(jpg|png|gif|jpeg)$/,"og.$1")}`}removeImage(){this.root.setHasChanges(!0),this.pageImage=""}}).prototype,"title",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Bo=Vt(So.prototype,"description",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Uo=Vt(So.prototype,"pageImage",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ro=Vt(So.prototype,"pageScreenshot",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Po=Vt(So.prototype,"domain",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Vt(So.prototype,"imageUploadHelpText",[o],Object.getOwnPropertyDescriptor(So.prototype,"imageUploadHelpText"),So.prototype),Vt(So.prototype,"metaImage",[o],Object.getOwnPropertyDescriptor(So.prototype,"metaImage"),So.prototype),Vt(So.prototype,"bindPageData",[l],Object.getOwnPropertyDescriptor(So.prototype,"bindPageData"),So.prototype),Vt(So.prototype,"setTitle",[l],Object.getOwnPropertyDescriptor(So.prototype,"setTitle"),So.prototype),Vt(So.prototype,"setDescription",[l],Object.getOwnPropertyDescriptor(So.prototype,"setDescription"),So.prototype),Vt(So.prototype,"uploadImageDone",[l],Object.getOwnPropertyDescriptor(So.prototype,"uploadImageDone"),So.prototype),Vt(So.prototype,"removeImage",[l],Object.getOwnPropertyDescriptor(So.prototype,"removeImage"),So.prototype),So);var jo,Fo,Lo,No,Mo,Do,Vo,Oo;let zo=(Fo=Vt((jo=class{constructor(e){this.root=null,Dt(this,"showBullets",Fo,this),Dt(this,"showCodeInsert",Lo,this),Dt(this,"codeHead",No,this),Dt(this,"codeBody",Mo,this),Dt(this,"responsive",Do,this),Dt(this,"needSetBackground",Vo,this),Dt(this,"background",Oo,this),this.root=e}bindPageData(){var e;const t=this.root.settings.p_data,s=t.show_bullets;this.showBullets=null==s||s,this.showCodeInsert=null!=(e=t.show_code)&&e,this.codeHead=t.code_head,this.codeBody=t.code_body,this.responsive=t.responsive,t.background&&(this.background.enabled=t.background.enabled,this.background.image=t.background.image,this.background.styles=t.background.styles,this.background.compression=t.background.compression,this.background.styles.contrast||this.syncContrast())}toggleShowBullets(){this.showBullets=!this.showBullets,this.root.needReload=!0,this.root.setHasChanges(!0)}toggleShowCodeInsert(){this.showCodeInsert=!this.showCodeInsert,this.root.setHasChanges(!0)}setCodeHead(e){this.codeHead=e,this.root.setHasChanges(!0)}setCodeBody(e){this.codeBody=e,this.root.setHasChanges(!0)}togglePageResponsive(e){this.responsive=e,this.root.needReload=!0,this.root.setHasChanges(!0)}toggleBackgroundEnabled(){this.background.enabled=!this.background.enabled,this.root.setHasChanges(!0),this.needSetBackground=!0}syncContrast(){const e=Pe(Fe([this.background.styles.backgroundColor,this.background.image&&this.background.image.average||"transparent"]),"dark","light");this.setContrastColor(e)}setContrastColor(e){this.background.styles.contrast=e,this.root.setHasChanges(!0),this.needSetBackground=!0}setBackgroundColor(e){this.background.styles.backgroundColor=e,this.root.setHasChanges(!0),this.needSetBackground=!0,this.syncContrast()}setBackgroundImage(e){this.needSetBackground=!0,this.root.setHasChanges(!0),this.background.image=e,this.syncContrast()}removeBackgroundImage(){this.needSetBackground=!0,this.root.setHasChanges(!0),this.background.image=null,this.syncContrast()}toggleBackgroundFixed(){this.needSetBackground=!0,this.root.setHasChanges(!0),this.background.styles.backgroundFixed=!this.background.styles.backgroundFixed}setBackgroundRepeat(e){this.needSetBackground=!0,this.root.setHasChanges(!0),this.background.styles.backgroundRepeat=e}setBackgroundPosition(e){this.needSetBackground=!0,this.root.setHasChanges(!0),this.background.styles.backgroundPosition=e}setBackgroundSize(e){this.needSetBackground=!0,this.root.setHasChanges(!0),this.background.styles.backgroundSize=e}toggleCompression(){this.root.setHasChanges(!0),this.background.compression=!this.background.compression,this.needSetBackground=!0}}).prototype,"showBullets",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lo=Vt(jo.prototype,"showCodeInsert",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),No=Vt(jo.prototype,"codeHead",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mo=Vt(jo.prototype,"codeBody",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Do=Vt(jo.prototype,"responsive",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vo=Vt(jo.prototype,"needSetBackground",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Oo=Vt(jo.prototype,"background",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{enabled:!1,image:null,compression:!1,styles:{backgroundColor:"#FFF",backgroundRepeat:"repeat",backgroundFixed:!1,backgroundPosition:"left top",backgroundSize:"auto",contrast:null}}}}),Vt(jo.prototype,"bindPageData",[l],Object.getOwnPropertyDescriptor(jo.prototype,"bindPageData"),jo.prototype),Vt(jo.prototype,"toggleShowBullets",[l],Object.getOwnPropertyDescriptor(jo.prototype,"toggleShowBullets"),jo.prototype),Vt(jo.prototype,"toggleShowCodeInsert",[l],Object.getOwnPropertyDescriptor(jo.prototype,"toggleShowCodeInsert"),jo.prototype),Vt(jo.prototype,"setCodeHead",[l],Object.getOwnPropertyDescriptor(jo.prototype,"setCodeHead"),jo.prototype),Vt(jo.prototype,"setCodeBody",[l],Object.getOwnPropertyDescriptor(jo.prototype,"setCodeBody"),jo.prototype),Vt(jo.prototype,"togglePageResponsive",[l],Object.getOwnPropertyDescriptor(jo.prototype,"togglePageResponsive"),jo.prototype),Vt(jo.prototype,"toggleBackgroundEnabled",[l],Object.getOwnPropertyDescriptor(jo.prototype,"toggleBackgroundEnabled"),jo.prototype),Vt(jo.prototype,"syncContrast",[l],Object.getOwnPropertyDescriptor(jo.prototype,"syncContrast"),jo.prototype),Vt(jo.prototype,"setContrastColor",[l],Object.getOwnPropertyDescriptor(jo.prototype,"setContrastColor"),jo.prototype),Vt(jo.prototype,"setBackgroundColor",[l],Object.getOwnPropertyDescriptor(jo.prototype,"setBackgroundColor"),jo.prototype),Vt(jo.prototype,"setBackgroundImage",[l],Object.getOwnPropertyDescriptor(jo.prototype,"setBackgroundImage"),jo.prototype),Vt(jo.prototype,"removeBackgroundImage",[l],Object.getOwnPropertyDescriptor(jo.prototype,"removeBackgroundImage"),jo.prototype),Vt(jo.prototype,"toggleBackgroundFixed",[l],Object.getOwnPropertyDescriptor(jo.prototype,"toggleBackgroundFixed"),jo.prototype),Vt(jo.prototype,"setBackgroundRepeat",[l],Object.getOwnPropertyDescriptor(jo.prototype,"setBackgroundRepeat"),jo.prototype),Vt(jo.prototype,"setBackgroundPosition",[l],Object.getOwnPropertyDescriptor(jo.prototype,"setBackgroundPosition"),jo.prototype),Vt(jo.prototype,"setBackgroundSize",[l],Object.getOwnPropertyDescriptor(jo.prototype,"setBackgroundSize"),jo.prototype),Vt(jo.prototype,"toggleCompression",[l],Object.getOwnPropertyDescriptor(jo.prototype,"toggleCompression"),jo.prototype),jo);var qo,Go,Xo,Ko,Wo,Zo,Yo,Jo,Qo,el;let tl=(Go=Vt((qo=class extends kt{get hasError(){return this.generalStore.uriError}constructor(e){super(),Dt(this,"isLoading",Go,this),Dt(this,"isSaving",Xo,this),Dt(this,"hasChanges",Ko,this),Dt(this,"pageId",Wo,this),Dt(this,"themeId",Zo,this),Dt(this,"settings",Yo,this),Dt(this,"meta",Jo,this),Dt(this,"mainPageData",Qo,this),Dt(this,"needReload",el,this),this.generalStore=null,this.seoStore=null,this.socialsStore=null,this.additionalStore=null,this.redirectsStore=null,this.pageId=e,this.generalStore=new To(this),this.seoStore=new Co(this),this.socialsStore=new Ho(this),this.additionalStore=new zo(this),this.redirectsStore=new ho}setIsLoading(e){this.isLoading=e}setHasChanges(e){this.hasChanges=e}setSavingState(e){this.isSaving=e}setNeedReload(e){this.needReload=e}async loadSettings(){try{const e=await ao.settingsLoad({pId:this.pageId});if(!e||!e.data||!e.meta){const e=new Error("Could not get page settings");return console.error(e),toast.error(e.message),e}return this.settings=e.data,this.meta=e.meta,e}catch(e){return console.error(e),toast.error("Could not get page settings"),e}}async loadMainPageData(){await ao.getPages({force:!0});const e=await ao.findPageByUri({uri:"/"});return this.mainPageData=e,e}bindPageData(){this.themeId=this.settings.theme_id,this.generalStore.bindPageData(),this.seoStore.bindPageData(),this.socialsStore.bindPageData(),this.additionalStore.bindPageData()}async onSave(){try{this.setSavingState("pending"),this.generalStore.fixUri();const e=this.getSave(),t=await ao.settingsSave(e);if(!t)throw new Error("Server error");if(window.isEditor){const e=t.p_data,s=e.p_title,i=e.p_uri;$("head title").text(s),t.is_uri_change&&window.history.replaceState("","",i),this.needReload&&window.location.reload(),await this.loadMainPageData(),flexbe_cli.events.trigger("page-settings_update",t),this.additionalStore.needSetBackground&&this.applyBackgroundSettings()}else await ao.getPages({force:!0});return this.setSavingState("success"),this.setHasChanges(!1),{success:!0,data:t}}catch(e){return this.setSavingState("error"),{success:!1,error:e.message}}finally{setTimeout((()=>{this.setSavingState(!1)}),650)}}applyBackgroundSettings(){flexbe.trigger("pageBackgroundChanged",{...this.additionalStore.background})}getSave(){const e=h({...this.settings}),{generalStore:t,seoStore:s,socialsStore:i,additionalStore:a}=this;return e.p_data.title=t.title,e.p_data.language=t.language,e.p_title=t.title,e.p_uri=t.uri,e.p_data.meta_desc=s.description,e.p_data.show_meta_keywords=s.showKeywords,e.p_data.meta_keywords=s.keywords,e.p_data.noindex=s.noindex,e.p_data.og_title=i.title,e.p_data.og_desc=i.description,e.p_data.meta_img=i.pageImage,e.p_data.show_bullets=a.showBullets,e.p_data.show_code=a.showCodeInsert,e.p_data.code_head=a.codeHead,e.p_data.code_body=a.codeBody,e.p_data.responsive=a.responsive,e.p_data.background=a.background,e}}).prototype,"isLoading",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xo=Vt(qo.prototype,"isSaving",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ko=Vt(qo.prototype,"hasChanges",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Wo=Vt(qo.prototype,"pageId",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zo=Vt(qo.prototype,"themeId",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yo=Vt(qo.prototype,"settings",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jo=Vt(qo.prototype,"meta",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qo=Vt(qo.prototype,"mainPageData",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),el=Vt(qo.prototype,"needReload",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Vt(qo.prototype,"hasError",[o],Object.getOwnPropertyDescriptor(qo.prototype,"hasError"),qo.prototype),Vt(qo.prototype,"setIsLoading",[l],Object.getOwnPropertyDescriptor(qo.prototype,"setIsLoading"),qo.prototype),Vt(qo.prototype,"setHasChanges",[l],Object.getOwnPropertyDescriptor(qo.prototype,"setHasChanges"),qo.prototype),Vt(qo.prototype,"setSavingState",[l],Object.getOwnPropertyDescriptor(qo.prototype,"setSavingState"),qo.prototype),Vt(qo.prototype,"setNeedReload",[l],Object.getOwnPropertyDescriptor(qo.prototype,"setNeedReload"),qo.prototype),Vt(qo.prototype,"loadSettings",[l],Object.getOwnPropertyDescriptor(qo.prototype,"loadSettings"),qo.prototype),Vt(qo.prototype,"loadMainPageData",[l],Object.getOwnPropertyDescriptor(qo.prototype,"loadMainPageData"),qo.prototype),Vt(qo.prototype,"bindPageData",[l],Object.getOwnPropertyDescriptor(qo.prototype,"bindPageData"),qo.prototype),qo);const sl={css:null,exports:{setup(e,{initMobx:t,inject:s}){t(),this.modal=s("modal"),this.store=new tl(e.props.pId),this.$saveButton=null,this.watch={"store.isLoading":()=>this.update(),"store.hasChanges":()=>this.update(),"store.isSaving":()=>this.update()},this.list={title:tr("admin::pages::settings::title"),content:[{title:tr("admin::pages::settings::base::title"),block:"page-settings-general",show:!0},{title:"SEO",block:"page-settings-seo",show:!0},{title:tr("admin::pages::settings::social::title"),block:"page-settings-socials",show:!0},{title:tr("admin::pages::settings::additional::title"),block:"page-settings-additional",show:!0}],buttons:[{title:tr("main::button::save"),get class(){const t=e.store.isSaving,s=e.store.hasChanges;let i="";return i="success"===t?"is-primary is-success":s?"is-primary":"is-secondary",`save-button filled large rounded ${i}`},get loading(){return e.store.isSaving},handler:()=>this.onSave()},{title:tr("main::button::close"),class:"large rounded ml5",handler:()=>this.modal.cancel()}]},this.meta={sprite:at("pages","admin")}},async onMounted(){this.$saveButton=$(this.root).find(".save-button"),this.store.setIsLoading(!0),await this.store.loadSettings(),await this.store.loadMainPageData(),this.store.bindPageData(),this.store.setIsLoading(!1),this._hotkeysDisposer=fs.register([{hotkeys:["cmd_s"],handlerDown:()=>this.onSave()}])},onBeforeUnmount(){this._hotkeysDisposer&&this._hotkeysDisposer()},async onSave(){if(this.store.hasError)return this.$saveButton.removeClass("shake-animation"),this.$saveButton.outerWidth(),this.$saveButton.addClass("shake-animation"),toast.error(tr("main::error:check_fields")),!1;const{success:e,error:t}=await this.store.onSave();t&&toast.error(t)}},template:(e,t,s,i)=>e('<div expr148="expr148" is="block-scrollable_menu"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["page-settings ",e.props.className].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"block-scrollable_menu",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.list},{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store},{type:t.ATTRIBUTE,name:"modal",evaluate:e=>e.modal},{type:t.ATTRIBUTE,name:"loader",evaluate:e=>e.store.isLoading},{type:t.ATTRIBUTE,name:"maxHeightBy",evaluate:e=>e.modal.$modal[0]}],redundantAttribute:"expr148",selector:"[expr148]"}]),name:"admin-page-settings"};e(sl.name,sl);const il={css:null,exports:{setup(e){this.store=e.props.store}},template:(e,t,s,i)=>e('<div expr984="expr984" class="flexbe-title text-m"> </div><div expr985="expr985" class="flexbe-placeholder" style="height: 60px;"></div><template expr986="expr986"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-field-group ps-general-title"}]},{redundantAttribute:"expr984",selector:"[expr984]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::common::title_label")].join("")}]},{type:s.IF,evaluate:e=>e.store.isLoading,redundantAttribute:"expr985",selector:"[expr985]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.store.isLoading,redundantAttribute:"expr986",selector:"[expr986]",template:e('<div expr987="expr987" is="flexbe-input" type="text"></div><div expr988="expr988" class="text-xs flexbe-desc"> </div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.store.generalStore.title},{type:t.ATTRIBUTE,name:"maxLength",evaluate:e=>198},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.store.generalStore.setTitle(t.target.value)}],redundantAttribute:"expr987",selector:"[expr987]"},{redundantAttribute:"expr988",selector:"[expr988]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.store.generalStore.titleHelpText].join("")}]}])}]),name:"ps-general-title"};e(il.name,il);const al={css:null,exports:{setup(e,{initMobx:t}){t(),this.store=e.props.store,this.state={initialValue:e.props.store.generalStore.uri,redirects:[],get store(){return e.props.store},get redirectsStore(){return this.store.redirectsStore},get uri(){return this.store.generalStore.uri},get isMainPage(){return"/"===this.uri},get isUriChanged(){return this.initialValue!==this.uri},get isLoading(){return this.store.isLoading},get needRedirectForPage(){if(this.redirects.length<0)return!1;return this.redirects.filter((e=>e.enabled)).some((e=>this.redirectsStore.helpers.needRedirectForPage(e.from_page,this.uri,e.regular_from_page)))}},this.meta={sprite:at("pages","admin"),redirectLink:"/admin/settings/redirects/"},this.watch={"state.isMainPage":()=>this.update(),"state.isUriChanged":()=>this.update(),"state.redirects":()=>this.update(),"state.needRedirectForPage":()=>this.update()},b((()=>!this.state.isLoading),(()=>{this.state.initialValue=this.state.uri,this.update()}))},async onMounted(){await this.state.redirectsStore.loadState({routeArgs:{path:"settings/redirects",query:{}}}),this.state.redirects=this.state.redirectsStore.state}},template:(e,t,s,i)=>e('<div expr989="expr989" class="flexbe-title text-m"> </div><div expr990="expr990" class="flexbe-placeholder" style="height: 60px;"></div><div expr991="expr991"></div><div expr997="expr997" is="ps-info-bar"></div><div expr998="expr998" is="ps-info-bar"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-field-group ps-general-uri"}]},{redundantAttribute:"expr989",selector:"[expr989]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::common::uri_label")].join("")}]},{type:s.IF,evaluate:e=>e.store.isLoading,redundantAttribute:"expr990",selector:"[expr990]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.store.isLoading,redundantAttribute:"expr991",selector:"[expr991]",template:e('<div expr992="expr992" is="flexbe-input" type="text" placeholder="/example/"></div><div expr996="expr996"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.classNames({"flexbe-field-group compact":e.state.isUriChanged||e.state.needRedirectForPage})}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[{id:"default",html:'<div expr993="expr993" class="flexbe-button small style-text make-main"></div>',bindings:[{type:s.IF,evaluate:e=>!e.state.isMainPage,redundantAttribute:"expr993",selector:"[expr993]",template:e('<svg class="flexbe-icon size-14"><use expr994="expr994"/></svg><span expr995="expr995" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.store.generalStore.makeMain()}]},{redundantAttribute:"expr994",selector:"[expr994]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#home"].join("")}]},{redundantAttribute:"expr995",selector:"[expr995]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::base::make_homepage")].join("")}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.store.generalStore.uri},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.store.generalStore.uriError},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.store.generalStore.uriIsDisabled},{type:t.ATTRIBUTE,name:"required",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"maxLength",evaluate:e=>250},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.store.generalStore.setUri(t.target.value)}],redundantAttribute:"expr992",selector:"[expr992]"},{type:s.IF,evaluate:e=>e.store.generalStore.uriHelpText,redundantAttribute:"expr996",selector:"[expr996]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.store.generalStore.uriHelpText].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["text-xs ",e.store.generalStore.uriError?"flexbe-error":"flexbe-desc"].join("")}]}])}])},{type:s.IF,evaluate:e=>e.state.isUriChanged,redundantAttribute:"expr997",selector:"[expr997]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"ps-info-bar",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.classNames({"flexbe-field-group compact":e.state.isUriChanged&&e.state.needRedirectForPage})},{type:t.ATTRIBUTE,name:"text",evaluate:e=>e.tr("admin::pages::settings::base::uri_changed",{href:e.meta.redirectLink})}]}])},{type:s.IF,evaluate:e=>e.state.needRedirectForPage,redundantAttribute:"expr998",selector:"[expr998]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"ps-info-bar",slots:[],attributes:[{type:t.ATTRIBUTE,name:"text-link",evaluate:e=>e.tr("admin::pages::settings::base::uri_redirect_link")},{type:t.ATTRIBUTE,name:"to-link",evaluate:e=>e.meta.redirectLink},{type:t.ATTRIBUTE,name:"text",evaluate:e=>e.tr("admin::pages::settings::base::uri_have_redirect")}]}])}]),name:"ps-general-uri"};e(al.name,al);const nl={css:null,exports:{setup(e){this.store=e.props.store,this.state={get languages(){if(!e.store.meta.languages)return[];return[{value:"inherit",title:tr("admin::pages::common::main_lang")},...e.store.meta.languages]},get language(){return e.store.generalStore.language?e.store.generalStore.language:"inherit"}}}},template:(e,t,s,i)=>e('<div expr999="expr999" class="flexbe-title text-m"> </div><div expr1000="expr1000" class="flexbe-placeholder" style="height: 60px;"></div><template expr1001="expr1001"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-field-group ps-general-lang"}]},{redundantAttribute:"expr999",selector:"[expr999]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::common::lang_label")].join("")}]},{type:s.IF,evaluate:e=>e.store.isLoading,redundantAttribute:"expr1000",selector:"[expr1000]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.store.isLoading,redundantAttribute:"expr1001",selector:"[expr1001]",template:e('<div expr1002="expr1002" is="proxy" data-is="flexbe-select"></div><div class="text-xs flexbe-desc"><raw expr1003="expr1003"></raw></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.state.languages},{type:t.ATTRIBUTE,name:"initial-value",evaluate:e=>e.state.language},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.store.generalStore.setLanguage(t.value)}],redundantAttribute:"expr1002",selector:"[expr1002]"},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::pages::settings::base::lang_note",{href:"/admin/settings/general/"})}],redundantAttribute:"expr1003",selector:"[expr1003]"}])}]),name:"ps-general-lang"};e(nl.name,nl);const rl={css:null,exports:{components:{"ps-general-title":il,"ps-general-uri":al,"ps-general-lang":nl},setup(e,{initMobx:t}){t(),this.store=e.props.store,this.watch={"store.generalStore":[()=>this.update(),{deep:!0}]}}},template:(e,t,s,i)=>e('<div expr899="expr899" is="ps-general-title"></div><div expr900="expr900" is="ps-general-uri"></div><div expr901="expr901" is="ps-general-lang"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.props.class}]},{type:s.TAG,getComponent:i,evaluate:e=>"ps-general-title",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store}],redundantAttribute:"expr899",selector:"[expr899]"},{type:s.TAG,getComponent:i,evaluate:e=>"ps-general-uri",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store}],redundantAttribute:"expr900",selector:"[expr900]"},{type:s.TAG,getComponent:i,evaluate:e=>"ps-general-lang",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store}],redundantAttribute:"expr901",selector:"[expr901]"}]),name:"page-settings-general"};e(rl.name,rl);const ol={css:null,exports:{setup(e,{initMobx:t}){t(),this.store=e.props.store}},template:(e,t,s,i)=>e('<div class="flexbe-field-group"><div expr1004="expr1004" class="flexbe-placeholder" style="height: 36px;"></div><div expr1005="expr1005" class="flexbe-field-item"></div></div><div expr1009="expr1009" class="flexbe-field-group ps-seo-keywords__field"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["ps-seo-keywords ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.store.isLoading,redundantAttribute:"expr1004",selector:"[expr1004]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.store.isLoading,redundantAttribute:"expr1005",selector:"[expr1005]",template:e('<label expr1006="expr1006" is="flexbe-checkbox" type="toggle"></label>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr1007="expr1007" class="flexbe-text"> </span><q expr1008="expr1008" is="flexbe-tooltip"></q>',bindings:[{redundantAttribute:"expr1007",selector:"[expr1007]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::seo::meta_keywords_toggle")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::pages::settings::seo::meta_keywords_toggle_tip")}],redundantAttribute:"expr1008",selector:"[expr1008]"}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.store.seoStore.showKeywords},{type:t.EVENT,name:"onchange",evaluate:e=>()=>e.store.seoStore.toggleShowKeywords()}],redundantAttribute:"expr1006",selector:"[expr1006]"}])},{type:s.IF,evaluate:e=>!e.store.isLoading&&e.store.seoStore.showKeywords,redundantAttribute:"expr1009",selector:"[expr1009]",template:e('<div expr1010="expr1010" class="flexbe-title text-m"> </div><div class="flexbe-field-item"><div expr1011="expr1011" is="flexbe-input" type="textarea"></div></div><div class="flexbe-field-item compact"><div expr1012="expr1012"> </div></div>',[{redundantAttribute:"expr1010",selector:"[expr1010]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::seo::meta_keywords_label")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.store.seoStore.keywords},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.store.seoStore.keywordsError},{type:t.ATTRIBUTE,name:"rows",evaluate:e=>3},{type:t.ATTRIBUTE,name:"cols",evaluate:e=>80},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.store.seoStore.setKeywords(t.target.value)}],redundantAttribute:"expr1011",selector:"[expr1011]"},{redundantAttribute:"expr1012",selector:"[expr1012]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.store.seoStore.keywordsHelpText].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-desc text-xs ",e.props.error?"flexbe-error":""].join("")}]}])}]),name:"ps-seo-keywords"};e(ol.name,ol);const ll={css:null,exports:{components:{"ps-seo-keywords":ol},setup(e,{initMobx:t}){t(),this.store=e.props.store,this.watch={"store.seoStore":[()=>this.update(),{deep:!0}]}}},template:(e,t,s,i)=>e('<div class="flexbe-field-group"><div expr902="expr902" class="flexbe-title text-m"> </div><template expr903="expr903"></template><div expr906="expr906" class="flexbe-placeholder" style="height: 90px;"></div></div><div expr907="expr907" is="ps-seo-keywords"></div><div class="flexbe-field-group"><label expr908="expr908" is="flexbe-checkbox" type="toggle"></label></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>[e.props.class," ps-seo-description"].join("")},{type:t.ATTRIBUTE,name:"xmlns",evaluate:e=>"http://www.w3.org/1999/html"}]},{redundantAttribute:"expr902",selector:"[expr902]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::seo::meta_desc_label")].join("")}]},{type:s.IF,evaluate:e=>!e.store.isLoading,redundantAttribute:"expr903",selector:"[expr903]",template:e('<div expr904="expr904" is="flexbe-input" type="textarea"></div><div expr905="expr905"> </div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.store.seoStore.description},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.store.seoStore.descriptionError},{type:t.ATTRIBUTE,name:"rows",evaluate:e=>3},{type:t.ATTRIBUTE,name:"cols",evaluate:e=>80},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.store.seoStore.setDescription(t.target.value)}],redundantAttribute:"expr904",selector:"[expr904]"},{redundantAttribute:"expr905",selector:"[expr905]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.store.seoStore.descriptionError?e.tr("admin::pages::settings::seo::error_meta_tag"):e.tr("admin::pages::settings::seo::meta_desc_note")].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-desc text-xs ",e.store.seoStore.descriptionError?"flexbe-error":""].join("")}]}])},{type:s.IF,evaluate:e=>e.store.isLoading,redundantAttribute:"expr906",selector:"[expr906]",template:e(null,[])},{type:s.TAG,getComponent:i,evaluate:e=>"ps-seo-keywords",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-field-group ",e.store.seoStore.showKeywords?"":"compact"].join("")},{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store}],redundantAttribute:"expr907",selector:"[expr907]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr909="expr909" class="flexbe-text"> </span>',bindings:[{redundantAttribute:"expr909",selector:"[expr909]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::seo::noindex_toggle")].join("")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.store.seoStore.noindex},{type:t.EVENT,name:"onchange",evaluate:e=>()=>e.store.seoStore.toggleNoindex()}],redundantAttribute:"expr908",selector:"[expr908]"}]),name:"page-settings-seo"};e(ll.name,ll);const dl={css:null,exports:{sprite:at("pages","admin"),socials:["facebook","instagram","telegram","vkontakte"]},template:(e,t,s,i)=>e('<div expr1013="expr1013" class="ps-socials-info__text text-xs"> </div><div class="ps-socials-info__icons"><svg expr1014="expr1014" class="flexbe-icon size-18"></svg></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-field-group ps-socials-info flexbe-bar rounded"}]},{redundantAttribute:"expr1013",selector:"[expr1013]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::social::info_title")].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e('<use expr1015="expr1015"/>',[{redundantAttribute:"expr1015",selector:"[expr1015]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.sprite,"#",e.item].join("")}]}]),redundantAttribute:"expr1014",selector:"[expr1014]",itemName:"item",indexName:null,evaluate:e=>e.socials}]),name:"ps-socials-info"};var cl;e(dl.name,dl);let pl=(Vt((cl=class extends kt{constructor(){super(),this.useProxyLink=void 0,this.searchValue="",this.inSearch=!1,this.cacheListImages={pixabay:[],unsplash:[],pexels:[]},this.useProxyLink=!1}setUseProxy(e){this.useProxyLink=e}setImagesInCache(e,t){this.cacheListImages[e]=t}clearCacheList(){this.cacheListImages.pixabay=[],this.cacheListImages.unsplash=[],this.cacheListImages.pexels=[]}setInSearch(e){this.inSearch=e}setSearchValue(e){this.searchValue=e}}).prototype,"setUseProxy",[l],Object.getOwnPropertyDescriptor(cl.prototype,"setUseProxy"),cl.prototype),Vt(cl.prototype,"setImagesInCache",[l],Object.getOwnPropertyDescriptor(cl.prototype,"setImagesInCache"),cl.prototype),Vt(cl.prototype,"clearCacheList",[l],Object.getOwnPropertyDescriptor(cl.prototype,"clearCacheList"),cl.prototype),Vt(cl.prototype,"setInSearch",[l],Object.getOwnPropertyDescriptor(cl.prototype,"setInSearch"),cl.prototype),Vt(cl.prototype,"setSearchValue",[l],Object.getOwnPropertyDescriptor(cl.prototype,"setSearchValue"),cl.prototype),cl);const ul={css:null,exports:{setup(e,{initMobx:t}){t();const s="cache.flexbe.net";this.state={inSelect:!1,store:e.props.store,get img(){return e.props.img},get imgAuthor(){return this.img.user},get imgLink(){return this.img.url},get imgStyle(){const{img:e}=this;return`background-color: ${e.color||"#A5BECA"}; padding-bottom: ${e.height/e.width*100}%`},get imgSrc(){const t=e.props.type;let i=this.imgLink.preview;if(this.store.useProxyLink)switch(t){case"pexels":i=i.replace("images.pexels.com",`${s}`);break;case"pixabay":i=i.replace("pixabay.com",`${s}`)}return i}},this.watch={"state.inSelect":[()=>this.update()]}},selectImage(){if(this.state.inSelect)return;const{img:e,imgLink:t}=this.state,s=t.full;this.state.inSelect=e.id,this.setImageByUrl(s,(()=>{setTimeout((()=>{r((()=>{this.state.inSelect=!1}))}),1e3)}))},getLinkWithUtm:e=>`${e}?utm_source=flexbe&utm_medium=referral&utm_campaign=api-credit`,uploadDone(...e){"function"==typeof this.props.onUploadDone&&this.props.onUploadDone(...e)},setImageByUrl(e,t=(()=>{})){const s=$.ajax({url:`/admin/api/project/${flexbe.vars.group.id}/file/upload_url/`,type:"POST",dataType:"json",data:{type:"image",file_name:"upload.jpg",file_url:e}});s.done((e=>{e.img_id?(this.uploadDone(e),t(e)):(t(!1),toast.error(tr("main::error::upload_file")))})),s.fail((()=>{t(!1),toast.error(tr("main::error::upload_file"))}))},onErrorImg(){this.state.store.setUseProxy(!0)}},template:(e,t,s,i)=>e('<img expr947="expr947" style="opacity: 1"/><div expr948="expr948" is="flexbe-loader" class="loader color-inherit"></div><div class="overlay"><a expr949="expr949" target="_blank"> </a>\n        -\n        <a expr950="expr950" target="_blank"> </a></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["image ",e.state.inSelect===e.state.img.id?"loading":""].join("")},{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.state.imgStyle}]},{redundantAttribute:"expr947",selector:"[expr947]",expressions:[{type:t.ATTRIBUTE,name:"src",evaluate:e=>e.state.imgSrc},{type:t.EVENT,name:"onclick",evaluate:e=>e.selectImage},{type:t.EVENT,name:"onerror",evaluate:e=>e.onErrorImg}]},{type:s.IF,evaluate:e=>e.state.inSelect===e.state.img.id,redundantAttribute:"expr948",selector:"[expr948]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[]}])},{redundantAttribute:"expr949",selector:"[expr949]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.imgAuthor.name].join("")},{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.getLinkWithUtm(e.state.imgAuthor.link)}]},{redundantAttribute:"expr950",selector:"[expr950]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.props.name].join("")},{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.getLinkWithUtm(e.state.imgLink.originalSource)}]}]),name:"flexbe-gallery-image"};e(ul.name,ul);const ml=[{name:tr("editor::background::gallery::category_nature"),search:"nature"},{name:tr("editor::background::gallery::category_landscape"),search:"landscape"},{name:tr("editor::background::gallery::category_mountains"),search:"mountains"},{name:tr("editor::background::gallery::category_sky"),search:"sky"},{name:tr("editor::background::gallery::category_city"),search:"city"},{name:tr("editor::background::gallery::category_road"),search:"road"},{name:tr("editor::background::gallery::category_people"),search:"people"},{name:tr("editor::background::gallery::category_girl"),search:"girl"},{name:tr("editor::background::gallery::category_woman"),search:"woman"},{name:tr("editor::background::gallery::category_man"),search:"man"},{name:tr("editor::background::gallery::category_friends"),search:"friends"},{name:tr("editor::background::gallery::category_family"),search:"family"},{name:tr("editor::background::gallery::category_love"),search:"love"},{name:tr("editor::background::gallery::category_happy"),search:"happy"},{name:tr("editor::background::gallery::category_wedding"),search:"wedding"},{name:tr("editor::background::gallery::category_flower"),search:"flower"},{name:tr("editor::background::gallery::category_animal"),search:"animal"},{name:tr("editor::background::gallery::category_coffee"),search:"coffee"},{name:tr("editor::background::gallery::category_food"),search:"food"},{name:tr("editor::background::gallery::category_restaurant"),search:"restaurant"},{name:tr("editor::background::gallery::category_home"),search:"home"},{name:tr("editor::background::gallery::category_work"),search:"work"},{name:tr("editor::background::gallery::category_construction"),search:"construction"},{name:tr("editor::background::gallery::category_business"),search:"business"},{name:tr("editor::background::gallery::category_office"),search:"office"},{name:tr("editor::background::gallery::category_desk"),search:"desk"},{name:tr("editor::background::gallery::category_computer"),search:"computer"},{name:tr("editor::background::gallery::category_clock"),search:"clock"},{name:"Apple",search:"apple"},{name:tr("editor::background::gallery::category_music"),search:"music"},{name:tr("editor::background::gallery::category_sport"),search:"sport"},{name:tr("editor::background::gallery::category_bike"),search:"bike"},{name:tr("editor::background::gallery::category_motorcycle"),search:"motorcycle"},{name:tr("editor::background::gallery::category_car"),search:"car"},{name:tr("editor::background::gallery::category_summer"),search:"summer"},{name:tr("editor::background::gallery::category_winter"),search:"winter"},{name:tr("editor::background::gallery::category_spring"),search:"spring"},{name:tr("editor::background::gallery::category_autumn"),search:"autumn"},{name:tr("editor::background::gallery::category_rain"),search:"rain"}],hl={css:null,exports:{setup(e,{initMobx:t}){t(),this.store=e.props.store,this.state={cache:{},searchTimeout:!1,perColumn:10,columns:3,search:!1,showEmptyPage:!1,showStartPage:!0,inSearch:this.showStartPage,inLoad:!1,loading:!1,term:"",inputValue:"",list:[],get emptyPageContent(){return tr("editor::background::gallery::search::empty_page",{search:this.term})},get editor(){var t;return(null==(t=e.options)?void 0:t.editor)||!1},get preloadCount(){return this.columns*this.perColumn},get columnsArr(){return Array.from({length:this.columns},((e,t)=>t))}},this.meta={sprite:at("gallery"),explode:ml},this.watch={"state.list":[()=>this.update()],"state.inLoad":[()=>this.update()],"state.loading":[()=>this.update()]}},selectTag(e=null,t=null){var s;if(this.state.search===e)return void(this.state.search=!1);const i=null==t?void 0:t.target,a=e&&this.meta.explode.find((t=>{const s=e=>e.toLowerCase();return s(t.search)===s(e)||s(t.name)===s(e)})),n=a;this.state.cache[this.state.search]=$.extend([],this.list),this.state.list=[],this.state.search=null!=(s=null==a?void 0:a.search)?s:e,i&&(this.state.term=n?"":a.name,this.state.showEmptyPage=!1),this.state.showStartPage=!this.state.search||!a||i&&!this.state.term&&!n,this.state.inSearch=this.state.showStartPage,this.viewHelp(a,i),setTimeout((()=>{r((()=>{this.state.list=$.extend(!0,[],this.state.cache[this.state.search])})),this.state.list.length?r((()=>{this.state.showEmptyPage=!1,this.state.showStartPage=!1,this.state.loading=!1})):(r((()=>{this.state.inLoad=!1})),this.loadFromService())}),100)},viewHelp(e=null,t=null){const s=$(".flexbe-list",this.root),i=s.children(".flexbe-gallery-item"),a=$(this.root).parent(".flexbe-modal-data"),n=$(".column",this.root);i.removeClass("active"),e?t?$(t).addClass("active"):i.each(((t,i)=>{i.innerText===e.name&&($(i).addClass("active"),s.animate({scrollTop:i.offsetTop-100}))})):s.animate({scrollTop:0}),n[0]&&n[0].scrollIntoView({block:"start",behavior:"smooth"}),a.scrollTop(0)},setTerm(e){if(!e||!e.target)return!1;const t=e.target.value.trim();this.state.inputValue=e.target.value,t!==this.state.term&&(this.state.term=t.replace(/ +/g," ").trim(),this.state.loading=!0,0===this.state.term.length?(clearTimeout(this.state.searchTimeout),this.state.showEmptyPage=!1,this.state.showStartPage=!0,this.state.inSearch=!0,this.state.loading=!1,this.state.search=!1,this.viewHelp()):(this.state.searchTimeout&&(clearTimeout(this.state.searchTimeout),this.state.searchTimeout=!1),this.state.searchTimeout=setTimeout((()=>{this.state.searchTimeout=!1,this.selectTag(this.state.term)}),500)))},loadFromService(e=null){if(this.state.inLoad||!this.state.search)return;const t=this.state.list.length,s=this.state.search;this.state.showStartPage=!1,this.state.loading=!0,this.state.inLoad=!0,this.service(t+1,this.state.preloadCount,this.state.search,(i=>{let a=0;if(r((()=>{this.state.inLoad=!1,this.state.showEmptyPage=!1})),"function"==typeof e&&e(i),!i||!Array.isArray(i)||!i.length)return this.state.list.length?void r((()=>{this.state.search=!1,this.state.loading=!1})):void r((()=>{this.state.showEmptyPage=!0,this.state.inSearch=!0,this.state.loading=!1}));s===this.state.search&&(this.state.list[t]=[[],[],[]],i.forEach((e=>{a>this.state.columns-1&&(a=0),this.state.list[t][a].push(e),a+=1})),r((()=>{this.state.loading=!1})))}))},service(e,t,s,i){const a=this.props.type,n=$.ajax({url:"/admin/api/image_search/",type:"GET",dataType:"json",data:{per_page:t,search:s,page:e,type:a}});n.done((e=>{Array.isArray(e)?i(e):i(!1)})),n.fail((()=>{i(!1)}))},syncGalleryStoreOnMount(){this.state.inputValue=this.store.searchValue,this.update(),this.store.inSearch&&this.store.searchValue&&(this.store.cacheListImages[this.props.type].length>0?(this.state.list=this.store.cacheListImages[this.props.type],this.state.showStartPage=!1,this.state.inSearch=!0,this.state.search=this.store.searchValue):this.setTerm({target:{value:this.store.searchValue}}),this.update())},syncGalleryStoreOnUnmount(){if(this.store.searchValue!==this.state.inputValue&&this.store.clearCacheList(),this.store.setSearchValue(this.state.inputValue),!this.state.inSearch)return this.store.clearCacheList(),void this.store.setInSearch(!1);this.store.setInSearch(!0),this.store.setImagesInCache(this.props.type,this.state.list)},onUnmounted(){this.syncGalleryStoreOnUnmount()},onMounted(){const e=$(this.root).find(".columns"),t=e.find(".column");this.syncGalleryStoreOnMount(),e.on("scroll",(e=>{const s=e.currentTarget.scrollTop+e.currentTarget.offsetHeight;let i=1/0;t.each(((e,t)=>{const s=t.offsetHeight;i>s&&(i=s)})),s+600>i&&this.loadFromService()}))}},template:(e,t,s,i)=>e('<div class="image-list"><div class="image-list-gallery"><div class="flexbe-list-container"><div expr642="expr642" class="image-item-category"> </div><div class="flexbe-list spaceless hoverable opacify scrollable-content"><div expr643="expr643"> </div><template expr644="expr644"></template></div></div><div class="search-container"><div class="image-search-container"><svg class="icon-search"><use expr646="expr646"/></svg><label expr647="expr647" is="flexbe-input" class="image-input-search grow" type="text"></label><div expr648="expr648" is="flexbe-loader" class="loader"></div></div><div class="result-container"><div expr649="expr649" class="image-search-start"></div><div expr653="expr653" class="image-search-empty"></div><div expr656="expr656"><div expr657="expr657" class="column"></div><div expr661="expr661" class="more"></div></div></div></div></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-gallery-modal"}]},{redundantAttribute:"expr642",selector:"[expr642]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::background::gallery::category::title")].join("")}]},{redundantAttribute:"expr643",selector:"[expr643]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::background::gallery::category_search")].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-gallery-item search-item ",e.state.inSearch&&!e.state.loading?"in-search":""].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.selectTag.bind(e,!1)}]},{type:s.EACH,getKey:null,condition:null,template:e('<div expr645="expr645" class="flexbe-gallery-item"> </div>',[{redundantAttribute:"expr645",selector:"[expr645]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.explode.name].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.selectTag.bind(e,e.explode.search)}]}]),redundantAttribute:"expr644",selector:"[expr644]",itemName:"explode",indexName:null,evaluate:e=>e.meta.explode},{redundantAttribute:"expr646",selector:"[expr646]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#search"].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.inputValue},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("editor::background::gallery::search::placeholder")},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0},{type:t.EVENT,name:"oninput",evaluate:e=>e.setTerm},{type:t.EVENT,name:"onenter",evaluate:e=>e.setTerm}],redundantAttribute:"expr647",selector:"[expr647]"},{type:s.IF,evaluate:e=>e.state.loading,redundantAttribute:"expr648",selector:"[expr648]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[]}])},{type:s.IF,evaluate:e=>e.state.showStartPage,redundantAttribute:"expr649",selector:"[expr649]",template:e('<svg class="flexbe-icon image-search-logo-icon mt10 mb20"><use expr650="expr650"/></svg><div expr651="expr651" class="flexbe-title text-l"> </div><div expr652="expr652" class="flexbe-desc text-s" is="raw"></div>',[{redundantAttribute:"expr650",selector:"[expr650]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#logo"].join("")}]},{redundantAttribute:"expr651",selector:"[expr651]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::background::gallery::search_title",{title:e.props.name})].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("editor::background::gallery::search_desc",{title:e.props.name})}],redundantAttribute:"expr652",selector:"[expr652]"}])},{type:s.IF,evaluate:e=>e.state.showEmptyPage,redundantAttribute:"expr653",selector:"[expr653]",template:e('<svg class="image-search-empty-icon"><use expr654="expr654"/></svg><div expr655="expr655" is="raw"></div>',[{redundantAttribute:"expr654",selector:"[expr654]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#empty_page"].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.state.emptyPageContent}],redundantAttribute:"expr655",selector:"[expr655]"}])},{redundantAttribute:"expr656",selector:"[expr656]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["columns scrollable-content ",e.state.showEmptyPage||e.state.showStartPage?"hidden":""].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e('<div expr658="expr658" class="page show"></div>',[{type:s.EACH,getKey:null,condition:null,template:e('<div expr659="expr659" class="item"></div>',[{type:s.EACH,getKey:null,condition:null,template:e('<div expr660="expr660" is="flexbe-gallery-image"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-gallery-image",slots:[],attributes:[{type:t.ATTRIBUTE,name:"img",evaluate:e=>e.img},{type:t.ATTRIBUTE,name:"type",evaluate:e=>e.props.type},{type:t.ATTRIBUTE,name:"name",evaluate:e=>e.props.name},{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store},{type:t.EVENT,name:"onUploadDone",evaluate:e=>{var t;return null==(t=e.props)?void 0:t.onUploadDone}}],redundantAttribute:"expr660",selector:"[expr660]"}]),redundantAttribute:"expr659",selector:"[expr659]",itemName:"img",indexName:null,evaluate:e=>e.page[e.columnIndex]}]),redundantAttribute:"expr658",selector:"[expr658]",itemName:"page",indexName:null,evaluate:e=>e.state.list}]),redundantAttribute:"expr657",selector:"[expr657]",itemName:"columnIndex",indexName:null,evaluate:e=>e.state.columnsArr},{type:s.IF,evaluate:e=>e.state.loading,redundantAttribute:"expr661",selector:"[expr661]",template:e('<div expr662="expr662" is="flexbe-loader" class="loader"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[],redundantAttribute:"expr662",selector:"[expr662]"}])}]),name:"flexbe-gallery-modal"};e(hl.name,hl);var gl=function(e){return e.PEXELES="pexels",e.UNSPLASH="unsplash",e.PIXABAY="pixabay",e}(gl||{});function vl({modalOptions:e,onUploadDone:t}){const s=new pl;return s.setUseProxy(["BY","RU"].includes(flexbe.vars.group.country)),Zs.create({width:770,title:tr("editor::background::gallery::modal_title"),overlay:!0,shadow:!1,...e,component:"flexbe-gallery-modal",tabs:[{id:"pexels",title:"Pexels",props:{type:gl.PEXELES,name:"Pexels",store:s}},{id:"pixabay",title:"Pixabay",props:{type:gl.PIXABAY,name:"Pixabay",store:s}}],props:{onUploadDone:t}})}const fl={css:null,exports:{sprite:at("pages","admin"),setup(e,{initMobx:t}){t();const s=e.props.store;this.store=s,this.state={get title(){return s.socialsStore.title||s.generalStore.title},get description(){return s.socialsStore.description||s.seoStore.description},get domain(){return s.socialsStore.domain}}},onError(){toast.error(tr("main::error::upload_image"))},openUnsplashGallery(){vl({onUploadDone:e=>this.store.socialsStore.uploadImageDone("gallery",e)})}},template:(e,t,s,i)=>e('<div expr1016="expr1016" class="flexbe-title text-m"> </div><div expr1017="expr1017" class="flexbe-placeholder" style="height: 246px;"></div><template expr1018="expr1018"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-field-group ps-socials-preview"}]},{redundantAttribute:"expr1016",selector:"[expr1016]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::social::upload_title")].join("")}]},{type:s.IF,evaluate:e=>e.store.isLoading,redundantAttribute:"expr1017",selector:"[expr1017]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.store.isLoading,redundantAttribute:"expr1018",selector:"[expr1018]",template:e('<div class="ps-socials-preview__uploading-block drop-zone-target"><div class="ps-socials-preview__preview-holder"><div expr1019="expr1019" class="ps-socials-preview__preview"><div expr1020="expr1020" class="ps-socials-preview__delete-button"></div><div expr1022="expr1022" class="ps-socials-preview__default-tip"></div></div><div class="ps-socials-preview__about"><div expr1025="expr1025" class="flexbe-text text-subtitle text-medium mb5 mt0"></div><div expr1026="expr1026" class="flexbe-desc text-xs mb5 mt0"></div><div expr1027="expr1027" class="flexbe-desc text-xs mt0"></div></div></div><div class="ps-socials-preview__upload"><div expr1028="expr1028" is="proxy" data-is="flexbe-button-upload" file-type="image" regular-class="is-secondary" drop-zone=".drop-zone-target"></div><button expr1029="expr1029" class="flexbe-button bg_option block filled"><svg class="flexbe-icon size-16"><use href="/_s/images/editor/editor_background.svg#photo_gallery"/></svg><span expr1030="expr1030" class="flexbe-text"> </span></button><div class="inline-box justify-content-center flexbe-desc"><svg class="flexbe-icon size-16"><use expr1031="expr1031"/></svg><span expr1032="expr1032" class="flexbe-text"> </span></div></div></div><div expr1033="expr1033" class="flexbe-desc text-xs" is="raw"></div>',[{redundantAttribute:"expr1019",selector:"[expr1019]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.store.socialsStore.metaImage}]},{type:s.IF,evaluate:e=>e.store.socialsStore.pageImage,redundantAttribute:"expr1020",selector:"[expr1020]",template:e('<svg class="flexbe-icon size-12"><use expr1021="expr1021"/></svg>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.store.socialsStore.removeImage()}]},{redundantAttribute:"expr1021",selector:"[expr1021]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.sprite,"#delete"].join("")}]}])},{type:s.IF,evaluate:e=>!e.store.socialsStore.pageImage&&e.store.socialsStore.pageScreenshot,redundantAttribute:"expr1022",selector:"[expr1022]",template:e('<svg class="flexbe-icon size-16"><use expr1023="expr1023"/></svg><span expr1024="expr1024" class="flexbe-text text-xs"> </span>',[{redundantAttribute:"expr1023",selector:"[expr1023]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.sprite,"#info"].join("")}]},{redundantAttribute:"expr1024",selector:"[expr1024]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::social::upload_default_image_tip")].join("")}]}])},{type:s.IF,evaluate:e=>e.state.title,redundantAttribute:"expr1025",selector:"[expr1025]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.title].join("")}]}])},{type:s.IF,evaluate:e=>e.state.description,redundantAttribute:"expr1026",selector:"[expr1026]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.description].join("")}]}])},{type:s.IF,evaluate:e=>e.state.domain,redundantAttribute:"expr1027",selector:"[expr1027]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.domain].join("")}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.EVENT,name:"onupload",evaluate:e=>(t,s)=>e.store.socialsStore.uploadImageDone(t,s)},{type:t.EVENT,name:"onerror",evaluate:e=>e.onError}],redundantAttribute:"expr1028",selector:"[expr1028]"},{redundantAttribute:"expr1029",selector:"[expr1029]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.openUnsplashGallery}]},{redundantAttribute:"expr1030",selector:"[expr1030]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::background::gallery_button")].join("")}]},{redundantAttribute:"expr1031",selector:"[expr1031]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.sprite,"#sizer"].join("")}]},{redundantAttribute:"expr1032",selector:"[expr1032]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::social::upload_image_size")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.store.socialsStore.imageUploadHelpText}],redundantAttribute:"expr1033",selector:"[expr1033]"}])}]),name:"ps-socials-preview"};e(fl.name,fl);const xl={css:null,exports:{setup(e){this.store=e.props.store}},template:(e,t,s,i)=>e('<div expr1034="expr1034" class="flexbe-title text-m"> </div><div expr1035="expr1035" class="flexbe-placeholder" style="height: 60px;"></div><template expr1036="expr1036"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-field-group ps-socials-title"}]},{redundantAttribute:"expr1034",selector:"[expr1034]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::social::title_label")].join("")}]},{type:s.IF,evaluate:e=>e.store.isLoading,redundantAttribute:"expr1035",selector:"[expr1035]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.store.isLoading,redundantAttribute:"expr1036",selector:"[expr1036]",template:e('<div expr1037="expr1037" is="flexbe-input" type="text"></div><div expr1038="expr1038" class="flexbe-desc text-xs"> </div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.store.socialsStore.title},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.store.generalStore.title},{type:t.ATTRIBUTE,name:"maxLength",evaluate:e=>198},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.store.socialsStore.setTitle(t.target.value)}],redundantAttribute:"expr1037",selector:"[expr1037]"},{redundantAttribute:"expr1038",selector:"[expr1038]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::social::title_note")].join("")}]}])}]),name:"ps-socials-title"};e(xl.name,xl);const bl={css:null,exports:{setup(e){this.store=e.props.store}},template:(e,t,s,i)=>e('<div expr1039="expr1039" class="flexbe-title text-m"> </div><div expr1040="expr1040" class="flexbe-placeholder" style="height: 91px;"></div><template expr1041="expr1041"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-field-group"}]},{redundantAttribute:"expr1039",selector:"[expr1039]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::social::desc_label")].join("")}]},{type:s.IF,evaluate:e=>e.store.isLoading,redundantAttribute:"expr1040",selector:"[expr1040]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.store.isLoading,redundantAttribute:"expr1041",selector:"[expr1041]",template:e('<div expr1042="expr1042" is="flexbe-input" type="textarea"></div><div expr1043="expr1043" class="flexbe-desc text-xs"> </div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.store.socialsStore.description},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.store.seoStore.description},{type:t.ATTRIBUTE,name:"rows",evaluate:e=>3},{type:t.ATTRIBUTE,name:"cols",evaluate:e=>80},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.store.socialsStore.setDescription(t.target.value)}],redundantAttribute:"expr1042",selector:"[expr1042]"},{redundantAttribute:"expr1043",selector:"[expr1043]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::social::desc_note")].join("")}]}])}]),name:"ps-socials-description"};e(bl.name,bl);const yl={css:null,exports:{components:{"ps-socials-info":dl,"ps-socials-preview":fl,"ps-socials-title":xl,"ps-socials-description":bl},setup(e,{initMobx:t}){t(),this.store=e.props.store,this.watch={"store.socialsStore":[()=>this.update(),{deep:!0}]}}},template:(e,t,s,i)=>e('<div expr910="expr910" is="ps-socials-info"></div><div expr911="expr911" is="ps-socials-preview"></div><div expr912="expr912" is="ps-socials-title"></div><div expr913="expr913" is="ps-socials-description"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.props.class}]},{type:s.TAG,getComponent:i,evaluate:e=>"ps-socials-info",slots:[],attributes:[],redundantAttribute:"expr910",selector:"[expr910]"},{type:s.TAG,getComponent:i,evaluate:e=>"ps-socials-preview",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store}],redundantAttribute:"expr911",selector:"[expr911]"},{type:s.TAG,getComponent:i,evaluate:e=>"ps-socials-title",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store}],redundantAttribute:"expr912",selector:"[expr912]"},{type:s.TAG,getComponent:i,evaluate:e=>"ps-socials-description",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store}],redundantAttribute:"expr913",selector:"[expr913]"}]),name:"page-settings-socials"};e(yl.name,yl);const _l={css:null,exports:{setup(e){this.store=e.props.store}},template:(e,t,s,i)=>e('<div expr1044="expr1044" class="flexbe-placeholder" style="height: 16px"></div><label expr1045="expr1045" is="flexbe-checkbox" type="toggle"></label>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-field-item ps-additional-bullets"}]},{type:s.IF,evaluate:e=>e.store.isLoading,redundantAttribute:"expr1044",selector:"[expr1044]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.store.isLoading,redundantAttribute:"expr1045",selector:"[expr1045]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr1046="expr1046" class="flexbe-text"> </span><q expr1047="expr1047" is="flexbe-tooltip"></q>',bindings:[{redundantAttribute:"expr1046",selector:"[expr1046]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::widgets::enable_bullets")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::pages::settings::widgets::enable_bullets_tip")}],redundantAttribute:"expr1047",selector:"[expr1047]"}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.store.additionalStore.showBullets},{type:t.EVENT,name:"onchange",evaluate:e=>()=>e.store.additionalStore.toggleShowBullets()}]}])}]),name:"ps-additional-bullets"};e(_l.name,_l);const Tl={css:null,exports:{setup(e,{initMobx:t}){t(),this.store=e.props.store,this.state={showCodeBlock:!1,get codeEnabled(){return e.store.additionalStore.showCodeInsert},get codeHead(){return e.store.additionalStore.codeHead},get codeBody(){return e.store.additionalStore.codeBody},get isLoading(){return e.store.isLoading}},b((()=>!this.state.isLoading),(()=>{this.state.showCodeBlock=this.state.codeEnabled&&(this.state.codeHead||this.state.codeBody),this.update()}))}},template:(e,t,s,i)=>e('<template expr1048="expr1048"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-field-item ps-widgets-code"}]},{type:s.IF,evaluate:e=>e.state.showCodeBlock,redundantAttribute:"expr1048",selector:"[expr1048]",template:e('<div expr1049="expr1049" class="flexbe-placeholder" style="height: 16px;"></div><div expr1050="expr1050" class="flexbe-field-group compact"></div><template expr1053="expr1053" }></template>',[{type:s.IF,evaluate:e=>e.state.isLoading,redundantAttribute:"expr1049",selector:"[expr1049]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.state.isLoading,redundantAttribute:"expr1050",selector:"[expr1050]",template:e('<label expr1051="expr1051" is="flexbe-checkbox" type="toggle"></label>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr1052="expr1052" class="flexbe-text"> </span>',bindings:[{redundantAttribute:"expr1052",selector:"[expr1052]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::widgets::show_code")].join("")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.codeEnabled},{type:t.EVENT,name:"onchange",evaluate:e=>()=>e.store.additionalStore.toggleShowCodeInsert()}],redundantAttribute:"expr1051",selector:"[expr1051]"}])},{type:s.IF,evaluate:e=>e.state.codeEnabled&&!e.state.isLoading,redundantAttribute:"expr1053",selector:"[expr1053]",template:e('<div class="flexbe-field-group"><div expr1054="expr1054" class="flexbe-title text-m"> </div><div expr1055="expr1055" is="flexbe-monaco-editor"></div></div><div class="flexbe-field-group"><div expr1056="expr1056" class="flexbe-title text-m"> </div><div expr1057="expr1057" is="flexbe-monaco-editor"></div><div class="flexbe-field-item compact ps-widgets-code__help-text"><div class="flexbe-desc text-xs"><raw expr1058="expr1058"></raw></div></div></div>',[{redundantAttribute:"expr1054",selector:"[expr1054]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::widgets::code_head_title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-monaco-editor",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.codeHead},{type:t.EVENT,name:"oninputchange",evaluate:e=>t=>e.store.additionalStore.setCodeHead(t.value)}],redundantAttribute:"expr1055",selector:"[expr1055]"},{redundantAttribute:"expr1056",selector:"[expr1056]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::widgets::code_body_title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-monaco-editor",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.codeBody},{type:t.EVENT,name:"oninputchange",evaluate:e=>t=>e.store.additionalStore.setCodeBody(t.value)}],redundantAttribute:"expr1057",selector:"[expr1057]"},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::pages::settings::widgets::code_body_help_text")}],redundantAttribute:"expr1058",selector:"[expr1058]"}])}])}]),name:"ps-additional-code"};e(Tl.name,Tl);const wl={css:null,exports:{setup(e,{initMobx:t}){t(),this.store=e.props.store,this.state={get checked(){return!1===e.store.additionalStore.responsive},get showAdaptiveToggle(){return flexbe.vars.group.responsive}}},toggleAdaptive(e){this.store.additionalStore.togglePageResponsive(!e.target.checked&&"auto")}},template:(e,t,s,i)=>e('<div expr1059="expr1059" class="flexbe-placeholder" style="height: 16px;"></div><label expr1060="expr1060" is="flexbe-checkbox" type="toggle"></label>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-field-item ps-additional-adaptive"}]},{type:s.IF,evaluate:e=>e.store.isLoading,redundantAttribute:"expr1059",selector:"[expr1059]",template:e(null,[])},{type:s.IF,evaluate:e=>e.state.showAdaptiveToggle&&!e.store.isLoading,redundantAttribute:"expr1060",selector:"[expr1060]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr1061="expr1061" class="flexbe-text"> </span>',bindings:[{redundantAttribute:"expr1061",selector:"[expr1061]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::widgets::disable_responsive_label")].join("")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.checked},{type:t.EVENT,name:"onchange",evaluate:e=>e.toggleAdaptive}]}])}]),name:"ps-additional-adaptive"};e(wl.name,wl);const kl={css:null,exports:{repeatOptions:[{title:tr("admin::pages::settings::background::repeat_none"),value:"no-repeat"},{title:tr("admin::pages::settings::background::repeat_x"),value:"repeat-x"},{title:tr("admin::pages::settings::background::repeat_y"),value:"repeat-y"},{title:tr("admin::pages::settings::background::repeat_xy"),value:"repeat"}],positionOptions:[{title:"left top",value:"left top"},{title:"center top",value:"center top"},{title:"right top",value:"right top"},{title:"left center",value:"left center"},{title:"center center",value:"center center"},{title:"right center",value:"right center"},{title:"left bottom",value:"left bottom"},{title:"center bottom",value:"center bottom"},{title:"right bottom",value:"right bottom"}],sizeOptions:[{title:tr("admin::pages::settings::background::size_auto"),value:"auto"},{title:tr("admin::pages::settings::background::size_cover"),value:"cover"},{title:tr("admin::pages::settings::background::size_contain"),value:"contain"}],setup(e,{initMobx:t,inject:s}){t(),this.modal=s("modal"),this.store=e.props.store,this.background=this.store.additionalStore.background,this.styles=this.background.styles,this.watch={"store.additionalStore":[()=>this.update(),{deep:!0}]}}},template:(e,t,s,i)=>e('<div class="background-image-settings__body"><div class="flexbe-field-group"><label expr1208="expr1208" is="flexbe-checkbox" type="toggle"></label><label expr1210="expr1210" is="flexbe-checkbox" type="toggle"></label></div><div class="flexbe-field-group"><div expr1213="expr1213" class="flexbe-title text-s"> </div><div expr1214="expr1214" is="proxy" data-is="flexbe-select" class="compact"></div></div><div class="flexbe-field-group"><div expr1215="expr1215" class="flexbe-title text-s"> </div><div class="background-image-settings__positions positions-control"><div expr1216="expr1216"></div></div></div><div expr1217="expr1217" class="flexbe-field-group"></div></div><div class="flexbe-modal-content buttons-line"><button expr1220="expr1220" class="flexbe-button is-primary filled"><span expr1221="expr1221" class="flexbe-text"> </span></button></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"background-image-settings"}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr1209="expr1209" class="flexbe-text"> </span>',bindings:[{redundantAttribute:"expr1209",selector:"[expr1209]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::background::toggle_fixed_title")].join("")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.styles.backgroundFixed},{type:t.EVENT,name:"onchange",evaluate:e=>()=>e.store.additionalStore.toggleBackgroundFixed()}],redundantAttribute:"expr1208",selector:"[expr1208]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr1211="expr1211" class="flexbe-text"> </span><q expr1212="expr1212" is="flexbe-tooltip"></q>',bindings:[{redundantAttribute:"expr1211",selector:"[expr1211]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::image::original_resolution_toggle")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("editor::image::original_resolution_tip")}],redundantAttribute:"expr1212",selector:"[expr1212]"}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>!e.background.compression},{type:t.EVENT,name:"onchange",evaluate:e=>()=>e.store.additionalStore.toggleCompression()}],redundantAttribute:"expr1210",selector:"[expr1210]"},{redundantAttribute:"expr1213",selector:"[expr1213]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::background::size_field_title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.sizeOptions},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.styles.backgroundSize},{type:t.ATTRIBUTE,name:"raw-values",evaluate:e=>!0},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.store.additionalStore.setBackgroundSize(t.value)}],redundantAttribute:"expr1214",selector:"[expr1214]"},{redundantAttribute:"expr1215",selector:"[expr1215]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::background::position_field_title")].join("")}]},{type:s.EACH,getKey:e=>e.item.value,condition:null,template:e('<span class="positions-control__dot"></span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["positions-control__item ",e.styles.backgroundPosition===e.item.value?"positions-control__item_active":""].join("")},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.item.tip},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.store.additionalStore.setBackgroundPosition(e.item.value)}]}]),redundantAttribute:"expr1216",selector:"[expr1216]",itemName:"item",indexName:null,evaluate:e=>e.positionOptions},{type:s.IF,evaluate:e=>"cover"!==e.styles.backgroundSize,redundantAttribute:"expr1217",selector:"[expr1217]",template:e('<div expr1218="expr1218" class="flexbe-title text-s"> </div><div expr1219="expr1219" is="proxy" data-is="flexbe-select" class="compact"></div>',[{redundantAttribute:"expr1218",selector:"[expr1218]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::background::repeat_field_title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.repeatOptions},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.styles.backgroundRepeat},{type:t.ATTRIBUTE,name:"raw-values",evaluate:e=>!0},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.store.additionalStore.setBackgroundRepeat(t.value)}],redundantAttribute:"expr1219",selector:"[expr1219]"}])},{redundantAttribute:"expr1220",selector:"[expr1220]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.modal.close()}]},{redundantAttribute:"expr1221",selector:"[expr1221]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("editor::form::field_done_button")}]}]),name:"background-image-settings"};e(kl.name,kl);const Al={css:null,exports:{setup(e,{inject:t}){this.store=e.props.store,this.background=this.store.additionalStore.background,this.modal=t("modal"),this.watch={background:[()=>this.update(),{deep:!0}]}},openBackgroundSettings(){return Zs.create({width:400,overlay:!0,shadow:!1,fromModal:this.modal,component:kl,title:tr("admin::pages::settings::background::settings_modal_title"),props:{store:this.store}})}},template:(e,t,s,i)=>e('<div expr1062="expr1062" class="flexbe-placeholder" style="height: 16px"></div><div class="flexbe-field-group compact"><label expr1063="expr1063" is="flexbe-checkbox" type="toggle"></label></div><div expr1066="expr1066" class="flexbe-field-group is-inline"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"flexbe-field-item ps-additional-background"}]},{type:s.IF,evaluate:e=>e.store.isLoading,redundantAttribute:"expr1062",selector:"[expr1062]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.store.isLoading,redundantAttribute:"expr1063",selector:"[expr1063]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr1064="expr1064" class="flexbe-text"> </span><q expr1065="expr1065" is="flexbe-tooltip"></q>',bindings:[{redundantAttribute:"expr1064",selector:"[expr1064]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::settings::background::toggle_title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::pages::settings::background::toggle_title_tip")}],redundantAttribute:"expr1065",selector:"[expr1065]"}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.background.enabled},{type:t.EVENT,name:"onchange",evaluate:e=>()=>e.store.additionalStore.toggleBackgroundEnabled()}]}])},{type:s.IF,evaluate:e=>e.background.enabled,redundantAttribute:"expr1066",selector:"[expr1066]",template:e('<div expr1067="expr1067" is="flexbe-color-input"></div><div expr1068="expr1068" is="flexbe-image-uploader"></div><div expr1069="expr1069" class="grow" is="proxy" data-is="flexbe-text-color"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-color-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"opacity",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.background.styles.backgroundColor},{type:t.ATTRIBUTE,name:"apply-if-valid",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"update",evaluate:e=>t=>e.store.additionalStore.setBackgroundColor(t.color)}],redundantAttribute:"expr1067",selector:"[expr1067]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-image-uploader",slots:[],attributes:[{type:t.ATTRIBUTE,name:"image",evaluate:e=>e.store.additionalStore.background.image},{type:t.EVENT,name:"onupload",evaluate:e=>t=>e.store.additionalStore.setBackgroundImage(t)},{type:t.EVENT,name:"onerror",evaluate:e=>e=>console.log("Upload error",e)},{type:t.ATTRIBUTE,name:"openSettings",evaluate:e=>e.openBackgroundSettings},{type:t.ATTRIBUTE,name:"removeImage",evaluate:e=>()=>e.store.additionalStore.removeBackgroundImage()}],redundantAttribute:"expr1068",selector:"[expr1068]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"colors",evaluate:e=>["light","dark"]},{type:t.ATTRIBUTE,name:"active",evaluate:e=>e.background.styles.contrast},{type:t.ATTRIBUTE,name:"update",evaluate:e=>t=>e.store.additionalStore.setContrastColor(t.color)}],redundantAttribute:"expr1069",selector:"[expr1069]"}])}]),name:"ps-additional-background"};e(Al.name,Al);const El={css:null,exports:{components:{"ps-additional-bullets":_l,"ps-additional-code":Tl,"ps-additional-adaptive":wl,"ps-additional-background":Al},setup(e,{initMobx:t}){t(),this.store=e.props.store,this.state={get showBackgroundSettings(){return window.isEditor&&4===e.props.store.themeId},get imgLink(){return`/_s/images/admin/png/temporary-code${"ru"===flexbe.vars.user.lang?"":"_en"}.png`}},this.watch={"store.additionalStore":[()=>this.update(),{deep:!0}]}}},template:(e,t,s,i)=>e('<div expr914="expr914" is="ps-additional-adaptive"></div><div expr915="expr915" is="ps-additional-bullets"></div><div expr916="expr916" is="ps-additional-code"></div><div expr917="expr917" is="ps-additional-background"></div><div class="temporary-code-background"><span expr918="expr918" is="raw" class="temporary-code-text"></span><div class="temporary-code-img"><img expr919="expr919" alt/></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.props.class}]},{type:s.TAG,getComponent:i,evaluate:e=>"ps-additional-adaptive",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store}],redundantAttribute:"expr914",selector:"[expr914]"},{type:s.IF,evaluate:e=>1!==e.store.themeId,redundantAttribute:"expr915",selector:"[expr915]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"ps-additional-bullets",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"ps-additional-code",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store}],redundantAttribute:"expr916",selector:"[expr916]"},{type:s.IF,evaluate:e=>e.state.showBackgroundSettings,redundantAttribute:"expr917",selector:"[expr917]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"ps-additional-background",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.store}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::pages::settings::widgets::temporary_code")}],redundantAttribute:"expr918",selector:"[expr918]"},{redundantAttribute:"expr919",selector:"[expr919]",expressions:[{type:t.ATTRIBUTE,name:"src",evaluate:e=>e.state.imgLink}]}]),name:"page-settings-additional"};e(El.name,El);const Il={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get textLink(){return e.props.textLink},get toLink(){return e.props.toLink},get showLink(){return this.textLink&&this.toLink}},this.meta={sprite:at("pages","admin")}}},template:(e,t,s,i)=>e('<div class="flexbe-bar rounded gap-medium"><div expr1070="expr1070" is="flexbe-icon" icon="info-warning"></div><span expr1071="expr1071" is="raw" class="ps-info-bar__content"></span><a expr1072="expr1072" class="flexbe-button borderless style-text opaque is-primary ps-info-bar__button" target="_blank"></a></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["ps-info-bar ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr1070",selector:"[expr1070]"},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.props.text}],redundantAttribute:"expr1071",selector:"[expr1071]"},{type:s.IF,evaluate:e=>e.state.showLink,redundantAttribute:"expr1072",selector:"[expr1072]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.textLink},{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.toLink}]}])}]),name:"ps-info-bar"};e(Il.name,Il);const Cl={selectDomain:({gId:e,onSelect:t})=>Zs.create({type:"overlay",scrollable:!1,riotTag:"admin-project-select",props:{gId:e,onSelect:t}}),showPreview:({url:e,onSelect:t})=>Zs.create({type:"overlay",scrollable:!1,riotTag:"admin-page-preview",props:{url:e,onSelect:t}}),selectPage:({onSelect:e})=>Zs.create({type:"overlay",scrollable:!1,riotTag:"admin-pages-list",props:{type:"overlay",onselect:e}}),create:({projectId:e,folderId:t=0})=>Zs.create({type:"overlay",padding:50,compact:!0,overlay:!0,scrollable:!1,title:tr("admin::pages::add::title_new"),component:"admin-page-add",props:{projectId:e,folderId:t}}),copyPages:({copyId:e,url:t,title:s,fId:i})=>Zs.create({title:tr("admin::pages::copy::title"),type:"window",overlay:!0,shadow:!0,width:400,riotTag:"admin-page-copy",props:{url:t,title:s,inNewDomain:!0,closeOnEsc:!0,copyId:e,fId:i}}),showPageSettings:e=>function(e){return Zs.create({width:800,overlay:!0,shadow:!0,closeButton:!1,component:sl,class:"admin-page-settings-modal",scrollable:!1,props:{pId:e}})}(e),addFolder:({pId:e,gId:t})=>Zs.create({width:390,overlay:!0,shadow:!0,title:tr("admin::pages::folder::add::title"),riotTag:"admin-page-folder-add",props:{pId:e,gId:t}}),removeFolder({fId:e}){const t=flexbe.page.findFolderById({fId:e});return Zs.create({width:400,overlay:!0,shadow:!0,riotTag:"admin-page-folder-delete",props:{folder:t}})}},Sl={css:null,exports:{setup(e,{initMobx:t}){t();const{projectId:s,folderId:i}=e.props;this.state={isMainPage:!1,uriWasChanged:!1,loading:!1,inCreate:!1,inScroll:!1,pageUri:`/page_${Ge(5)}/`,pageTitle:this.isMainPage?tr("admin::pages::add::homepage"):"",errorUri:"",themes:{},projectId:s,folderId:i,get uriClassName(){return this.error?"error":"done"},get currentTemplates(){var e;return null!=(e=this.themes.current)?e:[]}},this.meta={sprite:at("pages","admin")},this.watch={"state.pageUri":()=>this.update(),"state.errorUri":()=>this.update(),"state.loading":()=>this.update(),"state.inCreate":()=>this.update(),"state.inScroll":()=>this.update()}},setCleanUri(){this.state.pageUri=nr(this.state.pageUri,!!this.state.pageUri)},setPageTitle(e){e.target&&(this.state.pageTitle=e.target.value)},setPageUri(e){e.target&&(this.state.pageUri=e.target.value,this.state.uriWasChanged=!0,this.validateUri())},async validateUri(){this.state.errorUri="",""===this.state.pageUri&&(this.state.errorUri=tr("admin::pages::settings::base::uri_note"));await ao.findPageByUri({uri:this.state.pageUri})&&(this.state.errorUri=tr("admin::pages::error::uri_exist"))},async onMounted(){if("new"===this.state.projectId)this.state.isMainPage=!0;else{const e=await ao.getPagesFlat();this.state.isMainPage=null==e.find((e=>"/"===e.uri))}this.state.isMainPage&&(this.state.pageUri=tr("admin::pages::add::homepage"),this.state.pageTitle=tr("admin::pages::add::homepage")),setTimeout((()=>{const e=e=>$(e).toArray().map((e=>e.offsetTop)),t=$(this.root).find(".page-content"),s=$(this.root).find(".templates-container.current");let i,a=e(s),n=-1;$(window).off("resize.flexbe_page_add").on("resize.flexbe_page_add",$.throttle((()=>{a=e(s)}))),t.off("scroll.flexbe_page_add").on("scroll.flexbe_page_add",(()=>{const e=((e,t)=>{if(!Array.isArray(t))return-1;let s=-1;return t.forEach(((t,i)=>{e>t&&(s=i)})),s})(t[0].scrollTop,a);n!==e&&(n=e,s.removeClass("active"),e>=0&&s.eq(e).addClass("active")),this.state.inScroll=!0,clearTimeout(i),i=setTimeout((()=>{this.state.inScroll=!1}),150)}))}),0)},async onBeforeMount(){const e=e=>{this.state.loading=!1,"NetworkError"===e.name?toast.error(e.message):console.error(e),this.props.modal.close()};try{this.state.loading=!0;const t=await ao.loadTemplates(!0);return t&&t.current?(this.state.themes=t,this.state.loading=!1,t):e(new Error("No templates loaded"))}catch(t){return e(t)}},showPreview(e){let t;const s=e.url;t=Cl.showPreview({url:s,onSelect:()=>{this.createPage(e.id,t)}})},async createPage(e,t){if(this.state.inCreate)return;const s=this.state.isMainPage?"/":nr(this.state.pageUri,!!this.state.pageUri);if(this.state.errorUri)return t&&t.close(),toast.error(tr("main::error:check_fields")),$(this.root).find(".page-content").animate({scrollTop:0},200),anime({targets:$(this.root).find(".page-uri")[0],easing:"linear",loop:3,delay:200,translateX:[{value:5,duration:50,delay:0,elasticity:1e3},{value:-5,duration:100,delay:0,elasticity:1e3},{value:0,duration:50,delay:0,elasticity:1e3}]}),this.update(),!1;this.state.inCreate=e;const i={title:this.state.pageTitle,group_id:this.state.projectId,type:this.state.pageType,uri:s,src_p_id:e,folder_id:this.state.folderId};try{const e=await ao.createPage(i);e.domain&&e.uri?window.document.location=`${window.document.location.protocol}//${e.domain}${e.uri}`:(this.state.inCreate=!1,t&&t.close(),this.props.modal&&this.props.modal.close(),ao.getPages({force:!0}))}catch(e){this.state.inCreate=!1,toast.error(e.message)}}},template:(e,t,s,i)=>e('<div expr122="expr122" class="page-loading"></div><div expr124="expr124" class="page-content scrollable-content slide-down-animation"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-page-add admin-template-add ",e.props.className].join("")}]},{type:s.IF,evaluate:e=>e.state.loading,redundantAttribute:"expr122",selector:"[expr122]",template:e('<div expr123="expr123" is="flexbe-loader"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[],redundantAttribute:"expr123",selector:"[expr123]"}])},{type:s.IF,evaluate:e=>!e.state.loading,redundantAttribute:"expr124",selector:"[expr124]",template:e('<div class="page-params row gap-40"><div class="col col-6 page-title"><div expr125="expr125" class="flexbe-title text-subtitle"> </div><div expr126="expr126" is="flexbe-input" class="large shadow" maxlength="250"></div></div><div expr127="expr127"><div expr128="expr128" class="flexbe-title text-subtitle"> </div><div expr129="expr129" is="flexbe-input" class="large shadow" type="text" maxlength="198"></div></div></div><div class="page-themes-container"><div class="templates-title"><div expr131="expr131" class="flexbe-text text-subtitle"> </div></div><div expr132="expr132" class="templates-container current"></div></div>',[{redundantAttribute:"expr125",selector:"[expr125]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::common::title_label")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.pageTitle},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::pages::add::homepage")},{type:t.EVENT,name:"oninput",evaluate:e=>e.setPageTitle}],redundantAttribute:"expr126",selector:"[expr126]"},{redundantAttribute:"expr127",selector:"[expr127]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["col col-6 page-uri ",e.state.uriClassName].join("")}]},{redundantAttribute:"expr128",selector:"[expr128]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::common::uri_label")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[{id:"default",html:'<div class="flexbe-input__addon"><div expr130="expr130" class="flexbe-error error-text"></div></div>',bindings:[{type:s.IF,evaluate:e=>e.state.errorUri,redundantAttribute:"expr130",selector:"[expr130]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.errorUri].join("")}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.pageUri},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.state.errorUri},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>"/example/"},{type:t.ATTRIBUTE,name:"required",evaluate:e=>!0},{type:t.EVENT,name:"oninput",evaluate:e=>e.setPageUri},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.isMainPage},{type:t.EVENT,name:"onblur",evaluate:e=>e.setCleanUri}],redundantAttribute:"expr129",selector:"[expr129]"},{redundantAttribute:"expr131",selector:"[expr131]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::add::theme_title")].join("")}]},{type:s.IF,evaluate:e=>e.state.currentTemplates.pages&&e.state.currentTemplates.pages.length,redundantAttribute:"expr132",selector:"[expr132]",template:e('<template expr133="expr133"></template>',[{type:s.EACH,getKey:null,condition:null,template:e('<div expr134="expr134" is="admin-template-add-item"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"admin-template-add-item",slots:[],attributes:[{type:t.ATTRIBUTE,name:"template",evaluate:e=>e.item},{type:t.ATTRIBUTE,name:"inCreate",evaluate:e=>e.state.inCreate},{type:t.EVENT,name:"onCreate",evaluate:e=>e.createPage},{type:t.ATTRIBUTE,name:"showPreview",evaluate:e=>e.showPreview}],redundantAttribute:"expr134",selector:"[expr134]"}]),redundantAttribute:"expr133",selector:"[expr133]",itemName:"item",indexName:null,evaluate:e=>e.state.currentTemplates.pages}])}])}]),name:"admin-page-add"};e(Sl.name,Sl);const $l={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get template(){return e.props.template},get inCreate(){return e.props.inCreate},get dataAction(){return this.template.url?"sub":"main"},get buttonFillClass(){return this.inCreate===this.template.id?"filled loading":"filling bordered"},get tinyLabelStyle(){var e;return null!=(e=this.template.label)&&e.color?`{ 'color': ${this.template.label.color} }`:""}}},cardClick(e){$(e.target).closest('[data-action="main"]').length?this.props.onCreate(this.state.template.id):$(e.target).closest('[data-action="sub"]').length&&this.props.showPreview(this.state.template)}},template:(e,t,s,i)=>e('<div expr135="expr135" class="flexbe-white-card shadow hoverable"><div expr136="expr136" class="template-preview"><div expr137="expr137" class="preview-image"></div></div><div class="template-data"><div class="template-desc"><span expr138="expr138"> </span><span expr139="expr139" class="tiny-label"></span><q expr140="expr140" is="flexbe-tooltip"></q></div><div class="flexbe-buttons-line"><div expr141="expr141" data-action="main"><span expr142="expr142" class="flexbe-text"> </span></div><div expr143="expr143" data-action="sub" class="flexbe-button rounded is-primary large select"></div></div></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-template-add-item ",e.props.className].join("")}]},{redundantAttribute:"expr135",selector:"[expr135]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.cardClick}]},{redundantAttribute:"expr136",selector:"[expr136]",expressions:[{type:t.ATTRIBUTE,name:"data-action",evaluate:e=>e.state.dataAction}]},{redundantAttribute:"expr137",selector:"[expr137]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["background-image: url(",e.state.template.img,")"].join("")}]},{redundantAttribute:"expr138",selector:"[expr138]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr(e.state.template.title)}]},{type:s.IF,evaluate:e=>e.state.template.label,redundantAttribute:"expr139",selector:"[expr139]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr(e.state.template.label.text)].join("")},{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.state.tinyLabelStyle}]}])},{type:s.IF,evaluate:e=>e.state.template.tip,redundantAttribute:"expr140",selector:"[expr140]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr(e.state.template.tip)}]}])},{redundantAttribute:"expr141",selector:"[expr141]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button rounded is-primary large select ",e.state.buttonFillClass].join("")}]},{redundantAttribute:"expr142",selector:"[expr142]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::select")}]},{type:s.IF,evaluate:e=>e.state.template.url,redundantAttribute:"expr143",selector:"[expr143]",template:e('<span expr144="expr144" class="flexbe-text"> </span>',[{redundantAttribute:"expr144",selector:"[expr144]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::pages::add::show_button")}]}])}]),name:"admin-template-add-item"};e($l.name,$l);const Bl={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get theme(){return e.props.theme}}}},template:(e,t,s,i)=>e('<div class="theme-title"><div expr145="expr145" class="flexbe-text text-subtitle"> </div></div><div class="templates-container old"><template expr146="expr146"></template></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-template-add-old-theme ",e.props.className].join("")}]},{redundantAttribute:"expr145",selector:"[expr145]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.theme.name].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e('<div expr147="expr147" is="admin-template-add-item"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"admin-template-add-item",slots:[],attributes:[{type:t.ATTRIBUTE,name:"template",evaluate:e=>e.item},{type:t.ATTRIBUTE,name:"inCreate",evaluate:e=>e.props.inCreate},{type:t.EVENT,name:"onCreate",evaluate:e=>e.props.createPage},{type:t.ATTRIBUTE,name:"showPreview",evaluate:e=>e.props.showPreview}],redundantAttribute:"expr147",selector:"[expr147]"}]),redundantAttribute:"expr146",selector:"[expr146]",itemName:"item",indexName:null,evaluate:e=>e.state.theme.pages}]),name:"admin-template-add-old-theme"};e(Bl.name,Bl),riot3.tag2("admin-page-copy",'<div class="flexbe-title">{tr(\'admin::pages::copy::project_label\')}</div> <div class="flexbe-field-group is-inline"> <div class="grow" data-is="flexbe-input" riot-value="{domainTitle}" readonly="{true}"></div> <div if="{meta.showProjectSelect}" class="flexbe-button filled is-secondary" onclick="{selectProject}" disabled="{busy}"> <span class="flexbe-text"> {tr(\'admin::pages::copy::other_project_button\')} </span> </div> </div> <div class="flexbe-field-group" if="{tag.gId !== \'new\'}"> <div class="flexbe-title">{tr(\'admin::pages::common::title_label\')}</div> <div class="w100 pages-copy-title" data-is="flexbe-input" riot-value="{title}" autofocus="{300}" onchange="{changeTitle}"></div> </div> <div class="flexbe-field-group"> <div class="flexbe-title"> <span class="flexbe-text"> {tr(\'admin::pages::common::uri_label\')} </span> <span if="{error}" class="flexbe-error"> {tr(\'admin::pages::error::uri_exist\')} </span> </div> <div class="w100" data-is="flexbe-input" riot-value="{domain ? url : tr(\'admin::pages::add::homepage\')}" error="{error}" replace="{\'[^a-zA-Z--0-9 \\/\\.\\_\\-]\'}" oninput="{changeUri}" onchange="{normalizeUrl}" maxlength="250" disabled="{!domain || disabled}" ref="inputAddress"></div> </div> <div class="admin-page-copy-button"> <div class="flexbe-button filled is-primary block {loading: busy}" onclick="{copyAction}"> <span class="flexbe-text">{tr(\'main::button::duplicate\')}</span> </div> </div>',"",'class="admin-page-copy {opts.class}"',(function(e){let t=e.url;this.busy=!1,this.disabled=!1,this.title=st(e.title||"",!0),this.changed=!1,this.error=!1,this.gId=flexbe.vars.group.id,this.domain=flexbe.vars.group.domain,this.domainTitle=tr("admin::pages::copy::current_project"),this.url=flexbe.page.getCopyName({uri:e.url,gId:this.gId}),this.meta={showProjectSelect:["owner","admin","editor"].includes(flexbe.vars.user.role)},this.selectProject=function(){this.error=!1,flexbe.modals.pages.selectDomain({gId:this.gId,account_id:flexbe.vars.group.s_id})}.bind(this),this.copyAction=async function(){if(this.busy||this.error)return;const t=this.title,s=this.url;if(this.busy=!0,"new"!==this.gId)try{await flexbe.page.copyPage({gId:this.gId,pId:e.copyId,fId:e.fId,url:s,title:t})}catch(e){toast.error(e.message),this.update({busy:!1})}else try{const t=adminStore.getModule("projects"),s=await t.dispatch("addProject",{page_id:e.copyId});s.domain&&s.uri&&(document.location=`${document.location.protocol}//${s.domain}${s.uri}`)}catch(e){this.update({busy:!1})}}.bind(this),this.changeTitle=function(e){this.title="string"==typeof e?e:e.target.value}.bind(this),this.changeUri=async function(e){t="string"==typeof e?e:e.target.value,this.changed=!0,this.url=t,this.error=await flexbe.page.findPageByUri({uri:this.url,gId:this.gId}),this.update()}.bind(this),this.normalizeUrl=function(){this.url=nr(this.url,!!this.url)||"/",this.update()}.bind(this),this.onBeforeMount=function(){flexbe.on("adminCopyPageDomain",(async e=>{if(this.gId=e.gId,this.domain=e.domain,$(this.root).find(".pages-copy-title input")[0]?.focus(),e.gId&&"new"!==e.gId){e.data[0].list.find((e=>"/"===e.uri))?this.changed?(this.url=nr(t,!!t)||"/",this.error=await flexbe.page.findPageByUri({uri:this.url,gId:this.gId})):this.url=flexbe.page.getCopyName({uri:t,gId:this.gId}):(this.url="/",this.disabled=!0),this.domainTitle=e.gId===flexbe.vars.group.id?tr("admin::pages::copy::current_project"):this.domain}else this.domainTitle=tr("admin::pages::copy::create_project_button"),this.domain="",this.gId="new",this.url="/";this.update()}))}.bind(this),this.onBeforeUnmount=function(){flexbe.off("adminCopyPageDomain")}.bind(this)})),riot3.tag2("admin-page-preview",'<header> <div class="template-view"> <div class="select-pc {active: view == \'pc\'}" onclick="{setView.bind(this, \'pc\')}"> <svg><use riot-xlink:href="{sprite}#select-pc"></use></svg> </div> <div class="select-mobile {active: view == \'mobile\'}" onclick="{setView.bind(this, \'mobile\')}"> <svg><use riot-xlink:href="{sprite}#select-mobile"></use></svg> </div> </div> <div class="template-actions flexbe-buttons-line"> <div class="flexbe-button bordered rounded is-primary large" onclick="{cancelSelect}"> <span class="flexbe-text">{opts.cancelText || tr(\'admin::pages::add::preview_back_button\')}</span> </div> <div class="flexbe-button filled rounded is-primary large {\'loading\': inDone}" onclick="{doneSelect}"> <span class="flexbe-text">{opts.createText || tr(\'admin::pages::add::preview_select_button\')}</span> </div> </div> </header> <div class="preview-wrap"> <div class="preview {view} {loaded: loaded}"> <div data-is="proxy" is="flexbe-loader" class="loader" if="{!loaded}"></div> <iframe width="100%" height="100%" frameborder="0" riot-src="{opts.url}?service=1" onload="{iframeLoaded}"></iframe> </div> </div>',"",'class="admin-page-preview {opts.class}"',(function(e){const t=e.modal;this.sprite=flexbe.lib.getSprite("pages","admin"),this.view="pc",this.url=e.url,this.loaded=!1,this.inDone=!1,this.setView=function(e){this.view=e}.bind(this),this.iframeLoaded=function(){setTimeout((()=>{this.update({loaded:!0})}),120)}.bind(this),this.cancelSelect=function(){t.close(),"function"==typeof e.onclose&&e.onclose()}.bind(this),this.doneSelect=function(){this.inDone=!0,"function"==typeof e.onSelect&&e.onSelect()}.bind(this)}));const Ul={required:(e,t)=>{if("input"===t)return;const s=["checkbox","toggle"].includes(e.type);if(null==e.value||""===String(e.value).trim()||s&&!e.value)throw s?tr("main::error::enable_field"):tr("main::error::fill_field")},isDomain:(e,t)=>{if(!("input"===t||e.value&&er(e.value)))throw tr("main::error::invalid_domain")},isLink:(e,t)=>{if(!("input"===t||e.value&&ir(e.value,{fullLink:!0})))throw tr("main::error::invalid_url")},minLength:(e,t)=>{if(!e.minLength)return void console.warn("FLEXBE: You need to specify the field minimum length.");const s=e.minLength;if("input"!==t&&e.value.length<s)throw tr("admin::integrations::validation::min_length",{count:s})},maxLength:(e,t)=>{if(!e.maxLength)return void console.warn("FLEXBE: You need to specify the field maximum length.");const s=e.maxLength;if("input"!==t&&e.value.length>s)throw tr("admin::integrations::validation::max_length",{count:s})},rangeNumber:(e,t)=>{if(!e.rangeNumber)return void console.warn("FLEXBE: You need to specify the field range number.");if("input"===t)return;const s=e.rangeNumber.max,i=e.rangeNumber.min;if(s&&i&&(i>e.value||e.value>s))throw tr("admin::integrations::validation::range_number",{min:i,max:s});if(s&&e.value>s)throw tr("admin::integrations::validation::max_number",{count:s});if(i&&e.value<i)throw tr("admin::integrations::validation::min_number",{count:i})},mask:(e,t)=>{if("input"!==t&&e._maskInstance){if(!e._maskInstance.masked.isComplete)throw tr("main::error::fill_field")}},email:(e,t)=>{if(!("input"===t||e.value&&ar(e.value)))throw tr("main::error::invalid_email")},inn:(e,t)=>{if("input"!==t){if(10!==e.value.length&&12!==e.value.length)throw tr("admin::user::pay::details::form::ru_inn_length_error");if(!(e=>{if(12!==e.length&&10!==e.length)return!1;if(10===e.length){const t=String((2*e[0]+4*e[1]+10*e[2]+3*e[3]+5*e[4]+9*e[5]+4*e[6]+6*e[7]+8*e[8])%11%10);if(e[9]!==t)return!1}if(12===e.length){const t=String((7*e[0]+2*e[1]+4*e[2]+10*e[3]+3*e[4]+5*e[5]+9*e[6]+4*e[7]+6*e[8]+8*e[9])%11%10),s=String((3*e[0]+7*e[1]+2*e[2]+4*e[3]+10*e[4]+3*e[5]+5*e[6]+9*e[7]+4*e[8]+6*e[9]+8*e[10])%11%10);if(e[10]!==t||e[11]!==s)return!1}return!0})(e.value))throw tr("admin::user::pay::details::form::ru_inn_error")}},byUnp:(e,t)=>{if("input"!==t&&9!==e.value.length)throw tr("admin::user::pay::details::form::by_unp_error")},kzBin:(e,t)=>{if("input"!==t&&12!==e.value.length)throw tr("admin::user::pay::details::form::kz_bin_error")},ruKpp:(e,t)=>{var s;if("input"!==t&&(s=e.value,!/\d{4}[\dA-Z]{2}\d{3}/.test(s)))throw tr("admin::user::pay::details::form::ru_kpp_error")},kzID:(e,t)=>{var s;if("input"!==t&&(!(s=`${s=e.value}`).match(/^[A-Za-z]\d{8}$/)&&!s.match(/^\d{12}$/)))throw tr("admin::user::pay::details::form::kz_id_error")}},Rl={normalizeUrl:e=>((e=String(e||"").trim())&&!/^http?s?:\/\//.test(e)&&(e=`https://${e.replace(/^[hpt]{0,4}:\/{0,2}/,"")}`),e),cleanDomain:e=>{const t=/^(?:https?:)?(?:\/\/)?([^/?]+)/;return t.exec(e)&&(e=t.exec(e)[1]),e}},Pl={anyName:{mask:/^[\da-z--]+$/gi},email:{mask:/^\S*@?\S*$/},number:{mask:/[+-]?\d*/},phone:{mask:[{mask:"{+}000 00 00 00 00",startsWith:/\+373|\+370/},{mask:"{+}000 00 000 00 00",startsWith:/\+3/},{mask:"{+}0 (000) 000-00-00",startsWith:/\+[17]/},{mask:"{+}0000000[00000000]",startsWith:/\+/},{mask:"0000000[00000000]",startsWith:/[^+]/}],dispatch:(e,t)=>{const s=(String(t.unmaskedValue)+e).trim();return t.compiledMasks.find((e=>e.startsWith.test(s)))||t.compiledMasks[0]}},ipAddr:[{mask:"OCT.OCT.OCT.OCT",blocks:{OCT:{mask:Number,min:0,max:255}}}],zip:{mask:/^[\da-z-]+$/gi},ruKpp:{mask:"000000000"},ruInn:{mask:"0000000000[00]"},ruZip:{mask:"000000"},ruPassport:{mask:"0000 000000"}};class Hl{get valid(){return!this.error}get error(){return this._error||this.getError()||!1}set error(e){this.error!==e&&(this._error=e,this.onSetError({error:e,errorLevel:this.errorLevel}))}get errorLevel(){var e;return null!=(e=this._errorLevel)?e:"error"}set errorLevel(e){this.errorLevel!==e&&(this._errorLevel=e)}constructor(e,t={}){this.name="",this.type="text",this.label="",this.desc="",this.placeholder="",this.validators=[],this.mask=null,this.show=!0,this.name=e,this._error=t.initialError||!1,vt(this,t),this.onchange=this.onChange.bind(this),this.onChange=this.onChange.bind(this),this.validate=this.validate.bind(this),this.getError=this.getError.bind(this),this.setValue=this.setValue.bind(this),this.beforeSet=this.beforeSet.bind(this),this.afterSet=this.afterSet.bind(this),this.maskInit=this.maskInit.bind(this),this.cmInit=this.cmInit.bind(this),this.onInit=this.onInit.bind(this),this.onSetError=this.onSetError.bind(this),this.onInit(e,t)}validate(e){return function(e,t){let s=!1,i="",a=e.validators;"function"==typeof a&&(a=[a]);if(e.show)try{Array.isArray(a)&&a.length&&a.forEach((s=>s&&s(e,t)))}catch(e){s=e instanceof Error?e.message:"object"==typeof e?e.error:e,i=e.errorLevel||"error"}return e.errorLevel=i,e.error=s,!(s&&"error"===i)}(this,e)}maskInit(e){e&&(this._maskInstance=e)}cmInit(e){e&&(this._cm=e)}onChange(e){let t;"group_checkbox"===this.type?t=e:e.target?(t=["checkbox","toggle"].includes(this.type)?e.target.checked?1:0:e.target.value,e.target.mask&&(this._maskInstance=e.target.mask)):t=e.value,this.setValue(t,e.type||"change")}setValue(e,t="external"){const s=this.value;if(s===e)return void this.validate(t);this.beforeSet({type:t,oldValue:s,newValue:e}),["input","change"].includes(t)&&(this.inputed=!0);const i=Object.getOwnPropertyDescriptor(this,"value");(i.writable||i.set)&&(this.value=e),"external"===t&&this._maskInstance&&(this._maskInstance.unmaskedValue=e),this.afterSet({type:t,oldValue:s,newValue:e}),this.validate(t)}onInit(){}beforeSet(){}afterSet(){}getError(){}onSetError(){}}function jl(e,t){return Zs.create({overlay:!0,shadow:!t.fromModal,handle:!1,title:tr("admin::ecommerce::category::add_title"),width:450,...t,riotTag:"ecommerce-category-edit-modal",props:{mode:"add",...e}})}function Fl(e,t){return Zs.create({overlay:!0,shadow:!0,handle:!1,title:tr("admin::ecommerce::category::select_title"),width:540,...t,riotTag:"ecommerce-category-select-modal",props:{...e}})}riot3.tag2("ecommerce-category-edit-modal",'<div class="row"> <div class="col col-12"> <div class="flexbe-title"> {fields.name.label} </div> <div data-is="flexbe-input" type="{fields.name.type}" placeholder="{fields.name.placeholder}" riot-value="{fields.name.value}" error="{!fields.name.valid}" error-text="{fields.name.error}" oninput="{fields.name.onchange}" onkeydown="{keydownHandle}" autofocus="{true}"></div> </div> <div class="col col-12 mt20"> <label data-is="flexbe-input" type="{fields.visible.type}" checked="{fields.visible.value}" onchange="{fields.visible.onchange}"> <span class="flexbe-text">{tag.fields.visible.label}</span> <q data-is="flexbe-tooltip" content="{tag.fields.visible.tip}"></q> </label> </div> <div class="col col-12 mt20"> <div class="flexbe-buttons-line"> <div class="flexbe-button filled is-primary {\'loading\': state.saving, \'shake-animation\': state.error}" onclick="{onSave}"> <span class="flexbe-text" if="{state.mode === \'add\'}"> {tr(\'main::button::add\')} </span> <span class="flexbe-text" if="{state.mode !== \'add\'}"> {tr(\'admin::ecommerce::product::category_edit\')} </span> </div> <div class="flexbe-button filled default" onclick="{modalClose}"> <span class="flexbe-text"> {tr(\'main::button::cancel\')} </span> </div> </div> </div> </div>',"",'class="ecommerce-category-edit-modal flexbe-modal-content {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.state={saving:!1,error:!1,mode:e.mode??"edit",data:null},this.fields=[],this.normalizeData=function(){this.state.data={visible:1,name:"",...bt(e.data)}}.bind(this);const s=(e,s)=>{const i=vt({get value(){return t.state.data[e]??""},set value(s){t.state.data[e]=s}},s);return new Hl(e,i)};this.createFields=function(){const e=s("name",{label:tr("admin::ecommerce::category::name"),validators:[Ul.required]}),t=s("visible",{type:"toggle",label:tr("admin::ecommerce::category::visible_toggle"),tip:tr("admin::ecommerce::category::visible_tip")});this.fields={name:e,visible:t}}.bind(this),this.onSave=async function(){this.state.error=!1;if(this.checkErrors("submit"))return this.update(),this.root.offsetHeight,this.state.error={code:"error_in_fields",message:tr("main::error:check_fields")},void this.update();this.state.saving=!0,this.update();const t=bt(this.state.data),s={visible:t.visible,name:t.name},i=t.id;try{if("function"!=typeof e.onSave)return"opts.onSave not function";"add"===this.state.mode?await e.onSave(s):await e.onSave(i,s),this.modalSaved(),this.modalClose()}catch(e){if("NetworkError"!==e.name)throw e;toast.error(e.message)}this.state.saving=!1,this.update()}.bind(this),this.checkErrors=function(e){return!Object.values(this.fields).every((t=>t.validate(e)))}.bind(this),this.modalSaved=function(){e.modal?.saved()}.bind(this),this.modalClose=function(){e.modal?.close()}.bind(this),this.keydownHandle=function(e){13===e.which&&this.onSave()}.bind(this),this.onBeforeMount=function(){this.normalizeData(),this.createFields()}.bind(this)})),riot3.tag2("ecommerce-category-select-modal",'<div class="search-input-container"> <label data-is="flexbe-input" class="block search-input" type="text" oninput="{applySearch}" riot-value="{tag.search}" placeholder="{tr(\'admin::ecommerce::category_select::search\')}"> </label> <div class="clear-search-input" if="{tag.search !== \'\'}" onclick="{clearSearch}"> <svg class="flexbe-icon size-10"> <use riot-xlink:href="{meta.sprite}#close"></use> </svg> </div> </div> <div class="list-container"> <div class="buttons-container" if="{tag.state.sourceList.length && !tag.emptySearchResult}"> <div class="flexbe-button style-text" onclick="{clear}"> <span class="flexbe-text">{tr(\'admin::ecommerce::category_select::clean\')}</span> </div> <div class="flexbe-button style-text" onclick="{selectAll}"> <span class="flexbe-text">{tr(\'admin::ecommerce::category_select::select_all\')}</span> </div> </div> <div class="scrollable-content {\'empty\': tag.emptySearchResult}"> <div class="flexbe-list hoverable-background"> <label data-is="flexbe-input" class="flexbe-list-item" type="checkbox" each="{item in tag.searchResult}" key="{item.id}" checked="{item.selected}" onchange="{tag.toggleSelected.bind(tag, item)}"> <span class="flexbe-text">{item.name}</span> </label> </div> </div> <div if="{tag.emptySearchResult}" class="empty-text"> {tr(\'admin::ecommerce::category_select::not_search\')} </div> <div if="{!tag.state.sourceList.length}" class="empty-text"> {tr(\'admin::ecommerce::category_select::not_category\')} </div> <div class="flexbe-modal-footer"> <div class="flexbe-button filled {\'disabled\': state.loading}" onclick="{closeModal}"> <span class="flexbe-text">{tr(\'main::button::cancel\')}</span> </div> <div class="flexbe-button is-primary filled {\'loading disabled\': state.loading}" onclick="{setCategories}"> <span class="flexbe-text">{tr(\'main::button::done\')}</span> </div> </div> </div>',"",'class="ecommerce-category-select-modal {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.search="",this.searchResult=[],this.emptySearchResult=!1,this.selectedIds=[],this.state={loading:!1,get sourceList(){return t.props.list??[]}},this.meta={sprite:at("editor_products")},this.applySearch=function(e){const t=e.target.value;t?t.length>0&&(this.search=t,this.searchResult=this.state.sourceList.filter((e=>(e.title||e.name).toLowerCase().includes(t.toLowerCase()))),this.emptySearchResult=0===this.searchResult.length):this.clearSearch()}.bind(this),this.clearSearch=function(){this.search="",this.searchResult=this.state.sourceList,this.emptySearchResult=!1}.bind(this),this.toggleSelected=function(e,t){let s=[];s="true"===t.target.value?[...this.selectedIds,e.id]:this.selectedIds.filter((t=>t!==e.id)),this.searchResult.forEach((t=>t.selected=e.id===t.id)),this.selectedIds=s}.bind(this),this.clear=function(){this.searchResult.forEach((e=>e.selected=!1)),this.onSelected([])}.bind(this),this.selectAll=function(){const e=this.searchResult.map((e=>e.id));this.searchResult.forEach((e=>e.selected=!0)),this.onSelected(e)}.bind(this),this.onSelected=function(e){this.selectedIds=e,this.update()}.bind(this),this.onBeforeMount=function(){this.searchResult=this.state.sourceList}.bind(this),this.setCategories=async function(){this.state.loading=!0,this.update();try{return await this.onSave(),this.closeModal(),result}catch(e){return this.state.loading=!1,this.update(),e}}.bind(this),this.onSave=async function(){if(this.selectedIds.length)return await e.onSave(this.selectedIds)}.bind(this),this.closeModal=function(){e.modal.close()}.bind(this)}));const Ll={css:null,exports:{setup(e,{initMobx:t}){t(),this.$tags=[],this.$categories=adminStore.getModule("ecommerce/categories"),this.$store=e.props.store,this.state={sprite:at("ecommerce","admin"),fields:[],get item(){var t;return null!=(t=e.$store.state.item)?t:[]},get hasOptions(){return this.item.options.length},get media(){var e;return null!=(e=this.item.images)?e:[]},get displayImage(){return this.hasOptions?this.item.display_image:"product"},get categoryId(){return this.item.categories},get category(){const e=this.categoryList,t=this.categoryId;return e.filter((e=>t.some((t=>+t==+e.id))))},get categoryName(){return this.category.map((e=>e.name))},get categoryList(){return e.$categories.getters.categoryList}},this.watch={"state.categoryList":[()=>{this.meta.categoryFilter=this.state.categoryList,this.update()},{deep:!0}]},this.meta={visibleList:[{icon:"dot",iconWidth:"6px",iconHeight:"6px",title:tr("admin::ecommerce::variants::show"),value:1,color:"flexbe-green"},{icon:"dot",iconWidth:"6px",iconHeight:"6px",title:tr("admin::ecommerce::variants::hide"),value:0,color:"flexbe-red"}],search:"",showSelect:!1,categoryFilter:bt(this.$categories.getters.categoryList)},this.loading=[],this.createField=(t,s)=>{const i=vt({validators:[Ul.required],get value(){var s;return null!=(s=e.state.item[t])?s:""},set value(s){e.$store.commit("setField",t,s)}},s);return new Hl(t,i)}},createFields(){const e=this.createField("name",{label:tr("admin::ecommerce::variants::name"),placeholder:tr("admin::ecommerce::variants::name_placeholder"),validators:[Ul.required]}),t=this.createField("description",{label:tr("admin::ecommerce::variants::description"),type:"textarea",rows:3});this.state.fields={name:e,description:t}},checkErrors(){return!this.state.fields.name.validate()&&{code:"error_in_fields",message:tr("main::error:check_fields")}},changeVisible(e){const t=e.value;this.$store.commit("setField","visible",t)},selectDisplayImage(e){(e.target.checked?1:0)?this.$store.commit("setField","display_image","variant"):this.$store.commit("setField","display_image","product")},loadingImage(e,t){t?this.loading.push(e):this.loading=this.loading.filter((t=>t!==e)),this.loading.length?this.$store.trigger("disableSave"):this.$store.trigger("enableSave"),this.update()},getImageUrl:e=>Vr(e,120),getOriginUrl:e=>Vr(e,0),uploadedMedia(e,t){const s=bt(this.state.media),i=s.findIndex((t=>e===t.unq_id));if(0===(null==t?void 0:t.id))s.splice(i,1),toast.error(tr("main::error::upload_file"));else{const a=ct(t);s[i]={...a,unq_id:`${e}${(new Date).getTime()}`}}this.loadingImage(e,!1),this.$store.commit("setField","images",s)},onUploadStart(e){this.loadingImage(e,!0);const t=bt(this.state.media);t.push({unq_id:e,loading:!0}),this.$store.commit("setField","images",t)},onUploadedError(e){this.loadingImage(e,!1);let t=bt(this.state.media);t=t.filter((t=>e!==t.unq_id)),this.$store.commit("setField","images",t)},sortedMedia({oldIndex:e,newIndex:t}){const s=bt(this.state.media);s.splice(t,0,s.splice(e,1)[0]),this.$store.commit("setField","images",s),this.meta.destroyList=!0,this.update(),this.meta.destroyList=!1,this.update()},deleteMedia(e,t){t.preventDefault(),t.stopPropagation();const s=bt(this.state.media),i=s.findIndex((t=>t.unq_id===e.unq_id));s.splice(i,1),this.$store.commit("setField","images",s),this.$store.commit("removeVariantImg",e)},showSelect(){if(this.meta.showSelect)return!1;this.meta.showSelect=!0,this.update(),this.$tags.length||(this.$tags=$(this.root).find(".ecommerce-product-tags")),$(".overlay-area").off("click.show-select").on("click.show-select",(e=>{const t=this.$tags[0].contains(e.target),s=$(e.target).hasClass("flexbe-close");t||s||($(".overlay-area").off("click.show-select"),this.meta.showSelect=!1,this.update())}))},addCategoryItem(){const e=this.meta.categoryFilter,t=e[0];if(t){const e=this.state.categoryId.includes(t.id);if(this.meta.search="",this.meta.categoryFilter=this.state.categoryList,this.update(),e)return!1;const s=this.state.category.map((e=>e.id));s.push(t.id),this.$store.commit("setField","categories",s)}e.length||this.addCategory()},removeCategoryItem({index:e}){const t=this.state.category.map((e=>e.id));t.splice(e,1),this.$store.commit("setField","categories",t)},toggleCategory(e,t){const s=t.target.checked?1:0;let i=bt(this.state.item.categories);s?i.push(e):i=i.filter((t=>+t!=+e)),this.$store.commit("setField","categories",i)},filterCategory(e){if(!e.inputType)return!1;this.meta.search=e.target.value.trim(),this.meta.categoryFilter=this.state.categoryList.filter((e=>e.name.toLowerCase().includes(this.meta.search.toLowerCase()))),this.update()},addCategory(){jl({onSave:async e=>{const t=await this.$categories.dispatch("createCategory",e),s=bt(this.state.item.categories);s.push(t.id),this.meta.showSelect=!1,this.$store.commit("setField","categories",s),this.meta.search="",this.update()},data:{name:this.meta.search}},{fromModal:this.props.modal})},onBeforeMount(){if(this.createFields(),"add"===this.props.data.mode){var e;const t=+((null==(e=flexbe.routing.query)?void 0:e.categories)||0);this.$store.commit("setField","categories",[t])}},onMounted(){this.$store.on("checkError",(e=>{e(this.checkErrors())}))},onUnmounted(){this.$store.off("checkError",(()=>{}))}},template:(e,t,s,i)=>e('<div expr1321="expr1321" class="flexbe-text text-m text-medium mb10"> </div><div expr1322="expr1322" class="mb20 ecommerce-product--loading flexbe-placeholder"></div><div expr1323="expr1323" is="flexbe-input" class="mb20"></div><div expr1324="expr1324" class="flexbe-text text-m text-medium mb10"> </div><div expr1325="expr1325" class="mb20 ecommerce-product--loading flexbe-placeholder big-placeholder"></div><div expr1326="expr1326" is="flexbe-input" class="mb20"></div><div expr1327="expr1327" class="flexbe-text text-m text-medium mb10"> </div><div expr1328="expr1328" class="mb20 ecommerce-product--loading flexbe-placeholder small-placeholder"></div><div expr1329="expr1329" is="flexbe-buttons-line" button-class="small ecommerce-product_buttons-line mb20" role="buttons"></div><div expr1330="expr1330" class="flexbe-text text-m text-medium mb10"> </div><div expr1331="expr1331" class="mb20 ecommerce-product--loading flexbe-placeholder"></div><div expr1332="expr1332" class="mb20 ecommerce-product-tags not-scrollable" is="proxy" data-is="flexbe-input-tags" item-title="name"></div><div class="ecommerce-product_container-media"><div class="flexbe-text text-m ecommerce-product_title mt20"><span expr1339="expr1339"> <q expr1340="expr1340" is="flexbe-tooltip"></q></span><label expr1341="expr1341" is="flexbe-checkbox" type="toggle" name="is_auto"></label></div><div expr1343="expr1343" class="ecommerce-product_block-media"></div></div><div expr1355="expr1355" class="ecommerce-product_block-media--info"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["ecommerce-product-common-settings ",e.props.class].join("")}]},{redundantAttribute:"expr1321",selector:"[expr1321]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.fields.name.label].join("")}]},{type:s.IF,evaluate:e=>e.props.loader,redundantAttribute:"expr1322",selector:"[expr1322]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.props.loader,redundantAttribute:"expr1323",selector:"[expr1323]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"type",evaluate:e=>e.state.fields.name.type},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.state.fields.name.placeholder},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.fields.name.value},{type:t.ATTRIBUTE,name:"error",evaluate:e=>!e.state.fields.name.valid},{type:t.ATTRIBUTE,name:"error-text",evaluate:e=>e.state.fields.name.error},{type:t.EVENT,name:"oninput",evaluate:e=>e.state.fields.name.onchange},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>"add"===e.props.data.mode}]}])},{redundantAttribute:"expr1324",selector:"[expr1324]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.fields.description.label].join("")}]},{type:s.IF,evaluate:e=>e.props.loader,redundantAttribute:"expr1325",selector:"[expr1325]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.props.loader,redundantAttribute:"expr1326",selector:"[expr1326]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"type",evaluate:e=>e.state.fields.description.type},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.fields.description.value},{type:t.ATTRIBUTE,name:"rows",evaluate:e=>e.state.fields.description.rows},{type:t.EVENT,name:"oninput",evaluate:e=>e.state.fields.description.onchange}]}])},{redundantAttribute:"expr1327",selector:"[expr1327]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::ecommerce::variants::visible")].join("")}]},{type:s.IF,evaluate:e=>e.props.loader,redundantAttribute:"expr1328",selector:"[expr1328]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.props.loader,redundantAttribute:"expr1329",selector:"[expr1329]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-buttons-line",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.state.sprite},{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.visibleList},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.item.visible},{type:t.EVENT,name:"onchange",evaluate:e=>e.changeVisible}]}])},{redundantAttribute:"expr1330",selector:"[expr1330]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::ecommerce::variants::category")}]},{type:s.IF,evaluate:e=>e.props.loader,redundantAttribute:"expr1331",selector:"[expr1331]",template:e(null,[])},{type:s.IF,evaluate:e=>!e.props.loader,redundantAttribute:"expr1332",selector:"[expr1332]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div expr1333="expr1333"><label expr1334="expr1334" is="flexbe-checkbox" type="checkbox"></label><div expr1336="expr1336" class="ecommerce-product-tags--button flexbe-list-item"><svg class="flexbe-icon size-12"><use expr1337="expr1337"/></svg><span class="flexbe-text text-s"><raw expr1338="expr1338"></raw></span></div></div>',bindings:[{redundantAttribute:"expr1333",selector:"[expr1333]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>[e.meta.showSelect?"show":""," ecommerce-product-tags--selects flexbe-list borderless round-corners hoverable-background"].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr1335="expr1335" class="flexbe-text"> </span>',bindings:[{redundantAttribute:"expr1335",selector:"[expr1335]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.category.name}]}]}],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list-item ",!e.index&&e.meta.search?"ecommerce-product--category-hover":""].join("")},{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.categoryId.includes(e.category.id)},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.toggleCategory(e.category.id,t)}]}]),redundantAttribute:"expr1334",selector:"[expr1334]",itemName:"category",indexName:"index",evaluate:e=>e.meta.categoryFilter},{redundantAttribute:"expr1336",selector:"[expr1336]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.addCategory}]},{redundantAttribute:"expr1337",selector:"[expr1337]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#plus"].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::ecommerce::variants::add_category_button",{name:e.meta.search})}],redundantAttribute:"expr1338",selector:"[expr1338]"}]}],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.categoryName},{type:t.ATTRIBUTE,name:"input-value",evaluate:e=>e.meta.search},{type:t.ATTRIBUTE,name:"blur-add",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"allow-duplicates",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::ecommerce::variants::add_category_placeholder")},{type:t.EVENT,name:"oninput",evaluate:e=>e.filterCategory},{type:t.EVENT,name:"onfocus",evaluate:e=>e.showSelect},{type:t.ATTRIBUTE,name:"add-handler",evaluate:e=>e.addCategoryItem},{type:t.ATTRIBUTE,name:"remove-handler",evaluate:e=>e.removeCategoryItem}]}])},{redundantAttribute:"expr1339",selector:"[expr1339]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::ecommerce::variants::images_title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::ecommerce::variants::images_tip")}],redundantAttribute:"expr1340",selector:"[expr1340]"},{type:s.IF,evaluate:e=>e.state.hasOptions,redundantAttribute:"expr1341",selector:"[expr1341]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr1342="expr1342" class="flexbe-text"> </span>',bindings:[{redundantAttribute:"expr1342",selector:"[expr1342]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::ecommerce::variants::unique_image_toggle")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>"variant"===e.state.displayImage},{type:t.EVENT,name:"onchange",evaluate:e=>e.selectDisplayImage}]}])},{type:s.IF,evaluate:e=>"product"===e.state.displayImage,redundantAttribute:"expr1343",selector:"[expr1343]",template:e('<div expr1344="expr1344" class="ecommerce-product--loading flexbe-placeholder image-placeholder"></div><div expr1345="expr1345" class="display-flex flex-wrap" is="flexbe-sort-list" item-selector=".ecommerce-product_container" handle-selector=".ecommerce-product_container"></div>',[{type:s.EACH,getKey:null,condition:e=>e.props.loader,template:e(null,[]),redundantAttribute:"expr1344",selector:"[expr1344]",itemName:"item",indexName:null,evaluate:e=>[1,2,3]},{type:s.IF,evaluate:e=>!e.props.loader&&!e.meta.destroyList,redundantAttribute:"expr1345",selector:"[expr1345]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-sort-list",slots:[{id:"default",html:'<div expr1346="expr1346" class="ecommerce-product_container"></div><div expr1354="expr1354" is="proxy" data-is="flexbe-media-upload" type="image" multi="true" class="big rounded mb15"></div>',bindings:[{type:s.EACH,getKey:e=>e.file.unq_id,condition:null,template:e('<a expr1347="expr1347" target="_blank"></a><div expr1352="expr1352" class="ghost-image"></div>',[{type:s.IF,evaluate:e=>!e.file.loading,redundantAttribute:"expr1347",selector:"[expr1347]",template:e('<div class="ecommerce-product_overlay"><div expr1348="expr1348" class="ecommerce-product_image-delete"><svg class="flexbe-icon size-10"><use expr1349="expr1349"/></svg></div></div><div expr1350="expr1350" class="ecommerce-product_image"></div><div expr1351="expr1351" class="ecommerce-product_image" style="background-image: url(\'/images/admin/ecommerce/placeholder.png\')"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.getOriginUrl(e.file)}]},{redundantAttribute:"expr1348",selector:"[expr1348]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>t=>e.deleteMedia(e.file,t)}]},{redundantAttribute:"expr1349",selector:"[expr1349]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#close"].join("")}]},{type:s.IF,evaluate:e=>e.file.ext,redundantAttribute:"expr1350",selector:"[expr1350]",template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>["background-image: url(",e.getImageUrl(e.file),")"].join("")}]}])},{type:s.IF,evaluate:e=>e.file.f_name_info,redundantAttribute:"expr1351",selector:"[expr1351]",template:e(null,[])}])},{type:s.IF,evaluate:e=>e.file.loading,redundantAttribute:"expr1352",selector:"[expr1352]",template:e('<div class="overlay-loader"><span expr1353="expr1353" is="flexbe-loader" class="color-inherit"></span></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[],redundantAttribute:"expr1353",selector:"[expr1353]"}])}]),redundantAttribute:"expr1346",selector:"[expr1346]",itemName:"file",indexName:null,evaluate:e=>e.state.media},{type:s.IF,evaluate:e=>!e.props.loader&&!e.loading.length,redundantAttribute:"expr1354",selector:"[expr1354]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.EVENT,name:"on-uploaded",evaluate:e=>e.uploadedMedia},{type:t.EVENT,name:"on-upload-start",evaluate:e=>e.onUploadStart},{type:t.EVENT,name:"on-uploaded-error",evaluate:e=>e.onUploadedError},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"loader",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"overlay",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"show-overlay",evaluate:e=>!0}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"options",evaluate:e=>({preventOnFilter:!1})},{type:t.ATTRIBUTE,name:"sort-end",evaluate:e=>e.sortedMedia}]}])}])},{type:s.IF,evaluate:e=>"variant"===e.state.displayImage,redundantAttribute:"expr1355",selector:"[expr1355]",template:e('<div class="info-picture"></div><div expr1356="expr1356"> </div>',[{redundantAttribute:"expr1356",selector:"[expr1356]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::ecommerce::variants::image_info")}]}])}]),name:"ecommerce-product-common-settings"};e(Ll.name,Ll),riot3.tag2("ecommerce-product-simple-variant",'<div class="ecommerce-product-variants-setting_block flexbe-field-group row"> <div class="ecommerce-product-variants-setting_input col col-{opts.loader ? 12 : 6}"> <div class="flexbe-title text-m"> <span class="flexbe-text">{state.fields.price.label}</span> </div> <div if="{!opts.loader}" data-is="flexbe-input" type="{state.fields.price.type}" normalize="{state.fields.price.normalize}" placeholder="{state.fields.price.placeholder}" riot-value="{state.fields.price.value}" oninput="{state.fields.price.onchange}" max-length="{state.fields.price.maxlength}" onblur="{inputBlurPrice}"></div> <div class="ecommerce-product--loading flexbe-placeholder" if="{opts.loader}"></div> </div> <div class="col col-6" if="{!state.usePriceOld && !opts.loader}"> <div class="show-old-price flexbe-button style-text medium" onclick="{usePriceOld.bind(this, true)}"> <svg class="flexbe-icon size-12"><use riot-xlink:href="{state.sprite}#plus"></use></svg> <span class="flexbe-text text-s">{tr(\'admin::ecommerce::variants::add_old_price\')}</span> </div> </div> <div if="{state.usePriceOld && !opts.loader}" class="ecommerce-product-variants-setting_input col col-6"> <div class="flexbe-title text-m"> <span class="flexbe-text">{state.fields.priceOld.label}</span> <span class="hide-old-price text-shade-30" onclick="{usePriceOld.bind(this, false)}"> <svg class="flexbe-icon size-10"> <use riot-xlink:href="{state.sprite}#close"></use> </svg> </span> </div> <div data-is="flexbe-input" ref="oldPrice" class="flexbe-input old-price" type="{state.fields.priceOld.type}" normalize="{state.fields.priceOld.normalize}" riot-value="{state.fields.priceOld.value}" error="{state.fields.priceOld.error}" error-tip="{state.fields.priceOld.errorText}" oninput="{state.fields.priceOld.onchange}" max-length="{state.fields.priceOld.maxlength}" onblur="{inputBlurPriceOld}"></div> </div> </div> <div class="ecommerce-product-variants-setting_block flexbe-field-group row"> <div class="ecommerce-product-variants-setting_input col col-{opts.loader ? 12 : 6}"> <div class="flexbe-title text-m"> {state.fields.quantity.label} </div> <div if="{!opts.loader}" data-is="flexbe-input" class="{\'quantity_infinity\': state.fields.infinity.value} flexbe-input" type="{state.fields.quantity.type}" placeholder="{state.fields.infinity.value ? \'\' : state.fields.quantity.placeholder}" normalize="{state.fields.quantity.normalize}" riot-value="{state.fields.infinity.value ? \'\' : state.fields.quantity.value}" oninput="{state.fields.quantity.onchange}" readonly="{state.fields.infinity.value}" disabled="{state.fields.infinity.value}" max-length="{state.fields.quantity.maxlength}" ref="quantity"></div> <div if="{opts.loader}" class="ecommerce-product--loading flexbe-placeholder"></div> </div> <div if="{!opts.loader}" class="ecommerce-product-variants-setting_toggle col col-6"> <label data-is="flexbe-input" type="{state.fields.infinity.type}" checked="{state.fields.infinity.value}" onchange="{state.fields.infinity.onchange}"> <span class="flexbe-text">{tag.state.fields.infinity.label}</span> </label> </div> </div> <div class="flexbe-field-group"> <div class="flexbe-title text-m"> {state.fields.vendorCode.label} </div> <div if="{!opts.loader}" data-is="flexbe-input" type="{state.fields.vendorCode.type}" placeholder="{state.fields.vendorCode.placeholder}" riot-value="{state.fields.vendorCode.value}" oninput="{state.fields.vendorCode.onchange}" onblur="{inputBlurVendorCode}"></div> <div class="ecommerce-product--loading flexbe-placeholder" if="{opts.loader}"></div> </div> <div class="flexbe-field-group"> <div class="flexbe-title text-m">{tr(\'admin::ecommerce::variants::options_title\')}</div> <div class="ecommerce-product-variants-setting_options"> <div class="flexbe-text text-s mr30">{tr(\'admin::ecommerce::variants::options_note\')}</div> <svg width="48" height="22" viewbox="0 0 48 22" fill="none"> <path d="M17.6995 0H16.9C16.9 0 15.6 2.66667 13 2.66667C10.4 2.66667 9.1 0 9.1 0H8.3005C7.1227 0 5.967 0.328 4.9556 0.950667L0 4L1.5 10H4.9556V22H21.0444V10H24.5L26 4L21.0444 0.950667C20.033 0.328 18.8773 0 17.6995 0Z" fill="#D6343A"></path> <path d="M23 22H32.0286V10H35.4952L37 4L32.5 1.85634L28.6731 0H28L26.2986 1.85634L27.0165 2.29664L28.2678 3.06419L27.9115 4.48507L26.4067 10.4851L26.0268 12H24.4602H23V22Z" fill="#5452FE"></path> <path d="M34 22H43.0286V10H46.4952L48 4L43.5 1.85634L39.6731 0H39L37.2986 1.85634L38.0165 2.29664L39.2678 3.06419L38.9115 4.48507L37.4067 10.4851L37.0268 12H35.4602H34V22Z" fill="#177D50"></path> </svg> </div> <div class="flexbe-button is-secondary filled mt20" disabled="{opts.loader}" onclick="{opts.addOption}"> <span class="flexbe-text text-medium">{tr(\'admin::ecommerce::variants::add_option\')}</span> </div> </div>',"",'class="ecommerce-product-simple-variant {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.$store=this.opts.store,this.state={sprite:at("ecommerce","admin"),fields:[],get item(){return t.$state.item},get variant(){return this.item.variants[0]},get quantity(){return this.variant.quantity??null},get usePriceOld(){return this.item.use_price_old},get priceOld(){return this.variant.price_old},get price(){return this.variant.price},get option(){return[]}},this.meta={quantity:-1!==t.state.quantity?t.state.quantity:null};const s=(e,s)=>{const i=vt({get value(){return t.state.variant[e]??""},set value(s){t.$store.commit("setFieldVariant",{name:e,value:s,index:0})}},s);return new Hl(e,i)},i=(e="")=>e.replace(/[^+\d.,]/g,"");this.createFields=function(){const e=s("price",{label:tr("admin::ecommerce::variants::price"),type:"number",placeholder:"",maxlength:9,normalize:e=>i(e),get value(){return t.state.variant.price??null},set value(e){""===e&&(e=null),t.$store.commit("setFieldVariant",{name:"price",value:e,index:0}),t.state.usePriceOld&&t.checkError()}}),a=s("price_old",{label:tr("admin::ecommerce::variants::old_price"),type:"number",error:!1,errorText:"",maxlength:9,normalize:e=>i(e),get value(){return t.state.variant.price_old??""},set value(e){t.$store.commit("setFieldVariant",{name:"price_old",value:e,index:0}),t.error&&t.checkError()}}),n=s("quantity",{label:tr("admin::ecommerce::variants::quantity"),type:"number",placeholder:"0",maxlength:9,normalize:e=>i(e),get value(){return t.state.variant.quantity??null},set value(e){t.$store.commit("setFieldVariant",{name:"quantity",value:e,index:0}),t.meta.quantity=e}}),r=s("infinity",{label:tr("admin::ecommerce::variants::infinity"),type:"toggle",get value(){return-1===t.state.variant.quantity},set value(e){const s=e?-1:t.meta.quantity;t.$store.commit("setFieldVariant",{name:"quantity",value:s,index:0}),e||t.refs.quantity?.focus()}}),o=s("vendor_code",{label:tr("admin::ecommerce::variants::article"),placeholder:tr("admin::ecommerce::variants::article_placeholder"),get value(){let e=t.state.variant.vendor_code??"";return e&&(e=e.trim()),e},set value(e){t.$store.commit("setFieldVariant",{name:"vendor_code",value:e,index:0})}});this.state.fields={price:e,priceOld:a,quantity:n,infinity:r,vendorCode:o}}.bind(this),this.usePriceOld=function(e){t.$store.commit("setField","use_price_old",e),e?this.refs.oldPrice?.focus():(t.$store.commit("setField","use_price_old",!1),this.state.fields.priceOld.error="",this.state.fields.priceOld.errorText="")}.bind(this),this.checkError=function(){0!=+this.state.priceOld&&(this.state.fields.priceOld.error=+this.state.priceOld<=+this.state.price,this.state.fields.priceOld.errorText=tr("admin::ecommerce::variants::old_price_error"),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.update()}),100))}.bind(this),this.inputBlurPrice=function(){let e=t.state.variant.price;e&&(e=String(e).replace(/\.$/,"")),t.$store.commit("setFieldVariant",{name:"price",value:e,index:0})}.bind(this),this.inputBlurPriceOld=function(){let e=t.state.priceOld;e&&(e=String(e).replace(/\.$/,"")),t.$store.commit("setFieldVariant",{name:"price_old",value:e,index:0}),this.checkError()}.bind(this),this.inputBlurVendorCode=function(){let e=t.state.variant.vendor_code;e&&(e=e.trim()),this.meta.isFocus=!1,t.$store.commit("setFieldVariant",{name:"vendor_code",value:e,index:0}),this.update()}.bind(this),this.onBeforeMount=function(){this.createFields()}.bind(this),this.onMounted=function(){this.state.usePriceOld&&this.checkError()}.bind(this)})),riot3.tag2("action-complex-variant",'<div class="ecommerce-product-variants--setting-zone"> <svg class="flexbe-icon ecommerce-product-icon size-16"> <use riot-xlink:href="{opts.sprite}#dots"></use> </svg> <dropdown position="end" direction="bottom" trigger-delay="{0}" trigger="click" arrow="{false}" position-to=".ecommerce-product-variants--setting" ref="dropdown"> <div class="flexbe-list borderless hoverable hoverable-background opacify round-corners"> <label class="flexbe-list-item" onclick="{tag.editVariant.bind(tag, tag.opts.index, tag.opts.variant)}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#setting"></use> </svg> <span class="flexbe-text">{tr(\'main::button::settings\')}</span> </label> <label disabled="{tag.opts.variant.is_default}" class="flexbe-list-item" onclick="{tag.defaultVariant.bind(tag, tag.opts.index, tag.opts.variant)}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#common"></use> </svg> <span class="flexbe-text">{tr(\'admin::ecommerce::variants::is_default\')}</span> </label> <label class="flexbe-list-item" onclick="{tag.toggleVisibleVariant.bind(tag, tag.opts.index)}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#toggle_show"></use> </svg> <span class="flexbe-text">{tr(\'admin::ecommerce::variants::toggle_visible\')}</span> <span data-is="flexbe-input" type="toggle" checked="{tag.opts.variant.visible}"></span> </label> </div> </dropdown> </div>',"",'class="action-complex-variant {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.$store=this.opts.store,this.toggleVisibleVariant=function(e,t){t.stopPropagation();const s=t.target.checked;if("INPUT"!==t.target.tagName)return!1;this.$store.commit("setFieldVariant",{name:"visible",value:+s,index:e}),this.update()}.bind(this),this.editVariant=function(e,s,i){i.stopPropagation(),t.opts.editVariant(e,s,i),this.closeDropdown()}.bind(this),this.defaultVariant=function(e,t,s){t.is_default||(s.stopPropagation(),this.closeDropdown(),this.$store.commit("setFieldVariantDefault",{value:1,index:e}))}.bind(this),this.closeDropdown=function(){this.refs.dropdown.trigger("toggleDropdown",!1)}.bind(this)})),riot3.tag2("item-complex-variant",'<div class="ecommerce-product-variants--container" onclick="{editVariant.bind(tag, state.index, state.variant)}"> <div class="ecommerce-product-variants--img-block"> <svg if="{!state.media}" class="flexbe-icon size-28"> <use riot-xlink:href="{tag.meta.sprite}#not_img"></use> </svg> <div class="ecommerce-product-variants--img-item" if="{state.media}" riot-style="background-image: url({state.media})"></div> </div> <div class="ecommerce-product-variants--option">{state.name}</div> </div> <div class="ecommerce-product-variants--price"> <div data-is="flexbe-input" class="transparent small" type="{state.fields.price.type}" placeholder="{state.fields.price.placeholder}" riot-value="{state.fields.price.value}" oninput="{state.fields.price.onchange}" normalize="{state.fields.price.normalize}" max-length="{state.fields.price.maxlength}" data-prefix="{meta.isPrefix ? flexbe.vars.group.currency.symbol : \'\'}" data-suffix="{meta.isSuffix ? flexbe.vars.group.currency.symbol : \'\'}" onfocus="{inputFocus}" onblur="{inputBlurPrice}"></div> </div> <div class="ecommerce-product-variants--price-old" if="{state.usePriceOld}"> <div data-is="flexbe-input" class="flexbe-input transparent small old-price" type="{state.fields.priceOld.type}" placeholder="{state.fields.priceOld.placeholder}" error="{state.fields.priceOld.error}" error-tip="{state.fields.priceOld.errorText}" riot-value="{state.fields.priceOld.value}" oninput="{state.fields.priceOld.onchange}" normalize="{state.fields.priceOld.normalize}" max-length="{state.fields.priceOld.maxlength}" data-prefix="{meta.isPrefix ? flexbe.vars.group.currency.symbol : \'\'}" data-suffix="{meta.isSuffix ? flexbe.vars.group.currency.symbol : \'\'}" onblur="{inputBlurOldPrice}" onfocus="{inputFocus}"></div> </div> <div class="ecommerce-product-variants--quantity"> <div if="{state.variant.quantity === -1}" class="ecommerce-product-variants--quantity-infinity-icon"> <svg class="flexbe-icon quantity_infinity-svg size-16"> <use riot-xlink:href="{tag.meta.sprite}#infinity"></use> </svg> </div> <div class="ecommerce-product-variants--quantity-infinity quantity_infinity-svg" onclick="{toggleInfinity}"> <div class="display-flex" data-is="flexbe-tooltip" update-animation="{false}" content="{tag.meta.infinityTip}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.meta.sprite}#{(tag.state.variant.quantity === -1) ? \'big_close\' : \'big_infinity\'}"></use> </svg> </div> </div> <div data-is="flexbe-input" class="transparent small" type="{state.fields.quantity.type}" placeholder="{(state.variant.quantity === -1) ? \'\' : state.fields.quantity.placeholder}" riot-value="{(state.variant.quantity === -1) ? \'\' : state.fields.quantity.value}" oninput="{state.fields.quantity.onchange}" normalize="{state.fields.quantity.normalize}" readonly="{state.variant.quantity === -1}" max-length="{state.fields.quantity.maxlength}" onfocus="{inputFocus}" onblur="{inputBlur}" ref="quantity"></div> </div> <div class="ecommerce-product-variants--vendor-code"> <div data-is="flexbe-input" class="transparent small" type="{state.fields.vendorCode.type}" placeholder="{state.fields.vendorCode.placeholder}" riot-value="{state.fields.vendorCode.value}" oninput="{state.fields.vendorCode.onchange}" onfocus="{inputFocus}" onblur="{inputBlurVendorCode}"></div> </div> <div class="ecommerce-product-variants--hide-text {\'ecommerce-product-variants--use-old-price\': state.usePriceOld}" onclick="{editVariant.bind(tag, state.index, state.variant)}"> {tr(\'admin::ecommerce::variants::not_order\');} </div> <div class="ecommerce-product-variants--common" data-is="flexbe-tooltip" content="{tr(\'admin::ecommerce::variants::common_tip\')}"> <svg if="{tag.state.variant.is_default}" class="flexbe-icon size-12"> <use riot-xlink:href="{tag.meta.sprite}#common"></use> </svg> </div> <div data-is="action-complex-variant" class="ecommerce-product-variants--setting" sprite="{tag.meta.sprite}" index="{index}" variant="{state.variant}" store="{opts.store}" edit-variant="{editVariant}"></div>',"","class=\"item-complex-variant {'ecommerce-product-variants--hide': !state.variant.visible} {opts.class}\"",(function(e){this.mixin("initMobx");const t=this;this.$store=this.opts.store,this.state={fields:[],get item(){return t.$state.item},get optionsItem(){return this.item.options??[]},get variant(){return t.props.variant??[]},get quantity(){return this.variant.quantity??null},get mediaItem(){return this.item.images??[]},get mediaVariant(){return this.variant?.images??[]},get images(){return Dr({defId:this.variant?.default_image_id??null,displayImage:this.displayImage,productMedia:this.mediaItem,variantMedia:this.mediaVariant})},get media(){return this.images.length?Vr(this.images[0],240):""},get displayImage(){return this.item.display_image},get index(){return t.props.index??[]},get optionValues(){return this.variant?.option_values??[]},get name(){const e=[];return this.optionValues.forEach((t=>{const s=this.optionsItem.find((e=>e.id===t.option_id))?.values.find((e=>e.id===t.value_id));e.push(s?.name)})),e.join(", ")},get usePriceOld(){return this.item.use_price_old??!1}},this.meta={sprite:at("ecommerce","admin"),isFocus:!1,quantity:-1!==t.state.variant.quantity?t.state.variant.quantity:null,get isSuffix(){return":value :symbol"===flexbe.vars.group.currency_format.str},get isPrefix(){return":symbol:value"===flexbe.vars.group.currency_format.str},get infinityTip(){return-1===t.state.variant.quantity?tr("admin::ecommerce::variants::quantity_tip"):tr("admin::ecommerce::variants::infinity_tip")}},this.watch={"state.quantity":[()=>{-1!==t.state.quantity&&(t.meta.quantity=t.state.quantity)}]};const s=(e,s)=>{const i=vt({validators:[Ul.required],get value(){return t.state.variant[e]??""},set value(s){t.$store.commit("setFieldVariant",{name:e,value:s,index:t.state.index})}},s);return new Hl(e,i)},i=(e="")=>e.replace(/[^+\d.,]/g,"");this.createFields=function(){const e=s("price",{label:tr("admin::ecommerce::variants::price"),type:"number",placeholder:"",maxlength:9,normalize:e=>i(e),get value(){return t.state.variant.price??null},set value(e){""===e&&(e=null),t.$store.commit("setFieldVariant",{name:"price",value:e,index:t.state.index}),t.checkError()}}),a=s("price_old",{label:tr("admin::ecommerce::variants::old_price"),type:"number",placeholder:"",error:!1,errorText:"",maxlength:9,normalize:e=>i(e),get value(){return t.state.variant.price_old??""},set value(e){t.$store.commit("setFieldVariant",{name:"price_old",value:e,index:t.state.index}),t.error&&t.checkError()}}),n=s("quantity",{label:tr("admin::ecommerce::variants::quantity"),type:"number",placeholder:"0",maxlength:9,normalize:e=>i(e),get value(){return t.state.variant.quantity??""},set value(e){t.$store.commit("setFieldVariant",{name:"quantity",value:e,index:t.state.index})}}),r=s("vendor_code",{label:tr("admin::ecommerce::variants::article"),placeholder:tr("admin::ecommerce::variants::article_placeholder"),get value(){let e=t.state.variant.vendor_code??"";return e&&(e=e.trim()),e},set value(e){t.$store.commit("setFieldVariant",{name:"vendor_code",value:e,index:t.state.index})}});this.state.fields={price:e,priceOld:a,quantity:n,vendorCode:r}}.bind(this),this.toggleInfinity=function(){const e=-1===this.state.variant.quantity,s=e?this.meta.quantity:-1;t.$store.commit("setFieldVariant",{name:"quantity",value:s,index:t.state.index}),e&&t.refs.quantity?.focus()}.bind(this),this.checkError=function(){0!=+this.state.variant.price_old&&(this.state.fields.priceOld.error=+this.state.variant.price_old<=+this.state.variant.price,this.state.fields.priceOld.errorText=tr("admin::ecommerce::variants::old_price_error"),this.update())}.bind(this),this.inputFocus=function(){this.meta.isFocus=!0,this.update()}.bind(this),this.inputBlur=function(){this.meta.isFocus=!1,this.update()}.bind(this),this.inputBlurPrice=function(){let e=t.state.variant.price;e&&(e=String(e).replace(/\.$/,"")),this.meta.isFocus=!1,t.$store.commit("setFieldVariant",{name:"price",value:e,index:t.state.index}),this.update()}.bind(this),this.inputBlurVendorCode=function(){let e=t.state.variant.vendor_code;e&&(e=e.trim()),this.meta.isFocus=!1,t.$store.commit("setFieldVariant",{name:"vendor_code",value:e,index:t.state.index}),this.update()}.bind(this),this.inputBlurOldPrice=function(){let e=t.state.variant.price_old;e&&(e=String(e).replace(/\.$/,"")),this.meta.isFocus=!1,t.$store.commit("setFieldVariant",{name:"price_old",value:e,index:t.state.index}),this.checkError(),this.update()}.bind(this),this.editVariant=function(e,s,i){if(i.target.closest(".flexbe-input")||i.target.closest(".toggle-helper")||i.target.closest(".quantity_infinity-svg")||this.meta.isFocus)return i.preventDefault(),void i.stopPropagation();t.opts.modal?.disable();!function(e,t){Zs.create({overlay:!0,shadow:!1,handle:!1,title:tr("admin::ecommerce::variants::setting_title"),width:420,...t,riotTag:"ecommerce-variant-edit-modal",props:{mode:"edit",...e},onClose:()=>{e.onConfirm&&e.onConfirm(!1)}})}({variant:s,index:e,store:t.$store,onConfirm:()=>{t.opts.modal?.enable()}},{fromModal:t.opts.modal})}.bind(this),this.onBeforeMount=function(){this.createFields()}.bind(this),this.onUpdated=function(){this.state.usePriceOld||(this.state.fields.priceOld.error="",this.state.fields.priceOld.errorText="")}.bind(this),this.onMounted=function(){this.$store.on("checkErrorOldPrice",(()=>{this.checkError()}))}.bind(this),this.onUnmounted=function(){this.$store.off("checkErrorOldPrice",(()=>{}))}.bind(this)})),riot3.tag2("options-complex-variant",'<div class="options-complex-variant-title flexbe-text test-m"> {tr(\'admin::ecommerce::option::title\')} </div> <div data-is="flexbe-sort-list" if="{!opts.loader}" class="flexbe-list ecommerce-product-list" handle-selector=".draggable" item-selector=".flexbe-list-item" sortend="{sortOptions}"> <div class="flexbe-list-item field-index-{index}" each="{option, index in tag.opts.options}" key="{option.id}" data-id="{option.id}" field-index="{index}" onclick="{tag.editOption.bind(tag, index, option)}"> <div class="draggable"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{tag.opts.sprite}#drag"></use> </svg> </div> <div class="flexbe-text text-s ecommerce-product-list--name">{option.name}</div> <div class="ecommerce-product-list--container"> <div class="ecommerce-product-list--value" each="{value in option.values}"> <div class="ecommerce-product-list--color" if="{option.data.type === \'color\'}" riot-style="background: {value.data.color}"></div> <div class="flexbe-text text-s">{value.name}</div> </div> </div> <div class="flexbe-icon size-16 option-settings" title="{tr(\'editor::form::field_settings_button\')}"> <svg> <use riot-xlink:href="{tag.opts.sprite}#action_settings"></use> </svg> </div> <div class="flexbe-icon size-16 option-remove" title="{tr(\'editor::form::field_delete_button\')}" onclick="{tag.removeOption.bind(tag, index, option)}"> <svg> <use riot-xlink:href="{tag.opts.sprite}#action_delete"></use> </svg> </div> </div> </div> <div class="option-placeholder" if="{opts.loader}" each="{option in [1, 2, 3]}"> <div class="ecommerce-product--loading flexbe-placeholder small-placeholder"></div> </div>',"",'class="options-complex-variant {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.$store=this.opts.store,this.sortOptions=function({oldIndex:e,newIndex:t}){if(e===t)return;const s=bt(this.props.options);s.splice(t,0,s.splice(e,1)[0]),this.updateOptionList(s),this.update()}.bind(this),this.updateOptionList=function(e){this.$store.commit("setField","options",e),this.$store.commit("generatorVariants")}.bind(this),this.editOption=function(e,s,i){if(this.opts.loader||i.target.closest(".draggable")||i.target.closest(".option-remove")||i.target.closest(".field-list__sortable-drag"))return;t.opts.modal?.disable();!function(e,t){Zs.create({overlay:!0,shadow:!1,handle:!1,title:tr("admin::ecommerce::option::edit_title"),width:406,...t,riotTag:"ecommerce-option-edit-modal",props:{mode:"edit",...e},onClose:()=>{e.onConfirm&&e.onConfirm(!1)}})}({onSave:t.updateOption,option:s,index:e,store:t.$store,onConfirm:()=>{t.opts.modal?.enable()}})}.bind(this),this.updateOption=function(e){this.$store.commit("setOptions",e.index,e.option),this.update()}.bind(this),this.removeOption=function(e,s){t.opts.modal?.disable();As({props:{icon:`${t.opts.sprite}#remove_product`,title:tr("admin::ecommerce::option::delete_confirm_title",{name:s.name}),confirmButtonText:tr("main::button::confirm"),confirmButtonClass:"is-danger bordered colored",cancelButton:!0,onConfirm:()=>t.deleteOption(e),onDone:()=>{t.opts.modal?.enable()}},onClose:()=>t.opts.modal?.enable(),clickOut:!0,shadow:!1})}.bind(this),this.deleteOption=function(e){this.$store.commit("deleteOption",e),this.update()}.bind(this)})),riot3.tag2("ecommerce-product-complex-variant",'<div class="flexbe-field-group"> <div data-is="options-complex-variant" store="{$store}" options="{state.options}" sprite="{meta.sprite}" loader="{opts.loader}" modal="{tag.opts.modal}"></div> </div> <div class="flexbe-field-group"> <div class="flexbe-button is-secondary filled" disabled="{opts.loader}" onclick="{opts.addOption}"> <span class="flexbe-text text-medium">{tr(\'admin::ecommerce::variants::add_option\')}</span> </div> </div> <div class="flexbe-field-group"> <div class="ecommerce-product-variants-title"> <div class="flexbe-text text-medium"> {tr(\'admin::ecommerce::variants::title\')} ({state.variants.length}) </div> <div class="show-old-price flexbe-button style-text medium" if="{!state.usePriceOld}" onclick="{usePriceOld.bind(this, true)}" disabled="{opts.loader}"> <svg class="flexbe-icon size-12"> <use riot-xlink:href="{meta.sprite}#plus"></use> </svg> <span class="flexbe-text text-s">{tr(\'admin::ecommerce::variants::add_old_price\')}</span> </div> <div class="mass-actions flexbe-button style-text medium" onclick="{massActions}" disabled="{opts.loader}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{meta.sprite}#mass_actions"></use> </svg> <span class="flexbe-text text-s">{tr(\'admin::ecommerce::variants::mass_actions\')}</span> </div> </div> <div class="ecommerce-product-variants-heading"> <div class="ecommerce-product-variants--img-block"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.meta.sprite}#img_header"></use> </svg> </div> <div class="ecommerce-product-variants--option">{tr(\'admin::ecommerce::variants::options_title\')}</div> <div class="ecommerce-product-variants--price">{tr(\'admin::ecommerce::variants::price\')}</div> <div class="ecommerce-product-variants--price-old" if="{state.usePriceOld}"> <span>{tr(\'admin::ecommerce::variants::old_price\')}</span> <span class="hide-old-price" onclick="{usePriceOld.bind(this, false)}"> <svg class="flexbe-icon size-10"> <use riot-xlink:href="{tag.meta.sprite}#close"></use> </svg> </span> </div> <div class="ecommerce-product-variants--quantity">{tr(\'admin::ecommerce::variants::quantity_reduction\')}</div> <div class="ecommerce-product-variants--vendor-code">{tr(\'admin::ecommerce::variants::article\')}</div> </div> <div class="ecommerce-product-variants-block"> <div data-is="item-complex-variant" if="{!opts.loader}" class="ecommerce-product-variants-item" each="{variant, index in state.variants}" variant="{variant}" key="{variant.id}" store="{$store}" index="{index}" modal="{tag.opts.modal}"></div> <div class="variants-placeholder" if="{opts.loader}" each="{option in [1, 2, 3, 4]}"> <div class="ecommerce-product--loading flexbe-placeholder small-placeholder"></div> </div> </div> </div>',"",'class="ecommerce-product-complex-variant {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.$store=this.opts.store,this.state={get variants(){return t.$state.item.variants},get options(){return t.$state.item.options},get usePriceOld(){return t.$state.item.use_price_old}},this.meta={sprite:at("ecommerce","admin")},this.usePriceOld=function(e){this.$store.commit("setField","use_price_old",e),this.update()}.bind(this),this.massActions=function(e){e.preventDefault(),e.stopPropagation(),t.opts.modal?.disable();var s,i;s={store:t.$store,onConfirm:()=>{t.opts.modal?.enable()}},Zs.create({overlay:!0,shadow:!1,handle:!1,title:tr("admin::ecommerce::variants::mass_actions"),width:400,...i,riotTag:"ecommerce-variant-mass-actions-modal",props:s,onClose:()=>{s.onConfirm&&s.onConfirm(!1)}})}.bind(this)}));const Nl={css:null,exports:{setup(e){this.$store=e.props.store,this.state={get item(){var t;return null!=(t=e.$store.state.item)?t:[]},get isSimpleVariant(){var e;const t=1===this.item.variants.length,s=!(null!=(e=this.item.variants[0])&&e.option_values.length);return t&&s},get id(){return this.item.id}}},addOption(){var e;null==(e=this.props.modal)||e.disable();var t,s;t={onSave:this.updateOptionsList,store:this.$store,onConfirm:()=>{var e;null==(e=this.props.modal)||e.enable()}},Zs.create({overlay:!0,shadow:!1,handle:!1,title:tr("admin::ecommerce::option::add_title"),width:406,...s,riotTag:"ecommerce-option-edit-modal",props:{mode:"add",...t},onClose:()=>{t.onConfirm&&t.onConfirm(!1)}})},updateOptionsList(e){this.$store.commit("addOptions",e.option),this.update()}},template:(e,t,s,i)=>e('<div expr1357="expr1357" is="proxy" data-is="ecommerce-product-simple-variant"></div><div expr1358="expr1358" is="proxy" data-is="ecommerce-product-complex-variant"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["ecommerce-product-variants-setting ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.state.isSimpleVariant,redundantAttribute:"expr1357",selector:"[expr1357]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.props.store},{type:t.ATTRIBUTE,name:"loader",evaluate:e=>e.props.loader},{type:t.ATTRIBUTE,name:"add-option",evaluate:e=>e.addOption}]}])},{type:s.IF,evaluate:e=>!e.state.isSimpleVariant,redundantAttribute:"expr1358",selector:"[expr1358]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.props.store},{type:t.ATTRIBUTE,name:"loader",evaluate:e=>e.props.loader},{type:t.ATTRIBUTE,name:"add-option",evaluate:e=>e.addOption},{type:t.ATTRIBUTE,name:"modal",evaluate:e=>e.props.modal}]}])}]),name:"ecommerce-product-variants-setting"};e(Nl.name,Nl);const Ml=`var${Ge()}`;class Dl extends oo{constructor(...e){super(...e),this.loadStateRoute=e=>{const t=e.id,s=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/${t}/`;return t?s:""},this._state={saved:!0,item:{name:"",description:"",visible:1,images:[],categories:[],options:[],display_image:"product",default_variant_id:Ml,use_price_old:0,variants:[{id:Ml,option_values:[],vendor_code:"",quantity:null,price:null,price_old:null,default_image_id:null,images:[],visible:1,is_default:1,allow_negative_order:0}]}},this.getters={product:()=>{var e;return null!=(e=this.state.item)?e:{}}},this.helpers={generatorVariants:(e,t)=>1===e.length?e[0].map((e=>{const s=[e];return 1===this.state.item.options.length?this.helpers.fillingVariants(s,t):s})):e.shift().map((s=>this.helpers.generatorVariants([...e],t).map((i=>{const a=[s,...i];return this.state.item.options.length-1===e.length?this.helpers.fillingVariants(a,t):a})))).flat(),fillingVariants:(e,t)=>{let s={id:`var${Ge()}`,option_values:e,vendor_code:"",quantity:null,price:null,price_old:null,is_default:0,default_image_id:null,images:[],visible:1,common:0,allow_negative_order:0};return t.some(((i,a)=>{const n=i.option_values.map((e=>{const t={option_id:e.option_id,value_id:e.value_id};return Object.entries(t).toString()})),r=e.map((e=>Object.entries(e).toString())),o=n.filter((e=>r.includes(e))),l=i.option_values.length===o.length,d=e.length===o.length;return!(!l&&!d)&&(s=i,["price_old","price","quantity"].forEach((e=>{s[e]=i[e]?i[e]:null})),s.option_values=e,t.splice(a,1),!0)})),s},transformationOptions:e=>e.map((e=>e.values.map((t=>({option_id:e.id,value_id:t.id}))))),startGeneratorVariants:()=>{const e=bt(this.state.item.variants);if(this.state.item.options.length){const t=this.helpers.transformationOptions(this.state.item.options);return this.helpers.generatorVariants(t,e)}const t=e[0];return e[0].visible=1,t.option_values=[],[t]},deleteSpace(e){e.name=e.name.trim(),e.description=e.description.trim()},fixData(e){e.options.length||(e.display_image="product")}},this.mutations={setItem:e=>{this.state.item=e},setField:(e,t)=>{this.state.item[e]=t,this.state.saved=!1},setFieldVariant:({name:e,value:t,index:s})=>{s<0||s>=this.state.item.variants.length||(this.state.item.variants[s][e]=t,this.state.saved=!1)},setFieldVariantAll:({name:e,value:t})=>{this.state.item.variants.forEach((s=>{s.visible&&(s[e]=t)})),this.state.saved=!1},setFieldVariantDefault:({value:e,index:t})=>{if(!(t<0||t>=this.state.item.variants.length))if(this.mutations.setFieldVariant({name:"is_default",index:t,value:e}),e&&this.state.item.default_variant_id){const e=this.state.item.variants[t].id;this.state.item.variants.forEach(((e,t)=>{e.id===this.state.item.default_variant_id&&this.mutations.setFieldVariant({name:"is_default",index:t,value:0})})),this.mutations.setField("default_variant_id",e)}else e||(this.mutations.setFieldVariant({name:"is_default",index:0,value:1}),this.mutations.setField("default_variant_id",this.state.item.variants[0].id))},setOptions:(e,t)=>{e<0||e>=this.state.item.options.length||(this.state.saved=!1,this.state.item.options[e]=t,this.mutations.generatorVariants())},removeVariantImg:e=>{this.state.saved=!1,this.state.item.variants.forEach((t=>{e.f_id?t.images=t.images.filter((t=>t.f_id!==e.f_id)):t.images=t.images.filter((t=>t.img_id!==e.id))}))},addOptions:e=>{this.state.item.options.push(e),this.state.saved=!1,this.mutations.generatorVariants()},deleteOption:e=>{this.state.item.options.splice(e,1),this.state.saved=!1,this.mutations.generatorVariants()},generatorVariants:()=>{this.state.item.variants=this.helpers.startGeneratorVariants(),this.state.saved=!1;this.state.item.variants.some((e=>e.id===this.state.item.default_variant_id))||this.mutations.setFieldVariantDefault({index:0,value:1})},fixData:()=>{this.state.item.images?this.state.item.images=this.state.item.images.filter((e=>e)):this.state.item.images=[],this.state.item.variants&&this.state.item.variants.forEach((e=>{e.images?e.images=e.images.filter((e=>e)):e.images=[]})),this.helpers.fixData(this.state.item)}},this.actions={createProduct:async()=>{this.helpers.deleteSpace(this.state.item),this.helpers.fixData(this.state.item);try{return await this.api.createProduct(this.state.item),!0}catch(e){return toast.error(e.message),!1}},updateProduct:async()=>{this.helpers.deleteSpace(this.state.item),this.helpers.fixData(this.state.item);try{return await this.api.updateProduct(this.state.item.id,this.state.item),this.state.saved=!0,!0}catch(e){return toast.error(e.message),!1}},deleteProduct:async()=>{try{return await this.api.deleteProduct({id:[this.state.item.id]}),!0}catch(e){return toast.error(e.message),!1}},restoreProduct:async()=>{try{return await this.api.restoreProduct({id:[this.state.item.id]}),!0}catch(e){return toast.error(e.message),!1}}},this.api={async getProduct(e){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/${e}/`;return(await ai(t)).data},async createProduct(e={}){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/add/`;return(await ii(t,{asJson:!0,data:e})).data},async updateProduct(e,t={}){const s=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/${e}/update/`;return(await ii(s,{asJson:!0,data:t})).data},async deleteProduct(e={}){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/bulk/remove/`;return(await ni(t,{asJson:!0,data:e})).data},async restoreProduct(e={}){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/bulk/restore/`;return(await ii(t,{asJson:!0,data:e})).data}}}onAfterUpdate(){this.mutations.generatorVariants(),this.mutations.fixData()}}const Vl={css:null,exports:{setup(e,{initMobx:t,inject:s}){t(),this.modal=s("modal"),this.$store=new Dl(null,"ProductItemStore"),this.isManager="manager"===flexbe.vars.user.role,this.error=!1,this.state={sprite:at("ecommerce","admin"),isLoading:!0,savingState:!1,disableSave:!1,get storeSaved(){return e.$state.saved},get product(){return e.$state.item},get complex(){var t;const s=e.$state.item.variants.length>1,i=!(null==(t=e.$state.item.variants[0])||!t.option_values.length);return s||i},get data(){return{mode:e.props.mode}},list:{title:"edit"===e.props.mode?tr("admin::ecommerce::product::modal_edit_title"):tr("admin::ecommerce::product::modal_add_title"),content:[{title:tr("admin::ecommerce::product::menu_common"),block:"ecommerce-product-common-settings",show:!0},{title:tr("admin::ecommerce::product::menu_price_variants"),block:"ecommerce-product-variants-setting",show:!0}],buttons:[{title:"add"===e.props.mode?tr("admin::ecommerce::product::add"):tr("main::button::save"),hide:this.isManager,get class(){let t=e.state.isLoading||e.state.storeSaved?"is-secondary":"is-primary";return"success"===e.state.savingState&&(t="is-primary is-success"),`filled large rounded save-button ${t}`},get disabled(){return e.state.disableSave||e.state.isLoading},get loading(){return e.state.savingState},handler:()=>{if(this.state.isLoading||this.state.savingState)return!1;this.handlerSave()}},{title:"add"===e.props.mode?tr("main::button::cancel"):tr("main::button::close"),class:this.isManager?"large rounded ml-auto":"large rounded",handler:()=>{e.modal.cancel()}},{title:tr("admin::ecommerce::product::delete"),hide:"add"===e.props.mode||this.isManager,class:"is-danger style-text coloring ml-auto",handler:e=>{if(this.state.isLoading||this.state.savingState)return!1;this.handlerDelete(e)}}]}},this.watch={"state.complex":()=>{this.update(),this.modal.updatePosition()},"state.storeSaved":e=>{e?this.modal.saved():this.modal.unsaved()}},this.$store.on("commit",(()=>this.update())),this.$store.on("extendState",(()=>this.update())),this.$store.on("extendMeta",(()=>this.update())),this.$store.on("updateState",(()=>this.update())),this.$store.init()},async onMounted(){this.$store.on("disableSave",(()=>{this.state.disableSave=!0,this.update()})),this.$store.on("enableSave",(()=>{this.state.disableSave=!1,this.update()})),this._hotkeysDisposer=fs.register([{hotkeys:["cmd_s"],handlerDown:()=>this.handlerSave()}]),"edit"===this.props.mode?await this.$store.loadState({id:this.props.productId}):"add"===this.props.mode&&this.props.product&&this.$store.commit("setItem",this.props.product),this.state.isLoading=!1,this.update()},onUnmounted(){this.$store.off("commit"),this.$store.off("extendState"),this.$store.off("extendMeta"),this.$store.off("updateState"),this.$store.off("disableSave"),this.$store.off("enableSave"),this._hotkeysDisposer&&this._hotkeysDisposer()},async handlerSave(){const e=$(this.root).find(".flexbe-button.save-button");if(this.$store.trigger("checkError",(e=>{this.error=e})),this.error)return this.shakeEvent(e),toast.error(this.error.message),!1;this.state.savingState="pending",this.update();const t="add"===this.props.mode,s=t?"createProduct":"updateProduct";if(await this.$store.dispatch(s)){const e=t?"onSave":"onChange";await this.props[e](),this.updateCategoryList(),t?(toast.success(tr("admin::ecommerce::product::create_toast")),this.modal.close()):(this.state.savingState="success",this.update(),setTimeout((()=>{this.state.savingState=!1,this.update()}),650))}else this.shakeEvent(e),this.state.savingState=!1,this.update()},shakeEvent(e){e.removeClass("shake-animation"),e.outerWidth(),e.addClass("shake-animation")},handlerDelete(e){var t;e.stopPropagation(),e.preventDefault(),null==(t=this.modal)||t.disable();const s=this.state.product.name;As({props:{icon:`${this.state.sprite}#remove_product`,title:tr("admin::ecommerce::product::delete_confirm_title",{name:s}),text:tr("admin::ecommerce::product::delete_confirm_text"),confirmButtonText:tr("main::button::confirm"),confirmButtonClass:"is-danger bordered colored",cancelButton:!0,onConfirm:async()=>{var e;await this.$store.dispatch("deleteProduct")&&(await this.props.onChange(),this.updateCategoryList(),null==(e=this.modal)||e.close())},onDone:()=>{var e;return null==(e=this.modal)?void 0:e.enable()}},onClose:()=>{var e;return null==(e=this.modal)?void 0:e.enable()},overlay:!1,clickOut:!0,shadow:!1})},async updateCategoryList(){const e=adminStore.getModule("ecommerce/categories");await e.dispatch("getCategoryList")}},template:(e,t,s,i)=>e('<div expr1106="expr1106" is="block-scrollable_menu"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["ecommerce-product-edit-modal ",e.classNames({"ecommerce-product-complex":e.state.complex})," ",e.props.class].join("")},{type:t.ATTRIBUTE,name:"tabindex",evaluate:e=>"0"},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>"pending"===e.state.savingState},{type:t.ATTRIBUTE,name:"locked",evaluate:e=>e.isManager?"locked":""}]},{type:s.TAG,getComponent:i,evaluate:e=>"block-scrollable_menu",slots:[],attributes:[{type:t.ATTRIBUTE,name:"store",evaluate:e=>e.$store},{type:t.ATTRIBUTE,name:"modal",evaluate:e=>e.modal},{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.state.data},{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.state.list},{type:t.ATTRIBUTE,name:"loader",evaluate:e=>e.state.isLoading},{type:t.ATTRIBUTE,name:"maxHeightBy",evaluate:e=>e.modal.$modal[0]}],redundantAttribute:"expr1106",selector:"[expr1106]"}]),name:"ecommerce-product-edit-modal"};function Ol(e,t){return Zs.create({overlay:!0,shadow:!0,handle:!1,closeButton:!1,component:"ecommerce-product-edit-modal",...t,props:{mode:"add",...e}})}function zl(e,t){return Zs.create({overlay:!0,shadow:!0,handle:!1,closeButton:!1,component:"ecommerce-product-edit-modal",...t,props:{mode:"edit",...e},onClose:()=>{e.onClose&&e.onClose()}})}e(Vl.name,Vl),riot3.tag2("ecommerce-option-edit-modal",'<div class="flexbe-modal-content"> <div class="row"> <div class="col col-12"> <div class="flexbe-title"> {state.fields.name.label} </div> <div data-is="flexbe-input" type="{state.fields.name.type}" placeholder="{tr(\'admin::ecommerce::option::name_placeholder\')}" riot-value="{state.fields.name.value}" error="{state.error.name}" error-text="{state.error.text}" oninput="{state.fields.name.onchange}" autofocus="{true}"></div> </div> </div> <div class="row"> <div class="col col-12"> <div class="flexbe-title"> {tr(\'admin::ecommerce::option::type\')} </div> <div data-is="flexbe-buttons-line" class="is-group" role="radio" riot-value="{state.type}" list="{meta.tabs}" sprite="{meta.sprite}" onchange="{selectTab}"></div> </div> </div> <div class="row"> <div class="col col-12" ref="list"> <div class="flexbe-title"> {tr(\'admin::ecommerce::option::variants\')} </div> <div class="flexbe-field-line empty-placeholder {\'error\': state.error.notVariants} mb10" if="{!state.option.values.length}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{meta.sprite}#empty_variants"></use> </svg> <div class="flexbe-text"> {tr(\'admin::ecommerce::option::not_variants\')} </div> </div> <div if="{state.option.values.length}" data-is="flexbe-sort-list" class="field-list py10 mt-10" handle-selector=".draggable" item-selector=".flexbe-field-item" sortend="{sortVariants}"> <div class="flexbe-field-item flexbe-field-line field-index-{index}" each="{variant, index in tag.state.option.values}" key="{variant.id}" data-id="{variant.id}" field-index="{index}"> <div class="draggable"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{tag.meta.sprite}#drag"></use> </svg> </div> <div if="{tag.state.option.data.type === color}" class="ecommerce-option-edit--color-picker" data-is="flexbe-tooltip" content="{tr(\'admin::ecommerce::option::color_tip\')}" variant="{variant}" index="{index}"> <div data-is="flexbe-color-item" class="circle" riot-value="{opts.variant.data.color}" position="{[\'end_around\', \'center\']}" set-color="{tag.setVariantColor.bind(tag, opts.index)}" colors="{tag.meta.colors}" modal="{tag.opts.modal}"></div> </div> <div class="field-name"> <label data-is="flexbe-input" class="transparent w100" placeholder="{tag.state.placeholderVariant}" error="{variant.error}" error-text="{tag.state.error.text}" riot-value="{variant.name}" oninput="{tag.inputVariant.bind(tag, index)}" onchange="{tag.changeVariant.bind(tag, index)}"></label> </div> <div class="flexbe-icon size-16 field-remove ml5" title="{tr(\'editor::form::field_delete_button\')}" onclick="{tag.deleteVariant.bind(tag, index)}"> <svg> <use riot-xlink:href="{tag.meta.sprite}#action_delete"></use> </svg> </div> </div> </div> </div> <div class="col col-12"> <div if="{state.addValue}" class="flexbe-button style-text medium add-ecommerce-option--variant" onclick="{addVariant}"> <svg class="flexbe-icon size-12"> <use riot-xlink:href="{tag.meta.sprite}#plus"></use> </svg> <span class="flexbe-text">{tr(\'admin::ecommerce::option::add_variant\')}</span> </div> <div if="{!state.addValue}" class="flexbe-bar has-line"> <raw content="{tr(\'admin::ecommerce::option::max_combination\')}"></raw> <q data-is="flexbe-tooltip" content="{tr(\'admin::ecommerce::option::max_combination_tip\')}"></q> </div> </div> </div> <hr class="mb20 mt10"> <div class="row"> <div class="col col-12"> <div class="flexbe-title"> {tr(\'admin::ecommerce::option::display\')} </div> <div class="style-list flexbe-preview-list style-arrow fill-bg"> <div each="{widget_type in meta.widget_types}" if="{widget_type.show}" class="preview-outer {active: state.option.data.widget_type === widget_type.value}" data-style="{widget_type.value}" onclick="{setWidgetType.bind(this, widget_type)}"> <img riot-src="/_s/images/admin/ecommerce/option/{widget_type.image}" class="widget_type-style"> </div> </div> </div> </div> <hr class="my20"> <div class="row"> <div class="col col-12"> <div class="flexbe-button filled is-primary mr10 {\'loading\': state.saving}" onclick="{onSave}"> <span class="flexbe-text" if="{state.mode === \'add\'}"> {tr(\'admin::ecommerce::option::add\')} </span> <span class="flexbe-text" if="{state.mode !== \'add\'}"> {tr(\'main::button::apply\')} </span> </div> <div class="flexbe-button filled default" onclick="{modalClose}"> <span class="flexbe-text"> {tr(\'main::button::cancel\')} </span> </div> </div> </div> </div>',"",'class="ecommerce-option-edit-modal {opts.class}"',(function(e){this.mixin("initMobx");const t=e=>Pe(e,"dark","light"),s=this;this.$store=this.opts.store,this.state={saving:!1,error:{name:!1,notVariants:!1,variant:!1,text:tr("main::error::fill_field")},mode:e.mode??"edit",option:null,fields:[],get index(){return s.opts.index},get type(){return this.option.data.type??"list"},get placeholderVariant(){return"color"===this.type?tr("admin::ecommerce::option::variant_color_placeholder"):tr("admin::ecommerce::option::variant_list_placeholder")},get variants(){return s.$state.item.variants??[]},get options(){return s.$state.item.options??[]},get addValue(){let e=1;return this.options.forEach(((t,s)=>{s!==+this.index&&(e*=t.values.length)})),e*=this.option.values.length+1,(Math.floor(100/e)||e<50)&&!(e>100)}},this.meta={sprite:at("ecommerce","admin"),tabs:[{value:"list",title:tr("admin::ecommerce::option::tab_list")},{value:"color",title:tr("admin::ecommerce::option::tab_color"),icon:"tab_color"}],widget_types:[{value:"vertical_list",get image(){return"color"===s.state.option.data.type?"color_type_1.png":"list_type_1.png"},show:!0},{value:"vertical_block",get image(){return"color"===s.state.option.data.type?"color_type_2.png":"list_type_3.png"},show:!0},{value:"horizon_block",get image(){return"color"===s.state.option.data.type?"color_type_3.png":"list_type_2.png"},show:!0},{value:"radio",image:"color_type_4.png",get show(){return"color"===s.state.option.data.type}}],colors:["#FFFFFF","#000000"]},this.normalizeData=function(){const t=this.state,s=[{id:`var${Ge()}`,name:tr("admin::ecommerce::option::variant_example",{count:1}),data:{color:"#EF4D1E",contrast:"light"},error:!1},{id:`var${Ge()}`,name:tr("admin::ecommerce::option::variant_example",{count:2}),data:{color:"#0EA959",contrast:"light"},error:!1}];t.option={id:`id${Ge()}`,name:"",data:{type:"list",widget_type:"vertical_list"},values:t.variants.length>50?[s[0]]:s,...bt(e.option)}}.bind(this);this.createFields=function(){const e=((e,t)=>{const i=vt({get value(){return s.state.option[e]??""},set value(t){s.state.option[e]=t}},t);return new Hl(e,i)})("name",{label:tr("admin::ecommerce::option::name"),get value(){return s.state.option.name??""},set value(e){s.state.option.name=e,s.state.error.name=!1,s.modalUnsaved()}});this.state.fields={name:e}}.bind(this),this.selectTab=function(e){this.state.option.data.type=e.value,"list"===this.state.option.data.type&&"radio"===this.state.option.data.widget_type&&(this.state.option.data.widget_type="horizon_block"),this.update()}.bind(this),this.addVariant=function(){const e=this.state.option.values,s=["#EF4D1E","#0EA959","#5452FE"],i=this.state.option.values.length>=s.length?"#000000":s[this.state.option.values.length];if(this.state.error.notVariants=!1,e.length&&""===e[e.length-1].name)return this.focusInput(e),!1;this.state.option.values.push({id:`var${Ge()}`,name:"",data:{color:i,contrast:t(i)},error:!1}),this.modalUnsaved(),this.update(),this.focusInput(e)}.bind(this),this.focusInput=function(e){const t=$(this.refs.list).find(`.field-index-${e.length-1} input`);t.length&&t[0].focus()}.bind(this),this.inputVariant=function(e,t){this.state.option.values[e].name=t.target.value,this.state.option.values[e].error=!1}.bind(this),this.changeVariant=function(e,t){this.state.option.values[e].name=t.target.value.trim(),this.modalUnsaved(),this.update()}.bind(this),this.deleteVariant=function(e){this.state.option.values.splice(e,1),this.modalUnsaved(),this.update()}.bind(this),this.setVariantColor=function(e,s){this.state.option.values[e].data.color=s.value,this.state.option.values[e].data.contrastFixed=t(s.value),this.modalUnsaved(),this.update()}.bind(this),this.setWidgetType=function(e){this.state.option.data.widget_type=e.value,this.update()}.bind(this),this.sortVariants=function({oldIndex:e,newIndex:t}){if(e===t)return;const s=this.state.option.values;s.splice(t,0,s.splice(e,1)[0]),this.modalUnsaved(),this.update()}.bind(this),this.checkErrors=function(){this.state.option.values.length||(this.state.error.notVariants=!0),this.state.option.values.length&&(this.state.option.values.map((e=>{e.name||(e.error=!0)})),this.state.error.variant=this.state.option.values.some((e=>e.error))),this.state.error.name=""===this.state.fields.name.value;return this.state.error.name||this.state.error.notVariants||this.state.error.variant}.bind(this),this.onSave=function(){if(this.state.saving)return!1;const e=$(this.root).find(".flexbe-button.is-primary");if(this.checkErrors())return e.removeClass("shake-animation"),e[0].offsetWidth,e.addClass("shake-animation"),!1;this.state.saving=!0,this.opts.onSave({index:this.opts.index,option:this.state.option}),this.modalSaved(),this.modalClose()}.bind(this),this.modalSaved=function(){e.modal?.saved()}.bind(this),this.modalClose=function(){e.modal?.close()}.bind(this),this.modalUnsaved=function(){this.$store.trigger("modalOptionUnsaved")}.bind(this),this.onBeforeMount=function(){this.createFields(),this.normalizeData()}.bind(this),this.onMounted=function(){this.$store.on("modalOptionUnsaved",(()=>{this.opts.modal?.unsaved()}))}.bind(this),this.onUnmounted=function(){this.$store.off("modalOptionUnsaved",(()=>{}))}.bind(this)})),riot3.tag2("flexbe-color-item",'<div class="color-picker--item" riot-style="background: {state.value}" onclick="{showPicker}"></div>',"",'class="flexbe-color-item {opts.class}"',(function(e){let t=null;this.state={get value(){return e.riotValue||e.active||"#000000"}},this.watch={"state.value":[e=>{t?.updateState({value:e})}]},this.showPicker=function(s){s.stopPropagation(),t=new vn({value:this.state.value,opacity:e.opacity},{showOpacity:e.opacity||0===e.opacity,modalItem:this.root,modalPosition:e.position??["center","center"]}),t.on("apply_color",(t=>{e.setColor({value:t,extend:!0})})),t.render()}.bind(this)})),riot3.tag2("ecommerce-variant-edit-modal",'<div class="flexbe-modal-content"> <div class="ecommerce-variant-edit_option"> <div class="flexbe-list-item" each="{option in state.options}"> <div class="flexbe-text ecommerce-variant-edit_option-name">{option.nameOption}</div> <div class="ecommerce-variant-edit_option-value"> <div class="ecommerce-variant-edit_option-color {\'type-color\': state.hasColorType}"> <span if="{option.typeOption === \'color\'}" riot-style="background-color: {option.value}"></span> </div> <span class="flexbe-text">{option.valueName}</span> </div> </div> </div> <div class="ecommerce-variant-edit_visible mt20"> <label data-is="flexbe-input" type="{state.fields.visible.type}" checked="{state.fields.visible.value}" onchange="{state.fields.visible.onchange}"> <span class="flexbe-text">{tag.state.fields.visible.label}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::ecommerce::variant::toggle_visible_tip\')}"></q> </label> </div> <div class="flexbe-field-group" disabled="{state.fields.visible.value}"> <div class="ecommerce-variant-edit_image-title"> <div class="flexbe-text text-bold"> {meta.imageLabel[state.displayImage].title} </div> <q data-is="flexbe-tooltip" content="{meta.imageLabel[state.displayImage].tip}"></q> <div class="ecommerce-variant-edit_image-button" if="{state.displayImage === \'product\'}" onclick="{editProductImages}">{tr(\'admin::ecommerce::variants_edit::image_edit\')}</div> </div> <div class="ecommerce-variant-edit_content"> <div if="{state.displayImage === \'product\' && !state.mediaItem.length}" class="ecommerce-variant-edit_def-image"> <svg class="flexbe-icon size-16"> <use riot-href="{state.sprite}#not_image"></use> </svg> <div class="flexbe-text text-s">{tr(\'admin::ecommerce::variants_edit::not_upload_images\')}</div> </div> <div if="{state.displayImage === \'product\' && state.mediaItem.length}" key="{file.unq_id}" class="ecommerce-variant-edit_container selected-image {\'select\': (state.defaultImageId === file.unq_id)}" each="{file, index in state.mediaVariant}" onclick="{checkMedia.bind(tag, file, index)}"> <div class="ecommerce-variant-edit_check-mark rounded"> <svg class="flexbe-icon size-10"> <use riot-href="{state.sprite}#check_mark"></use> </svg> </div> <div class="ecommerce-variant-edit_image" if="{file.ext}" riot-style="background-image: url({tag.getImageUrl(file)})"></div> <div class="ecommerce-variant-edit_image" if="{file.f_name_info}" style="background-image: url(\'/images/admin/ecommerce/placeholder.png\')"></div> </div> <div if="{state.displayImage === \'variant\'}" class="display-flex flex-wrap" data-is="flexbe-sort-list" item-selector=".ecommerce-variant-edit_container" handle-selector=".ecommerce-variant-edit_container" group="{state.mediaVariant}" options="{{ preventOnFilter: false }}" sortend="{sortedMedia}" sprite="{state.sprite}" loader="{opts.loader}"> <div key="{file.unq_id}" class="ecommerce-variant-edit_container" each="{file in opts.group}"> <a href="{tag.getOriginUrl(file)}" target="_blank" if="{!file.loading}" class="w100 h100"> <div class="ecommerce-variant-edit_overlay"> <div class="ecommerce-variant-edit_image-delete" onclick="{tag.deleteMedia.bind(tag, file)}"> <svg class="flexbe-icon size-10"> <use riot-href="{opts.sprite}#close"></use> </svg> </div> </div> <div class="ecommerce-variant-edit_image" if="{file.ext}" riot-style="background-image: url({tag.getImageUrl(file)})"></div> <div class="ecommerce-variant-edit_image" if="{file.f_name_info}" style="background-image: url(\'/images/admin/ecommerce/placeholder.png\')"></div> </a> <div if="{file.loading}" class="ghost-image"> <div class="overlay-loader"> <span data-is="proxy" is="flexbe-loader" class="color-inherit"></span> </div> </div> </div> <div if="{!tag.opts.loader && !tag.meta.loading.length}" data-is="flexbe-media-upload" type="image" multi="true" on-uploaded="{tag.uploadedMedia}" on-upload-start="{tag.onUploadStart}" on-uploaded-error="{tag.onUploadedError}" icon="{false}" loader="{true}" overlay="{true}" show-overlay="{true}" class="big rounded mb15"></div> </div> </div> <div class="ecommerce-variant-edit_block mb20"> <div class="ecommerce-variant-edit_input"> <div class="flexbe-title"> {state.fields.price.label} </div> <div data-is="flexbe-input" type="{state.fields.price.type}" placeholder="{state.fields.price.placeholder}" riot-value="{state.fields.price.value}" oninput="{state.fields.price.onchange}" normalize="{state.fields.price.normalize}"></div> </div> <div if="{!state.usePriceOld}" class="show-old-price flexbe-button style-text medium" onclick="{usePriceOld.bind(this, true)}"> <svg class="flexbe-icon size-12"> <use riot-href="{state.sprite}#plus"></use> </svg> <span class="flexbe-text text-s">{tr(\'admin::ecommerce::variants::add_old_price\')}</span> </div> <div class="ecommerce-variant-edit_input" if="{state.usePriceOld}"> <div class="container_hide-old-price"> <span class="flexbe-text text-medium">{state.fields.priceOld.label}</span> <span class="hide-old-price flexbe-text text-shade-30" onclick="{usePriceOld.bind(this, false)}"> <svg class="flexbe-icon size-10"><use riot-href="{state.sprite}#close"></use></svg> </span> </div> <div data-is="flexbe-input" ref="oldPrice" class="flexbe-input {\'old-price\': state.fields.priceOld.value}" type="{state.fields.priceOld.type}" placeholder="{state.fields.priceOld.placeholder}" riot-value="{state.fields.priceOld.value}" error="{state.fields.priceOld.error}" error-tip="{state.fields.priceOld.errorText}" oninput="{state.fields.priceOld.onchange}" normalize="{state.fields.priceOld.normalize}" onblur="{checkError}"></div> </div> </div> <div class="ecommerce-variant-edit_block mb20"> <div class="ecommerce-variant-edit_input"> <div class="flexbe-title"> {state.fields.quantity.label} </div> <div data-is="flexbe-input" ref="quantity" class="flexbe-input {\'quantity_infinity\': state.fields.infinity.value}" type="{state.fields.quantity.type}" placeholder="{state.fields.infinity.value ? \'\' : state.fields.quantity.placeholder}" riot-value="{state.fields.infinity.value ? \'\' : state.fields.quantity.value}" oninput="{state.fields.quantity.onchange}" normalize="{state.fields.quantity.normalize}" readonly="{state.fields.infinity.value}" disabled="{state.fields.infinity.value}"></div> </div> <div class="ecommerce-variant-edit_toggle"> <label data-is="flexbe-input" type="{state.fields.infinity.type}" checked="{state.fields.infinity.value}" onchange="{state.fields.infinity.onchange}"> <span class="flexbe-text">{tag.state.fields.infinity.label}</span> </label> </div> </div> <div class="ecommerce-variant-edit_vendor-code mb20"> <div class="flexbe-title"> {state.fields.vendorCode.label} </div> <div class="col col-12"> <div data-is="flexbe-input" type="{state.fields.vendorCode.type}" placeholder="{state.fields.vendorCode.placeholder}" riot-value="{state.fields.vendorCode.value}" oninput="{state.fields.vendorCode.onchange}" onblur="{inputBlurVendorCode}"></div> </div> </div> <div class="ecommerce-variant-edit_default"> <label data-is="flexbe-input" type="{state.fields.isDefault.type}" checked="{state.fields.isDefault.value}" onchange="{state.fields.isDefault.onchange}" disabled="{state.fields.isDefault.value && state.firstVariant}" locked="{state.fields.isDefault.value && state.firstVariant}"> <span class="flexbe-text">{tag.state.fields.isDefault.label}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::ecommerce::variant::toggle_common_tip\')}"></q> </label> </div> </div> <div class="flexbe-button filled is-primary" onclick="{onSave}"> <span class="flexbe-text"> {tr(\'main::button::done\')} </span> </div> </div>',"",'class="ecommerce-variant-edit-modal {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.$store=this.opts.store,this.state={error:!1,index:e.index,fields:[],sprite:at("ecommerce","admin"),get firstVariant(){return 0===this.index},get variant(){return t.props.variant},get item(){return t.$state.item},get mediaItem(){return this.item?.images??[]},get displayImage(){return this.item?.display_image??"product"},get mediaVariant(){return"product"===this.displayImage?this.mediaItem??[]:this.variant?.images??[]},get defaultImageId(){return this.variant?.default_image_id&&this.mediaVariantIds.includes(this.variant?.default_image_id)?this.variant.default_image_id:this.mediaVariant.length?this.mediaVariant[0]?.unq_id:null},get mediaVariantIds(){return this.mediaVariant.map((e=>e?.unq_id))??[]},get usePriceOld(){return this.item.use_price_old},get optionsItem(){return this.item.options??[]},get variantOption(){return this.variant?.option_values??[]},get options(){let e=[];return this.variantOption.forEach((t=>{const s=this.optionsItem.filter((e=>e.id===t.option_id))[0],i=s.values.filter((e=>e.id===t.value_id))[0];e.push({nameOption:s.name,typeOption:s.data.type,valueName:i.name,value:i.value})})),e},get hasColorType(){return this.options.some((e=>"color"===e.typeOption))}},this.meta={loading:[],quantity:-1!==t.state.variant.quantity?t.state.variant.quantity:null,imageLabel:{product:{title:tr("admin::ecommerce::variants_edit::images_product_title"),tip:tr("admin::ecommerce::variants_edit::images_product_tip")},variant:{title:tr("admin::ecommerce::variants_edit::images_variant_title"),tip:tr("admin::ecommerce::variants_edit::images_variant_tip")}}},this.watch={"state.mediaVariant":[()=>this.update()]};const s=(e,s)=>{const i=vt({get value(){return t.state.variant[e]??""},set value(s){t.$store.commit("setFieldVariant",{name:e,value:s,index:t.state.index})}},s);return new Hl(e,i)},i=(e="")=>e.replace(/[^+\d.,]/g,"");this.createFields=function(){const e=s("price",{label:tr("admin::ecommerce::variants::price"),type:"number",placeholder:"-",normalize:e=>i(e),get value(){return t.state.variant.price??""},set value(e){t.$store.commit("setFieldVariant",{name:"price",value:e,index:t.state.index}),t.state.usePriceOld&&t.checkError()}}),a=s("price_old",{label:tr("admin::ecommerce::variants::old_price"),type:"number",placeholder:"-",error:!1,errorText:"",normalize:e=>i(e),get value(){return t.state.variant.price_old??""},set value(e){t.$store.commit("setFieldVariant",{name:"price_old",value:e,index:t.state.index}),t.error&&t.checkError()}}),n=s("quantity",{label:tr("admin::ecommerce::variants::quantity"),type:"number",placeholder:"0",normalize:e=>i(e),get value(){return t.state.variant.quantity??null},set value(e){t.meta.quantity=e,t.$store.commit("setFieldVariant",{name:"quantity",value:e,index:t.state.index})}}),r=s("infinity",{label:tr("admin::ecommerce::variants::infinity"),type:"toggle",get value(){return-1===t.state.variant.quantity},set value(e){const s=e?-1:t.meta.quantity;t.$store.commit("setFieldVariant",{name:"quantity",value:s,index:t.state.index}),e||t.refs.quantity?.focus()}}),o=s("vendor_code",{label:tr("admin::ecommerce::variants::article"),placeholder:tr("admin::ecommerce::variants::article_placeholder"),get value(){let e=t.state.variant.vendor_code??"";return e&&(e=e.trim()),e},set value(e){t.$store.commit("setFieldVariant",{name:"vendor_code",value:e,index:t.state.index})}}),l=s("visible",{label:tr("admin::ecommerce::variant::toggle_visible"),type:"toggle",get value(){return!t.state.variant.visible},set value(e){t.$store.commit("setFieldVariant",{name:"visible",value:!e,index:t.state.index})}}),d=s("allow_negative_order",{label:tr("admin::ecommerce::variant::toggle_allow_negative_order"),type:"toggle"}),c=s("is_default",{label:tr("admin::ecommerce::variant::toggle_common"),type:"toggle",get value(){return t.state.variant.is_default??!1},set value(e){t.$store.commit("setFieldVariantDefault",{name:"is_default",value:e,index:t.state.index})}});this.state.fields={price:e,priceOld:a,quantity:n,infinity:r,vendorCode:o,visible:l,isDefault:c,allowNegativeOrder:d}}.bind(this),this.loadingImage=function(e,t){t?this.meta.loading.push(e):this.meta.loading=this.meta.loading.filter((t=>t!==e)),this.meta.loading.length?this.$store.trigger("disableSave"):this.$store.trigger("enableSave"),this.update()}.bind(this),this.getImageUrl=function(e){return Vr(e,120)}.bind(this),this.getOriginUrl=function(e){return Vr(e,0)}.bind(this),this.uploadedMedia=function(e,s){const i=bt(this.state.mediaVariant),a=i.findIndex((t=>e===t.unq_id));if(0===s?.id)i.splice(a,1),toast.error(tr("main::error::upload_file"));else{const t=ct(s);i[a]={...t,unq_id:`${e}${(new Date).getTime()}`}}this.loadingImage(e,!1),this.$store.commit("setFieldVariant",{name:"images",value:i,index:t.state.index})}.bind(this),this.onUploadStart=function(e){this.loadingImage(e,!0);const s=bt(this.state.mediaVariant);s.push({unq_id:e,loading:!0}),this.$store.commit("setFieldVariant",{name:"images",value:s,index:t.state.index})}.bind(this),this.onUploadedError=function(e){this.loadingImage(e,!1);let s=bt(this.state.mediaVariant);s=s.filter((t=>e!==t.unq_id)),this.$store.commit("setFieldVariant",{name:"images",value:s,index:t.state.index})}.bind(this),this.sortedMedia=function({oldIndex:e,newIndex:s}){const i=bt(this.state.mediaVariant);i.splice(s,0,i.splice(e,1)[0]),this.$store.commit("setFieldVariant",{name:"images",value:i,index:t.state.index})}.bind(this),this.deleteMedia=function(e,s){s.stopPropagation(),s.preventDefault();let i=bt(this.state.mediaVariant);const a=i.findIndex((t=>t.unq_id===e.unq_id));i.splice(a,1),this.$store.commit("setFieldVariant",{name:"images",value:i,index:t.state.index})}.bind(this),this.checkMedia=function(e){const s=e.unq_id??null;this.$store.commit("setFieldVariant",{name:"default_image_id",value:s,index:t.state.index}),this.update()}.bind(this),this.usePriceOld=function(e){this.$store.commit("setField","use_price_old",e),this.update(),e?this.refs.oldPrice?.focus():(this.state.fields.priceOld.error="",this.state.fields.priceOld.errorText="")}.bind(this),this.editProductImages=function(){this.modalClose();const t=e.modal.options.fromModal.$modal,s=t.find(".content-list.scrollable-content"),i=t.find(".ecommerce-product_container-media");s.animate({scrollTop:0},250),i.removeClass("animation-ripple"),i.offset(),i.addClass("animation-ripple")}.bind(this),this.checkError=function(){0!=+this.state.variant.price_old&&(this.state.fields.priceOld.error=+this.state.variant.price_old<=+this.state.variant.price,this.state.fields.priceOld.errorText=tr("admin::ecommerce::variants::old_price_error"),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.update()}),100))}.bind(this),this.inputBlurVendorCode=function(){let e=t.state.variant.vendor_code;e&&(e=e.trim()),this.meta.isFocus=!1,t.$store.commit("setFieldVariant",{name:"vendor_code",value:e,index:t.state.index}),this.update()}.bind(this),this.onSave=function(){this.modalClose()}.bind(this),this.modalClose=function(){e.modal?.close()}.bind(this),this.onBeforeMount=function(){this.createFields()}.bind(this)})),riot3.tag2("ecommerce-variant-mass-actions-modal",'<div class="flexbe-field-group"> <div class="flexbe-field-item"> <label data-is="flexbe-input" type="{state.fields.use_price.type}" checked="{state.fields.use_price.value}" onchange="{state.fields.use_price.onchange}"> <span class="flexbe-text">{tag.state.fields.use_price.label}</span> </label> <div if="{state.fields.use_price.value}" class="input-holder input-price"> <div data-is="flexbe-input" tabindex="0" type="{state.fields.price.type}" placeholder="{state.fields.price.placeholder}" riot-value="{state.fields.price.value}" oninput="{state.fields.price.onchange}" normalize="{state.fields.price.normalize}"></div> </div> </div> <div class="flexbe-field-item"> <label data-is="flexbe-input" type="{state.fields.use_price_old.type}" checked="{state.fields.use_price_old.value}" onchange="{state.fields.use_price_old.onchange}"> <span class="flexbe-text">{tag.state.fields.use_price_old.label}</span> </label> <div if="{state.fields.use_price_old.value}" class="input-holder input-price-old"> <div data-is="flexbe-input" tabindex="0" type="{state.fields.price_old.type}" placeholder="{state.fields.price_old.placeholder}" riot-value="{state.fields.price_old.value}" oninput="{state.fields.price_old.onchange}" normalize="{state.fields.price_old.normalize}"></div> </div> </div> <div class="flexbe-field-item"> <label data-is="flexbe-input" type="{state.fields.use_vendor_code.type}" checked="{state.fields.use_vendor_code.value}" onchange="{state.fields.use_vendor_code.onchange}"> <span class="flexbe-text">{tag.state.fields.use_vendor_code.label}</span> </label> <div if="{state.fields.use_vendor_code.value}" class="input-holder input-vendor-code"> <div data-is="flexbe-input" tabindex="0" type="{state.fields.vendor_code.type}" placeholder="{state.fields.vendor_code.placeholder}" riot-value="{state.fields.vendor_code.value}" oninput="{state.fields.vendor_code.onchange}"></div> </div> </div> <div class="flexbe-field-item"> <label data-is="flexbe-input" type="{state.fields.use_quantity.type}" checked="{state.fields.use_quantity.value}" onchange="{state.fields.use_quantity.onchange}"> <span class="flexbe-text">{tag.state.fields.use_quantity.label}</span> </label> <div if="{state.fields.use_quantity.value}" class="input-holder input-quantity"> <div data-is="flexbe-input" ref="quantity" tabindex="0" class="input flexbe-input {\'quantity_infinity\': state.fields.infinity.value}" type="{state.fields.quantity.type}" placeholder="{state.fields.infinity.value ? \'\' : state.fields.quantity.placeholder}" riot-value="{state.fields.infinity.value ? \'\' : state.fields.quantity.value}" oninput="{state.fields.quantity.onchange}" normalize="{state.fields.quantity.normalize}" readonly="{state.fields.infinity.value}" disabled="{state.fields.infinity.value}"></div> <label data-is="flexbe-input" class="flexbe-input toggle_infinity" type="{state.fields.infinity.type}" checked="{state.fields.infinity.value}" onchange="{state.fields.infinity.onchange}"> <span class="flexbe-text">{tag.state.fields.infinity.label}</span> </label> </div> </div> </div> <div class="flexbe-field-group flexbe-buttons-line"> <div class="flexbe-button filled is-primary {\'loading\': state.saving}" onclick="{onSave}"> <span class="flexbe-text">{tr(\'main::button::apply\')}</span> </div> <div class="flexbe-button filled default" onclick="{modalClose}"> <span class="flexbe-text">{tr(\'main::button::cancel\')}</span> </div> </div>',"",'class="ecommerce-variant-mass-actions-modal"',(function(e){this.mixin("initMobx");const t=this;this.$store=this.opts.store,this.state={sprite:at("ecommerce","admin"),saving:!1,fields:[],variants:{price:"",price_old:"",quantity:null,vendor_code:""},get item(){return t.$state.item}},this.meta={quantity:null,toggle:{use_price:!1,use_price_old:!1,use_vendor_code:!1,use_quantity:!1}},this.watch={"state.fields.use_price.value":[()=>{setTimeout((()=>{const e=$(t.root).find(".input-price .flexbe-input__text");e.length&&e.focus()}),0)}],"state.fields.use_price_old.value":[()=>{setTimeout((()=>{const e=$(t.root).find(".input-price-old .flexbe-input__text");e.length&&e.focus()}),0)}],"state.fields.use_vendor_code.value":[()=>{setTimeout((()=>{const e=$(t.root).find(".input-vendor-code .flexbe-input__text");e.length&&e.focus()}),0)}],"state.fields.use_quantity.value":[()=>{setTimeout((()=>{const e=$(t.root).find(".input-quantity .flexbe-input__text");e.length&&e.focus()}),0)}]};const s=(e,s)=>{const i=vt({get value(){return t.meta.toggle[e]},set value(s){t.meta.toggle[e]=s}},s);return new Hl(e,i)},i=(e="")=>e.replace(/[^+\d.,]/g,"");this.createFields=function(){const e=s("use_price",{label:tr("admin::ecommerce::variants::price"),type:"toggle"}),a=s("use_price_old",{label:tr("admin::ecommerce::variants::old_price"),type:"toggle"}),n=s("use_vendor_code",{label:tr("admin::ecommerce::variants::article"),type:"toggle"}),r=s("use_quantity",{label:tr("admin::ecommerce::variants::quantity"),type:"toggle"}),o=s("price",{type:"number",placeholder:"-",normalize:e=>i(e),get value(){return t.state.variants.price??""},set value(e){t.state.variants.price=e}}),l=s("price_old",{placeholder:"-",type:"number",error:!1,errorText:"",normalize:e=>i(e),get value(){return t.state.variants.price_old},set value(e){t.state.variants.price_old=e}}),d=s("quantity",{type:"number",placeholder:"0",normalize:e=>i(e),get value(){return t.state.variants.quantity??null},set value(e){t.state.variants.quantity=+e,t.meta.quantity=+e}}),c=s("vendor_code",{placeholder:tr("admin::ecommerce::variants::article_placeholder"),get value(){return t.state.variants.vendor_code??""},set value(e){t.state.variants.vendor_code=e}}),p=s("infinity",{label:tr("admin::ecommerce::variants::infinity"),type:"toggle",get value(){return-1===t.state.variants.quantity},set value(e){t.state.variants.quantity=e?-1:t.meta.quantity}});this.state.fields={price:o,price_old:l,quantity:d,vendor_code:c,infinity:p,use_price:e,use_price_old:a,use_vendor_code:n,use_quantity:r}}.bind(this),this.onSave=function(){if(this.state.saving)return!1;this.state.saving=!0,this.opts.onConfirm(),this.massUpdate(),this.modalClose()}.bind(this),this.massUpdate=function(){this.meta.toggle.use_price_old&&""!==this.state.variants.price_old&&t.$store.commit("setField","use_price_old",!0),["price","price_old","quantity","vendor_code"].forEach((e=>{if(this.meta.toggle[`use_${e}`]){let t=this.state.variants[e];["price","price_old"].includes(e)&&(t=t.replace(/\.$/,"")),this.$store.commit("setFieldVariantAll",{name:e,value:t}),["price","price_old"].includes(e)&&this.$store.trigger("checkErrorOldPrice")}}))}.bind(this),this.modalClose=function(){e.modal?.close()}.bind(this),this.onBeforeMount=function(){this.createFields()}.bind(this)})),riot3.tag2("action-side-menu",'<div class="flexbe-action-buttons"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{opts.sprite}#dots"></use> </svg> <dropdown position="center" direction="bottom" trigger-delay="{0}" trigger="click" autohide="{true}" arrow="{false}" append-to-body="{true}" onopen="{tag.opts.onopen}" onclose="{tag.opts.onclose}" ref="dropdown"> <div class="action-side-menu-dropdown flexbe-list borderless hoverable hoverable-background opacify round-corners"> <label class="flexbe-list-item" onclick="{tag.showEditCategory}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#action_settings"></use> </svg> <span class="flexbe-text">{tr(\'admin::ecommerce::product::category_setting\')}</span> </label> <label class="flexbe-list-item" onclick="{tag.toggleVisibleCategory}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#toggle_show"></use> </svg> <span class="flexbe-text">{tr(\'admin::ecommerce::product::category_show\')}</span> <span data-is="flexbe-input" type="toggle" class="flexbe-input ml-auto" checked="{tag.opts.category.visible}"></span> </label> <label class="flexbe-list-item" onclick="{tag.removeCategory}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#action_delete"></use> </svg> <span class="flexbe-text">{tr(\'main::button::delete\')}</span> </label> </div> </dropdown> </div>',"",'class="action-side-menu {opts.class}"',(function(e){const t=this;this.sprite=at("ecommerce","admin"),this.showEditCategory=function(){!function(e,t){Zs.create({overlay:!0,shadow:!0,handle:!1,title:tr("admin::ecommerce::category::edit_title"),width:450,...t,riotTag:"ecommerce-category-edit-modal",props:{mode:"edit",...e}})}({onSave:this.editCategory,data:this.opts.category}),this.closeDropdown()}.bind(this),this.editCategory=async function(e,t){await this.$store.dispatch("categories/updateCategory",e,t)}.bind(this),this.toggleVisibleCategory=function(t){if(t.stopPropagation(),"INPUT"!==t.target.tagName)return!1;const s=e.category;+t.target.checked?this.showCategory(s):this.hideCategory(s)}.bind(this),this.showCategory=async function(e){await this.$store.dispatch("categories/showCategory",e)}.bind(this),this.hideCategory=async function(e){await this.$store.dispatch("categories/hideCategory",e)}.bind(this),this.removeCategory=function(){const e=t.opts.category.countProducts,s=t.opts.category.name;As({props:{icon:`${t.sprite}#remove_category`,title:tr("admin::ecommerce::category::delete_title",{name:s}),toggleText:e?tr("admin::ecommerce::category::delete_toggle",{count:e}):"",confirmButtonText:tr("main::button::confirm"),confirmButtonClass:"is-danger bordered colored",cancelButton:!0,onConfirm:e=>{const s=t.opts.category.id,i=t.opts.currentItem,a=t.deleteCategory({deleteProducts:e.toggle});return+s==+i&&flexbe.routing.go("/admin/ecommerce/"),a}},clickOut:!0}),this.closeDropdown()}.bind(this),this.deleteCategory=async function(e){const s=t.opts.category.id,i=t.opts.category.name;await this.$store.dispatch("categories/removeCategory",{id:s,deleteProducts:e,name:i}),e.deleteProducts&&await this.$store.dispatch("products/updateProducts")}.bind(this),this.closeDropdown=function(){this.refs.dropdown.trigger("toggleDropdown",!1)}.bind(this)})),riot3.tag2("admin-side-menu-item",'<a href="?page=1&countOnPage={state.countPage}&categories={state.category.id}" class="menu-item {!state.category.visible ? \'menu-item-hidden\' : \'\'} {\'open-dropdown\': inDropdown} {active: (+state.category.id === +opts.currentItem)}"> <span class="draggable"> <svg class="flexbe-icon" viewbox="0 0 6 14" id="draggable"> <path d="M0 0h2v2H0V0zm0 4h2v2H0V4zm0 4h2v2H0V8zm0 4h2v2H0v-2zm4 0h2v2H4v-2zM4 0h2v2H4V0zm0 4h2v2H4V4zm0 4h2v2H4"></path> </svg> </span> <span class="flexbe-text category-item_text">{state.category.name}</span> <div class="category-products-count">{state.category.countProducts}</div> </a> <div class="category-action"> <div data-is="action-side-menu" sprite="{opts.sprite}" category="{state.category}" current-item="{opts.currentItem}" onopen="{onOpenDropdown}" onclose="{onCloseDropdown}"></div> </div>',"",'class="admin-side-menu-item {opts.class}" title="{state.category.name.length > 17 ? state.category.name : \'\'}"',(function(e){const t=this;this.mixin("initMobx"),this.state={get category(){return t.props.category},get countPage(){return t.props.countPage}},this.onOpenDropdown=function(){this.inDropdown=!0,this.update()}.bind(this),this.onCloseDropdown=function(){this.inDropdown=!1,this.update()}.bind(this)})),riot3.tag2("admin-ecommerce-menu",'<div class="side-menu"> <div class="menu-header"> <div class="flexbe-title text-title"> {tr(\'admin::ecommerce::product::title\')} </div> </div> <div class="item-list-outer"> <div class="list-title">{tr(\'admin::ecommerce::category::title\')}</div> <div class="scrollable-content admin-side-menu--scroll"> <a href="?page=1&countOnPage={meta.countOnPage}" class="menu-item {active: !currentQuery}"> <span class="flexbe-text">{tr(\'admin::ecommerce::category::all_products\')}</span> <div class="category-products-count"> {state.allProducts} </div> </a> <div if="{state.list.length}" class="item-list {\'disabled-sorting\': isManager}" data-is="flexbe-sort-list" item-selector=".category-container" handle-selector=".draggable" sortend="{sortedCategory}" group="{state.list}" sprite="{meta.sprite}" current-item="{currentQuery}"> <div class="category-container" id="{item.id}" each="{item in opts.group}"> <div data-is="admin-side-menu-item" category="{item}" sprite="{opts.sprite}" count-page="{tag.meta.countOnPage}" current-item="{opts.currentItem}"></div> </div> </div> </div> </div> <div if="{!isManager}" class="style-link ecommerce-menu__link" onclick="{showAddCategory}"> {tr(\'admin::ecommerce::category::add\')} </div> </div>',"",'class="admin-side-menu admin-ecommerce-menu {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.$store=this.$store.getModule("categories"),this.isManager="manager"===flexbe.vars.user.role,this.state={get list(){return t.$state.items},get allProducts(){return t.$state.allProductsCount}},this.meta={sprite:at("ecommerce","admin"),get query(){return flexbe.routing.query},get countOnPage(){return this.query.countOnPage??25}},this.watch={"state.list":[()=>this.update(),{deep:!0}],"state.allProducts":[()=>this.update()]},this.sortedCategory=async function({oldIndex:e,newIndex:t,item:s}){if(e===t||this.isManager)return;const i=+s.id,a=bt(this.state.list);a.splice(t,0,a.splice(e,1)[0]);const n=a[t-1]?.id??null;await this.$store.dispatch("sortCategory",i,n,a)}.bind(this),this.showAddCategory=function(){this.isManager||jl({onSave:this.addCategory},{shadow:!0})}.bind(this),this.addCategory=async function(e){await this.$store.dispatch("createCategory",e)}.bind(this),this.onBeforeMount=function(){this.currentQuery="object"==typeof this.meta.query?.categories?0:this.meta.query?.categories,flexbe.routing.on("before-route",(({query:e})=>{this.update({currentQuery:e.categories??0})}))}.bind(this),this.onBeforeUnmount=function(){flexbe.routing.off("before-route")}.bind(this)})),riot3.tag2("action-product-item",'<div class="flexbe-action-buttons"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{opts.sprite}#dots"></use> </svg> <dropdown position="end" direction="bottom" trigger-delay="{0}" trigger="click" arrow="{false}" position-to=".action" ref="dropdown"> <div class="flexbe-list borderless hoverable hoverable-background opacify round-corners"> <label class="flexbe-list-item" onclick="{tag.showEditProduct}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#setting"></use> </svg> <span class="flexbe-text">{tr(\'main::button::settings\')}</span> </label> <label if="{!tag.isManager}" class="flexbe-list-item" onclick="{tag.doubleProduct}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#action_double"></use> </svg> <span class="flexbe-text">{tr(\'admin::ecommerce::product::action_double\')}</span> </label> <label if="{!tag.isManager}" class="flexbe-list-item" onclick="{tag.toggleVisibleProduct}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#toggle_show"></use> </svg> <span class="flexbe-text">{tr(\'admin::ecommerce::product::action_show\')}</span> <span data-is="flexbe-input" type="toggle" checked="{tag.opts.product.visible}"></span> </label> <label if="{!tag.isManager}" class="flexbe-list-item" onclick="{tag.addProductFromCategory}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#action_add_from"></use> </svg> <span class="flexbe-text">{tr(\'admin::ecommerce::product::action_add_from_category\')}</span> </label> <label if="{tag.categoryId && !tag.isManager}" class="flexbe-list-item" onclick="{tag.removeProductFromCategory}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#action_remove_from"></use> </svg> <span class="flexbe-text">{tr(\'admin::ecommerce::product::action_remove_from_category\')}</span> </label> <label if="{!tag.isManager && !tag.$route.query.show_deleted}" class="flexbe-list-item" onclick="{tag.removeProduct}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#action_delete"></use> </svg> <span class="flexbe-text">{tr(\'main::button::delete\')}</span> </label> <label if="{tag.$route.query.show_deleted}" class="flexbe-list-item" onclick="{tag.restoreProduct}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.opts.sprite}#action_restore"></use> </svg> <span class="flexbe-text">{tr(\'main::button::restore\')}</span> </label> </div> </dropdown> </div>',"",'class="action-product-item {opts.class}"',(function(e){const t=this,s=location.search.split("&").filter((e=>e.includes("categories")));this.categoryId=null,this.isManager="manager"===flexbe.vars.user.role,s.length&&(this.categoryId=+s[0].split("=")[1]),this.$route=null,this.$products=null,this.$category=null,this.state={get productState(){return t.$products.state},get categoryState(){return t.$category.state},get categoryList(){return this.categoryState.items??[]},get totalCount(){return this.productState.totalCount},get params(){return this.productState.params??{}},get countOnPage(){return this.params.countOnPage??25}},this.onBeforeMount=function(){this.$route=flexbe.routing,this.$products=this.$store.getModule("products"),this.$category=this.$store.getModule("categories")}.bind(this),this.showEditProduct=function(e){e.stopPropagation();zl({productId:this.opts.product.id,onChange:()=>{},onClose:async()=>{t.$store.dispatch("setParams",{product:""}),await t.$store.dispatch("products/updateProducts"),await t.$store.dispatch("products/changeCurrentPage")}}),t.$store.dispatch("setParams",{product:this.opts.product.id}),this.closeDropdown()}.bind(this),this.doubleProduct=function(e){e.stopPropagation();const s=h(this.opts.product);s.id=`var${Ge()}`,s.name=`Copy_${s.name}`;Ol({onSave:async()=>{let e=_e(location.search);e.page=Math.ceil((t.state.totalCount+1)/t.state.params.countOnPage),t.$store.dispatch("products/setParams",e),await t.$store.dispatch("products/updateProducts")},product:s}),this.closeDropdown()}.bind(this),this.removeProduct=function(e){e.stopPropagation();As({props:{icon:`${t.opts.sprite}#remove_product`,title:tr("admin::ecommerce::product::delete_confirm_title",{name:t.opts.product.name}),confirmButtonText:tr("main::button::confirm"),confirmButtonClass:"is-danger bordered colored",cancelButton:!0,onConfirm:()=>t.deleteProduct(t.opts.product.id)},clickOut:!0}),this.closeDropdown()}.bind(this),this.deleteProduct=async function(e){await this.$store.dispatch("products/deleteProducts",{id:[e]})}.bind(this),this.restoreProduct=async function(e){e.stopPropagation();const t=e.item.product.id;await this.$store.dispatch("products/restoreProducts",{id:[t]}),this.closeDropdown()}.bind(this),this.removeProductFromCategory=function(e){e.stopPropagation();const s=e.item.product,i=this.categoryId,a=this.state.categoryList.find((e=>e.id===+i));As({clickOut:!0,props:{icon:`${t.opts.sprite}#action_remove_from_confirm`,title:tr("admin::ecommerce::product::simple::remove_from_category_confirm_title",{product:s.title,category:a.name}),confirmButtonText:tr("main::button::confirm"),cancelButton:!0,onConfirm:async()=>{await this.$store.dispatch("products/removeProductsFromCategory",[s.id],i),await this.$store.dispatch("categories/getCategoryList")}}})}.bind(this),this.addProductFromCategory=function(e){e.stopPropagation();const s=e.item.product;Fl({onSave:async e=>{const i=await t.$store.dispatch("products/addProductsFromCategory",[s.id],e);return await this.$store.dispatch("categories/getCategoryList"),i},list:t.state.categoryList})}.bind(this),this.toggleVisibleProduct=function(e){if(e.stopPropagation(),"INPUT"!==e.target.tagName)return!1;const t=e.item.product.id;+e.target.checked?this.showProduct(t):this.hideProduct(t)}.bind(this),this.showProduct=async function(e){await this.$store.dispatch("products/showProducts",{products:[e]})}.bind(this),this.hideProduct=async function(e){await this.$store.dispatch("products/hideProducts",{products:[e]})}.bind(this),this.closeDropdown=function(){this.refs.dropdown.trigger("toggleDropdown",!1)}.bind(this)})),riot3.tag2("variants-item",'<div class="variants-image__block"> <svg if="{!state.image}" class="flexbe-icon size-32"> <use riot-xlink:href="{tag.opts.sprite}#not_img"></use> </svg> <div if="{state.image}" class="variants-image__item" riot-style="background-image: url(\'{state.media}\')"></div> </div> <div class="variants-title"> <span class="flexbe-text text-s">{state.name}</span> <span class="flexbe-text text-xs text-shade-40">{tr(\'admin::ecommerce::product::variant_article\', { article: state.article })}</span> </div> <div class="variants-info"> <span class="flexbe-text text-xs">{!state.price ? tr(\'admin::ecommerce::product::price_null\') : formatMoney(state.price)}</span> <span class="flexbe-text text-xs text-shade-40"> {(state.quantity === -1) ? tr(\'admin::ecommerce::product::variant_infinity\') : tr(\'admin::ecommerce::product::variant_count\', { count: state.quantity })} </span> </div>',"",'class="flexbe-list-item {opts.class}"',(function(e){const t=this;this.tag=t,this.mixin("initMobx"),this.formatMoney=mt,this.state={get displayImages(){return this.isOptions?t.props.displayImage:"product"},get productsImages(){return t.props.productImages??[]},get variant(){return t.props.variant??{}},get isOptions(){return t.props.isOptions??!1},get name(){return(this.variant.name??[]).join("/")??""},get article(){return this.variant.vendor_code??""},get price(){return this.variant.price??""},get quantity(){return this.variant.quantity??0},get images(){return this.variant.images??[]},get defaultImageId(){return this.variant.default_image_id??null},get image(){return Dr({defId:this.defaultImageId,displayImage:this.displayImages,productMedia:this.productsImages,variantMedia:this.images})},get media(){return this.image.length?Vr(this.image[0],32):"/_s/images/admin/ecommerce/def_image.svg"}}})),riot3.tag2("admin-ecommerce-product-item",'<div class="tr"> <span class="draggable"> <svg class="flexbe-icon" viewbox="0 0 6 14" id="draggable"> <path d="M0 0h2v2H0V0zm0 4h2v2H0V4zm0 4h2v2H0V8zm0 4h2v2H0v-2zm4 0h2v2H4v-2zM4 0h2v2H4V0zm0 4h2v2H4V4zm0 4h2v2H4"></path> </svg> </span> <div class="td select"> <label data-is="flexbe-input" class="product-check contrast" type="checkbox" checked="{opts.product.checked}" onclick="{opts.selectItem}"></label> </div> <div class="td image"> <svg if="{!state.images.length}" class="flexbe-icon"> <use riot-xlink:href="{state.sprite}#not_img"></use> </svg> <div class="admin-ecommerce-product-item_image" if="{state.images.length}" riot-style="background-image: url(\'{state.media}\')"></div> </div> <div class="th title"> <span>{opts.product.name || tr(\'admin::ecommerce::product::table_name_title\')}</span> <div class="title-hide-tooltip" data-is="flexbe-tooltip" content="{tr(\'admin::ecommerce::product::hide_tip\')}"> <svg if="{!tag.opts.product.visible}" class="flexbe-icon size-16"> <use riot-xlink:href="{tag.state.sprite}#hide"></use> </svg> </div> </div> <div class="td article {\'variants\': state.isOptions}"> <div if="{!state.isOptions}">{state.article}</div> <div if="{state.isOptions}" class="variants-item"> <div class="flexbe-action-buttons"> <div class="variants-item-title"> <svg class="flexbe-icon size-22"> <use riot-xlink:href="{state.sprite}#article"></use> </svg> <span class="flexbe-text">{tr(\'admin::ecommerce::product::variant_quantity\', { count: state.article })}</span> </div> <dropdown if="{state.article}" position="start" direction="bottom" trigger-delay="{0}" trigger="hover" arrow="{false}" position-to=".article" ref="dropdown"> <div class="variants-item--dropdown flexbe-list round-corners border-indentation"> <div data-is="variants-item" each="{variant in tag.state.variants}" if="{variant.visible}" sprite="{tag.state.sprite}" variant="{variant}" is-options="{tag.state.isOptions}" quantity="{tag.state.article}" product-images="{tag.state.productImages}" display-image="{tag.state.displayImage}"></div> </div> </dropdown> </div> </div> </div> <div class="td quantity"> <div if="{!tag.state.isOptions && tag.state.isInfinity}" class="title-hide-tooltip" data-is="flexbe-tooltip" content="{tr(\'admin::ecommerce::product::infinity_tip\')}"> <svg class="flexbe-icon size-20"> <use riot-xlink:href="{tag.state.sprite}#infinity"></use> </svg> </div> <div class="quantity-text" if="{state.isOptions || !state.isInfinity}"> <span if="{state.quantity || !tag.state.isInfinity}">{state.quantity}</span> <div if="{tag.state.isInfinity}" class="title-hide-tooltip" data-is="flexbe-tooltip" content="{tag.state.quantity ? tr(\'admin::ecommerce::product::same_infinity_tip\') : tr(\'admin::ecommerce::product::infinity_tip\')}"> <svg class="flexbe-icon size-{tag.state.quantity ? \'10\' : \'20\'}"> <use riot-xlink:href="{tag.state.sprite}#{tag.state.quantity ? \'plus\' : \'infinity\'}"></use> </svg> </div> </div> </div> <div class="td total">{state.total}</div> <div class="td action"> <div data-is="action-product-item" sprite="{state.sprite}" product="{opts.product}"></div> </div> </div>',"","class=\"admin-ecommerce-product-item product-item {'product-item-hide': !state.product.visible, checked: state.product.checked}\"",(function(e){this.mixin("initMobx");const t=this;this.state={sprite:at("ecommerce","admin"),get product(){return t.props.product??[]},get visible(){return this.product.visible??!0},get productImages(){return this.product.images??[]},get quantity(){let e=0;return this.product.variants.forEach((t=>{-1!==t.quantity&&t.visible&&(e+=t.quantity)})),e},get isOptions(){return this.product.options.length},get isInfinity(){return this.product.variants.some((e=>-1===e.quantity))},get article(){if(this.isOptions){return this.product.variants.filter((e=>e.visible)).length}return this.product.variants[0].vendor_code||""},get total(){if(0===this.product.price.min&&0===this.product.price.max)return tr("admin::ecommerce::product::free");if(!this.product.price.min&&!this.product.price.max)return tr("admin::ecommerce::product::price_null");const e=this.product.price.min?mt(this.product.price.min):0,t=mt(this.product.price.max);return e===t?t:`${e}  ${t}`},get displayImage(){return this.isOptions?this.product.display_image:"product"},get defaultVariantId(){return this.product.default_variant_id??null},get variants(){return this.product.variants??[]},get defaultVariant(){return this.variants.filter((e=>e.id===this.defaultVariantId))??[]},get images(){return Dr({defId:this.defaultVariant[0]?.default_image_id??null,displayImage:this.displayImage,productMedia:this.product.images,variantMedia:this.defaultVariant[0].images})},get media(){return!this.images.length||this.images[0].loading?"":Vr(this.images[0],120)}},this.watch={"state.visible":[()=>this.update()]}})),riot3.tag2("admin-product-actions-list",'<div class="actions-list flexbe-list borderless" if="{actions.length}"> <div class="flexbe-list-item" if="{!action.hide}" each="{action in actions}" onclick="{selectAction.bind(null, action)}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{opts.sprite}#{action.icon}"></use> </svg> <span class="flexbe-text">{action.title}</span> </div> </div>',"",'class="admin-product-actions-list {opts.class}"',(function(e){const t=this.parent?this.parent.main||this.parent:this;this.tag=this,this.main=t;const s=location.search.split("&").filter((e=>e.includes("categories")));let i=null;s.length&&(i=+s[0].split("=")[1]);const a=e.productsList.filter((e=>e.checked)),n=a.some((e=>e.visible)),r=a.some((e=>!e.visible));flexbe.routing.query.show_deleted?this.actions=[{action:"restore",icon:"action_restore",title:tr("main::button::restore")}]:this.actions=[{action:"addFromCategory",icon:"action_add_from",title:tr("admin::ecommerce::product::action_add_from_category")},{action:"removeFromCategory",hide:!i,icon:"action_remove_from",title:tr("admin::ecommerce::product::action_remove_from_category")},{action:"show",hide:!r,icon:"show",title:tr("admin::ecommerce::product::action_all_show")},{action:"hide",hide:!n,icon:"hide",title:tr("admin::ecommerce::product::action_all_hide")},{action:"remove",icon:"action_delete",title:tr("main::button::delete")}],this.selectAction=function(t){t=Object.assign({},t),"function"==typeof e.onselect&&e.onselect(t)}.bind(this)})),riot3.tag2("admin-ecommerce-list-actionbar",'<div class="actions-button"> <span class="flexbe-text">{tr(\'admin::ecommerce::actions::title\')}</span> <svg class="flexbe-icon size-10"> <use riot-xlink:href="{opts.sprite}#select"></use> </svg> <dropdown position="center" direction="top" autohide="{true}" onopen="{opts.dropdownOpen}" onclose="{opts.dropdownClose}"> <div class="dropdown-header"> <div class="flexbe-title">{tr(\'admin::ecommerce::actions::title\')}</div> </div> <div data-is="admin-product-actions-list" onselect="{tag.setAction}" sprite="{tag.opts.sprite}" products-list="{tag.opts.productsList}"></div> </dropdown> </div> <div class="flexbe-button large rounded is-primary" onclick="{closeBar}"> <span class="flexbe-text">{tr(\'main::button::close\')}</span> </div>',"",'class="admin-ecommerce-list-actionbar {opts.class}"',(function(e){const t=this;this.tag=t,this.$category=adminStore.getModule("ecommerce/categories"),this.state={get categoryState(){return t.$category.state},get categoryList(){return this.categoryState.items??[]}},this.setAction=function(s){const i=e.productsList.filter((e=>e.checked)).map((e=>e.id)),a=i.length;if("hide"===s.action&&this.hideProducts({products:i}),"show"===s.action&&this.showProducts({products:i}),"remove"===s.action){const e=()=>t.deleteProducts({id:i});As({clickOut:!0,props:{icon:`${t.opts.sprite}#remove_product`,title:tr("admin::ecommerce::products::delete_confirm_title",{count:a}),confirmButtonText:tr("main::button::confirm"),cancelButton:!0,onConfirm:e}})}"restore"===s.action&&this.restoreProducts({id:i}),"removeFromCategory"===s.action&&this.removeProductsFromCategory(i,a),"addFromCategory"===s.action&&this.addProductsFromCategory(i),this.closeBar()}.bind(this),this.hideProducts=async function(e){await this.$store.dispatch("products/hideProducts",e)}.bind(this),this.showProducts=async function(e){await this.$store.dispatch("products/showProducts",e)}.bind(this),this.deleteProducts=async function(e){await this.$store.dispatch("products/deleteProducts",e)}.bind(this),this.restoreProducts=async function(e){await this.$store.dispatch("products/restoreProducts",e)}.bind(this),this.removeProductsFromCategory=async function(e,s){const i=location.search.split("&").filter((e=>e.includes("categories")));if(!i.length)return;const a=+i[0].split("=")[1],n=this.state.categoryList.find((e=>e.id===+a));As({clickOut:!0,props:{icon:`${t.opts.sprite}#action_remove_from_confirm`,title:tr("admin::ecommerce::product::mass::remove_from_category_confirm_title",{count:s,category:n.name}),confirmButtonText:tr("main::button::confirm"),cancelButton:!0,onConfirm:async()=>{await this.$store.dispatch("products/removeProductsFromCategory",e,a),await this.$store.dispatch("categories/getCategoryList")}}})}.bind(this),this.addProductsFromCategory=async function(e){Fl({onSave:async s=>{const i=await t.$store.dispatch("products/addProductsFromCategory",e,s);return await this.$store.dispatch("categories/getCategoryList"),i},list:t.state.categoryList})}.bind(this),this.closeBar=function(){e.selectAll(!1)}.bind(this)})),riot3.tag2("ecommerce-list-placeholder",'<div class="tr"> <div class="td select"></div> <div class="td image flexbe-placeholder rounded"></div> <div class="td title flexbe-placeholder rounded"></div> <div class="td article flexbe-placeholder rounded"></div> <div class="td quantity flexbe-placeholder rounded"></div> <div class="td total flexbe-placeholder rounded"></div> <div class="td action"></div> </div>',"",'class="ecommerce-list-placeholder"',(function(e){})),riot3.tag2("admin-ecommerce-pagination",'<div class="admin-ecommerce-pagination-container" if="{state.totalPages > 1}"> <span class="flexbe-text caption"> {tr(\'admin::ecommerce::products::pagination\', {                 page: Math.max(1, state.currentPage),                 pages: Math.max(1, state.totalPages)             })} </span> <div class="flexbe-button is-secondary filled small" disabled="{state.currentPage <= 1}" onclick="{paginationHandle.bind(null, \'prev\')}"> <svg class="flexbe-icon size-10" viewbox="0 0 6 10"> <path d="M2 5L6 1L5 0L0 5L5 10L6 9L2 5Z"></path> </svg> </div> <div class="flexbe-button is-secondary filled small" disabled="{state.currentPage >= state.totalPages}" onclick="{paginationHandle.bind(null, \'next\')}"> <svg class="flexbe-icon size-10" viewbox="0 0 6 10"> <path d="M4 5L0 1L1 0L6 5L1 10L0 9L4 5Z"></path> </svg> </div> </div>',"",'class="admin-ecommerce-pagination {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.loading=!1,this.$store=this.$store.getModule("products"),this.state={get totalPages(){return+t.$state.totalPages??0},get params(){return t.$state.params??{}},get currentPage(){return this.params.page??1}},this.watch={"state.totalPages":[()=>this.update()],"state.params":[()=>this.update()]},this.paginationHandle=function(e){this.loading||(this.loading=!0,this.$store.dispatch("toggleLoader",!0)),$("html, body").scrollTop(0);const s="next"===e?this.state.currentPage+1:this.state.currentPage-1;t.$store.dispatch("setParams",{page:s}),clearTimeout(this.timer),this.timer=setTimeout((async()=>{this.loading=!1,await t.$store.dispatch("updateProducts"),t.$store.dispatch("toggleLoader",!1)}),500)}.bind(this),this.onBeforeMount=function(){const e=_e(location.search);t.$store.dispatch("setParams",e)}.bind(this)})),riot3.tag2("admin-ecommerce-list",'<div data-is="proxy" is="admin-ecommerce-header"></div> <section class="ecommerce-list"> <div class="ecommerce-list--head"> <div class="tr"> <div class="th select"> <label data-is="flexbe-input" class="all-product-check" type="checkbox" disabled="{!state.list.length ||  isManager}" checked="{state.list.length && state.selectedProducts}" onchange="{selectAll}"></label> </div> <div class="td image"></div> <div class="th title"> <div class="flexbe-text">{tr(\'admin::ecommerce::header::name\')}</div> </div> <div class="td article"> <div class="flexbe-text">{tr(\'admin::ecommerce::header::article\')}</div> </div> <div class="td quantity">{tr(\'admin::ecommerce::header::quantity\')}</div> <div class="td total">{tr(\'admin::ecommerce::header::price\')}</div> <div class="td action"></div> </div> </div> <div class="ecommerce-list--loading" if="{state.loading}"> <div data-is="ecommerce-list-placeholder" each="{item in placeholders}"></div> </div> <div class="ecommerce-list--empty" if="{!state.list.length && !state.loading}"> <span if="{!state.search}" class="flexbe-text text-m">{tr(\'admin::ecommerce::products::empty\')}</span> <span if="{state.search}" class="flexbe-text text-m">{tr(\'main::error::no_results\')}</span> </div> <div class="ecommerce-list--body scrollable-content {\'disabled-sorting\': isManager} {\'show-list-actionbar\': state.selectedProducts}" if="{state.list.length && !state.loading}"> <div if="{state.list.length}" data-is="flexbe-sort-list" item-selector=".admin-ecommerce-product-item" handle-selector=".draggable" sortend="{sortProducts}" list="{state.list}"> <div data-is="admin-ecommerce-product-item" each="{product in opts.list}" key="{product.id}" id="{product.id}" tabindex="0" product="{product}" onclick="{tag.clickProduct}" onmousedown="{tag.clickProduct}" onmouseup="{tag.clickProduct}" select-item="{parent.tag.selectItem}"></div> </div> <div data-is="admin-ecommerce-pagination" if="{state.list.length}" class="pagination-block inline-box"></div> </div> </section> <footer data-is="admin-ecommerce-list-actionbar" class=" {\'show\': state.selectedProducts}" dropdown-open="{dropdownOpen}" dropdown-close="{dropdownClose}" products-list="{state.list}" select-all="{selectAll}" sprite="{state.sprite}"></footer>',"",'class="admin-ecommerce-list {overlayed: dropdownOpened, has-selected: state.selectedProducts}"',(function(e){this.mixin("initMobx");const t=this;this.$categories=adminStore.getModule("ecommerce/categories"),this.$store=this.$store.getModule("products"),this.isManager="manager"===flexbe.vars.user.role,this.state={sprite:at("ecommerce","admin"),selectedProducts:!1,get list(){return t.$state.items??[]},get ids(){return this.list.map((e=>e.id))},get totalCount(){return t.$state.totalCount},get loading(){return t.$state.loading},get params(){return t.$state.params??{}},get search(){return this.params.searchQuery},get currentPage(){return this.params.page??1}};let s=this.state.totalCount;this.watch={"state.totalCount":[e=>{+e!=+s&&(s=e,this.getCategoryList())}],"state.loading":[()=>this.update()],"state.search":[()=>this.selectAll(!1)],"state.ids":[()=>this.update(),{deep:!0}],"state.selectedProducts":[()=>this.update()]},this.placeholders=new Array(3).fill(null),this.loading=!1;let i,a,n,r,o,l=0,d=!1;fs.register([{hotkeys:["escape"],handlerDown:()=>this.selectAll(!1)}]),this.getCategoryList=async function(){await this.$categories.dispatch("getCategoryList")}.bind(this),this.selectAll=function(e){if(this.isManager)return;const t="object"==typeof e?e.target.checked:!!e;this.state.selectedProducts=t,this.state.list.forEach((e=>{e.checked=t})),this.update()}.bind(this),this.clickProduct=function(e){if(!e.target.closest(".product-check"))if(e.target.closest(".balloon")||e.target.closest(".action-product-item"))this.preventEvent(e);else if("click"===e.type){const s=this.dropdownOpened;if(d||s||this.state.selectedProducts)d=!1,this.preventEvent(e);else{const s=e.item.product,i=_e(location.search);this.showEditProduct(s.id),t.$store.dispatch("setParams",{...i,product:s.id})}if(this.state.selectedProducts){const t=e.item.product;this.selectItem(t,{shiftKey:e.shiftKey})}}else"mousedown"===e.type?(i=e.x,a=e.y,d=!1):"mouseup"===e.type&&(n=e.x,r=e.y,d=Math.sqrt((n-i)**2+(r-a)**2)>7)}.bind(this),this.showEditProduct=function(e){zl({productId:e,onChange:()=>{},onClose:async()=>{t.$store.dispatch("setParams",{product:""}),await t.$store.dispatch("updateProducts"),await t.$store.dispatch("changeCurrentPage")}})}.bind(this),this.selectItem=function(e,t){if(this.isManager)return;e&&e.item&&(e=(t=e).item.product),t instanceof Event&&(t.preventDefault(),t.stopPropagation());const s=t&&t.shiftKey,i=this.state.list.findIndex((t=>t.id===e.id)),a=s?l:i,n=Math.min(i,a),r=Math.max(i,a),o=!e.checked;this.state.list.filter(((e,t)=>t>=n&&t<=r)).forEach((e=>{e.checked=o})),this.state.selectedProducts=this.state.list.filter((e=>e.checked)).length??0,l=i}.bind(this),this.preventEvent=function(e){e.preventDefault()}.bind(this),this.dropdownOpen=function(e){clearTimeout(o),this.update({dropdownOpened:!0}),$(e.target).closest(".product-item").addClass("focus")}.bind(this),this.dropdownClose=function(e){clearTimeout(o),o=setTimeout((()=>{this.update({dropdownOpened:!1})}),100),$(e.target).closest(".product-item").removeClass("focus")}.bind(this),this.sortProducts=async function({oldIndex:e,newIndex:t,item:s}){if(this.isManager)return;if(e===t)return;const i=+s.id,a=this.state.list.map((e=>e)),n=location.search.split("&").filter((e=>e.includes("categories")));let r=null;n.length&&(r=+n[0].split("=")[1]),a.splice(t,0,a.splice(e,1)[0]);const o=a[t-1]?.id??null,l=a[t+1]?.id??null;o?await this.$store.dispatch("sortProducts",[i,o],r,"after",a):await this.$store.dispatch("sortProducts",[i,l],r,"before",a)}.bind(this),this.onBeforeMount=function(){const e=_e(location.search);t.$store.dispatch("setParams",e),e.product&&this.showEditProduct(+e.product)}.bind(this)}));const ql={css:null,exports:{setup(e,{initMobx:t}){t(),this.loading=!1,this.$store=this.$store.getModule("products"),this.isManager="manager"===flexbe.vars.user.role,this.state={get totalCount(){return e.$state.totalCount},get params(){var t;return null!=(t=e.$state.params)?t:{}},get countOnPage(){var e;return null!=(e=this.params.countOnPage)?e:25},get search(){var e;return null!=(e=this.params.searchQuery)?e:""}},this.watch={"state.totalCount":[()=>this.update()]}},addItem(){this.isManager||Ol({onSave:this.updateProductsList})},async updateProductsList(){let e=_e(location.search);e.page=Math.ceil((this.state.totalCount+1)/this.state.params.countOnPage),this.$store.dispatch("setParams",e),await this.$store.dispatch("updateProducts")},searchInput(e){const t=e.target.value;this.loading||(this.loading=!0,this.$store.dispatch("toggleLoader",!0)),this.$store.dispatch("setParams",{searchQuery:t,page:1}),clearTimeout(this.timer),this.timer=setTimeout((async()=>{await this.$store.dispatch("updateProducts"),this.loading=!1,this.update(),this.$store.dispatch("toggleLoader",!1)}),1e3)},async cleanInput(){clearTimeout(this.timer),this.loading=!1,this.$store.dispatch("toggleLoader",!1),this.$store.dispatch("setParams",{searchQuery:""}),await this.$store.dispatch("updateProducts")},async handleInput(e){27===e.which&&!this.loading&&this.state.search&&await this.cleanInput()},onBeforeMount(){const e=_e(location.search);this.$store.dispatch("setParams",e)}},template:(e,t,s,i)=>e('<div expr149="expr149" is="flexbe-input" class="admin-ecommerce-search"></div><div expr151="expr151" class="admin-ecommerce-search__info"></div><div expr152="expr152" class="admin-ecommerce__add-item flexbe-button is-primary filled rounded weight-medium"></div><div expr154="expr154" is="proxy" data-is="admin-ecommerce-pagination"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-ecommerce-header ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[{id:"default",html:'<span expr150="expr150" class="admin-ecommerce-search__clean flexbe-modal-close"></span>',bindings:[{type:s.IF,evaluate:e=>e.state.search,redundantAttribute:"expr150",selector:"[expr150]",template:e(null,[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.cleanInput}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::ecommerce::product::search_placeholder")},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.search},{type:t.EVENT,name:"oninput",evaluate:e=>e.searchInput},{type:t.EVENT,name:"onkeydown",evaluate:e=>e.handleInput}],redundantAttribute:"expr149",selector:"[expr149]"},{type:s.IF,evaluate:e=>e.state.search&&!e.loading,redundantAttribute:"expr151",selector:"[expr151]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::ecommerce::product::search")," ",e.state.totalCount].join("")}]}])},{type:s.IF,evaluate:e=>!e.isManager,redundantAttribute:"expr152",selector:"[expr152]",template:e('<span expr153="expr153" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.addItem}]},{redundantAttribute:"expr153",selector:"[expr153]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::ecommerce::product::add")}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-ecommerce-pagination pagination-block inline-box ",e.classNames({disabled:e.loading,"ml-auto":e.isManager})].join("")}],redundantAttribute:"expr154",selector:"[expr154]"}]),name:"admin-ecommerce-header"};e(ql.name,ql),riot3.tag2("transfer-site",'<div class="flexbe-title text-s">{tr(\'admin::projects::transfer::email_label\')}</div> <div class="grow transfer-site-input" data-is="flexbe-input" placeholder="{tr(\'admin::projects::transfer::email_placeholder\')}" oninput="{enterCode}" error="{error}" error-tip="{errorText}" onkeydown="{keydownHandle}"></div> <div class="flexbe-buttons-line mt20"> <div class="flexbe-button filled is-primary {loading: transfer}" onclick="{transferProject}"> <span class="flexbe-text">{tr(\'main::button::confirm\')}</span> </div> <div class="flexbe-button filled default" onclick="{closeTransfer}"> <span class="flexbe-text">{tr(\'main::button::cancel\')}</span> </div> </div>',"",'class="transfer-site"',(function(e){this.$projectsStore=adminStore.getModule("projects"),this.projectId=e.projectId,this.sprite=at("projects","admin"),this.transfer=!1,this.error=!1,this.errorText="",this.enterCode=function(e){("object"!=typeof e||e.target)&&(this.error=!1,this.email="string"==typeof e?e:e.target.value,this.update())}.bind(this),this.transferProject=async function(t){if(t&&(t.preventDefault(),t.stopPropagation()),this.inputCheck(),!this.error){this.update({transfer:!0});try{await this.$projectsStore.dispatch("transferProject",{projectId:this.projectId,email:this.email}),this.update({transfer:!1}),e.modal.close()}catch(e){this.update({error:!0,errorText:e.message,transfer:!1})}}}.bind(this),this.inputCheck=function(){!this.email&&!/^(([^<>()[\]\\.,;:\s@\']+(\.[^<>()[\]\\.,;:\s@\']+)*)|(\'.+\'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z--\-0-9]+\.)+[a-zA-Z--]{2,}))$/.test(this.email)&&(this.errorText=tr("admin::projects::transfer::email_error"),this.error=!0)}.bind(this),this.closeTransfer=function(){e.modal.close()}.bind(this),this.keydownHandle=function(e){13==+e.which&&this.transferProject(e)}.bind(this),this.on("mount",(()=>{setTimeout((()=>{$(this.root).find(".transfer-site-input input")[0].focus()}),300)}))}));const Gl={css:null,exports:{setup(e,{initMobx:t}){t(),this.$projectsStore=adminStore.getModule("projects"),this.state={_isDraft:!1,isMainPage:!1,uriWasChanged:!1,loading:!1,inCreate:!1,inScroll:!1,projectName:"",themes:{},get accountId(){var t;return null!=(t=e.props.accountId)?t:null},get addOnSharedAccount(){return this.accountId&&this.accountId!==flexbe.vars.user.id},get limitExceeded(){return!this.addOnSharedAccount&&e.$projectsStore.getters.limitExceeded},get isDraft(){return this._isDraft||this.limitExceeded},get currentTemplates(){var e;return null!=(e=this.themes.current)?e:[]}},this.meta={sprite:at("pages","admin")},this.watch={"state.pageUri":()=>this.update(),"state.errorUri":()=>this.update(),"state.loading":()=>this.update(),"state.inCreate":()=>this.update(),"state.inScroll":()=>this.update()}},showPreview(e){let t;const s=e.url;t=flexbe.modals.pages.showPreview({url:s,onSelect:()=>{this.createProject(e.id,t)}})},toggleDraft(e){this.state._isDraft=e.target.checked},setProjectName(e){this.state.projectName=e.target.value},async createProject(e,t){if(this.state.inCreate||!e)return;this.state.inCreate=e;const s={is_draft:this.state.isDraft,account_id:this.state.accountId,page_id:e,name:this.state.projectName};try{const e=await this.$projectsStore.dispatch("addProject",s);e&&e.domain&&e.uri?window.document.location=`${window.document.location.protocol}//${e.domain}${e.uri}`:(this.state.inCreate=!1,t&&t.close(),this.props.modal&&this.props.modal.close(),ao.getPages({force:!0}))}catch(e){this.state.inCreate=!1}},initTooltips(){flexbe.tip.initArea(this.root)},onUpdated(){this.initTooltips()},async onMounted(){this.initTooltips(),setTimeout((()=>{const e=e=>$(e).toArray().map((e=>e.offsetTop)),t=$(this.root).find(".page-content"),s=$(this.root).find(".templates-container.current");let i,a=e(s),n=-1;$(window).off("resize.flexbe_page_add").on("resize.flexbe_page_add",$.throttle((()=>{a=e(s)}))),t.off("scroll.flexbe_page_add").on("scroll.flexbe_page_add",(()=>{const e=((e,t)=>{if(!Array.isArray(t))return-1;let s=-1;return t.forEach(((t,i)=>{e>t&&(s=i)})),s})(t[0].scrollTop,a);n!==e&&(n=e,s.removeClass("active"),e>=0&&s.eq(e).addClass("active")),this.state.inScroll=!0,clearTimeout(i),i=setTimeout((()=>{this.state.inScroll=!1}),150)}))}),0)},async onBeforeMount(){const e=e=>{this.state.loading=!1,"NetworkError"===e.name?toast.error(e.message):console.error(e),this.props.modal.close()};try{this.state.loading=!0;const t=await ao.loadTemplates(!0);return t&&t.current?(await this.$projectsStore.loadState(),this.state.themes=t,this.state.loading=!1,t):e(new Error("No templates loaded"))}catch(t){return e(t)}}},template:(e,t,s,i)=>e('<div expr155="expr155" class="page-loading"></div><div expr157="expr157" class="page-content scrollable-content slide-down-animation"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-project-add admin-template-add ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.state.loading,redundantAttribute:"expr155",selector:"[expr155]",template:e('<div expr156="expr156" is="flexbe-loader"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[],redundantAttribute:"expr156",selector:"[expr156]"}])},{type:s.IF,evaluate:e=>!e.state.loading,redundantAttribute:"expr157",selector:"[expr157]",template:e('<div class="page-params row gap-40"><div class="col col-6 page-title"><div expr158="expr158" class="flexbe-title text-subtitle"> </div><div expr159="expr159" is="flexbe-input" class="flexbe-field-group large shadow"></div></div><div class="col col-6 mt40"><label expr160="expr160" is="flexbe-checkbox" class="flexbe-field-group large flexbe-bar rounded" type="toggle"></label></div></div><div class="page-themes-container"><div class="templates-title"><div expr162="expr162" class="flexbe-text text-subtitle"> </div></div><div expr163="expr163" class="templates-container current"></div></div>',[{redundantAttribute:"expr158",selector:"[expr158]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::add::name_title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.pageTitle},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::projects::name::placeholder")},{type:t.EVENT,name:"oninput",evaluate:e=>e.setProjectName}],redundantAttribute:"expr159",selector:"[expr159]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr161="expr161" class="flexbe-text"> </span>',bindings:[{redundantAttribute:"expr161",selector:"[expr161]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::add::draft_label")].join("")},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>!e.state.addOnSharedAccount&&e.state.limitExceeded?e.tr("admin::bill::projects_limit::toast"):""}]}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.isDraft||e.state.limitExceeded},{type:t.EVENT,name:"onchange",evaluate:e=>e.toggleDraft},{type:t.ATTRIBUTE,name:"locked",evaluate:e=>e.state.limitExceeded}],redundantAttribute:"expr160",selector:"[expr160]"},{redundantAttribute:"expr162",selector:"[expr162]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::pages::add::theme_title")].join("")}]},{type:s.IF,evaluate:e=>e.state.currentTemplates.pages&&e.state.currentTemplates.pages.length,redundantAttribute:"expr163",selector:"[expr163]",template:e('<template expr164="expr164"></template>',[{type:s.EACH,getKey:null,condition:null,template:e('<div expr165="expr165" is="admin-template-add-item"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"admin-template-add-item",slots:[],attributes:[{type:t.ATTRIBUTE,name:"template",evaluate:e=>e.item},{type:t.ATTRIBUTE,name:"inCreate",evaluate:e=>e.state.inCreate},{type:t.EVENT,name:"onCreate",evaluate:e=>e.createProject},{type:t.ATTRIBUTE,name:"showPreview",evaluate:e=>e.showPreview}],redundantAttribute:"expr165",selector:"[expr165]"}]),redundantAttribute:"expr164",selector:"[expr164]",itemName:"item",indexName:null,evaluate:e=>e.state.currentTemplates.pages}])}])}]),name:"admin-project-add"};e(Gl.name,Gl);const Xl={css:null,exports:{setup(e,{initMobx:t,inject:s}){t({autoUpdate:!0}),this.$projectsStore=e.props.$projectsStore||adminStore.getModule("projects"),this.modal=s("modal"),this.state={projectId:e.props.projectId,error:!1,deleting:!1}},enterCode(e){("object"!=typeof e||e.target)&&(this.state.error=!1,this.state.url="string"==typeof e?e:e.target.value)},async deleteProjects(e){e&&(e.preventDefault(),e.stopPropagation()),this.state.url===String(this.state.projectId)?(this.state.deleting=!0,await this.$projectsStore.dispatch("removeProject",{projectId:this.state.projectId}),flexbe.vars.group.id===this.state.projectId?document.location="https://flexbe.com/admin/sites/":toast.success(tr("admin::projects::delete::success_notify")),this.modal.close()):this.state.error=!0}},template:(e,t,s,i)=>e('<div expr166="expr166" class="flexbe-title text-s mb20"> </div><div class="flexbe-field-group is-inline"><div expr167="expr167" class="grow" is="flexbe-input" placeholder="999999" min="0" max="999999" step="0" maxlength="6" autofocus></div><div expr168="expr168"><span expr169="expr169" class="flexbe-text"> </span></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"admin-project-delete"}]},{redundantAttribute:"expr166",selector:"[expr166]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::delete::confirmation_text",{group_id:e.state.projectId})].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"pattern",evaluate:e=>/[0-9]{0,6}/},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.state.error},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.url},{type:t.ATTRIBUTE,name:"error-text",evaluate:e=>e.tr("admin::projects::delete::error_confirmation")},{type:t.EVENT,name:"oninput",evaluate:e=>e.enterCode},{type:t.EVENT,name:"onenter",evaluate:e=>e.deleteProjects}],redundantAttribute:"expr167",selector:"[expr167]"},{redundantAttribute:"expr168",selector:"[expr168]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button filled is-primary noshrink ",e.classNames({loading:e.state.deleting})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.deleteProjects}]},{redundantAttribute:"expr169",selector:"[expr169]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::delete")}]}]),name:"admin-project-delete"};e(Xl.name,Xl);const Kl={create:e=>Zs.create({type:"overlay",padding:50,compact:!0,overlay:!0,scrollable:!1,title:tr("admin::projects::add::title"),component:"admin-project-add",props:e}),delete:e=>Zs.create({width:400,name:"delete_site",overlay:!0,shadow:!0,title:tr("admin::projects::delete::title",{domain:(null==e?void 0:e.domain)||""}),component:"admin-project-delete",props:e})},Wl={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={inDropdown:!1,searchInputInFocus:!1,get $state(){return e.$state},get $store(){return e.$store},get personalList(){return this.$state.projects.personal},get shareList(){return this.$state.projects.share},get userData(){return this.$state.user},get showAddDomain(){return!!this.$state.show_add_project_btn},get showProfile(){return!!this.$state.show_profile},get filters(){return this.$state.filters||{}},get typeFilterValue(){return this.filters.type||"all"},get sortData(){return this.filters.sort},get searchValue(){return this.filters.search},get activeView(){return this.$state.view},get visibleSitesCount(){return this.$store.getters.visibleCount},get userId(){return flexbe.vars.user.id}},this.meta={filtersSprite:at("filters","admin"),typeFilters:[{value:"all",title:tr("admin::projects::filters::type::all::title")},{value:"published",title:tr("admin::projects::filters::type::published::title")},{value:"drafts",title:tr("admin::projects::filters::type::drafts::title")}],sortFilters:[{name:"create",value:"asc",title:tr("admin::projects::filters::sort::create::title")},{name:"update",value:"asc",title:tr("admin::projects::filters::sort::update::title")},{name:"name",value:"asc",title:tr("admin::projects::filters::sort::name::title")},{name:"domain",value:"asc",title:tr("admin::projects::filters::sort::domain::title")}],viewList:[{value:"grid",icon:"cards-view",iconSize:14,tip:tr("admin::projects::filters::view::grid::tip")},{value:"table",icon:"table-view",iconSize:14,tip:tr("admin::projects::filters::view::table::tip")}]},this.watch={"state.inDropdown":()=>this.update(),"state.activeView":()=>this.update()}},updateSort(e){this.$store.dispatch("setFilters",{sort:e})},onOpenDropdown(){this.inDropdown=!0},onCloseDropdown(){this.inDropdown=!1},updateFilter(e){this.$store.dispatch("setFilters",{type:e})},onSearchInput({value:e}){this.$store.dispatch("setFilters",{search:e})},setView({value:e}){this.$store.dispatch("setView",{value:e})},addProject(){Kl.create()}},template:(e,t,s,i)=>e('<div class="flexbe-title text-title inline-box"><div expr170="expr170" class="flexbe-text"> </div><div expr171="expr171" is="dropdown-filter" class="ml20"></div></div><div class="admin-project-header__buttons"><div expr172="expr172" is="admin-search-input"></div><div expr173="expr173" is="dropdown-sort"></div><div expr174="expr174" is="flexbe-switch" class="round stretched is-group" size="large"></div><template expr175="expr175"></template><template expr178="expr178"></template></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-project-header fade-in-animation group-title borderless ",e.props.class].join("")}]},{redundantAttribute:"expr170",selector:"[expr170]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"dropdown-filter",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.typeFilters},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.typeFilterValue},{type:t.EVENT,name:"on-update",evaluate:e=>e.updateFilter}],redundantAttribute:"expr171",selector:"[expr171]"},{type:s.TAG,getComponent:i,evaluate:e=>"admin-search-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::projects::search::placeholer")},{type:t.EVENT,name:"on-search-input",evaluate:e=>e.onSearchInput},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.searchValue},{type:t.ATTRIBUTE,name:"search-count",evaluate:e=>e.state.visibleSitesCount}],redundantAttribute:"expr172",selector:"[expr172]"},{type:s.TAG,getComponent:i,evaluate:e=>"dropdown-sort",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.sortFilters},{type:t.ATTRIBUTE,name:"data",evaluate:e=>e.state.sortData},{type:t.EVENT,name:"on-update",evaluate:e=>e.updateSort},{type:t.ATTRIBUTE,name:"show-value",evaluate:e=>!1}],redundantAttribute:"expr173",selector:"[expr173]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-switch",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.activeView},{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.viewList},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.filtersSprite},{type:t.EVENT,name:"onChange",evaluate:e=>e.setView}],redundantAttribute:"expr174",selector:"[expr174]"},{type:s.IF,evaluate:e=>e.state.showAddDomain,redundantAttribute:"expr175",selector:"[expr175]",template:e('<div class="flexbe-separator"></div><div expr176="expr176" class="flexbe-button filled rounded large is-primary"><span expr177="expr177" class="flexbe-text"> </span></div>',[{redundantAttribute:"expr176",selector:"[expr176]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.addProject}]},{redundantAttribute:"expr177",selector:"[expr177]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::add_button")].join("")}]}])},{type:s.IF,evaluate:e=>e.state.showProfile,redundantAttribute:"expr178",selector:"[expr178]",template:e('<div class="flexbe-separator"></div><div expr179="expr179"><span expr180="expr180" class="profile-mail"> </span><div expr181="expr181" is="proxy" data-is="user-avatar"></div><div expr182="expr182" is="proxy" data-is="dropdown" class="menu-list" position="end"></div></div>',[{redundantAttribute:"expr179",selector:"[expr179]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["header-profile ",e.classNames({"in-dropdown":e.state.inDropdown})].join("")}]},{redundantAttribute:"expr180",selector:"[expr180]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.userData.email].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"user-image",evaluate:e=>e.state.userData.avatar},{type:t.ATTRIBUTE,name:"user-mail",evaluate:e=>e.state.userData.email}],redundantAttribute:"expr181",selector:"[expr181]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="editor-items-list"><div class="flexbe-list hoverable hoverable-background vertical-gaps"><a expr183="expr183" class="flexbe-list-item"></a><a expr185="expr185" class="flexbe-list-item"></a><a expr187="expr187" class="flexbe-list-item"><span expr188="expr188"> </span></a></div></div>',bindings:[{type:s.IF,evaluate:e=>e.state.personalList.length||e.state.shareList.length&&e.state.shareList[0].projects[0],redundantAttribute:"expr183",selector:"[expr183]",template:e('<span expr184="expr184"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.personalList.length?e.state.personalList[0].domain_link:e.state.shareList[0].projects[0].domain_link,"/admin/auth/?go=/admin/user/profile/"].join("")}]},{redundantAttribute:"expr184",selector:"[expr184]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::profile")}]}])},{type:s.IF,evaluate:e=>e.state.personalList.length,redundantAttribute:"expr185",selector:"[expr185]",template:e('<span expr186="expr186"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.personalList[0].domain_link,"/admin/auth/?go=/admin/user/pay/"].join("")}]},{redundantAttribute:"expr186",selector:"[expr186]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::pay")}]}])},{redundantAttribute:"expr187",selector:"[expr187]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>["/admin/logout/?id=",e.state.userId].join("")}]},{redundantAttribute:"expr188",selector:"[expr188]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("menu::logout")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!0},{type:t.EVENT,name:"onopen",evaluate:e=>e.onOpenDropdown},{type:t.EVENT,name:"onclose",evaluate:e=>e.onCloseDropdown}],redundantAttribute:"expr182",selector:"[expr182]"}])}]),name:"admin-project-header"};e(Wl.name,Wl);const Zl={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={siteDeleteDate:"",isClicableItems:!0,get $store(){return e.$store},get $state(){return e.$state},get projects(){return this.$store.getters.filteredProjectsList},get view(){return this.$state.view},get searchValue(){return this.$state.filters.search},get projectsType(){return this.$state.filters.type},get personalList(){return this.$state.projects.personal||[]},get domainsList(){return[...this.projects.transfer_request,...this.projects.personal]},get oldList(){return this.projects.old},get sharedList(){return this.projects.share},get filteredFullList(){return this.$store.getters.filteredFullList},get showAddDomain(){return!!this.$state.show_add_project_btn},get showProfile(){return!!this.$state.show_profile},get showCreateProject(){return!!this.$state.show_create_project_btn},get userHasSharedOnly(){return!!this.$state.shared_sites_only},get isPaid(){return!!this.$state.is_paid},get allowDelete(){return!this.$state.projects.personal||this.$state.projects.personal.length>1},get allowCreate(){return this.showCreateProject&&!this.userHasSharedOnly},get showListBlock(){return!!this.$store.getters.visibleCount},get showSharedList(){return this.sharedList.length&&this.sharedList.some((e=>e.projects.length))},get techUrlShow(){return!!this.$state.filters.search}},this.meta={sprite:at("projects","admin"),get projectInfoTitle(){return e.state.allowCreate?tr("admin::projects::empty::title"):null},get projectInfoText(){return e.state.allowCreate?e.state.isPaid?tr("admin::projects::empty::text"):tr("admin::projects::empty::text_trial"):tr("admin::projects::empty::info_text")},get projectInfoTrial(){return e.state.allowCreate&&!this.isPaid?tr("admin::projects::empty::sub_text_trial"):null}},this.watch={"state.techUrlShow":()=>this.update(),"state.isClicableItems":()=>this.update(),"state.$state":[()=>this.update(),{deep:!0}]}},addProjectOnSharedAccount(e){if(e&&e.projects){const t=e.projects[0].account_id;Kl.create({accountId:t})}},initTooltips(){Yt.initArea(this.root)},prohibitClick(e){this.state.isClicableItems=!e},onMounted(){this.initTooltips(),this.root.removeAttribute("data-json")},onUpdated(){this.initTooltips()},onUnmounted(){this._hotkeysDisposer&&this._hotkeysDisposer()}},template:(e,t,s,i)=>e('<div expr189="expr189" class="row admin-project-table-header"></div><div expr193="expr193" class="admin-project-content__empty slide-down-animation"></div><div expr197="expr197" class="admin-project-content__empty slide-down-animation"></div><div expr206="expr206" class="sites-group-list"></div><div expr211="expr211" class="sites-group-list slide-down-animation"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-project-content ",`${e.state.view}-view`].join("")}]},{type:s.IF,evaluate:e=>"table"===e.state.view&&e.state.domainsList.length,redundantAttribute:"expr189",selector:"[expr189]",template:e('<div class="admin-project-table-header__col col col-1"></div><div expr190="expr190" class="admin-project-table-header__col col admin-project-col-name text-shade"> </div><div expr191="expr191" class="admin-project-table-header__col col col-3 text-shade"> </div><div expr192="expr192" class="admin-project-table-header__col col col-3 text-shade"> </div>',[{redundantAttribute:"expr190",selector:"[expr190]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::list::column::name")].join("")}]},{redundantAttribute:"expr191",selector:"[expr191]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::list::column::domain")].join("")}]},{redundantAttribute:"expr192",selector:"[expr192]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::list::column::last_save")].join("")}]}])},{type:s.IF,evaluate:e=>e.state.searchValue&&!e.state.filteredFullList.length,redundantAttribute:"expr193",selector:"[expr193]",template:e('<svg expr194="expr194" is="flexbe-icon" class="search-icon" icon="search"></svg><div expr195="expr195" class="flexbe-text text-title"> </div><div expr196="expr196" class="flexbe-text text-note flexbe-desc"> </div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"size",evaluate:e=>28},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr194",selector:"[expr194]"},{redundantAttribute:"expr195",selector:"[expr195]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::search::not_found::title")].join("")}]},{redundantAttribute:"expr196",selector:"[expr196]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::search::not_found::desc",{search:e.state.searchValue})].join("")}]}])},{type:s.IF,evaluate:e=>!e.state.searchValue&&!e.state.filteredFullList.length,redundantAttribute:"expr197",selector:"[expr197]",template:e('<template expr198="expr198"></template><template expr202="expr202"></template>',[{type:s.IF,evaluate:e=>"published"===e.state.projectsType,redundantAttribute:"expr198",selector:"[expr198]",template:e('<svg expr199="expr199" is="flexbe-icon" icon="published-light"></svg><div expr200="expr200" class="flexbe-text text-title"> </div><div expr201="expr201" class="flexbe-text text-note flexbe-desc"> </div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"size",evaluate:e=>28},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr199",selector:"[expr199]"},{redundantAttribute:"expr200",selector:"[expr200]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::epmty::publised::title")].join("")}]},{redundantAttribute:"expr201",selector:"[expr201]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::epmty::publised::desc")].join("")}]}])},{type:s.IF,evaluate:e=>"drafts"===e.state.projectsType,redundantAttribute:"expr202",selector:"[expr202]",template:e('<svg expr203="expr203" is="flexbe-icon" icon="draft-light"></svg><div expr204="expr204" class="flexbe-text text-title"> </div><div expr205="expr205" class="flexbe-text text-note flexbe-desc"> </div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"size",evaluate:e=>28},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr203",selector:"[expr203]"},{redundantAttribute:"expr204",selector:"[expr204]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::epmty::draft::title")].join("")}]},{redundantAttribute:"expr205",selector:"[expr205]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::draft::desc")].join("")}]}])}])},{type:s.IF,evaluate:e=>e.state.showCreateProject||!e.state.personalList.length,redundantAttribute:"expr206",selector:"[expr206]",template:e('<div class="sites-domains-empty slide-down-animation"><div class="flexbe-white-card shadow p40"><div expr207="expr207" class="flexbe-text text-xl mb20"></div><div class="flexbe-text text-sm mb30"><raw expr208="expr208"></raw></div><div class="sites-domains-empty-button"><a href="/admin/sites/create/" class="flexbe-button filled rounded large is-primary"><span expr209="expr209" class="flexbe-text"> </span></a><span expr210="expr210" class="flexbe-text flexbe-desc text-sm ml15"></span></div></div></div>',[{type:s.IF,evaluate:e=>e.state.showCreateProject,redundantAttribute:"expr207",selector:"[expr207]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.meta.projectInfoTitle].join("")}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.meta.projectInfoText}],redundantAttribute:"expr208",selector:"[expr208]"},{redundantAttribute:"expr209",selector:"[expr209]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::add_button")}]},{type:s.IF,evaluate:e=>!e.state.isPaid,redundantAttribute:"expr210",selector:"[expr210]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.meta.projectInfoTrial].join("")}]}])}])},{type:s.IF,evaluate:e=>e.state.showListBlock,redundantAttribute:"expr211",selector:"[expr211]",template:e('<div expr212="expr212" class="sites-group"></div><div expr214="expr214" class="sites-group"></div><div expr224="expr224" class="sites-group"></div>',[{type:s.IF,evaluate:e=>e.state.domainsList.length,redundantAttribute:"expr212",selector:"[expr212]",template:e('<div class="sites-domains"><div expr213="expr213" is="admin-project-item" class="place-item"></div></div>',[{type:s.EACH,getKey:e=>`${e.domains.project_id}-${e.index}`,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"admin-project-item",slots:[],attributes:[{type:t.ATTRIBUTE,name:"domains",evaluate:e=>e.domains},{type:t.ATTRIBUTE,name:"transfer",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"is-clickable",evaluate:e=>e.state.isClicableItems},{type:t.ATTRIBUTE,name:"delete",evaluate:e=>e.state.allowDelete},{type:t.ATTRIBUTE,name:"tech-url-show",evaluate:e=>e.state.techUrlShow},{type:t.ATTRIBUTE,name:"prohibit-click",evaluate:e=>e.prohibitClick}]}]),redundantAttribute:"expr213",selector:"[expr213]",itemName:"domains",indexName:"index",evaluate:e=>e.state.domainsList}])},{type:s.IF,evaluate:e=>e.state.showSharedList,redundantAttribute:"expr214",selector:"[expr214]",template:e('<div class="projects-header group-title"><svg class="flexbe-icon size-28"><use expr215="expr215"/></svg><div expr216="expr216" class="flexbe-text text-subtitle"> </div></div><div expr217="expr217" class="shared-account"></div>',[{redundantAttribute:"expr215",selector:"[expr215]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#group-shared"].join("")}]},{redundantAttribute:"expr216",selector:"[expr216]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::shared_title")}]},{type:s.EACH,getKey:null,condition:e=>e.sharedAccount.projects.length,template:e('<div class="shared-account__header"><div expr218="expr218" is="proxy" data-is="user-avatar" class="shared-account__avatar"></div><div expr219="expr219" class="shared-account__email"> </div><div expr220="expr220" class="shared-account__button flexbe-button filled is-secondary rounded"></div></div><div class="shared-account__projects sites-domains"><div expr223="expr223" is="admin-project-item" class="place-item"></div></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"user-mail",evaluate:e=>e.sharedAccount.user_mail},{type:t.ATTRIBUTE,name:"user-avatar",evaluate:e=>e.sharedAccount.avatar}],redundantAttribute:"expr218",selector:"[expr218]"},{redundantAttribute:"expr219",selector:"[expr219]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.sharedAccount.user_mail].join("")},{type:t.ATTRIBUTE,name:"test",evaluate:e=>JSON.stringify(e.sharedAccount)},{type:t.ATTRIBUTE,name:"data-tip",evaluate:e=>e.tr("admin::projects::shared::role_tip",{role:e.tr(`admin::members::roles::${e.sharedAccount.role}_title`)})}]},{type:s.IF,evaluate:e=>e.state.$state.accessConfig[e.sharedAccount.role].includes("create")&&!e.state.showProfile,redundantAttribute:"expr220",selector:"[expr220]",template:e('<svg expr221="expr221" is="flexbe-icon" icon="plus"></svg><div expr222="expr222" class="flexbe-text"> </div>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.addProjectOnSharedAccount(e.sharedAccount)}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"size",evaluate:e=>12},{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr221",selector:"[expr221]"},{redundantAttribute:"expr222",selector:"[expr222]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::add_button")].join("")}]}])},{type:s.EACH,getKey:null,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"admin-project-item",slots:[],attributes:[{type:t.ATTRIBUTE,name:"domains",evaluate:e=>e.project},{type:t.ATTRIBUTE,name:"is-clickable",evaluate:e=>e.state.isClicableItems},{type:t.ATTRIBUTE,name:"tech-url-show",evaluate:e=>e.state.techUrlShow},{type:t.ATTRIBUTE,name:"role",evaluate:e=>e.sharedAccount.role},{type:t.ATTRIBUTE,name:"prohibit-click",evaluate:e=>e.prohibitClick}]}]),redundantAttribute:"expr223",selector:"[expr223]",itemName:"project",indexName:null,evaluate:e=>e.sharedAccount.projects}]),redundantAttribute:"expr217",selector:"[expr217]",itemName:"sharedAccount",indexName:null,evaluate:e=>e.state.sharedList}])},{type:s.IF,evaluate:e=>e.state.oldList.length,redundantAttribute:"expr224",selector:"[expr224]",template:e('<div class="projects-header group-title"><svg class="flexbe-icon size-28"><use expr225="expr225"/></svg><div expr226="expr226" class="flexbe-text text-subtitle"> </div></div><div class="sites-domains"><div expr227="expr227" is="admin-project-item" class="place-item"></div></div>',[{redundantAttribute:"expr225",selector:"[expr225]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#group-old"].join("")}]},{redundantAttribute:"expr226",selector:"[expr226]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::old_versions_title")].join("")}]},{type:s.EACH,getKey:null,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"admin-project-item",slots:[],attributes:[{type:t.ATTRIBUTE,name:"old",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"domains",evaluate:e=>e.domains},{type:t.ATTRIBUTE,name:"tech-url-show",evaluate:e=>e.state.techUrlShow},{type:t.ATTRIBUTE,name:"is-clickable",evaluate:e=>e.state.isClicableItems},{type:t.ATTRIBUTE,name:"prohibit-click",evaluate:e=>e.prohibitClick}]}]),redundantAttribute:"expr227",selector:"[expr227]",itemName:"domains",indexName:null,evaluate:e=>e.state.oldList}])}])}]),name:"admin-project-content"};e(Zl.name,Zl);const Yl={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={inHover:!1,inDropdown:!1,inEditingName:!1,onScreen:!1,previewImage:null,temporaryPublishTag:!1,_localName:"",get isActive(){return this.inHover||this.inDropdown||this.inEditingName},get view(){return e.$state.view},get projectData(){return e.props.domains},get isDraft(){return!!this.projectData.is_draft},get waitingTransfer(){return this.projectData.waiting_transfer},get waitingTransferAcceptance(){return this.projectData.transfer_id&&!this.projectData.transfer_in_progress},get incomingTransferInProgress(){return this.projectData.transfer_id&&this.projectData.transfer_in_progress},get transferInProgress(){return this.waitingTransfer&&this.waitingTransfer.in_progress},get waitingTransferAcceptanceFromRecipient(){return this.waitingTransfer&&!this.waitingTransfer.in_progress},get isTransferState(){return this.waitingTransferAcceptance||this.incomingTransferInProgress||this.transferInProgress||this.waitingTransferAcceptanceFromRecipient},get favicon(){const e="string"==typeof this.projectData.favicon?this.projectData.favicon:pt(this.projectData.favicon);return this.projectData.favicon?`${this.projectData.domain_link}${e}`:"/_s/images/favicon.png"},get searchValue(){return e.$state.filters.search},get sortFilter(){return e.$state.filters.sort},get titleHtmlContent(){return e.props.techUrlShow||this.projectData.domain_is_reg?e.formatMatchedString(this.projectData.domain_title,this.searchValue):tr("admin::projects::domain_not_connected_state")},get nameHtmlContent(){return e.formatMatchedString(this.projectData.name||"",this.searchValue)||tr("admin::projects::name::placeholder")},get lastSaveDateString(){if(!this.projectData.updated_at)return"";const e=flexbe.vars.user.lang,t=new Date(1e3*this.projectData.updated_at),s=new Date;return t.toDateString()===s.toDateString()?`${qe(t.getHours())}:${qe(t.getMinutes())}`:t.getFullYear()===s.getFullYear()?t.toLocaleDateString(e,{month:"long",day:"numeric"}):t.toLocaleDateString(e,{month:"numeric",day:"numeric",year:"numeric"})},get canRename(){const t=e.props.role||"owner";return e.$state.accessConfig[t].includes("rename")&&!this.waitingTransferAcceptance},get previewStyle(){return this.previewImage?`background-image: url(${this.previewImage})`:null},get showPublisedTag(){const e="table"===this.view;return(this.temporaryPublishTag||e)&&!this.projectData.is_draft},get showDraftTag(){return this.projectData.is_draft},get showLeadsTag(){return this.projectData.unread_leads&&!this.showDraftTag&&!this.showPublisedTag},get allowChangeIsDraft(){const t=e.props.role||"admin",s=e.props.old;return e.$state.accessConfig[t].includes("draft")&&!s&&!this.isTransferState},get isClickableItem(){var t;return(null==(t=e.props.isClickable)||t)&&!this.waitingTransferAcceptance}},this.meta={sprite:at("projects","admin"),modalSprite:at("modal","common"),get domainLink(){return e.state.projectData.domain_link},get pagesLink(){return`${this.domainLink}/admin/auth/?go=/admin/pages/`},get leadsPageLink(){return`${this.domainLink}/admin/auth/?go=/admin/lead/`}},this.watch={"state.inHover":()=>this.update(),"state.inDropdown":e=>{this.props.prohibitClick(e),this.update()},"state.onScreen":()=>this.update(),"state.previewImage":()=>this.update(),"state.searchValue":()=>this.update(),"state.inEditingName":e=>{this.props.prohibitClick(e),this.update()},"state.renameDoneState":()=>this.update(),"state.temporaryPublishTag":()=>this.update()}},formatMatchedString(e="",t=""){var s,i;t=null!=(i=t)?i:"";const a=(e=null!=(s=e)?s:"").toLowerCase().indexOf(t.toLowerCase()),n=a+t.length;if(!t||-1===a)return e;return`<span>${e.slice(0,a)}</span><mark>${e.slice(a,n)}</mark><span>${e.slice(n,e.length)}</span>`.replace(/\s/g,"&nbsp;")},cardHover(e){this.state.inHover=e},onOpenDropdown(e,t){e.stopPropagation(),this.state.inDropdown=!0,setTimeout((()=>{var e;null!=t&&null!=(e=t.refs)&&e.balloon&&t.refs.balloon.scrollIntoView({behavior:"smooth",block:"nearest"})}),50)},onCloseDropdown(){this.state.inDropdown=!1},startEditingName(e){!this.state.inEditingName&&this.state.canRename&&(this.stopPropagation(e),this.state.inEditingName=!0)},stopEditingName(){this.state.inEditingName=!1},setLocalProjectName(e){this.state._localName=e.target.value.trim()},revertLastProjectName(){this.state._localName=this.state.projectData.name},async setProjectName(e){e.stopPropagation(),this.stopEditingName(),this.state._localName!==this.state.projectData.name&&(await this.$store.dispatch("setProjectName",{projectId:this.state.projectData.project_id,name:this.state._localName}),this.state.renameDoneState=!0,setTimeout((()=>{this.state.renameDoneState=!1}),800),"name"===this.state.sortFilter.name&&setTimeout((()=>{const e=document.querySelector(`[data-project-id="${this.state.projectData.project_id}"]`);e&&(!function(e,t,s){const i=$(e);i.addClass(t),setTimeout((()=>{i.removeClass(t)}),s)}(e,"active",700),e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}))}),10))},deleteProject(e,t){Kl.delete({projectId:e,domain:t,$projectsStore:this.$store})},transferProject(){const{project_id:e,domain_is_reg:t}=this.state.projectData;Zs.create({width:400,name:"transfer.site",overlay:!0,shadow:!0,title:tr("admin::projects::transfer::title"),riotTag:"transfer-site",props:{projectId:e,isConnectedDomain:t}})},toggleDraft(e=!this.state.isDraft){flexbe.trigger("closeDropdown"),e!==this.state.isDraft&&(e?this.makeDraft():this.removeFromDrafts())},makeDraft(){const{project_id:e,domain_title:t}=this.state.projectData;As({clickOut:!0,props:{icon:`${this.meta.sprite}#make-draft`,title:t?tr("admin::projects::make_draft::title",{domain:t}):tr("admin::projects::make_draft::short_title"),text:tr("admin::projects::make_draft::desc"),confirmButtonText:tr("admin::projects::make_draft::confirm_button"),cancelButton:!0,onConfirm:()=>this.$store.dispatch("toggleDraft",{projectId:e,isDraft:!0}),onDone:async()=>{toast.success(tr("admin::projects::make_draft::success_toast"))}}})},removeFromDrafts(){const{project_id:e,domain_title:t}=this.state.projectData;this.$store.getters.limitExceeded?flexbe.modals.bill.selectPublicSites({limit:flexbe.bill.domainLimit,selectedProjectIds:[e],selectAllPublised:!0}):As({clickOut:!0,props:{icon:`${this.meta.sprite}#remove-from-draft`,title:t?tr("admin::projects::remove_from_draft::title",{domain:t}):tr("admin::projects::remove_from_draft::short_title"),text:tr("admin::projects::remove_from_draft::desc"),confirmButtonText:tr("admin::projects::remove_from_draft::confirm_button"),cancelButton:!0,onConfirm:()=>this.$store.dispatch("toggleDraft",{projectId:e,isDraft:!1}),onDone:async()=>{toast.success(tr("admin::projects::remove_from_draft::success_toast")),this.state.temporaryPublishTag=!0,setTimeout((()=>{this.state.temporaryPublishTag=!1}),1500)}}})},transferAcceptance(){this.$store.dispatch("transferAcceptance",{projectId:this.state.projectData.project_id,transferId:this.state.projectData.transfer_id})},cancelTransfer(e){this.preventDefault(e),this.stopPropagation(e);const{project_id:t,domain_title:s}=this.state.projectData;As({clickOut:!0,props:{icon:`${this.meta.modalSprite}#info`,title:tr("admin::projects::transfer::cancel_confirm::title",{domain:s}),cancelButton:!0,confirmButtonClass:"is-danger bordered colored",onConfirm:()=>this.$store.dispatch("cancelTransferProject",{projectId:t}),onDone:async()=>{toast.success(tr("admin::projects::transfer::cancel_confirm::tip"))}}})},refuseAccess(){As({props:{icon:`${this.meta.sprite}#refuse-access`,title:tr("admin::projects::refuse_access::title"),confirmButtonText:tr("admin::projects::refuse_access::button"),cancelButton:!0,onConfirm:()=>{this.$store.dispatch("refuseAccess",{projectId:this.state.projectData.project_id})},onDone:()=>{toast.success(tr("admin::projects::refuse_access::success_notify"))},onError:e=>{toast.error(e.message)}}})},onBeforeMount(){this.state._localName=this.state.projectData.name},onMounted(){this.observer=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&(this.state.previewImage=!!this.state.projectData.img_id&&`/img/${this.state.projectData.img_id}_800.jpg`,this.observer.disconnect())}))}),{threshold:0,rootMargin:"200px 0px"}),this.observer.observe(this.root)},onUnmounted(){this.observer&&this.observer.disconnect()},stopPropagation(e){e&&e.stopPropagation()},preventDefault(e){e&&e.preventDefault()},onPointerDown(){(!this.state.isClickableItem||this.state.inDropdown||this.state.inEditingName)&&(this.state.preventClick=!0,document.addEventListener("pointerup",(()=>{setTimeout((()=>{this.state.preventClick=!1}),20)}),{once:!0}))},goToPages(){if(!this.state.isClickableItem||this.state.preventClick)return;const e=fs.commandKey?"_blank":"_self";window.open(this.meta.pagesLink,e)}},template:(e,t,s,i)=>e('<div expr228="expr228"></div><div expr279="expr279" class="admin-project-item__inner"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-project-item ",e.classNames({"is-draft":e.state.projectData.is_draft,active:e.state.isActive,"in-rename":e.state.inEditingName,disabled:e.state.waitingTransferAcceptance,clickable:e.state.isClickableItem})," ",e.props.class].join("")},{type:t.ATTRIBUTE,name:"data-project-id",evaluate:e=>e.state.projectData.project_id}]},{type:s.IF,evaluate:e=>"table"!==e.state.view,redundantAttribute:"expr228",selector:"[expr228]",template:e('<div class="site-header"><img expr229="expr229" class="favicon mr10"/><a expr230="expr230"><span expr231="expr231" is="proxy" data-is="raw"></span></a><a expr232="expr232" class="site-tag flexbe-button filled small is-primary clickable"></a><div expr234="expr234"></div><div expr248="expr248" class="flexbe-action-buttons"></div></div><div class="site-preview-wrap"><div expr251="expr251" class="site-preview"><div expr252="expr252" class="preview-image"></div></div><div expr253="expr253" class="site-transfer scrollable-content dark-scroll"></div></div><div class="site-footer"><div expr267="expr267" class="site-footer__name admin-project-name justify-between"><template expr268="expr268"></template><template expr275="expr275"></template></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["project-card flexbe-white-card shadow hoverable ",e.classNames({hover:e.state.inHover||e.state.inDropdown})].join("")},{type:t.EVENT,name:"onmouseenter",evaluate:e=>()=>e.cardHover(!0)},{type:t.EVENT,name:"onmouseleave",evaluate:e=>()=>e.cardHover(!1)}]},{redundantAttribute:"expr229",selector:"[expr229]",expressions:[{type:t.ATTRIBUTE,name:"src",evaluate:e=>e.state.favicon}]},{redundantAttribute:"expr230",selector:"[expr230]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["text-content flexbe-text site-title ",e.state.projectData.domain_is_reg?"text-dark":"text-shade"].join("")},{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.meta.pagesLink}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.state.titleHtmlContent}],redundantAttribute:"expr231",selector:"[expr231]"},{type:s.IF,evaluate:e=>e.state.showLeadsTag,redundantAttribute:"expr232",selector:"[expr232]",template:e('<span expr233="expr233" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.meta.leadsPageLink}]},{redundantAttribute:"expr233",selector:"[expr233]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>["+",e.tr("admin::projects::leads_legend",e.state.projectData.unread_leads)].join("")}]}])},{type:s.IF,evaluate:e=>e.state.showDraftTag||e.state.showPublisedTag,redundantAttribute:"expr234",selector:"[expr234]",template:e('<template expr235="expr235"></template><template expr238="expr238"></template><div expr240="expr240" is="proxy" data-is="dropdown" position="center"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["site-tag ",e.classNames({"is-secondary":e.state.showDraftTag,"is-green":e.state.showPublisedTag,clickable:e.state.showDraftTag&&!e.state.isTransferState&&e.state.allowChangeIsDraft})].join("")}]},{type:s.IF,evaluate:e=>e.state.showDraftTag,redundantAttribute:"expr235",selector:"[expr235]",template:e('<svg expr236="expr236" is="flexbe-icon" icon="draft"></svg><span expr237="expr237" class="flexbe-text"> </span>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr236",selector:"[expr236]"},{redundantAttribute:"expr237",selector:"[expr237]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::tag::draft")}]}])},{type:s.IF,evaluate:e=>e.state.showPublisedTag,redundantAttribute:"expr238",selector:"[expr238]",template:e('<span expr239="expr239" class="flexbe-text"> </span>',[{redundantAttribute:"expr239",selector:"[expr239]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::tag::published")}]}])},{type:s.IF,evaluate:e=>e.state.allowChangeIsDraft,redundantAttribute:"expr240",selector:"[expr240]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="flexbe-list opacify hoverable borderless hoverable-background round-corners"><div expr241="expr241" class="flexbe-list-item"><template expr242="expr242"></template><template expr245="expr245"></template></div></div>',bindings:[{redundantAttribute:"expr241",selector:"[expr241]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.toggleDraft()}]},{type:s.IF,evaluate:e=>e.state.isDraft,redundantAttribute:"expr242",selector:"[expr242]",template:e('<svg expr243="expr243" is="flexbe-icon" icon="publish"></svg><div expr244="expr244" class="flexbe-text"> </div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>16}],redundantAttribute:"expr243",selector:"[expr243]"},{redundantAttribute:"expr244",selector:"[expr244]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::remove_from_draft")}]}])},{type:s.IF,evaluate:e=>!e.state.isDraft,redundantAttribute:"expr245",selector:"[expr245]",template:e('<svg expr246="expr246" is="flexbe-icon" icon="draft"></svg><div expr247="expr247" class="flexbe-text"> </div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>16}],redundantAttribute:"expr246",selector:"[expr246]"},{redundantAttribute:"expr247",selector:"[expr247]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::make_draft")}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"min-width",evaluate:e=>230},{type:t.EVENT,name:"onopen",evaluate:e=>e.onOpenDropdown}]}])}])},{type:s.IF,evaluate:e=>!e.state.waitingTransferAcceptance,redundantAttribute:"expr248",selector:"[expr248]",template:e('<div class="action-button"><svg expr249="expr249" is="flexbe-icon" icon="more"></svg><div expr250="expr250" is="admin-project-item-dropdown" relative=".flexbe-white-card"></div></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr249",selector:"[expr249]"},{type:s.TAG,getComponent:i,evaluate:e=>"admin-project-item-dropdown",slots:[],attributes:[{type:t.ATTRIBUTE,name:"project-data",evaluate:e=>e.state.projectData},{type:t.EVENT,name:"onopen",evaluate:e=>e.onOpenDropdown},{type:t.EVENT,name:"onclose",evaluate:e=>e.onCloseDropdown},{type:t.ATTRIBUTE,name:"min-width",evaluate:e=>230},{type:t.ATTRIBUTE,name:"old",evaluate:e=>e.props.old},{type:t.ATTRIBUTE,name:"transfer",evaluate:e=>e.props.transfer},{type:t.ATTRIBUTE,name:"delete",evaluate:e=>e.props.delete},{type:t.ATTRIBUTE,name:"role",evaluate:e=>e.props.role},{type:t.ATTRIBUTE,name:"allow-change-is-draft",evaluate:e=>e.state.allowChangeIsDraft},{type:t.ATTRIBUTE,name:"transfer-project",evaluate:e=>e.transferProject},{type:t.ATTRIBUTE,name:"make-draft",evaluate:e=>e.makeDraft},{type:t.ATTRIBUTE,name:"remove-from-drafts",evaluate:e=>e.removeFromDrafts},{type:t.ATTRIBUTE,name:"delete-project",evaluate:e=>e.deleteProject},{type:t.ATTRIBUTE,name:"refuse-access",evaluate:e=>e.refuseAccess}],redundantAttribute:"expr250",selector:"[expr250]"}])},{redundantAttribute:"expr251",selector:"[expr251]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.goToPages},{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.onPointerDown}]},{redundantAttribute:"expr252",selector:"[expr252]",expressions:[{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.state.previewStyle}]},{type:s.IF,evaluate:e=>e.state.isTransferState,redundantAttribute:"expr253",selector:"[expr253]",template:e('<div class="site-transfer-container"><svg expr254="expr254" is="flexbe-icon" icon="transfer-big"></svg><svg expr255="expr255" is="flexbe-icon" icon="transfer-progress-big"></svg><div expr256="expr256" class="flexbe-title"></div><div expr257="expr257" class="flexbe-title"></div><template expr258="expr258"></template><div expr261="expr261" class="flexbe-desc" is="proxy" data-is="raw"></div><div expr262="expr262" class="flexbe-buttons-line centered"></div></div>',[{type:s.IF,evaluate:e=>e.state.waitingTransferAcceptance||e.state.waitingTransferAcceptanceFromRecipient,redundantAttribute:"expr254",selector:"[expr254]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>28}]}])},{type:s.IF,evaluate:e=>e.state.transferInProgress||e.state.incomingTransferInProgress,redundantAttribute:"expr255",selector:"[expr255]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>28}]}])},{type:s.IF,evaluate:e=>e.state.transferInProgress,redundantAttribute:"expr256",selector:"[expr256]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::transfer::submitted_title")].join("")}]}])},{type:s.IF,evaluate:e=>e.state.incomingTransferInProgress,redundantAttribute:"expr257",selector:"[expr257]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::transfer::incoming_title")].join("")}]}])},{type:s.IF,evaluate:e=>e.state.waitingTransferAcceptance,redundantAttribute:"expr258",selector:"[expr258]",template:e('<div expr259="expr259" class="flexbe-title"> </div><div expr260="expr260" class="flexbe-desc"> </div>',[{redundantAttribute:"expr259",selector:"[expr259]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::transfer::acceptance::title",{domain:e.state.projectData.domain_title})].join("")}]},{redundantAttribute:"expr260",selector:"[expr260]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::transfer::acceptance::desc")].join("")}]}])},{type:s.IF,evaluate:e=>e.state.waitingTransferAcceptanceFromRecipient,redundantAttribute:"expr261",selector:"[expr261]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::projects::transfer::text",{email:e.state.waitingTransfer.email})}]}])},{type:s.IF,evaluate:e=>e.state.waitingTransferAcceptanceFromRecipient||e.state.waitingTransferAcceptance,redundantAttribute:"expr262",selector:"[expr262]",template:e('<div expr263="expr263" class="flexbe-button is-white filled rounded"></div><div expr265="expr265" class="flexbe-button is-dark bordered filling rounded"></div>',[{type:s.IF,evaluate:e=>e.state.waitingTransferAcceptance,redundantAttribute:"expr263",selector:"[expr263]",template:e('<span expr264="expr264" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.transferAcceptance(e.state.projectData.project_id)}]},{redundantAttribute:"expr264",selector:"[expr264]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::transfer::confirm_button")}]}])},{type:s.IF,evaluate:e=>e.state.waitingTransferAcceptanceFromRecipient||e.state.waitingTransferAcceptance,redundantAttribute:"expr265",selector:"[expr265]",template:e('<span expr266="expr266" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.cancelTransfer}]},{redundantAttribute:"expr266",selector:"[expr266]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::cancellation")}]}])}])}])},{redundantAttribute:"expr267",selector:"[expr267]",expressions:[{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.startEditingName}]},{type:s.IF,evaluate:e=>!e.state.inEditingName||!e.state.canRename,redundantAttribute:"expr268",selector:"[expr268]",template:e('<div expr269="expr269"><span expr270="expr270" is="proxy" data-is="raw"></span></div><div expr271="expr271" class="flexbe-button style-text edit-button"></div><div expr273="expr273" class="flexbe-button filled is-secondary active rename-done-button"></div>',[{redundantAttribute:"expr269",selector:"[expr269]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["text-content flexbe-text site-title ",e.state.projectData.name?"text-dark":"text-shade"].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.state.nameHtmlContent}],redundantAttribute:"expr270",selector:"[expr270]"},{type:s.IF,evaluate:e=>e.state.canRename&&!e.state.renameDoneState,redundantAttribute:"expr271",selector:"[expr271]",template:e('<div expr272="expr272" is="flexbe-icon" icon="rename"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr272",selector:"[expr272]"}])},{type:s.IF,evaluate:e=>e.state.renameDoneState,redundantAttribute:"expr273",selector:"[expr273]",template:e('<div expr274="expr274" is="flexbe-loader"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[{type:t.ATTRIBUTE,name:"done",evaluate:e=>!0}],redundantAttribute:"expr274",selector:"[expr274]"}])}])},{type:s.IF,evaluate:e=>e.state.inEditingName&&e.state.canRename,redundantAttribute:"expr275",selector:"[expr275]",template:e('<div expr276="expr276" is="flexbe-input"></div><div expr277="expr277" class="flexbe-button is-secondary filled"><div expr278="expr278" is="flexbe-icon" icon="apply"></div></div>',[{type:s.IF,evaluate:e=>e.state.inEditingName&&e.state.canRename,redundantAttribute:"expr276",selector:"[expr276]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state._localName},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::projects::name::placeholder")},{type:t.ATTRIBUTE,name:"blur-on-escape",evaluate:e=>!0},{type:t.EVENT,name:"oninput",evaluate:e=>e.setLocalProjectName},{type:t.EVENT,name:"onblur",evaluate:e=>e.setProjectName},{type:t.EVENT,name:"onenter",evaluate:e=>e.setProjectName},{type:t.EVENT,name:"onescape",evaluate:e=>e.revertLastProjectName},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0}]}])},{redundantAttribute:"expr277",selector:"[expr277]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.setProjectName}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>14}],redundantAttribute:"expr278",selector:"[expr278]"}])}])},{type:s.IF,evaluate:e=>"table"===e.state.view,redundantAttribute:"expr279",selector:"[expr279]",template:e('<div expr280="expr280" class="admin-project-item__row row flex-nowrap"><div class="admin-project-item__col col col-1 preview-col"><div expr281="expr281"><svg expr282="expr282" is="flexbe-icon" icon="transfer-big"></svg><svg expr283="expr283" is="flexbe-icon" icon="transfer-progress-big"></svg></div></div><div class="admin-project-item__col col admin-project-col-name"><div expr284="expr284" class="admin-project-name"><template expr285="expr285"></template><template expr292="expr292"></template></div></div><div class="admin-project-item__col col col-3"><a expr296="expr296"><span expr297="expr297" is="proxy" data-is="raw"></span></a></div><div class="admin-project-item__col col col-2"><div expr298="expr298" class="text-content flexbe-text"> </div></div><div expr299="expr299" class="admin-project-item__col col col-2"><div expr300="expr300"></div></div><div expr314="expr314" class="admin-project-item__col col"></div></div><div expr317="expr317" class="flexbe-bar flexbe-bar--info rounded text-s"></div>',[{redundantAttribute:"expr280",selector:"[expr280]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.goToPages},{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.onPointerDown}]},{redundantAttribute:"expr281",selector:"[expr281]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["preview-image ",e.classNames({darken:e.state.isTransferState})].join("")},{type:t.ATTRIBUTE,name:"style",evaluate:e=>e.state.previewStyle}]},{type:s.IF,evaluate:e=>e.state.waitingTransferAcceptance||e.state.waitingTransferAcceptanceFromRecipient,redundantAttribute:"expr282",selector:"[expr282]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>28}]}])},{type:s.IF,evaluate:e=>e.state.transferInProgress||e.state.incomingTransferInProgress,redundantAttribute:"expr283",selector:"[expr283]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>28}]}])},{redundantAttribute:"expr284",selector:"[expr284]",expressions:[{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.startEditingName}]},{type:s.IF,evaluate:e=>!e.state.inEditingName||!e.state.canRename,redundantAttribute:"expr285",selector:"[expr285]",template:e('<div expr286="expr286"><span expr287="expr287" is="proxy" data-is="raw"></span></div><div expr288="expr288" class="flexbe-button style-text edit-button"></div><div expr290="expr290" class="flexbe-button filled is-secondary active rename-done-button"></div>',[{redundantAttribute:"expr286",selector:"[expr286]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["text-content flexbe-text site-title ",e.state.projectData.name?"text-dark":"text-shade"].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.state.nameHtmlContent}],redundantAttribute:"expr287",selector:"[expr287]"},{type:s.IF,evaluate:e=>e.state.canRename&&!e.state.renameDoneState,redundantAttribute:"expr288",selector:"[expr288]",template:e('<div expr289="expr289" is="flexbe-icon" icon="rename"></div>',[{expressions:[{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.startEditingName}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr289",selector:"[expr289]"}])},{type:s.IF,evaluate:e=>e.state.renameDoneState,redundantAttribute:"expr290",selector:"[expr290]",template:e('<div expr291="expr291" is="flexbe-loader"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[{type:t.ATTRIBUTE,name:"done",evaluate:e=>!0}],redundantAttribute:"expr291",selector:"[expr291]"}])}])},{type:s.IF,evaluate:e=>e.state.inEditingName&&e.state.canRename,redundantAttribute:"expr292",selector:"[expr292]",template:e('<div expr293="expr293" is="flexbe-input"></div><div expr294="expr294" class="flexbe-button is-secondary filled"><div expr295="expr295" is="flexbe-icon" icon="apply"></div></div>',[{type:s.IF,evaluate:e=>e.state.inEditingName&&e.state.canRename,redundantAttribute:"expr293",selector:"[expr293]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state._localName},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::projects::name::placeholder")},{type:t.ATTRIBUTE,name:"blur-on-escape",evaluate:e=>!0},{type:t.EVENT,name:"oninput",evaluate:e=>e.setLocalProjectName},{type:t.EVENT,name:"onblur",evaluate:e=>e.setProjectName},{type:t.EVENT,name:"onenter",evaluate:e=>e.setProjectName},{type:t.EVENT,name:"onescape",evaluate:e=>e.revertLastProjectName},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0}]}])},{redundantAttribute:"expr294",selector:"[expr294]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.setProjectName}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>14}],redundantAttribute:"expr295",selector:"[expr295]"}])},{redundantAttribute:"expr296",selector:"[expr296]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["text-content flexbe-text site-title ",e.state.projectData.domain_is_reg?"text-dark":"text-shade"].join("")},{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.meta.pagesLink}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.state.titleHtmlContent}],redundantAttribute:"expr297",selector:"[expr297]"},{redundantAttribute:"expr298",selector:"[expr298]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.lastSaveDateString].join("")}]},{redundantAttribute:"expr299",selector:"[expr299]",expressions:[{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.stopPropagation}]},{type:s.IF,evaluate:e=>e.state.showDraftTag||e.state.showPublisedTag,redundantAttribute:"expr300",selector:"[expr300]",template:e('<template expr301="expr301"></template><template expr304="expr304"></template><div expr306="expr306" is="proxy" data-is="dropdown" position="center"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["site-tag ",e.classNames({"is-secondary":e.state.showDraftTag,"is-green":e.state.showPublisedTag,clickable:!e.state.isTransferState&&e.state.allowChangeIsDraft})].join("")}]},{type:s.IF,evaluate:e=>e.state.showDraftTag,redundantAttribute:"expr301",selector:"[expr301]",template:e('<svg expr302="expr302" is="flexbe-icon" icon="draft"></svg><span expr303="expr303" class="flexbe-text"> </span>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr302",selector:"[expr302]"},{redundantAttribute:"expr303",selector:"[expr303]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::tag::draft")}]}])},{type:s.IF,evaluate:e=>e.state.showPublisedTag,redundantAttribute:"expr304",selector:"[expr304]",template:e('<span expr305="expr305" class="flexbe-text"> </span>',[{redundantAttribute:"expr305",selector:"[expr305]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::tag::published")}]}])},{type:s.IF,evaluate:e=>e.state.allowChangeIsDraft,redundantAttribute:"expr306",selector:"[expr306]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="flexbe-list opacify hoverable borderless hoverable-background round-corners"><div expr307="expr307" class="flexbe-list-item"><template expr308="expr308"></template><template expr311="expr311"></template></div></div>',bindings:[{redundantAttribute:"expr307",selector:"[expr307]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.toggleDraft()}]},{type:s.IF,evaluate:e=>e.state.isDraft,redundantAttribute:"expr308",selector:"[expr308]",template:e('<svg expr309="expr309" is="flexbe-icon" icon="publish"></svg><div expr310="expr310" class="flexbe-text"> </div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>16}],redundantAttribute:"expr309",selector:"[expr309]"},{redundantAttribute:"expr310",selector:"[expr310]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::remove_from_draft")}]}])},{type:s.IF,evaluate:e=>!e.state.isDraft,redundantAttribute:"expr311",selector:"[expr311]",template:e('<svg expr312="expr312" is="flexbe-icon" icon="draft"></svg><div expr313="expr313" class="flexbe-text"> </div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>16}],redundantAttribute:"expr312",selector:"[expr312]"},{redundantAttribute:"expr313",selector:"[expr313]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::make_draft")}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"min-width",evaluate:e=>230},{type:t.EVENT,name:"onopen",evaluate:e=>e.onOpenDropdown}]}])}])},{type:s.IF,evaluate:e=>!e.state.waitingTransferAcceptance,redundantAttribute:"expr314",selector:"[expr314]",template:e('<div class="flexbe-action-buttons"><div class="action-button"><svg expr315="expr315" is="flexbe-icon" icon="more"></svg><div expr316="expr316" is="admin-project-item-dropdown" relative=".flexbe-white-card"></div></div></div>',[{expressions:[{type:t.EVENT,name:"onpointerdown",evaluate:e=>e.stopPropagation}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr315",selector:"[expr315]"},{type:s.TAG,getComponent:i,evaluate:e=>"admin-project-item-dropdown",slots:[],attributes:[{type:t.ATTRIBUTE,name:"project-data",evaluate:e=>e.state.projectData},{type:t.EVENT,name:"onopen",evaluate:e=>e.onOpenDropdown},{type:t.EVENT,name:"onclose",evaluate:e=>e.onCloseDropdown},{type:t.ATTRIBUTE,name:"min-width",evaluate:e=>230},{type:t.ATTRIBUTE,name:"old",evaluate:e=>e.props.old},{type:t.ATTRIBUTE,name:"transfer",evaluate:e=>e.props.transfer},{type:t.ATTRIBUTE,name:"delete",evaluate:e=>e.props.delete},{type:t.ATTRIBUTE,name:"role",evaluate:e=>e.props.role},{type:t.ATTRIBUTE,name:"allow-change-is-draft",evaluate:e=>e.state.allowChangeIsDraft},{type:t.ATTRIBUTE,name:"transfer-project",evaluate:e=>e.transferProject},{type:t.ATTRIBUTE,name:"make-draft",evaluate:e=>e.makeDraft},{type:t.ATTRIBUTE,name:"remove-from-drafts",evaluate:e=>e.removeFromDrafts},{type:t.ATTRIBUTE,name:"delete-project",evaluate:e=>e.deleteProject},{type:t.ATTRIBUTE,name:"refuse-access",evaluate:e=>e.refuseAccess}],redundantAttribute:"expr316",selector:"[expr316]"}])},{type:s.IF,evaluate:e=>e.state.isTransferState,redundantAttribute:"expr317",selector:"[expr317]",template:e('<svg expr318="expr318" is="flexbe-icon" icon="icon-info"></svg><div expr319="expr319" class="flexbe-text"></div><div expr320="expr320" class="flexbe-text"></div><div expr321="expr321" class="flexbe-text"></div><div expr322="expr322" class="flexbe-text"></div><div class="inline-box ml-auto"><template expr323="expr323"></template><div expr325="expr325" class="style-link underline is-light"></div></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr318",selector:"[expr318]"},{type:s.IF,evaluate:e=>e.state.waitingTransferAcceptance,redundantAttribute:"expr319",selector:"[expr319]",template:e(" <br/> ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::transfer::acceptance::title",{domain:e.state.projectData.domain_title})].join("")},{type:t.TEXT,childNodeIndex:2,evaluate:e=>[e.tr("admin::projects::transfer::acceptance::desc")].join("")}]}])},{type:s.IF,evaluate:e=>e.state.transferInProgress,redundantAttribute:"expr320",selector:"[expr320]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::transfer::submitted_title"),"."].join("")}]}])},{type:s.IF,evaluate:e=>e.state.incomingTransferInProgress,redundantAttribute:"expr321",selector:"[expr321]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::transfer::incoming_title"),"."].join("")}]}])},{type:s.IF,evaluate:e=>e.state.waitingTransferAcceptanceFromRecipient,redundantAttribute:"expr322",selector:"[expr322]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::transfer::title"),". ",e.tr("admin::projects::transfer::email_desc",{email:e.state.waitingTransfer.email})].join("")}]}])},{type:s.IF,evaluate:e=>e.state.waitingTransferAcceptance,redundantAttribute:"expr323",selector:"[expr323]",template:e('<div expr324="expr324" class="style-link underline"> </div><div class="flexbe-separator small-gap"></div>',[{redundantAttribute:"expr324",selector:"[expr324]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::transfer::confirm_button")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.transferAcceptance(e.state.projectData.project_id)}]}])},{type:s.IF,evaluate:e=>e.state.waitingTransferAcceptanceFromRecipient||e.state.waitingTransferAcceptance,redundantAttribute:"expr325",selector:"[expr325]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::button::cancellation")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.cancelTransfer}]}])}])}])}]),name:"admin-project-item"};e(Yl.name,Yl);const Jl={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get projectData(){return e.props.projectData},get waitingTransfer(){return this.projectData.waiting_transfer},get domainLink(){return this.projectData.domain_link},get showDomainsItem(){return!this.projectData.domain_is_reg&&"manager"!==this.projectData.role},get showLeadsItem(){return 1!==this.projectData.version_id},get allowChangeIsDraft(){var t;return null==(t=e.props.allowChangeIsDraft)||t}},this.meta={sprite:at("projects","admin")}},getLinkForProject(e){return`${this.state.domainLink}/admin/auth/?go=/${e}`}},template:(e,t,s,i)=>e('<div expr326="expr326" class="menu-list" is="proxy" data-is="dropdown" position="center"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-project-item-dropdown ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="editor-items-list"><div class="flexbe-list borderless opacify hoverable hoverable-background vertical-gaps"><a expr327="expr327" class="flexbe-list-item"></a><a expr330="expr330" class="flexbe-list-item"><svg expr331="expr331" is="flexbe-icon" icon="pages"></svg><span expr332="expr332" class="flexbe-text"> </span></a><a expr333="expr333" class="flexbe-list-item"></a><a expr336="expr336" class="flexbe-list-item"></a><a expr339="expr339" class="flexbe-list-item"></a><a expr342="expr342" class="flexbe-list-item"></a><a expr345="expr345" class="flexbe-list-item"></a><a expr348="expr348" class="flexbe-list-item"></a><template expr351="expr351"></template><hr class="flexbe-hr m0"/><a expr358="expr358" class="flexbe-list-item"></a><a expr361="expr361" class="flexbe-list-item"></a></div></div>',bindings:[{type:s.IF,evaluate:e=>e.state.showDomainsItem,redundantAttribute:"expr327",selector:"[expr327]",template:e('<svg expr328="expr328" is="flexbe-icon" icon="globe"></svg><span expr329="expr329" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.getLinkForProject("admin/settings/domains/")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr328",selector:"[expr328]"},{redundantAttribute:"expr329",selector:"[expr329]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::connect_domain")}]}])},{redundantAttribute:"expr330",selector:"[expr330]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.getLinkForProject("admin/pages/")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr331",selector:"[expr331]"},{redundantAttribute:"expr332",selector:"[expr332]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::pages")}]},{type:s.IF,evaluate:e=>"manager"!==e.state.projectData.role,redundantAttribute:"expr333",selector:"[expr333]",template:e('<svg expr334="expr334" is="flexbe-icon" icon="ecommerce"></svg><span expr335="expr335" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.getLinkForProject("admin/ecommerce/")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr334",selector:"[expr334]"},{redundantAttribute:"expr335",selector:"[expr335]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::ecommerce")}]}])},{type:s.IF,evaluate:e=>e.state.showLeadsItem,redundantAttribute:"expr336",selector:"[expr336]",template:e('<svg expr337="expr337" is="flexbe-icon" icon="leads"></svg><span expr338="expr338" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.getLinkForProject("admin/lead/")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr337",selector:"[expr337]"},{redundantAttribute:"expr338",selector:"[expr338]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::leads")}]}])},{type:s.IF,evaluate:e=>"manager"!==e.state.projectData.role&&1!==e.state.projectData.version_id,redundantAttribute:"expr339",selector:"[expr339]",template:e('<svg expr340="expr340" is="flexbe-icon" icon="analytics"></svg><span expr341="expr341" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.getLinkForProject("admin/stat/")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr340",selector:"[expr340]"},{redundantAttribute:"expr341",selector:"[expr341]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::analytics")}]}])},{type:s.IF,evaluate:e=>e.props.old,redundantAttribute:"expr342",selector:"[expr342]",template:e('<svg expr343="expr343" is="flexbe-icon" icon="pay-old"></svg><span expr344="expr344" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.getLinkForProject("admin/user/pay/")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr343",selector:"[expr343]"},{redundantAttribute:"expr344",selector:"[expr344]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::payment")}]}])},{type:s.IF,evaluate:e=>"manager"!==e.state.projectData.role,redundantAttribute:"expr345",selector:"[expr345]",template:e('<svg expr346="expr346" is="flexbe-icon" icon="settings"></svg><span expr347="expr347" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.getLinkForProject(e.props.old?"admin/settings/domains/":"admin/settings/general/")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr346",selector:"[expr346]"},{redundantAttribute:"expr347",selector:"[expr347]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::settings")}]}])},{type:s.IF,evaluate:e=>e.props.transfer&&"owner"===e.state.projectData.role&&!e.state.waitingTransfer,redundantAttribute:"expr348",selector:"[expr348]",template:e('<svg expr349="expr349" is="flexbe-icon" icon="transfer"></svg><span expr350="expr350" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.props.transferProject}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>16}],redundantAttribute:"expr349",selector:"[expr349]"},{redundantAttribute:"expr350",selector:"[expr350]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::transfer")}]}])},{type:s.IF,evaluate:e=>e.state.allowChangeIsDraft,redundantAttribute:"expr351",selector:"[expr351]",template:e('<a expr352="expr352" class="flexbe-list-item"></a><a expr355="expr355" class="flexbe-list-item"></a>',[{type:s.IF,evaluate:e=>!e.state.projectData.is_draft,redundantAttribute:"expr352",selector:"[expr352]",template:e('<svg expr353="expr353" is="flexbe-icon" icon="draft"></svg><span expr354="expr354" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.props.makeDraft}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>16}],redundantAttribute:"expr353",selector:"[expr353]"},{redundantAttribute:"expr354",selector:"[expr354]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::make_draft")}]}])},{type:s.IF,evaluate:e=>e.state.projectData.is_draft,redundantAttribute:"expr355",selector:"[expr355]",template:e('<svg expr356="expr356" is="flexbe-icon" icon="publish"></svg><span expr357="expr357" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.props.removeFromDrafts}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>16}],redundantAttribute:"expr356",selector:"[expr356]"},{redundantAttribute:"expr357",selector:"[expr357]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::remove_from_draft")}]}])}])},{type:s.IF,evaluate:e=>e.props.delete&&"owner"===e.state.projectData.role&&!e.state.waitingTransfer,redundantAttribute:"expr358",selector:"[expr358]",template:e('<svg expr359="expr359" is="flexbe-icon" icon="delete"></svg><span expr360="expr360" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>null==e.props.deleteProject?void 0:e.props.deleteProject(e.state.projectData.project_id,e.state.projectData.domain_title,e.state.projectData.domain_link)}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr359",selector:"[expr359]"},{redundantAttribute:"expr360",selector:"[expr360]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::remove_project_menu")}]}])},{type:s.IF,evaluate:e=>"owner"!==e.state.projectData.role,redundantAttribute:"expr361",selector:"[expr361]",template:e('<svg expr362="expr362" is="flexbe-icon" icon="renouncement"></svg><span expr363="expr363" class="flexbe-text"> </span>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>null==e.props.refuseAccess?void 0:e.props.refuseAccess(e.state.projectData.project_id)}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr362",selector:"[expr362]"},{redundantAttribute:"expr363",selector:"[expr363]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::projects::dropdown::refuse_access_menu")}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"autohide",evaluate:e=>!0},{type:t.ATTRIBUTE,name:null,evaluate:e=>e.props}],redundantAttribute:"expr326",selector:"[expr326]"}]),name:"admin-project-item-dropdown"};e(Jl.name,Jl),riot3.tag2("admin-stat-list",'<header> <div class="flexbe-title text-title"> {tr(\'admin::stat::list::title\')} </div> </header> <div class="group-list pb40"> <div class="group-item dayly-stat"> <div class="flexbe-title section-title text-subtitle data-view-control inline-box"> <span class="flexbe-text">{tr(\'admin::stat::list::days_title\')}</span> <div if="{dailyView === \'chart\'}" class="chart-toggle"> <div each="{graph in dailyGraphs}" onclick="{toggleDailyKey.bind(this, graph)}" riot-style="color: {graph.color}" class="toggle-option {active: graph.active}"> <svg viewbox="0 0 12 12" class="flexbe-icon size-12"> <use riot-xmlns:xlink="http://www.w3.org/1999/xlink" riot-href="{sprite}#option-mark"></use> </svg> <span class="flexbe-text text-sm">{graph.title}</span> </div> </div> <div data-is="admin-stat-list-export" type="day" class="mr20 ml-auto"></div> <div data-is="flexbe-buttons-line" class="is-group view-types not-equal" button-class="small" list="{viewOptions}" riot-value="{dailyView}" onchange="{setDailyView}" role="selector"> </div> </div> <table class="flexbe-table hoverable text-center block" if="{dailyView === \'table\'}"> <thead class="text-note text-shade"> <tr> <th class="text-left">{tr(\'admin::stat::list::table::day_header\')}</th> <th>{tr(\'admin::stat::list::table::visitors_header\')}</th> <th>{tr(\'admin::stat::list::table::new_visitors_header\')}</th> <th>{tr(\'admin::stat::list::table::leads_header\')}</th> <th>{tr(\'admin::stat::list::table::conversion_header\')}</th> </tr> </thead> <tbody> <tr each="{item in monthTable}"> <td class="text-left">{item.date_format}</td> <td>{item.cnt_v}</td> <td>{item.cnt_u}</td> <td>{item.leads}</td> <td>{item.conversion}%</td> </tr> </tbody> </table> <div if="{dailyView === \'chart\'}" class="flexbe-white-box shadow p0"> <chart data="{monthData}" base="index" keys="{dailyKeys}" base-grid="day" legend="{legend}" gradient="1" colors="{dailyColors}"> </chart> </div> </div> <div class="group-item daily-stat"> <div class="flexbe-title section-title text-subtitle data-view-control inline-box"> <span class="flexbe-text">{tr(\'admin::stat::list::months_title\')}</span> <div if="{monthlyView === \'chart\'}" class="chart-toggle"> <div each="{graph in monthlyGraphs}" onclick="{toggleMonthlyKey.bind(this, graph)}" riot-style="color: {graph.color}" class="toggle-option {active: graph.active}"> <svg viewbox="0 0 12 12" class="flexbe-icon size-12"> <use riot-xmlns:xlink="http://www.w3.org/1999/xlink" riot-href="{sprite}#option-mark"></use> </svg> <span class="flexbe-text text-sm">{graph.title}</span> </div> </div> <div data-is="admin-stat-list-export" class="mr20 ml-auto" type="month"></div> <div data-is="flexbe-buttons-line" list="{viewOptions}" riot-value="{monthlyView}" onchange="{setYearView}" role="selector" button-class="small" class="is-group view-types not-equal"> </div> </div> <div if="{monthlyView === \'table\'}" class=""> <table class="flexbe-table hoverable text-center block"> <thead class="text-note text-shade"> <tr> <th class="text-left">{tr(\'admin::stat::list::table::month_header\')}</th> <th>{tr(\'admin::stat::list::table::visitors_header\')}</th> <th>{tr(\'admin::stat::list::table::new_visitors_header\')}</th> <th>{tr(\'admin::stat::list::table::leads_header\')}</th> <th>{tr(\'admin::stat::list::table::conversion_header\')}</th> </tr> </thead> <tbody> <tr each="{item in yearTable}"> <td class="text-left">{item.date_format}</td> <td>{item.cnt_v}</td> <td>{item.cnt_u}</td> <td>{item.leads}</td> <td>{item.conversion}%</td> </tr> </tbody> </table> </div> <div if="{monthlyView === \'chart\'}" class="flexbe-white-box shadow p0"> <chart data="{yearData}" base="index" keys="{monthlyKeys}" base-grid="month" legend="{legend}" gradient="1" colors="{monthlyColors}"> </chart> </div> </div> </div>',"",'class="admin-content admin-stat-list container"',(function(e){this.main=this,this.viewOptions=[{title:tr("admin::stat::list::chart::tab_table"),value:"chart"},{title:tr("admin::stat::list::table::tab_name"),value:"table"}],this.dailyKeys=["visitors","leads"],this.monthlyKeys=["visitors","leads"],this.dailyGraphs=[{key:"visitors",title:tr("admin::stat::list::chart::visits_label"),active:!0,color:"#87a4ff",index:0},{key:"leads",title:tr("admin::stat::list::chart::leads_label"),active:!0,color:"#6CDE88",index:1}],this.monthlyGraphs=[{key:"visitors",title:tr("admin::stat::list::chart::visits_label"),active:!0,color:"#87a4ff",index:0},{key:"leads",title:tr("admin::stat::list::chart::leads_label"),active:!0,color:"#6CDE88",index:1}],this.monthData=[],this.yearData=[],this.sprite=at("stat","admin"),this.dailyView=window.localStorage.getItem("f_stat_daily_view")||"chart",this.monthlyView=window.localStorage.getItem("f_stat_monthly_view")||"chart",this.legend={titleKey:"date",props:[{key:"visitors",mask:"admin::stat::list::chart::visitors_legend"},{key:"leads",mask:"admin::stat::list::chart::leads_legend"},{key:"conversion",mask:"admin::stat::list::chart::conversion_legend"}]},this.dailyColors=["#87a4ff","#6CDE88"],this.monthlyColors=["#87a4ff","#6CDE88"],this.data={month:JSON.parse(e.dataStat),year:JSON.parse(e.dataYear)},this.dailyPircent=100/(this.data.month.length-1),this.toggleDailyKey=function(e){e.active&&1===this.dailyKeys.length&&this.toggleDailyKey(this.dailyGraphs[1===e.index?0:1]),this.update({dailyView:"none"}),e.active=!e.active,e.active?(this.dailyKeys.splice(e.index,0,e.key),this.dailyColors.splice(e.index,0,e.color)):(this.dailyKeys.splice(e.index,1),this.dailyColors.splice(e.index,1)),this.update({dailyView:"chart"})}.bind(this),this.toggleMonthlyKey=function(e){e.active&&1===this.monthlyKeys.length&&this.toggleMonthlyKey(this.monthlyGraphs[1===e.index?0:1]),this.update({monthlyView:"none"}),e.active=!e.active,e.active?(this.monthlyKeys.splice(e.index,0,e.key),this.monthlyColors.splice(e.index,0,e.color)):(this.monthlyKeys.splice(e.index,1),this.monthlyColors.splice(e.index,1)),this.update({monthlyView:"chart"})}.bind(this),this.setDailyView=function(e){window.localStorage.setItem("f_stat_daily_view",e.value),this.update({dailyView:e.value})}.bind(this),this.setYearView=function(e){window.localStorage.setItem("f_stat_monthly_view",e.value),this.update({monthlyView:e.value})}.bind(this),this.updateLegend=function(e,t,s,i){this.dailyLegend.index=e,this.dailyLegend.date=i.date,this.dailyLegend.visitors=i.visitors,this.dailyLegend.leads=i.leads,this.dailyLegend.conversion=i.conversion,this.update()}.bind(this),this.updateCharts=function(){this.monthTable=this.data.month.slice(),this.monthTable.sort(((e,t)=>t.time-e.time));const e=this.data.month.map((e=>+e.cnt_v)),t=this.data.month.map((e=>+e.leads));e.reduce(((e,t)=>Math.max(e,t))),t.reduce(((e,t)=>Math.max(e,t))),this.data.month.sort(((e,t)=>e.time-t.time)),this.data.month.forEach(((e,t)=>{const s=Ze({date:new Date(1e3*e.time),timezone:flexbe.vars.group.timezone});this.monthData.push({index:t,time:1e3*e.time,day:s.getDate(),date:e.date_format,visitors:+e.cnt_v,conversion:e.conversion,leads:+e.leads})})),this.yearTable=this.data.year.slice(),this.yearTable.sort(((e,t)=>t.time-e.time)),this.data.year.sort(((e,t)=>e.time-t.time)),this.data.year.forEach(((e,t)=>{this.yearData.push({index:t,time:1e3*e.time,month:e.date_format.substr(0,3),date:e.date_format,visitors:+e.cnt_v,conversion:e.conversion,leads:+e.leads})})),this.update()}.bind(this),this.on("mount",(()=>{this.updateCharts(),this.root.removeAttribute("data-stat"),this.root.removeAttribute("data-year")}))})),riot3.tag2("admin-stat-list-export",'<div class="export-button"> <svg class="flexbe-icon size-16" viewbox="0 0 16 16"> <path d="M14 14V12H16V15C16 15.5523 15.5523 16 15 16H1C0.447715 16 0 15.5523 0 15V12H2V14H14ZM9 0V8.3L11.6 5.6L13 7L8 12L3 7L4.4 5.6L7 8.3V0H9Z"></path> </svg> <dropdown position="start" autohide="{true}" arrow-pad="{20}"> <div class="dropdown-header"> <div class="flexbe-title">{tr(\'admin::stat::export::title\')}</div> <div class="flexbe-desc">{tag.state.desc}</div> </div> <div class="flexbe-list opacify hoverable hoverable-background round-corners-bottom"> <a class="flexbe-list-item" target="_blank" riot-href="{tag.getHref(\'xls\')}" download> <span class="flexbe-text">{tr(\'admin::lead::export::to_xls\')}</span> </a> <a class="flexbe-list-item" target="_blank" riot-href="{tag.getHref(\'csv\')}" download> <span class="flexbe-text">{tr(\'admin::lead::export::to_csv\')}</span> </a> </div> </dropdown> </div>',"",'class="admin-stat-list-export {opts.class}"',(function(e){this.state={get desc(){return tr(`admin::stat::export::desc_${e.type}`)}},this.getHref=function(t){return`/admin/api/project/${flexbe.vars.group.id}/stat/export/${t}/?type=${e.type}`}.bind(this)})),riot3.tag2("chart",'<div class="stat-chart-outer" riot-style="padding: 0 {padding}px;"> <svg class="gradients-list"> <defs> <lineargradient each="{color, index in rgbas}" riot-id="gradient-{uniqueId}-{color.original}" x1="0%" x2="0%" y1="0%" y2="100%"> <stop offset="0%" stop-color="{color.colors[0]}" stop-opacity="0.2"></stop> <stop offset="100%" stop-color="{color.colors[1]}" stop-opacity="0"></stop> </linearGradient> </defs> </svg> <div class="stat-chart"> <div class="chart-inner" riot-style="margin: 0 -{padding}px;" ref="chart" riot-id="chart_{this.uniqueId}"></div> <div if="{baseGrid}" class="base-grid" riot-style="margin-right: -{gridMargins}%; margin-left: -{gridMargins}%;"> <div each="{item in baseGrid}" class="grid-item"> <span class="item-title {active: item.active}"> {item.title} </span> </div> </div> <div if="{legend && activeLegend}" class="chart-legend {\'left-sided\': legend.side === \'left\', \'show\': legend.side}" riot-style=" left: {legend.margin}%"> <div class="chart-legend-inner"> <div class="legend-title">{legend.title}</div> <div each="{prop in legend.props}" class="legend-prop">{prop.string}</div> </div> </div> </div> </div>',"","",(function(e){this.uniqueId=(1e9*Math.random()).toString().split(".")[0],this.data=e.data,this.xKey=e.base,this.xGrid=e.baseGrid,this.keys=e.keys,this.padding=e.padding||25,this.colors=e.colors||["#87a4ff","#6CDE88"],this.legend=e.legend,this.firstHover=!1,this.activeLegend=!1,this.gradient=e.gradient,this.fill=e.fill,this.legend.side="left",this.updateLegend=function(e,t,s,i){if(this.activeLegend=this.firstHover,this.firstHover=!0,!this.legend)return!1;this.width-this.width/this.data.length*e<200?this.legend.side="left":this.legend.side="right",this.legend.index=e,1===this.data.length?this.legend.margin=50:this.legend.margin=this.percent*e,this.legend.title=i[this.legend.titleKey],this.baseGrid&&this.setGridActive(e),this.legend.props.map((e=>{const t={};return t.count=i[e.key],e.string=tr(e.mask,t),e})),$(this.refs.chart).find(".point-circle-large, .point-circle-small").removeClass("active"),$(this.refs.chart).find(`.point-circle-large[data-index="${e}"], .point-circle-small[data-index="${e}"]`).addClass("active"),this.setHoverForFF(),this.update()}.bind(this),this.setHoverForFF=function(){window.navigator&&window.navigator.userAgent.includes("Firefox")&&($(this.refs.chart).find(".point-circle-large, .point-circle-small").attr("r",4),$(this.refs.chart).find(".point-circle-large.active").attr("r",14),$(this.refs.chart).find(".point-circle-small.active").attr("r",10))}.bind(this),this.options={element:`chart_${this.uniqueId}`,data:this.data,xkey:this.xKey,ykeys:this.keys,labels:this.keys,lineColors:this.colors,lineWidth:1,pointSize:4,hoverPointSizePlus:0,gridLineColor:["#DADADA"],continuousLine:!0,pointFillColors:["#ffffff"],behaveLikeLine:!0,padding:this.padding,axes:!1,pointStrokeColors:this.colors,smooth:!1,hoverCallback:this.updateLegend},this.updateGrid=function(){this.baseGrid=this.data.map((e=>({index:e[this.xKey],title:e[this.xGrid]}))),this.gridMargins=55/this.data.length,this.update()}.bind(this),this.setGridActive=function(e){this.baseGrid.forEach(((t,s)=>{if(s===e)return t.active=!0,!0;t.active=!1}))}.bind(this),this.extendCircles=function(e){const t=$(this.refs.chart).find(`circle[stroke="${e.toLowerCase()}"]`);t.length&&t.each(((t,s)=>{const i=$(this.refs.chart).find("svg")[0],a=document.createElementNS("http://www.w3.org/2000/svg","circle"),n=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",s.getAttribute("cx")),n.setAttribute("cx",s.getAttribute("cx")),a.setAttribute("cy",s.getAttribute("cy")),n.setAttribute("cy",s.getAttribute("cy")),a.setAttribute("r",4),n.setAttribute("r",4),a.setAttribute("fill",e),n.setAttribute("stroke",e),a.setAttribute("class","point-circle-small"),n.setAttribute("class","point-circle-large"),a.setAttribute("data-index",t),n.setAttribute("data-index",t),i.insertBefore(a,s),i.insertBefore(n,s)}))}.bind(this),this.rgbas=[],this.colors.forEach(((e,t)=>{const s=He(e);this.rgbas.push({index:t,original:e.replace("#","").toLowerCase(),colors:[s,s]})})),this.on("mount",(()=>{this.percent=100/(this.data.length-1),this.width=this.refs.chart.clientWidth,this.chart=new Morris.Area(this.options),this.gradient&&$(this.refs.chart).find('path[stroke="none"]').each(((e,t)=>{const s=$(t).next("path");if(s.length){const e=s.attr("stroke").toLowerCase();t.setAttribute("fill",`url(#gradient-${this.uniqueId}-${e.replace("#","")})`)}})),this.colors.forEach((e=>{this.extendCircles(e)})),this.xGrid&&this.updateGrid()}))})),riot3.tag2("stat-section-utm",'<header> <div class="flexbe-title text-title inline-box"> {tr(\'admin::stat::utm::title\')} </div> </header> <div class="group-list slide-down-animation pb40"> <div data-is="stat-block-utm-settings" url="{urlObj}" pages="{pages}" onupdate="{updateUrl}" class="group-content"></div> <div data-is="stat-block-utm-link" url="{url}" class="group-content"></div> <div class="group-content flexbe-info-box inline-box"> <img class="box-icon" width="36" src="/_s/images/emoji/flag_in_hole.png"> <div class="box-content"> <span data-is="raw" content="{tr(\'admin::stat::utm::info\')}"></span> </div> </div> </div>',"",'class="admin-content admin-stat-utm container narrow"',(function(e){const t=this,s=JSON.parse(e.dataPageList)||[];function i(){const e=Object.assign({},t.urlObj.params);"other"===e.utm_source&&(e.utm_source=e.sourceAlt),delete e.sourceAlt,"other"===e.utm_medium&&(e.utm_medium=e.mediumAlt),delete e.mediumAlt,Object.entries(t.urlObj.params).forEach((([t,s])=>{s||delete e[t]})),t.url=`${window.location.protocol}//${flexbe.vars.group.domain}${t.urlObj.page}`,t.url=`${t.url}?${ye(e)}`}this.pages=s,this.url="",this.urlObj={page:"/",params:{utm_source:"",sourceAlt:"",utm_medium:"",mediumAlt:"",utm_campaign:"",utm_term:"",utm_content:""}},this.updateUrl=function(){i(),this.update()}.bind(this),this.on("before-mount",(()=>{t.pages.forEach((e=>{e.title||(e.title=tr("admin::pages::empty_title")),"/"!==e.value&&(e.desc=e.value)})),i(),this.root.removeAttribute("data-page-list"),this.update()}))})),riot3.tag2("stat-block-utm-link",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::stat::utm::link_title\')}</span> <div data-is="flexbe-button-copy" class="flexbe-button small to-right" riot-value="{opts.url}" show-text="{true}" show-icon="{false}" show-icon-done="{true}"></div> </div> <div class="flexbe-white-box shadow collection"> <div class="collection-item url-string"> <div class="flexbe-text">{opts.url}</div> </div> <div class="collection-item collection-footer shade"> <div class="flexbe-desc" data-is="raw" content="{tr(\'admin::stat::utm::link_desc\')}"></div> </div> </div>',"",'class="stat-block-utm-link {opts.class}"',(function(e){})),riot3.tag2("stat-block-utm-settings",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::stat::utm::params_title\')}</span> </div> <div class="flexbe-table flexbe-white-box shadow overflow"> <div class="tbody"> <div class="tr"> <div class="th"> <span class="flexbe-text text-dark"> {tr(\'admin::stat::utm::page_label\')} </span> </div> <div class="td"> <div data-is="flexbe-select" list="{pages}" onchange="{setPage}" riot-value="{urlObj.page}" class="transparent in-table"> </div> </div> </div> <div class="tr"> <div class="th"> <div class="flexbe-text text-dark"> {tr(\'admin::stat::utm::utm_source_label\')} </div> <div class="flexbe-text flexbe-desc"> utm_source </div> </div> <div class="td"> <div data-is="flexbe-select" list="{sources}" onchange="{setSource}" riot-value="{urlObj.params.utm_source}" class="transparent in-table"> </div> </div> </div> <div if="{urlObj.params.utm_source === \'other\'}" class="tr"> <div class="th"> <div class="flexbe-text text-dark"> {tr(\'admin::stat::utm::utm_source_custom_label\')} </div> <div class="flexbe-text flexbe-desc text-ui"> utm_source </div> </div> <div class="td"> <div data-is="flexbe-input" autofocus="{true}" oninput="{setAltSource}" riot-value="{urlObj.params.sourceAlt}" class="transparent in-table"> </div> </div> </div> <div class="tr"> <div class="th"> <div class="flexbe-text text-dark"> {tr(\'admin::stat::utm::utm_medium_label\')} </div> <div class="flexbe-text flexbe-desc text-ui"> utm_medium </div> </div> <div class="td"> <div data-is="flexbe-select" list="{utmTypes}" onchange="{setUtmType}" riot-value="{urlObj.params.utm_medium}" class="transparent in-table"> </div> </div> </div> <div if="{urlObj.params.utm_medium === \'other\'}" class="tr"> <div class="th"> <div class="flexbe-text text-dark"> {tr(\'admin::stat::utm::utm_medium_custom_label\')} </div> <div class="flexbe-text flexbe-desc text-ui"> utm_medium </div> </div> <div class="td"> <div data-is="flexbe-input" autofocus="{true}" oninput="{setAltType}" riot-value="{urlObj.params.mediumAlt}" class="transparent in-table"> </div> </div> </div> <div class="tr"> <div class="th"> <div class="flexbe-text text-dark"> {tr(\'admin::stat::utm::utm_campaign_label\')} </div> <div class="flexbe-text flexbe-desc text-ui"> utm_campaign </div> </div> <div class="td"> <div data-is="flexbe-input" placeholder="{tr(\'admin::stat::utm::utm_campaign_placeholder\')}" oninput="{setCompaingName}" riot-value="{urlObj.params.utm_campaign}" class="transparent in-table"> </div> </div> </div> <div class="tr"> <div class="th"> <div class="flexbe-text text-dark"> {tr(\'admin::stat::utm::utm_term_label\')} </div> <div class="flexbe-text flexbe-desc text-ui"> utm_term </div> </div> <div class="td"> <div data-is="flexbe-input" placeholder="{tr(\'admin::stat::utm::utm_term_placeholder\')}" oninput="{setKeyword}" riot-value="{urlObj.params.utm_term}" class="transparent in-table"> </div> </div> </div> <div class="tr"> <div class="th"> <div class="flexbe-text text-dark"> {tr(\'admin::stat::utm::utm_content_label\')} </div> <div class="flexbe-text flexbe-desc text-ui"> utm_content </div> </div> <div class="td"> <div data-is="flexbe-input" placeholder="{tr(\'admin::stat::utm::utm_content_placeholder\')}" oninput="{setContent}" riot-value="{urlObj.params.utm_content}" class="transparent in-table"> </div> </div> </div> </div> </div>',"",'class="stat-block-utm-settings {opts.class}"',(function(e){this.urlObj=e.url,this.pages=e.pages;const t=["UZ","AM","AZ","BY","KZ","KG","TJ","RU","MD"],s=t.includes(flexbe.vars.group.country),i=t.includes(flexbe.vars.user.country),a=["ru","kz","by"].includes(flexbe.vars.group.lang),n="ru"===flexbe.vars.user.lang;this.sources=s||i||a||n?[{value:"",title:tr("admin::stat::utm::not_selected")},{value:"yandex",title:tr("admin::stat::utm::sources::yandex")},{value:"google",title:"Google.Ads"},{value:"facebook",title:"Facebook"},{value:"vk_post",title:tr("admin::stat::utm::sources::vk_post")},{value:"vk_target",title:tr("admin::stat::utm::sources::vk_target")},{value:"vk",title:tr("admin::stat::utm::sources::vk")},{value:"odnoklassniki",title:tr("admin::stat::utm::sources::odnoklassniki")},{value:"youtube",title:"YouTube"},{value:"instagram",title:"Instagram"},{value:"twitter",title:"Twitter"},{value:"other",title:tr("admin::stat::utm::sources::other")}]:[{value:"",title:tr("admin::stat::utm::not_selected")},{value:"google",title:"Google.Ads"},{value:"facebook",title:"Facebook"},{value:"youtube",title:"YouTube"},{value:"instagram",title:"Instagram"},{value:"twitter",title:"Twitter"},{value:"other",title:tr("admin::stat::utm::sources::other")}],this.utmTypes=[{value:"",title:tr("admin::stat::utm::not_selected")},{value:"cpc",title:tr("admin::stat::utm::types::cpc")},{value:"cpm",title:tr("admin::stat::utm::types::cpm")},{value:"email",title:tr("admin::stat::utm::types::email")},{value:"banner",title:tr("admin::stat::utm::types::banner")},{value:"retargeting",title:tr("admin::stat::utm::types::retargeting")},{value:"price",title:tr("admin::stat::utm::types::price")},{value:"affiliate",title:tr("admin::stat::utm::types::affiliate")},{value:"other",title:tr("admin::stat::utm::types::other")}],this.utmType="",this.setPage=function(e){this.urlObj.page=e.value,this.updateData()}.bind(this),this.setSource=function(e){this.urlObj.params.utm_source=e.value,this.updateData()}.bind(this),this.setAltSource=function(e){const t=e.target.value;this.urlObj.params.sourceAlt=t,this.updateData()}.bind(this),this.setUtmType=function(e){this.urlObj.params.utm_medium=e.value,this.updateData()}.bind(this),this.setAltType=function(e){const t=e.target.value;this.urlObj.params.mediumAlt=t,this.updateData()}.bind(this),this.setCompaingName=function(e){const t=e.target.value;this.urlObj.params.utm_campaign=t,this.updateData()}.bind(this),this.setKeyword=function(e){const t=e.target.value;this.urlObj.params.utm_term=t,this.updateData()}.bind(this),this.setContent=function(e){const t=e.target.value;this.urlObj.params.utm_content=t,this.updateData()}.bind(this),this.updateData=function(){this.update(),"function"==typeof e.onupdate&&e.onupdate()}.bind(this)})),riot3.tag2("app-common",'<div data-is="proxy" is="flexbe-loader" class="app-loader size-large" if="{loading === \'page\'}"></div> <virtual if="{loading !== \'page\'}"> <div data-is="page-progress-loader" loading="{loading}"></div> <div if="{views.menu}" data-is="{views.menu}"></div> <div class="admin-content"> <header class="container {classes.header}" if="{found}"> <div if="{$route.title && !$route.match || !$route.match.length}" class="flexbe-text text-title"> {$route.title} </div> <div if="{$route.match && $route.match.length && !$route.match[0].breadcrumbsHide}" data-is="admin-breadcrumbs" class="text-title" routes="{$route.match}"></div> <virtual if="{!error}"> <div if="{views.header}" data-is="proxy" is="{views.header}"></div> <div if="{components.header}" data-is="proxy" is="{components.header}"></div> </virtual> </header> <div data-is="proxy" is="upgrade-tariff-warning-bar" class="upgrade-tariff-warning-bar {classes.warning}" if="{showWarning}"></div> <section class="container {showWarning ? \'upgrade-tariff-warning-disabled\' : \'\'} {classes.section}" if="{!error && !skipView && (views.view || components.view)}"> <div if="{views.view}" data-is="{views.view}"></div> <div if="{components.view}" data-is="proxy" is="{components.view}"></div> </section> <section if="{error}" data-is="admin-error-page"></section> <section if="{!error && !found}" data-is="admin-notfound-page"></section> </div> </virtual>',"",'class="app-common {opts.class}"',(function(e){const t=()=>{this.isMounted&&this.update()},s=(e,t)=>{console.error(e,this),this.update({loading:null,error:e,views:{...t.view}})};let i,a=!0,n=!0;this.views={},this.components={},this.classes={},this.loading="page",this.showWarning=!1,this.skipView=!1,this.error=!1,this.found=!1,this.$route=flexbe.routing,this.onBeforeRoute=function({route:e,store:s}){n?(n=!1,this.loading="page",this.views={...e.views},this.components={...e.components},this.classes={...e.classes},a=!0):(this.loading="progress",a=e.views.view?e.views.view!==this.views.view:e.components.view!==this.components.view),s&&(s.off("commit",t),s.off("extendState",t),s.off("extendMeta",t),s.off("updateState",t)),clearTimeout(i),i=setTimeout((()=>{this.update()}),10)}.bind(this),this.onRouted=function({route:e,store:n}){clearTimeout(i);try{n&&(n.on("commit",t),n.on("extendState",t),n.on("extendMeta",t),n.on("updateState",t)),this.error=!1,this.found=!0,this.loading="done",this.views={...e.views},this.components={...e.components},this.classes={...e.classes},this.update({skipView:!a}),a||this.update({skipView:!1}),this.updateWarning(e),window.scrollTo(0,0)}catch(t){s(t,e)}}.bind(this),this.onRouteError=function(e,{route:t}){clearTimeout(i),s(e,t)}.bind(this),this.onRouteDefault=function(){clearTimeout(i),"page"===this.loading&&(console.log(404,"The route was not found, be sure to register the path in the routing table"),this.update({loading:null,error:!1,found:!1,views:{}}))}.bind(this),this.onBeforeMount=function(){flexbe.routing.on("before-route",this.onBeforeRoute),flexbe.routing.on("route",this.onRouted),flexbe.routing.on("route-error",this.onRouteError),flexbe.routing.on("route-default",this.onRouteDefault)}.bind(this),this.onUnmounted=function(){const e=this.$store;e&&(e.off("commit",t),e.off("extendState",t),e.off("extendMeta",t),e.off("updateState",t)),flexbe.routing.off("before-route",this.onBeforeRoute),flexbe.routing.off("route",this.onRouted),flexbe.routing.off("route-error",this.onRouteError),flexbe.routing.off("route-default",this.onRouteDefault)}.bind(this),this.updateWarning=function(e){let t=!1;if(e&&e.warning){const{path:s}=e.warning;t=0==+flexbe.vars.plans[s]}this.update({showWarning:t})}.bind(this)})),riot3.tag2("side-menu",'<div class="menu-header"> <div class="flexbe-title text-title"> {state.title} </div> </div> <div class="item-list-outer" if="{group.show}" each="{group in state.groups}"> <div class="list-title" if="{group.title}">{group.title}</div> <div class="item-list"> <a each="{item in group.list}" class="menu-item {item.active ? \'active\' : \'\'}" href="{item.href}" if="{item.show}"> <div class="menu-item__inner"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{item.sprite}#{item.icon}"></use></svg> <span class="flexbe-text">{item.text}</span> </div> </a> </div> </div>',"","class=\"side-menu {state.sticky ? 'sticky' : ''} {opts.class}\"",(function(e){const t=this,s=at("side_menu","admin");this.mixin("initMobx"),this.state={sticky:!1,title:"",groups:[],activeItem:null},this.watch={"state.sticky":()=>this.update()},this.onBeforeMount=function(){this.updateMenuList(flexbe.routing&&flexbe.routing.path||location.pathname),flexbe.routing&&flexbe.routing.on("before-route",(({path:e})=>this.updateMenuList(e)))}.bind(this),this.onMounted=function(){this.normalizeSideMenuPosition(),$(this.root).closest(".scrollable-content").on("scroll.side-menu",(()=>this.normalizeSideMenuPosition())),$(document).on("scroll.side-menu",(()=>this.normalizeSideMenuPosition())),$(window).on("resize.side-menu",$.throttle((()=>this.normalizeSideMenuPosition()),200))}.bind(this),this.onBeforeUnmount=function(){$(this.root).closest(".scrollable-content").off(".side-menu"),$(document).off(".side-menu"),$(window).off(".side-menu")}.bind(this),this.updateMenuList=function(t){this.state.activeItem=null,this.state.path=rr(t,{leadingSlash:!0}),this.state.groups=this.normalizeList(e.menu.groups||[]),this.state.title=e.menu.title||""}.bind(this),this.getSimilarity=function(e){return e.includes(t.state.path)||t.state.path.includes(e)?function(e,t){let s=e,i=t;e.length<t.length&&(s=t,i=e);let a=s.length;if(0===a)return 1;return(a-function(e,t){e=e.toLowerCase(),t=t.toLowerCase();let s=[];for(let i=0;i<=e.length;i++){let a=i;for(let n=0;n<=t.length;n++)if(0===i)s[n]=n;else if(n>0){let r=s[n-1];e.charAt(i-1)!==t.charAt(n-1)&&(r=Math.min(Math.min(r,a),s[n])+1),s[n-1]=a,a=r}i>0&&(s[t.length]=a)}return s[t.length]}(s,i))/parseFloat(a)}(e,t.state.path):0}.bind(this),this.normalizeItem=function(e){return e.href=rr(e.href,{leadingSlash:!0}),e.hasOwnProperty("show")||(e.show=!0),e.hasOwnProperty("sprite")||(e.sprite=s),e.similarity=this.getSimilarity(e.href),e.similarity&&(!this.state.activeItem||this.state.activeItem.similarity<=e.similarity)&&(e.active=!0,this.state.activeItem&&(this.state.activeItem.active=!1),this.state.activeItem=e),e}.bind(this),this.normalizeList=function(e){return e=(e=bt(e)).map((e=>(e.list=e.list.map((e=>this.normalizeItem(e))),e.hasOwnProperty("show")||(e.show=e.list.filter((e=>e.show)).length),e)))}.bind(this),this.normalizeSideMenuPosition=function(){const e=this.root,t=window.innerHeight,s=window.scrollY,i=e.offsetHeight,{top:a}=$(e.parentElement).offset();this.state.sticky=s>i-(t-a)}.bind(this)})),riot3.tag2("user-side-menu",'<div data-is="side-menu" menu="{menu}"></div>',"",'class="admin-side-menu user-side-menu {opts.class}"',(function(e){const t="owner"===flexbe.vars.user.role,s={icon:"user-profile",text:tr("admin::side_menu::profile_text"),href:"/admin/user/profile/"},i={icon:"user-pay",text:tr("admin::side_menu::pay_text"),href:"/admin/user/pay/",show:t},a={icon:"user-pay-plan",text:tr("admin::side_menu::pay_plan_text"),href:"/admin/user/pay/plan/",show:t},n={icon:"user-pay-invoices",text:tr("admin::side_menu::pay_invoices_text"),href:"/admin/user/pay/invoices/",show:t},r={icon:"user-access",text:tr("admin::side_menu::users_text"),href:"/admin/user/members/",show:t};this.menu={title:tr("admin::side_menu::title"),groups:[{list:[s,i,a,n]},{title:tr("admin::side_menu::additional_title"),list:[r]}]}})),riot3.tag2("user-section-profile",'<div class="group-list slide-down-animation"> <div data-is="user-block-avatar" class="group-item"></div> <div data-is="user-block-credetials" class="group-item"></div> <div data-is="user-block-lang" class="group-item"></div> <div data-is="user-block-subscriptions" class="group-item"></div> </div>',"",'class="user-section-profile pb60 {opts.class}"',(function(e){})),riot3.tag2("user-block-avatar",'<div data-is="flexbe-media-upload" url="/admin/api/user/avatar/" type="image" on-uploaded="{uploadDone}" icon="{false}" loader="{true}" overlay="{true}" class="big circle"> <div data-is="user-avatar" class="flexbe-media-upload__image" user-image="{tag.state.avatar}"></div> </div>',"",'class="user-block-avatar {opts.class}"',(function(e){const t=this;this.state={get avatar(){return t.$state.avatar??{}}},this.uploadDone=function(e,t){const s=t.data?.avatar;if(s){const e=Object.assign(this.state.avatar,{img_ext:s.img_ext,img_id:s.img_id});flexbe.trigger("user-profile-change",{userImage:e})}this.update()}.bind(this)})),riot3.tag2("user-block-credetials",'<div class="flexbe-title text-subtitle inline-box"> <div class="flexbe-text">{tr(\'admin::user::profile::credentials::title\')}</div> <div data-is="proxy" is="save-button" show-edit="{false}" show-cancel="{hasChanges}" show-save="{hasChanges}" on-cancel="{cancelEdit}" on-save="{onSave}" on-done="{onDone}" on-error="{onError}" observer="{observer}"></div> </div> <div class="flexbe-white-box shadow flexbe-table overflow"> <div class="tbody"> <div class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'main::label::email\')} </span> </div> <div class="td" ref="email"> <div data-is="flexbe-input" type="text" class="transparent in-table" riot-value="{emailToSave}" error="{errors.email}" error-tip="{errors.email}" oninput="{setEmail}" onkeydown="{saveOnKeydown}"></div> </div> </div> <div class="tr" if="{!isPasswordChange}"> <div class="th"> <span class="flexbe-text"> {tr(\'main::label::password\')} </span> </div> <div class="td"> <div class="inline-box"> <span class="flexbe-text"></span> <div class="flexbe-button small is-light filled to-right" onclick="{toggleChangePassword}"> <span class="flexbe-text"> {tr(\'admin::user::profile::credentials::change_password_button\')} </span> </div> </div> </div> </div> <virtual if="{isPasswordChange}"> <div class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'admin::user::profile::credentials::password_old_label\')} </span> </div> <div class="td" ref="oldPassword"> <div data-is="flexbe-input" class="transparent in-table" type="password" placeholder="" riot-value="{oldPassword}" error="{errors.oldPassword}" error-tip="{errors.oldPassword}" oninput="{setOldPassword}" onkeydown="{keydownOldPassword}" autocomplete="new-password"></div> </div> </div> <div class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'admin::user::profile::credentials::password_new_label\')} </span> </div> <div class="td" ref="newPassword"> <div data-is="flexbe-input" class="transparent in-table" type="password" placeholder="" riot-value="{newPassword}" error="{errors.newPassword}" error-tip="{errors.newPassword}" oninput="{setNewPassword}" onkeydown="{saveOnKeydown}" autocomplete="new-password"></div> </div> </div> </virtual> </div> </div>',"",'class="user-block-credetials {opts.class}"',(function(e){const t=this;this.state={get email(){return t.$state.email}},this.errors={},this.emailToSave=this.state.email,this.oldPassword="",this.newPassword="",this.isPasswordChange=!1,this.hasChanges=!1,this.observer=At({}),this.setEmail=function(e){this.emailToSave=String(e.target.value||"").trim(),this.errors.email=!1,this.hasChanges=this.emailToSave!==this.state.email||this.isPasswordChange}.bind(this),this.toggleChangePassword=function(){const e=!this.isPasswordChange;if(this.update({errors:{},isPasswordChange:e,hasChanges:this.emailToSave!=this.state.email||e}),e){this.refs.oldPassword.querySelector("input").focus()}}.bind(this),this.setOldPassword=function(e){this.oldPassword=String(e.target.value||"").trim(),this.errors.oldPassword=!1}.bind(this),this.keydownOldPassword=function(e){if(13===e.which)if(this.oldPassword&&this.newPassword)this.triggerSave();else if(this.oldPassword){this.refs.newPassword.querySelector("input").focus()}}.bind(this),this.setNewPassword=function(e){this.newPassword=String(e.target.value||"").trim(),this.errors.newPassword=!1}.bind(this),this.checkErrors=function(){let e;const t=this.emailToSave;if(t)if(ar(t)){if(this.isPasswordChange){const t=this.oldPassword,s=this.newPassword;t&&s||(e=new Error(tr("main::error::fill_field")),e.data={field:t?"newPassword":"oldPassword"})}}else e=new Error(tr("main::error::invalid_email")),e.data={field:"email"};else e=new Error(tr("main::error::fill_field")),e.data={field:"email"};return e}.bind(this),this.setError=function(e,t){this.errors[e]=t,this.update();const s=this.refs[e];if(s){const e=s.querySelector(".flexbe-input");e.classList.remove("shake-animation"),e.offsetWidth,e.classList.add("shake-animation"),e.querySelector("input").focus()}}.bind(this),this.getData=function(){const e={email:this.emailToSave};return this.isPasswordChange&&(e.old_password=this.oldPassword,e.new_password=this.newPassword),e}.bind(this),this.onSave=async function(){const e=this.checkErrors(),t=this.getData();if(e)return e;let s;try{s=await this.$store.dispatch("saveData",t)}catch(e){s=e}return s}.bind(this),this.onDone=function(){this.cancelEdit(),flexbe.trigger("user-profile-change",{userMail:this.state.email})}.bind(this),this.onError=function(e){const{violations:t,field:s}=e.data||{},i=t&&Object.keys(t).map((e=>t[e]))||[];s&&this.setError(s,e.message),i.length&&i.forEach((e=>{this.setError(e.propertyPath.replace(/([-_][a-z])/g,(e=>e.toUpperCase().replace("-","").replace("_",""))),e.title)})),e.message?s||i.length||toast.error(e.message):console.error(e)}.bind(this),this.triggerSave=function(){this.hasChanges&&this.observer.trigger("save")}.bind(this),this.saveOnKeydown=function(e){13===e.which&&this.triggerSave()}.bind(this),this.cancelEdit=function(){const{email:e}=this.state;this.update({errors:{},hasChanges:!1,isPasswordChange:!1,oldPassword:"",newPassword:"",emailToSave:e})}.bind(this)})),riot3.tag2("user-block-lang",'<div class="flexbe-title text-subtitle inline-box"> <div class="flexbe-text">{tr(\'admin::user::profile::interface::title\')}</div> <div data-is="admin-save-text" class="flexbe-desc" status="{status}"></div> </div> <div class="flexbe-table flexbe-white-box shadow overflow"> <div class="tbody"> <div class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'main::label::timezone\')} </span> </div> <div class="td"> <div data-is="flexbe-select" class="transparent in-table" list="{tag.state.timezones}" initial-value="{tag.state.timezone}" onchange="{selectTimezone}"> </div> </div> </div> <div class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'main::label::language\')} </span> </div> <div class="td"> <div data-is="flexbe-select" class="transparent in-table" list="{tag.state.languages}" initial-value="{tag.state.language}" onchange="{selectLanguage}"> </div> </div> </div> <div class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'main::label::country\')} </span> </div> <div class="td"> <div data-is="flexbe-select" class="transparent in-table" list="{state.countries}" initial-value="{state.country}" onchange="{selectCountry}"> </div> </div> </div> </div> </div>',"",'class="user-block-lang {opts.class}"',(function(e){const t=this;this.status="saved",this.state={get countries(){return t.$meta.countries},get country(){return t.$state.country},get languages(){return t.$meta.languages},get language(){return t.$state.language},get timezones(){return t.$meta.timezones},get timezone(){return t.$state.timezone}},this.selectTimezone=function(e){this.state.timezone!=e.value&&this.saveData({timezone:e.value})}.bind(this),this.selectLanguage=async function(e){if(this.state.language==e.value)return;(await this.saveData({language:e.value}))?.language===e.value&&location.reload()}.bind(this),this.selectCountry=function(e){this.state.country!=e.value&&this.saveData({country:e.value})}.bind(this),this.saveData=async function(e){let t;this.update({status:"saving"});try{t=await this.$store.dispatch("saveData",e),this.update({status:"success"})}catch(e){this.update({status:"error"}),"NetworkError"===e.name?toast.error(e.message):console.error(e)}return t}.bind(this)})),riot3.tag2("user-block-subscriptions",'<div class="flexbe-title text-subtitle inline-box"> <div class="flexbe-text">{tr(\'admin::user::profile::subscriptions::title\')}</div> <div data-is="admin-save-text" class="flexbe-desc" status="{status}"></div> </div> <div class="flexbe-table flexbe-white-box shadow overflow"> <div class="tbody"> <div class="tr" each="{item in tag.meta.subscriptions}"> <div class="td"> <div class="inline-box"> <label data-is="flexbe-input" class="large" type="toggle" item="{item}" checked="{!state.unsubscribed.includes(item.value)}" onchange="{toggleSubscribe.bind(tag, item)}"> <div class="checkbox-title flexbe-subtitle">{opts.item.title}</div> </label> <div class="flexbe-desc font-ui to-right">{item.subtitle}</div> </div> </div> </div> </div> </div>',"",'class="user-block-subscriptions {opts.class}"',(function(e){const t=this;this.status="saved",this.state={get unsubscribed(){return t.$state.unsubscribed||[]}},this.meta={get subscriptions(){return t.$meta.subscriptions||[]}},this.toggleSubscribe=function(e,t){let s=[...this.state.unsubscribed];t.target.checked?s=s.filter((t=>t!==e.value)):s.includes(e.value)||s.push(e.value),this.saveSubscriptions(s)}.bind(this),this.saveSubscriptions=async function(e){let t;this.update({status:"saving"});try{t=await this.$store.dispatch("saveSubscriptions",{unsubscribe:e}),this.update({status:"success"})}catch(e){this.update({status:"error"}),console.error(e)}return t}.bind(this)})),riot3.tag2("admin-user-pay-error",'<header> <div class="flexbe-title text-title">{opts.pageTitle}</div> </header> <div class="flexbe-white-box shadow is-card"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{sprite}#pay-error"></use> </svg> <div class="flexbe-title text-subtitle error-title"> {tr(\'admin::user::pay::result::error_title\')} </div> <div class="flexbe-text error-message"> <div if="{opts.message}">{opts.message}</div> <div>{tr(\'admin::user::pay::result::error_note\')}</div> </div> <a class="flexbe-button filled rounded large is-primary mt30" href="{opts.redirectUrl || \'/admin/user/pay/\'}"> <span class="flexbe-text">{tr(\'admin::user::pay::result::try_again_button\')}</span> </a> </div>',"",'class="admin-user-pay-error {opts.class}"',(function(e){this.sprite=flexbe.lib.getSprite("pay","admin")})),riot3.tag2("admin-user-pay-success",'<header> <div class="flexbe-title text-title">{opts.pageTitle}</div> </header> <div class="flexbe-white-box shadow is-card"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{sprite}#pay-done"></use> </svg> <div class="flexbe-title text-subtitle done-title"> {tr(\'admin::user::pay::result::success_title\')} </div> <div class="flexbe-text done-message"> {tr(\'admin::user::pay::result::success_note\')} </div> </div>',"",'class="admin-user-pay-success {opts.class}"',(function(e){this.sprite=flexbe.lib.getSprite("pay","admin")})),riot3.tag2("admin-user-pay-details",'<header> <div class="flexbe-title text-title">{tr(\'admin::user::pay::details::title\')}</div> </header> <div class="group-list pb60"> <div class="group-content slide-down-animation" if="{types.length > 1}"> <div class="flexbe-title text-subtitle">{tr(\'admin::user::pay::details::type::title\')}</div> <div class="flexbe-card-list cards-select gap-25"> <div class="flexbe-card-item" each="{item in types}" disabled="{user.type && user.locked && item.type !== user.type}"> <div class="flexbe-white-card shadow rounded {active: (item.type === user.type)}" onclick="{setType.bind(tag, item.type)}"> <span class="flexbe-check" if="{item.type === user.type}"></span> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#payer-type-{item.type}"></use> </svg> <span class="flexbe-text">{item.title}</span> </div> </div> </div> </div> <div class="group-content slide-down-animation" if="{fields[user.type]}"> <div class="flexbe-title text-subtitle">{tr(\'admin::user::pay::details::form::title\')}</div> <div class="flexbe-white-box shadow flexbe-table"> <div class="tbody"> <div class="tr" each="{field in fields[user.type]}" if="{renderFields && (field.show || field.show == undefined)}"> <div class="th middle"> <span class="flexbe-text">{field.label}</span> <span class="flexbe-text" if="{field.required}">*</span> </div> <div class="td middle"> <span class="flexbe-text" if="{user.locked}"> {user[field.name] || \'\'} </span> <div data-is="flexbe-input" if="{!user.locked && field.type === \'text\' && (!user.locked || !field.required)}" class="transparent text-inherit" placeholder="{field.placeholder}" replace="{field.replace}" pattern="{field.pattern}" error="{!!field.error}" error-text="{field.error}" suggestions="{field.suggestions}" riot-value="{field.value}" oninput="{field.onchange}" onchange="{field.onchange}"> </div> <div data-is="flexbe-select" if="{!user.locked && field.type === \'select\' && (!user.locked || !field.required)}" class="transparent text-inherit" initial-value="{field.value}" list="{field.list}" onchange="{field.onchange}"> </div> </div> </div> </div> </div> </div> <div class="group-content slide-down-animation" if="{user.type}"> <div class="flexbe-button filled rounded large is-primary {loading: inSave, shake-animation: animateError}" onclick="{saveData}"> <span class="flexbe-text" if="{isFirst}">{tr(\'main::button::go_to_payment\')}</span> <span class="flexbe-text" if="{!isFirst}">{tr(\'main::button::save\')}</span> </div> </div> </div>',"",'class="admin-user-pay-details {opts.class}"',(function(e){let t={},s=[];try{t=JSON.parse(e.dataJson),s=Object.entries(t.countries_list||[]).map((([e,t])=>({value:e,title:t})))}catch(e){}const i=this,a=e=>{const t=e.data,{inn:s,name:a}=t,n=t.address&&t.address.data||{};s&&r.inn.setValue(s),a&&a.short_with_opf&&r.company.setValue(a.short_with_opf),n&&n.source&&r.address.setValue(n.source),i.update()},n=(e,t)=>{const s=vt({get value(){return i.user[e]},set value(t){i.user[e]=t}},t);return new Hl(e,s)},r={fullname:n("fullname",{label:tr("main::label::fullname"),placeholder:tr("main::label::fullname_placeholder"),replace:"[^a-zA-Z--0-9 -]",required:1,validators:[Ul.required,(e,t)=>{if("input"===t)return;if(String(e.value).split(" ").filter((e=>e)).length<2)throw tr("admin::user::pay::details::form::fullname_error")}]}),country:n("country",{type:"select",label:tr("main::label::country"),list:s,afterSet:()=>{i.update({renderFields:!1}),i.update({renderFields:!0})}}),company:n("company",{label:tr("main::label::company_name"),placeholder:tr("main::label::company_name_placeholder"),required:1,validators:[Ul.required],get suggestions(){return"RU"==i.user.country&&{type:"PARTY",onSelect:a}}}),inn:n("inn",{label:tr("admin::user::pay::details::form::ru_inn_label"),placeholder:"1234567890",pattern:"\\d{0,12}",required:1,get show(){return"RU"==i.user.country},get suggestions(){return"RU"==i.user.country&&{type:"PARTY",minChars:10,formatSelected:e=>e.data.inn||"",onSelect:a}},validators:[Ul.required,Ul.inn]}),byUnp:n("byUnp",{label:tr("admin::user::pay::details::form::by_unp_label"),placeholder:"123456789",pattern:"\\d{0,9}",required:1,get show(){return"BY"==i.user.country},validators:[Ul.required,Ul.byUnp]}),kzBin:n("kzBin",{label:tr("admin::user::pay::details::form::kz_bin_label"),placeholder:"123456789102",pattern:"\\d{0,12}",required:1,get show(){return"KZ"===i.user.country},validators:[Ul.required,Ul.kzBin]}),taxId:n("taxId",{label:tr("admin::user::pay::details::form::tax_id"),placeholder:"12345678",replace:"[^a-zA-Z0-9]",get show(){return!/KZ|BY|RU|UA/i.test(i.user.country)}}),address:n("address",{label:tr("main::label::post_address"),placeholder:tr("main::label::post_address_placeholder")})};this.tag=i,this.main=this,this.sprite=flexbe.lib.getSprite("pay","admin"),this.animateError=!1,this.renderFields=!0,this.user=t.bill_user,this.types=[{type:1,title:tr("admin::user::pay::details::type::personal_label")},{type:2,title:tr("admin::user::pay::details::type::company_label")}],this.fields={1:[r.fullname],2:[r.country,r.company,r.inn,r.byUnp,r.kzBin,r.taxId,r.address]},this.user.type||(this.user.type=this.types[0].type,this.isFirst=!0),this.setType=function(e){this.user.type=e,this.update()}.bind(this),this.validateAll=function(){const e=this.fields[this.user.type];if(!e)return!1;return e.filter((e=>e.show)).map((e=>e.validate("submit"))).every((e=>e))}.bind(this),this.saveData=function(){if(!this.validateAll())return this.update({animateError:!1}),void setTimeout((()=>{this.update({animateError:!0})}),30);this.inSave=!0,flexbe.bill.updatePayer({user:this.user},((t,s)=>{t?(this.update({inSave:!1}),toast.error(t.message)):location.href=e.dataRedirectUrl||"/admin/user/pay/"}))}.bind(this),this.on("mount",(()=>{this.root.removeAttribute("data-json")}))})),riot3.tag2("admin-user-pay-invoices",'<header> <div class="flexbe-title text-title">{tr(\'admin::user::pay::invoices::title\')}</div> </header> <table class="flexbe-table text-center block slide-down-animation"> <thead class="text-note text-shade"> <tr> <th class="id text-left">#</th> <th class="sum">{tr(\'admin::user::pay::invoices::amount_head\')}</th> <th class="status">{tr(\'admin::user::pay::invoices::status_head\')}</th> <th class="date-created">{tr(\'admin::user::pay::invoices::date_created_head\')}</th> <th class="date-paid">{tr(\'admin::user::pay::invoices::paid_date_head\')}</th> <th class="invoice"></th> </tr> </thead> <tbody if="{pays.length}"> <tr each="{pay in pays}" key="pay_id" no-reorder> <td class="id text-left"> <span>{pay.pay_id}</span> </td> <td class="sum"> <span>{pay.pay_sum_text || pay.pay_sum}</span> </td> <td class="status status-{pay.pay_status}"> <span>{pay.pay_status_text}</span> </td> <td class="date-created"> <span if="{pay.pay_time_create_text}">{pay.pay_time_create_text}</span> </td> <td class="date-paid"> <span if="{pay.pay_time_done_text}">{pay.pay_time_done_text}</span> </td> <td class="invoice"> <div class="flexbe-action-buttons"> <div class="action-button" if="{pay.show_invoice}"> <svg class="flexbe-icon size-16 m0"> <use riot-xlink:href="{sprite}#dots"></use> </svg> <dropdown position="center" direction="bottom" pay="{pay}" autohide="{true}"> <div class="flexbe-list hoverable hoverable-background opacify"> <a class="flexbe-list-item" riot-href="/admin/user/pay/print.pdf/?id={opts.pay.pay_id}&stamp=1&download=1" download="true"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{tag.paySprite}#download_invoice"></use> </svg> <span class="flexbe-text">{tr(\'admin::user::pay::invoices::download_invoice_btn\')}</span> </a> <a class="flexbe-list-item" riot-href="/admin/user/pay/print.pdf/?id={opts.pay.pay_id}&stamp=1" target="_blank"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{tag.paySprite}#open_invoice"></use> </svg> <span class="flexbe-text">{tr(\'admin::user::pay::invoices::open_invoice_btn\')}</span> </a> </div> </dropdown> </div> </div> </td> </tr> </tbody> <tbody if="{!pays.length}"> <tr class="empty-list"> <td colspan="5"><span>{tr(\'admin::user::pay::invoices::empty\')}</span></td> </tr> </tbody> </table>',"",'class="admin-user-pay-invoices {opts.class}"',(function(e){this.tag=this,this.main=this,this.pays=[],this.sprite=at("settings","admin"),this.paySprite=at("pay","admin"),this.on("before-mount",(()=>{if(e.dataJson){let t=[];try{t=JSON.parse(e.dataJson)}catch(e){}this.update({pays:t})}})),this.on("mount",(()=>{this.root.removeAttribute("data-json")}))}));const Ql={css:null,exports:{setup(e,{initMobx:t}){t(),this.observer=At({}),this.state={currencyList:null,currency:"",oldPlan:null,plans:[],period:"month",discounts:[],get showRubWarning(){return"RUB"===this.currency&&"RU"!==flexbe.vars.user.country&&!flexbe.bill.isPaid}},this.watch={"state.currency":[()=>this.update()],"state.period":[()=>this.update()],"state.discounts":[()=>this.update(),{deep:!0}]}},setCurrency(e){this.state.currency=e,this.updateDiscounts(),this.update(),this.observer.trigger("update-plans")},setPeriod(e){this.state.period=e,this.update(),this.observer.trigger("update-plans")},onPlanChange(e){this.update(),window.location.href="/admin/user/pay/"},onBeforeMount(){try{const e=JSON.parse(this.props.dataJson.replace(/\\({|})/g,((e,t)=>t)));this.state.oldPlan=e.archived_plan,this.state.plans=e.plans,this.state.currencyList=e.currency_list,this.state.currency=e.currency||flexbe.bill.planCurrency||"USD",this.updateDiscounts()}catch(e){}},updateDiscounts(){const e=this.state.plans.filter((e=>e.currency===this.state.currency))[0].price;this.state.discounts=[],this.state.discounts=[{id:"year",discount:e.year.discount}],"RUB"===this.state.currency&&(this.state.discounts=[...this.state.discounts,{id:"month3",discount:e.month3.discount}])},onMounted(){this.root.removeAttribute("data-json"),flexbe.on("bill-plan-changed",this.onPlanChange)},onUnmounted(){flexbe.off("bill-plan-changed",this.onPlanChange)}},template:(e,t,s,i)=>e('<header expr957="expr957" is="admin-user-pay-plan-header"></header><div class="group-list slide-down-animation"><div class="group-content"><div expr958="expr958" is="admin-user-pay-plan-list"></div></div><div expr959="expr959" class="group-content"></div></div><div expr961="expr961" class="flexbe-white-card rounded error px25 py20"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-user-pay-plan ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"admin-user-pay-plan-header",slots:[],attributes:[{type:t.ATTRIBUTE,name:"currency",evaluate:e=>e.state.currency},{type:t.ATTRIBUTE,name:"currencyList",evaluate:e=>e.state.currencyList},{type:t.ATTRIBUTE,name:"setCurrency",evaluate:e=>e.setCurrency},{type:t.ATTRIBUTE,name:"period",evaluate:e=>e.state.period},{type:t.ATTRIBUTE,name:"setPeriod",evaluate:e=>e.setPeriod},{type:t.ATTRIBUTE,name:"discounts",evaluate:e=>e.state.discounts}],redundantAttribute:"expr957",selector:"[expr957]"},{type:s.TAG,getComponent:i,evaluate:e=>"admin-user-pay-plan-list",slots:[],attributes:[{type:t.ATTRIBUTE,name:"currency",evaluate:e=>e.state.currency},{type:t.ATTRIBUTE,name:"plans",evaluate:e=>e.state.plans},{type:t.ATTRIBUTE,name:"observer",evaluate:e=>e.observer},{type:t.ATTRIBUTE,name:"period",evaluate:e=>e.state.period}],redundantAttribute:"expr958",selector:"[expr958]"},{type:s.IF,evaluate:e=>e.state.oldPlan&&e.state.oldPlan.planID,redundantAttribute:"expr959",selector:"[expr959]",template:e('<div expr960="expr960" is="admin-user-pay-plan-archive"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"admin-user-pay-plan-archive",slots:[],attributes:[{type:t.ATTRIBUTE,name:"plan",evaluate:e=>e.state.oldPlan}],redundantAttribute:"expr960",selector:"[expr960]"}])},{type:s.IF,evaluate:e=>e.state.showRubWarning,redundantAttribute:"expr961",selector:"[expr961]",template:e('<div class="flexbe-text"><raw expr962="expr962"></raw></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::user::pay::plan::rub_warning")}],redundantAttribute:"expr962",selector:"[expr962]"}])}]),name:"admin-user-pay-plan"};e(Ql.name,Ql);const ed={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get currencyList(){return e.props.currencyList||[]},get currentCurrency(){return this.currencyList.find((t=>t.value===e.props.currency))||this.currencyList[0]},get currentCurrencyTitle(){return this.currentCurrency.title},get isPaid(){return flexbe.bill.isPaid},get discounts(){return e.props.discounts},get discountMonth3(){var e;return null==(e=this.discounts.filter((e=>"month3"===e.id))[0])?void 0:e.discount},get discountYear(){var e;return null==(e=this.discounts.filter((e=>"year"===e.id))[0])?void 0:e.discount}}},onMounted(){this.updatePeriodList()},updatePeriodList(){const{discountYear:e,discountMonth3:t}=this.state;if(this.state.list=[],this.state.list=[{value:"month",title:tr("admin::user::pay::period::month")},{value:"year",title:tr("admin::user::pay::period::year"),children:`<span>-${e}%</span>`}],"RUB"===this.state.currentCurrency.value){const e={value:"month3",title:tr("admin::user::pay::period::for_month3"),children:`<span>-${t}%</span>`};this.list=this.state.list.splice(1,0,e)}this.update()},setCurrency(e){"function"==typeof this.props.setCurrency&&(this.props.setCurrency(e.value),this.updatePeriodList())},setPeriod(e){"function"==typeof this.props.setPeriod&&this.props.setPeriod(e.value)}},template:(e,t,s,i)=>e('<div class="flexbe-title text-title m0"><span expr963="expr963"></span><span expr964="expr964"></span></div><div class="ml-auto display-flex"><div expr965="expr965" is="flexbe-switch" class="round"></div><div expr966="expr966" class="flexbe-tag clickable ml10"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"admin-user-pay-plan-header"}]},{type:s.IF,evaluate:e=>e.state.isPaid,redundantAttribute:"expr963",selector:"[expr963]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::user::pay::plan::title")}]}])},{type:s.IF,evaluate:e=>!e.state.isPaid,redundantAttribute:"expr964",selector:"[expr964]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::user::pay::plan::select_title")}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-switch",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.state.list},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.props.period},{type:t.EVENT,name:"onChange",evaluate:e=>e.setPeriod}],redundantAttribute:"expr965",selector:"[expr965]"},{type:s.IF,evaluate:e=>e.state.currencyList.length>1,redundantAttribute:"expr966",selector:"[expr966]",template:e('<span expr967="expr967" class="flexbe-text"> </span><svg class="flexbe-icon size-8 arrow-down" viewBox="0 0 8 5"><path d="M4 3L7 0L8 1L4 5L0 1L1 0L4 3Z"/></svg><div expr968="expr968" is="proxy" data-is="dropdown" position="center"></div>',[{redundantAttribute:"expr967",selector:"[expr967]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.currentCurrencyTitle].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="flexbe-list round-corners borderless hoverable hoverable-background"><div expr969="expr969"></div></div>',bindings:[{type:s.EACH,getKey:null,condition:null,template:e('<span expr970="expr970" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list-item ",e.classNames({active:e.currency.value===e.props.currency})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.setCurrency(e.currency)}]},{redundantAttribute:"expr970",selector:"[expr970]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.currency.title}]}]),redundantAttribute:"expr969",selector:"[expr969]",itemName:"currency",indexName:null,evaluate:e=>e.state.currencyList}]}],attributes:[{type:t.ATTRIBUTE,name:"autohide",evaluate:e=>!0}],redundantAttribute:"expr968",selector:"[expr968]"}])}]),name:"admin-user-pay-plan-header"};e(ed.name,ed);const td={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={limitShowSites:10,beta:"BETA",plans:[],activeMultipleId:null,inProgress:!1,planId:flexbe.bill.planID,showAllSites:!1,get period(){return e.props.period||"month"},get priceText(){let e;switch(this.period){case"month":e=tr("admin::user::pay::plan::one_month");break;case"month3":e=tr("admin::user::pay::plan::three_month");break;case"year":e=tr("admin::user::pay::plan::for_year");break;default:e=""}return e}},this.watch={"state.inProgress":[()=>this.update()],"state.activeMultipleId":[()=>this.update()],"state.plans":[()=>this.update(),{deep:!0}],"state.showAllSites":[()=>this.update()],"state.period":[()=>this.update()]}},selectPlan(e){const t=e.planID;this.state.inProgress=t,flexbe.bill.planChangeSelect(t,((e,t)=>{this.state.inProgress=!1,e?toast.error(e.message):t&&(toast.success(tr("admin::user::pay::plan::changed_notify")),this.props.onChange&&this.props.onChange(e,t),this.props.modal&&this.props.modal.close())}))},selectMultiplan(e){this.state.activeMultipleId=e.value,this.updatePlans()},updatePlans(){let e=bt(this.props.plans);this.props.currency&&(e=e.filter((e=>!e.currency||e.currency===this.props.currency)));const t=e.find((e=>+e.planID===flexbe.bill.planID)),s=e.filter((e=>!e.multiple)),i=e.filter((e=>e.multiple)),a=s;if(i.length){const e={};let s=this.state.activeMultipleId&&i.find((e=>e.planID==this.state.activeMultipleId))||t&&t.multiple&&t||i[0];s=bt(s),i.forEach((t=>{Object.values(t.info).forEach((s=>{Object.entries(s.list).forEach((([s,i])=>{let a=e[s]||[];a.find((e=>e.title===t.title))||a.push({title:i.title,price:t.price.month.plan_price,planPrice:t.plan_price,value:t.planID,sitePriceText:t.price[this.state.period||"month"].site_price_text}),a=a.sort(((e,t)=>parseInt(e.planPrice)-parseInt(t.planPrice))),e[s]=a}))}))})),Object.entries(s.info.base_functionality.list).forEach((([t,i])=>{"projects"===t&&e[t]&&e[t].length>1&&(s.info.base_functionality.list[t]={text:i.title,list:e[t]})})),s&&(this.state.activeMultipleId=s.planID,a.push(s))}this.state.plans=a},onPlanChange(){this.update()},getContent:({text:e,title:t})=>`\n            <div class="fare-tip-outer px10 py5">\n                <div class="flexbe-title">${t}</div>\n                <div class="flexbe-text text-xs text-shade-70 font-ui">${e}</div>\n            </div>\n        `,getTitle:e=>e.replace(/\d+$/,""),showMoreSites(){this.state.showAllSites=!0},onBeforeMount(){this.updatePlans()},onMounted(){flexbe.on("bill-plan-changed",this.onPlanChange),this.updatePlans(),this.props.observer&&this.props.observer.on("update-plans",this.updatePlans)},onUnmounted(){flexbe.off("bill-plan-changed",this.onPlanChange),this.props.observer&&this.props.observer.off("update-plans",this.updatePlans)}},template:(e,t,s,i)=>e('<div expr920="expr920" class="flexbe-card-item"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"admin-user-pay-plan-list flexbe-card-list gap-25"}]},{type:s.EACH,getKey:null,condition:null,template:e('<div class="flexbe-white-box shadow"><div expr921="expr921" class="plan-title flexbe-text text-m"> </div><div class="plan-price"><div class="plan-price-month"><span expr922="expr922" class="price"></span><span expr923="expr923" class="price"></span><span expr924="expr924" class="desc"> </span></div><div expr925="expr925" class="plan-price-year"></div></div><div expr928="expr928"></div><div expr930="expr930" class="plan-select flexbe-button block filled is-light weight-medium"></div><div class="flexbe-hr my20"></div><ul expr932="expr932" class="plan-info"></ul></div>',[{redundantAttribute:"expr921",selector:"[expr921]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.getTitle(e.plan.title)}]},{type:s.IF,evaluate:e=>!e.plan.price&&e.plan.sum,redundantAttribute:"expr922",selector:"[expr922]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.plan.sum}]}])},{type:s.IF,evaluate:e=>e.plan.price,redundantAttribute:"expr923",selector:"[expr923]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.plan.price[e.state.period].price_month_text}]}])},{redundantAttribute:"expr924",selector:"[expr924]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::user::pay::plan::month_desc",{count:""})}]},{type:s.IF,evaluate:e=>e.state.period&&"month"!==e.state.period,redundantAttribute:"expr925",selector:"[expr925]",template:e('<span expr926="expr926" class="price"></span><span expr927="expr927" class="desc"> </span>',[{type:s.IF,evaluate:e=>e.plan.price,redundantAttribute:"expr926",selector:"[expr926]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.plan.price[e.state.period].price_text,""].join("")}]}])},{redundantAttribute:"expr927",selector:"[expr927]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.priceText}]}])},{type:s.IF,evaluate:e=>e.plan.planID!==e.state.planId,redundantAttribute:"expr928",selector:"[expr928]",template:e('<span expr929="expr929" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["plan-select flexbe-button block filled is-primary weight-medium ",e.classNames({loading:e.state.inProgress===e.plan.planID})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.selectPlan(e.plan)}]},{redundantAttribute:"expr929",selector:"[expr929]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::select")}]}])},{type:s.IF,evaluate:e=>+e.plan.planID===e.state.planId,redundantAttribute:"expr930",selector:"[expr930]",template:e('<span expr931="expr931" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>!0}]},{redundantAttribute:"expr931",selector:"[expr931]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::user::pay::plan::current_badge")}]}])},{type:s.EACH,getKey:null,condition:null,template:e('<li expr933="expr933"></li><li expr934="expr934"></li>',[{type:s.IF,evaluate:e=>e.value.module_name,redundantAttribute:"expr933",selector:"[expr933]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.value.module_name},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["plan-info-title ",e.classNames({"plan-info-disabled":!e.value.is_active})].join("")}]}])},{type:s.EACH,getKey:null,condition:null,template:e('<template expr935="expr935"></template><span expr936="expr936" class="plan-info-disabled"></span><span expr937="expr937" class="plan-info-beta"></span><template expr938="expr938"></template><q expr946="expr946" is="proxy" data-is="flexbe-tooltip" theme="tooltipster-white" max-width="280" class="flexbe-tooltip"></q>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>e.classNames({"plan-info-projects":"projects"===e.key,"flexbe-tag clickable":e.value.list[e.key].list&&e.value.list[e.key].list.length>0})}]},{type:s.IF,evaluate:e=>!e.value.list[e.key].list&&e.value.list[e.key].availability,redundantAttribute:"expr935",selector:"[expr935]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.value.list[e.key].title,""].join("")}]}])},{type:s.IF,evaluate:e=>!e.value.list[e.key].list&&!e.value.list[e.key].availability,redundantAttribute:"expr936",selector:"[expr936]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.value.list[e.key].title,""].join("")}]}])},{type:s.IF,evaluate:e=>e.value.list[e.key].beta&&e.value.list[e.key].availability,redundantAttribute:"expr937",selector:"[expr937]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.beta}]}])},{type:s.IF,evaluate:e=>e.value.list[e.key].list,redundantAttribute:"expr938",selector:"[expr938]",template:e('<span expr939="expr939" class="flexbe-text"> </span><svg class="flexbe-icon size-8 arrow-down" viewBox="0 0 8 5"><path d="M4 3L7 0L8 1L4 5L0 1L1 0L4 3Z"/></svg><div expr940="expr940" is="proxy" data-is="dropdown" position="center" direction="bottom"></div>',[{redundantAttribute:"expr939",selector:"[expr939]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.value.list[e.key].text}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="flexbe-list borderless hoverable hoverable-background"><div expr941="expr941"></div></div><div class="flexbe-hr m0"></div><div expr944="expr944" class="plan-info-dropdown-more"></div>',bindings:[{type:s.EACH,getKey:null,condition:e=>e.state.limitShowSites>e.index||e.state.showAllSites,template:e('<span expr942="expr942" class="flexbe-text feature-name"> </span><span expr943="expr943" class="flexbe-text feauture-price"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-list-item ",e.classNames({active:e.feature.value===e.state.activeMultipleId})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.selectMultiplan(e.feature)}]},{redundantAttribute:"expr942",selector:"[expr942]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.feature.title}]},{redundantAttribute:"expr943",selector:"[expr943]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.feature.sitePriceText}]}]),redundantAttribute:"expr941",selector:"[expr941]",itemName:"feature",indexName:"index",evaluate:e=>e.value.list[e.key].list},{type:s.IF,evaluate:e=>!e.state.showAllSites,redundantAttribute:"expr944",selector:"[expr944]",template:e('<span expr945="expr945" class="flexbe-desc mr10"> </span><svg class="flexbe-icon size-10 arrow-down" viewBox="0 0 8 5"><path d="M4 3L7 0L8 1L4 5L0 1L1 0L4 3Z"/></svg>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.showMoreSites}]},{redundantAttribute:"expr945",selector:"[expr945]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::user::pay::plan::sites::show_more")}]}])}]}],attributes:[{type:t.ATTRIBUTE,name:"force-direction",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"autohide",evaluate:e=>!0}],redundantAttribute:"expr940",selector:"[expr940]"}])},{type:s.IF,evaluate:e=>!e.value.list[e.key].list&&"projects"!==e.key&&e.value.list[e.key].availability,redundantAttribute:"expr946",selector:"[expr946]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>()=>e.getContent(e.value.list[e.key].tooltip)}]}])}]),redundantAttribute:"expr934",selector:"[expr934]",itemName:"key",indexName:null,evaluate:e=>Object.keys(e.value.list)}]),redundantAttribute:"expr932",selector:"[expr932]",itemName:"value",indexName:null,evaluate:e=>Object.values(e.plan.info)}]),redundantAttribute:"expr920",selector:"[expr920]",itemName:"plan",indexName:null,evaluate:e=>e.state.plans}]),name:"admin-user-pay-plan-list"};e(td.name,td);const sd={css:null,exports:{setup(e,{initMobx:t}){var s,i;t(),this.sprite=at("pay","admin"),this.state={inProgress:!1,planId:flexbe.bill.planID,domainCount:null==(s=flexbe.vars)||null==(i=s.plans)?void 0:i.domain_limit,get plan(){return e.props.plan||{}},get title(){return this.plan.title},get priceMonthText(){return this.plan.price.month.price_month_text},get equalPlanId(){return+this.planId==+this.plan.planID}},this.watch={"state.inProgress":[()=>this.update()]}},selectPlan(){this.state.inProgress=!0,flexbe.bill.planChangeSelect(this.state.plan.planID,((e,t)=>{this.state.inProgress=!1,e?toast.error(e.message):t&&toast.success(tr("admin::user::pay::plan::changed_notify"))}))}},template:(e,t,s,i)=>e('<div expr971="expr971" class="flexbe-title text-subtitle"> </div><div class="flexbe-white-box shadow"><div class="plan-name-row"><svg expr972="expr972" is="flexbe-icon" icon="summary-plan"></svg><span expr973="expr973" class="flexbe-text"> </span></div><div class="plan-price-row"><svg expr974="expr974" is="flexbe-icon" icon="summary-sum"></svg><span expr975="expr975" class="flexbe-text"> </span></div><div expr976="expr976" class="plan-price-row"></div><div class="plan-summary-row"><div expr979="expr979"></div><div expr981="expr981" class="plan-select flexbe-button block large rounded filled is-light"></div></div></div><div expr983="expr983" class="flexbe-desc mt20"> </div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["admin-user-pay-plan-archive ",e.props.class].join("")}]},{redundantAttribute:"expr971",selector:"[expr971]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::user::pay::plan::archive_title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr972",selector:"[expr972]"},{redundantAttribute:"expr973",selector:"[expr973]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::user::pay::plan::name",{name:e.state.title})].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr974",selector:"[expr974]"},{redundantAttribute:"expr975",selector:"[expr975]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::user::pay::plan::month_desc",{count:e.state.priceMonthText})].join("")}]},{type:s.IF,evaluate:e=>e.state.domainCount,redundantAttribute:"expr976",selector:"[expr976]",template:e('<svg expr977="expr977" is="flexbe-icon" icon="count-sites"></svg><span expr978="expr978" class="flexbe-text"> </span>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr977",selector:"[expr977]"},{redundantAttribute:"expr978",selector:"[expr978]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::user::pay::plan::features::projects_plural",{count:e.state.domainCount})}]}])},{type:s.IF,evaluate:e=>!e.state.equalPlanId,redundantAttribute:"expr979",selector:"[expr979]",template:e('<span expr980="expr980" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["plan-select flexbe-button block large rounded filled is-primary ",e.classNames({loading:e.state.inProgress})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.selectPlan}]},{redundantAttribute:"expr980",selector:"[expr980]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::select")}]}])},{type:s.IF,evaluate:e=>e.state.equalPlanId,redundantAttribute:"expr981",selector:"[expr981]",template:e('<span expr982="expr982" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>!0}]},{redundantAttribute:"expr982",selector:"[expr982]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::user::pay::plan::current_badge")}]}])},{redundantAttribute:"expr983",selector:"[expr983]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::user::pay::plan::archive_note")].join("")}]}]),name:"admin-user-pay-plan-archive"};e(sd.name,sd),riot3.tag2("admin-user-pay-view",'<header> <div class="flexbe-title text-title">{opts.pageTitle}</div> </header> <div class="group-list slide-down-animation pb50"> <virtual if="{data.pay_service === \'plan\'}"> <div class="group-content" if="{!isManualPayment}" data-is="admin-user-pay-view-planinfo" main="{tag}"></div> <div class="group-content" if="{data.is_trial || isManualPayment}"> <div class="flexbe-title text-subtitle" if="{!isManualPayment}"> {tr(\'admin::user::pay::period::label\')} </div> <div class="flexbe-title text-subtitle" if="{isManualPayment}"> {tr(\'admin::user::pay::period::choose_title\')} </div> <div class="flexbe-white-box shadow block" data-is="admin-user-pay-view-period" main="{tag}" plan="{data.bill_plan}" period="{data.bill_period}" select="{changePeriod}"> </div> </div> </virtual> <virtual if="{data.pay_service === \'sms\'}"> <div class="group-content" data-is="admin-user-pay-view-sms-plans" main="{tag}" list="{data.sms_plans}" active="{data.active_sms_plan}" select="{changeSmsCount}"> </div> </virtual> <virtual if="{data.pay_service === \'belgie\'}"> <div class="group-content" data-is="admin-user-pay-view-belgie" data="{data.form}" main="{tag}" register-validator="{registerValidator}" unregister-validator="{unregisterValidator}"></div> </virtual> <div class="group-content" if="{isRussian && !(isAutoPayment) && data.pay_methods_list.length > 1}"> <div class="flexbe-title text-subtitle"> <span class="flexbe-text"> {tr(\'admin::user::pay::methods::title\')} </span> </div> <div data-is="admin-user-pay-view-methods-list" list="{data.pay_methods_list}" method="{data.pay_method}" main="{tag}" select-method="{selectPayMethod}" remove-method="{removePayMethod}"> </div> </div> <div data-is="admin-user-pay-view-checkout" main="{tag}" register-validator="{registerValidator}" unregister-validator="{unregisterValidator}"></div> </div>',"",'class="admin-user-pay-view {opts.class}"',(function(e){const t=JSON.parse(e.dataJson),s=()=>{this.hasMycard=!(!t.mycard||!t.mycard.id),this.isAutoPayment=!(this.isManualPayment||!this.hasMycard||!t.mycard.auto_payment)},i=e=>new Promise(((s,i)=>{this.update({cardAutoToggling:!0}),flexbe.bill.mycardAutoToggle(e,((a,n)=>{this.cardAutoToggling=!1,n&&n.bill_exp&&(t.bill_exp=n.bill_exp,t.mycard.auto_payment_next=n.bill_exp),a?(toast.error(a.message),i(a.message)):(void 0!==e.mycard&&(t.mycard=Object.assign({},e.mycard)),void 0!==e.cardId&&(t.mycard.id=e.cardId),void 0!==e.autoPayment&&(t.mycard.auto_payment=e.autoPayment,this.isCardChange=!1),s()),this.hasMycard=!(!t.mycard||!t.mycard.id),this.isAutoPayment=!(this.isManualPayment||!this.hasMycard||!t.mycard.auto_payment),this.update()}))}));this.tag=this,this.main=this,this.data=t,this.sprite=at("pay","admin"),this.validators=[],this.currency=t.currency,this.isRussian="RUB"===this.currency,this.isUSA=!this.isRussian,this.isManualPayment=t.manual,this.isCardChange=!1,this.isRussian||(t.pay_method="card",t.paycard_auto_status="plan"===t.pay_service,t.paycard_save_status="plan"===t.pay_service),this.selectPayMethod=function(e){t.pay_method=e.type,t.pay_gate=e.gate,this.update()}.bind(this),this.removePayMethod=function(e){/^mycard/.test(e.type)&&this.removeMyCard(e.type)}.bind(this),this.changePlan=function(e){t.bill_plan=e.bill_plan,t.bill_exp&&(t.bill_exp=e.bill_exp),this.update()}.bind(this),this.changePeriod=function(e){t.bill_period=e,this.update()}.bind(this),this.changeSmsCount=function(e){t.active_sms_plan=e.id,this.update()}.bind(this),this.changePromocode=function(e){t.entered_promocode=e,this.update()}.bind(this),this.removeMyCard=function(e){"string"!=typeof e&&(e=t.mycard.id),e=e.replace(/^mycard_/,"");As({props:{icon:`${this.sprite}#remove-card-confirm`,title:tr("admin::user::pay::remove_card_confirm::title"),text:tr("admin::user::pay::remove_card_confirm::text"),confirmButtonText:tr("main::button::delete"),onConfirm:()=>new Promise(((s,i)=>{this.update({cardRemoving:!0}),flexbe.bill.mycardRemove(e,(a=>{if(this.update({cardRemoving:!1}),a)toast.error(a.message),i(a.message);else if(s(!0),t.pay_methods_list=t.pay_methods_list.filter((t=>!t.type.includes(e))),t.pay_method=t.pay_methods_list[0].type,t.mycard.id&&t.mycard.id.includes(e)){let e=t.pay_methods_list.find((e=>e.mycard&&e.mycard.auto_payment));e=e||t.pay_methods_list.find((e=>e.mycard&&e.mycard.id)),t.mycard=e?e.mycard:null}this.update()}))}))}})}.bind(this),this.disableAutopay=function(){const e=t.mycard,s=t.bill_period,a=t.pay_service_id;As({props:{icon:`${this.sprite}#disable-autopay-confirm`,title:tr("admin::user::pay::disable_autorenew::title"),text:tr("admin::user::pay::disable_autorenew::text"),confirmButtonText:tr("main::button::deactivate"),onConfirm:()=>i({payServiceId:a,autoPeriod:s,cardId:e.id,autoPayment:!1})}})}.bind(this),this.enableAutopay=function(){const e=t.pay_methods_list.filter((e=>e.mycard&&e.mycard.id)).map((e=>e.mycard)),s=t.bill_period,a=t.pay_service_id;if(1===e.length){const e=t.mycard;return i({mycard:e,autoPeriod:s,payServiceId:a,cardId:e.id,autoPayment:!0})}if(e.length>1)return new Promise((t=>{flexbe.modals.bill.showMycardSelect({list:e,onSelect:e=>{t(i({mycard:e,autoPeriod:s,payServiceId:a,cardId:e.id,autoPayment:!0}))}})}))}.bind(this),this.registerValidator=function(e){this.validators.push(e)}.bind(this),this.unregisterValidator=function(e){const t=this.validators.indexOf(e);array.splice(t,1)}.bind(this),this.checkValid=function(){return!this.validators.length||this.validators.every((e=>e()))}.bind(this),this.onBeforeMount=function(){s()}.bind(this),this.onMounted=function(){this.root.removeAttribute("data-json"),flexbe.on("bill-plan-changed",this.changePlan),flexbe.on("bill-period-changed",this.changePeriod),flexbe.on("bill-promocode-changed",this.changePromocode)}.bind(this),this.onUnmounted=function(){flexbe.off("bill-plan-changed",this.changePlan),flexbe.off("bill-period-changed",this.changePeriod),flexbe.off("bill-promocode-changed",this.changePromocode)}.bind(this)})),riot3.tag2("admin-user-pay-view-checkout",'<div class="group-content" data-is="admin-user-pay-view-stripe" main="{main}" ref="stripeTag" if="{main.isUSA && (data.pay_method == \'card\') && (!main.hasMycard || main.isCardChange || main.isManualPayment)}" stripe="{stripeInstance}"> </div> <div class="group-content" data-is="admin-user-pay-view-summary" main="{main}"></div> <form class="group-content" if="{!main.isAutoPayment || main.isCardChange}" action="/admin/user/pay/" method="post" onsubmit="{sendForm}" ref="form"> <div class="pay-form-fields"> <input name="pay_service_id" type="hidden" riot-value="{data.pay_service_id}"> <input name="pay_service" type="hidden" riot-value="{data.pay_service}"> <input if="{stripeToken}" name="local_pay[stripe_token]" type="hidden" riot-value="{stripeToken.id}"> <virtual if="{data.pay_service === \'plan\'}"> <input name="plan_id" type="hidden" riot-value="{data.bill_plan.planID}"> <input name="period" type="hidden" riot-value="{data.bill_period}"> <input if="{!main.isRussian}" name="is_auto" type="hidden" value="1"> <input if="{!main.isRussian}" name="is_save" type="hidden" value="1"> <input if="{main.isUSA && main.isCardChange}" name="is_card_change" type="hidden" value="1"> </virtual> <virtual if="{data.pay_service === \'sms\'}"> <input name="pay_extra_info[sms_plan_id]" type="hidden" riot-value="{getSmsPlan().id}"> <input name="pay_extra_info[sms_count]" type="hidden" riot-value="{getSmsPlan().count}"> </virtual> <virtual if="{data.pay_service === \'domain\'}"> <input name="pay_extra_info[reg_id]" type="hidden" riot-value="{data.domain_data.reg_id}"> <input name="pay_extra_info[renew_id]" type="hidden" riot-value="{data.domain_data.renew_id}"> <input name="pay_extra_info[reg_domain]" type="hidden" riot-value="{data.domain_data.reg_domain}"> </virtual> <virtual if="{data.pay_service === \'belgie\'}"> <input name="pay_extra_info[legal_form]" type="hidden" riot-value="{data.form.legal_form}"> <input if="{data.form.legal_form === \'ooo\'}" name="pay_extra_info[owner][name_company]" type="hidden" riot-value="{data.form.owner.name_company}"> <input name="pay_extra_info[owner][address]" type="hidden" riot-value="{data.form.owner.address}"> <input name="pay_extra_info[owner][email]" type="hidden" riot-value="{data.form.owner.email}"> <input name="pay_extra_info[owner][full_name]" type="hidden" riot-value="{data.form.owner.full_name}"> <input name="pay_extra_info[owner][phone]" type="hidden" riot-value="{data.form.owner.phone}"> <input name="pay_extra_info[domain][description]" type="hidden" riot-value="{data.form.domain.description}"> <input name="pay_extra_info[domain][name]" type="hidden" riot-value="{data.form.domain.name}"> <input if="{data.form.legal_form !== \'fiz\'}" name="pay_extra_info[state_registration][account_number]" type="hidden" riot-value="{data.form.state_registration.account_number}"> <input if="{data.form.legal_form !== \'fiz\'}" name="pay_extra_info[state_registration][registered_at]" type="hidden" riot-value="{data.form.state_registration.registered_at}"> <input if="{data.form.legal_form !== \'fiz\'}" name="pay_extra_info[state_registration][registered_by]" type="hidden" riot-value="{data.form.state_registration.registered_by}"> <input if="{data.form.legal_form !== \'fiz\'}" name="pay_extra_info[state_registration][solution_number]" type="hidden" riot-value="{data.form.state_registration.solution_number}"> <input if="{data.form.legal_form !== \'fiz\'}" name="pay_extra_info[state_registration][type]" type="hidden" riot-value="{data.form.state_registration.type}"> <input if="{data.form.legal_form !== \'ooo\'}" name="pay_extra_info[document][identifier]" type="hidden" riot-value="{data.form.document.identifier}"> <input if="{data.form.legal_form !== \'ooo\'}" name="pay_extra_info[document][document_number]" type="hidden" riot-value="{data.form.document.document_number}"> <input if="{data.form.legal_form !== \'ooo\'}" name="pay_extra_info[document][issued_at]" type="hidden" riot-value="{data.form.document.issued_at}"> <input if="{data.form.legal_form !== \'ooo\'}" name="pay_extra_info[document][issued_by]" type="hidden" riot-value="{data.form.document.issued_by}"> <input if="{data.form.legal_form !== \'ooo\'}" name="pay_extra_info[document][serial_number]" type="hidden" riot-value="{data.form.document.serial_number}"> <input if="{data.form.legal_form !== \'ooo\'}" name="pay_extra_info[document][type]" type="hidden" riot-value="{data.form.document.type}"> </virtual> <input name="pay_sum" type="hidden" riot-value="{getSummaryPrice()}"> <input name="pay_method" type="hidden" riot-value="{data.pay_method}"> <input name="pay_gate" type="hidden" riot-value="{data.pay_gate}"> <input name="pay_currency" type="hidden" riot-value="{main.currency}"> </div> <div class="flexbe-field-group is-inline mb30" if="{!main.isManualPayment && data.pay_method == \'card\' && main.isRussian}"> <label data-is="flexbe-input" type="toggle" class="large mr40" name="is_auto" checked="{!!data.paycard_auto_status}" riot-value="{data.paycard_auto_status ? 1 : 0}" onchange="{changeAutoStatus}"> <span class="flexbe-text">{tr(\'admin::user::pay::checkout::enable_autorenew_label\')}</span> </label> <label data-is="flexbe-input" type="toggle" class="large mr40" if="{!data.paycard_auto_status}" name="is_save" checked="{!!data.paycard_save_status}" riot-value="{data.paycard_save_status ? 1 : 0}" onchange="{changeSaveStatus}"> <span class="flexbe-text">{tr(\'admin::user::pay::checkout::save_card_label\')}</span> </label> </div> <button type="submit" class="flexbe-button filled rounded is-primary large {loading: sending}" disabled="{main.isUSA && !stripeInstance}"> <span class="flexbe-text" if="{data.pay_method == \'bank_company\'}">{tr(\'admin::user::pay::checkout::create_invoice_button\')}</span> <span class="flexbe-text" if="{data.pay_method != \'bank_company\' && main.isUSA && data.paycard_auto_status}">{tr(\'admin::user::pay::checkout::subscribe_button\')}</span> <span class="flexbe-text" if="{data.pay_method != \'bank_company\' && (!main.isUSA || !data.paycard_auto_status)}">{tr(\'admin::user::pay::checkout::pay_button\')}</span> </button> <div class="pay-disclaimer mt30 {invisible: !isShowDisclaimer()}"> <span class="flexbe-desc">{getDisclaimerText()}</span> </div> </form>',"",'class="admin-user-pay-view-checkout {opts.class}"',(function(e){const t=this,s=e.main,i=s.data,a=()=>{const e=$(this.root).find(".admin-user-pay-view-stripe .flexbe-table");e.removeClass("shake-animation"),e.outerWidth(),e.addClass("shake-animation")};this.data=i,this.sending=!1,this.stripeInstance=!1,this.stripeKey=i.stripe_public_key,this.stripeToken=!1,this.isShowDisclaimer=function(){return"mycard"===i.pay_method&&s.main.isAutoPayment||"card"===i.pay_method&&i.paycard_auto_status}.bind(this),this.getSmsPlan=function(e=i.active_sms_plan){return i.sms_plans.find((t=>t.id===e))||i.sms_plans[0]}.bind(this),this.getSummaryPrice=function(){let e="";if("plan"===i.pay_service){const t=i.bill_period;e=(i.bill_plan.price[t]||{}).price}else if("sms"===i.pay_service){e=this.getSmsPlan().price}else"domain"===i.pay_service?e=i.domain_data.reg_price:"belgie"===i.pay_service&&(e=i.pay_sum);return e||""}.bind(this),this.getDisclaimerText=function(){if("plan"!==i.pay_service)return"";const e=i.bill_plan.price[i.bill_period],t=e&&e.price_text||"";let s;switch(i.bill_period){case"month":s=tr("admin::user::pay::period::every_month");break;case"month3":s=tr("admin::user::pay::period::every_month3");break;case"year":s=tr("admin::user::pay::period::every_year")}return tr("admin::user::pay::checkout::autorenew_desc",{price:t,period:s})}.bind(this),this.changeSaveStatus=function(e){i.paycard_save_status=e.target.checked?1:0,s.update()}.bind(this),this.changeAutoStatus=function(e){i.paycard_auto_status=e.target.checked?1:0,s.update()}.bind(this),this.sendForm=async function(e){if(s.isUSA&&!this.stripeInstance)return e.preventDefault(),!1;if(!s.checkValid())return e.preventDefault(),toast.error(tr("main::error:check_fields")),!1;if(this.update({sending:!0}),s.isUSA&&s.hasMycard&&!s.isAutoPayment&&!s.isCardChange&&!s.isManualPayment)return s.enableAutopay().then((()=>{this.update({sending:!1})})),e.preventDefault(),!1;const n=this.refs.form,r=this.stripeInstance;if(s.isUSA&&r){e.preventDefault();const i=t.refs.stripeTag.elements,o={currency:s.currency};r.createToken(i.cardNumber,o).then((e=>{e.error?(a(),toast.error(e.error.message),this.update({sending:!1})):(this.update({stripeToken:e.token}),n.submit())}))}if("bank_company"===i.pay_method){e.preventDefault(),e.stopPropagation();try{let e={};"sms"===i.pay_service?e={sms_plan_id:this.getSmsPlan().id,sms_count:this.getSmsPlan().count}:"domain"===i.pay_service?e={reg_id:i.domain_data.reg_id,renew_id:i.domain_data.renew_id,reg_domain:i.domain_data.reg_domain}:"belgie"===i.pay_service&&(e=i.form);const t=await flexbe.bill.getInvoiceInfo({service:i.pay_service,serviceId:i.pay_service_id,sum:this.getSummaryPrice(),payExtra:e}),s=[" ",` ${t.flexbe_inn}  ${t.flexbe_kpp}`,`/ ${t.flexbe_acc}`,` ${t.flexbe_bik}`],a=[t.pay_desc];flexbe.modals.bill.showInvoiceInfo({invoice:t.pay_id,sum:t.pay_sum_text,destination:a,recipient:s})}catch(e){"NetworkError"===e.name?toast.error(e.message):console.error(e)}finally{this.update({sending:!1})}}}.bind(this),this.onMounted=function(){s.isUSA&&be(["https://js.stripe.com/v3/"],(()=>{this.stripeInstance=window.Stripe(this.stripeKey),this.update()}))}.bind(this)})),riot3.tag2("admin-user-pay-view-methods-list",'<div class="flexbe-card-list gap-25 aliqout-{getAliquote()}"> <div class="flexbe-card-item grow" each="{method in opts.list}"> <div class="flexbe-white-card shadow hoverable pointer rounded {active: method.type == opts.method}" type="{method.type}" gate="{method.gate}" onclick="{selectMethod}"> <div class="icon-area"> <svg class="icon-remove flexbe-icon size-16" if="{/^mycard/.test(method.type)}" onclick="{removeMethod}"> <use riot-xlink:href="{sprite}#remove"></use> </svg> <span class="icon-check flexbe-check" if="{method.type == opts.method}"></span> </div> <svg class="flexbe-icon icon-method"> <use riot-xlink:href="{getIcon(method)}"></use> </svg> <div class="flexbe-text" if="{!/^mycard/.test(method.type)}"> {method.name} </div> <div class="flexbe-text" if="{/^mycard/.test(method.type)}"> <div>{tr(\'admin::user::pay::methods::mycard\')}</div> <div>&nbsp;{method.mycard.end}</div> </div> </div> </div> </div>',"",'class="admin-user-pay-view-methods-list {opts.class}"',(function(e){const t=e.main;this.tag=this,this.main=t,this.sprite=flexbe.lib.getSprite("pay","admin"),this.getAliquote=function(){const t=e.list.length;let s=3;return t%4==0?s=4:t%5==0||t%3==0?s=3:t%2==0&&t<=4&&(s=2),s}.bind(this),this.getIcon=function(e){const t=e.mycard;let s=e.type;return/^mycard/.test(s)&&(s="mycard"),"mycard"===s&&t&&["mastercard","visa","mir"].includes(t.type)&&(s=t.type),`${this.sprite}#method-${s}`}.bind(this),this.selectMethod=function(t){const s=t.item.method;e.selectMethod&&e.selectMethod(s)}.bind(this),this.removeMethod=function(t){const s=t.item.method;e.removeMethod&&e.removeMethod(s)}.bind(this)})),riot3.tag2("admin-user-pay-view-planinfo",'<div class="flexbe-table flexbe-white-box shadow overflow"> <div class="tbody"> <div class="tr"> <div class="th"> <span class="flexbe-text">{tr(\'admin::user::pay::info::plan_label\')}</span> </div> <div class="td"> <div class="inline-box between"> <span class="flexbe-text">{data.bill_plan.title}</span> <div class="flexbe-button filled is-light small" onclick="{changePlan}"> <span class="flexbe-text">{tr(\'admin::user::pay::info::plan_change_button\')}</span> </div> </div> </div> </div> <div class="tr" if="{!data.is_trial}"> <div class="th"> <span class="flexbe-text">{tr(\'admin::user::pay::period::label\')}</span> </div> <div class="td"> <div class="inline-box between"> <span class="flexbe-text">{getPeriodLabel(data.bill_period)}</span> <div class="discount-beidge" if="{getPriceField(\'discount\')}"> {tr(\'admin::user::pay::period::discount_badge\', { discount: getPriceField(\'discount\') })} </div> <div class="flexbe-button filled is-light small" onclick="{changePeriod}"> <span class="flexbe-text">{tr(\'admin::user::pay::info::period_change_button\')}</span> </div> </div> </div> </div> <div class="tr"> <div class="th" if="{!main.isAutoPayment}"> <span class="flexbe-text" if="{data.is_trial}">{tr(\'admin::user::pay::info::trial_label\')}</span> <span class="flexbe-text" if="{!data.is_trial}">{tr(\'admin::user::pay::info::expire_label\')}</span> </div> <div class="th" if="{main.isAutoPayment}"> <span class="flexbe-text">{tr(\'admin::user::pay::info::autorenew_label\')}</span> <q data-is="flexbe-tooltip">{tag.getAutopayTip()}</q> </div> <div class="td"> <div class="inline-box between"> <span class="flexbe-text" if="{!(main.isAutoPayment)}"> {data.is_trial ? data.bill_trial_exp : data.bill_exp} </span> <span class="flexbe-text" if="{main.isAutoPayment}"> {data.mycard.auto_payment_next || data.bill_exp} </span> <div class="flexbe-button filled is-light small {loading: main.cardAutoToggling}" if="{main.hasMycard}" disabled="{main.cardRemoving}" onclick="{toggleAutopay}"> <span class="flexbe-text" if="{main.isAutoPayment}"> {main.isRussian ? tr(\'admin::user::pay::info::disable_autorenew_button\') : tr(\'admin::user::pay::info::cancel_subscription_button\')} </span> <span class="flexbe-text" if="{!main.isAutoPayment}"> {main.isRussian ? tr(\'admin::user::pay::info::enable_autorenew_button\') : tr(\'admin::user::pay::info::enable_subscription_button\')} </span> </div> </div> </div> </div> <div class="tr" if="{main.hasMycard && (main.isAutoPayment || !main.isRussian)}"> <div class="th"> <span class="flexbe-text">{tr(\'admin::user::pay::info::mycard_label\')}</span> </div> <div class="td"> <div class="inline-box"> <svg class="flexbe-icon icon-card" if="{[\'visa\', \'mastercard\'].includes(data.mycard.type)}"> <use riot-xlink:href="{sprite}#card-{data.mycard.type}"></use> </svg> <span class="flexbe-text"> {data.mycard.end}</span> <virtual if="{main.isRussian}"> <div class="flexbe-button to-right filled is-light small {loading: main.cardRemoving}" disabled="{main.cardAutoToggling || main.cardRemoving}" onclick="{main.removeMyCard}"> <span class="flexbe-text">{tr(\'admin::user::pay::info::remove_card_button\')}</span> </div> </virtual> <virtual if="{!main.isRussian}"> <div if="{!main.isCardChange}" class="flexbe-button to-right filled is-light small" disabled="{main.cardAutoToggling || main.cardRemoving}" onclick="{changeCard}"> <span class="flexbe-text">{tr(\'admin::user::pay::info::change_card_button\')}</span> </div> <div if="{!main.isAutoPayment}" class="flexbe-button to-right filled is-light small {loading: main.cardRemoving}" disabled="{main.cardAutoToggling}" onclick="{main.removeMyCard}"> <span class="flexbe-text">{tr(\'admin::user::pay::info::remove_card_button\')}</span> </div> </virtual> </div> </div> </div> <div class="tr"> <div class="th"> <span class="flexbe-text">{tr(\'admin::user::pay::info::payer_label\')}</span> </div> <div class="td"> <div class="inline-box between"> <span class="flexbe-text" if="{!data.bill_user.type}"></span> <span class="flexbe-text" if="{data.bill_user.type == 1}">{data.bill_user.fullname || \'\'}</span> <span class="flexbe-text" if="{data.bill_user.type == 2}">{data.bill_user.company || \'\'}</span> <a class="flexbe-button filled is-light small" href="/admin/user/pay/details/" if="{!data.bill_user.locked}"> <span class="flexbe-text">{tr(\'admin::user::pay::info::payer_change_button\')}</span> </a> </div> </div> </div> </div> </div>',"",'class="admin-user-pay-view-planinfo {opts.class}"',(function(e){const t=e.main,s=t.data;this.tag=this,this.main=t,this.data=s,this.sprite=t.sprite,this.changeCard=function(){t.update({isCardChange:!0})}.bind(this),this.changePlan=function(){flexbe.modals.bill.showPlanChange()}.bind(this),this.changePeriod=function(){flexbe.modals.bill.showPeriodChange({period:s.bill_period,plan:s.bill_plan})}.bind(this),this.toggleAutopay=function(){s.mycard&&s.mycard.auto_payment?t.disableAutopay():t.enableAutopay()}.bind(this),this.getPriceField=function(e){const t=s.bill_plan.price[s.bill_period];return t&&t[e]||0}.bind(this),this.getAutopayTip=function(){if("plan"!=s.pay_service)return"";const e=this.getPriceField("price_text");let t;switch(s.bill_period){case"month":t=tr("admin::user::pay::period::every_month");break;case"month3":t=tr("admin::user::pay::period::every_month3");break;case"year":t=tr("admin::user::pay::period::every_year")}return tr("admin::user::pay::info::autorenew_tip",{price:e,period:t})}.bind(this),this.getPeriodLabel=function(e){switch(e){case"month":return tr("admin::user::pay::period::each_month");case"month3":return tr("admin::user::pay::period::each_month3");case"year":return tr("admin::user::pay::period::each_year");default:return tr("admin::user::pay::period::each_month")}}.bind(this)})),riot3.tag2("admin-user-pay-view-stripe",'<div class="flexbe-title text-subtitle"> <span class="flexbe-text">{tr(\'admin::user::pay::stripe::title\')}</span> </div> <div class="flexbe-table flexbe-white-box shadow overflow"> <div class="tbody"> <div class="tr card-number"> <div class="th"> <span class="flexbe-text">{tr(\'admin::user::pay::stripe::card_number\')}</span> </div> <div class="td card-input" ref="cardNumber"></div> <div class="td card-advanced"> <svg class="flexbe-icon icon-card" if="{cardBrand}"> <use riot-xlink:href="{sprite}#card-{cardBrand}"></use> </svg> </div> </div> <div class="tr card-expiry"> <div class="th"> <span class="flexbe-text">{tr(\'admin::user::pay::stripe::card_expiry\')}</span> </div> <div class="td card-input" ref="cardExpiry"></div> <div class="td card-advanced"></div> </div> <div class="tr card-cvc"> <div class="th"> <div class="inline-box"> <span class="flexbe-text"> CVV/CVC </span> <q data-is="flexbe-tooltip" theme="tooltipster-light"> <svg width="60" height="42"> <use riot-xlink:href="{tag.sprite}#cvc"></use> </svg> </q> </div> </div> <div class="td card-input" ref="cardCvc"></div> <div class="td card-advanced"></div> </div> </div> </div>',"",'class="admin-user-pay-view-stripe {opts.class}"',(function(e){let t;const s=e.main,i=s.data;this.tag=this,this.main=s,this.data=i,this.cardBrand=!1,this.sprite=s.sprite,this.elements={};const a={base:{color:"#30343b",fontWeight:"normal",fontFamily:"Museo Sans, Formular, Open Sans, sans-serif",fontSize:"15px",fontSmoothing:"antialiased","::placeholder":{color:"#c1c2c4"},":hover::placeholder":{color:"#acaeb1"},":focus::placeholder":{color:"#acaeb1"}},invalid:{color:"#ff4747","::placeholder":{color:"rgba(255, 71, 71, 0.5)"}}},n={base:"stripe-element",focus:"focus",empty:"empty",invalid:"invalid",complete:"complete"},r=()=>{if(!t&&e.stripe){this.off("mount",r),this.off("update",r),t=e.stripe;const s=t.elements({fonts:[{family:"Museo Sans",src:"url(https://flexbe.ru/_s/files/fonts/museo500.eot)",weight:"normal"}]});["cardNumber","cardExpiry","cardCvc"].forEach((e=>{const t=s.create(e,{style:a,classes:n}),i=this.refs[e];t.mount(i),this.elements[e]=t})),this.elements.cardNumber.on("change",(e=>{this.update({cardBrand:!!["visa","mastercard"].includes(e.brand)&&e.brand})}))}};this.on("mount",r),this.on("update",r)})),riot3.tag2("admin-user-pay-view-summary",'<div class="flexbe-title text-subtitle"> <span class="flexbe-text" if="{main.isAutoPayment}">{tr(\'admin::user::pay::summary::autopay_title\')}</span> <span class="flexbe-text" if="{!main.isAutoPayment}">{tr(\'admin::user::pay::summary::title\')}</span> <virtual if="{data.show_promocode && !main.isAutoPayment}"> <div class="enter-promocode" if="{!data.entered_promocode.code}" onclick="{addPromocode}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{sprite}#promocode"></use></svg> <span class="flexbe-text">{tr(\'admin::user::pay::summary::enter_promocode_button\')}</span> </div> <div class="promocode-label" if="{data.entered_promocode.code && !inPromocodeRemove}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{sprite}#promocode"></use></svg> <span class="flexbe-text" data-is="flexbe-tooltip" promocode="{data.entered_promocode}" content="{data.entered_promocode.text ? data.entered_promocode.code : false}"> {opts.promocode.text || opts.promocode.code} </span> <span class="flexbe-close" onclick="{removePromocode}"></span> </div> </virtual> <div class="other-methods" if="{main.isRussian && main.isAutoPayment}"> <a href="?manual=1" class="flexbe-text"> {tr(\'admin::user::pay::summary::manual_payment_button\')} </a> </div> </div> <div class="flexbe-white-box shadow inline-box between"> <span class="flexbe-text summary-text">{getSummaryText()}</span> <span class="flexbe-text summary-price">{getSummaryPrice()}</span> </div> <div class="flexbe-desc mt10" if="{gePrompt()}">{gePrompt()}</div>',"",'class="admin-user-pay-view-summary {opts.class}"',(function(e){const t=e.main,s=t.data;this.tag=this,this.main=t,this.data=s,this.sprite=flexbe.lib.getSprite("pay","admin"),s.entered_promocode||(s.entered_promocode={}),this.getSmsPlan=function(e=s.active_sms_plan){return s.sms_plans.find((t=>t.id===e))||s.sms_plans[0]}.bind(this),this.getSummaryText=function(){if("plan"===s.pay_service){let e;switch(s.bill_period){case"month":e=tr("admin::user::pay::period::for_month");break;case"month3":e=tr("admin::user::pay::period::for_month3");break;case"year":e=tr("admin::user::pay::period::for_year")}let t=s.bill_plan.title;return tr("admin::user::pay::summary::pay_purpose",{plan:t,period:e})}if("sms"===s.pay_service){const e=this.getSmsPlan();return tr("admin::user::pay::summary::pay_purpose_sms",{count:e.count})}if("domain"===s.pay_service){const e=s.domain_data;return e.renew_id?tr("admin::user::pay::summary::pay_purpose_domain_renew",{domain:e.reg_domain}):tr("admin::user::pay::summary::pay_purpose_domain_reg",{domain:e.reg_domain})}if("belgie"===s.pay_service)return tr("admin::user::pay::summary::pay_belgie_reg")}.bind(this),this.getSummaryPrice=function(){let e="";if("plan"===s.pay_service){const t=s.bill_period;e=(s.bill_plan.price[t]||{}).price_text}else if("sms"===s.pay_service){e=this.getSmsPlan().price_text}else"domain"===s.pay_service?e=s.domain_data.reg_price_text:"belgie"===s.pay_service&&(e=s.pay_sum_text);return e||""}.bind(this),this.gePrompt=function(){let e=!1;return"belgie"===s.pay_service&&(e=tr("admin::user::pay::tip::pay_belgie_reg")),e}.bind(this),this.addPromocode=function(){flexbe.modals.bill.showCouponEnter({code:s.entered_promocode.code})}.bind(this),this.removePromocode=function(){const e=s.entered_promocode.code;this.update({inPromocodeRemove:!0}),flexbe.bill.removePromocode(e,((e,t)=>{this.update({inPromocodeRemove:!1}),e&&toast.error(e.message)}))}.bind(this)})),riot3.tag2("admin-user-pay-view-period",'<div class="tbody"> <label class="tr" each="{data, period in opts.plan.price}"> <div class="td row-title"> <div data-is="flexbe-input" type="radio" name="period{eventId}" riot-value="{period}" checked="{opts.period == period}" onclick="{selectPeriod.bind(tag, period)}"> <span class="flexbe-text">{tag.getPeriodLabel(opts.riotValue)}</span> </div> </div> <div class="td row-price"> <span class="price">{data.price_month_text}</span> <span class="desc">{tr(\'admin::user::pay::plan::month_desc\', { count: \'\' } )}</span> </div> <div class="td row-discount"> <div class="discount-beidge" if="{data.discount}"> {tr(\'admin::user::pay::period::discount_badge\', { discount: data.discount })} </div> </div> </label> </div>',"",'class="admin-user-pay-view-period flexbe-table {opts.class}"',(function(e){const t=e.main;this.tag=this,this.main=t,this.eventId=Math.floor(1e3*Math.random()),this.selectPeriod=function(t){e.select&&e.select(t)}.bind(this),this.getPeriodLabel=function(e){switch(e){case"month":return tr("admin::user::pay::period::each_month");case"month3":return tr("admin::user::pay::period::each_month3");case"year":return tr("admin::user::pay::period::each_year");default:return tr("admin::user::pay::period::each_month")}}.bind(this)})),riot3.tag2("admin-user-pay-view-sms-plans",'<div class="flexbe-title text-subtitle"> {tr(\'admin::user::pay::sms::select_title\')} </div> <div class="flexbe-white-box shadow flexbe-table"> <div class="tbody"> <label class="tr" each="{plan in opts.list}"> <div class="td row-count"> <div data-is="flexbe-input" class="text-inherit" type="radio" name="sms_plan" plan="{plan}" riot-value="{plan.id}" checked="{opts.active == plan.id}" onclick="{selectPlan}"> <span class="flexbe-text"> {tr(\'admin::user::pay::sms_desc\', { count: opts.plan.count })} </span> </div> </div> <div class="td row-one"> <span class="price">{plan.price_one_text}</span> <span class="desc">{tr(\'admin::user::pay::sms_desc\', { count: \'/\' })}</span> </div> <div class="td row-total"> <span class="price"> {plan.price_text} </span> </div> </label> </div> </div> <div class="flexbe-desc mt20"> {tr(\'admin::user::pay::sms::note\')} </div>',"",'class="admin-user-pay-view-sms-plans {opts.class}"',(function(e){const t=e.main;this.tag=this,this.main=t,this.selectPlan=function(t){const s=t.item.plan;e.select&&e.select(s)}.bind(this)})),riot3.tag2("admin-user-pay-view-belgie",'<div class="flexbe-title text-subtitle"> {tr(\'admin::user::pay::belgie::select_title\')} </div> <div class="flexbe-white-box shadow flexbe-table"> <div class="tbody"> <label key="{index}" class="tr" each="{item, index in meta.list}"> <div class="td row-count"> <div data-is="flexbe-input" class="text-inherit" type="radio" name="belgie_legal" item="{item}" riot-value="{item.type}" checked="{item.type === tag.state.legalActive}" onclick="{selectLegal.bind(tag, item.type)}"> <span class="flexbe-text"> {tr(opts.item.name)} </span> </div> </div> </label> </div> </div> <div each="{block in blocks}" if="{!block.hide}"> <div class="flexbe-title text-subtitle mt40">{tr(block.title)}</div> <div class="flexbe-white-box shadow flexbe-table"> <div class="tbody"> <div class="tr" each="{field in block.list}"> <div class="th middle"> <span class="flexbe-text">{field.label}</span> <span class="flexbe-text" if="{field.required}">*</span> </div> <div class="td middle"> <div data-is="flexbe-input" class="transparent text-inherit" placeholder="{field.placeholder}" replace="{field.replace}" pattern="{field.pattern}" name="{field.name}" mask="{field.mask}" mask-init="{field.maskInit}" error="{!!field.error}" error-text="{field.error}" riot-value="{field.value}" oninput="{field.onchange}" onchange="{field.onchange}"> </div> </div> </div> </div> </div> </div>',"",'class="admin-user-pay-view-belgie {opts.class}"',(function(e){const t=this;this.tag=t,this.form=e.data,this.state={get legalActive(){return localStorage.getItem("form_legal_form")??t.form.legal_form??"fiz"}},this.meta={list:[{type:"fiz",name:"admin::user::pay::belgie::select_fiz"},{type:"ooo",name:"admin::user::pay::belgie::select_ur"},{type:"ip",name:"admin::user::pay::belgie::select_ip"}]};const s=(e,s,i)=>{const a=vt({get value(){return t.form[e][s]},set value(i){t.form[e][s]=i,localStorage.setItem(`form_${e}_${s}`,i)},onInit:()=>{t.form[e][s]||(t.form[e][s]=localStorage.getItem(`form_${e}_${s}`)??"")}},i);return new Hl(s,a)},i={nameCompany:s("owner","name_company",{label:tr("admin::user::pay::belgie::form::owner::name_company::title"),placeholder:tr("admin::user::pay::belgie::form::owner::name_company::placeholder"),replace:"[^a-zA-Z--0-9 -]",required:1,validators:[Ul.required]}),fullName:s("owner","full_name",{label:tr("admin::user::pay::belgie::form::owner::full_name::title"),placeholder:tr("admin::user::pay::belgie::form::owner::full_name::placeholder"),replace:"[^a-zA-Z--0-9 -]",required:1,validators:[Ul.required]}),address:s("owner","address",{label:tr("admin::user::pay::belgie::form::owner::address::title"),placeholder:tr("admin::user::pay::belgie::form::owner::address::placeholder"),required:1,validators:[Ul.required]}),phone:s("owner","phone",{label:tr("admin::user::pay::belgie::form::owner::phone::title"),placeholder:tr("admin::user::pay::belgie::form::owner::phone::placeholder"),replace:"[^0-9 -+]",required:1,validators:[Ul.required]}),email:s("owner","email",{label:"E-mail",placeholder:"E-mail",required:1,name:"email",validators:[Ul.required,Ul.email],onInit:()=>{t.form.owner.email&&!localStorage.getItem("form_owner_email")||(t.form.owner.email=localStorage.getItem("form_owner_email")??flexbe.vars.user.mail)}}),typeRegistration:s("state_registration","type",{label:tr("admin::user::pay::belgie::form::state_registration::type::title"),placeholder:tr("admin::user::pay::belgie::form::state_registration::type::placeholder"),required:1,validators:[Ul.required]}),registeredBy:s("state_registration","registered_by",{label:tr("admin::user::pay::belgie::form::state_registration::registered_by::title"),placeholder:tr("admin::user::pay::belgie::form::state_registration::registered_by::placeholder"),required:1,validators:[Ul.required]}),registerdAt:s("state_registration","registered_at",{label:tr("admin::user::pay::belgie::form::state_registration::registered_at::title"),placeholder:tr("admin::user::pay::belgie::form::state_registration::registered_at::placeholder"),required:1,mask:{mask:Date,min:new Date(1920,0,1),max:new Date},validators:[Ul.required,Ul.mask]}),solutionNumber:s("state_registration","solution_number",{label:tr("admin::user::pay::belgie::form::state_registration::solution_number::title"),placeholder:tr("admin::user::pay::belgie::form::state_registration::solution_number::placeholder")}),accountNumber:s("state_registration","account_number",{label:tr("admin::user::pay::belgie::form::state_registration::account_number::title"),placeholder:tr("admin::user::pay::belgie::form::state_registration::account_number::placeholder"),required:1,validators:[Ul.required]}),identifierDocument:s("document","identifier",{label:tr("admin::user::pay::belgie::form::document::identifier::title"),placeholder:tr("admin::user::pay::belgie::form::document::identifier::placeholder"),required:1,validators:[Ul.required]}),typeDocument:s("document","type",{label:tr("admin::user::pay::belgie::form::document::type::title"),placeholder:tr("admin::user::pay::belgie::form::document::type::placeholder"),required:1,validators:[Ul.required]}),serialNumber:s("document","serial_number",{label:tr("admin::user::pay::belgie::form::document::serial_number::title"),placeholder:tr("admin::user::pay::belgie::form::document::serial_number::placeholder"),required:1,validators:[Ul.required]}),documentNumber:s("document","document_number",{label:tr("admin::user::pay::belgie::form::document::document_number::title"),placeholder:tr("admin::user::pay::belgie::form::document::document_number::placeholder"),required:1,validators:[Ul.required]}),issuedBy:s("document","issued_by",{label:tr("admin::user::pay::belgie::form::document::issued_by::title"),placeholder:tr("admin::user::pay::belgie::form::document::issued_by::placeholder"),required:1,validators:[Ul.required]}),issuedAt:s("document","issued_at",{label:tr("admin::user::pay::belgie::form::document::issued_at::title"),placeholder:tr("admin::user::pay::belgie::form::document::issued_at::placeholder"),required:1,mask:{mask:Date,min:new Date(1920,0,1),max:new Date},validators:[Ul.required,Ul.mask]}),name:s("domain","name",{label:tr("admin::user::pay::belgie::form::domain::name::title"),placeholder:tr("admin::user::pay::belgie::form::domain::name::placeholder"),required:1,validators:[Ul.required,Ul.isDomain],onInit:()=>{if(t.form.domain.name&&!window.location.search.replace("?domain=","")||"app.flexbe.com"===flexbe.vars.group.domain||flexbe.vars.group.domain.includes("myflexbe.com"))t.form.domain.name=localStorage.getItem("form_domain_name")??t.form.domain.name;else{const e=window.location.search.replace("?domain=","")||flexbe.vars.group.domain;t.form.domain.name=decodeURI(e)}}}),description:s("domain","description",{label:tr("admin::user::pay::belgie::form::domain::description::title"),placeholder:tr("admin::user::pay::belgie::form::domain::description::placeholder"),required:1,validators:[Ul.required]})};this.blocks=[{title:"admin::user::pay::belgie::form::owner::title",get list(){const e=[i.fullName,i.address,i.phone,i.email];return"ooo"===t.state.legalActive&&e.unshift(i.nameCompany),e}},{title:"admin::user::pay::belgie::form::document::title",get hide(){return"ooo"===t.state.legalActive},list:[i.identifierDocument,i.typeDocument,i.serialNumber,i.documentNumber,i.issuedBy,i.issuedAt]},{title:"admin::user::pay::belgie::form::registration::title",get hide(){return"fiz"===t.state.legalActive},list:[i.typeRegistration,i.registeredBy,i.registerdAt,i.solutionNumber,i.accountNumber]},{title:"admin::user::pay::belgie::form::domain::title",list:[i.name,i.description]}],this.selectLegal=function(e){e&&(this.form.legal_form=e,localStorage.setItem("form_legal_form",e),this.update())}.bind(this),this.validateAll=function(){const e=this.blocks.filter((e=>!e.hide)).flatMap((e=>e.list)).map((e=>e.validate("submit"))).every((e=>e));return this.update(),e}.bind(this),this.onBeforeMount=function(){this.form.legal_form=localStorage.getItem("form_legal_form")??"fiz"}.bind(this),this.onMounted=function(){e.registerValidator&&e.registerValidator(this.validateAll)}.bind(this),this.onUnmounted=function(){e.unregisterValidator&&e.unregisterValidator(this.validateAll)}.bind(this)}));const id={css:null,exports:{setup(e,{initMobx:t,inject:s}){t();const i=e.props.user||{};this.modal=s("modal"),this.state={inSave:!1,showErrors:!1,userMailError:!1,userProjectsIds:Object.assign([],i.projects),projectsStore:adminStore.getModule("projects"),user:i,userId:i.id,userMail:i.email,userRole:i.role||"admin",get type(){return e.props.type||"create"}},this.meta={sprite:at("user.members","admin"),roles:[{value:"admin",title:tr("admin::members::roles::admin_title"),desc:tr("admin::members::roles::admin_desc")},{value:"editor",title:tr("admin::members::roles::editor_title"),desc:tr("admin::members::roles::editor_desc")},{value:"manager",title:tr("admin::members::roles::manager_title"),desc:tr("admin::members::roles::manager_desc")}]},this.watch={"state.inSave":()=>this.update(),"state.userRole":()=>this.update(),"state.showErrors":()=>this.update(),"state.userMailError":()=>this.update(),"state.userProjectsIds":()=>this.update()}},setEmail(e){"edit"!==this.state.type&&(this.state.userMail=String(e.target.value).trim(),"change"===e.type&&(this.state.showErrors=!0),this._checkEmail())},setRole(e){this.state.userRole!==e.value&&("admin"===this.state.userRole&&(this.state.userProjectsIds=[]),this.state.userRole=e.value,setTimeout((()=>{this.refs.email.dispatchEvent(new InputEvent("focus"))}),300),this._setWidth())},onSelectProjects(e){this.state.userProjectsIds=e||[]},async saveHandler(e){if(e.preventDefault(),e.stopPropagation(),this.state.showErrors=!0,this._checkEmail(),this.state.userMailError)return this.refs.email.shake(),void this.refs.email.focus();if("admin"!==this.state.userRole&&!this.state.userProjectsIds.length){const e=this.refs.projects;return e.classList.remove("shake-animation"),requestAnimationFrame((()=>{e.classList.add("shake-animation")})),void toast.error(tr("admin::members::edit::projects_fill_error"))}const{userId:t,userRole:s,userMail:i,userProjectsIds:a}=this.state,n={id:t,role:s,email:i,projects:a};this.state.inSave=!0;try{var r,o;const e=await flexbe.admin.user.members.save(n);if(this.state.inSave=!1,!e.data)return toast.error(tr("main::error::incorrect_answer"));null==(r=(o=this.props).onSave)||r.call(o,e.data),this.modal.close()}catch(e){this.state.inSave=!1,this.props.onErorr?this.props.onErorr(e):toast.error(e.message)}},_checkEmail(){const e=this.state.userMail,t=!ar(e),s=!t&&!this.state.userId&&(this.props.members||[]).find((t=>t.email===e));e?this.state.userMailError=t?tr("main::error::invalid_email"):!!s&&tr("admin::members::edit::user_exist_error"):this.state.showErrors=tr("main::error::fill_field")},_setWidth(){const e="admin"===this.state.userRole?340:680;this.state.currentWidth!==e&&(anime({targets:this.root,width:e,duration:350,easing:"easeOutExpo"}),this.state.currentWidth=e)},async onBeforeMount(){await this.state.projectsStore.loadProjects()},onMounted(){this.refs={email:this.$(".email-input"),projects:this.$(".select-projects")}}},template:(e,t,s,i)=>e('<form expr1107="expr1107" class="row gap-40"><div class="col left-col"><div class="flexbe-field-group user-mail"><div expr1108="expr1108" class="flexbe-title"> </div><div expr1109="expr1109" is="flexbe-input" class="email-input"></div></div><div class="flexbe-field-group user-roles"><div expr1110="expr1110"></div></div><button expr1114="expr1114" type="submit"><span expr1115="expr1115" class="flexbe-text"></span><span expr1116="expr1116" class="flexbe-text"></span></button></div><div expr1117="expr1117" is="select-projects" class="col"></div></form>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["member-edit-modal flexbe-modal-content ",e.props.class].join("")}]},{redundantAttribute:"expr1107",selector:"[expr1107]",expressions:[{type:t.EVENT,name:"onsubmit",evaluate:e=>e.saveHandler}]},{redundantAttribute:"expr1108",selector:"[expr1108]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::label::email")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.userMail},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::members::email_placeholder")},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>"edit"===e.state.type},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.state.showErrors&&e.state.userMailError},{type:t.ATTRIBUTE,name:"error-tip",evaluate:e=>e.state.userMailError},{type:t.EVENT,name:"oninput",evaluate:e=>e.setEmail},{type:t.EVENT,name:"onchange",evaluate:e=>e.setEmail},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0}],redundantAttribute:"expr1109",selector:"[expr1109]"},{type:s.EACH,getKey:null,condition:null,template:e('<div class="inline-box"><div expr1111="expr1111" is="flexbe-icon" class="role-icon"></div><span expr1112="expr1112" class="flexbe-text flexbe-title role-name"> </span><div class="flexbe-check"></div></div><div expr1113="expr1113" class="role-desc flexbe-desc"> </div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["role-item ",e.classNames({active:e.role.value===e.state.userRole})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.setRole(e.role)}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>`role-${e.role.value}`}],redundantAttribute:"expr1111",selector:"[expr1111]"},{redundantAttribute:"expr1112",selector:"[expr1112]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.role.title].join("")}]},{redundantAttribute:"expr1113",selector:"[expr1113]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.role.desc].join("")}]}]),redundantAttribute:"expr1110",selector:"[expr1110]",itemName:"role",indexName:null,evaluate:e=>e.meta.roles},{redundantAttribute:"expr1114",selector:"[expr1114]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button filled is-primary mt5 ",e.classNames({loading:e.state.inSave})].join("")}]},{type:s.IF,evaluate:e=>"create"===e.state.type,redundantAttribute:"expr1115",selector:"[expr1115]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::members::add_user_button")].join("")}]}])},{type:s.IF,evaluate:e=>"edit"===e.state.type,redundantAttribute:"expr1116",selector:"[expr1116]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::button::save")].join("")}]}])},{type:s.IF,evaluate:e=>"admin"!==e.state.userRole,redundantAttribute:"expr1117",selector:"[expr1117]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"select-projects",slots:[],attributes:[{type:t.ATTRIBUTE,name:"selected-projects",evaluate:e=>e.state.userProjectsIds},{type:t.ATTRIBUTE,name:"projects-store",evaluate:e=>e.state.projectsStore},{type:t.ATTRIBUTE,name:"show-toggle",evaluate:e=>!0},{type:t.EVENT,name:"on-change",evaluate:e=>e.onSelectProjects}]}])}]),name:"member-edit-modal"};e(id.name,id),riot3.tag2("member-limit-modal",'<img class="users-img" src="/_s/images/admin/members/users_empty.png" alt="empty"> <div class="users-desc flexbe-text text-h3"> {tr(\'admin::members::limit_desc\')} </div> <div class="flexbe-button filled is-primary" onclick="{clickHandler}"> <span class="flexbe-text"> {tr(\'main::button::change_plan\')} </span> </div>',"",'class="member-limit-modal {opts.class}"',(function(e){this.clickHandler=function(t){e.modal.close(),flexbe.modals.bill.showPlanChange(e.onChange)}.bind(this)}));riot3.tag2("user-section-members",'<header> <div class="flexbe-title text-title">{tr(\'admin::members::title\')}</div> </header> <div class="group-list slide-down-animation"> <div data-is="user-block-members-restricted" class="group-item" if="{membersLimit == 0 && !members.length}"></div> <div data-is="user-block-members-empty" class="group-item" if="{membersLimit > 0 && !members.length}"></div> <div data-is="user-block-members-list" class="group-item" if="{members.length}"></div> </div>',"",'class="user-section-members pb60 {opts.class}"',(function(e){const t=JSON.parse(e.dataJson),s=e=>{this.update({membersLimit:flexbe.bill.usersLimit})},i=()=>{this.members=ge(this.members,{role:"ASC",email:"ASC"}),this.update()};this.projects=t.projects,this.members=t.members,this.membersLimit=null,this.membersSprite=flexbe.lib.getSprite("user.members","admin"),this.removeMember=function(e){As({clickOut:!0,props:{icon:`${this.membersSprite}#revoke-confirm-modal`,title:tr("admin::members::list::revoke_confirm_title",{email:e.email}),onConfirm:()=>flexbe.admin.user.members.revoke({id:e.id}),onDone:t=>{if(!t)return;const s=this.members.findIndex((t=>t.id===e.id));if(-1!==s){const e=this.members.splice(s,1)[0];this.update(),e&&toast.success(tr("admin::members::list::user_removed_notify",{email:e.email}))}},onError:e=>{toast.error(e.message)}}})}.bind(this),this.addMember=function(e){if(this.members.length>=this.membersLimit)return t=(t,s)=>{!t&&s&&this.addMember(e)},Zs.create({overlay:!0,shadow:!0,width:400,riotTag:"member-limit-modal",props:{onChange:t}});var t;(({projects:e,members:t,onSave:s}={})=>{Zs.create({overlay:!0,shadow:!0,handle:!1,title:tr("admin::members::create::modal_title"),scrollable:!1,height:450,component:"member-edit-modal",props:{type:"create",members:t,projects:e,onSave:s}})})({members:this.members,projects:this.projects,onSave:this.saveMember})}.bind(this),this.editMember=function(e){(({user:e,projects:t,onSave:s}={})=>{Zs.create({overlay:!0,shadow:!0,handle:!1,title:tr("admin::members::edit::modal_title"),scrollable:!1,height:450,component:"member-edit-modal",props:{type:"edit",user:e,projects:t,onSave:s}})})({projects:this.projects,user:e,onSave:this.saveMember})}.bind(this),this.saveMember=function(e){if(!e)return;const t=this.members.findIndex((t=>t.id==e.id));-1!==t?(this.members[t]=Object.assign(this.members[t],e),toast.success(tr("admin::members::edit::edited_notify",{email:e.email}))):(this.members.push(e),toast.success(tr("admin::members::edit::created_notify",{email:e.email}))),i(),this.update()}.bind(this),this.on("before-mount",(()=>{s(),i(),flexbe.on("bill-plan-changed",s)})),this.on("unmount",(()=>{flexbe.off("bill-plan-changed",s)})),this.on("mount",(()=>{this.root.removeAttribute("data-json")}))})),riot3.tag2("user-block-members-list",'<div class="flexbe-white-box shadow collection"> <div class="collection-item collection-header font-ui"> <div class="row gap-50"> <div class="col account">{tr(\'admin::members::list::user_title\')}</div> <div class="col role">{tr(\'admin::members::list::role_title\')}</div> <div class="col project">{tr(\'admin::members::list::project_title\')}</div> </div> </div> <div class="collection-item" role="item" if="{owner.role === \'owner\'}"> <div class="row gap-50"> <div class="col account"> <span data-is="user-avatar" user-image="{owner.avatar}" user-mail="{owner.email}"> </span> <span class="user-mail flexbe-text"> {owner.email} </span> </div> <div class="col role"> <span class="flexbe-text" data-tip="{roles[owner.role].desc}" data-width="300"> {roles[owner.role].title} </span> </div> <div class="col project"> <div class="projects-list"> <span class="flexbe-text"> {tr(\'admin::members::list::projects_all\')} </span> </div> </div> <div class="col controls"></div> </div> </div> <div class="collection-item" role="item" each="{user in members}"> <div class="row gap-50"> <div class="col account"> <span data-is="user-avatar" user-image="{user.avatar}" user-mail="{user.email}"> </span> <span class="user-mail flexbe-text"> {user.email} </span> </div> <div class="col role"> <span class="flexbe-text" data-tip="{roles[user.role].desc}" data-width="300"> {roles[user.role].title} </span> </div> <div class="col project"> <div class="projects-list {has-dropdown: user.role != \'admin\'}"> <virtual if="{user.role == \'admin\'}"> <span class="flexbe-text"> {tr(\'admin::members::list::projects_all\')} </span> </virtual> <virtual if="{user.role != \'admin\'}"> <span class="flexbe-text"> {tr(\'admin::members::list::projects_count\', { count: (user.projects || []).length })} </span> <svg class="arrow-down" width="8" height="5" viewbox="0 0 8 5"> <path d="M4 3L7 0L8 1L4 5L0 1L1 0L4 3Z"></path> </svg> <dropdown class="projects-list-dropdown" position="center" direction="bottom" force-direction="{true}" groups="{user.projects}" projects="{tag.projects}"> <div class="dropdown-header"> <div class="flexbe-title">{tr(\'admin::members::list::projects_dropdown_title\')}</div> </div> <div data-is="members-element-projects" groups="{opts.groups}" projects="{opts.projects}" show-toggle="{false}"> </div> </dropdown> </virtual> </div> </div> <div class="col controls"> <div class="flexbe-action-buttons"> <div class="action-button" onclick="{editHandler}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{settingsSprite}#settings"></use></svg> </div> <div class="action-button" onclick="{revokeHandler}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{settingsSprite}#remove"></use></svg> </div> </div> </div> </div> </div> <div class="collection-item shade"> <div class="flexbe-button small is-primary filled" onclick="{addHandler}"> <span class="flexbe-text">{tr(\'admin::members::add_user_button\')}</span> </div> <div class="users-count flexbe-desc"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{membersSprite}#users_limit"></use> </svg> <span class="flexbe-text" if="{isOwner}"> {members.length + 1}/{main.membersLimit + 1} </span> <span class="flexbe-text" if="{!isOwner}"> {members.length}/{main.membersLimit} </span> </div> </div> </div>',"",'class="user-block-members-list {opts.class}"',(function(e){const t=this.main;this.settingsSprite=flexbe.lib.getSprite("settings","admin"),this.membersSprite=flexbe.lib.getSprite("user.members","admin"),this.members=t.members,this.projects=t.projects,this.roles={owner:{title:tr("admin::members::roles::owner_title"),desc:tr("admin::members::roles::owner_desc")},admin:{title:tr("admin::members::roles::admin_title"),desc:tr("admin::members::roles::admin_desc")},editor:{title:tr("admin::members::roles::editor_title"),desc:tr("admin::members::roles::editor_desc")},manager:{title:tr("admin::members::roles::manager_title"),desc:tr("admin::members::roles::manager_desc")}},this.owner={id:flexbe.vars.user.id,avatar:flexbe.vars.user.avatar,email:flexbe.vars.user.mail,role:flexbe.vars.user.role},this.isOwner="owner"===flexbe.vars.user.role,this.addHandler=function(){t.addMember()}.bind(this),this.editHandler=function(e){t.editMember(e.item.user)}.bind(this),this.revokeHandler=function(e){t.removeMember(e.item.user)}.bind(this)})),riot3.tag2("user-block-members-empty",'<div class="flexbe-white-box shadow is-card"> <img class="users-img" src="/_s/images/admin/members/users_empty.png" alt="empty"> <div class="users-desc flexbe-text"> {tr(\'admin::members::empty_desc\')} </div> <div class="flexbe-button filled rounded large is-primary" onclick="{main.addMember}"> <span class="flexbe-text"> {tr(\'admin::members::add_user_button\')} </span> </div> </div>',"",'class="user-block-members-empty {opts.class}"',(function(e){})),riot3.tag2("user-block-members-restricted",'<div class="flexbe-white-box shadow is-card"> <img class="users-img" src="/_s/images/admin/members/users_empty.png" alt="empty"> <div class="users-title flexbe-text"> {tr(\'admin::members::notallowed_title\')} </div> <div class="users-desc flexbe-desc"> {tr(\'admin::members::empty_desc\')} </div> <div class="flexbe-button filled rounded large is-primary" onclick="{clickHandler}"> <span class="flexbe-text"> {tr(\'main::button::change_plan\')} </span> </div> </div>',"",'class="user-block-members-restricted {opts.class}"',(function(e){this.clickHandler=function(e){flexbe.modals.bill.showPlanChange()}.bind(this)})),riot3.tag2("members-element-projects",'<label class="flexbe-list-item" each="{project in projects}" onchange="{toggleHandler}"> <div class="site-preview"> <div if="{project.img_id}" class="preview-image" riot-style="background-image: url(\'/img/{project.img_id}_120.jpg\')"></div> </div> <span class="flexbe-text project-domain"> {project.domain} </span> <div if="{showToggle}" data-is="flexbe-input" type="toggle" class="project-toggle" checked="{isChecked(project.id)}"> </div> </label>',"",'class="members-element-projects flexbe-list scrollable-content {has-toggle: showToggle} {opts.class}"',(function(e){this.on("before-mount",(()=>{this.showToggle=e.showToggle,this.projects=e.projects||[],this.showToggle||(this.projects=this.projects.filter((e=>this.isChecked(e.id))))})),this.isChecked=function(t){return(e.groups||[]).find((e=>e==t))}.bind(this),this.toggleHandler=function(t){const s=t.target.checked,i=t.item.project;"function"==typeof e.ontoggle&&e.ontoggle(s,i)}.bind(this)})),riot3.tag2("settings-side-menu",'<div data-is="side-menu" menu="{menu}"></div>',"",'class="admin-side-menu settings-side-menu {opts.class}"',(function(e){const t="owner"===flexbe.vars.user.role,s={icon:"general",text:tr("admin::settings::menu::general"),href:"/admin/settings/general/"},i={icon:"localization",text:tr("admin::settings::menu::domain"),href:"/admin/settings/domains/"},a={icon:"notification",text:tr("admin::settings::menu::notify"),href:"/admin/settings/notify/"},n={icon:"optimization",text:tr("admin::settings::menu::optimization"),href:"/admin/settings/optimization/"},r={icon:"confirm-rights",text:tr("admin::settings::menu::verify"),href:"/admin/settings/verify/"},o={icon:"robots",text:tr("admin::settings::menu::robots_txt"),href:"/admin/settings/robots/"},l={icon:"fonts",text:tr("admin::settings::menu::fonts"),href:"/admin/settings/fonts/"},d={show:t,icon:"users",text:tr("admin::settings::menu::access"),href:"/admin/settings/access/"},c={icon:"redirects",text:tr("admin::settings::menu::redirects"),href:"/admin/settings/redirects/"},p={icon:"notification-visitor",text:tr("admin::settings::menu::notification_visitor"),href:"/admin/settings/notification/visitor/"},u={icon:"ecommerce",text:tr("admin::settings::menu::ecommerce"),href:"/admin/settings/ecommerce/common/"},m={icon:"delivery",text:tr("admin::settings::menu::delivery"),href:"/admin/settings/ecommerce/delivery/"},h={icon:"promo",text:tr("admin::settings::menu::promocode"),href:"/admin/settings/ecommerce/promotion/"},g={icon:"legal",text:tr("admin::settings::menu::legal"),href:"/admin/settings/legal/"},v={icon:"counters",text:tr("admin::settings::menu::counters"),href:"/admin/settings/integration/counters/"},f={icon:"apps",text:tr("admin::settings::menu::widgets"),href:"/admin/settings/integration/widgets/"},x={icon:"mailing",text:tr("admin::settings::menu::mailing"),href:"/admin/settings/integration/mailing/"},b={icon:"crm",text:tr("admin::settings::menu::export_applications"),href:"/admin/settings/integration/crm/"},y={icon:"code",text:tr("admin::settings::menu::code"),href:"/admin/settings/code/"},_={icon:"pay",text:tr("admin::settings::menu::payments"),href:"/admin/settings/pay/"},T={icon:"mail",text:tr("admin::settings::menu::email"),href:"/admin/settings/integration/domain_mailing/"},w={icon:"api",text:tr("admin::settings::menu::api"),href:"/admin/settings/api/"},k={icon:"ai",text:tr("admin::settings::ai::title"),href:"/admin/settings/ai/"};this.menu={title:tr("admin::settings::menu::title"),groups:[{title:tr("admin::settings::menu::group_basic_title"),list:[s,i,a,n,l,y,g,r,o,c,d,p,k]},{title:tr("admin::settings::menu::group_ecommerce_title"),list:[u,m,h]},{title:tr("admin::settings::menu::group_integration_title"),list:[v,f,x,b,_,T,w]}]}})),riot3.tag2("settings-section-access",'<div class="group-list slide-down-animation"> <div data-is="user-block-members-restricted" class="group-item" if="{!state.limit}"></div> <div data-is="settings-block-access-empty" class="group-item" if="{state.limit && !state.members.length}"></div> <div data-is="settings-block-access-list" class="group-item" if="{state.limit && state.members.length}"></div> </div>',"",'class="settings-section-access pb60 {opts.class}"',(function(e){const t=this;this.state={get limit(){return flexbe.bill.usersLimit},get members(){return t.$state.members}},flexbe.on("bill-plan-changed",(()=>{this.update()}))})),riot3.tag2("settings-block-access-list",'<div class="flexbe-white-box shadow collection"> <div class="collection-item collection-header font-ui"> <div class="row gap-50"> <div class="col account">{tr(\'admin::members::list::user_title\')}</div> <div class="col role">{tr(\'admin::members::list::role_title\')}</div> </div> </div> <div class="collection-item {shaded: !user.has_access}" role="item" each="{user in state.members}" user-role="{user.role}"> <div class="row gap-50"> <div class="col account"> <span data-is="user-avatar" user-image="{user.avatar}" user-mail="{user.email}"> </span> <span class="user-mail flexbe-text"> {user.email} </span> </div> <div class="col role"> <span class="flexbe-text" role="{user.role}" data-tip="{roles[user.role].desc}" data-width="300"> {roles[user.role].title} </span> </div> <div class="col controls"> <div class="toggle-access" data-tip="{user.role == \'admin\' ? tr(\'admin::settings::access::admin_access_warning\') : false}"> <label data-is="flexbe-input" type="toggle" class="large" disabled="{user.role == \'admin\' || user.role == \'owner\'}" checked="{user.role == \'admin\' || user.has_access}" onchange="{toggleAccess}"> </label> </div> </div> </div> </div> </div>',"",'class="settings-block-access-list {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.roles={owner:{title:tr("admin::members::roles::owner_title"),desc:tr("admin::members::roles::owner_desc")},admin:{title:tr("admin::members::roles::admin_title"),desc:tr("admin::members::roles::admin_desc")},editor:{title:tr("admin::members::roles::editor_title"),desc:tr("admin::members::roles::editor_desc")},manager:{title:tr("admin::members::roles::manager_title"),desc:tr("admin::members::roles::manager_desc")}},this.state={get currentUser(){return{id:flexbe.vars.user.id,avatar:flexbe.vars.user.avatar,email:flexbe.vars.user.mail,role:"owner",has_access:!0}},get isOwner(){return"owner"===this.currentUser.role},get members(){const e=ge([...t.$state.members||[]],{role:"ASC",email:"ASC"});return this.isOwner?[this.currentUser,...e]:e}},this.toggleAccess=async function(e){const t=e.item.user,s=e.target.checked?1:0;try{await this.$store.toggleAccess({user:t,groupId:flexbe.vars.group.id,state:s}),toast.success(s?tr("admin::settings::access::access_grant_notify"):tr("admin::settings::access::access_revoke_notify"))}catch(e){"NetworkError"===e.name?toast.error(e.message):console.error(e)}this.update()}.bind(this),this.on("mount",(()=>{flexbe.tip.initArea(this.root)}))})),riot3.tag2("settings-block-access-empty",'<div class="flexbe-white-box shadow is-card"> <img class="users-img" src="/_s/images/admin/members/users_empty.png" alt="empty"> <div class="users-desc flexbe-text"> {tr(\'admin::members::empty_desc\')} </div> <a class="flexbe-button filled rounded large is-primary" href="/admin/user/members/"> <span class="flexbe-text"> {tr(\'admin::settings::access::user_control_button\')} </span> </a> </div>',"",'class="settings-block-access-empty {opts.class}"',(function(e){}));const ad={css:null,exports:null,template:(e,t,s,i)=>e('<a expr803="expr803" class="flexbe-button bordered large rounded is-primary" href="/admin/user/members/"></a>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["element-members-control-button header-button ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.$state.members.length,redundantAttribute:"expr803",selector:"[expr803]",template:e('<span expr804="expr804" class="flexbe-text"> </span>',[{redundantAttribute:"expr804",selector:"[expr804]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::access::user_control_button")}]}])}]),name:"element-members-control-button"};e(ad.name,ad),riot3.tag2("settings-section-legal",'<div class="group-list slide-down-animation"> <div data-is="settings-block-policy" class="group-content"></div> <div data-is="settings-block-cookies" class="group-content"></div> </div>',"",'class="settings-section-legal pb60 {opts.class}"',(function(e){})),riot3.tag2("settings-block-policy",'<div class="flexbe-title text-subtitle inline-box"> <span data-is="admin-save-text" class="flexbe-desc" status="{state.status}"></span> </div> <div class="shadow flexbe-white-box policy-settings collection p0 drop-zone-target"> <div class="collection-item"> <label data-is="flexbe-input" checked="{state.enabled}" class="large" onchange="{togglePolicy}" type="toggle"> <span>{tr(\'admin::settings::policy::enable_label\')}</span> </label> </div> <virtual if="{state.enabled}"> <div class="collection-item block"> <div class="flexbe-title mb15"> {tr(\'admin::settings::policy::type_label\')} </div> <div class="flexbe-field-group"> <label each="{item in meta.policyTypes}" class="large" data-is="flexbe-input" type="radio" name="policy_type" checked="{item.value === tag.state.policyType}" onchange="{setPolicyType.bind(tag, item.value)}"> <span class="flexbe-text">{item.title}</span> </label> </div> </div> <div class="collection-item upload-policy fade-in-animation"> <span if="{!state.filename}" class="flexbe-text flexbe-desc"> {tr(\'admin::settings::policy::file_empty\')} </span> <a if="{state.filename}" href="{state.data.file}" target="_blank" class="flexbe-text flexbe-desc"> {state.filename} </a> <div data-is="flexbe-button-upload" class="upload-favicon size-small" regular-class="is-secondary" common-class="small filled" button-title="{tr(\'admin::settings::policy::upload_file\')}" url="{meta.uploadUrl}" file-type="file" drop-zone=".drop-zone-target" onupload="{onUploadDone}" onerror="{onUploadError}" show-icon="0"></div> <div if="{state.filename}" class="flexbe-action-buttons ml-auto"> <div class="action-button"> <svg class="flexbe-icon size-16" onclick="{removePolicyFile}"> <use riot-xlink:href="{state.sprite}#remove"></use> </svg> </div> </div> </div> </virtual> <div if="{state.showHelper}" class="collection-item collection-footer shade"> <div class="flexbe-desc" data-is="raw" content="{tr(\'admin::settings::policy::ru_note\')}"></div> </div> </div>',"",'class="settings-block-policy {opts.class}"',(function(e){const t=this;this.meta={uploadUrl:`/admin/api/project/${flexbe.vars.group.id}/settings/policy/upload/`,policyTypes:[{value:"text",title:tr("admin::settings::policy::type_text")},{value:"checkbox",title:tr("admin::settings::policy::type_checkbox")}]},this.state={status:"saved",sprite:at("settings","admin"),get showHelper(){return"RU"===flexbe.vars.group.country},get data(){return t.$state.policy_personal_data},get enabled(){return this.data.show},get policyType(){return this.data.type??"text"},get filename(){const e=this.data.file;if(!e)return!1;const t=e.split("/");return t[t.length-1].split("?")[0]||!1}},this.togglePolicy=async function(e){const t=e.target.checked?1:0;await this.setPolicyData({show:t})}.bind(this),this.setPolicyType=async function(e){await this.setPolicyData({type:e})}.bind(this),this.setPolicyData=async function(e){this.state.status="saving";try{await this.$store.dispatch("updatePersonalData",{...this.state.data,...e}),this.state.status="success"}catch(e){this.state.status="error","NetworkError"===e.name?toast.error(e.message):console.error(e)}this.update()}.bind(this),this.removePolicyFile=async function(){this.state.status="saving";try{await this.$store.dispatch("removePolicyFile",{...this.state.data,file:""}),this.state.status="success"}catch(e){this.state.status="error","NetworkError"===e.name?toast.error(e.message):console.error(e)}this.update()}.bind(this),this.onUploadDone=function(e,t){t?.data?.policy_personal_data&&this.$store.commit("setPersonalData",t.data.policy_personal_data)}.bind(this),this.onUploadError=function(e,t){t.data?.errorMessage&&toast.error(t.data.errorMessage)}.bind(this)})),riot3.tag2("settings-block-cookies",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::cookies::title\')}</span> <div data-is="proxy" is="save-button" show-edit="{false}" show-save="{state.hasChanges}" on-save="{onSave}" on-error="{onError}"></div> </div> <div class="collection flexbe-white-box shadow p0 overflow" tabindex="0"> <div class="collection-item"> <label data-is="flexbe-input" checked="{state.show}" class="large" onchange="{toggleCookies}" type="toggle"> <span>{tr(\'admin::settings::cookies::enable_label\')}</span> </label> </div> <virtual if="{state.show}"> <div class="collection-item"> <label data-is="flexbe-input" checked="{state.allowCookies}" class="large" onchange="{toggleAllowCookies}" type="toggle"> <span>{tr(\'admin::settings::cookies::intercept_cookies::label\')}</span> <q data-is="flexbe-tooltip" max-width="535">{tr(\'admin::settings::cookies::intercept_cookies::tip\')}</q> </label> </div> <div class="collection-item"> <label data-is="flexbe-input" checked="{state.cookiesPolicy}" class="large" onchange="{toggleCookiesPolicy}" type="toggle"> <span>{tr(\'admin::settings::cookies::policy_label\')}</span> </label> </div> <div class="collection-item"> <label data-is="flexbe-input" checked="{state.cookiesText}" class="large" onchange="{toggleCookiesText}" type="toggle"> <span>{tr(\'admin::settings::cookies::notify_text_label\')}</span> </label> </div> <div class="collection-item block"> <div class="flexbe-text mb15"> {tr(\'admin::settings::cookies::descr::title\')} </div> <div class="cookies-style"> <div each="{card in cards}" class="cookies-style__item {check: state.style === card.img}" onclick="{toggleStyle}" key="{card.img}" data-key="{card.img}"> <div class="cookies-img"> <img riot-src="/_s/images/admin/png/cookies/{card.img}.png" alt=""> </div> <div class="cookies-text-wrap"> <svg class="flexbe-icon size-16 cookies-svg"> <use riot-href="{sprite}1#icon-check"></use> </svg> <span class="font-ui flexbe-text text-note">{card.description}</span> </div> </div> </div> </div> </virtual> <div class="flexbe-table block" if="{showFields()}"> <div class="tbody"> <div class="tr {field.class} {field.name}" each="{field, name in fields}" key="{name}" if="{(field.show || field.show == null)}"> <div class="th">{field.label}</div> <div class="td"> <div data-is="flexbe-input" name="textContent" class="transparent" type="{field.type}" rows="{field.rows}" error="{!!field.error}" error-text="{field.error}" placeholder="{field.placeholder}" riot-value="{field.value}" oninput="{field.onchange}" onchange="{field.onchange}"></div> </div> </div> </div> </div> </div> <div class="cookies-helper"> <div class="flexbe-desc" data-is="raw" content="{tr(\'admin::settings::cookies::note\')}"></div> </div>',"",'class="settings-block-cookies {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.sprite=at("settings","admin"),this.state={_lastValue:null,get data(){return t.$state.cookies_warning},get hasChanges(){return JSON.stringify(this._lastValue)!==JSON.stringify(t.$state.cookies_warning)},get style(){return this._lastValue.style??this.data?.style??"right_bottom"},get show(){return this._lastValue.show??this.data?.show??!1},get allowCookies(){return this._lastValue.dont_set_if_not_agree??this.data?.dont_set_if_not_agree??!1},get cookiesPolicy(){return this._lastValue.use_policy??this.data?.use_policy??!1},get cookiesText(){return this._lastValue.use_custom_warning_text??this.data?.use_custom_warning_text??!1},get baseText(){return"center_compact"===this.style?tr("admin::settings::cookies::short_text_notification"):tr("admin::settings::cookies::long_text_notification")}},this.cards=[{description:tr("admin::settings::cookies::descr::style_right"),img:"right_bottom"},{description:tr("admin::settings::cookies::descr::style_centre-compact"),img:"center_compact"},{description:tr("admin::settings::cookies::descr::style_centre-long"),img:"center_long"}];const s=(e,s)=>{const i=vt({get value(){return t.state._lastValue[e]},set value(s){t.state._lastValue[e]=s}},s);return new Hl(e,i)};this.fields={custom_warning_text:s("custom_warning_text",{label:tr("admin::settings::cookies::notify_text_title"),required:1,rows:3,type:"textarea",class:"cookie-text-textarea",get show(){return t.state.cookiesText&&t.state.show},validators:[Ul.required]}),button_text:s("button_text",{label:tr("admin::settings::cookies::text_button_title"),required:1,class:"cookie-text-input",get show(){return"center_compact"!==t.state.style&&t.state.cookiesText&&t.state.show},validators:[Ul.required]}),link_text:s("link_text",{label:tr("admin::settings::cookies::text_link_title"),required:1,class:"cookie-text-input",get show(){return t.state.cookiesPolicy&&t.state.show},validators:[Ul.required]}),policy_uri:s("policy_uri",{label:tr("admin::settings::cookies::page_policy_title"),required:1,class:"cookie-text-input",placeholder:"/legal/cookie-policy/",get show(){return t.state.cookiesPolicy&&t.state.show},set value(e){t.state._lastValue.policy_uri=rr(e)},get value(){return t.state._lastValue.policy_uri},validators:[Ul.required]})},this.showFields=function(){return!!Object.values(this.fields).filter((e=>e.show)).length}.bind(this),this.toggleCookies=function(e){const t=e.target.checked?1:0;this.state._lastValue={...this.state._lastValue,show:t,use_policy:0,dont_set_if_not_agree:0,use_custom_warning_text:0}}.bind(this),this.toggleAllowCookies=function(e){this.state._lastValue.dont_set_if_not_agree=e.target.checked?1:0}.bind(this),this.toggleCookiesPolicy=function(e){if(this.state._lastValue.use_policy=e.target.checked?1:0,!this.fields.link_text.value&&this.state._lastValue.use_policy&&this.fields.link_text.setValue(tr("admin::settings::cookies::base_text_link")),this.update(),this.state._lastValue.use_policy){$(".link_text",this.root)[0].scrollIntoView({behavior:"smooth"})}}.bind(this),this.toggleCookiesText=function(e){if(this.state._lastValue.use_custom_warning_text=e.target.checked?1:0,!this.fields.custom_warning_text.value&&this.state._lastValue.use_custom_warning_text&&this.fields.custom_warning_text.setValue(this.state.baseText),!this.fields.button_text.value&&this.state._lastValue.use_custom_warning_text&&this.fields.button_text.setValue(tr("admin::settings::cookies::base_text_button")),this.update(),this.state._lastValue.use_custom_warning_text){$(".custom_warning_text",this.root)[0].scrollIntoView({behavior:"smooth"})}}.bind(this),this.toggleStyle=function(e){const t=this.state.baseText;this.state._lastValue.style=e.item.card.img,this.fields.custom_warning_text.value&&t!==this.fields.custom_warning_text.value||this.fields.custom_warning_text.setValue(this.state.baseText),!this.fields.button_text.value&&"center_compact"!==this.style&&this.state._lastValue.use_custom_warning_text&&this.fields.button_text.setValue(tr("admin::settings::cookies::base_text_button"))}.bind(this),this.validateAll=function(){return[t.fields.custom_warning_text,t.fields.button_text,t.fields.link_text,t.fields.policy_uri].filter((e=>e.show)).map((e=>e.validate("submit"))).every((e=>e))}.bind(this),this.onSave=async function(){if(!this.validateAll()){const e=this.root.querySelector(".save-button");return $(e).removeClass("shake-animation"),$(e).outerWidth(),$(e).addClass("shake-animation"),this.update(),new Error(tr("main::error:check_fields"))}let e;try{e=await this.$store.dispatch("updateCookiesData",{...this.state.data,...this.state._lastValue})}catch(t){e=t}return e}.bind(this),this.onError=function(e){e.message?toast.error(e.message):console.error(e)}.bind(this),this.onBeforeMount=function(){this.state._lastValue=bt(this.state.data)}.bind(this),this.onMounted=function(){const e=$("body");$(this.root).off("pointerover").on("pointerover",".cookies-style__item",(t=>{const s="center_compact"===t.currentTarget.dataset.key?tr("admin::settings::cookies::short_text_notification"):tr("admin::settings::cookies::long_text_notification"),i=`<div class="cookies-wrap style--${t.currentTarget.dataset.key}">\n                    <div class="cookies-container">\n                      <div class="cookies-content scrollable">\n                          <span>\n                            ${this.fields.custom_warning_text.value&&this.state.cookiesText?this.fields.custom_warning_text.value.replace(/(?:\r\n|\r|\n)/g,"<br />"):s}\n                            <a href="${this.fields.policy_uri.value}" target="_blank" class="cookies-button-more ${this.state.cookiesPolicy?"show":""}">\n                               ${this.fields.link_text.value?this.fields.link_text.value:tr("admin::settings::cookies::base_text_link")}\n                            </a>\n                          </span>\n                      </div>\n                      <div class="cookies-button-container">\n                          <a href="${this.fields.policy_uri.value}" target="_blank" class="cookies-button-more scrollable ${this.state.cookiesPolicy?"show":""}">\n                               ${this.fields.link_text.value?this.fields.link_text.value:tr("admin::settings::cookies::base_text_link")}\n                          </a>\n                          <div class="cookies-button scrollable">\n                              ${this.fields.button_text.value&&this.state.cookiesText&&"center_compact"!==this.state.style?this.fields.button_text.value:tr("admin::settings::cookies::base_text_button")}\n                          </div>\n                      </div>\n                      <div class="cookies-close">\n                        <svg width="12" height="12" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">\n                            <path d="M6 5l5-5 1 1-5 5 5 5-1 1-5-5-5 5-1-1 5-5-5-5 1-1 5 5z"/>\n                        </svg>\n                      </div>\n                    </div>\n                 </div>`;$(".cookies-wrap").remove(),e.append(i),this.cookieTimer=setTimeout((()=>{$(".cookies-wrap").addClass("show")}),150)})),$(this.root).off("pointerout").on("pointerout",".cookies-style__item",(e=>{clearTimeout(this.cookieTimer),$(".cookies-wrap").removeClass("show")}))}.bind(this)})),riot3.tag2("settings-section-api",'<div class="group-list slide-down-animation"> <div class="group-content flexbe-info-box inline-box"> <img class="box-icon" width="36" src="/_s/images/emoji/progger_girl.png"> <div class="box-content"> <div class="flexbe-text"> {tr(\'admin::settings::api::desc\')} </div> <div data-is="raw" content="{tr(\'admin::settings::api::desc_documentation_link\')}"></div> </div> </div> <div class="group-content" data-is="settings-block-api-keys"></div> <div class="group-content" data-is="settings-block-webhooks"></div> </div>',"",'class="settings-section-api pb60 {opts.class}"',(function(e){})),riot3.tag2("settings-block-webhooks",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::api::webhook::title\')}</span> <span data-is="admin-save-text" class="flexbe-desc" status="{saveStatus}" error-text="{errorText}"></span> </div> <table class="flexbe-white-box shadow flexbe-table overflow"> <tbody> <tr each="{hook, index in state.hooks}"> <th>Webhook #{index + 1}</th> <td> <div class="inline-box"> <div data-is="proxy" is="save-input" input-class="{\'in-table\': true, \'transparent\': !hook.changed, \'borderless\': hook.changed}" placeholder="https://" autofocus="{!hook.id}" riot-value="{hook.url}" error="{checkError(hook)}" error-text="{tr(\'main::error::invalid_url\')}" oninput="{setHook}" onchange="{setHook}" show-save="{hook.changed}" on-save="{onSave.bind(tag, hook, index)}" on-done="{onDone.bind(tag, hook)}" on-error="{onError.bind(tag)}"></div> <div class="flexbe-action-buttons"> <div class="action-button" onclick="{removeHook}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#remove"></use> </svg> </div> </div> </div> </td> </tr> <tr if="{!state.hooks.length}"> <td colspan="2"> <div class="inline-box text-shade"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#api"></use> </svg> <span class="flexbe-text">{tr(\'admin::settings::api::webhook::empty_desc\')}</span> </div> </td> </tr> <tr class="tr"> <td colspan="2"> <div class="flexbe-button is-secondary filled small" onclick="{addHook}"> <span class="flexbe-text">{tr(\'admin::settings::api::webhook::add_button\')}</span> </div> </td> </tr> </tbody> </table>',"",'class="settings-block-webhooks {opts.class}"',(function(e){const t=this;function s(e){return(e=String(e||"").trim())&&!/^http?(?:s)?:\/\//.test(e)&&(e=`http://${e.replace(/^[htp]{0,4}:\/{0,2}/,"")}`),e}this.sprite=at("settings","admin"),this.saveStatus="saved",this.state={get hooks(){return t.$state.hooks}},this.checkError=function(e){const t=s(e.url);return e.changed&&!ir(t,!0)}.bind(this),this.setHook=function(e){const t=e.item.index;let i=String(e.target.value||"").trim();"change"===e.type&&(i=s(i)),this.$store.setHook(t,{url:i}),this.update()}.bind(this),this.addHook=function(e){this.$store.addHook({url:""})}.bind(this),this.removeHook=async function(e){const t=e.item.index;try{this.update({saveStatus:"saving"});const e=await this.$store.removeHook(t);this.update({saveStatus:e.id?"success":"saved"})}catch(e){"NetworkError"===e.name?this.update({saveStatus:"error",errorText:e.message}):console.error(e)}}.bind(this),this.onSave=async function(e,t){if(!e||!e.changed)return;let i;this.update();try{i=await this.$store.saveHook(t,{id:e.id,url:s(e.url)})}catch(e){i=e}return i}.bind(this),this.onDone=function(e){e.changed=!1,this.update()}.bind(this),this.onError=function(e){e.message?toast.error(e.message):console.error(e)}.bind(this)})),riot3.tag2("settings-block-api-keys",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::api::key::title\')}</span> </div> <div class="flexbe-white-box shadow flexbe-table overflow"> <div class="tbody"> <div class="tr"> <div class="th">{tr(\'admin::settings::api::key::url_label\')}</div> <div class="td">{state.url}</div> </div> <div class="tr"> <div class="th">{tr(\'admin::settings::api::key::key_label\')}</div> <div class="td"> <div class="inline-box between"> <span class="flexbe-text">{state.key}</span> <div class="flexbe-button is-secondary filled small {loading: state.loading}" onclick="{resetKeyHandle}"> <span class="flexbe-text">{tr(\'admin::settings::api::key::reset_button\')}</span> </div> </div> </div> </div> </div> </div>',"",'class="settings-block-api-keys {opts.class}"',(function(e){const t=this;this.state={loading:!1,get url(){return t.$state.api_url},get key(){return t.$state.api_key}},this.resetKeyHandle=function(){As({props:{title:tr("admin::settings::api::reset::title"),text:tr("admin::settings::api::reset::text"),onConfirm:()=>{this.generateKey()}}})}.bind(this),this.generateKey=async function(){this.state.loading=!0,this.update();try{await this.$store.resetApiKey(),toast.success(tr("admin::settings::api::reset::success_notify"))}catch(e){"NetworkError"===e.name?toast.error(e.message):console.error(e)}this.state.loading=!1,this.update()}.bind(this)})),riot3.tag2("settings-section-code",'<div class="group-list slide-down-animation"> <div class="group-content" data-is="settings-block-code" each="{params in types}" params="{params}" riot-value="{state[params.type]}" onsave="{saveCode}"></div> <div class="flexbe-desc mt20" data-is="raw" content="{tr(\'admin::settings::code::desc\')}"></div> </div>',"",'class="settings-section-code pb60 {opts.class}"',(function(e){const t=this;this.types=[{type:"head",title:`${tr("admin::settings::code::header_label")}`},{type:"body",title:`${tr("admin::settings::code::footer_label")}`}],this.state={get head(){return t.$state.head||""},get body(){return t.$state.body||""}},this.saveCode=function(e,t){return this.$store.saveCode(t.type,e)}.bind(this)})),riot3.tag2("settings-block-code",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{params.title}</span> <div data-is="proxy" is="save-button" hide="{hasErrors}" show-edit="{false}" show-save="{hasChanges && !hasErrors}" on-save="{onSave}" on-done="{onDone}" on-error="{onError}" observer="{observer}"></div> <span class="flexbe-error to-right" if="{hasErrors}"> {(typeof hasErrors == \'string\') ? hasErrors : tr(\'admin::settings::code::wrong_code_error\')} </span> </div> <div data-is="proxy" is="flexbe-monaco-editor" class="large shadow p0" settings="{params.codeSettings}" riot-value="{value}" oninputchange="{setValue}" onlint="{lintCodeEditor}"></div>',"",'class="settings-block-code {opts.class}"',(function(e){this.hasErrors=!1,this.hasChanges=!1,this.params=e.params,this.value=e.riotValue,this.savedValue=this.value,this.observer=At({}),this.lintCodeEditor=function(e){this.update({hasErrors:e.length>0})}.bind(this),this.setValue=function(e){const t=e.value;t!==this.value&&(this.value=t,setTimeout((()=>{this.hasChanges=this.savedValue!==t,this.update()}),300))}.bind(this),this.onSave=function(){if(!this.hasErrors)return this.savedValue=this.value,!e.onsave||e.onsave(this.value,this.params)}.bind(this),this.onDone=function(){this.update({hasChanges:this.savedValue!==this.value}),e.ondone&&e.ondone()}.bind(this),this.onError=function(e){e.message?toast.error(e.message):console.error(e)}.bind(this),this.onBeforeUnmount=function(){this._hotkeysDisposer&&this._hotkeysDisposer()}.bind(this)})),riot3.tag2("settings-section-domain_mailing",'<div data-is="settings-block-integrations-available-list" confirm="{confirm}" confirm-show="{confirmShow}" class="slide-down-animation" if="{!state.hasDomain}"></div> <div data-is="block-integrations-mailing-list" class="slide-down-animation" if="{state.hasDomain}"></div>',"",'class="settings-section-integrations {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.sprite=at("settings.mail","admin"),this.state={get domains(){return t.$getters.domains},get hasDomain(){return!!this.domains?.length&&(this.domains.length>1||this.domains[0].integration)}},this.confirmShow=!this.state.domains?.length,this.confirm=()=>As({props:{icon:`${this.sprite}#domain_confirm_big`,title:tr("admin::integrations::domain_mailing::no_domains_title"),text:tr("admin::integrations::domain_mailing::no_domains_desc"),confirmButtonText:tr("admin::integrations::domain_mailing::goto_domains_button"),onConfirm:()=>{flexbe.routing.go("/admin/settings/domains/")}},clickOut:!0})})),riot3.tag2("settings-section-integrations-connect",'<div data-is="settings-block-integrations-available-list" class="slide-down-animation"></div>',"",'class="settings-section-integrations-connect group-list pb60 {opts.class}"',(function(e){})),riot3.tag2("element-store-app-description",'<div class="tabs-header" if="{opts.forceTabs || opts.tabs.length > 1}"> <div each="{tab in opts.tabs}" class="tab {active: tab.type == opts.active}" onclick="{selectTab}">{tab.title}</div> <yield from="header-addon"></yield> </div> <div class="tabs-content" if="{state.contentHtml}"> <div class="content-block" data-is="raw" content="{state.contentHtml}"></div> </div> <div class="tabs-content" if="{state.contentTag && !opts.store}" data-is="{state.contentTag}" modal="{opts.modal}" meta="{opts.meta}" instance="{opts.instance}" integration="{opts.integration}" observer="{opts.observer}"></div>',"",'class="element-store-app-description content-tabs {opts.class}"',(function(e){this.mixin("inheritYield");const t=()=>{const t=(()=>{const t=e.tabs||[],s=e.active;return t.find((e=>e.type==s))||t[0]})();t&&(this.state.count=e.tabs.length,this.state.contentHtml=t.contentHtml,this.state.contentTag=t.contentTag)};this.state={count:0,contentHtml:null,contentTag:null},this.selectTab=function(t){const s=t.item.tab;"function"==typeof e.select&&e.select(s,t)}.bind(this),this.onBeforeMount=function(){t()}.bind(this),this.onBeforeUpdate=function(){const e=this.state.count;t(),this.state.count!==e&&(this.root.classList.remove("slide-down-animation"),this.root.offsetHeight,this.root.classList.add("slide-down-animation"))}.bind(this)}));const nd=(e,t=!0)=>{"NetworkError"===e.name&&t?toast.error(e.message):"FormError"===e.name&&e.data&&t?toast.error(e.data.title):console.error(e)},rd=(e,t,s)=>{Pd({requestType:s,instance:e,store:t})};riot3.tag2("admin-integrations-field-item",'<div data-is="flexbe-input" if="{state.showInput}" class="{getClassList()}" name="{state.field.name}" type="{state.field.type}" riot-value="{state.field.value}" disabled="{state.field.disabled}" readonly="{state.field.readonly}" autofocus="{state.field.autofocus}" placeholder="{state.field.placeholder}" pattern="{state.field.pattern}" mask="{state.field.mask}" mask-init="{state.field.maskInit}" normalize="{state.field.normalize}" error="{!state.field.valid}" error-level="{state.field.errorLevel}" error-text="{state.field.errorTip ? false : state.field.error}" error-tip="{state.field.errorTip ? state.field.error: false}" oninput="{state.field.onchange}" loading="{state.field.loading}" onchange="{state.field.onchange}"></div> <div data-is="proxy" is="flexbe-monaco-editor" if="{state.field.type === \'monacoEditor\'}" class="{getClassList()}" name="{state.field.name}" type="{state.field.type}" riot-value="{state.field.value}" autofocus="{state.field.autofocus}" disabled="{state.field.disabled}" settings="{state.field.monacoEditorSettings}" placeholder="{state.field.placeholder}" error="{!state.field.valid}" error-text="{state.field.errorTip ? false : state.field.error}" error-tip="{state.field.errorTip ? state.field.error: false}" oninputchange="{state.field.onchange}" loading="{state.field.loading}" onchange="{state.field.onchange}" oninit="{state.field.cmInit}"></div> <div data-is="flexbe-select" if="{state.field.type === \'select\'}" class="{getClassList()}" name="{state.field.name}" riot-value="{state.field.value}" raw-values="{state.field.rawValues}" disabled="{state.field.disabled}" list="{state.field.list}" error="{!state.field.valid}" empty-label="{state.field.emptyLabel}" error-text="{state.field.error}" onchange="{state.field.onchange}"></div> <div data-is="flexbe-group-radio" if="{state.field.type === \'radio\'}" class="{getClassList()}" input-class="{getRadioClassList()}" name="{state.field.name}" riot-value="{state.field.value}" list="{state.field.list}" error="{!state.field.valid}" error-text="{state.field.error}" onchange="{state.field.onchange}"></div> <label data-is="flexbe-input" type="toggle" if="{state.field.type === \'toggle\'}" class="{getClassList()}" name="{state.field.name}" label="{state.field.label}" checked="{+state.field.value}" placeholder="{state.field.placeholder}" mask="{state.field.mask}" error="{!state.field.valid}" error-text="{state.field.errorTip ? false : state.field.error}" error-tip="{state.field.errorTip ? state.field.error: false}" onchange="{state.field.onchange}"> <span class="flexbe-text"> {tag.state.field.title || tag.state.field.label} <q data-is="flexbe-tooltip" content="{tag.state.field.tooltip}" if="{tag.state.field.tooltip}"></q> </span> </label> <div data-is="flexbe-group-checkbox" type="toggle" if="{state.field.type === \'group_checkbox\'}" class="{getClassList()}" input-class="{state.field.inputClass || getClassList()}" riot-value="{state.field.value || state.field.riotvalue}" list="{state.field.list}" onchange="{state.field.onchange}"></div> <div data-is="{state.field.tag}" if="{state.field.type === \'custom\'}" field="{state.field}"></div> <div data-is="flexbe-buttons-line" if="{state.field.type === \'buttons\'}" class="{getClassList()}" name="{state.field.name}" riot-value="{state.field.value}" list="{state.field.list}" onchange="{state.field.onchange}"></div> <button class="flexbe-button small filled is-secondary to-right ml25" if="{state.showButton}" onclick="{state.buttonAction}"> <div class="flexbe-text"> {tr(\'main::button::change\')} </div> </button>',"",'class="admin-integrations-field-item {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.sprite=flexbe.lib.getSprite("settings.integrations","admin"),this.state={get field(){return t.props.field},get showInput(){return!["select","radio","buttons","group_checkbox","toggle","monacoEditor","custom"].includes(this.field.type)},get showButton(){return this.showInput&&(this.field.hasOwnProperty("action")||this.field.showModal)},get buttonAction(){const s=e.instance?.hasOwnProperty("settings")??!1;return(this.field.showModal??!1)&&s?rd.bind(t,e.instance,t.$store,"update"):this.field.action}},this.getClassList=function(){return this.state.field.class??" "}.bind(this),this.getRadioClassList=function(){return this.state.field.class??""}.bind(this),this.onBeforeMount=function(){this.state.field.valid||this.state.field.validate()}.bind(this)})),riot3.tag2("admin-integration-connect-button",'<div class="flexbe-button filled is-primary {loading: opts.loading}" onclick="{opts.connect}"> <span class="flexbe-text"> {opts.title || tr(\'main::button::enable\')} </span> </div> <yield></yield>',"",'class="{opts.class}"',(function(e){this.mixin("inheritYield")}));const od={...Ul,allowedRegex:(e,t)=>{if(!e.allowedRegex)return void console.warn('FLEXBE: You need to specify the regular expression for "allowedCharacters" validator.');if("input"===t)return;var s;if(!e.allowedRegex.test(e.value))throw null!=(s=e.regexError)?s:tr("admin::integrations::validation::not_allowed_characters")}},ld=e=>{const t=e.type,s=e.list||[],i=e.listItemTitle||"title",a=e.listItemValue||"value",n=e.listItemDesc;return["radio","select","custom"].includes(t)&&"object"==typeof s[0]?(({list:e,title:t,desc:s,value:i})=>{const a=[];return e.forEach((e=>{const n={value:e.value||e[i],title:e.title||e[t],...s&&{desc:e[s]||s},...e};Array.isArray(t)&&(n.title=e.title||t.map((t=>e[t]||t)).join("")),Array.isArray(s)&&(n.desc=e.desc||s.map((t=>e[t]||t)).join("")),a.push(n)})),a})({list:s,title:i,desc:n,value:a}):s.length?s:[]},dd=e=>{const t=e.name;return e.list&&(e.source_list=e.list,e.list=ld(e)),e.validators&&(e.validators=(e=>{var t;return(null!=(t=e.validators)?t:[]).map((e=>"string"==typeof e?od[e]:e)).filter((e=>"function"==typeof e))})(e)),e.mask&&(e.mask=(e=>Pl[e.mask])(e)),e.normalize&&(e.normalize=(e=>!!e.hasOwnProperty("normalize")&&("string"==typeof e.normalize?Rl[e.normalize]:e.normalize))(e)),new Hl(t,e)},cd=(e=[],t="external")=>{const s=e.filter((e=>!e.validate(t)));return!!s.length&&{code:"error_in_fields",message:tr("main::error:check_fields"),fields:s}},pd=(e=[],t={})=>{const s=e.filter((e=>Object.keys(t).includes(e.name)));s.length&&s.forEach((e=>{e.error=t[e.name].title}))};riot3.tag2("admin-integrations-connect-form",'<div class="flexbe-field-group" if="{field.show}" each="{field in fields}" key="{field.name}"> <div class="flexbe-title" if="{field.label}"> {field.label} <q data-is="flexbe-tooltip" if="{field.labelTooltip}" content="{field.labelTooltip}"></q> </div> <div data-is="raw" if="{field.content}" content="{field.content}" class="{field.contentClass}"></div> <div data-is="admin-integrations-field-item" field="{field}"></div> </div> <div class="flexbe-buttons-line inline" if="{state.connectButtonComponent}" data-is="{state.connectButtonComponent}" instance="{opts.instance}" integration="{state.integration}" modal="{opts.modal}" connect="{connect}" check-errors="{checkErrors}" loading="{state.loading}"> <div class="flexbe-button is-secondary noshrink" disabled="{tag.state.loading}" onclick="{tag.closeModal}"> <span class="flexbe-text"> {tr(\'main::button::cancel\')} </span> </div> </div>',"",'class="admin-integrations-connect-form {opts.class}"',(function(e){this.mixin("initMobx");const t=this,s="admin-integration-connect-button";this.extendFromProps={fields:{name:"fields",formatter:(e=[])=>e.filter((e=>e.show??!0)).map(((e,s)=>{const i=vt({onInit:function(){const e=this.value,t=this.initialValue;null!=t&&null==e&&(this.value=t)},get value(){return xt(t.state.stage,this.name)},set value(e){const s={...t.state.stage};_t(s,this.name,e),t.state.stage=s},get initialError(){return t.state.errors[this.name]},onSetError:function({error:e}){t.state.errors={...t.state.errors,[this.name]:e}}},e);return dd(i)}))}},this.state={error:!1,integration:e.integration,get instance(){return t.props.instance},get integrationName(){return this.instance.integration},get connectButtonComponent(){return this.integration.connect.button??s},get stage(){const e=this.integrationName;return t.$state.stage?.[e]||{}},set stage(e){const s=this.integrationName;t.$store.commit("setStagePart",s,e)},get loading(){return this.stage.loading||!1},set loading(e){this.stage={...this.stage,loading:e}},get errors(){return this.stage.errors||{}},set errors(e){this.stage={...this.stage,errors:e}}},this.checkErrors=function(e){const t=cd(this.fields,e);return this.state.error=!!t&&t.message,t}.bind(this),this.connect=async function(){if(this.checkErrors("connect"),this.state.error){this.update();const e=this.root.querySelector(`[data-is=${this.state.connectButtonComponent}]`);return e&&(e.classList.remove("shake-animation"),e.offsetWidth,e.classList.add("shake-animation")),!1}this.state.loading=!0;try{const{integrationName:t,instance:s,stage:i}=this.state;let a;const n=e.modal.options.requestType??"connect";"connect"===n?(await this.$store.dispatch("connect",t,i.settings),a=tr("admin::integrations::common::connect_success_message")):"update"===n?(await this.$store.dispatch("updateInstance",s.instance_id,{settings:i.settings},!0),a=tr("admin::integrations::common::update_success_message")):"reconnect"===n&&(await this.$store.dispatch("setEnabled",s.instance_id,{state:!0}),await this.$store.dispatch("updateInstance",s.instance_id,{settings:i.settings},!0),a=tr("admin::integrations::common::reconnect_success_message")),this.state.loading=!1,this.closeModal(),toast.success(a),flexbe.routing.go(`/admin/settings/integration/${s.category}/`)}catch(e){this.state.loading=!1,"NetworkError"===e.name?toast.error(e.message):"FormError"===e.name&&e.data?(pd(this.fields,e.data.violations),toast.error(e.data.title)):console.error(e)}}.bind(this),this.closeModal=function(){e.modal&&e.modal.close()}.bind(this),e.observer&&e.observer.on("connect",(e=>{const{loading:t,connectButtonComponent:i}=this.state,a=e.target.classList.contains("monaco-mouse-cursor-text"),n=navigator.platform.match("Mac")?e.metaKey:e.ctrlKey;if((!a||n)&&!t){if(i!==s){const e=$(this.root).find(".flexbe-button.is-primary");e&&e.trigger("click")}else this.connect()}})),this.on("before-mount",(()=>{this.$store.on("checkErrors",this.checkErrors),this.$store.on("connect",this.connect)})),this.on("unmount",(()=>{this.$store.off("checkErrors",this.checkErrors),this.$store.off("connect",this.connect)}))})),riot3.tag2("admin-integrations-settings-form-placeholder",'<div class="flexbe-admin-form"> <div class="form-item"> <div class="form-item-label"> <div class="flexbe-placeholder rounded"></div> </div> <div class="form-item-content"> <div class="flexbe-placeholder rounded"></div> </div> </div> </div>',"",'class="admin-integrations-settings-form-placeholder {opts.class}"',(function(e){})),riot3.tag2("admin-integrations-settings-form",'<div data-is="admin-integrations-settings-form-placeholder" if="{loading}"></div> <div class="flexbe-admin-form" if="{!loading}" tabindex="0"> <div class="form-item scrollable-content integrations-fields-item" each="{field, index in fields}" key="{field.name}" if="{field.show}"> <div if="{field.label}" class="form-item-label"> <div class="flexbe-title"> {field.label} <q data-is="flexbe-tooltip" class="flexbe-tooltip" if="{field.labelTooltip}" content="{field.labelTooltip}"></q> </div> </div> <div data-is="admin-integrations-field-item" class="form-item-content" field="{field}" instance="{state.instance}"> </div> </div> </div> <yield></yield>',"",'class="admin-integrations-settings-form w100 {opts.class}"',(function(e){this.mixin("inheritYield"),this.mixin("initMobx");const t=this;this.extendFromProps={fields:{name:"fields",formatter:(e=[])=>e.map((e=>{const s=vt({get value(){const e=this.initialValue,s=xt(t.state.settings,this.name);return null!=e&&null==s?e:s},set value(e){t.$store.commit("setField",{integrationId:t.state.integrationId,name:this.name,value:e},!1)},get initialError(){return t.state.errors[this.name]},onSetError:function({error:e,errorLevel:s}){t.$store.commit("setError",{integrationId:t.state.integrationId,name:this.name,errorLevel:s,error:e})}},e);return dd(s)}))},loading:{default:!1}},this.state={get instance(){return t.props.instance},get integration(){return t.props.integration},get integrationId(){return this.instance.instance_id},get settings(){return this.instance.settings||{}},get errors(){return this.instance.errors||{}}},this.onBeforeMount=function(){this.$store.on("checkErrors",s),this.$store.on("setErrors",i)}.bind(this),this.onUnmounted=function(){this.$store.off("checkErrors",s),this.$store.off("setErrors",i)}.bind(this);const s=({integrationId:e,validateLevel:t})=>{this.state.integrationId===e&&cd(this.fields,t)},i=({integrationId:e,violations:t})=>{this.state.integrationId===e&&pd(this.fields,t)}})),riot3.tag2("element-integrations-google-analytics-connect-tab",'<div data-is="admin-integrations-connect-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}" observer="{opts.observer}" modal="{opts.modal}"> </div>',"","",(function(e){this.mixin("initMobx");this.state={instance:e.instance,integration:e.integration,fields:[{name:"settings.counter_id",label:tr("admin::integrations::counters::google_analytics::enter_counter_number_label"),placeholder:"G-XXXXXXXXXX",validators:["required","allowedRegex","minLength","maxLength",e=>{if(e.value.includes("UA-"))throw{error:tr(" 1  2023   Universal Analytics   .     Google  4."),errorLevel:"warning"}},e=>{if(!e.value.includes("UA-")&&!e.value.includes("G-"))throw{error:tr("admin::integrations::counters::google_analytic::error_counter")}}],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,maxLength:16,errorTip:!0,autofocus:!0}]}})),riot3.tag2("settings-block-counters-google-analytics",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}"> </div>',"",'class="{opts.class}"',(function(e){const t=this;this.mixin("initMobx");this.state={get instance(){return t.props.instance},get integration(){return t.props.integration},get integrationId(){return this.instance.instance_id},fields:[{name:"counter_id",placeholder:"123456789",class:"transparent in-table",label:tr("admin::integrations::counters::counter_number_label"),validators:["required","allowedRegex","minLength","maxLength",e=>{if(e.value.includes("UA-"))throw{error:tr("admin::integrations::counters::google_analytic::error"),errorLevel:"warning"}},e=>{if(!e.value.includes("UA-")&&!e.value.includes("G-"))throw{error:tr("admin::integrations::counters::google_analytic::error_counter")}}],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,maxLength:16,errorTip:!0}]},this.onMounted=function(){this.$store.trigger("checkErrors",{integrationId:this.state.integrationId,violations:"checkError"})}.bind(this)})),riot3.tag2("element-integrations-google-analytics-instruction-tab","<raw content=\"{tr('admin::integrations::counters::google_analytics::instruction')}\"></raw> <raw class=\"flexbe-desc mt15\" content=\"{tr('admin::integrations::counters::after_sending_the_lead_lead_is_sent', {'event': 'ga(\\'send\\', \\'event\\', \\'order_done\\', \\'send\\');'}, 'admin')}\"></raw>","",'class="integration-instruction {opts.class}"',(function(e){}));riot3.tag2("element-integrations-gtm-connect-tab",'<div data-is="admin-integrations-connect-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}" observer="{opts.observer}" modal="{opts.modal}"> </div>',"","",(function(e){this.mixin("initMobx"),this.state={instance:e.instance,integration:e.integration,fields:[{name:"settings.counter_id",label:tr("admin::integrations::counters::gtm::enter_counter_number_label"),placeholder:"GTM-XXXX",validators:["required","allowedRegex","minLength","maxLength"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,maxLength:15,autofocus:!0,normalize:e=>e.toUpperCase()}]}})),riot3.tag2("settings-block-counters-gtm",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}"> </div>',"",'class="{opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={get instance(){return t.props.instance},get integration(){return t.props.integration},fields:[{name:"counter_id",placeholder:"123456789",class:"transparent in-table",label:tr("admin::integrations::counters::counter_number_label"),validators:["required","allowedRegex","minLength","maxLength"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,maxLength:15,normalize:e=>e.toUpperCase()}]}}));const ud=async e=>{var t;const s=`/admin/api/integrations/yandex_metrika/counters/?token=${e}`;return null==(t=(await ii(s)).data)?void 0:t.counters},md=async(e,t)=>{var s;const i={token:e,name:t};return null==(s=(await ii("/admin/api/integrations/yandex_metrika/counters/new/",{data:i})).data)?void 0:s.id},hd={webvisor:1,webvisor_version:2,auto_goals:1};riot3.tag2("element-integrations-yandex-metrika-connect-button",'<div data-is="admin-integration-connect-button" connect="{connect}" loading="{loading}"> <yield></yield> </div>',"",'class="{opts.class}"',(function(e){const t=this;window.setYAToken=function(e){e&&t.getCounters(e)},this.mixin("initMobx"),this.mixin("inheritYield"),this.loading=e.loading,this.state={instance:e.instance,integration:e.integration,get integrationName(){return this.instance.integration},get stage(){return t.$state.stage?.[this.integrationName]||{}},get isMainConnect(){return this.stage?.mainConnect??!0},get settings(){return(this.isMainConnect?this.stage.main_settings:this.stage.additional_settings)??{}},get token(){return this.settings.token??!1},get counters(){return this.stage.counters??!1},get countersLoaded(){return Array.isArray(this.counters)},get counterId(){return this.settings.counter_id},get options(){return this.settings.options??{}},get name(){return this.stage.new_counter_name??""}},this.connect=async function(){let t;const{counterId:s,isMainConnect:i,counters:a,token:n}=this.state,r=i&&!a,o=i&&!a&&n,l=i&&a&&"new"===s,d=!l&&!o&&!r;this.update({loading:!0});try{if(r)t=window.open("/admin/integrations/yandex_metrika/oauth/","YAoAuth","width=800, height=800");else{if(e.checkErrors())t=null,this.root.classList.remove("shake-animation"),this.root.offsetWidth,this.root.classList.add("shake-animation");else if(o)t=await this.getCounters(n);else if(l){const s=await this.createCounter();s&&(this.updateCounterID(s),t=await e.connect())}else d&&(this.updateCounterID(s),t=await e.connect())}}catch(e){nd(e)}return this.update({loading:!1}),t}.bind(this),this.updateCounterID=function(e){const{settings:t,integrationName:s}=this.state;t.counter_id=e,this.$store.commit("setStagePart",s,{settings:t})}.bind(this),this.getCounters=async function(e){const{integrationName:t}=this.state;try{const s=await ud(e),i={token:e};Array.isArray(s)&&(this.$store.commit("setStagePart",t,{main_settings:i,counters:s}),this.opts.modal.updatePosition())}catch(e){nd(e)}}.bind(this),this.createCounter=async function(){const{name:e,integrationName:t,counters:s,token:i}=this.state;try{const a=await md(i,e);if(a){const n={token:i};s.push({id:a,name:e}),this.$store.commit("setStagePart",t,{main_settings:n,counters:s})}return a}catch(e){nd(e)}}.bind(this)})),riot3.tag2("element-integrations-yandex-metrika-connect-tab",'<div class="content-block mb20" if="{state.isMainConnect}"> <span data-is="raw" class="flexbe-text" content="{tr(\'admin::integrations::counters::yandex_metrika::main_way_access_info\')}"> </span> <span data-is="raw" content="{tr(\'admin::integrations::counters::yandex_metrika::main_way_suggestion\')}" onclick="{toggleHandler}"> </span> </div> <div class="flexbe-text mb20" if="{!state.isMainConnect}"> <span data-is="raw" class="flexbe-text" content="{tr(\'admin::integrations::counters::yandex_metrika::additional_way_access_info\')}"> </span> <span data-is="raw" content="{tr(\'admin::integrations::counters::yandex_metrika::additional_way_suggestion\')}" onclick="{toggleHandler}"> </span> </div> <div data-is="admin-integrations-connect-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}" observer="{opts.observer}" modal="{opts.modal}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={instance:e.instance,integration:e.integration,get integrationName(){return this.instance.integration},get stage(){return t.$state.stage?.[this.integrationName]??{}},get isMainConnect(){return this.stage.mainConnect??!0},get settings(){return(this.isMainConnect?this.stage.main_settings:this.stage.additional_settings)??{}},get counters(){return this.stage.counters??!1},get countersLoaded(){return Array.isArray(this.counters)},get counterId(){return this.settings.counter_id},get metaCurrentCounter(){return this.countersLoaded?this.counters.find((e=>e.id==this.counterId)):null},get metaCountersList(){const e=[{title:tr("admin::integrations::common::add_new"),value:"new"}];if(this.counters){const t=[...this.counters].map((e=>({title:e.name||e.domain,desc:e.id&&`(${e.id})`,value:e.id})));e.unshift(...t)}return e},get listInitialValue(){return this.counters?.[0]?.id||"new"},get showNewCounter(){return!!this.counters&&(!this.counters.length||"new"==this.counterId)},get fields(){return this.isMainConnect?this.mainFields:this.additionalFields},get additionalFields(){return[{name:"additional_settings.counter_id",label:tr("admin::integrations::counters::yandex_metrika::enter_counter_number_label"),placeholder:"123456789",validators:["required","allowedRegex","minLength","maxLength"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,maxLength:15,initialValue:"",autofocus:!0},{name:"additional_settings.options.webvisor_version",type:"buttons",label:tr("admin::integrations::counters::yandex_metrika::webvisor_toggle"),class:"is-group",validators:["required"],initialValue:String(hd.webvisor_version),list:[{title:tr("admin::integrations::counters::yandex_metrika::webvisor_disabled"),value:"0"},{title:tr("admin::integrations::counters::yandex_metrika::webvisor_version_1"),value:"1"},{title:tr("admin::integrations::counters::yandex_metrika::webvisor_version_2"),value:"2"}],afterSet:({newValue:e})=>{const s={options:{webvisor:+e?1:0}};t.$store.commit("setStagePart",this.integrationName,{additional_settings:s},!0)}}]},get mainFields(){return[{show:this.counters,name:"main_settings.counter_id",type:"select",label:tr("admin::integrations::counters::yandex_metrika::select_counter_label"),validators:["required"],initialValue:this.listInitialValue,list:this.metaCountersList},{show:this.showNewCounter,name:"new_counter_name",label:tr("admin::integrations::counters::yandex_metrika::enter_counter_name_label"),placeholder:"example.com",validators:["required"],autofocus:!0},{show:this.countersLoaded,name:"main_settings.options",type:"group_checkbox",label:tr("admin::integrations::common::additional_label"),initialValue:hd,list:[{value:"webvisor",title:tr("admin::integrations::counters::yandex_metrika::webvisor_toggle"),tooltip:tr("admin::integrations::counters::yandex_metrika::webvisor_tip")},{value:"auto_goals",title:tr("admin::integrations::counters::yandex_metrika::auto_goals_toggle"),tooltip:tr("admin::integrations::counters::yandex_metrika::auto_goals_tip")}]}]}},this.watch={"state.metaCurrentCounter":e=>{const{integrationName:s,isMainConnect:i,stage:a}=this.state,n=i&&e?.hasOwnProperty("webvisor"),r=a.main_settings?.options?.hasOwnProperty("auto_goals"),o=!r&&{auto_goals:hd.auto_goals},l={options:{webvisor:e?.webvisor??hd.webvisor,webvisor_version:e?.webvisor_version??hd.webvisor_version,...o}};n&&t.$store.commit("setStagePart",s,{main_settings:l})}},this.toggleHandler=function(e){const{isMainConnect:s,integrationName:i}=this.state,a=!s;e.target.classList.contains("style-link")&&t.$store.commit("setStagePart",i,{mainConnect:a})}.bind(this),this.extendSettings=function(){const{integrationName:e}=this.state,s={connect_type:"additional",options:{webvisor:hd.webvisor}};t.$store.commit("setStagePart",e,{additional_settings:s,main_settings:{connect_type:"main"}})}.bind(this),this.on("before-mount",this.extendSettings)})),riot3.tag2("settings-block-counters-yandex-metrika",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" loading="{!state.countersLoaded}" instance="{state.instance}" integration="{state.integration}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={counters:[],countersLoaded:!1,get integration(){return t.props.integration},get instance(){return t.props.instance},get integrationId(){return this.instance.instance_id},get settings(){return this.instance.settings??{}},get isMainConnect(){return"main"===this.settings.connect_type},get fields(){return this.isMainConnect?this.mainFields:this.additionalFields},get additionalFields(){return[{name:"counter_id",placeholder:"123456789",class:"transparent in-table",label:tr("admin::integrations::counters::counter_number_label"),validators:["required","allowedRegex","minLength","maxLength"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,maxLength:15},{name:"options.webvisor_version",type:"buttons",label:tr("admin::integrations::counters::yandex_metrika::webvisor_toggle"),class:"is-group",validators:["required"],list:[{title:tr("admin::integrations::counters::yandex_metrika::webvisor_disabled"),value:"0"},{title:tr("admin::integrations::counters::yandex_metrika::webvisor_version_1"),value:"1"},{title:tr("admin::integrations::counters::yandex_metrika::webvisor_version_2"),value:"2"}],afterSet:({newValue:e})=>{t.$store.commit("setField",{integrationId:this.integrationId,name:"options.webvisor",value:+e?1:0})}}]},get mainFields(){return[{name:"counter_id",type:"select",label:tr("admin::integrations::counters::yandex_metrika::select_counter_label"),class:"transparent in-table",emptyLabel:tr("admin::integrations::counters::yandex_metrika::empty_select_label"),list:this.counters,afterSet:({newValue:e})=>t.updateWebvisor(e)},{name:"options",type:"group_checkbox",class:"mt10 mb5",inputClass:"large mb5",label:tr("admin::integrations::common::additional_label"),list:[{value:"webvisor",title:tr("admin::integrations::counters::yandex_metrika::webvisor_toggle"),tooltip:tr("admin::integrations::counters::yandex_metrika::webvisor_tip")},{value:"auto_goals",title:tr("admin::integrations::counters::yandex_metrika::auto_goals_toggle"),tooltip:tr("admin::integrations::counters::yandex_metrika::auto_goals_tip")}]}]}},this.updateWebvisor=function(e,t=!1){const{counters:s,settings:i,integrationId:a}=this.state,n=s.find((t=>t.id==e));if(!n)return;const r={webvisor:n.webvisor,webvisor_version:n.webvisor_version};if(t){!Object.keys(r).every((e=>r[e]==i.options[e]))&&(i.options={...i.options,...r},this.$store.dispatch("updateInstance",a,{settings:i}))}else this.$store.commit("setField",{integrationId:a,name:"options",value:r},!0)}.bind(this),this.loadList=async function(){const{settings:e,instance:t,isMainConnect:s}=this.state,{token:i,counter_id:a}=e;if(s){try{const e=[...await ud(i)].map((e=>({title:e.name||e.domain,desc:`(${e.id})`,value:e.id})));this.state.counters=e,this.updateWebvisor(a,!0)}catch(e){this.$store.dispatch("addInstanceError",t.instance_id,{explanation:e.data?.title??e?.message,disable_ui:!0,action:!0,level:"danger"}),nd(e)}this.state.countersLoaded=!0,this.update()}else this.state.countersLoaded=!0}.bind(this),this.on("before-mount",this.loadList)}));const gd={connect:{component:"element-integrations-yandex-metrika-connect-tab",button:"element-integrations-yandex-metrika-connect-button"},settings:{component:"settings-block-counters-yandex-metrika",actions:{action:{title:tr("admin::integrations::counters::yandex_metrika::go_to_counter"),icon:"to-link-bold",handler:(e,t)=>{const s=t.item.instance.settings.counter_id;window.open(`https://metrika.yandex.ru/dashboard?id=${s}`,"_blank")}}}}};riot3.tag2("element-integrations-another-counter-connect-tab",'<div data-is="admin-integrations-connect-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}" observer="{opts.observer}" modal="{opts.modal}"> </div>',"","",(function(e){this.mixin("initMobx"),this.state={instance:e.instance,integration:e.integration,fields:[{name:"settings.title",label:tr("admin::integrations::counters::another_counter::title_label"),placeholder:tr("admin::integrations::counters::another_counter::title_placeholder"),validators:["required"],autofocus:!0},{name:"settings.html",type:"monacoEditor",label:tr("admin::integrations::counters::another_counter::code_label"),validators:["required"],minLength:5}]}})),riot3.tag2("settings-block-counters-another-counter",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}"> </div>',"",'class="{opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={get instance(){return t.props.instance},get integration(){return t.props.integration},fields:[{name:"html",type:"monacoEditor",class:"large",validators:["required"]}]}}));riot3.tag2("element-integrations-default-widget-connect-tab",'<div data-is="admin-integrations-connect-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}" observer="{opts.observer}" modal="{opts.modal}"> </div>',"","",(function(e){this.mixin("initMobx"),this.state={instance:e.instance,integration:e.integration,fields:[{name:"settings.html",type:"monacoEditor",autofocus:50,label:tr("admin::integrations::widgets::code_label"),validators:["required"]}]}})),riot3.tag2("settings-block-widgets-default",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}"> </div>',"",'class="{opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={get instance(){return t.props.instance},get integration(){return t.props.integration},fields:[{name:"html",class:"large",type:"monacoEditor",validators:["required"]}]}}));riot3.tag2("element-integrations-custom-widget-connect-tab",'<div data-is="admin-integrations-connect-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}" observer="{opts.observer}" modal="{opts.modal}"> </div>',"",'class="{opts.class}"',(function(e){this.mixin("initMobx"),this.state={instance:e.instance,integration:e.integration,fields:[{name:"settings.title",label:tr("admin::integrations::widgets::title_label"),placeholder:tr("admin::integrations::widgets::title_placeholder"),validators:["required"],initialValue:"",autofocus:!0},{name:"settings.position",type:"buttons",label:tr("admin::integrations::widgets::position_label"),class:"is-group",validators:["required"],initialValue:"body",list:[{title:tr("admin::integrations::widgets::position::head_option"),value:"head"},{title:tr("admin::integrations::widgets::position::body_option"),value:"body"}]},{name:"settings.html",type:"monacoEditor",label:tr("admin::integrations::widgets::code_label"),validators:["required"],initialValue:""}]}})),riot3.tag2("settings-block-widgets-custom-widget",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}"></div>',"",'class="{opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.state={get instance(){return t.props.instance},get integration(){return t.props.integration},fields:[{name:"position",type:"buttons",class:"is-group",label:tr("admin::integrations::widgets::position_label"),initialValue:"body",list:[{title:tr("admin::integrations::widgets::position::head_option"),value:"head"},{title:tr("admin::integrations::widgets::position::body_option"),value:"body"}]},{name:"html",type:"monacoEditor",validators:["required"]}]}}));riot3.tag2("admin-integrations-connect-steps",'<div data-is="{state.current.content.tag}" if="{showContent(\'tag\', \'top\')}"></div> <div data-is="raw" class="{state.current.content.class}" content="{state.current.content.text}" if="{showContent(\'text\', \'top\')}"></div> <div data-is="admin-integrations-connect-form" class="{opts.connectFormClass}" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}" modal="{opts.modal}"></div> <div data-is="{state.current.content.tag}" if="{showContent(\'tag\', \'bottom\')}"></div> <div data-is="raw" class="{state.current.content.class}" content="{state.current.content.text}" if="{showContent(\'text\', \'bottom\')}"></div> <div class="flexbe-buttons-line inline" ref="buttons"> <div class="flexbe-button filled is-primary {loading: state.loading}" onclick="{stepForward}"> <span class="flexbe-text"> {state.stepForwardButton} </span> </div> <div class="flexbe-button is-secondary noshrink" onclick="{stepBack}" disabled="{state.loading}"> <span class="flexbe-text"> {state.stepBackButton} </span> </div> </div>',"",'class="admin-integrations-connect-steps {opts.class}"',(function(e){const t=this;let s;const i=tr("main::button::enable"),a=tr("main::button::apply"),n=tr("main::button::next"),r=tr("main::button::back"),o=tr("main::button::cancel");this.mixin("initMobx"),this.state={loading:!1,integration:e.integration,instance:e.instance,name:e.instance.integration,settingsMode:e.instance.hasOwnProperty("settings"),get stepForwardButton(){const{steps:e,step:t}=this;return e[t]?.stepForwardButton?e[t].stepForwardButton:this.isLastStep?this.settingsMode?a:i:n},get stepBackButton(){return this.isFirstStep?o:r},get maxStepIndex(){return this.steps.length-1},get isFirstStep(){return 0===this.stepInt},get isLastStep(){return this.stepInt===this.maxStepIndex},get stepInt(){return this.stage.step??0},get stage(){return t.$state.stage?.[this.name]??{}},get settings(){return this.stage.settings??{}},get waitForConnect(){return this.stage.loading??!0},get steps(){return t.props.steps??[]},get current(){return this.steps[this.stepInt]},get resolve(){return s=this.current?.action?.resolve,s?this.stage[s]??!1:null},get fields(){return this.current?.fields??[]}},this.watch={"state.resolve":e=>{const{current:i,name:a,stepInt:n,isLastStep:r}=this.state;Boolean(e)&&(r&&i?.autoconnect?this.connectLastAction():this.takeStep(n+1),s&&t.$store.commit("setStagePart",a,{[s]:!1}),i.afterStep?.())}},this.stepForward=async function(){const{stepInt:e,maxStepIndex:t,current:s,resolve:i}=this.state,a=e>=t?t:e+1,n=a===e;if(!this.checkErrors()){s.beforeStep?.();try{await this.handleAction()&&!1!==i?(n||this.takeStep(a),s.afterStep?.()):(this.state.loading=!1,this.update())}catch{this.state.loading=!1,this.update()}}}.bind(this),this.stepBack=function(){const{stepInt:e}=this.state;if(0===e)this.closeModal();else{const t=e>0?e-1:0;this.takeStep(t)}}.bind(this),this.takeStep=function(e){const{name:t}=this.state;this.$store.commit("setStagePart",t,{step:e})}.bind(this),this.showContent=function(e,t){const{current:s}=this.state;return!!s&&(s.content&&s.content[e]&&(s.content.position??"top")===t)}.bind(this),this.checkErrors=function(){const{stage:e,fields:t}=this.state;let s=!1;this.$store.trigger("checkErrors","connect");const i=e.errors&&Object.entries(e.errors).filter((([e,t])=>t)).map((([e,t])=>e));if(s=i&&t.filter((e=>(e.show??!0)&&i.includes(e.name))).length,s){const e=$(this.refs.buttons).find(".flexbe-button.is-primary");e.removeClass("shake-animation"),e[0].offsetWidth,e.addClass("shake-animation")}return s}.bind(this),this.handleAction=async function(){const{current:e,loading:t,isLastStep:s}=this.state;if(!e)return;let i,a;const n=e.action?.handler??e.action,r=e.autoconnect,o=this.connectLastAction;try{const e=s&&!t,l=!n&&e;if(!n&&!e)a=!0;else{if(i=l?o:n,this.state.loading=!0,this.update(),r&&i!==o){await i()&&(a=await o())}else a=await i();this.state.loading=!1,this.update()}}catch(e){nd(e),a=!1}return a}.bind(this),this.connectLastAction=async function(){this.$store.trigger("connect");const e=e=>new Promise((t=>setTimeout(t,e)));for(;this.state.waitForConnect;)await e(50);return!0}.bind(this),this.closeModal=function(){e.modal&&e.modal.close()}.bind(this),e.observer&&e.observer.on("connect",(e=>{this.state.loading||this.stepForward()}))}));const vd=async e=>{const t={key:e};return(await ii("/admin/api/integrations/unisender/lists/",{data:t})).data},fd=async(e,t)=>{var s;const i={key:e,title:t};return null==(s=(await ii("/admin/api/integrations/unisender/lists/create/",{data:i})).data)?void 0:s.id};riot3.tag2("element-integrations-unisender-connect-tab",'<div data-is="admin-integrations-connect-steps" instance="{state.instance}" integration="{state.integration}" steps="{state.steps}" modal="{opts.modal}" observer="{opts.observer}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={instance:e.instance,integration:e.integration,get integrationName(){return this.instance.integration},get stage(){return t.$state.stage?.[this.integrationName]??{}},get settings(){return this.stage.settings??{}},get listId(){return this.settings.list_id},get mailingList(){return this.stage.mailingList??!1},get metaMailingList(){const e=[{title:tr("admin::integrations::common::add_new"),value:"new"}];return this.mailingList&&e.unshift(...this.mailingList),e},get showNewListName(){return!!this.mailingList&&(!this.mailingList.length||"new"==this.listId)},get initialValueMap(){return{key:this.instance.settings?.key,list_id:this.mailingList?.[0]?.id||"new",confirmation:this.instance.settings?.confirmation??0}},get lastStepAction(){return!("new"!==this.listId)&&t.createMailingList},get steps(){return[{fields:[{name:"settings.key",label:tr("admin::integrations::mailing::key_label"),placeholder:"",validators:["required","minLength","allowedRegex"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,autofocus:!0,initialValue:this.initialValueMap.key}],action:t.getMailingList},{fields:[{name:"settings.list_id",type:"select",label:tr("admin::integrations::mailing::select_list_label"),validators:["required"],list:this.metaMailingList,listItemTitle:"name",listItemValue:"id",emptyLabel:tr("admin::integrations::mailing::empty_select_label"),initialValue:this.initialValueMap.list_id},{name:"new_list_name",label:tr("admin::integrations::mailing::unisender::enter_list_name_label"),validators:["required"],autofocus:!0,show:this.showNewListName}],action:this.lastStepAction,autoconnect:!0}]}},this.getMailingList=async function(){const{integrationName:e,settings:t}=this.state,s=t.key;try{const t=await vd(s);return Array.isArray(t)&&this.$store.commit("setStagePart",e,{mailingList:t}),t}catch(e){nd(e)}}.bind(this),this.createMailingList=async function(){const{integrationName:e,mailingList:t,settings:s,stage:i}=this.state,a=s.key,n=i?.new_list_name;try{const i=await fd(a,n);return i&&(s.list_id=i,t.push({id:i,name:n}),this.$store.commit("setStagePart",e,{mailingList:t,settings:s})),i}catch(e){nd(e)}}.bind(this),this.on("mount",(()=>{this.$store.commit("setStagePart",this.state.integrationName,{settings:{confirmation:1}})}))})),riot3.tag2("settings-block-mailing-unisender",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" loading="{!state.listLoaded}" instance="{state.instance}" integration="{state.integration}" disabled="{false}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={list:[],listLoaded:!1,serviceError:!1,get integration(){return t.props.integration},get instance(){return t.props.instance},get settings(){return t.props.instance.settings},get fields(){return[{name:"key",class:"in-table",validators:["required","allowedRegex","minLength"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,label:tr("admin::integrations::mailing::key_label"),showModal:!0,disabled:!0},{name:"list_id",type:"select",class:"in-table",list:this.list,listItemTitle:"name",listItemValue:"id",label:tr("admin::integrations::mailing::list_label"),emptyLabel:tr("admin::integrations::mailing::empty_select_label"),show:!this.serviceError}]}},this.loadList=async function(){const{instance:e,settings:t}=this.state,{key:s}=t;try{const e=await vd(s);this.state.list=e}catch(t){this.state.serviceError=!0,this.$store.dispatch("addInstanceError",e.instance_id,{explanation:t.data?.title??t?.message,disable_ui:!0,action:!0,level:"danger"}),nd(t,!0)}this.state.listLoaded=!0,this.update()}.bind(this),this.watch={"state.settings":[this.loadList,{deep:!0}]},this.on("before-mount",this.loadList)})),riot3.tag2("element-integrations-unisender-instruction-tab",'<div data-is="raw" content="{tr(\'admin::integrations::mailing::unisender::instruction\', { href: tr(\'admin::integrations::mailing::unisender::url\') })}" onclick="{showExample}"> </div>',"",'class="integration-instruction {opts.class}"',(function(e){this.showExample=function(e){const t=e.target,s=t.closest("li"),{screenshot:i}=s.dataset;if(t.classList.contains("style-link")&&i){const e=`/_s/images/admin/settings/mailing/services/unisender/instruction/${flexbe.vars.user.lang}/`;ks({src:`${e}unisender_${i}.png`,class:"integration-instruction-modal"})}}.bind(this)}));const xd=async(e,t)=>{let s={key:e,url:t};t||(s={key:e});return(await ii("/admin/api/integrations/getresponse/lists/",{data:s})).data},bd=async(e,t,s)=>{var i;let a={key:e,title:t,url:s};s||(a={key:e,title:t});return null==(i=(await ii("/admin/api/integrations/getresponse/lists/create/",{data:a})).data)?void 0:i.id};riot3.tag2("element-integrations-getresponse-connect-tab",'<div data-is="admin-integrations-connect-steps" instance="{state.instance}" integration="{state.integration}" steps="{state.steps}" modal="{opts.modal}" observer="{opts.observer}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={instance:e.instance,integration:e.integration,get integrationName(){return this.instance.integration},get stage(){return t.$state.stage?.[this.integrationName]??{}},get settings(){return this.stage.settings??{}},get listId(){return this.settings.list_id},get mailingList(){return this.stage.mailingList??!1},get metaMailingList(){const e=[{title:tr("admin::integrations::common::add_new"),value:"new"}];return this.mailingList&&e.unshift(...this.mailingList),e},get showUrl(){return 1*this.settings?.getresponse_360??0},get showNewListName(){return!!this.mailingList&&(!this.mailingList.length||"new"==this.listId)},get initialValueMap(){return{key:this.instance.settings?.key,getresponse_360:this.instance.settings?1*this.instance.settings?.getresponse_360:0,url:this.instance.settings?.url,list_id:this.mailingList?.[0]?.id||"new"}},get lastStepAction(){return!("new"!==this.listId)&&t.createMailingList},get steps(){return[{fields:[{name:"settings.key",label:tr("admin::integrations::mailing::key_label"),placeholder:"",validators:["required","minLength","allowedRegex"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,autofocus:!0,initialValue:this.initialValueMap.key},{name:"settings.getresponse_360",type:"toggle",title:tr("admin::integrations::mailing::getresponse::360_toggle"),initialValue:this.initialValueMap.getresponse_360},{name:"settings.url",label:"GetResponse360 API URL",placeholder:"https://api.getresponse360.com/flexbe",normalize:"normalizeUrl",validators:["required","isLink"],autofocus:!0,initialValue:this.initialValueMap.url,show:this.showUrl}],action:t.getMailingList},{fields:[{name:"settings.list_id",type:"select",label:tr("admin::integrations::mailing::select_list_label"),validators:["required"],list:this.metaMailingList,listItemTitle:"name",listItemValue:"id",emptyLabel:tr("admin::integrations::mailing::empty_select_label"),initialValue:this.initialValueMap.list_id},{name:"new_list_name",label:tr("admin::integrations::mailing::getresponse::enter_list_name_label"),labelTooltip:tr("admin::integrations::validation::latin_allowed_characters"),validators:["required","allowedRegex"],allowedRegex:/^[a-z0-9\-\_]+$/i,autofocus:!0,show:this.showNewListName}],beforeStep:()=>{if(!(1*this.settings.getresponse_360)){const e=this.settings;delete e.url,t.$store.commit("setStagePart",this.integrationName,{settings:e})}},action:this.lastStepAction,autoconnect:!0}]}},this.getMailingList=async function(){const{integrationName:e,settings:t}=this.state,s=t.key,i=!!(1*t.getresponse_360)&&t.url;try{const t=await xd(s,i);return Array.isArray(t)&&this.$store.commit("setStagePart",e,{mailingList:t}),t}catch(e){nd(e)}}.bind(this),this.createMailingList=async function(){const{integrationName:e,mailingList:t,settings:s,stage:i}=this.state,a=s.key,n=i?.new_list_name,r=!!(1*s.getresponse_360)&&s.url;try{const i=await bd(a,n,r);return i&&(s.list_id=i,t.push({id:i,name:n}),this.$store.commit("setStagePart",e,{mailingList:t,settings:s})),i}catch(e){nd(e)}}.bind(this)})),riot3.tag2("settings-block-mailing-getresponse",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" loading="{!state.listLoaded}" instance="{state.instance}" integration="{state.integration}" disabled="{false}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={list:[],listLoaded:!1,serviceError:!1,get integration(){return t.props.integration},get instance(){return t.props.instance},get settings(){return this.instance.settings},get showUrl(){return Number(this.settings.getresponse_360)??!1},get fields(){return[{name:"key",class:"in-table",validators:["required","allowedRegex","minLength"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,label:tr("admin::integrations::mailing::key_label"),showModal:!0,disabled:!0},{name:"list_id",type:"select",class:"in-table",list:this.list,listItemTitle:"name",listItemValue:"id",label:tr("admin::integrations::mailing::list_label"),emptyLabel:tr("admin::integrations::mailing::empty_select_label"),show:!this.serviceError},{name:"url",class:"in-table",label:"GetResponse360 API URL",placeholder:"https://api.getresponse360.com/flexbe",normalize:"normalizeUrl",validators:["required","isLink"],show:this.showUrl,disabled:!0}]}},this.loadList=async function(){const{instance:e,settings:t}=this.state,{key:s,url:i}=t;try{const e=await xd(s,i);this.state.list=e}catch(t){this.state.serviceError=!0,this.$store.dispatch("addInstanceError",e.instance_id,{explanation:t.data?.title??t?.message,disable_ui:!0,action:!0,level:"danger"}),nd(t,!0)}this.state.listLoaded=!0,this.update()}.bind(this),this.watch={"state.settings":[this.loadList,{deep:!0}]},this.on("before-mount",this.loadList)})),riot3.tag2("element-integrations-getresponse-instruction-tab",'<div data-is="raw" content="{tr(\'admin::integrations::mailing::getresponse::instruction\', { href: tr(\'admin::integrations::mailing::getresponse::url\') })}" onclick="{showExample}"> </div>',"",'class="integration-instruction {opts.class}"',(function(e){this.showExample=function(e){const t=e.target,s=t.closest("li"),{screenshot:i}=s.dataset;if(t.classList.contains("style-link")&&i){const e=`/_s/images/admin/settings/mailing/services/getresponse/instruction/${flexbe.vars.user.lang}/`;ks({src:`${e}getresponse_${i}.png`,class:"integration-instruction-modal"})}}.bind(this)}));const yd=async e=>{const t=`/admin/api/project/${flexbe.vars.group.id}/integrations/sendpulse/list/`,s={settings:e};return await ii(t,{data:s})},_d=async(e,t)=>{const s=`/admin/api/project/${flexbe.vars.group.id}/integrations/sendpulse/create/`,i={settings:e,book_name:t},a=await ii(s,{data:i});return null==a?void 0:a.id};riot3.tag2("element-integrations-sendpulse-connect-tab",'<div data-is="admin-integrations-connect-steps" instance="{state.instance}" integration="{state.integration}" steps="{state.steps}" modal="{opts.modal}" observer="{opts.observer}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={instance:e.instance,integration:e.integration,get integrationName(){return this.instance.integration},get stage(){return t.$state.stage?.[this.integrationName]??{}},get settings(){return this.stage.settings??{}},get bookId(){return this.settings.book_id},get bookList(){const e=[{title:tr("admin::integrations::mailing::sendpulse::add_new"),id:"new"}];return this.stage.bookList&&e.unshift(...this.stage.bookList),e},get senderList(){return this.stage.senderList},get showNewListName(){return"new"===this.bookId},get showMethodDouble(){return"double-opt-in"===this.settings.method},get showTemplateFields(){return this.showMethodDouble&&0==+this.settings.template_default},get initialValueMap(){return{client_id:this.instance.settings?.client_id,client_secret:this.instance.settings?.client_secret,book_id:this.bookList?.[0]?.id||"new",sender_mail:this.senderList?.[0]?.email}},get lastStepAction(){const e="new"===this.bookId;return 0===this.settings.template_default&&(this.settings.template_id=this.state?.template_id),!!e&&t.createAddressBook},get steps(){return[{fields:[{name:"settings.client_id",label:tr("admin::integrations::mailing::sendpulse::client_id"),placeholder:"1e98c57f23d744f70c6eb6263e639a41",validators:["required","minLength","allowedRegex"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,autofocus:!0,initialValue:this.initialValueMap.client_id},{name:"settings.client_secret",label:tr("admin::integrations::mailing::sendpulse::client_secret"),placeholder:"0ec3eabddc3527fd4316a538e76ba4b4",validators:["required","minLength","allowedRegex"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,initialValue:this.initialValueMap.client_secret}],action:t.getDataList},{fields:[{name:"settings.book_id",type:"select",label:tr("admin::integrations::mailing::sendpulse::book_list_label"),validators:["required"],list:this.bookList,listItemTitle:"name",listItemValue:"id",emptyLabel:tr("admin::integrations::mailing::empty_select_label"),initialValue:this.initialValueMap.book_id},{name:"book_name",label:tr("admin::integrations::mailing::sendpulse::enter_list_name_label"),validators:["required"],autofocus:!0,show:this.showNewListName},{name:"settings.method",type:"buttons",class:"is-group",label:tr("admin::integrations::mailing::sendpulse::method_label"),labelTooltip:tr("admin::integrations::mailing::sendpulse::method_tips"),list:[{title:tr("admin::integrations::mailing::sendpulse::single_opt_in"),value:"single-opt-in"},{title:tr("admin::integrations::mailing::sendpulse::double_opt_in"),value:"double-opt-in"}]},{name:"settings.sender_mail",type:"select",label:tr("admin::integrations::mailing::sendpulse::sender_list_label"),emptyLabel:tr("admin::integrations::mailing::empty_select_label"),validators:["required"],list:this.senderList,listItemTitle:"email",listItemValue:"email",autofocus:!0,show:this.showMethodDouble,initialValue:this.initialValueMap.sender_mail},{name:"settings.template_default",type:"toggle",label:tr("admin::integrations::mailing::sendpulse::template_label"),title:tr("admin::integrations::mailing::sendpulse::template_title"),show:this.showMethodDouble},{name:"template_id",label:tr("admin::integrations::mailing::sendpulse::template_id_label"),validators:["required","allowedRegex","minLength"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,placeholder:"ae2819ce-1a91-419b-981a-6f55f4be94e2",labelTooltip:tr("admin::integrations::mailing::sendpulse::template_id_tips"),show:this.showTemplateFields}],action:this.lastStepAction,autoconnect:!0}]}},this.getDataList=async function(){const{integrationName:e,settings:t}=this.state;t.token&&delete t.token;try{const{books:s,senders:i,token:a}=await yd(t),n=s,r=i;return this.state.settings.token=a,this.state.settings.book_id=n[0]?.id??"new",this.state.settings.sender_mail=r[0]?.email,Array.isArray(n)&&this.$store.commit("setStagePart",e,{bookList:n,senderList:r}),!0}catch(e){nd(e)}}.bind(this),this.createAddressBook=async function(){const{integrationName:e,bookList:t,settings:s,stage:i}=this.state,a=i?.book_name;try{const i=await _d(s,a);if(i){const n=a;s.book_id=i,t.push({id:i,title:n}),this.$store.commit("setStagePart",e,{bookList:t,settings:s})}return a}catch(e){nd(e)}}.bind(this),this.on("mount",(()=>{this.$store.commit("setStagePart",this.state.integrationName,{settings:{method:"single-opt-in",template_default:1}})}))})),riot3.tag2("settings-block-mailing-sendpulse",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" loading="{!state.listLoaded}" instance="{state.instance}" integration="{state.integration}" disabled="{false}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={booksList:[],senderList:[],listLoaded:!1,serviceError:!1,get integration(){return t.props.integration},get instance(){return t.props.instance},get settings(){return t.props.instance.settings},get showMethodDouble(){return"double-opt-in"===this.settings.method},get showTemplateFields(){const e=this.showMethodDouble,t=this.settings.template_default;return e&&0==+t},get fields(){return[{name:"client_id",class:"in-table",label:tr("admin::integrations::mailing::sendpulse::client_id"),validators:["required","minLength","allowedRegex"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,showModal:!0,disabled:!0},{name:"client_secret",class:"in-table",label:tr("admin::integrations::mailing::sendpulse::client_secret"),validators:["required","minLength","allowedRegex"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,disabled:!0},{name:"book_id",type:"select",class:"in-table",label:tr("admin::integrations::mailing::sendpulse::book_list_label"),validators:["required"],list:this.booksList,listItemTitle:"name",listItemValue:"id",emptyLabel:tr("admin::integrations::mailing::empty_select_label")},{name:"method",type:"buttons",class:"in-table is-group",label:tr("admin::integrations::mailing::sendpulse::method_label"),labelTooltip:tr("admin::integrations::mailing::sendpulse::method_tips"),list:[{title:tr("admin::integrations::mailing::sendpulse::single_opt_in"),value:"single-opt-in"},{title:tr("admin::integrations::mailing::sendpulse::double_opt_in"),value:"double-opt-in"}]},{name:"sender_mail",type:"select",class:"in-table",label:tr("admin::integrations::mailing::sendpulse::sender_list_label"),emptyLabel:tr("admin::integrations::mailing::empty_select_label"),validators:["required"],list:this.senderList,listItemTitle:"email",listItemValue:"email",autofocus:!0,show:this.showMethodDouble},{name:"template_default",type:"toggle",class:"in-table",label:tr("admin::integrations::mailing::sendpulse::template_label"),title:tr("admin::integrations::mailing::sendpulse::template_title"),show:this.showMethodDouble},{name:"template_id",class:"in-table",label:tr("admin::integrations::mailing::sendpulse::template_id_label"),labelTooltip:tr("admin::integrations::mailing::sendpulse::template_id_tips"),placeholder:"ae2819ce-1a91-419b-981a-6f55f4be94e2",validators:["required","allowedRegex","minLength"],allowedRegex:/^[a-z0-9\-]+$/i,minLength:5,show:this.showTemplateFields}]}},this.loadList=async function(){const{settings:e}=this.state;try{const{books:t,senders:s}=await yd(e);this.state.booksList=t,this.state.senderList=s}catch(e){this.state.serviceError=!0,nd(e,!0)}this.state.listLoaded=!0,this.update()}.bind(this),this.on("before-mount",this.loadList)})),riot3.tag2("element-integrations-sendpulse-instruction-tab",'<div data-is="raw" content="{tr(\'admin::integrations::mailing::sendpulse::instruction\',          { href: tr(\'admin::integrations::mailing::sendpulse::url\') } )}" onclick="{showExample}"> </div>',"",'class="integration-instruction {opts.class}"',(function(e){this.showExample=function(e){const t=e.target,s=t.closest("li"),{screenshot:i}=s.dataset;if(t.classList.contains("style-link")&&i){const e=`/_s/images/admin/settings/mailing/services/sendpulse/instruction/${flexbe.vars.user.lang}/`;ks({src:`${e}sendpulse_${i}.png`,class:"integration-instruction-modal"})}}.bind(this)}));const Td={assign_automatically:{title:tr("admin::integrations::crm::assign_automatically"),value:0},utm:"contacts",unsorted:0};riot3.tag2("element-integrations-amocrm-connect-tab",'<div data-is="admin-integrations-connect-steps" instance="{state.instance}" integration="{state.integration}" steps="{state.steps}" modal="{opts.modal}" observer="{opts.observer}"></div>',"","",(function(e){const t=this;function s(){const{settings:e}=t.state,s=`/admin/integrations/amocrm/oauth/?domain=${e.account_url}`;window.open(s,"AmoCrm","width=800, height=800")}this.mixin("inheritYield"),this.state={instance:e.instance,integration:e.integration,get integrationName(){return this.instance.integration},get settings(){return this.stage?.settings??{}},get stage(){return t.$state.stage?.[this.instance.integration]},get userList(){return this.stage?.users},get dealCategoryList(){return this.stage?.categories},get metaUserList(){const e=[Td.assign_automatically];if(this.userList){const t=[...this.userList].map((e=>({title:`${e.name} ${e.last_name}`,desc:e.email&&e.name!==e.email&&`(${e.email})`,value:e.id})));e.push(...t)}return e},get metaDealCategoryList(){const e=[Td.assign_automatically];return this.dealCategoryList&&e.push(...this.dealCategoryList),e},get steps(){return[{content:{text:tr("admin::integrations::crm::annotation_next"),class:"flexbe-text mb15"},action:{handler:s,resolve:"after_auth"}},{fields:[{name:"settings.assignee",list:this.metaUserList,type:"select",label:tr("admin::integrations::crm::assignment_label"),labelTooltip:tr("admin::integrations::crm::amocrm::assignment_tip")},{name:"settings.deal_category",list:this.metaDealCategoryList,type:"select",listItemTitle:"name",listItemValue:"id",label:tr("admin::integrations::crm::deal_category_label")},{name:"settings.utm_tags",type:"buttons",class:"is-group",label:tr("admin::integrations::crm::utm_label"),list:[{title:tr("admin::integrations::crm::utm::no_option"),value:"no_option"},{title:tr("admin::integrations::crm::utm::deals_option"),value:"deals"},{title:tr("admin::integrations::crm::utm::contacts_option"),value:"contacts"}]}],stepForwardButton:this.instanceSettings?tr("main::button::apply"):tr("admin::integrations::crm::install_button")}]}},window.setTokens=function(s,{tokens:i,users:a,categories:n}){if(i){const{integrationName:r}=t.state,{access_token:o,refresh_token:l,expires:d}=i,c=Td.assign_automatically.value,p=Td.assign_automatically.value;t.$store.commit("setStagePart",r,{settings:{account_url:s,access_token:o,refresh_token:l,expires:d,assignee:p,deal_category:c},after_auth:!0,users:a,categories:n}),e.modal&&e.modal.updatePosition()}}}));const wd=async(e,t=null)=>ii("/admin/settings/integration/crm/amocrm/check/"+(t?t+"/":""),{data:{settings:e}}).then((e=>e.data));riot3.tag2("settings-block-crm-amocrm",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" loading="{!state.listLoaded}" instance="{state.instance}" integration="{state.integration}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={metaUsers:[],metaCategories:[],listLoaded:!1,serviceError:!1,get instance(){return t.props.instance},get integration(){return t.props.integration},get integrationId(){return this.instance.instance_id},get settings(){return t.props.instance.settings},get fields(){return[{name:"account_url",label:tr("admin::integrations::crm::amocrm::domain_label"),class:"in-table",placeholder:tr("admin::integrations::crm::amocrm::domain_placeholder"),showModal:!0,disabled:!0},{name:"assignee",list:this.metaUsers,type:"select",class:"transparent in-table",label:tr("admin::integrations::crm::assignment_label")},{name:"deal_category",list:this.metaCategories,type:"select",listItemTitle:"name",listItemValue:"id",class:"transparent in-table",label:tr("admin::integrations::crm::deal_category_label")},{name:"utm_tags",type:"buttons",class:"is-group",label:tr("admin::integrations::crm::utm_label"),list:[{title:tr("admin::integrations::crm::utm::no_option"),value:"no_option"},{title:tr("admin::integrations::crm::utm::deals_option"),value:"deals"},{title:tr("admin::integrations::crm::utm::contacts_option"),value:"contacts"}]}]}},this.loadLists=async function(){const{settings:e,instance:t}=this.state;try{const{users:t,categories:s,token:i}=await wd(e,this.state.instance?.instance_id);if(t){const e=[...t].map((e=>({title:`${e.name} ${e.last_name}`,desc:e.email&&e.name!==e.email&&`(${e.email})`,value:e.id})));this.state.metaUsers=[Td.assign_automatically,...e]}i&&(this.state.settings.access_token=i.access_token,this.state.settings.refresh_token=i.refresh_token),this.state.metaCategories=[Td.assign_automatically,...s]}catch(e){this.state.serviceError=!0,this.$store.dispatch("addInstanceError",t.instance_id,{explanation:e.data?.title??e?.message,disable_ui:!0,action:!0,level:"danger"}),nd(e,!0)}this.state.listLoaded=!0,this.update()}.bind(this),this.watch={"state.settings":[this.loadLists,{deep:!0}]},this.on("before-mount",this.loadLists)})),riot3.tag2("element-integrations-amocrm-instruction-tab","<raw content=\"{tr('admin::integrations::crm::amocrm::instruction',          { href: tr('admin::integrations::crm::amocrm::url') } )}\" onclick=\"{showExample}\"></raw>","",'class="integration-instruction {opts.class}" ref="bla"',(function(e){this.showExample=function(e){const t=e.target,s=t.closest("li"),{screenshot:i}=s.dataset;if(t.classList.contains("style-link")&&i){const e=`/_s/images/admin/settings/crm/services/amocrm/instruction/${flexbe.vars.user.lang}/`;ks({src:`${e}amocrm_${i}.png`,class:"integration-instruction-modal"})}}.bind(this)}));const kd=async e=>{const t=`/admin/settings/integration/crm/bitrix24/check/?domain=${e}`;return(await ai(t)).result},Ad=async e=>{const t=`/admin/settings/integration/crm/bitrix24/${e}/getAdditionalInfo/`;return(await ai(t)).data},Ed={assign_automatically:{title:tr("admin::integrations::crm::assign_automatically"),value:0},funnel_general:{title:tr("admin::integrations::crm::bitrix24::funnel_general"),value:0}};riot3.tag2("element-integrations-bitrix24-connect-tab",'<div data-is="admin-integrations-connect-steps" instance="{state.instance}" integration="{state.integration}" steps="{state.steps}" modal="{opts.modal}" observer="{opts.observer}"></div>',"","",(function(e){const t=this;async function s(){const{domain:e,integrationName:s}=t.state;try{const i=await kd(e);return i||t.$store.commit("setStagePart",s,{errors:{"settings.account_url":tr("admin::integrations::crm::bitrix24::url_wrong_error")}}),i}catch(e){nd(e)}}function i(){const{domain:e}=t.state,s=`/admin/integrations/bitrix24/oauth/?domain=${e}`;window.open(s,"B24oAuth","width=800, height=800")}this.mixin("inheritYield"),this.state={instance:e.instance,integration:e.integration,get integrationName(){return this.instance.integration},get stage(){return t.$state.stage?.[this.integrationName]},get instanceSettings(){return this.instance?.settings},get settings(){return this.stage?.settings??{}},get domain(){return this.settings.account_url},get installURL(){let e="https://www.bitrix24.ru/apps/?app=flexbe.leads";return this.domain?.includes("bitrix")&&(e=`https://${this.domain}/marketplace/detail/flexbe.leads/`),e},get userList(){return this.stage?.user_list},get dealCategoryList(){return this.stage?.deal_category_list},get metaUsers(){const e=[Ed.assign_automatically];if(this.userList){const t=[...this.userList].map((e=>({title:e.name?`${e.name} `:"",desc:e.last_name?`${e.last_name}`:"",value:e.id})));e.push(...t)}return e},get metaCategories(){const e=[Ed.funnel_general];return this.dealCategoryList&&e.push(...this.dealCategoryList),e},get steps(){return[{fields:[{name:"settings.account_url",label:tr("admin::integrations::crm::bitrix24::url_label"),placeholder:tr("admin::integrations::crm::bitrix24::url_placeholder"),validators:["required","isDomain"],normalize:"cleanDomain",autofocus:!0,initialValue:this.instanceSettings?.account_url}],action:s},{content:{text:tr("admin::integrations::crm::bitrix24::connect_info",{url:this.installURL}),class:"flexbe-text mb15"},fields:[{name:"is_installed",type:"toggle",validators:["required"],errorTip:!0,title:tr("admin::integrations::crm::bitrix24::install_label")}],action:{handler:i,resolve:"after_auth"}},{fields:[{name:"settings.assignee",list:this.metaUsers,type:"select",label:tr("admin::integrations::crm::assignment_label"),labelTooltip:tr("admin::integrations::crm::bitrix24::assignment_tip")},{name:"settings.deal_category",list:this.metaCategories,type:"select",listItemTitle:"name",listItemValue:"id",label:tr("admin::integrations::crm::deal_category_label")},{name:"settings.utm_tags",type:"toggle",label:tr("admin::integrations::common::additional_label"),title:tr("admin::integrations::crm::utm_label"),initialValue:1}],stepForwardButton:this.instanceSettings?tr("main::button::apply"):tr("admin::integrations::crm::install_button")}]}},window.setB24Tokens=function({tokens:s,user_list:i,deal_category_list:a}){if(s){const{integrationName:n}=t.state,{access_token:r,refresh_token:o,expires:l}=s,d=Ed.assign_automatically.value,c=Ed.assign_automatically.value;t.$store.commit("setStagePart",n,{settings:{access_token:r,refresh_token:o,expires:l,assignee:c,deal_category:d},user_list:i,deal_category_list:a,after_auth:!0}),e.modal&&e.modal.updatePosition()}}})),riot3.tag2("settings-block-crm-bitrix24",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" loading="{!state.listLoaded}" instance="{state.instance}" integration="{state.integration}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={metaUsers:[],metaCategories:[],listLoaded:!1,serviceError:!1,get instance(){return t.props.instance},get integration(){return t.props.integration},get integrationId(){return this.instance.instance_id},get settings(){return t.props.instance.settings},get fields(){return[{name:"account_url",class:"in-table",label:tr("admin::integrations::crm::bitrix24::url_label"),placeholder:tr("admin::integrations::crm::bitrix24::url_placeholder"),showModal:!0,disabled:!0},{name:"assignee",type:"select",class:"transparent in-table",list:this.metaUsers,label:tr("admin::integrations::crm::assignment_label")},{name:"deal_category",type:"select",class:"transparent in-table",list:this.metaCategories,listItemTitle:"name",listItemValue:"id",label:tr("admin::integrations::crm::deal_category_label")},{name:"utm_tags",type:"toggle",label:tr("admin::integrations::common::additional_label"),title:tr("admin::integrations::crm::utm_label"),class:"large"}]}},this.loadLists=async function(){const{integrationId:e}=this.state;try{const{users:t,categories:s}=await Ad(e);if(t){const e=[...t].map((e=>({title:e.name?`${e.name} `:"",desc:e.last_name?`${e.last_name}`:"",value:e.id})));this.state.metaUsers=[Ed.assign_automatically,...e]}this.state.metaCategories=[Ed.funnel_general,...s]}catch(t){this.state.serviceError=!0,this.$store.commit("setInstanceErrors",{integrationId:e,errors:[{explanation:t.data?.title??t?.message,disable_ui:!0,action:!0,level:"danger"}]}),nd(t,!0)}this.state.listLoaded=!0,this.update()}.bind(this),this.watch={"state.settings":[this.loadLists,{deep:!0}]},this.on("before-mount",this.loadLists)})),riot3.tag2("element-integrations-bitrix24-instruction-tab",'<raw content="{tr(\'admin::integrations::crm::bitrix24::instruction\')}" onclick="{showExample}"></raw>',"",'class="integration-instruction {opts.class}" ref="bla"',(function(e){this.showExample=function(e){const t=e.target,s=t.closest("li");if(s){const{screenshot:e}=s.dataset;if(t.classList.contains("style-link")&&e){const t=`/_s/images/admin/settings/crm/services/bitrix24/instruction/${flexbe.vars.user.lang}/`;ks({src:`${t}step_${e}.png`,class:"integration-instruction-modal"})}}}.bind(this)}));const Id={add_folder:{id:"create",name:tr("admin::pages::folder::add::title")},main_folder:{id:"main",name:tr("admin::integrations::crm::google_sheets::main_folder")}},Cd=async({access:e,refresh:t,expiresIn:s,created:i,tokenType:a,scope:n,type:r,utm:o})=>{const l=`/admin/api/google/drive/folder/?settings[token][access_token]=${e}&settings[token][refresh_token]=${t}&settings[token][expires_in]=${s}&settings[token][scope]=${n}&settings[token][token_type]=${a}&settings[token][created]=${i}&settings[type]=${r}&settings[utm]=${o}&settings[folder][name]&settings[folder][id]`;return await ai(l)},Sd=async({access:e,refresh:t,expiresIn:s,created:i,tokenType:a,scope:n,type:r,utm:o,folder:l})=>{const d=`/admin/api/google/drive/folder/?settings[token][access_token]=${e}&settings[token][refresh_token]=${t}&settings[token][expires_in]=${s}&settings[token][scope]=${n}&settings[token][token_type]=${a}&settings[token][created]=${i}&settings[type]=${r}&settings[utm]=${o}&settings[folder][name]=${l}&settings[folder][id]`;return await ii(d,{data:{folder:l}})};riot3.tag2("element-integrations-google-sheets-connect-tab",'<div data-is="admin-integrations-connect-steps" instance="{state.instance}" integration="{state.integration}" steps="{state.steps}" modal="{opts.modal}" observer="{opts.observer}"></div>',"","",(function(e){this.mixin("initMobx");const t=this;function s(){window.open("/admin/integrations/google_sheets/oauth/","GoogleSheets","width=800, height=800")}this.state={instance:e.instance,integration:e.integration,get integrationName(){return this.instance.integration},get settings(){return this.stage?.settings??{}},get stage(){return t.$state.stage?.[this.integrationName]},get metaFolderList(){return[...this.stage?.folders||[],Id.add_folder].map((e=>({title:e.name,value:e.id})))},get steps(){return[{content:{text:tr("admin::integrations::crm::google_sheets::connect"),class:"flexbe-text mb15"},action:{handler:s,resolve:"after_auth"}},{fields:[{class:"google-sheets-select-custom",name:"settings.folder",type:"select",list:this.metaFolderList,label:tr("admin::integrations::crm::google_sheets::steps_connect::select_folder"),get value(){return t.state.stage.settings.folder?.id||Id.main_folder.id},set value(e){if("create"===e)return void t.uiCreateFolderModal();const s={...t.state.stage},i=t.state.stage.folders.find((t=>t.id===e));_t(s,this.name,i),t.$store.commit("setStagePart",t.state.integrationName,s)}},{name:"settings.type",type:"radio",label:tr("admin::integrations::crm::google_sheets::steps_connect::request"),labelTooltip:tr("admin::integrations::crm::google_sheets::steps_connect::tip"),list:[{title:tr("admin::integrations::crm::google_sheets::steps_connect::one_table"),value:"united"},{title:tr("admin::integrations::crm::google_sheets::steps_connect::separate_tables"),value:"different"}],get value(){return t.state.settings.type},set value(e){t.$store.commit("setStagePart",t.state.integrationName,{settings:{type:e}})}},{name:"settings.utm",type:"toggle",label:tr("admin::integrations::common::additional_label"),title:tr("admin::integrations::crm::utm_label")}],stepForwardButton:this.instanceSettings?tr("main::button::apply"):tr("admin::integrations::crm::install_button")}]}},window.setGoogleSheetsTokens=async s=>{if(s){const{integrationName:i}=t.state,a="united",n="0";let r=await Cd({access:s.access_token,refresh:s.refresh_token,expiresIn:s.expires_in,created:s.created,tokenType:s.token_type,scope:s.scope,type:a,utm:n});r=[Id.main_folder,...r],t.$store.commit("setStagePart",i,{settings:{type:a,utm:n,folder:r[0],token:{...s}},folders:r,after_auth:!0}),e.modal&&e.modal.updatePosition()}},window.googleSheetsTokensError=()=>{e.modal.shake(),toast.error(tr("admin::integrations::crm::google_sheets::toast_error"))},this.uiCreateFolderModal=function(){Zs.create({width:450,title:tr("admin::pages::folder::add::title"),overlay:!0,shadow:!0,handle:!1,clickOut:!1,fromModal:e.modal,riotTag:"modal-google-sheets",props:{settings:t.state.settings,onAddedFolder:e=>{const s={...t.state.stage};_t(s,"settings.folder",e),_t(s,"folders",[...s.folders,e]),t.$store.commit("setStagePart",t.state.integrationName,s)}},onClose:()=>{t.update()}})}.bind(this)})),riot3.tag2("settings-block-crm-google-sheets",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}" loading="{state.listLoaded}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={listLoaded:!0,serviceError:!1,get instance(){return t.props.instance},get integrationId(){return this.instance.instance_id},get integrationName(){return this.instance.integration},get settings(){return this.instance.settings},get folder(){return this.settings.folder},get foldersList(){return[...t.state.folders||[],Id.add_folder].map((e=>({title:e.name,value:e.id})))},get type(){return this.settings.type},get tokens(){return this.settings.token},get fields(){return[{class:"google-sheets-select-custom flexbe-select transparent in-table",name:"folder",type:"select",list:this.foldersList,label:tr("admin::integrations::crm::google_sheets::folder"),get value(){return t.state.folder?.id||Id.main_folder.id},set value(e){if("create"===e)return void t.uiCreateFolderModal();const s=t.state.folders.find((t=>t.id===e));t.$store.commit("setField",{integrationId:t.state.integrationId,name:"folder",value:s})}},{name:"type",type:"radio",label:tr("admin::integrations::crm::google_sheets::steps_connect::request"),labelTooltip:tr("admin::integrations::crm::google_sheets::steps_connect::tip"),list:[{title:tr("admin::integrations::crm::google_sheets::steps_connect::one_table"),value:"united"},{title:tr("admin::integrations::crm::google_sheets::steps_connect::separate_tables"),value:"different"}]},{name:"utm",type:"toggle",label:tr("admin::integrations::common::additional_label"),title:tr("admin::integrations::crm::utm_label"),class:"large"}]}},this.uiCreateFolderModal=function(){Zs.create({width:450,title:tr("admin::pages::folder::add::title"),overlay:!0,shadow:!0,handle:!1,riotTag:"modal-google-sheets",props:{settings:t.state.settings,onAddedFolder:e=>{t.state.folders=[...t.state.folders,e],t.$store.commit("setField",{integrationId:t.state.integrationId,name:"folder",value:{name:e.name,id:e.id}})}},onClose:()=>{t.update()}})}.bind(this),this.onMounted=async function(){try{this.state.listLoaded=!0,t.state.folders=await Cd({access:this.state.tokens.access_token,refresh:this.state.tokens.refresh_token,expiresIn:this.state.tokens.expires_in,created:this.state.tokens.created,tokenType:this.state.tokens.token_type,scope:this.state.tokens.scope,utm:this.state.settings.utm,type:this.state.type}),t.state.folders=[Id.main_folder,...t.state.folders],this.state.listLoaded=!1}catch(e){this.state.listLoaded=!1,this.state.serviceError=!0,nd(e,!0)}this.update()}.bind(this)})),riot3.tag2("modal-google-sheets",'<div class="row"> <div class="col col-12"> <div class="flexbe-title">{tr(\'admin::pages::folder::add::name_label\')}</div> <div data-is="flexbe-input" oninput="{inputValue}" autofocus="{true}" required="{true}" error="{state.error}" error-tip="{state.errorTip}" onkeydown="{keydownHandle}"></div> </div> <div class="col col-12 mt20"> <div class="flexbe-buttons-line"> <div class="flexbe-button filled is-primary {state.loading ? \'loading\' : \'\'} {\'shake-animation\': state.error}" onclick="{addFolder}"> <span class="flexbe-text"> {tr(\'main::button::add\')} </span> </div> <div class="flexbe-button filled default" onclick="{modalClose}"> <span class="flexbe-text"> {tr(\'main::button::cancel\')} </span> </div> </div> </div> </div>',"",'class="flexbe-modal-content"',(function(e){this.mixin("initMobx"),this.state={loading:!1,error:!1,errorTip:tr("main::required_field_missing_error"),get tokens(){return e.settings.token},get type(){return e.settings.type},get utm(){return e.settings.utm}},this.inputValue=function(e){this.state.folderName=e.target.value,this.state.error=!1}.bind(this),this.addFolder=async function(){if(this.state.folderName)try{this.state.loading=!0;const t=await Sd({access:this.state.tokens.access_token,refresh:this.state.tokens.refresh_token,expiresIn:this.state.tokens.expires_in,created:this.state.tokens.created,tokenType:this.state.tokens.token_type,scope:this.state.tokens.scope,type:this.state.type,utm:this.state.utm,folder:this.state.folderName});e.onAddedFolder?.(t),this.state.loading=!1,this.state.error=!1,this.modalClose()}catch{this.state.loading=!1,this.state.error=!0,this.update()}else this.state.error=!0,this.update()}.bind(this),this.modalClose=function(){e.modal?.close()}.bind(this),this.keydownHandle=function(e){13===e.which&&this.addFolder()}.bind(this)}));riot3.tag2("element-integrations-pipedrive-instruction-tab","<raw content=\"{tr('admin::integrations::crm::pipedrive::instruction',      { href: tr('admin::integrations::crm::pipedrive::url') } )}\" onclick=\"{showExample}\"></raw>","",'class="integration-instruction {opts.class}" ref="bla"',(function(e){this.showExample=function(e){const t=e.target,s=t.closest("li"),{screenshot:i}=s.dataset;if(t.classList.contains("style-link")&&i){const e=`/_s/images/admin/settings/crm/services/pipedrive/instruction/${flexbe.vars.user.lang}/`;ks({src:`${e}${i}.png`,class:"integration-instruction-modal"})}}.bind(this)}));const $d=async()=>await ai("/admin/integrations/pipedrive/auth/uri/"),Bd=async e=>await ai("/admin/integrations/pipedrive/sales_funnel/",{data:e}),Ud=async e=>{const t="/admin/integration/pipedrive/addition_info/"+e.integrationId+"/";return await ai(t)};riot3.tag2("settings-block-crm-pipedrive",'<div data-is="admin-integrations-settings-form" fields="{state.fields}" instance="{state.instance}" integration="{state.integration}" loading="{state.listLoaded}"> </div>',"","",(function(e){const t=this;this.mixin("initMobx"),this.state={listLoaded:!0,serviceError:!1,get instance(){return t.props.instance},get integrationId(){return this.instance.instance_id},get integrationName(){return this.instance.integration},get settings(){return this.instance.settings},get showSalesFunnel(){return"deal"===this.settings?.script||!1},get salesFunnelList(){return t.state.salesFunnel||[]},get fields(){return[{name:"script",type:"buttons",class:"is-group",label:tr("admin::integrations::crm::pipedrive::script_label"),list:[{title:tr("admin::integrations::crm::pipedrive::deal"),value:"deal"},{title:tr("admin::integrations::crm::pipedrive::lead"),value:"lead"}]},{name:"sales_funnel",list:this.salesFunnelList,show:this.showSalesFunnel,type:"select",listItemTitle:"name",listItemValue:"id",label:tr("admin::integrations::crm::pipedrive::sales_funnel"),get value(){return t.state.settings.sales_funnel?.id||[]},set value(e){const s=t.state.salesFunnel.find((t=>t.id===e)),i={id:s.id,name:s.name};t.$store.commit("setField",{integrationId:t.state.integrationId,name:"sales_funnel",value:i})}},{name:"utm",type:"toggle",class:"large",label:tr("admin::integrations::common::additional_label"),title:tr("admin::integrations::crm::utm_label")}]}},this.onMounted=async function(){try{this.state.listLoaded=!0;this.state.settings.token;const e=await Ud({integrationId:this.state.integrationId});t.state.salesFunnel=[...e],this.state.listLoaded=!1}catch(e){this.state.listLoaded=!1,this.state.serviceError=!0,nd(e,!0)}this.update()}.bind(this)})),riot3.tag2("element-integrations-pipedrive-connect-tab",'<div data-is="admin-integrations-connect-steps" instance="{state.instance}" integration="{state.integration}" steps="{state.steps}" modal="{opts.modal}" observer="{opts.observer}"></div>',"","",(function(e){this.mixin("initMobx");const t=this;async function s(){const e=await $d();window.open(e,"PipeDrive","width=800, height=800")}this.state={instance:e.instance,integration:e.integration,get integrationName(){return this.instance.integration},get settings(){return this.stage?.settings??{}},get stage(){return t.$state.stage?.[this.integrationName]},get showSalesFunnel(){return"deal"===this.settings?.script||!1},get salesFunnel(){return this.stage?.sales_funnel||[]},get steps(){return[{content:{text:tr("admin::integrations::crm::pipedrive::connect_text"),class:"flexbe-text mb15"},action:{handler:s,resolve:"after_auth"}},{fields:[{name:"settings.script",type:"buttons",class:"is-group",label:tr("admin::integrations::crm::pipedrive::script_label"),list:[{title:tr("admin::integrations::crm::pipedrive::deal"),value:"deal"},{title:tr("admin::integrations::crm::pipedrive::lead"),value:"lead"}]},{name:"settings.sales_funnel",list:this.salesFunnel,show:this.showSalesFunnel,type:"select",listItemTitle:"name",listItemValue:"id",label:tr("admin::integrations::crm::pipedrive::sales_funnel"),get value(){return t.state.settings.sales_funnel?.id??t.state.stage.sales_funnel[0].id},set value(e){const s={...t.state.stage},i=t.state.stage.sales_funnel.find((t=>t.id===e)),a={id:i.id,name:i.name};_t(s,"settings.sales_funnel",a),t.$store.commit("setStagePart",t.state.integrationName,s)}},{name:"settings.utm",type:"toggle",label:tr("admin::integrations::common::additional_label"),title:tr("admin::integrations::crm::utm_label")}],stepForwardButton:this.instanceSettings?tr("main::button::apply"):tr("admin::integrations::crm::install_button")}]}},window.setPipedriveTokens=async s=>{if(s){const{integrationName:i}=t.state,a=await Bd({access_token:s.access_token,api_domain:s.api_domain}),n={id:a[0].id,name:a[0].name};t.$store.commit("setStagePart",i,{settings:{token:{...s},script:"deal",utm:0,sales_funnel:n},sales_funnel:a,after_auth:!0}),e.modal&&e.modal.updatePosition()}}}));riot3.tag2("block-domain_mailing-field-item",'<div data-is="flexbe-input" each="{field, index in state.fields}" class="col col-{tag.opts.columns[index]} {field.inputClass}" placeholder="{field.placeholder}" type="{field.type}" error="{field.error}" replace="{field.replace}" error-tip="{field.error}" autofocus="{field.autofocus}" pattern="{field.pattern}" riot-value="{field.value}" oninput="{field.onchange}" onchange="{field.onchange}"></div> <div class="integrations-group-input-icon col col-2" disabled="{opts.isDisabled && opts.total <= 1}" onclick="{opts.removeItem}" if="{opts.removeItem}"> <svg class="flexbe-icon size-16"> <use riot-href="{sprite}#remove"></use> </svg> </div>',"",'class="block-domain_mailing-field-item {opts.class}"',(function(e){const t=this;function s({domainId:e,type:s,validateLevel:i}){["connect","save","add"].includes(s)&&t.state.domainId===e&&cd(t.state.fields,i)}function i({domainId:e,type:s,violations:i}){["connect","save"].includes(s)&&+t.state.domainId==+e&&pd(t.state.fields,i)}function a(s,i){const a=vt({get name(){return`${t.state.fieldName}.${t.state.index}.${s}`},get value(){return xt(t.state.settings,this.name)},set value(t){e.commit(this.name,t)},get error(){return t.state.errors[this.name]},set error(t){e.commitError(this.name,t)}},i);return dd(a)}this.mixin("initMobx"),this.sprite=at("settings","admin"),this.state={get integrationName(){return this.instance.integration},get fieldName(){return t.props.fieldName},get index(){return t.props.index},get instance(){return t.props.instance},get integration(){return t.props.integration},get stage(){return t.props.stage},get settings(){return this.stage.settings??{}},get domainId(){return this.settings.domain_id},get errors(){return this.stage.errors??{}},get fields(){const t=this.fieldName;return"DKIM"===t?[a("name",{placeholder:"mail._domainkey.site.com",validators:["required"]}),a("value",{placeholder:"v=DKIM1; k=rsa; t=s; p=MIGf...",validators:["required"],replace:/^['"]+|['"]+$/g})]:"SPF"===t?[a("value",{placeholder:"v=spf1 redirect=_spf.site.com",replace:/^['"]+|['"]+$/g})]:"MX"===t?[a("value",{placeholder:"mx1.server.com.",autofocus:e.autofocus,validators:["required","allowedRegex"],regexError:tr("admin::integrations::validation::invalid_mx"),allowedRegex:/^([\da-z]+[\d-.a-z]*[\da-z]+)\.([a-z]{2,10})\.$/i}),a("priority",{inputClass:"priority-input",placeholder:"0",type:"number",rangeNumber:{max:100},validators:["required","rangeNumber"]})]:void 0}},this.onBeforeMount=function(){this.$store.on("checkErrors",s),this.$store.on("setErrors",i)}.bind(this),this.onUnmounted=function(){this.$store.off("checkErrors",s),this.$store.off("setErrors",i)}.bind(this)})),riot3.tag2("block-domain_mailing-fields-block",'<div class="flexbe-field-group row-24 gap-10" if="{state.list.length && state.titles.length}"> <div each="{column in state.titles}" class="flexbe-desc col col-{column.cols}"> {column.title} </div> </div> <virtual each="{item, index in state.list}" key="{index}"> <div data-is="block-domain_mailing-field-item" class="flexbe-field-group row-24 gap-10" columns="{state.columns}" field-name="{opts.fieldName}" index="{index}" is-disabled="{opts.isDisabled}" total="{state.list.length}" instance="{state.instance}" integration="{state.integration}" autofocus="{opts.autofocus}" stage="{state.stage}" commit="{opts.commit}" commit-error="{opts.commitError}" remove-item="{opts.removeItem ? deleteItem.bind(tag, index) : false}"></div> </virtual> <div class="integrations-group-input-button style-link" if="{opts.addItem}" onclick="{addItem}"> <svg class="flexbe-icon size-12"> <use riot-xlink:href="{sprite}#plus"></use> </svg> <span class="flexbe-text">{opts.textAddButton}</span> </div>',"",'class="block-domain_mailing-fields-block {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.sprite=at("settings.integrations","admin"),this.state={get fieldName(){return t.props.fieldName},get instance(){return t.props.instance},get integration(){return t.props.integration},get settings(){return this.instance.settings},get stage(){return t.props.stage},get list(){const e=this.stage.settings??{};return"SPF"===this.fieldName?[{}]:e[this.fieldName]||[]},get columns(){return(t.props.columns??[]).map((e=>e.cols))},get titles(){return(t.props.columns??[]).filter((e=>e.title))}},this.deleteItem=function(t){const s=[...this.state.list];if(e.isDisabled&&this.state.list.length<=1)return!1;s.splice(t,1),e.commit&&e.commit(e.fieldName,s),e.commitResetError&&e.commitResetError()}.bind(this),this.addItem=function(){const{settings:t,stage:s}=this.state,i=t?.domain_id??s.settings.domain_id;this.$store.trigger("checkErrors",{type:"add",validateLevel:"add",domainId:i});const a=h(this.state.list),n=this.state.instance.errors??this.state.stage.errors;n&&Object.values(n).filter((e=>e)).length&&Object.keys(n).filter((t=>t.includes(e.fieldName))).length||(a.push(e.format),e.commit&&e.commit(e.fieldName,a))}.bind(this)})),riot3.tag2("element-integrations-custom-mail-connect-tab",'<div class="content-block pb20"> <div class="text">{tr(\'admin::integrations::domain_mailing::custom::connect\')}</div> </div> <div class="form-item integrations-fields-item"> <div class="flexbe-title"> {tr(\'admin::integrations::domain_mailing::default::settings::mx::title\')} </div> <div data-is="block-domain_mailing-fields-block" class="form-item-content" field-name="MX" stage="{state.stage}" instance="{state.instance}" integration="{state.integration}" add-item="{true}" remove-item="{true}" is-disabled="{true}" autofocus="{true}" text-add-button="{tr(\'admin::integrations::domain_mailing::add_button\', { field: \'MX\' })}" format="{format}" columns="{columns}" commit="{onChange}" commit-error="{onSetError}" commit-reset-error="{onResetError}"> </div> </div> <div class="flexbe-buttons-line inline"> <div class="flexbe-button filled is-primary {loading: state.loading}" onclick="{connect}"> <span class="flexbe-text"> {tr(\'main::button::enable\')} </span> </div> <div class="flexbe-button is-secondary noshrink" disabled="{state.loading}" onclick="{closeModal}"> <span class="flexbe-text"> {tr(\'main::button::cancel\')} </span> </div> </div>',"",'class="element-integrations-custom-mail-connect-tab {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={loading:!1,error:!1,instance:e.instance,integration:e.integration,meta:e.meta,get integrationName(){return this.instance.integration},get stage(){const e=this.integrationName;return t.$state.stage?.[e]||{}},set stage(e){const s=this.integrationName;t.$store.commit("setStagePart",s,e)},get settings(){return this.stage.settings??{}},set settings(e){this.stage={...this.stage,settings:e}},get errors(){return this.stage.errors??{}},set errors(e){this.stage={...this.stage,errors:e}}},this.columns=[{title:tr("admin::integrations::domain_mailing::default::settings::address_server::title"),cols:17},{title:tr("admin::integrations::domain_mailing::default::settings::priority::title"),cols:5}],this.format={value:"",priority:""},this.onChange=function(e,t){const s={...this.state.settings};_t(s,e,t),this.state.settings=s}.bind(this),this.onSetError=function(e,t){const s={...this.state.errors};s[e]=t,this.state.errors=s}.bind(this),this.onResetError=function(){t.state.stage.errors={},this.$store.trigger("checkErrors",{type:"add",domainId:t.state.settings.domain_id,validateLevel:"add"})}.bind(this),this.connect=async function(){if(this.$store.trigger("checkErrors",{type:"connect",domainId:t.state.settings.domain_id,validateLevel:"connect"}),Object.values(this.state.errors).filter((e=>e)).length){this.update();const e=this.root.querySelector(".flexbe-buttons-line > .is-primary");return e.classList.remove("shake-animation"),e.offsetHeight,e.classList.add("shake-animation"),!1}this.state.loading=!0,this.update();try{const e=this.state.integrationName,t=this.state.settings;await this.$store.dispatch("connect",e,t),this.closeModal(),toast.success(tr("admin::integrations::common::connect_success_message")),flexbe.routing.go("/admin/settings/integration/domain_mailing/")}catch(e){"NetworkError"===e.name?toast.error(e.message):"FormError"===e.name&&e.data?(this.$store.trigger("setErrors",{type:"connect",domainId:t.state.settings.domain_id,violations:e.data.violations}),toast.error(e.data.title)):console.error(e)}this.state.loading=!1,this.update()}.bind(this),this.closeModal=function(){e.modal&&e.modal.close()}.bind(this),e.observer&&e.observer.on("connect",(e=>{this.state.loading||this.connect()})),this.on("before-mount",(()=>{const e=flexbe.routing.query?.domain_id;this.state.stage={settings:{domain_id:e??t.state.meta.domains[0].domain_id,MX:[{value:"",priority:""}]}}}))})),riot3.tag2("settings-block-domain_custom-mail",'<div class="flexbe-admin-form" tabindex="0"> <div class="form-item integrations-fields-item"> <div class="form-item-label"> <div class="flexbe-title"> {tr(\'admin::integrations::domain_mailing::default::settings::mx::title\')} </div> </div> <div data-is="block-domain_mailing-fields-block" class="form-item-content" field-name="MX" stage="{state.instance}" instance="{state.instance}" integration="{state.integration}" add-item="{true}" remove-item="{true}" is-disabled="{true}" text-add-button="{tr(\'admin::integrations::domain_mailing::add_button\', { field: \'MX\' })}" format="{format}" columns="{columns[MX]}" commit="{onChange}" commit-error="{onSetError}" commit-reset-error="{onResetError}"> </div> </div> <div class="form-item integrations-fields-item"> <div class="form-item-label"> <div class="flexbe-title"> {tr(\'admin::integrations::domain_mailing::default::settings::spf::title\')} </div> </div> <div data-is="block-domain_mailing-fields-block" class="form-item-content main-spf-content" field-name="SPF" stage="{state.instance}" instance="{state.instance}" integration="{state.integration}" format="{format}" columns="{columns[SPF]}" commit="{onChange}" commit-error="{onSetError}"> </div> </div> <div class="form-item integrations-fields-item"> <div class="form-item-label"> <div class="flexbe-title"> {tr(\'admin::integrations::domain_mailing::default::settings::dkim::title\')} </div> </div> <div data-is="block-domain_mailing-fields-block" class="form-item-content" field-name="DKIM" stage="{state.instance}" instance="{state.instance}" integration="{state.integration}" add-item="{true}" remove-item="{true}" is-disabled="{false}" text-add-button="{tr(\'admin::integrations::domain_mailing::add_button\', { field: \'DKIM\' })}" format="{format}" columns="{columns[DKIM]}" commit="{onChange}" commit-error="{onSetError}" commit-reset-error="{onResetError}"> </div> </div> </div>',"",'class="settings-block-domain_custom-mail"',(function(e){const t=this;this.mixin("initMobx"),this.sprite=at("settings.integrations","admin"),this.state={error:!1,get instance(){return t.props.instance},get integration(){return t.props.integration},get domainMail(){return t.props.domain}},this.columns={DKIM:[{title:tr("admin::integrations::domain_mailing::default::settings::subdomain::title"),cols:11},{title:tr("admin::integrations::domain_mailing::default::settings::value::title"),cols:11}],MX:[{title:tr("admin::integrations::domain_mailing::default::settings::address_server::title"),cols:18},{title:tr("admin::integrations::domain_mailing::default::settings::priority::title"),cols:4}],SPF:[{cols:"24 transparent"}]},this.format={name:"",value:""},this.onChange=function(e,s){const i=this.state.domainMail.domain_id;t.$store.commit("setField",{domainId:i,name:e,value:s})}.bind(this),this.onSetError=function(e,s){const i=this.state.domainMail.domain_id;t.$store.commit("setError",{domainId:i,name:e,error:s})}.bind(this),this.onResetError=function(){const e=this.state.domainMail.domain_id;t.$store.commit("resetErrors",{domainId:e}),this.$store.trigger("checkErrors",{type:"add",domainId:this.state.domainMail.domain_id,validateLevel:"add"})}.bind(this)}));riot3.tag2("element-integrations-default-domain_mailing-connect-tab",'<div class="content-block pb20"> {tr(\'admin::integrations::domain_mailing::default::connect\')} </div> <div data-is="admin-integrations-connect-form" instance="{state.instance}" integration="{state.integration}" modal="{opts.modal}" observer="{opts.observer}"> </div>',"","",(function(e){this.mixin("initMobx"),this.state={instance:e.instance,integration:e.integration,meta:e.meta,get integrationName(){return this.instance.integration}};const t=flexbe.routing.query?.domain_id,s={settings:{domain_id:t??this.state.meta.domains[0].domain_id}};this.$store.commit("setStagePart",this.state.integrationName,s)})),riot3.tag2("settings-block-domain_mailing-default",'<div class="flexbe-admin-form" tabindex="0"> <div class="form-item integrations-fields-item"> <div class="form-item-label"> <div class="flexbe-title"> {tr(\'admin::integrations::domain_mailing::default::settings::mx::title\')} </div> </div> <div class="form-item-content"> <div class="flexbe-field-group row-24 gap-10"> <div each="{column in columns[\'MX\']}" class="flexbe-desc col col-{column.cols}">{column.title}</div> </div> <div each="{item in state.instance.settings.MX}" class="flexbe-field-group row-24 gap-10"> <div class="flexbe-text text-m col col-10">{item.value}</div> <div class="flexbe-text text-m col col-10">{item.priority}</div> </div> </div> </div> <div class="form-item integrations-fields-item"> <div class="form-item-label"> <div class="flexbe-title"> {tr(\'admin::integrations::domain_mailing::default::settings::spf::title\')} </div> </div> <div data-is="block-domain_mailing-fields-block" class="form-item-content main-spf-content" field-name="SPF" stage="{state.instance}" instance="{state.instance}" integration="{state.integration}" format="{format}" columns="{columns[SPF]}" commit="{onChange}" commit-error="{onSetError}"> </div> </div> <div class="form-item integrations-fields-item"> <div class="form-item-label"> <div class="flexbe-title"> {tr(\'admin::integrations::domain_mailing::default::settings::dkim::title\')} </div> </div> <div data-is="block-domain_mailing-fields-block" class="form-item-content" field-name="DKIM" stage="{state.instance}" instance="{state.instance}" integration="{state.integration}" add-item="{true}" remove-item="{true}" is-disabled="{false}" text-add-button="{tr(\'admin::integrations::domain_mailing::add_button\', { field: \'DKIM\' })}" format="{format}" columns="{columns[DKIM]}" commit="{onChange}" commit-error="{onSetError}" commit-reset-error="{onResetError}"> </div> </div> </div>',"",'class="settings-block-domain_mailing-default"',(function(e){const t=this;this.mixin("initMobx"),this.sprite=at("settings.integrations","admin"),this.state={error:!1,get instance(){return t.props.instance},get integration(){return t.props.integration},get domainMail(){return t.props.domain},get domainId(){return this.domainMail.domain_id}},this.columns={DKIM:[{title:tr("admin::integrations::domain_mailing::default::settings::subdomain::title"),cols:11},{title:tr("admin::integrations::domain_mailing::default::settings::value::title"),cols:11}],MX:[{title:tr("admin::integrations::domain_mailing::default::settings::address_server::title"),cols:10},{title:tr("admin::integrations::domain_mailing::default::settings::priority::title"),cols:10}],SPF:[{cols:"24 transparent"}]},this.format={name:"",value:""},this.onChange=function(e,s){t.$store.commit("setField",{domainId:t.state.domainId,name:e,value:s})}.bind(this),this.onSetError=function(e,s){const i=this.state.domainMail.domain_id;t.$store.commit("setError",{domainId:i,name:e,error:s})}.bind(this),this.onResetError=function(){const e=this.state.domainMail.domain_id;t.$store.commit("resetErrors",{domainId:e}),this.$store.trigger("checkErrors",{type:"add",domainId:t.state.domainId,validateLevel:"add"})}.bind(this)}));const Rd={google_analytics:{connect:"element-integrations-google-analytics-connect-tab",settings:"settings-block-counters-google-analytics",instruction:"element-integrations-google-analytics-instruction-tab"},google_tag_manager:{connect:"element-integrations-gtm-connect-tab",settings:"settings-block-counters-gtm"},yandex_metrika:gd,another_counter:{connect:"element-integrations-another-counter-connect-tab",settings:"settings-block-counters-another-counter"},callback_hunter:{connect:"element-integrations-default-widget-connect-tab",settings:"settings-block-widgets-default"},jivo_site:{connect:"element-integrations-default-widget-connect-tab",settings:"settings-block-widgets-default"},talk_me:{connect:"element-integrations-default-widget-connect-tab",settings:"settings-block-widgets-default"},custom_widget:{connect:"element-integrations-custom-widget-connect-tab",settings:"settings-block-widgets-custom-widget"},unisender:{connect:{component:"element-integrations-unisender-connect-tab",button:!1},settings:"settings-block-mailing-unisender",instruction:"element-integrations-unisender-instruction-tab"},sendpulse:{connect:{component:"element-integrations-sendpulse-connect-tab",button:!1},settings:"settings-block-mailing-sendpulse",instruction:"element-integrations-sendpulse-instruction-tab"},getresponse:{connect:{component:"element-integrations-getresponse-connect-tab",button:!1},settings:"settings-block-mailing-getresponse",instruction:"element-integrations-getresponse-instruction-tab"},amocrm:{connect:{component:"element-integrations-amocrm-connect-tab",button:!1},settings:"settings-block-crm-amocrm",instruction:"element-integrations-amocrm-instruction-tab"},bitrix24:{connect:{component:"element-integrations-bitrix24-connect-tab",button:!1},settings:"settings-block-crm-bitrix24",instruction:"element-integrations-bitrix24-instruction-tab"},google_sheets:{connect:{component:"element-integrations-google-sheets-connect-tab",button:!1},settings:"settings-block-crm-google-sheets"},pipe_drive:{connect:{component:"element-integrations-pipedrive-connect-tab",button:!1},settings:"settings-block-crm-pipedrive",instruction:"element-integrations-pipedrive-instruction-tab"},custom_mail:{connect:"element-integrations-custom-mail-connect-tab",settings:{component:"settings-block-domain_custom-mail",actions:{pause:!1}},instruction:!1},google_suite:{connect:"element-integrations-default-domain_mailing-connect-tab",settings:{component:"settings-block-domain_mailing-default",actions:{pause:!1}},instruction:!0},mailru:{connect:"element-integrations-default-domain_mailing-connect-tab",settings:{component:"settings-block-domain_mailing-default",actions:{pause:!1}},instruction:!0},yandex_connect:{connect:"element-integrations-default-domain_mailing-connect-tab",settings:{component:"settings-block-domain_mailing-default",actions:{pause:!1}},instruction:!0}};riot3.tag2("integration-modal",'<div class="integration-modal-header" data-is="element-integrations-service-card" instance="{state.instance}" integration="{state.integration}"> </div> <div data-is="element-store-app-description" tabs="{state.tabs}" active="{state.activeTab}" select="{selectTab}" instance="{state.instance}" integration="{state.integration}" observer="{observer}" meta="{$meta}" modal="{opts.modal}" force-tabs="{true}"> <yield to="header-addon"> <a href="{tag.state.link}" target="_blank" class="integration-link style-link-ignore" if="{tag.state.link}"> <svg class="flexbe-icon size-12"> <use riot-xlink:href="{tag.state.linkIcon}"></use> </svg> <span class="flexbe-text"> {tr(\'admin::integrations::common::integration_service_link\')} </span> </a> </yield> </div>',"",'class="integration-modal"',(function(e){this.mixin("initMobx"),this.observer=At({});const t=this,s=()=>{this.isMounted&&this.update()};this.$store=e.store,this.sprite=flexbe.lib.getSprite("settings.integrations","admin"),this.state={activeTab:e.data?e.data.activeTab:"installation",get instance(){return e.instance},get integrationName(){return this.instance.integration},get integration(){return Rd[this.integrationName]},get link(){return this.instance.info.site_url},get linkIcon(){return`${t.sprite}#to-link`},get tabs(){let e=this.integration.tabs;if(null==e){const t=e=>"string"==typeof e,s=t(this.integration.connect)?this.integration.connect:this.integration.connect.component,i=this.instance.info.description,a=this.integration.instruction??!1,n=t(a)&&a,r=!n&&this.instance.info.instruction;e=[{type:"installation",title:tr("admin::integrations::common::connect_tab"),contentTag:s,show:!!s},{type:"description",title:tr("admin::integrations::common::description_tab"),contentHtml:i,show:!!i},{type:"instruction",title:tr("admin::apps::common::tab_instruction"),contentHtml:r,contentTag:n,show:a}]}return t.opts.data?.tabs?e.filter((e=>t.opts.data.tabs.includes(e.type))):e.filter((e=>e.show))}},this.selectTab=function(e){this.state.activeTab=e.type,this.update()}.bind(this),this.on("before-mount",(()=>{this.$store.on("commit",s),this.$store.on("extendState",s),this.$store.on("extendMeta",s),this.$store.on("updateState",s)})),this.on("mount",(()=>{$(document).on("keydown.connect_form",(t=>{if(13==t.which)return t.preventDefault(),e.modal.disabled||this.observer.trigger("connect",t),!1}))})),this.on("unmount",(()=>{this.$store.off("commit",s),this.$store.off("extendState",s),this.$store.off("extendMeta",s),this.$store.off("updateState",s),$(document).off("keydown.connect_form"),t.$store.commit("setStagePart",this.state.integrationName,null)}))}));const Pd=({instance:e,store:t,requestType:s,data:i})=>{Zs.create({width:500,handle:!1,clickOut:!!i&&i.clickOut,overlay:!0,shadow:!0,requestType:null!=s?s:"connect",riotTag:"integration-modal",props:{instance:e,store:t,data:i}})};riot3.tag2("settings-block-integrations-available-list",'<div class="flexbe-card-list" if="{state.available.length}"> <div class="flexbe-card-item w50" each="{instance in state.available}"> <div class="flexbe-white-card rounded shadow hoverable" data-is="element-integrations-service-card" instance="{instance}" show-arrow="{true}" onclick="{showModal}"></div> </div> </div>',"",'class="settings-block-integrations-available-list {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.state={get available(){const e=bt(t.$state.available);return e.concat(e.splice(e.findIndex((e=>/another|custom/.test(e.integration))),1))},get category(){return t.$state.category}},this.showModal=function(t){const s=t.item.instance,i=this.$store;if(e.confirmShow)return e.confirm(),!1;Pd({instance:s,store:i})}.bind(this)})),riot3.tag2("block-integrations-mailing-list",'<div class="group-list"> <div each="{domain in state.domains}" key="{domain.domain_id}" class="element-integrations-settings-instance group-content"> <div if="{state.domains.length > 1}" class="integrations-mailing-title inline-box"> <div class="text-subtitle">@{domain.domain_name}</div> </div> <div class="flexbe-white-box shadow collection"> <div data-is="element-integrations-connected-mail" domain-mail="{domain}" if="{domain.integration}"> </div> <div data-is="element-integrations-mail" domain-mail="{domain}" if="{!domain.integration}"> </div> </div> </div> </div>',"",'class="block-integrations-mailing-list {opts.class}"',(function(e){const t=this;this.state={get domains(){return t.$getters.domains},get connected(){return t.$state.connected}}}));const Hd={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get category(){return e.$meta.current_category},get title(){return tr({widgets:"admin::integrations::widgets::add_button",counters:"admin::integrations::counters::add_button",mailing:"admin::integrations::mailing::add_button",crm:"admin::integrations::crm::add_button"}[this.category])},get showButton(){var t,s;return(null==(t=e.$state.connected)?void 0:t.length)&&(null==(s=e.$state.available)?void 0:s.length)},get link(){return`/admin/settings/integration/${this.category}/connect/`}}}},template:(e,t,s,i)=>e('<a expr805="expr805" class="flexbe-button is-primary large bordered rounded"></a>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["element-integrations-add-button header-button ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.state.showButton,redundantAttribute:"expr805",selector:"[expr805]",template:e('<span expr806="expr806" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>e.state.link}]},{redundantAttribute:"expr806",selector:"[expr806]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.title}]}])}]),name:"element-integrations-add-button"};e(Hd.name,Hd),riot3.tag2("element-integrations-service-card",'<div class="application-icon store-app-icon size-large"> <img class="flexbe-icon size-auto" riot-src="{state.icon}"> </div> <div class="application-text"> <div class="flexbe-title">{state.title}</div> <div class="flexbe-desc">{state.subtitle}</div> </div> <div class="application-action" if="{opts.showArrow}"> <svg class="flexbe-icon size-10 arrow"> <use riot-xlink:href="{state.sprite}#arrow-next"></use> </svg> </div>',"",'class="element-integrations-service-card store-app-card-preview {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.state={sprite:flexbe.lib.getSprite("settings.integrations","admin"),get instance(){return t.props.instance},get info(){return this.instance.info??{}},get title(){return this.info.title},get subtitle(){return this.info.subtitle},get icon(){return this.info.icon}}})),riot3.tag2("element-integrations-settings-instance",'<div class="flexbe-white-box shadow collection"> <div class="collection-item integration-header {py10: state.title.isEditable}"> <div class="integration-icon store-app-icon size-small"> <img class="flexbe-icon size-auto" riot-src="{state.icon}"> </div> <div class="integration-name flexbe-title text-truncate" if="{!state.title.isEditable}"> {state.title.value} </div> <div data-is="flexbe-input" if="{state.title.isEditable}" riot-value="{state.title.value}" class="integration-name integration-name--editable transparent in-table" oninput="{tag.editTitle}" error="{state.title.error}"> </div> <span class="integration-status flexbe-tag small is-light fade-in-animation" if="{!state.isEnabled}"> {tr(\'admin::integrations::common::paused_badge\')} </span> <span data-is="flexbe-tooltip" if="{state.instanceError}" content="{tr(state.instanceError.explanation)}" class="integration-status flexbe-tag small is-{(!state.instanceError.level || state.instanceError.level == \'error\') ? \'danger\' : state.instanceError.level} fade-in-animation"> {tr(tag.state.instanceError.title) || tr(\'main::error::default\')} </span> <div class="flexbe-button small filled is-secondary integration-button" if="{state.instanceError && state.instanceError.action}" onclick="{reconnectHandler}"> <div class="flexbe-text"> {tr(\'main::button::reconnect\')}</div> </div> <div data-is="proxy" is="save-button" class="integration-button" if="{!state.instanceError.action}" show-save="{state.isChanged}" on-save="{onSave}" on-error="{onError}" observer="{observer}"></div> <div data-is="element-integrations-settings-actions" class="integration-actions" instance="{state.instance}" integration="{state.integration}"></div> </div> <div data-is="{state.settingsComponent}" class="collection-item integration-body" instance="{state.instance}" integration="{state.integration}" disabled="{state.instanceError && state.instanceError.disable_ui}"></div> </div>',"",'class="element-integrations-settings-instance group-content"',(function(e){this.mixin("initMobx"),this.observer=At({});const t=this;this.state={get isChanged(){return this.instance.is_changed},get isEnabled(){return this.instance.is_enabled},get instance(){return t.props.instance},get instanceError(){const e=this.instance.data?.errors??[];return!!e.length&&e[e.length-1]},get integration(){return Rd[this.integrationName]},get integrationName(){return this.instance.integration},get errors(){return this.instance.errors},get settings(){return this.instance.settings},get info(){return this.instance.info},get name(){return this.instance.integration},get category(){return this.instance.category},get title(){const e=this.settings.hasOwnProperty("title");return{value:this.settings.title??this.info.title,isEditable:e,error:!1}},get integrationId(){return this.instance.instance_id},get icon(){return this.info.icon},get settingsComponent(){return"string"==typeof this.integration.settings?this.integration.settings:this.integration.settings.component}},this.normalizeSettings=function(e){return"sendpulse"===this.state.integrationName&&1===e.template_default&&delete e.template_id,e}.bind(this),this.onSave=async function(){const e=this.state.integrationId;this.$store.trigger("checkErrors",{integrationId:e,validateLevel:"saving"});const{settings:t,errors:s,title:i}=this.state,a="object"==typeof s&&Object.values(s).filter((e=>"error"===e.errorLevel)).some((e=>e)),n=i.isEditable&&i.error;if(a||n){const e=this.root.querySelector(".integration-button");return e.classList.remove("shake-animation"),e.offsetHeight,e.classList.add("shake-animation"),new Error(tr("main::error:check_fields"))}let r;try{r=await this.$store.dispatch("updateInstance",e,{settings:this.normalizeSettings(t)})}catch(e){r=e}return r}.bind(this),this.onError=function(e){if("FormError"===e.name&&e.data){const{integrationId:t}=this.state;return this.$store.trigger("setErrors",{integrationId:t,violations:e.data.violations}),void toast.error(e.data.title)}e.message?toast.error(e.message):console.error(e)}.bind(this),this.reconnectHandler=function(t){const s=t.item.instance,i=this.$store;if(e.confirmShow)return e.confirm(),!1;Pd({requestType:"reconnect",instance:s,store:i})}.bind(this),this.editTitle=function(e){const{integrationId:t,title:s}=this.state,i=e.target.value.trim();s.error=!1,i?this.$store.commit("setField",{integrationId:t,name:"title",value:i},!1):s.error=tr("main::error::fill_field")}.bind(this)})),riot3.tag2("element-integrations-settings-actions",'<div class="action-button"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{commonSprite}#dots"></use> </svg> <dropdown position="center" direction="bottom" ref="dropdown"> <div class="status-list flexbe-list borderless hoverable hoverable-background round-corners"> <label if="{tag.actions.pause}" class="flexbe-list-item" onclick="{tag.toggleStatus}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#{tag.state.enabled ? \'action-pause\': \'action-resume\'}"></use> </svg> <span class="flexbe-text" if="{tag.state.enabled}"> {tr(\'admin::integrations::button::pause\')} </span> <span class="flexbe-text" if="{!tag.state.enabled}"> {tr(\'admin::integrations::button::resume\')} </span> </label> <label if="{tag.actions.action}" class="flexbe-list-item" onclick="{tag.actions.action.handler.bind(null, tag)}"> <svg class="flexbe-icon size-15"> <use riot-href="{tag.sprite}#{tag.actions.action.icon}"></use> </svg> <span class="flexbe-text">{tag.actions.action.title}</span> </label> <label if="{tag.actions.instruction}" class="flexbe-list-item" onclick="{tag.instruction}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#icon-instruction"></use> </svg> <span class="flexbe-text">{tr(\'admin::apps::common::tab_instruction\')}</span> </label> <label if="{tag.actions.disconnect}" class="flexbe-list-item" onclick="{tag.disconnect}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#action-remove"></use> </svg> <span class="flexbe-text">{tr(\'main::button::delete\')}</span> </label> </div> </dropdown> </div>',"",'class="element-integrations-settings-actions flexbe-action-buttons {opts.class}"',(function(e){const t=this;this.sprite=flexbe.lib.getSprite("settings.integrations","admin"),this.commonSprite=flexbe.lib.getSprite("settings","admin"),this.extendFromProps={integration:{name:"actions",formatter:e=>{const t=e.settings?.actions,s=e.instruction;return{pause:t?.pause??!0,disconnect:t?.disconnect??!0,action:t?.action??!1,instruction:s}}}},this.state={get instance(){return e.instance},get integrationId(){return this.instance.instance_id},get settings(){return this.instance.settings},get category(){return this.instance.category},get enabled(){return this.instance.is_enabled}},this.toggleStatus=async function(e){e.preventUpdate=!0,flexbe.trigger("closeDropdown");const t=this.state.integrationId,s=this.state.enabled?0:1;try{return await this.$store.dispatch("setEnabled",t,s)}catch(e){"NetworkError"===e.name?toast.error(e.message):console.error(e)}this.update()}.bind(this),this.instruction=function(){Pd({instance:t.opts.instance,store:t.$store,data:{activeTab:"instruction",tabs:["instruction"],clickOut:!0}})}.bind(this),this.disconnect=async function(){const e={widgets:tr("admin::integrations::common::remove_widget_confirm_title"),counters:tr("admin::integrations::common::remove_counter_confirm_title"),mailing:tr("admin::integrations::common::remove_mailing_confirm_title"),crm:tr("admin::integrations::common::remove_crm_confirm_title"),domain_mailing:tr("admin::integrations::common::remove_domain-mailing_confirm_title",{domain:t.opts.domainName})},s=`${this.sprite}#remove_confirm_big`,i=this.state.category;As({props:{icon:s,title:e[i],confirmButtonClass:"is-danger bordered colored",cancelButton:!0,onConfirm:async()=>{await this.$store.dispatch("disconnect",this.state.integrationId),toast.success(tr("admin::integrations::common::remove_success_message"))},onError:e=>{"NetworkError"===e.type?toast.error(e.message):console.error(e)}},clickOut:!0})}.bind(this)})),riot3.tag2("element-integrations-connected-mail",'<div class="collection-item integration-header"> <div class="integration-icon store-app-icon size-small"> <img class="flexbe-icon size-auto" riot-src="{state.info.icon}"> </div> <div class="integration-name flexbe-title text-truncate"> {state.info.title} </div> <div data-is="proxy" is="save-button" class="integration-button" show-save="{state.isChanged}" on-save="{onSave}" on-error="{onError}" observer="{observer}"></div> <div data-is="element-integrations-settings-actions" class="integration-actions" instance="{state.instance}" domain-name="{state.domainName}" integration="{state.integration}"></div> </div> <div data-is="{state.settingsComponent}" class="collection-item integration-body" key="{state.domainId}" instance="{state.instance}" integration="{state.integration}" domain="{state.domainMail}"></div>',"",'class="element-integrations-connected-mail {opts.class}" tabindex="0"',(function(e){const t=this;this.mixin("initMobx"),this.observer=At({}),this.state={get isChanged(){return this.instance.is_changed},get domainMail(){return t.props.domainMail},get info(){return this.domainMail.integration.info},get instance(){return this.domainMail.integration},get errors(){return this.instance.errors},get domainName(){return this.domainMail.domain_name},get domainId(){return this.domainMail.domain_id},get integration(){return Rd[this.integrationName]},get integrationName(){return this.instance.integration},get settingsButton(){return this.integration.settings.button},get settingsComponent(){return this.integration.settings.component},get settingsButton(){return this.integration.settings.button},get settings(){return this.instance.settings}},this.onSave=async function(){const e=this.state.instance.instance_id,t=this.state.domainId;if(await this.$store.trigger("checkErrors",{type:"save",domainId:this.state.domainId,validateLevel:"save"}),this.update(),this.state.errors&&Object.values(this.state.errors).filter((e=>!!e)).length){const e=this.root.querySelector(".integration-button");return e.classList.remove("shake-animation"),e.offsetHeight,e.classList.add("shake-animation"),new Error(tr("main::error:check_fields"))}let s;try{s=await this.$store.dispatch("updateInstance",t,e,{settings:this.state.settings})}catch(e){s=e}return s}.bind(this),this.onError=function(e){if("FormError"===e.name&&e.data){const s=this.root.querySelector(".integration-button");return s.classList.remove("shake-animation"),s.offsetHeight,s.classList.add("shake-animation"),this.$store.trigger("setErrors",{type:"save",domainId:this.state.domainId,violations:e.data.violations}),void t.update()}e.message?toast.error(e.message):console.error(e)}.bind(this)})),riot3.tag2("element-integrations-mail",'<div class="collection-item"> <div class="service-icon store-app-icon size-small"> <img class="flexbe-icon size-16" src="/_s/images/admin/settings/mail/services/default-small.svg"> </div> <div class="service-connect"> {tr(\'admin::integrations::domain_mailing::service_disabled_info\')} </div> <div class="flexbe-button filled small is-secondary connect-button ml-auto" onclick="{connectService}"> <span class="flexbe-text">{tr(\'admin::integrations::domain_mailing::connect_button\')}</span> </div> </div>',"",'class="element-integrations-mail {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.state={get domainMail(){return t.props.domainMail}},this.connectService=function(){flexbe.routing.go(`/admin/settings/integration/domain_mailing/connect/?domain_id=${this.state.domainMail.domain_id}`)}.bind(this)})),riot3.tag2("settings-section-domains",'<div if="{state.hasMain}" data-is="settings-block-domain-main" class="group-item slide-down-animation"></div> <div if="{state.hasAliases}" data-is="settings-block-domain-aliases" class="group-item slide-down-animation"></div> <div if="{state.hasOrders}" data-is="settings-block-domain-orders" class="group-item slide-down-animation"></div> <div if="{state.hasMain}" data-is="settings-block-domain-tech" class="group-item slide-down-animation"></div> <div if="{state.isEmpty}" class="group-item slide-down-animation" data-is="settings-block-domains-empty"></div> <div class="free-domain pt30 pl100" if="{state.freeDomainTip}"> <svg class="flexbe-icon size-32"> <path d="M6.75466 3.1L1.15466 9.5C0.754664 9.9 0.854664 10.5 1.25466 10.9C1.65466 11.3 2.25466 11.2 2.65466 10.8L6.65466 6.1C6.65466 12.2 9.05466 17.9 13.3547 22.3C17.8547 26.8 23.7547 29.3 30.2547 29.5C30.8547 29.5 31.2547 29.1 31.2547 28.5C31.2547 28 30.8547 27.5 30.2547 27.5C24.3547 27.4 18.8547 25.1 14.7547 20.9C10.7547 16.9 8.55466 11.7 8.55466 6.1L12.6547 10.8C13.0547 11.2 13.6547 11.3 14.0547 10.9C14.2547 10.7 14.3547 10.4 14.3547 10.1C14.3547 9.9 14.2547 9.6 14.1547 9.4L8.65466 3C8.35466 2.7 8.05466 2.5 7.65466 2.5C7.25466 2.5 6.95466 2.7 6.75466 3.1Z"></path> </svg> <span class="flexbe-text"> {tr(\'admin::domains::main::ru_price_info_text\')} </span> </div>',"",'class="settings-section-domains group-list pb60 {opts.class}"',(function(e){const t=this;this.state={get hasMain(){return t.$state&&t.$state.main_domain&&t.$state.main_domain.domain_id},get hasAliases(){return t.$state&&t.$state.domain_list&&t.$state.domain_list.length},get hasOrders(){return t.$state&&t.$state.domain_reg_list&&t.$state.domain_reg_list.length},get isEmpty(){return!this.hasMain&&!this.hasAliases&&!this.hasOrders},get freeDomainTip(){return this.isEmpty&&t.$state.domain_free_available}}})),riot3.tag2("settings-block-domain-main",'<div class="flexbe-white-box shadow collection status-{state.domainStatus}"> <div class="collection-item"> <div data-is="element-domains-domain-info" domain="{state.domain}"></div> <div data-is="element-domains-domain-actions" domain="{state.domain}"></div> </div> <div class="collection-item" if="{state.domain.expire || state.domain.price.renew}"> <div class="pay-block inline-box" if="{state.domain.expire}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#history_tip"></use> </svg> <span class="flexbe-text" data-is="flexbe-tooltip" content="{state.expireTip}"> {tr(\'admin::domains::main::payed_until_text\', { date: tag.state.domain.expire_text })} </span> </div> <div class="price-block inline-box" if="{state.domain.price.renew || state.domain.is_free}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#price_tip"></use> </svg> <div class="flexbe-text" data-is="element-domains-domain-price" domain="{state.domain}" type="renew" wrap="{true}"></div> <a if="{state.domain.allow_renew && state.domain.reg_id}" class="flexbe-button small is-secondary filled" href="/admin/user/pay/domain/?domain_renew_id={state.domain.reg_id}"> <span class="flexbe-text">{tr(\'admin::domains::main::renew_button\')}</span> </a> </div> </div> </div>',"",'class="settings-block-domain-main {opts.class}"',(function(e){const t=this;this.sprite=at("settings.domains","admin"),this.state={get domain(){return t.$state.main_domain},get domainStatus(){return"error"===this.domain.status.status?"error":"success"},get expireTip(){return this.domain.is_transfer?tr("admin::domains::main::expire_transfer_tip"):tr("admin::domains::main::expire_domain_tip")}}})),riot3.tag2("settings-block-domain-aliases",'<div class="flexbe-title text-subtitle"> {tr(\'admin::domains::main::domain_aliases_text\')} </div> <div class="flexbe-white-box shadow flexbe-table"> <div class="thead text-shade text-note"> <div class="tr"> <div class="th info"> {tr(\'admin::domains::main::domain_name_label\')} </div> <div class="th expire"> {tr(\'admin::domains::main::domain_expire_label\')} </div> <div class="th price"> {tr(\'admin::domains::main::domain_price_label\')} </div> <div class="th actions"></div> </div> </div> <div class="tbody"> <div class="tr" each="{domain in $state.domain_list}"> <div class="td info"> <div data-is="element-domains-domain-info" domain="{domain}"></div> </div> <div class="td expire"> {domain.expire ? domain.expire_text : \'\'} </div> <div class="td price"> <div data-is="element-domains-domain-price" domain="{domain}" type="renew"></div> </div> <div class="td actions"> <div data-is="element-domains-domain-actions" domain="{domain}"></div> </div> </div> </div> </div>',"",'class="settings-block-domain-aliases {opts.class}"',(function(e){})),riot3.tag2("settings-block-domain-orders",'<div class="flexbe-title text-subtitle"> {tr(\'admin::domains::main::domain_orders_title\')} </div> <div class="flexbe-white-box shadow collection"> <div data-is="element-domains-reg-item" class="collection-item" each="{domain in $state.domain_reg_list}" domain="{domain}"></div> </div>',"",'class="settings-block-domain-orders {opts.class}"',(function(e){})),riot3.tag2("settings-block-domain-tech",'<div class="flexbe-title text-subtitle"> {tr(\'admin::domains::main::tech_domain_title\')} </div> <div class="flexbe-white-box shadow collection"> <div class="collection-item w100"> <div class="flexbe-text text-shade-60"> {state.techAddress} </div> <div class="flexbe-desc ml-auto"> {tr(\'admin::settings::access_code::title\')}: {state.accessCode} </div> </div> </div>',"",'class="settings-block-domain-tech {opts.class}"',(function(e){this.state={get techAddress(){return`lp${flexbe.vars.group.id}.myflexbe.com`},get accessCode(){return flexbe.vars.group.s_id}}})),riot3.tag2("settings-block-domains-empty",'<div class="flexbe-white-box shadow is-card"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{sprite}#www_big"></use> </svg> <div class="domains-desc flexbe-text my20" data-is="raw" content="{tr(\'admin::domains::main::domains_empty_desc\')}"></div> <a class="flexbe-button filled rounded large is-primary" href="/admin/settings/domains/add/"> <span class="flexbe-text"> {tr(\'admin::domains::main::add_domain_button\')} </span> </a> </div>',"",'class="settings-block-domains-empty {opts.class}"',(function(e){this.sprite=flexbe.lib.getSprite("settings.domains","admin")}));const jd={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get showButton(){const t=e.$state;if(t){const e=t.main_domain&&t.main_domain.domain_id,s=t.domain_list&&t.domain_list.length,i=t.domain_reg_list&&t.domain_reg_list.length;return e||s||i}return!1}}}},template:(e,t,s,i)=>e('<a expr807="expr807" class="flexbe-button is-primary large bordered rounded" href="/admin/settings/domains/add/"></a>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["element-domains-add-alias-button header-button ",e.props.domains].join("")}]},{type:s.IF,evaluate:e=>e.state.showButton,redundantAttribute:"expr807",selector:"[expr807]",template:e('<span expr808="expr808" class="flexbe-text"> </span>',[{redundantAttribute:"expr808",selector:"[expr808]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::domains::main::add_alias_button")}]}])}]),name:"element-domains-add-alias-button"};e(jd.name,jd),riot3.tag2("domain-dns-servers-modal",'<div class="flexbe-modal-content"> <div class="flexbe-field-group"> <label data-is="flexbe-input" type="toggle" checked="{state.customEnabled}" onchange="{setCustomEnabled}"> <span class="flexbe-text"> {tr(\'admin::domains::change_nameservers::custom_ns_label\')} </span> </label> </div> <div class="flexbe-field-group"> <div class="flexbe-field-group compact is-inline" each="{item, index in state.dnsList}"> <div class="flexbe-title">NS{index + 1}</div> <div data-is="flexbe-input" class="input-host grow" riot-value="{item.host}" placeholder="{(index < 2) ? tr(\'admin::domains::change_nameservers::host_placeholder\') : tr(\'admin::domains::change_nameservers::host_opt_placeholder\')}" error="{item.hostError}" error-tip="{item.hostError}" replace="{/[^a-z-\\-_0-9.]*/gi}" maxlength="{254}" disabled="{!state.customEnabled}" oninput="{setNsHost}" onchange="{setNsHost}"> </div> <div if="{showIp(item.host)}" data-is="flexbe-input" class="input-ip" riot-value="{item.ip}" error="{item.ipError}" error-tip="{item.ipError}" mask="{ipMask}" placeholder="{tr(\'admin::domains::change_nameservers::ip_placeholder\')}" oninput="{setNsIP}" onchange="{setNsIP}"> </div> </div> </div> <div class="flexbe-field-group flexbe-bar has-line" if="{state.customEnabled}"> {tr(\'admin::domains::change_nameservers::wrong_settings_warning\')} </div> <div class="inline-box"> <div class="flexbe-button filled is-primary {loading: state.loading}" onclick="{saveList}"> <span class="flexbe-text">{tr(\'main::button::save\')}</span> </div> <div class="flexbe-error ml10" if="{this.state.error}"> {this.state.error.message} </div> </div> </div>','domain-dns-servers-modal .input-ip,[data-is="domain-dns-servers-modal"] .input-ip{width:150px}',"",(function(e){this.mixin("initMobx");const t=e.domain,s=t.custom_dns_list||{},i=s.enabled?1:0;let a=i;const n=$.extend(!0,[],t.dns_list).map((e=>Object.freeze({host:e,ip:""}))),r=$.extend(!0,[{host:"",ip:""},{host:"",ip:""},{host:"",ip:""},{host:"",ip:""}],s.list);this.state={error:!1,loading:!1,customEnabled:i,defaultDNS:n,domainDNS:r,get dnsList(){return this.customEnabled?this.domainDNS:this.defaultDNS}},this.watch={"state.customEnabled":e=>{if(e&&!a){a=!0;const e=h(this.state.defaultDNS);this.state.domainDNS.forEach(((t,s)=>{const i=e[s];!t.host&&i&&(t.host=i.host,t.ip=i.ip)}))}this.update()}},this.ipMask=Pl.ipAddr,this.setCustomEnabled=function(){this.state.customEnabled=this.state.customEnabled?0:1,this.update()}.bind(this),this.setNsHost=function(e){const t=e.item.index,s=this.state.domainDNS[t];s&&(s.hostError=!1,s.host=String(e.target.value).trim(),"change"===e.type&&(!s.host&&t<=1?s.hostError=tr("main::error::fill_field"):s.host&&!er(s.host)&&(s.hostError=tr("main::error::invalid_domain"))))}.bind(this),this.setNsIP=function(e){const t=e.item.index,s=this.state.domainDNS[t];if(s&&(s.ipError=!1,s.ip=String(e.target.value).trim(),"change"===e.type&&e.target.mask)){e.target.mask.masked.isComplete||(s.ipError=tr("main::error::fill_field"))}}.bind(this),this.showIp=function(e){if(!this.state.customEnabled)return!1;return new RegExp(t.full_name+"$").test(e)}.bind(this),this.checkErrors=function(){if(this.state.error=!1,this.state.customEnabled){const e=this.state.dnsList;e.filter((e=>e.host)).length<2?this.state.error={code:"need_more_ns",message:tr("admin::domains::change_nameservers::ns_limit_error")}:e.some((e=>e.hostError||e.ipError))&&(this.state.error={code:"error_in_fields",message:tr("main::error:check_fields")})}return this.state.error}.bind(this),this.saveList=async function(){if(this.checkErrors(),this.state.error)return!1;this.state.loading=!0;const s=this.state.customEnabled,i=this.state.dnsList.filter((e=>e.host));try{await ii(`/admin/api/project/${flexbe.vars.group.id}/settings/domains/parameters/save/`,{data:{reg_id:t.reg_id,custom_dns_list:{enabled:s,list:i}}}),await adminStore.getModule("settings/domains").loadState(),this.state.loading=!1,this.update(),e.modal.close(),toast.success(tr("admin::domains::reg::form::saved_notify"))}catch(e){if("NetworkError"!==e.name)throw e;this.state.loading=!1,this.state.error={code:"server_error",message:e.message},this.update()}}.bind(this)})),riot3.tag2("domain-contact-settings-modal",'<div class="flexbe-modal-content" if="{!state.loaded}"> <div data-is="proxy" is="flexbe-loader"></div> </div> <div class="flexbe-modal-content" if="{state.loaded && !forceRerender}"> <div class="flexbe-field-group" each="{field, index in fields}"> <div class="flexbe-title">{field.label}</div> <div data-is="flexbe-input" if="{field.type != \'select\'}" name="{field.name}" type="{field.type}" riot-value="{field.value}" placeholder="{field.placeholder}" mask="{field.mask}" error="{!field.valid}" error-text="{field.error}" oninput="{field.onchange}" onchange="{field.onchange}"> </div> <div data-is="flexbe-select" if="{field.type == \'select\'}" name="{field.name}" riot-value="{field.value}" list="{field.list}" error="{!field.valid}" error-text="{field.error}" onchange="{field.onchange}"> </div> </div> <div class="inline-box"> <div class="flexbe-button filled is-primary {loading: state.saving}" onclick="{saveContacts}"> <span class="flexbe-text">{tr(\'main::button::save\')}</span> </div> <div class="flexbe-error ml10" if="{this.state.error}"> {this.state.error.message} </div> </div> </div>',"","",(function(e){const t=e.domain,s=Object.assign({},t.contacts),i=(e,t)=>{const i=vt({validators:[Ul.required,Ul.mask],get value(){return s[e]||""},set value(t){s[e]=t}},t);return new Hl(e,i)};this.meta={countries:[]},this.state={error:!1,saving:!1,loaded:!1},this.createFields=function(){const e=i("email",{label:tr("main::label::email"),placeholder:tr("admin::domains::reg::form::field_email_placeholder"),validators:[Ul.required,Ul.email],mask:Pl.email}),t=i("phone",{label:tr("main::label::phone_number"),placeholder:tr("admin::domains::reg::form::phone_placeholder"),mask:Pl.phone}),s=i("country",{label:tr("admin::domains::reg::form::field_country_label"),placeholder:tr("admin::domains::reg::form::field_country_placeholder"),type:"select",list:this.meta.countries,afterSet:()=>{this.rerenderFields()}}),a=i("address_city",{label:tr("admin::domains::reg::form::field_city_label"),placeholder:tr("admin::domains::reg::form::field_city_placeholder")}),n=i("address_street",{label:tr("admin::domains::reg::form::field_street_label"),placeholder:tr("admin::domains::reg::form::field_street_placeholder")}),r=i("address_zip",{label:tr("admin::domains::reg::form::field_zip_label"),placeholder:tr("admin::domains::reg::form::field_zip_placeholder"),get mask(){return"RU"==s.value?Pl.ruZip:Pl.zip}});this.fields=[e,t,s,r,a,n]}.bind(this),this.checkErrors=function(){this.state.error=!1;return this.fields.every((e=>e.validate()))||(this.state.error={code:"error_in_fields",message:tr("main::error:check_fields")}),this.state.error}.bind(this),this.setErrors=function(e=[]){return!!e.length&&(e=he(e,(e=>e.field)),this.fields.forEach((t=>{e[t.name]&&(t.error=""===e[t.name].full_text?t.error=e[t.name].text:e[t.name].full_text)})),this.state.error={code:"error_in_fields",message:tr("main::error:check_fields")},this.state.error)}.bind(this),this.rerenderFields=function(){this.update({forceRerender:!0}),this.update({forceRerender:!1})}.bind(this),this.loadMeta=async function(){const e=await ai("/admin/api/countries/");this.meta.countries=Object.assign(this.meta.countries,e.data),this.state.loaded=!0}.bind(this),this.saveContacts=async function(){if(this.checkErrors(),this.state.error)return!1;this.state.saving=!0,this.state.customEnabled;try{await ii(`/admin/api/project/${flexbe.vars.group.id}/settings/domains/parameters/save/`,{data:{reg_id:t.reg_id,...s}}),await adminStore.getModule("settings/domains").loadState(),this.state.saving=!1,this.update(),e.modal.close(),toast.success(tr("admin::domains::reg::form::saved_notify"))}catch(e){if("NetworkError"!==e.name)throw e;this.state.saving=!1,this.setErrors(e.data.data.error),this.update(),toast.error(e.message)}}.bind(this),this.on("before-mount",(async()=>{await this.loadMeta(),this.createFields(),this.update(),e.modal.updatePosition()}))})),riot3.tag2("modal-belgie-alert",'<svg viewbox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="flexbe-icon size-28"> <path fill-rule="evenodd" clip-rule="evenodd" d="M5 3H6H19H20V4V8V9H19H18V12V13H17V13.8027C17.8825 13.2922 18.9071 13 20 13C23.3137 13 26 15.6863 26 19C26 22.3137 23.3137 25 20 25C19.6593 25 19.3252 24.9716 19 24.917V25H18H5H4V24V20V19H5H6V17H3H2V16V12V11H3V8V7H4H5V4V3ZM15.5278 23C15.0113 22.4229 14.6048 21.7452 14.3414 21H7H6V23H15.5278ZM14 19C14 18.2987 14.1203 17.6256 14.3414 17H8V19H14ZM5 9V11H16V9H6H5ZM18 7H17H7V5H18V7ZM15 13H4V15H7H15V13ZM24 19C24 21.2091 22.2091 23 20 23C17.7909 23 16 21.2091 16 19C16 16.7909 17.7909 15 20 15C22.2091 15 24 16.7909 24 19Z" fill="#56B157"></path> </svg> <div class="flexbe-text text-l mt20"> {tr(\'admin::user::pay::belgie::pay_for_plan_message\')} </div> <a href="/admin/user/pay/" class="flexbe-button filled is-primary px15 mt20">{tr(\'admin::settings::notify::go_to_payment_button\')}</a>',"",'class="modal-sms-plan-alert"',(function(e){}));riot3.tag2("element-domains-domain-actions",'<div class="action-button"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{commonSprite}#dots"></use> </svg> <dropdown position="right" direction="bottom" autohide="{false}" ref="dropdown"> <div class="status-list flexbe-list borderless hoverable hoverable-background round-corners"> <label class="flexbe-list-item" onchange="{tag.toggleSsl}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#action_ssl"></use> </svg> <span class="flexbe-text">{tr(\'admin::domains::domain_action::ssl_text\')}</span> <span data-is="flexbe-input" type="toggle" checked="{tag.state.sslEnable}"></span> </label> <label class="flexbe-list-item" onchange="{tag.toggleRedirect}" if="{!tag.state.isMain}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#action_redirect"></use> </svg> <span class="flexbe-text">{tr(\'admin::domains::domain_action::redirect_text\')}</span> <span data-is="flexbe-input" type="toggle" checked="{tag.state.redirectToMain}"></span> </label> <label class="flexbe-list-item" onclick="{tag.makeMain}" if="{!tag.state.isMain}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#action_main"></use> </svg> <span class="flexbe-text">{tr(\'admin::domains::domain_action::make_main_text\')}</span> </label> <a class="flexbe-list-item" href="/admin/settings/integration/domain_mailing/connect/?domain_id={tag.state.domainId}" if="{!tag.state.mailService && tag.state.isWork}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#action_mail"></use> </svg> <span class="flexbe-text">{tr(\'admin::domains::mail::domain_action_connect_mail\')}</span> </a> <a class="flexbe-list-item" href="/admin/settings/integration/domain_mailing/" if="{tag.state.mailService && tag.state.isWork}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#action_mail"></use> </svg> <span class="flexbe-text">{tr(\'admin::domains::domain_action::edit_mail_text\')}</span> </a> <a if="{tag.state.domain.allow_renew && tag.state.isOwnDomain}" href="/admin/user/pay/domain/?domain_renew_id={tag.state.domain.reg_id}" class="flexbe-list-item"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#action_renew"></use> </svg> <span class="flexbe-text">{tr(\'admin::domains::domain_action::renew\')}</span> </a> <label if="{tag.state.isOwnDomain}" class="flexbe-list-item" onclick="{tag.showDNSSettings}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#action_dns"></use> </svg> <span class="flexbe-text">{tr(\'admin::domains::domain_action::setup_dns_text\')}</span> </label> <label if="{tag.state.isOwnDomain}" class="flexbe-list-item" onclick="{tag.showContactsSettings}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#action_contacts"></use> </svg> <span class="flexbe-text">{tr(\'admin::domains::domain_action::credentials\')}</span> </label> <a if="{tag.state.isByDomain}" class="flexbe-list-item" onclick="{tag.goToPayment}" href="/admin/user/pay/belgie/?domain={tag.state.domain.full_name}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#belgie"></use> </svg> <span class="flexbe-text">{tr(\'admin::domains::domain_action::belgie\')}</span> </a> <hr> <label class="flexbe-list-item" onclick="{tag.removeDomain}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#action_remove"></use> </svg> <span class="flexbe-text" if="{tag.state.isOwnDomain}">{tr(\'admin::domains::domain_action::unlink_text\')}</span> <span class="flexbe-text" if="{!tag.state.isOwnDomain}">{tr(\'admin::domains::domain_action::remove_text\')}</span> </label> </div> </dropdown> </div>',"",'class="element-domains-domain-actions flexbe-action-buttons {opts.domains}"',(function(e){this.commonSprite=at("settings","admin"),this.sprite=at("settings.domains","admin");const t=this.tag;this.main,this.state={get domain(){return e.domain},get sslEnable(){let e=+this.domain.ssl.enabled;return!e||0!==this.domain.ssl.status&&4!==this.domain.ssl.status||(e=0),e},get domainId(){return this.domain.domain_id},get mailService(){return this.domain.mail_service||!1},get redirectToMain(){return!this.isMain&&this.domain.is_redirect_to_main},get isMain(){return!!this.domain.is_main},get isWork(){return!!this.domain.is_work},get isOwnDomain(){return this.domain.reg_id},get isByDomain(){const e=["by",""].includes(this.domain.zone_name),t="BY"===flexbe.vars.group.country,s="owner"===flexbe.vars.user.role;return(e||t)&&s}},this.toggleSsl=async function(e){try{await t.$store.dispatch("toggleDomainSsl",this.state.domain.domain_id,e.target.checked),e.target.checked?toast.success(tr("admin::domains::main::ssl_enabled_notify")):toast.success(tr("admin::domains::main::ssl_disabled_notify"))}catch(e){"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.toggleRedirect=async function(e){try{await t.$store.dispatch("toggleDomainRedirect",this.state.domain.domain_id,e.target.checked),this.state.redirectToMain?toast.success(tr("admin::domains::main::redirect_enabled_notify")):toast.success(tr("admin::domains::main::redirect_disabled_notify"))}catch(e){"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.makeMain=function(){this.closeDropdown(),As({props:{icon:`${this.sprite}#make_main_confirm`,title:tr("admin::domains::main::make_main_confirm_title",{domain:this.state.domain.full_name}),cancelButton:!0,onConfirm:()=>t.$store.dispatch("setDomainAsMain",this.state.domain.domain_id),onDone:e=>{e&&toast.success(tr("admin::domains::main::make_main_success_notify"))},onError:e=>{toast.error(e.message)}}})}.bind(this),this.showContactsSettings=function(){this.closeDropdown(),(e=>{const t=e.domain.full_name;Zs.create({width:500,handle:!1,overlay:!0,shadow:!0,title:tr("admin::domains::change_contacts::title",{domain:t}),riotTag:"domain-contact-settings-modal",props:e})})({domain:this.state.domain})}.bind(this),this.showDNSSettings=function(){this.closeDropdown(),(e=>{const t=e.domain.full_name;Zs.create({width:500,handle:!1,overlay:!0,shadow:!0,title:tr("admin::domains::change_nameservers::title",{domain:t}),riotTag:"domain-dns-servers-modal",props:e})})({domain:this.state.domain})}.bind(this),this.removeDomain=function(){this.closeDropdown(),As({props:{icon:`${this.sprite}#remove_domain_confirm`,title:tr("admin::domains::main::remove_domain_confirm_title",{domain:this.state.domain.full_name}),cancelButton:!0,onConfirm:()=>t.$store.dispatch("removeDomain",this.state.domain.domain_id),onDone:e=>{e&&toast.success(tr("admin::domains::main::domain_removed_notify"))},onError:e=>{toast.error(e.message)}}})}.bind(this),this.goToPayment=function(e){this.closeDropdown(),flexbe.bill.isPaid||(e.preventDefault(),Zs.create({noTitle:!0,overlay:!0,shadow:!0,riotTag:"modal-belgie-alert",width:400}))}.bind(this),this.closeDropdown=function(){this.refs.dropdown.trigger("toggleDropdown",!1)}.bind(this)})),riot3.tag2("element-domains-domain-info",'<div class="domain-ssl" data-is="element-domains-ssl-status" domain="{opts.domain}"></div> <div class="domain-name" title="{opts.domain.full_name}"> <span class="flexbe-text">{opts.domain.full_name}</span> </div> <div class="domain-status" data-is="element-domains-domain-status" domain="{opts.domain}"></div>',"",'class="element-domains-domain-info {opts.class}"',(function(e){})),riot3.tag2("element-domains-domain-price",'<span data-is="flexbe-tooltip" content="{tag.priceTip}"> {tag.priceText} </span>',"",'class="element-domains-domain-price {opts.class}"',(function(e){let t="",s="";const i=e.type||"reg";if(e.domain.is_free)s=tr("admin::domains::main::free_text"),t=tr("admin::domains::main::price_free_tip");else if(e.domain.is_transfer)t=tr("admin::domains::main::transfered_domain_expire_tip"),s="";else{const t=e.domain.price["reg"===i?"reg":"renew"],a=e.domain.price["reg"===i?"reg_text":"renew_text"];s=t?tr("admin::domains::main::price_year_text",{price:a}):""}e.wrap&&(s=`${tr("admin::domains::main::price_label")}: ${s}`),this.priceText=s,this.priceTip=t})),riot3.tag2("element-domains-domain-status",'<div class="domain-error" if="{state.icon}" data-is="flexbe-tooltip" content="{state.tip}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#{tag.state.icon}"></use> </svg> </div> <span class="flexbe-tag small is-light" if="{state.label}" data-is="flexbe-tooltip" content="{state.tip}"> {tag.state.label} </span>',"",'class="element-domains-domain-status {opts.class}"',(function(e){this.mixin("initMobx");const t=e.domain,s=(t.dns_list||[]).join("<br>"),i={ok:{get label(){return t.is_main?tr("admin::domains::main::primary_domain_text"):t.is_redirect_to_main?tr("admin::domains::main::redirect_text"):null}},in_transfer:{label:tr("admin::domains::main::domain_registered_label"),tip:{text:tr("admin::domains::main::domain_registered_tip_text")}},is_transfered:{label:tr("admin::domains::main::domain_transfered_label"),tip:{text:tr("admin::domains::main::domain_wait_transfered_tip_text")}},expired:{icon:"error",get tip(){return{title:tr("admin::domains::main::domain_expired_tip_title"),text:t.is_transfer?tr("admin::domains::main::domain_expired_transfer_tip_text"):tr("admin::domains::main::domain_expired_tip_text")}}},not_register:{icon:"error",tip:{title:tr("admin::domains::main::domain_not_registered_tip_title"),text:tr("admin::domains::main::domain_not_registered_tip_text",{list:s})}},dns_wait:{icon:"error",tip:{title:tr("admin::domains::main::domain_dns_wait_tip_title"),text:tr("admin::domains::main::domain_dns_wait_tip_text",{list:s})}},cname_wait:{icon:"error",tip:{title:tr("admin::domains::main::domain_dns_wait_tip_title"),text:tr("admin::domains::main::subdomain_dns_wait_tip_text",{domain:t.full_name,cname:t.cname_server})}},dns_wrong:{icon:"error",tip:{title:tr("admin::domains::main::domain_doesnt_work_text"),text:tr("admin::domains::main::domain_dns_wait_tip_text",{list:s})}},cname_wrong:{icon:"error",tip:{title:tr("admin::domains::main::domain_doesnt_work_text"),text:tr("admin::domains::main::subdomain_dns_wait_tip_text",{domain:t.full_name,cname:t.cname_server})}}};this.sprite=flexbe.lib.getSprite("settings.domains","admin"),this.state={get status(){return t.status||{}},get info(){return i[this.status.code]||{}},get label(){return this.info.label||!1},get icon(){return this.info.icon||!1},get tip(){let e="";const t=this.info.tip||{};return t.title&&(e+=`<p class="title">${t.title}</p>`),t.text&&(e+=`<p class="text">${t.text}</p>`),e}}})),riot3.tag2("element-domains-reg-item",'<div class="domain-name">{state.name}</div> <div class="domain-status" if="{state.status == \'wait_payment\'}"> <div class="status"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{sprite}#wait"></use></svg> <span class="flexbe-desc">{tr(\'admin::domains::main::domain_wait_payment_text\')}</span> </div> <div class="actions flexbe-buttons-line"> <a class="flexbe-button small is-primary filled" href="/admin/user/pay/domain/?domain_reg_id={state.regId}"> <span class="flexbe-text">{tr(\'admin::domains::main::pay_button\')}</span> </a> <a if="{state.allowEdit}" class="flexbe-button small is-secondary filled" href="/admin/settings/domains/reg/?reg_id={state.regId}"> <span class="flexbe-text">{tr(\'main::button::edit\')}</span> </a> <div class="flexbe-button small is-secondary filled" onclick="{cancelRegistration}"> <svg class="flexbe-icon size-14 text-shade-40"> <use riot-xlink:href="{sprite}#action_remove_small"></use> </svg> </div> </div> </div> <div class="domain-status" if="{state.status == \'queue\'}"> <div class="status" data-is="flexbe-tooltip" content="{tr(\'admin::domains::main::domain_in_register_tip\')}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.sprite}#wait"></use></svg> <span class="flexbe-desc">{tr(\'admin::domains::main::domain_in_register_label\')}</span> </div> </div> <div class="domain-status" if="{state.status == \'error\'}"> <div class="status" data-is="flexbe-tooltip" content="{state.errorMessage}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.sprite}#error"></use></svg> <span class="flexbe-error">{tr(\'admin::domains::reg::error_label\')}</span> </div> </div> <div class="domain-status" if="{state.status == \'wrong_data\'}"> <div class="status" data-is="flexbe-tooltip" content="{state.errorMessage}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.sprite}#error"></use></svg> <span class="flexbe-error">{tr(\'admin::domains::reg::wrong_data_label\')}</span> </div> <div class="actions flexbe-buttons-line"> <a if="{state.allowEdit}" class="flexbe-button small is-secondary filled" href="/admin/settings/domains/reg/?reg_id={state.regId}"> <span class="flexbe-text">{tr(\'main::button::edit\')}</span> </a> </div> </div>',"",'class="element-domains-reg-item {opts.class}"',(function(e){const t=this,s={0:"queue",1:"success",2:"deleted",3:"wrong_data",4:"error",10:"wait_payment"};this.sprite=flexbe.lib.getSprite("settings.domains","admin"),this.state={domain:e.domain,get errorMessage(){let e="";const t=this.status,s=this.domain.errors||[];if("error"===t){if(e=`<div class="tip-title">${tr("admin::domains::reg::error_tip")}</div>`,s.length){const t=s.map((e=>e.code)).join(", ");e+=`<div class="tip-text">${tr("admin::domains::reg::error_code_text",{code:t})}</div>`}}else"wrong_data"===t&&(e=`${tr("admin::domains::reg::wrong_data_tip")}`);return e},get allowEdit(){return"wrong_data"===this.status||"wait_payment"===this.status},get regId(){return this.domain.reg_id},get name(){return this.domain.reg_domain},get status(){return s[this.domain.reg_status]||"canceled"}},this.cancelRegistration=function(){As({props:{icon:`${this.sprite}#remove_domain_confirm`,title:tr("admin::domains::main::cancel_registration_confirm_title",{domain:t.state.name}),cancelButton:!0,onConfirm:()=>this.$store.dispatch("cancelDomainReg",t.state.regId),onDone:e=>{e&&(toast.success(tr("admin::domains::main::domain_reg_canceled_notify")),riot3.update())},onError:e=>{toast.error(e.message)}}})}.bind(this)})),riot3.tag2("element-domains-ssl-status",'<div data-is="flexbe-tooltip" content="{state.status.title || \'\'}"> <svg class="flexbe-icon size-12"> <use riot-xlink:href="{tag.sprite}#ssl_{tag.state.status.icon}"></use> </svg> </div>',"",'class="element-domains-ssl-status {opts.class}"',(function(e){const t=this;this.mixin("initMobx");const s={0:{icon:"off",title:tr("admin::domains::main::ssl_status_off_text")},1:{icon:"wait",title:tr("admin::domains::main::ssl_status_wait_text")},2:{icon:"wait",title:tr("admin::domains::main::ssl_status_wait_text")},3:{icon:"on",title:tr("admin::domains::main::ssl_status_on_text")},4:{icon:"error",title:tr("admin::domains::main::ssl_status_error")},9:{icon:"wait"}};this.sprite=flexbe.lib.getSprite("settings.domains","admin"),this.state={get status(){const e=t.props.domain||{},i=e.ssl||{},a=i.enabled;let n=i.status;a?3!=n||e.is_work||(n=9):n=0;return s[n]||s[4]||{}}}})),riot3.tag2("settings-section-domains-add",'<div data-is="settings-block-domains-search-field" class="group-item slide-down-animation"></div> <div data-is="settings-block-domains-search-results" class="group-item"></div>',"",'class="settings-section-domains-add group-list pb60 {opts.class}"',(function(e){this.onBeforeMount=function(){const e=this.$state?.search?.name,t=flexbe.routing.query&&flexbe.routing.query.domain_name,s=!t||t!=e;(!this.$state||e&&s)&&this.$store.commit("resetState")}.bind(this)})),riot3.tag2("settings-block-domains-search-field",'<div data-is="flexbe-input" class="search-field large shadow" placeholder="example.com" replace="{/[^a-z-\\-0-9.]*/gi}" maxlength="{254}" autofocus="{true}" riot-value="{state.search}" error="{!!state.error}" oninput="{setSearch}" onkeydown:enter="{checkDomain}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#search"></use> </svg> <div class="flexbe-input__addon"> <div class="flexbe-error" if="{tag.state.error}"> {tag.state.error} </div> <div class="flexbe-button small filled {tag.state.allowCheck ? \'is-primary\' : \'is-secondary\'} {loading: tag.state.loading}" disabled="{!tag.state.allowCheck}" onclick="{tag.checkDomain}"> <span class="flexbe-text"> {tr(\'admin::domains::add::check_button\')} </span> </div> </div> </div> <div class="flexbe-desc"> {tr(\'admin::domains::add::search_field_desc\')} </div>',"",'class="settings-block-domains-search-field {opts.class}"',(function(e){const t=this;this.sprite=at("settings.domains","admin"),this.state={get loading(){return t.$state.searchLoading},get domain(){return t.$state.search||{}},get allowCheck(){const e=this.domain.name;return!this.loading&&this.search&&this.search!==e},search:flexbe.routing.query.domain_name||"",error:!1},this.setSearch=function(e){this.state.search=e.target.value,this.state.error&&this.checkErrors()}.bind(this),this.checkErrors=function(){this.state.error=!1,this.state.search?er(this.state.search)||(this.state.error=tr("main::error::invalid_domain")):this.state.error=tr("main::error::fill_field")}.bind(this),this.checkDomain=async function(){if(this.checkErrors(),this.state.error||!this.state.allowCheck)return void this.update();const e=String(this.state.search).trim().replace(/^www\./,""),t=location.pathname,s=ye({..._e(location.search),domain_name:e},!0);let i;history.replaceState(history.state,"",`${t}?${s}`),this.$store.commit("resetState");try{i=await this.$store.dispatch("loadSearch",e)}catch(e){if("NetworkError"!==e.name)throw e;this.state.error=e.message,this.update()}if(i&&"domain"===i.type)try{await this.$store.dispatch("loadRecommends",e)}catch(e){"NetworkError"!==e.name&&console.error(e)}}.bind(this)})),riot3.tag2("settings-block-domains-search-results",'<div class="main-search"> <div if="{!state.searchLoading && state.searchAction}" data-is="settings-element-domains-add-item" class="slide-down-animation" domain="{state.search}"> </div> </div> <div class="recommends-list slide-down-animation mt40" if="{state.recommendsLoading}"> <div data-is="settings-element-domains-add-placeholder" each="{item in placeholders}"> </div> </div> <div class="recommends-list slide-down-animation mt40" if="{!state.recommendsLoading && state.recommends.length}"> <div class="flexbe-title text-subtitle"> {tr(\'admin::domains::add::other_zones_title\')} </div> <div data-is="settings-element-domains-add-item" each="{domain in state.recommends}" domain="{domain}"> </div> </div>',"",'class="settings-block-domains-search-results {opts.class}"',(function(e){const t=this;this.placeholders=new Array(5).fill(null),this.state={get searchAction(){return this.search.action},get searchLoading(){return t.$state.searchLoading},get recommendsLoading(){return t.$state.recommendsLoading},get search(){return t.$state.search||{}},get recommends(){return t.$state.recommends||[]}}})),riot3.tag2("settings-element-domains-add-item",'<div class="domain-name inline-box"> <span class="sub" if="{subName}">{subName}.</span> <span class="domain">{domainName}.</span> <span class="zone">{zoneName}</span> </div> <div class="domain-status"> <div class="flexbe-tag small is-light" if="{labelText}"> {labelText} </div> </div> <div class="domain-info" if="{isRegister}"> <div if="{!isFree}" class="domain-price" data-is="element-domains-domain-price" domain="{domain}"></div> <div if="{isFree}" class="domain-price is-free" data-is="flexbe-tooltip" content="{tr(\'admin::domains::main::ru_price_info_text\')}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.sprite}#gift"></use></svg> <span class="flexbe-text">{tr(\'admin::domains::main::free_text\')}</span> </div> </div> <div class="domain-info" if="{infoText}"> <div data-is="flexbe-tooltip" class="flexbe-desc" content="{infoTip}"> {tag.infoText} </div> </div> <div class="domain-action" if="{isRegister || isTransfer}"> <div if="{isRegister}" class="flexbe-button small filled is-primary {loading: checking}" onclick="{registerDomain}"> <span class="flexbe-text">{registerText}</span> </div> <div if="{isTransfer}" class="flexbe-button small filled is-secondary {loading: checking}" onclick="{transferDomain}"> <span class="flexbe-text">{transferText}</span> </div> </div>',"",'class="settings-element-domains-add-item flexbe-info-box {opts.class}"',(function(e){const t=this,s=e.domain;this.checking=!1,this.sprite=flexbe.lib.getSprite("settings.domains","admin"),this.domain=s,this.action=s.action,this.domainId=s.domain_id,this.domainType=s.type,this.fullName=s.name||"",this.subName=s.sub||"",this.zoneName=s.zone||"",this.domainName=this.subName?this.fullName.replace(new RegExp("^"+this.subName+"\\."),""):this.fullName,this.domainName=this.domainName.replace(new RegExp("\\."+this.zoneName+"$"),""),this.isRegister=!("register"!==this.action||!s.price.reg),this.isTransfer="transfer"===this.action,this.isError="error"===this.action,this.errorCode=this.isError&&s.error_code,this.transferCode=this.isTransfer&&s.transfer_code,this.isFree=this.isRegister&&s.price.is_free,this.registerText=tr("admin::domains::add::register_button"),this.transferText=tr("admin::domains::add::transfer_button"),this.labelText=!1,this.infoText=!1,this.infoTip=!1,this.isError?"reserved"===this.errorCode?this.labelText=tr("admin::domains::add::domain_reserved_label"):"requested"===this.errorCode?this.labelText=tr("admin::domains::add::is_requested"):"exist"===this.errorCode&&(this.labelText=tr("admin::domains::add::domain_exist_text")):this.isTransfer&&("flexbe_internal"===this.transferCode?this.labelText=tr("admin::domains::add::domain_flexbe_another_project_label"):"flexbe_external"===this.transferCode?this.labelText=tr("admin::domains::add::domain_flexbe_another_account_label"):"registered_domain"===this.transferCode?("domain"===this.domainType&&(this.labelText=tr("admin::domains::add::domain_reserved_label")),this.infoText=tr("admin::domains::add::domain_reserved_help"),this.infoTip=tr("admin::domains::add::domain_reserved_tip")):"not_registered_domain"===this.transferCode?(this.transferText=tr("admin::domains::add::add_button"),"domain"===this.domainType?(this.infoText=tr("admin::domains::add::transfer_register_help"),this.infoTip=tr("admin::domains::add::transfer_register_external_tip")):(this.infoText=tr("admin::domains::add::transfer_add_subdomain_help_text"),this.infoTip=tr("admin::domains::add::transfer_subdomain_domain_not_register_tip"))):"can_not_register"===this.transferCode&&(this.infoText=tr("admin::domains::add::transfer_register_help"),this.infoTip=tr("admin::domains::add::transfer_register_external_tip"),this.transferText=tr("admin::domains::add::add_button"))),this.registerDomain=async function(e){if(!flexbe.bill.isPaid)return As({props:{icon:`${t.sprite}#coins_big`,title:tr("admin::domains::add::pay_plan_modal_title"),confirmButtonText:tr("main::button::go_to_payment"),onConfirm:()=>{location.href="/admin/user/pay/"}},clickOut:!0}),e.preventDefault(),!1;try{this.checking=!0;if(!(await this.$store.api.checkRegAllowed(this.fullName)).data.is_reg_allowed)throw new Js("Register not allowed")}catch(e){return"NetworkError"===e.name?toast.error(e.message):console.error(e),this.checking=!1,this.update(),!1}flexbe.routing.go(`/admin/settings/domains/reg/?domain_name=${this.fullName}`)}.bind(this),this.transferDomain=async function(e){const s=async e=>{try{this.checking=!0;const t=await this.$store.api.transferDomain(e);if(!t.data.domain_id)throw new Js(tr("admin::domains::add::transfer_error_common_error"));flexbe.routing.go(`/admin/settings/domains/transfer_done/?domain_id=${t.data.domain_id}`)}catch(e){"NetworkError"===e.name?toast.error(e.message):console.error(e)}this.update({checking:!1})};if("not_registered_domain"===this.transferCode&&"subdomain"===this.domainType)As({clickOut:!0,props:{icon:`${t.sprite}#info_big`,title:tr("admin::domains::add::transfer_subdomain_domain_not_register_modal_title"),text:tr("admin::domains::add::transfer_subdomain_domain_not_register_modal_text"),cancelButton:!0,onConfirm:()=>s(t.fullName)}});else{if("flexbe_internal"===this.transferCode)return As({clickOut:!0,props:{icon:`${t.sprite}#transfer_big`,title:tr("admin::domains::add::flexbe_internal_transfer_modal_title",{domain:t.fullName}),text:tr("admin::domains::add::flexbe_internal_transfer_modal_text"),cancelButton:!0,onConfirm:async()=>{try{await this.$store.api.transferDomainInternal(this.domainId);toast.success(tr("admin::domains::add::transfer_success_notify_text")),flexbe.routing.go("/admin/settings/domains/")}catch(e){return"NetworkError"===e.name?toast.error(e.message):console.error(e),!1}return!0}}}),!1;if("flexbe_external"===this.transferCode)return As({props:{icon:`${t.sprite}#info_big`,title:tr("admin::domains::add::flexbe_external_transfer_modal_title"),text:tr("admin::domains::add::flexbe_external_transfer_modal_text"),confirmButtonText:tr("main::button::close"),cancelButton:!1},clickOut:!0}),!1;s(t.fullName)}}.bind(this)})),riot3.tag2("settings-element-domains-add-placeholder",'<div class="domain-name flexbe-placeholder rounded"></div> <div class="domain-info flexbe-placeholder rounded"></div> <div class="domain-action flexbe-placeholder rounded"></div>',"",'class="settings-element-domains-add-placeholder flexbe-info-box {opts.class}"',(function(e){})),riot3.tag2("settings-section-domains-reg",'<div class="found-errors flexbe-info-box" if="{state.commonErrors}"> <svg class="box-icon flexbe-icon size-16"> <use riot-xlink:href="{sprite}#error"></use> </svg> <div class="box-content flexbe-error"> <div class="flexbe-text"> {state.commonErrors} </div> </div> </div> <div class="group-content" if="{state.formType == \'ru\'}"> <div class="flexbe-title text-subtitle"> {tr(\'admin::domains::reg::form::payer_type_title\')} </div> <div class="flexbe-card-list cards-select gap-25"> <div class="flexbe-card-item w50" each="{item in types}"> <div class="flexbe-white-card shadow rounded {active: (item.type == state.type)}" onclick="{setType.bind(tag, item.type)}"> <span class="flexbe-check" if="{item.type == state.type}"></span> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#owner-type-{item.type}"></use> </svg> <span class="flexbe-text">{item.title}</span> </div> </div> </div> </div> <div class="group-content" each="{group in fields}" if="{group.show !== false}"> <div class="flexbe-title text-subtitle"> {group.title} </div> <div class="flexbe-white-box shadow flexbe-table"> <div class="tbody"> <div class="tr" each="{field in group.list}" if="{renderFields && field.show !== false}"> <div class="th"> <div class="flexbe-text text-dark"> {field.label} <q data-is="flexbe-tooltip" if="{field.desc}" content="{field.desc}"></q> </div> </div> <div class="td"> <div if="{field.type == \'select\'}" data-is="flexbe-select" class="transparent in-table" ref="{field.name}" name="{field.name}" riot-value="{field.value}" list="{field.list}" onchange="{field.onchange}"> </div> <div if="{field.type != \'select\'}" data-is="flexbe-input" class="transparent in-table" ref="{field.name}" name="{field.name}" type="{field.type}" placeholder="{field.placeholder}" normalize="{field.normalize}" mask="{field.mask}" mask-init="{field.maskInit}" suggestions="{field.suggestions}" riot-value="{field.value}" error="{!field.valid}" error-text="{field.error}" onkeyup:enter="{nextField.bind(tag, field)}" oninput="{field.onchange}" onchange="{field.onchange}"> </div> </div> </div> </div> </div> </div> <div class="group-content inline-box"> <div class="flexbe-button large filled rounded is-primary {loading: state.sending, shake-animation: animateError}" onclick="{submitForm}"> <span class="flexbe-text"> {tr(\'admin::domains::reg::form::register_button\')} </span> </div> <div class="price-desc ml20" if="{state.regPrice && !state.isPaid}"> <div class="flexbe-text">{tr(\'admin::domains::reg::form::price_year_label\')}</div> <div class="flexbe-desc">{tr(\'admin::domains::reg::form::price_year_text\', { price: state.regPriceText })}</div> </div> </div>',"",'class="settings-section-domains-reg group-list pb60 {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.sprite=flexbe.lib.getSprite("settings.domains","admin"),this.renderFields=!0,this.state={formType:"default",get fieldErrors(){return t.$getters.errors},get commonErrors(){const e=t.$getters.errorsNotInField.map((e=>e.code)).filter((e=>!!e)),s=e.length,i=e.join(", ");return!!s&&tr("admin::domains::reg::error_list",{count:s,list:i})},get domain(){return t.$state.domain},get type(){return t.$getters.user.type},get isPaid(){return t.$getters.isPaid},get regPrice(){return!this.domain.is_free&&this.domain.price.reg||0},get regPriceText(){return this.domain.price.reg_text},get countries(){return t.$state.countries}},this.types=[{type:1,title:tr("admin::domains::reg::form::payer_person_label")},{type:2,title:tr("admin::domains::reg::form::payer_company_label")}],["ru","su",""].includes(this.state.domain.zone_name)&&(this.state.formType="ru"),this.init=function(){const e=(e,s)=>{const i=this.state.fieldErrors[e],a=vt({initialError:i&&i.text,validators:[Ul.required,Ul.mask],get value(){return t.$store.helpers.getField(e)},set value(s){t.$store.commit("setField",e,s)}},s);return new Hl(e,a)},s=(e="")=>String(e).split(" ").map((e=>e.split("").map(((e,t)=>t?e.toLowerCase():e.toUpperCase())).join(""))).join(" "),i=e=>{const s=e.data,{inn:i,kpp:o,name:l,management:d}=s,h=s.address&&s.address.data||{};if(i&&u.setValue(i),o&&m.setValue(o),l&&l.short_with_opf&&c.setValue(l.short_with_opf),l&&l.latin&&p.setValue(l.latin),h.postal_code&&w.setValue(h.postal_code),""===h.country&&y.setValue("RU"),h.city_with_type&&_.setValue(h.city_with_type),h.street_with_type){const e=[h.street_with_type,[h.house_type,h.house].filter((e=>e)).join(" "),[h.flat_type,h.flat].filter((e=>e)).join(" ")].filter((e=>e)).join(", ");T.setValue(e)}if(d&&d.name){const[e,t,s]=d.name.split(" ");t&&a.setValue(t),e&&n.setValue(e),s&&r.setValue(s)}t.update()},a=e("fio_firstname",{label:tr("admin::domains::reg::form::field_firstname_label"),placeholder:tr("admin::domains::reg::form::field_firstname_placeholder"),mask:Pl.anyName,normalize:e=>s(e),afterSet({newValue:e}){o.inputed||o.setValue(or(e))}}),n=e("fio_lastname",{label:tr("admin::domains::reg::form::field_lastname_label"),placeholder:tr("admin::domains::reg::form::field_lastname_placeholder"),mask:Pl.anyName,normalize:e=>s(e),afterSet({newValue:e}){l.inputed||l.setValue(or(e))}}),r=e("fio_secondname",{label:tr("admin::domains::reg::form::field_middlename_label"),placeholder:tr("admin::domains::reg::form::field_middlename_placeholder"),mask:Pl.anyName,normalize:e=>s(e),afterSet({newValue:e}){if(!d.inputed){const t=or(e);t[0]&&d.setValue(t[0])}}}),o=e("fio_eng_firstname",{label:tr("admin::domains::reg::form::field_firstname_label"),desc:tr("admin::domains::reg::form::field_en_desc"),placeholder:tr("admin::domains::reg::form::field_firstname_en_placeholder"),mask:Pl.anyName,normalize:e=>(e=s(e),e=or(e))}),l=e("fio_eng_lastname",{label:tr("admin::domains::reg::form::field_lastname_label"),desc:tr("admin::domains::reg::form::field_en_desc"),placeholder:tr("admin::domains::reg::form::field_lastname_en_placeholder"),mask:Pl.anyName,normalize:e=>(e=s(e),e=or(e))}),d=e("fio_eng_secondname",{label:tr("admin::domains::reg::form::field_middlename_label"),placeholder:tr("admin::domains::reg::form::field_middlename_en_placeholder"),desc:tr("admin::domains::reg::form_field_middlename_desc"),mask:Pl.anyName,normalize:e=>(e=s(e),(e=or(e))&&e[0]||"")}),c=e("company_name_ru",{label:tr("admin::domains::reg::form::field_company_ru_label"),placeholder:tr("admin::domains::reg::form::field_company_ru_placeholder"),normalize:e=>e.replace(/"/g,"'"),get suggestions(){return"RU"==y.value&&{type:"PARTY",onSelect:i}},afterSet({newValue:e}){if(!p.inputed){const t=or(e);p.setValue(t)}}}),p=e("company_name",{label:tr("admin::domains::reg::form::field_company_label"),desc:tr("admin::domains::reg::form::field_en_desc"),placeholder:tr("admin::domains::reg::form::field_company_placeholder"),get validators(){return"ru"===t.state.formType?[Ul.required,Ul.mask]:[]},normalize:e=>(e=e.replace(/"/g,"'"),or(e||""))}),u=e("company_inn",{get show(){return"RU"==y.value},label:tr("admin::domains::reg::form::field_company_inn_label"),placeholder:"1234567890",get validators(){return"RU"===y.value?[Ul.required,Ul.inn]:[]},get mask(){return"RU"===y.value?Pl.ruInn:null},get suggestions(){return"RU"===y.value&&{type:"PARTY",minChars:10,formatSelected:e=>e.data.inn||"",onSelect:i}}}),m=e("company_kpp",{get show(){return"RU"==y.value},label:tr("admin::domains::reg::form::field_company_kpp_label"),placeholder:"123456789",validators:[Ul.ruKpp],mask:Pl.ruKpp}),h=e("birthday",{label:tr("admin::domains::reg::form::field_birthday_label"),placeholder:"05.09.1993",mask:{mask:Date,min:new Date(1920,0,1),max:new Date}}),g=[tr("admin::domains::reg::form::field_passport_number_label"),tr("admin::domains::reg::form::field_kz_id_label")],v=["1234 123456","123456789000 / N12345678"],f=e("passport_number",{get label(){return"KZ"===y.value?g[1]:g[0]},get placeholder(){return"KZ"===y.value?v[1]:v[0]},get validators(){return"KZ"===y.value?[Ul.required,Ul.kzID]:null},get mask(){return"RU"==y.value?Pl.ruPassport:null}}),x=e("passport_date",{label:tr("admin::domains::reg::form::field_passport_date_label"),placeholder:"15.10.2010",mask:{mask:Date,min:new Date(1920,0,1),max:new Date}}),b=e("passport_issued",{label:tr("admin::domains::reg::form::field_passport_issue_label"),placeholder:tr("admin::domains::reg::form::field_passport_issue_placeholder")}),y=e("country",{label:tr("admin::domains::reg::form::field_country_label"),placeholder:tr("admin::domains::reg::form::field_country_placeholder"),type:"select",list:t.state.countries,get name(){const e=this.list.find((e=>e.value==this.value));return e?e.title:""},afterSet(){t.update({renderFields:!1}),t.update({renderFields:!0})}}),_=e("address_city",{label:tr("admin::domains::reg::form::field_city_label"),placeholder:tr("admin::domains::reg::form::field_city_placeholder"),normalize:e=>e.replace(/[(){}\[\]]/g,"")}),T=e("address_street",{label:tr("admin::domains::reg::form::field_street_label"),placeholder:tr("admin::domains::reg::form::field_street_placeholder")}),w=e("address_zip",{label:tr("admin::domains::reg::form::field_zip_label"),placeholder:tr("admin::domains::reg::form::field_zip_placeholder"),get mask(){return"RU"==y.value?Pl.ruZip:Pl.zip}}),k=e("email",{label:tr("main::label::email"),placeholder:tr("admin::domains::reg::form::field_email_placeholder"),validators:[Ul.email],mask:Pl.email}),A=e("phone",{label:tr("main::label::phone_number"),placeholder:tr("admin::domains::reg::form::phone_placeholder"),mask:Pl.phone});this.fields=[{title:tr("admin::domains::reg::form::personal_data_title"),list:[p,o,l]},{title:tr("admin::domains::reg::form::adress_title"),list:[T,_,y,w]},{title:tr("admin::domains::reg::form::contacts_title"),list:[k,A]}],"ru"===this.state.formType&&(this.fields=[{get show(){return 1==t.state.type},title:tr("admin::domains::reg::form::personal_data_title"),list:[n,a,r,h,y,f,x,b]},{get show(){return 2==t.state.type},title:tr("admin::domains::reg::form::company_data_title"),list:[c,p,u,m,y,w,_,T]},{get show(){return 1==t.state.type},title:tr("admin::domains::reg::form::adress_title"),list:[w,_,T]},{title:tr("admin::domains::reg::form::contacts_title"),list:[l,o,d,k,A]}])}.bind(this),this.setType=function(e){this.resetErrors(),sessionStorage.setItem("domain_reg.type",e),this.$store.commit("setField","type",e)}.bind(this),this.nextField=function(e){if(e.validate("change")){const t=this.getFields(),s=t.indexOf(e),i=t[s+1];i&&this.refs[i.name]?this.refs[i.name].focus():s==t.length-1&&this.submitForm()}this.update()}.bind(this),this.validateAll=function(){return this.getFields().map((e=>e.validate("submit"))).every((e=>e))}.bind(this),this.resetErrors=function(){this.getFields(!0).forEach((e=>{e.error=!1})),this.update()}.bind(this),this.getFields=function(e=!1){let t=this.fields.filter((e=>!1!==e.show)).reduce(((e,t)=>[...e,...t.list]),[]);return e||(t=t.filter((e=>!1!==e.show))),t}.bind(this),this.submitForm=async function(){if(this.validateAll()){try{this.state.sending=!0;const e=await this.$store.api.registerDomain();if(e.data.action){let t=null;switch(e.data.action){case"pay":t=`/admin/user/pay/domain/?domain_reg_id=${e.data.reg_id}`;break;case"done":t=`/admin/settings/domains/reg_done/?domain_id=${e.data.domain_id}`}t&&(window.location=t)}}catch(e){"NetworkError"===e.name?toast.error(e.message):console.error(e)}this.state.sending=!1,this.update()}else this.update({animateError:!1}),setTimeout((()=>{this.update({animateError:!0});const e=this.root.querySelector('.flexbe-input[error="true"] input');e&&e.focus()}),50)}.bind(this),this.on("before-mount",this.init)})),riot3.tag2("settings-section-domains-reg-done",'<div class="flexbe-white-box shadow is-card"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{sprite}#done_big"></use> </svg> <div class="flexbe-text mt20"> {tr(\'admin::domains::reg_done::box_title\')} </div> <div class="flexbe-desc mt10"> {tr(\'admin::domains::main::domain_will_be_available_text\')} </div> <a href="/admin/settings/domains/" class="flexbe-button large rounded filled is-primary mt20"> <span class="flexbe-text">{tr(\'admin::domains::back_to_domains_button\')}</span> </a> </div>',"",'class="settings-section-domains-reg-done pb60 {opts.class}"',(function(e){this.sprite=flexbe.lib.getSprite("settings.domains","admin")})),riot3.tag2("settings-section-domains-transfer-done",'<div class="flexbe-white-box shadow content-ui px25 py20" if="{state.instructionType === \'dns_list\'}"> <p class="text"> {tr(\'admin::domains::transfer_done::change_dns_title\', {                 domain: state.domainName             })} </p> <table> <tr each="{ns, index in state.nsList}"> <th>NS{index + 1}</th> <td>{ns}</td> </tr> </table> <div class="note" data-is="raw" content="{tr(\'admin::domains::transfer_done::change_dns_note\')}"></div> </div> <div class="flexbe-white-box shadow content-ui px25 py20" if="{state.instructionType === \'cname\'}"> <p class="text"> {tr(\'admin::domains::transfer_done::change_cname_title\', {                 sub: state.subName,                 domain: state.domainName             })} </p> <table> <thead> <tr> <th> <span>{tr(\'admin::domains::transfer_done::entry_name_title\')}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::domains::transfer_done::entry_name_tip\', {                             sub: state.subName,                             domain: state.domainName                         })}"></q> </th> <th> <span>{tr(\'admin::domains::transfer_done::entry_type_title\')}</span> </th> <th> <span>{tr(\'admin::domains::transfer_done::entry_value_title\')}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::domains::transfer_done::entry_value_tip\')}"></q> </th> </tr> </thead> <tbody> <tr> <td>{state.subName}</td> <td>CNAME</td> <td> <span class="text">{state.cnameServer}. </span> <span class="note">{tr(\'admin::domains::transfer_done::cname_value_tip\')}</span> </td> </tr> </tbody> </table> <div class="note" data-is="raw" content="{tr(\'admin::domains::transfer_done::change_cname_note\')}"></div> </div> <div class="flexbe-white-box shadow is-card" if="{state.instructionType === \'success\'}"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{sprite}#done_big"></use> </svg> <div class="flexbe-text mt20"> {tr(\'admin::domains::transfer_done::success_title\')} </div> <div class="flexbe-desc mt10"> {tr(\'admin::domains::main::domain_will_be_available_text\')} </div> <a href="/admin/settings/domains/" class="flexbe-button large rounded filled is-primary mt20"> <span class="flexbe-text">{tr(\'admin::domains::back_to_domains_button\')}</span> </a> </div> <a href="/admin/settings/domains/" class="flexbe-button large rounded filled is-primary mt30" if="{state.instructionType !== \'success\'}"> <span class="flexbe-text">{tr(\'admin::domains::back_to_domains_button\')}</span> </a> <div class="flexbe-info-box mt30" if="{state.instructionType !== \'success\'}"> <img class="box-icon" width="36" height="36" src="/_s/images/emoji/support_girl.png"> <div class="box-content" data-is="raw" content="{tr(\'admin::domains::transfer_done::domain_setup_help_text\')}" onclick="{clickHandler}"></div> </div>',"",'class="settings-section-domains-transfer-done pb60 {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.sprite=flexbe.lib.getSprite("settings.domains","admin"),this.clickHandler=function(e){e.target.closest('[data-command="support"]')&&flexbe.support.toggleChat(!0)}.bind(this),this.state={get instructionType(){return this.domain.instruction||"success"},get domain(){return t.$state.domain},get subName(){return this.domain.sub_name},get domainName(){return this.domain.full_name},get nsList(){return h(this.domain.dns_list)},get cnameServer(){return this.domain.cname_server}}}));const Fd={css:null,exports:null,template:(e,t,s,i)=>e('<div class="group-list slide-down-animation"><div expr820="expr820" is="proxy" data-is="settings-block-favicon" class="group-content"></div><div expr821="expr821" is="proxy" data-is="settings-block-localization" class="group-content"></div><div expr822="expr822" is="proxy" data-is="settings-block-animation" class="group-content"></div><div expr823="expr823" is="proxy" data-is="settings-block-adaptive" class="group-content"></div><div expr824="expr824" is="proxy" data-is="settings-block-antispam" class="group-content"></div><div expr825="expr825" is="settings-block-draft" class="group-content"></div><div expr826="expr826" is="settings-block-access" class="group-content"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-section-general pb60 ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[],redundantAttribute:"expr820",selector:"[expr820]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[],redundantAttribute:"expr821",selector:"[expr821]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[],redundantAttribute:"expr822",selector:"[expr822]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[],redundantAttribute:"expr823",selector:"[expr823]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[],redundantAttribute:"expr824",selector:"[expr824]"},{type:s.TAG,getComponent:i,evaluate:e=>"settings-block-draft",slots:[],attributes:[],redundantAttribute:"expr825",selector:"[expr825]"},{type:s.TAG,getComponent:i,evaluate:e=>"settings-block-access",slots:[],attributes:[],redundantAttribute:"expr826",selector:"[expr826]"}]),name:"settings-section-general"};e(Fd.name,Fd);const Ld={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={isDraft:1==flexbe.vars.group.is_draft,role:flexbe.vars.user.role,status:"saved",projectStore:adminStore.getModule("projects"),get isDisabled(){return!this.projectStore.state.accessConfig[this.role].includes("draft")},get projectId(){return+flexbe.vars.group.id}},this.meta={sprite:`${at("settings","admin")}1`},this.watch={"state.status":[()=>this.update(),{delay:10}],"state.loading":[()=>this.update(),{delay:10}],"state.isDraft":[()=>this.update(),{delay:10}]}},async toggleDraft(e){if(e!==this.state.isDraft){this.state.isDraft=e,this.state.status="saving";try{await this.state.projectStore.api.toggleDraft({projectId:this.state.projectId,isDraft:e}),this.state.status="success"}catch(e){if(this.state.status="error",this.syncIsDraft(),"NetworkError"===e.name)toast.error(e.message);else if(e.response&&409===e.response.status){var t;"project_limit"===(null==(t=e.response.responseJSON)?void 0:t.type_error)&&flexbe.modals.bill.selectPublicSites({limit:flexbe.bill.domainLimit,selectedProjectIds:[this.state.projectId],selectAllPublised:!0,onChange:async e=>{this.state.status="saving",e.includes(this.state.projectId)&&(this.state.isDraft=!1),this.state.status="success"}})}else console.error(e)}this.update()}},syncIsDraft(){this.state.isDraft=flexbe.vars.group.is_draft}},template:(e,t,s,i)=>e('<div class="inline-box between"><div class="flexbe-title text-subtitle inline-box"><span expr809="expr809" class="flexbe-text"> </span><q expr810="expr810" is="flexbe-tooltip"></q></div><div expr811="expr811" is="proxy" data-is="admin-save-text" class="flexbe-desc"></div></div><div class="status-crads-list inline-box"><div expr812="expr812"><img class="lock-preview" src="/_s/images/admin/settings/general/image/public-project.png" alt/><div expr813="expr813" class="flexbe-title mt20"> </div><div expr814="expr814" class="flexbe-desc text-center"> </div><svg expr815="expr815" is="flexbe-icon" icon="icon-check"></svg></div><div expr816="expr816"><img class="lock-preview" src="/_s/images/admin/settings/general/image/draft-project.png" alt/><div expr817="expr817" class="flexbe-title mt20"> </div><div expr818="expr818" class="flexbe-desc text-center"> </div><svg expr819="expr819" is="flexbe-icon" icon="icon-check"></svg></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-block-draft ",e.props.class," ",e.classNames({disabled:e.state.isDisabled})].join("")}]},{redundantAttribute:"expr809",selector:"[expr809]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::site_status::title")].join("")}]},{type:s.IF,evaluate:e=>e.state.isDisabled,redundantAttribute:"expr810",selector:"[expr810]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::settings::site_status::unavailable_tip",{role:e.tr(`admin::members::roles::${e.state.role}_title`)})}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"status",evaluate:e=>e.state.status}],redundantAttribute:"expr811",selector:"[expr811]"},{redundantAttribute:"expr812",selector:"[expr812]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-white-box shadow ",e.classNames({active:!e.state.isDraft})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.toggleDraft(!1)}]},{redundantAttribute:"expr813",selector:"[expr813]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::site_status::publised::title")}]},{redundantAttribute:"expr814",selector:"[expr814]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::site_status::publised::desc")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr815",selector:"[expr815]"},{redundantAttribute:"expr816",selector:"[expr816]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-white-box shadow ",e.classNames({active:e.state.isDraft})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.toggleDraft(!0)}]},{redundantAttribute:"expr817",selector:"[expr817]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::site_status::draft::title")}]},{redundantAttribute:"expr818",selector:"[expr818]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::site_status::draft::desc")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"size",evaluate:e=>18}],redundantAttribute:"expr819",selector:"[expr819]"}]),name:"settings-block-draft"};e(Ld.name,Ld);const Nd={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={get accessCode(){return flexbe.vars.group.s_id}},this.meta={}}},template:(e,t,s,i)=>e('<div class="flexbe-title text-subtitle inline-box"><span expr827="expr827" class="flexbe-text"> </span></div><div class="flexbe-white-box shadow inline-box between"><div class="settings-block-access__code inline-box"><div expr828="expr828" class="flexbe-text text-xl text-medium"> </div><div expr829="expr829" is="proxy" data-is="flexbe-button-copy" copy-class="style-text" done-class="style-text"></div></div><div expr830="expr830" class="flexbe-desc"> </div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-block-access ",e.props.class].join("")}]},{redundantAttribute:"expr827",selector:"[expr827]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::access::title")}]},{redundantAttribute:"expr828",selector:"[expr828]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.accessCode}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"show-text",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.accessCode}],redundantAttribute:"expr829",selector:"[expr829]"},{redundantAttribute:"expr830",selector:"[expr830]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::access::desc")].join("")}]}]),name:"settings-block-access"};e(Nd.name,Nd),riot3.tag2("settings-block-adaptive",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::responsive::title\')}</span> <span data-is="admin-save-text" class="flexbe-desc" status="{status}"></span> </div> <div class="flexbe-white-box shadow inline-box"> <img class="adaptive-preview" src="/_s/images/admin/settings/general/adaptive.png" alt=""> <div class="policy-inner"> <label data-is="flexbe-input" class="large" type="toggle" checked="{$state.is_adaptive}" onchange="{toggleAdaptive}"> <span>{tr(\'admin::settings::responsive::enable_label\')}</span> </label> </div> </div> <div class="flexbe-desc mt20"> {tr(\'admin::settings::responsive::desc\')} </div>',"",'class="settings-block-adaptive {opts.class}"',(function(e){this.status="saved",this.toggleAdaptive=async function(e){const t=e.target.checked;this.update({status:"saving"});try{await this.$store.dispatch("toggleAdaptive",t),this.update({status:"success"})}catch(e){this.update({status:"error"}),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this)})),riot3.tag2("settings-block-antispam",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::antispam::title\')}</span> <span data-is="admin-save-text" class="flexbe-desc" status="{state.status}"></span> </div> <div class="flexbe-white-box shadow block collection"> <div class="collection-item"> <label data-is="flexbe-input" checked="{state.isEnabled}" class="large" onchange="{toggleAntispam}" type="toggle"> <span>{tr(\'admin::settings::captcha_toggle\')}</span> </label> </div> <div if="{state.isEnabled}" class="collection-item block fade-in-animation"> <div class="flexbe-title mb15"> {tr(\'admin::settings::captcha_visibility_label\')} </div> <div class="flexbe-field-group"> <label data-is="flexbe-input" checked="{!state.isVisible}" class="large" onchange="{setVisibility.bind(this, 0)}" type="radio"> <span>{tr(\'admin::settings::captcha_visibility::invisible_option\')}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::settings::captcha_visibility::invisible_option_tip\')}"></q> </label> <label data-is="flexbe-input" checked="{state.isVisible}" class="large" onchange="{setVisibility.bind(this, 1)}" type="radio"> <span>{tr(\'admin::settings::captcha_visibility::visible_option\')}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::settings::captcha_visibility::visible_option_tip\')}"></q> </label> </div> </div> <div if="{state.isEnabled}" class="collection-item block fade-in-animation"> <div class="flexbe-title mb15"> {tr(\'admin::settings::captcha_ttl_label\')} </div> <div class="flexbe-field-group"> <label data-is="flexbe-input" checked="{!state.ttl}" class="large" onchange="{toggleTTL.bind(this, 0)}" type="radio"> <span>{tr(\'admin::settings::captcha_ttl_off_option\')}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::settings::captcha_ttl_off_option_tip\')}"></q> </label> <label data-is="flexbe-input" checked="{state.ttl}" class="large" onchange="{toggleTTL.bind(this)}" type="radio"> <span>{tr(\'admin::settings::captcha_ttl_on_option\')}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::settings::captcha_ttl_on_option_tip\')}"></q> </label> </div> <div class="row" if="{state.ttl}"> <div class="col col-6"> <div class="flexbe-desc mb10"> {tr(\'admin::settings::captcha_ttl_interval_label\')} </div> <div data-is="flexbe-select" list="{meta.intervals}" initial-value="{state.ttl}" onchange="{setTTL}"></div> </div> </div> </div> <div class="collection-item fade-in-animation" if="{state.isEnabled && !state.isVisible}"> <label data-is="flexbe-input" checked="{state.isPolicyShow}" class="large" onchange="{togglePolicy}" type="toggle"> <span>{tr(\'admin::settings::captcha_policy::enable_label\')}</span> <q data-is="flexbe-tooltip" interactive="{true}" content="{tr(\'admin::settings::captcha_policy::ru_note\')}"></q> </label> </div> <div class="collection-footer collection-item shade"> <span class="flexbe-desc"> {tr(\'admin::settings::captcha_helper\')} </span> </div> </div>',"",'class="settings-block-antispam {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={status:"saved",get flood(){return t.$state.flood||{}},get captcha(){return this.flood.captcha||{}},get policyData(){return this.captcha.policy||{}},get isEnabled(){return this.captcha.enabled||0},get isVisible(){return this.captcha.visible||0},get isPolicyShow(){return this.policyData.show||0},get ttl(){return this.captcha.ttl||0}},this.meta={intervals:[{title:tr("main::time::minutes",5),value:300},{title:tr("main::time::minutes",15),value:900},{title:tr("main::time::minutes",30),value:1800},{title:tr("main::time::hours",1),value:3600},{title:tr("main::time::hours",3),value:10800},{title:tr("main::time::hours",12),value:43200},{title:tr("main::time::hours",24),value:86400}],lastTTLValue:t.state.ttl||300},this.toggleAntispam=async function(e){const t=e.target.checked;this.state.status="saving",this.update();try{await this.$store.dispatch("setAntispam",{...this.state.captcha,enabled:t}),this.state.status="success",this.update()}catch(e){this.state.status="error",this.update(),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.setVisibility=async function(e){this.state.status="saving",this.update();try{await this.$store.dispatch("setAntispam",{...this.state.captcha,visible:e}),this.state.status="success",this.update()}catch(e){this.state.status="error",this.update(),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.toggleTTL=async function(e){this.state.status="saving",this.update(),0!==e&&(e=this.meta.lastTTLValue);try{await this.$store.dispatch("setAntispam",{...this.state.captcha,ttl:e}),this.state.status="success",this.update()}catch(e){this.state.status="error",this.update(),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.setTTL=async function(e){const t=e.value;this.state.status="saving",this.meta.lastTTLValue=t,this.update();try{await this.$store.dispatch("setAntispam",{...this.state.captcha,ttl:t}),this.state.status="success",this.update()}catch(e){this.state.status="error",this.update(),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.togglePolicy=async function(e){const t=e.target.checked?1:0;this.state.status="saving";try{await this.$store.dispatch("updateCaptchaPolicyData",{...this.state.policyData,show:t}),this.state.status="success"}catch(e){this.state.status="error","NetworkError"===e.name?toast.error(e.message):console.error(e)}this.update()}.bind(this)})),riot3.tag2("settings-block-favicon",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::favicon::title\')}</span> </div> <div class="flexbe-white-box shadow inline-box drop-zone-target"> <div class="flexbe-button filled small is-secondary mr10 favicon-preview"> <img if="{!state.icon}" class="flexbe-icon size-16" src="/_s/images/favicon.png"> <img if="{state.icon}" class="flexbe-icon size-16" riot-src="{state.icon}"> <div if="{state.icon}" class="delete-favicon" onclick="{deleteFavicon}"></div> </div> <div data-is="flexbe-button-upload" class="upload-favicon size-small" regular-class="is-secondary" common-class="small filled" url="{url}" file-type="image" accept="image/png,image/svg+xml" show-icon="{false}" drop-zone=".drop-zone-target" onupload="{onUploadDone}" onerror="{onUploadError}"> </div> <div class="size-helper flexbe-desc"> <svg class="flexbe-icon size-16"> <use xlink:href="/_s/images/editor/editor_media.svg?1#recomend_size"></use> </svg> <span class="flexbe-text">{tr(\'admin::settings::favicon::format_note\')}</span> </div> </div>',"",'class="settings-block-favicon {opts.class}"',(function(e){const t=this;this.url=`/admin/api/project/${flexbe.vars.group.id}/settings/favicon/upload/`,this.state={get icon(){const e=t.$state.favicon;return"string"==typeof e?e:pt(e,192)}},this.deleteFavicon=function(){this.$store.dispatch("deleteFavicon")}.bind(this),this.onUploadDone=function(e,t){t?.data?.seo_favicon&&this.$store.commit("setFavicon",t.data.seo_favicon)}.bind(this),this.onUploadError=function(e,t){t.data?.errorMessage&&toast.error(t.data.errorMessage)}.bind(this)})),riot3.tag2("settings-block-localization",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::localization::title\')}</span> <span data-is="admin-save-text" class="flexbe-desc" status="{status}"></span> </div> <div class="flexbe-table flexbe-white-box shadow overflow" if="{!hideUi}"> <div class="tbody"> <div class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'main::label::language\')} <q data-is="flexbe-tooltip">{tr(\'admin::settings::localization::language_tip\')}</q> </span> </div> <div class="td"> <div data-is="flexbe-select" list="{meta.languages}" initial-value="{state.language}" onchange="{setLang}" class="transparent in-table"></div> </div> </div> <div class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'main::label::country\')} <q data-is="flexbe-tooltip">{tr(\'admin::settings::localization::country_tip\')}</q> </span> </div> <div class="td"> <div data-is="flexbe-select" list="{meta.countries}" initial-value="{state.country}" onchange="{setCountry}" class="transparent in-table"></div> </div> </div> <div class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'main::label::timezone\')} <q data-is="flexbe-tooltip">{tr(\'admin::settings::localization::timezone_tip\')}</q> </span> </div> <div class="td"> <div data-is="flexbe-select" list="{meta.timezones}" initial-value="{state.timezone}" onchange="{setTimeZone}" class="transparent in-table"></div> </div> </div> <div class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'main::label::currency\')} <q data-is="flexbe-tooltip">{tr(\'admin::settings::localization::currency_tip\')}</q> </span> </div> <div class="td"> <div data-is="flexbe-select" list="{meta.currencies}" initial-value="{state.currencyCode}" onchange="{setCurrencyCode}" class="transparent in-table"></div> </div> </div> <div class="tr"> <div class="th"> <span class="flexbe-text">{tr(\'admin::settings::localization::currency_symbol_label\')}</span> </div> <div class="td" if="{meta.symbols.length > 1}"> <div data-is="flexbe-buttons-line" class="is-group view-types currency-symbols ml-10" button-class="small" list="{meta.symbols}" riot-value="{state.currencySymbol}" onchange="{setCurrencySymbol}" role="selector"> </div> </div> <div class="td" if="{meta.symbols.length <= 1}"> <span class="flexbe-text">{meta.symbols[0]}</span> </div> </div> </div> </div>',"",'class="settings-block-localization {opts.class}"',(function(e){const t=this;this.status="saved",this.state={get currencyCode(){return flexbe.vars.group.currency.code},get currencySymbol(){return flexbe.vars.group.currency.symbol},get language(){return flexbe.vars.group.lang},get country(){return flexbe.vars.group.country},get timezone(){return flexbe.vars.group.timezone||"Europe/Moscow"}},this.meta={get languages(){return t.$meta.languages},get countries(){return t.$meta.countries},get currencies(){return t.$meta.currencies},get timezones(){return t.$meta.timezones},symbols:[]},this.updateSymbolsList=function(e=this.state.currencyCode){const s=function(e){const s=t.meta.currencies.find((t=>t.value===e));if(s)return Array.isArray(s.symbol)?s.symbol:[s.symbol];return null}(e);s&&(this.meta.symbols=s)}.bind(this),this.redrawUI=function(){this.update({hideUi:!0}),this.update({hideUi:!1})}.bind(this),this.setLang=async function(e){this.update({status:"saving"});try{await this.$store.dispatch("setLocale",{language:e.value}),this.update({status:"success"})}catch(e){this.update({status:"error"}),this.redrawUI(),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.setCountry=async function(e){this.update({status:"saving"});try{await this.$store.dispatch("setLocale",{country:e.value}),this.update({status:"success"})}catch(e){this.update({status:"error"}),this.redrawUI(),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.setTimeZone=async function(e){this.update({status:"saving"});try{await this.$store.dispatch("setLocale",{timezone:e.value}),this.update({status:"success"})}catch(e){this.update({status:"error"}),this.redrawUI(),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.setCurrencyCode=async function(e){this.updateSymbolsList(e.value),this.update({status:"saving"});try{await this.$store.dispatch("setCurrency",{code:e.value,symbol:this.meta.symbols[0]}),this.update({status:"success"})}catch(e){this.update({status:"error"}),this.updateSymbolsList(),this.redrawUI(),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.setCurrencySymbol=async function(e){this.update({status:"saving"});try{await this.$store.dispatch("setCurrency",{symbol:e.value}),this.update({status:"success"})}catch(e){this.update({status:"error"}),this.redrawUI(),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.on("before-mount",(()=>{this.updateSymbolsList()}))})),riot3.tag2("settings-block-animation",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::animate::title\')}</span> <span data-is="admin-save-text" class="flexbe-desc" status="{state.status}"></span> </div> <div class="flexbe-white-box shadow collection"> <div class="collection-item"> <label data-is="flexbe-input" checked="{state.smoothingScrollEnabled}" class="large" onchange="{toggleSmoothingScroll}" type="toggle"> <span>{tr(\'admin::settings::smoothing_scroll::title\')}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::settings::smoothing_scroll::tip\')}"></q> </label> </div> <div class="collection-item block"> <div class="flexbe-title mb20">{tr(\'admin::settings::animate_block::title\')}</div> <div class="media-select"> <div each="{card in cards}" key="{card.style}" class="media-select__item {check: state.style === card.style}" onmouseenter="{togglePlay}" onmouseleave="{togglePlay}" onclick="{toggleStyle}"> <div class="media-select__preview {played: card.played}"> <img class="poster" riot-src="{card.poster}"> <video class="video" if="{card.played}" autoplay="autoplay" muted="muted" pip="false" disablepictureinpicture disableremoteplayback loop> <source riot-src="{card.video}" type="video/mp4"> </video> </div> <div class="media-select__text-wrap"> <svg class="flexbe-icon size-16 media-select__svg"> <use riot-xlink:href="{sprite}1#icon-check"></use> </svg> <span class="flexbe-text text-note font-ui media-select__text">{card.description}</span> </div> </div> </div> </div> <div class="collection-footer collection-item shade"> <div class="flexbe-desc" data-is="raw" content="{tr(\'admin::settings::animate_block::note\')}"></div> </div> </div>',"",'class="settings-block-animation {opts.class}"',(function(e){const t=this;this.sprite=at("settings","admin"),this.state={status:"saved",get blockAnimationData(){return t.$state.block_animation||{}},get smootingScrollData(){return t.$state.smoothing_scroll||{}},get smoothingScrollEnabled(){return this.smootingScrollData.enabled??!1},get style(){return this.blockAnimationData.show?this.blockAnimationData.style??"default":"default"},get show(){return this.blockAnimationData.show??!1}},this.cards=[{video:"/_s/images/admin/settings/general/animations/off.mp4",poster:"/_s/images/admin/settings/general/animations/off.png",description:tr("admin::settings::animate_block::descr::style_off"),style:"default",show:0},{video:"/_s/images/admin/settings/general/animations/fade_in.mp4",poster:"/_s/images/admin/settings/general/animations/fade_in.png",description:tr("admin::settings::animate_block::descr::style_fade_in"),style:"fade_in",show:1},{video:"/_s/images/admin/settings/general/animations/slide_up.mp4",poster:"/_s/images/admin/settings/general/animations/slide_up.png",description:tr("admin::settings::animate_block::descr::style_slide_up"),style:"slide_up",show:1}],this.togglePlay=function(e){const t=e.item.card,s="mouseenter"===e.type;t.played=s,this.update()}.bind(this),this.toggleSmoothingScroll=async function(e){const{checked:t}=e.target;this.state.status="saving";try{await this.$store.dispatch("updateSmoothingScroll",{enabled:t?1:0}),this.state.status="success",this.update()}catch(e){this.state.status="error","NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.toggleStyle=async function(e){const t=e.item.card,s=t.style,i=t.show;this.state.status="saving";try{await this.$store.dispatch("updateAnimateBlockData",{...this.state.blockAnimationData,style:s,show:i}),this.state.status="success",this.update()}catch(e){this.state.status="error","NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this)})),riot3.tag2("settings-section-integrations",'<div data-is="settings-block-integrations-connected-list" class="slide-down-animation" if="{state.showConnected}"></div> <div data-is="settings-block-integrations-available-list" class="slide-down-animation" if="{!state.showConnected}"></div>',"",'class="settings-section-integrations {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={get showConnected(){return t.$state.connected?.length}},this.shouldUpdate=function(){return!flexbe.routing.loading}.bind(this)})),riot3.tag2("settings-block-integrations-connected-list",'<div data-is="element-integrations-settings-instance" each="{instance in state.connected}" instance="{instance}" key="instance_id"></div>',"",'class="settings-block-integrations-connected-list group-list {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={get connected(){return t.$state.connected}}})),riot3.tag2("settings-section-notify",'<div class="group-list slide-down-animation"> <div data-is="settings-block-notify-mails" class="group-item"></div> <div data-is="settings-block-notify-telegram" class="group-item"></div> <div if="{isRussia || $state.sms_available}" data-is="settings-block-notify-sms" class="group-item"></div> <div if="{false}" data-is="settings-block-notify-mobile" class="group-item"></div> </div>',"",'class="settings-section-notify {opts.class}"',(function(e){this.sprite=flexbe.lib.getSprite("settings","admin"),this.isRussia="RU"===flexbe.vars.user.country||"RU"===flexbe.vars.group.country})),riot3.tag2("settings-block-notify-mails",'<div class="flexbe-title text-subtitle inline-box"> <span>{tr(\'admin::settings::notify::email_subtitle\')}</span> <span data-is="admin-save-text" class="flexbe-desc" status="{saveStatus}"></span> </div> <div class="flexbe-white-box shadow p0 overflow"> <div class="flexbe-table block"> <div class="tbody"> <div each="{email, index in state.emails}" class="tr"> <div class="th"> <span class="flexbe-text"> Email #{index + 1} </span> </div> <div class="td"> <div class="inline-box"> <div data-is="proxy" is="save-input" input-class="transparent in-table `email_{index}`" placeholder="{tr(\'admin::settings::notify::email_placeholder\')}" riot-value="{email.email}" type="text" name="test[{index}]" error-text="{email.error}" error="{email.error}" onchange="{setMail.bind(this, email)}" oninput="{setMail.bind(this, email)}" show-save="{email.changed}" on-save="{onSave.bind(tag, email)}" on-done="{onDone.bind(tag, email)}" on-error="{onError.bind(tag, email)}"></div> <div class="flexbe-action-buttons ml25"> <div if="{email.msg}" class="action-button" data-is="flexbe-tooltip" content="{email.msg}"> <svg class="flexbe-icon text-danger size-16 "> <use riot-xlink:href="{tag.sprite}#warning"></use> </svg> </div> <div class="action-button"> <svg class="flexbe-icon size-16" onclick="{removeEmail.bind(this, email, index)}"> <use riot-xlink:href="{sprite}#remove"></use> </svg> </div> </div> </div> </div> </div> </div> </div> <div class="collection"> <div if="{!state.emails.length}" class="collection-item text-shade"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#box"></use> </svg> <span class="flexbe-text"> {tr(\'admin::settings::notify::add_email_desc\')} </span> </div> <div class="collection-item {\'top-border\': state.emails.length}"> <div class="row"> <div class="col col-4"> <div class="flexbe-button small filled is-secondary px15" onclick="{addEmail}"> {tr(\'admin::settings::notify::add_email_button\')} </div> </div> <div class="col col-8"> <label data-is="flexbe-input" if="{state.emails.length}" checked="{state.utm}" class="large to-right" onchange="{toggleUtm}" type="toggle"> <span>{tr(\'admin::settings::notify::email_add_utm_toggle\')}</span> </label> </div> </div> </div> </div> </div>',"",'class="settings-block-notify-mails {opts.class}"',(function(e){const t=this;this.sprite=flexbe.lib.getSprite("settings","admin"),this.saveStatus=!1,this.state={get emails(){return t.$state.notify_emails},get utm(){return t.$state.notify_email_send_utm}},this.addEmail=async function(){this.state.emails.length;const e=this.state.emails.findIndex((e=>!e.email));if(e>=0){const t=this.root.querySelector(`.email_${e}`);return $(t).focus(),!1}try{await this.$store.addEmail({email:""}),setTimeout((()=>{const t=this.root.querySelector(`.email_${e}`);t&&$(t).focus()}),30)}catch(e){if(e.message)return void toast.error(e.message);console.error(e)}}.bind(this),this.setMail=function(e,t){e.email=t.target.value.replace(/ /g,""),e.email!==t.target.value&&(t.target.value=e.email),e.error=!1,"input"!==t.type?"change"===t.type&&this.checkEmail(e):e.changed=!0}.bind(this),this.checkEmail=function(e){const t=ar(e.email);return t||(e.error=tr("main::error::invalid_email")),t}.bind(this),this.toggleUtm=async function(e){const t=e.target.checked;this.saveStatus="saving";try{await this.$store.setEmailUTM(t),this.update({saveStatus:"success"})}catch(e){this.saveStatus="error",this.update(),"NetworkError"!==e.name&&console.error(e)}}.bind(this),this.removeEmail=async function(e){this.update({saveStatus:"saving"});try{await this.$store.removeEmail(e),this.update({saveStatus:"success"})}catch(e){this.update({saveStatus:"error"}),"NetworkError"!==e.name&&console.error(e)}}.bind(this),this.onSave=async function(e){if(this.checkEmail(e),e.error)return this.update(),new Error(e.error);let t;try{t=await this.$store.saveEmail(e),t&&t.data&&(e.id=t.data.id)}catch(e){t=e}return t}.bind(this),this.onDone=function(e){e.changed=!1,e.error=!1,this.update()}.bind(this),this.onError=function(e,t){if(e.changed=!1,this.update(),t.data&&t.data.code||t.validation)return e.error=t.message,this.update(),!1;t.message?toast.error(t.message):console.error(t)}.bind(this),this.onMounted=function(){$(this.root).find(".tooltipstered").tooltipster({theme:"tooltipster-dark"})}.bind(this)})),riot3.tag2("settings-block-notify-mobile",'<div class="flexbe-title text-subtitle inline-box"> <span>{tr(\'admin::settings::notify::mobile_app_subtitle\')}</span> </div> <div class="flexbe-white-box shadow mobile-block"> <div class="mobile-desc-block"> <div class="flexbe-title"> <img class="flexbe-logo" src="/_s/images/admin/png/flexbe-app-icon.png" alt=""> </div> <div class="flexbe-text text-m mobile-desc"> {tr(\'admin::settings::notify::mobile_app_desc\')} </div> <div class="links-outer"> <a href="https://play.google.com/store/apps/details?id=com.flexbe.leads&utm_source=flexbe&utm_medium=badge&utm_campaign=notify_settings" target="_blank" class="mobile-link"> <img src="/_s/images/admin/settings/notify/google_play_ru.png" class="link-image"> </a> <a href="https://itunes.apple.com/ru/app/fleksbi/id1127849507?utm_source=flexbe&utm_medium=badge&utm_campaign=notify_settings" target="_blank" class="mobile-link"> <img src="/_s/images/admin/settings/notify/app_store_ru.png" class="link-image"> </a> </div> </div> </div>',"",'class="settings-block-notify-mobile {opts.class}"',(function(e){this.sprite=flexbe.lib.getSprite("settings","admin")})),riot3.tag2("element-notify-sms-item",'<div data-is="proxy" is="save-input" input-class="transparent in-table" placeholder="+7 (000) 000-00-00" riot-value="{data.masked}" error-text="{data.error}" error="{data.error}" oninput="{setPhone}" show-save="{data.changed}" on-save="{onSave}" on-done="{onDone}" on-error="{onError}" observer="{observer}"></div> <div class="flexbe-action-buttons ml25"> <div class="action-button"> <svg class="flexbe-icon size-16" onclick="{opts.onremove}"> <use riot-xlink:href="{sprite}#remove"></use> </svg> </div> </div>',"",'class="element-notify-sms-item inline-box {opts.class}"',(function(e){this.data=e.data,this.sprite=at("settings","admin"),this.observer=At({}),this.data.masked||(this.data.masked=this.data.phone),this.setPhone=function(t){const s=t.target.value,i=s.replace(/([- \(\)])/g,"");this.$store.updatePhone(e.index,{phone:i,masked:s,changed:!0,error:!1}),this.update()}.bind(this),this.onSave=async function(){if(t=this.data.phone,!/^\+?\d{3,21}$/.test(t)){const e=new Error(tr("admin::settings::notify::invalid_phone_error"));return e.validation=!0,e}var t;let s;try{s=await this.$store.savePhone({id:this.data.id,phone:this.data.phone,index:e.index})}catch(e){s=e}return s}.bind(this),this.onDone=function(){this.data.changed=!1,this.data.error=!1,this.update()}.bind(this),this.onError=function(e){if(this.data.changed=!1,this.update(),e.data&&e.data.code||e.validation)return this.data.error=e.message,this.update(),!1;e.message?toast.error(e.message):console.error(e)}.bind(this),this.setMask=function(){}.bind(this),this.onMounted=function(){be(["/_s/lib/imask/imask.min.js?v1"],(()=>{this.setMask()}))}.bind(this)})),riot3.tag2("modal-sms-plan-alert",'<svg viewbox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" class="flexbe-icon size-28"> <path fill-rule="evenodd" clip-rule="evenodd" d="M5 3H6H19H20V4V8V9H19H18V12V13H17V13.8027C17.8825 13.2922 18.9071 13 20 13C23.3137 13 26 15.6863 26 19C26 22.3137 23.3137 25 20 25C19.6593 25 19.3252 24.9716 19 24.917V25H18H5H4V24V20V19H5H6V17H3H2V16V12V11H3V8V7H4H5V4V3ZM15.5278 23C15.0113 22.4229 14.6048 21.7452 14.3414 21H7H6V23H15.5278ZM14 19C14 18.2987 14.1203 17.6256 14.3414 17H8V19H14ZM5 9V11H16V9H6H5ZM18 7H17H7V5H18V7ZM15 13H4V15H7H15V13ZM24 19C24 21.2091 22.2091 23 20 23C17.7909 23 16 21.2091 16 19C16 16.7909 17.7909 15 20 15C22.2091 15 24 16.7909 24 19Z" fill="#56B157"></path> </svg> <div class="flexbe-text text-l mt20"> {tr(\'admin::settings::notify::pay_for_plan_message\')} </div> <a href="/admin/user/pay/" class="flexbe-button filled is-primary px15 mt20">{tr(\'admin::settings::notify::go_to_payment_button\')}</a>',"",'class="modal-sms-plan-alert"',(function(e){})),riot3.tag2("modal-telegram",'<div class="modal-telegram_inner"> <div class="modal-telegram_block modal-telegram_bot"> <img src="/_s/images/admin/settings/notify/telegram/instruction-bot_retina.png"> <div class="flexbe-title">{tr(\'admin::settings::notify::telegram_method_label\')} 1</div> <div data-is="raw" class="flexbe-desc" content="{tr(\'admin::settings::notify::telegram_bot_desc\',                 { link: opts.data.link, name: opts.data.botname  })}"> </div> <div class="flexbe-button"> <span class="flexbe-text">{opts.data.command}</span> </div> </div> <div class="modal-telegram_block modal-telegram_qr"> <img class="qr-image" riot-src="{opts.data.qr}" alt="{opts.data.link}"> <div class="flexbe-title">{tr(\'admin::settings::notify::telegram_method_label\')} 2</div> <div class="flexbe-desc">{tr(\'admin::settings::notify::telegram_qr_desc\')}</div> <div class="flexbe-button"> <img src="/_s/images/admin/settings/notify/telegram/instruction-camera-handle-icon.svg"> <span class="flexbe-text">{tr(\'admin::settings::notify::telegram_qr_point_camera\')}</span> </div> </div> </div>',"",'class="modal-telegram {opts.class}"',(function(e){}));riot3.tag2("settings-block-notify-sms",'<div class="flexbe-title text-subtitle inline-box"> {tr(\'admin::settings::notify::sms_subtitle\')} <span data-is="admin-save-text" class="flexbe-desc" status="{saveStatus}"></span> </div> <div class="flexbe-white-box shadow p0 overflow"> <div class="flexbe-table block" if="{!hideUI}"> <div class="tbody"> <div class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'admin::settings::notify::sms_remained_label\')} </span> </div> <div class="td"> <div class="inline-box"> <span if="{state.smsLimit === 0}" class="{\'flexbe-desc\': !state.smsAvailable}"> {state.smsAvailable || 0} {tr(\'admin::settings::notify::sms_unit\')} </span> <span if="{state.smsLimit > 0}" class="{\'flexbe-desc\': !state.smsAvailable}"> {tr(\'admin::settings::notify::sms_free_available\', {                                     sms_available: state.smsAvailable,                                     sms_limit: state.smsLimit                                 })} </span> <span class="flexbe-desc ml-auto" if="{state.showDiscontinuedMessage}">   -  </span> <a if="{false}" href="/admin/user/pay/sms/" onclick="{goToPayment}" class="flexbe-button small filled is-secondary to-right"> <span class="flexbe-text">{tr(\'admin::settings::notify::sms_pay_button\')}</span> </a> </div> </div> </div> <div if="{state.phones.length}" each="{phone, index in state.phones}" class="tr"> <div class="th"> <span class="flexbe-text"> {tr(\'admin::settings::notify::phone_number_label\')} #{index + 1} </span> </div> <div class="td"> <div data-is="element-notify-sms-item" ref="phone-{index}" data="{phone}" index="{index}" onremove="{removePhone.bind(tag, index)}"></div> </div> </div> </div> </div> <div class="collection"> <div if="{!state.phones.length}" class="collection-item top-border text-shade"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#phone"></use> </svg> <span class="flexbe-text"> {tr(\'admin::settings::notify::add_phone_desc\')} </span> </div> <div class="collection-item {\'top-border\': state.phones.length}"> <div class="row"> <div class="col col-4"> <div class="flexbe-button small filled is-secondary" onclick="{addPhone}"> <span class="flexbe-text">{tr(\'admin::settings::notify::add_phone_number_button\')}</span> </div> </div> <div class="col col-8" if="{state.phones.length}"> <label data-is="flexbe-input" riot-value="{state.isSimplified}" checked="{state.isSimplified}" class="large to-right" onchange="{toggleSimplified}" type="toggle"> <span>{tr(\'admin::settings::notify::simplified_messages_toggle\')}</span> </label> <q data-is="flexbe-tooltip"> {tr(\'admin::settings::notify::simplified_messages_tip\')} </q> </div> </div> </div> <div class="collection-footer collection-item shade" if="{state.showDiscontinuedMessage}"> <div class="flexbe-desc">    </div> </div> </div> </div>',"",'class="settings-block-notify-sms {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.sprite=at("settings","admin"),this.state={get smsLimit(){return t.$state.sms_limit},get smsAvailable(){return t.$state.sms_available},get showDiscontinuedMessage(){return"ru"===flexbe.vars.user.lang},get isSimplified(){return t.$state.notify_sms_light},get phones(){return t.$state.phones}},this.redrawUI=function(){this.update({hideUI:!0}),this.update({hideUI:!1})}.bind(this),this.goToPayment=function(e){flexbe.bill.isPaid||(e.preventDefault(),Zs.create({noTitle:!0,overlay:!0,shadow:!0,riotTag:"modal-sms-plan-alert",width:400}))}.bind(this),this.addPhone=async function(){const e=this.state.phones.length,t=this.state.phones.findIndex((e=>e.changed));if(t>=0){return $(this.refs[`phone-${t}`].root).find("input").focus(),!1}try{await this.$store.addPhone({phone:"+7",changed:!0})}catch(e){}setTimeout((()=>{$(this.refs[`phone-${e}`].root).find("input").focus()}),50)}.bind(this),this.removePhone=async function(e){try{await this.$store.removePhone(e),this.update()}catch(e){console.error(e)}}.bind(this),this.toggleSimplified=async function(e){const t=e.target.checked?1:0;this.update({saveStatus:"saving"});try{await this.$store.setSiplified(t),this.update({saveStatus:"success"})}catch(e){this.update({saveStatus:"error"}),this.redrawUI(),"NetworkError"!==e.name&&console.error(e)}}.bind(this)})),riot3.tag2("settings-block-notify-telegram",'<div class="flexbe-title text-subtitle inline-box"> <span>Telegram</span> <span data-is="admin-save-text" class="flexbe-desc" status="{saveStatus}"></span> </div> <div class="telegram-outer flexbe-white-box shadow"> <div class="telegram-inner px25 py25" if="{!state.isConnected}"> <div class="telegram-logo"> <img src="/_s/images/admin/settings/notify/telegram/telegram.png"> <span class="flexbe-text">{tr(\'admin::settings::notify::telegram_disconnected_status\')}</span> </div> <div class="flexbe-button is-secondary filled" onclick="{openTelegramModal}"> {tr(\'main::button::enable\')} </div> </div> <div class="telegram-inner" if="{state.isConnected}"> <div class="collection"> <div class="collection-item" each="{account in state.accounts}" key="{account.id}"> <div class="telegram-avatar"> <div data-is="user-avatar" user-image="{account.profile_image}" user-mail="{getAccountName(account)}"> </div> <div class="flexbe-text">{getAccountName(account)}</div> </div> <button class="flexbe-button is-secondary filled" onclick="{disconnectTelegram.bind(null, account)}"> {tr(\'main::button::disable\')} </button> </div> <div class="collection-item"> <div class="col col-4"> <button class="flexbe-button is-secondary filled" onclick="{openTelegramModal}"> {tr(\'main::button::add\')} </button> </div> <div class="col col-8" if="{state.accounts.length}"> <label data-is="flexbe-input" riot-value="{state.utm}" checked="{state.utm}" class="large to-right" onchange="{toggleUtm}" type="toggle"> <span>{tr(\'admin::settings::notify::telegram_add_utm_toggle\')}</span> </label> </div> </div> </div> </div> </div>',"",'class="settings-block-notify-telegram {opts.class}"',(function(e){const t=this;this.sprite=flexbe.lib.getSprite("settings","admin"),this.state={get data(){return t.$state.telegram},get utm(){return t.$state.notify_telegram_send_utm},get isConnected(){return Object.keys(this.data.accounts).length},get accounts(){const e=this.data.accounts;return Object.keys(e).map((t=>e[t]))}},this.getAccountName=function(e){if("private"===e.type){const t=`${e.first_name} ${e.last_name??""}`;return e.username??t}return e.title}.bind(this),this.openTelegramModal=function(){var e;e={...this.state.data},Zs.create({noTitle:!0,riotTag:"modal-telegram",overlay:!0,shadow:!0,width:600,props:{data:e}})}.bind(this),this.toggleUtm=async function(e){const t=e.target.checked;this.saveStatus="saving";try{await this.$store.setTelegramUTM(t),this.update({saveStatus:"success"})}catch(e){this.saveStatus="error",this.update(),"NetworkError"!==e.name&&console.error(e)}}.bind(this),this.disconnectTelegram=async function(e){this.saveStatus="saving";try{await this.$store.disconnectTelegram(e?.id),this.update({saveStatus:"success"})}catch(e){this.update({saveStatus:"error"}),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this)})),riot3.tag2("settings-element-pay-method-item",'<div class="flexbe-white-box shadow collection status-{state.settings.mode === \'debug\' ? \'inactive\' : \'success\'}"> <div class="collection-item"> <div class="service-icon store-app-icon size-small"> <img class="flexbe-icon size-auto" riot-src="{state.info.icon_small}"> </div> <div class="service-name"> <span class="flexbe-text">{state.info.title}</span> </div> <div class="service-mode flexbe-desc" data-is="flexbe-tooltip" if="{(state.settings.mode === \'debug\') && (meta.showModeTitle)}" content="{tr(\'admin::settings::pay::services::modes::debug_tip\')}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#mode-debug"></use> </svg> <span class="flexbe-text">{tr(\'admin::settings::pay::services::modes::debug\')}</span> </div> <div class="service-mode flexbe-success" data-is="flexbe-tooltip" if="{state.settings.mode === \'work\'}" content="{tr(\'admin::settings::pay::services::modes::work_tip\')}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{tag.sprite}#mode-work"></use> </svg> <span class="flexbe-text">{tr(\'admin::settings::pay::services::modes::work\')}</span> </div> <div class="service-actions flexbe-buttons-line"> <button class="flexbe-button filled small is-secondary" onclick="{setupService}"> <span class="flexbe-text">{tr(\'main::button::settings\')}</span> </button> <button class="flexbe-button filled small is-secondary" onclick="{disableService}"> <span class="flexbe-text">{tr(\'main::button::disable\')}</span> </button> </div> </div> <div class="collection-item" if="{state.info.support_methods_text}"> <div class="service-supports flexbe-desc"> {state.info.support_methods_text} </div> </div> </div>',"",'class="settings-element-pay-method-item {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.sprite=flexbe.lib.getSprite("settings.pay","admin"),this.state={get item(){return t.props.data},get name(){return this.item.name},get settings(){return this.item.settings},get info(){return this.item.info}},this.meta={get showModeTitle(){return"Stripe"!==t.state.info.title}},this.setupService=function(){flexbe.routing.go(`/admin/settings/pay/service/${this.state.name}/`)}.bind(this),this.disableService=function(){As({props:{icon:`${this.sprite}#remove_confirm_big`,title:tr("admin::settings::pay::remove_method_confirm_title"),confirmButtonClass:"is-danger bordered colored",cancelButton:!0,onConfirm:()=>this.$store.dispatch("disableService",this.state.name),onError:e=>{"NetworkError"===e.type?toast.error(e.message):console.error(e)}},clickOut:!0})}.bind(this)})),riot3.tag2("settings-block-pay-methods-list",'<div class="flexbe-title text-subtitle"> {tr(\'admin::settings::pay::pay_methods_title\')} </div> <div class="group-list"> <div class="group-content" data-is="settings-element-pay-method-item" each="{item in state.list}" data="{item}"> </div> <div class="group-content" if="{state.services.length}"> <a class="flexbe-button large filled rounded is-primary" href="/admin/settings/pay/connect/"> <span class="flexbe-text">{tr(\'admin::settings::pay::add_method_button\')}</span> </a> </div> </div>',"",'class="settings-block-pay-methods-list {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={get list(){return t.$getters.list||[]},get services(){return t.$getters.services||[]}}})),riot3.tag2("settings-block-pay-services-list",'<div class="flexbe-card-list" if="{state.services.length}"> <div class="flexbe-card-item w50" each="{service in state.services}"> <div class="store-app-card-preview flexbe-white-card rounded shadow {service.currency_disabled ? \'disabled\' : \'hoverable pointer\'}" onclick="{selectService}" onmouseenter="{onHover}" onmouseleave="{onHover}"> <div class="application-icon store-app-icon size-large"> <img class="flexbe-icon size-auto" riot-src="{service.icon_large}"> </div> <div class="application-text"> <div class="flexbe-title">{service.title}</div> <div class="flexbe-desc">{service.short_desc}</div> </div> <div class="application-action" if="{!service.currency_disabled}"> <svg class="flexbe-icon size-10 arrow"> <use riot-xlink:href="{sprite}#arrow-next"></use> </svg> </div> <div class="application-locked" if="{service.currency_disabled}" data-is="flexbe-tooltip" content="{tr(\'admin::settings::pay::services::paypal::disabled_currency\', { currency: service.currency })}" interactive="{false}"> <svg class="flexbe-icon size-16 lock"> <use riot-xlink:href="{tag.sprite}#locked"></use> </svg> </div> </div> </div> </div> <div class="flexbe-white-box shadow is-card empty-methods" if="{!state.services.length}"> <img src="/_s/images/admin/settings/pay/services_list.png"> <div class="flexbe-text"> {tr(\'admin::settings::pay::no_methods_available_text\')} </div> </div>',"",'class="settings-block-pay-services-list {opts.class}"',(function(e){const t=this;this.sprite=flexbe.lib.getSprite("settings.pay","admin"),this.state={get services(){return t.$getters.services}},this.onHover=function(e){const t="mouseenter"===e.type?"open":"close",s=$(e.target).closest(".store-app-card-preview").find(".tooltipstered");s.length&&s.tooltipster(t)}.bind(this),this.selectService=function(e){const t=e.item.service;if(t.currency_disabled)return!1;flexbe.routing.go(`/admin/settings/pay/service/${t.name}/`)}.bind(this)})),riot3.tag2("settings-section-pay",'<div data-is="settings-block-pay-methods-list" class="slide-down-animation" if="{state.showMethods}"></div> <div data-is="settings-block-pay-services-list" class="slide-down-animation" if="{!state.showMethods}"></div>',"",'class="settings-section-pay {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.state={get showMethods(){return t.$getters.list.length}}})),riot3.tag2("settings-section-pay-connect",'<div data-is="settings-block-pay-services-list" class="slide-down-animation"></div>',"",'class="settings-section-pay-connect group-list pb60 {opts.class}"',(function(e){})),riot3.tag2("element-store-app-header",'<div class="flexbe-white-box shadow collection status-{opts.status}"> <div class="collection-item"> <div class="application-icon store-app-icon size-small"> <img class="flexbe-icon size-auto" riot-src="{opts.icon}"> </div> <div class="application-name"> <span class="flexbe-text">{opts.title}</span> <span class="flexbe-separator" if="{opts.info}"></span> <span class="flexbe-desc" if="{opts.info}">{opts.info}</span> </div> <div class="application-actions flexbe-buttons-line"> <div data-is="proxy" is="flexbe-button" class="filled small {serviceDisabled ? \'is-secondary\' : \'is-primary\'}" if="{!opts.enabled}" loading="{loading: opts.loading}" text="{tr(\'main::button::enable\')}" onclick="{serviceDisabled ? \'\' : opts.onenable}" tip="{serviceDisabled ? tr(\'admin::upgrade_tariff_warning::content_text\') : \'\'}"></div> <div data-is="proxy" is="flexbe-button" class="filled small is-secondary" if="{opts.enabled}" loading="{loading: opts.loading}" text="{tr(\'main::button::disable\')}" onclick="{opts.ondisable}"></div> </div> </div> </div>',"",'class="element-store-app-header {opts.class}"',(function(e){this.serviceDisabled=0===flexbe.vars.plans.payment})),riot3.tag2("element-pay-service-save",'<button class="flexbe-button filled large rounded is-primary noshrink {loading: loading}" onclick="{saveForm}"> <span class="flexbe-text">{tr(\'main::button::save\')}</span> </button> <div class="warning-message {show: showText}"> <div class="{errorText ? \'flexbe-error\' : \'flexbe-success\'}" if="{errorText || successText}">{errorText || successText}</div> </div>',"",'class="element-pay-service-save inline-box {opts.class}"',(function(e){let t;this.loading=!1,this.showText=!1,this.successText=!1,this.errorText=!1,this.saveForm=async function(){let e;clearTimeout(t),this.update({loading:!0,showText:!1}),this.update();try{e=await this.$store.dispatch("saveSettings"),this.successText=tr("main::save_text::success"),this.errorText=!1,toast.success(this.successText)}catch(e){if(this.successText=!1,"NetworkError"===e.name)this.errorText=e.message,toast.error(e.message);else{if("FormError"!==e.name)throw e;this.errorText=tr("main::error:check_fields")}}return this.update({loading:!1,showText:!0}),t=setTimeout((()=>{this.update({showText:!1})}),2500),e}.bind(this),this.onBeforeMount=function(){this._hotkeysSaveDisposer=fs.register({hotkeys:["cmd_s"],handlerDown:()=>this.saveForm()})}.bind(this),this.onBeforeUnmount=function(){this._hotkeysSaveDisposer()}.bind(this)}));const Md=(e,t,s)=>{const i=vt({get value(){return e.$store.helpers.getField(t)},set value(s){e.$store.commit("setField",t,s)},getError:()=>{const s=e.$store.errors.first(t);return s&&s.message||!1}},s);return new Hl(t,i)};riot3.tag2("pay-service-cash-tab-settings",'<div class="content-block"> <div class="label {error: !fields.instruction.valid}"> {tr(\'admin::settings::pay::services::cash::settings::instruction_text_label\')} </div> <div data-is="flexbe-input" type="{fields.instruction.type}" rows="{fields.instruction.rows}" riot-value="{fields.instruction.value}" error="{!fields.instruction.valid}" oninput="{fields.instruction.onchange}" onchange="{fields.instruction.onchange}"></div> </div> <div data-is="settings-block-pay-custom-url" success="{fields.customUrlSuccess}" active="{fields.isCustomUrl}"></div> <div class="content-block shade" data-is="element-pay-service-save"></div>',"",'class="pay-service-cash-tab-settings {opts.class}"',(function(e){this.fields={instruction:Md(this,"instruction",{type:"textarea",rows:8}),customUrlSuccess:Md(this,"custom_url_success"),isCustomUrl:Md(this,"is_custom_url")}})),riot3.tag2("pay-service-cash-tab-desc",'<div class="content-block"> <div class="text" data-is="raw" content="{state.desc}"></div> </div>',"",'class="pay-service-cash-tab-desc {opts.class}"',(function(e){this.state={desc:this.$state.info.desc}}));const Dd={tabs:[{type:"settings",title:tr("admin::apps::common::tab_settings"),contentTag:"pay-service-cash-tab-settings",show:"enabled"},{type:"desc",title:tr("admin::apps::common::tab_desc"),contentTag:"pay-service-cash-tab-desc",show:!0}]};riot3.tag2("element-pay-service-ofd-setup",'<div class="field-title">{tr(\'admin::settings::pay::ofd::title\')}</div> <div class="row"> <div class="col"> <label class="large" data-is="flexbe-input" type="toggle" checked="{fields.active.value}" onchange="{fields.active.onchange}"> <span class="flexbe-text">{tr(\'admin::settings::pay::ofd::enable_label\')}</span> </label> </div> </div> <div class="row fade-in-animation" if="{fields.active.value}"> <div class="col col-6"> <div class="label {error: fields.tax.error}">{tr(\'admin::settings::pay::ofd::tax_label\')}</div> <div data-is="flexbe-select" list="{meta.tax_list}" riot-value="{fields.tax.value}" error="{!fields.tax.valid}" onchange="{fields.tax.onchange}"> </div> </div> <div class="col col-6"> <div class="label {error: fields.sno.error}">{tr(\'admin::settings::pay::ofd::sno_label\')}</div> <div data-is="flexbe-select" list="{meta.sno_list}" riot-value="{fields.sno.value}" error="{!fields.sno.valid}" onchange="{fields.sno.onchange}"> </div> </div> </div> <div class="row fade-in-animation" if="{fields.active.value}"> <div class="col col-6"> <div class="label {error: fields.subject.error}">{tr(\'admin::settings::pay::ofd::subject_label\')}</div> <div data-is="flexbe-select" list="{meta.payment_subject_list}" riot-value="{fields.subject.value}" error="{!fields.subject.valid}" onchange="{fields.subject.onchange}"> </div> </div> <div class="col col-6"> <div class="label {error: fields.mode.error}">{tr(\'admin::settings::pay::ofd::mode_label\')}</div> <div data-is="flexbe-select" list="{meta.payment_mode_list}" riot-value="{fields.mode.value}" error="{!fields.mode.valid}" onchange="{fields.mode.onchange}"> </div> </div> </div>',"",'class="element-pay-service-ofd-setup {opts.class}"',(function(e){this.meta={...this.$state.meta},this.fields={active:Md(this,"online_cashbox.is_active",{type:"toggle"}),tax:Md(this,"online_cashbox.tax",{type:"select"}),sno:Md(this,"online_cashbox.sno",{type:"select"}),subject:Md(this,"online_cashbox.payment_subject",{type:"select"}),mode:Md(this,"online_cashbox.payment_mode",{type:"select"})}})),riot3.tag2("pay-service-robokassa-tab-settings",'<div class="content-block"> <div class="field-title"></div> <div class="row"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::robokassa::settings::work_mode_title\')}</div> <div data-is="flexbe-buttons-line" class="is-group" role="radio" list="{meta.work_modes}" riot-value="{fields.mode.value}" onchange="{fields.mode.onchange}"> </div> </div> </div> </div> <div class="content-block"> <div class="field-title">{tr(\'admin::settings::pay::services::robokassa::settings::api_settings_title\')}</div> <div class="row"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::robokassa::settings::login_label\')}</div> <div data-is="flexbe-input" placeholder="market_id" riot-value="{fields.login.value}" error="{!fields.login.valid}" error-tip="{fields.login.error}" onchange="{fields.login.onchange}" name="robokassa_market_id"> </div> </div> </div> <div class="row"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::robokassa::settings::pass1_label\')}</div> <div data-is="flexbe-input" placeholder="password1" riot-value="{fields.pass1.value}" error="{!fields.pass1.valid}" error-tip="{fields.pass1.error}" onchange="{fields.pass1.onchange}" name="robokassa_pass1"> </div> </div> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::robokassa::settings::pass2_label\')}</div> <div data-is="flexbe-input" placeholder="password2" riot-value="{fields.pass2.value}" error="{!fields.pass2.valid}" error-tip="{fields.pass2.error}" onchange="{fields.pass2.onchange}" name="robokassa_pass2"> </div> </div> </div> </div> <div class="content-block" data-is="element-pay-service-ofd-setup"></div> <div data-is="settings-block-pay-custom-url" success="{fields.customUrlSuccess}" fail="{fields.customUrlFail}" active="{fields.isCustomUrl}"></div> <div class="content-block shade" data-is="element-pay-service-save"></div>',"",'class="pay-service-robokassa-tab-settings {opts.class}"',(function(e){const t=this.$state.info?.meta||{};this.meta={resultUrl:`${location.origin}${t.result_url}`,successUrl:`${location.origin}${t.success_url}`,failUrl:`${location.origin}${t.fail_url}`,work_modes:t.work_modes,...this.$state.meta},this.fields={mode:Md(this,"mode",{type:"radio"}),login:Md(this,"MrchLogin"),pass1:Md(this,"pass1"),pass2:Md(this,"pass2"),customUrlSuccess:Md(this,"custom_url_success"),customUrlFail:Md(this,"custom_url_fail"),isCustomUrl:Md(this,"is_custom_url")}})),riot3.tag2("pay-service-robokassa-testpayment",'<p class="text mt0" data-is="raw" content="{tr(\'admin::settings::pay::services::robokassa::testing::step_1\')}"></p> <p class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::robokassa::testing::step_2\')}"></p> <p class="text mb0" data-is="raw" content="{tr(\'admin::settings::pay::services::robokassa::testing::step_3\')}"></p>',"",'class="pay-service-robokassa-testpayment flexbe-modal-content {opts.class}"',(function(e){})),riot3.tag2("pay-service-robokassa-tab-instruction",'<div class="content-block"> <ol> <li data-is="raw" content="{tr(\'admin::settings::pay::services::robokassa::instruction::step_1_title\', { href: \'https://partner.robokassa.ru/Reg/Register?culture=ru\' })}"></li> <li> {tr(\'admin::settings::pay::services::robokassa::instruction::step_2_title\')} <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/robo-help1.jpg">{tr(\'admin::settings::apps::example_button\')}</a> <div class="info-box my10"> <div class="p"> <div class="note unselectable">{tr(\'admin::settings::pay::services::robokassa::instruction::result_url_label\')}</div> <div class="text">{meta.resultUrl}</div> </div> <div class="p"> <div class="note unselectable">{tr(\'admin::settings::pay::services::robokassa::instruction::success_url_label\')}</div> <div class="text">{meta.successUrl}</div> </div> <div class="p"> <div class="note unselectable">{tr(\'admin::settings::pay::services::robokassa::instruction::fail_url_label\')}</div> <div class="text">{meta.failUrl}</div> </div> </div> </li> <li> {tr(\'admin::settings::pay::services::robokassa::instruction::step_3_title\')} <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/robo-help2.jpg">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> {tr(\'admin::settings::pay::services::robokassa::instruction::step_4_title\')} <a onclick="{showTestPayment}">{tr(\'admin::settings::pay::services::robokassa::instruction::step_4_help\')}</a> </li> </ol> </div>',"",'class="pay-service-robokassa-tab-instruction {opts.class}"',(function(e){const t=this.$state.info&&this.$state.info.meta||{};this.meta={resultUrl:`${location.origin}${t.result_url}`,successUrl:`${location.origin}${t.success_url}`,failUrl:`${location.origin}${t.fail_url}`},this.showTestPayment=function(e){e.preventDefault(),Zs.create({title:tr("admin::settings::pay::services::robokassa::testing::title"),overlay:!0,shadow:!0,handle:!1,width:500,uiClass:"editor-ui",riotTag:"pay-service-robokassa-testpayment"})}.bind(this)})),riot3.tag2("pay-service-robokassa-tab-desc",'<div class="content-block" data-is="raw" content="{state.desc}"></div>',"",'class="pay-service-robokassa-tab-desc {opts.class}"',(function(e){this.state={desc:this.$state.info.desc}}));const Vd={tabs:[{type:"settings",title:tr("admin::apps::common::tab_settings"),contentTag:"pay-service-robokassa-tab-settings",show:"enabled"},{type:"instruction",title:tr("admin::apps::common::tab_instruction"),contentTag:"pay-service-robokassa-tab-instruction",show:"enabled"},{type:"desc",title:tr("admin::apps::common::tab_desc"),contentTag:"pay-service-robokassa-tab-desc",show:!0}]};riot3.tag2("pay-service-tinkoff-tab-settings",'<div class="content-block"> <div class="field-title">{tr(\'admin::settings::pay::services::tinkoff::settings::api_settings_title\')}</div> <div class="row"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::tinkoff::settings::work_mode_label\')}</div> <div data-is="flexbe-buttons-line" class="is-group" role="radio" list="{meta.work_modes}" riot-value="{fields.mode.value}" onchange="{fields.mode.onchange}"> </div> </div> </div> <div class="row" if="{fields.mode.value == \'debug\'}"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::tinkoff::settings::demo_terminal_label\')}</div> <div data-is="flexbe-input" placeholder="my_market_demo" riot-value="{fields.demoTerminalKey.value}" error="{!fields.demoTerminalKey.valid}" error-tip="{fields.demoTerminalKey.error}" onchange="{fields.demoTerminalKey.onchange}" name="tinkoff_terminal_key"> </div> </div> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::tinkoff::settings::demo_secret_label\')}</div> <div data-is="flexbe-input" placeholder="secret_key_demo" riot-value="{fields.demoSecretKey.value}" error="{!fields.demoSecretKey.valid}" error-tip="{fields.demoSecretKey.error}" onchange="{fields.demoSecretKey.onchange}" name="tinkoff_secret_key"> </div> </div> </div> <div class="row" if="{fields.mode.value == \'work\'}"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::tinkoff::settings::terminal_label\')}</div> <div data-is="flexbe-input" placeholder="my_market" riot-value="{fields.terminalKey.value}" error="{!fields.terminalKey.valid}" error-tip="{fields.terminalKey.error}" onchange="{fields.terminalKey.onchange}"> </div> </div> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::tinkoff::settings::secret_label\')}</div> <div data-is="flexbe-input" placeholder="secret_key" riot-value="{fields.secretKey.value}" error="{!fields.secretKey.valid}" error-tip="{fields.secretKey.error}" oninput="{updateSecretKey}" onchange="{fields.secretKey.onchange}"> </div> </div> </div> </div> <div class="content-block" data-is="element-pay-service-ofd-setup"></div> <div data-is="settings-block-pay-custom-url" success="{fields.customUrlSuccess}" fail="{fields.customUrlFail}" active="{fields.isCustomUrl}"></div> <div class="content-block shade" data-is="element-pay-service-save"></div>',"",'class="pay-service-tinkoff-tab-settings {opts.class}"',(function(e){const t=this.$state.info?.meta||{};this.meta={method:t.method,resultUrl:`${location.origin}${t.result_url}`,successUrl:`${location.origin}${t.success_url}`,failUrl:`${location.origin}${t.fail_url}`,work_modes:t.work_modes,...this.$state.meta},this.fields={mode:Md(this,"mode",{type:"radio"}),demoTerminalKey:Md(this,"DEMO_terminal_key"),demoSecretKey:Md(this,"DEMO_secret_key"),terminalKey:Md(this,"terminal_key"),secretKey:Md(this,"secret_key"),customUrlSuccess:Md(this,"custom_url_success"),customUrlFail:Md(this,"custom_url_fail"),isCustomUrl:Md(this,"is_custom_url")},this.updateSecretKey=function(e){this.fields.secretKey.value=e.target.value,this.update()}.bind(this)})),riot3.tag2("pay-service-tinkoff-testpayment",'<p class="text mt0" data-is="raw" content="{tr(\'admin::settings::pay::services::tinkoff::testing::step_1\')}"></p> <p class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::tinkoff::testing::step_2\')}"></p> <p class="text mb0" data-is="raw" content="{tr(\'admin::settings::pay::services::tinkoff::testing::step_3\')}"></p>',"",'class="pay-service-tinkoff-testpayment flexbe-modal-content {opts.class}"',(function(e){})),riot3.tag2("pay-service-tinkoff-tab-instruction",'<div class="content-block"> <ol> <li data-is="raw" content="{tr(\'admin::settings::pay::services::tinkoff::instruction::step_1_title\', { href: \'https://www.tinkoff.ru/business/?invite_code=5260362996\' })}"></li> <li> {tr(\'admin::settings::pay::services::tinkoff::instruction::step_2_title\')} <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/tinkoff-help-2.png">{tr(\'admin::settings::apps::example_button\')}</a> <div class="info-box my10"> <div class="p"> <div class="note unselectable">{tr(\'admin::settings::pay::services::tinkoff::instruction::method_label\')}</div> <div class="text">{meta.method}</div> </div> <div class="p"> <div class="note unselectable">{tr(\'admin::settings::pay::services::tinkoff::instruction::notification_url_label\')}</div> <div class="text">{meta.resultUrl}</div> </div> <div class="p"> <div class="note unselectable">{tr(\'admin::settings::pay::services::tinkoff::instruction::success_url_label\')}</div> <div class="text">{meta.successUrl}</div> </div> <div class="p"> <div class="note unselectable">{tr(\'admin::settings::pay::services::tinkoff::instruction::fail_url_label\')}</div> <div class="text">{meta.failUrl}</div> </div> </div> </li> <li> {tr(\'admin::settings::pay::services::tinkoff::instruction::step_3_title\')} <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/tinkoff-help-1.png"> {tr(\'admin::settings::pay::services::tinkoff::instruction::step_3_help\')} </a> </li> <li> {tr(\'admin::settings::pay::services::tinkoff::instruction::step_4_title\')} <a onclick="{showTestPayment}">{tr(\'admin::settings::pay::services::tinkoff::instruction::step_4_help\')}</a> </li> </ol> </div>',"",'class="pay-service-tinkoff-tab-instruction {opts.class}"',(function(e){const t=this.$state.info?.meta||{};this.meta={method:t.method,resultUrl:`${location.origin}${t.result_url}`,successUrl:`${location.origin}${t.success_url}`,failUrl:`${location.origin}${t.fail_url}`},this.showTestPayment=function(e){e.preventDefault(),Zs.create({title:tr("admin::settings::pay::services::tinkoff::testing::title"),overlay:!0,shadow:!0,handle:!1,width:500,uiClass:"editor-ui",riotTag:"pay-service-tinkoff-testpayment"})}.bind(this)})),riot3.tag2("pay-service-tinkoff-tab-desc",'<div class="content-block" data-is="raw" content="{state.desc}"></div>',"",'class="pay-service-tinkoff-tab-desc {opts.class}"',(function(e){this.state={desc:this.$state.info.desc}}));const Od={tabs:[{type:"settings",title:tr("admin::apps::common::tab_settings"),contentTag:"pay-service-tinkoff-tab-settings",show:"enabled"},{type:"instruction",title:tr("admin::apps::common::tab_instruction"),contentTag:"pay-service-tinkoff-tab-instruction",show:"enabled"},{type:"desc",title:tr("admin::apps::common::tab_desc"),contentTag:"pay-service-tinkoff-tab-desc",show:!0}]};riot3.tag2("pay-service-bepaid-tab-settings",'<div class="content-block"> <div class="field-title"></div> <div class="row"> <div class="col col-6"> <div class="field-title">{tr(\'admin::settings::pay::services::bepaid::settings::host\')}</div> <div data-is="flexbe-buttons-line" class="is-group" role="radio" list="{meta.host}" riot-value="{fields.host.value}" onchange="{fields.host.onchange}"> </div> </div> </div> </div> <div class="content-block"> <div class="field-title">{tr(\'admin::settings::pay::services::bepaid::settings::api_settings_title\')}</div> <div class="row"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::bepaid::settings::work_mode_label\')}</div> <div data-is="flexbe-buttons-line" class="is-group" role="radio" list="{meta.work_modes}" riot-value="{fields.mode.value}" onchange="{fields.mode.onchange}"> </div> </div> </div> <div class="row" if="{fields.mode.value == \'debug\'}"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::bepaid::settings::demo_id_label\')}</div> <div data-is="flexbe-input" placeholder="shopId" riot-value="{fields.demoTerminalKey.value}" error="{!fields.demoTerminalKey.valid}" error-tip="{fields.demoTerminalKey.error}" onchange="{fields.demoTerminalKey.onchange}" name="bepaid_terminal_key"> </div> </div> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::bepaid::settings::demo_secret_label\')}</div> <div data-is="flexbe-input" placeholder="shopKey" riot-value="{fields.demoSecretKey.value}" error="{!fields.demoSecretKey.valid}" error-tip="{fields.demoSecretKey.error}" onchange="{fields.demoSecretKey.onchange}" name="bepaid_secret_key"> </div> </div> </div> <div class="row" if="{fields.mode.value == \'work\'}"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::bepaid::settings::id_label\')}</div> <div data-is="flexbe-input" placeholder="shopId" riot-value="{fields.terminalKey.value}" error="{!fields.terminalKey.valid}" error-tip="{fields.terminalKey.error}" onchange="{fields.terminalKey.onchange}"> </div> </div> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::bepaid::settings::secret_label\')}</div> <div data-is="flexbe-input" placeholder="shopKey" riot-value="{fields.secretKey.value}" error="{!fields.secretKey.valid}" error-tip="{fields.secretKey.error}" oninput="{updateSecretKey}" onchange="{fields.secretKey.onchange}"> </div> </div> </div> </div> <div data-is="settings-block-pay-custom-url" success="{fields.customUrlSuccess}" fail="{fields.customUrlFail}" active="{fields.isCustomUrl}"></div> <div class="content-block shade" data-is="element-pay-service-save"></div>',"",'class="pay-service-bepaid-tab-settings {opts.class}"',(function(e){const t=this.$state.info?.meta||{};this.meta={method:t.method,resultUrl:`${location.origin}${t.result_url}`,successUrl:`${location.origin}${t.success_url}`,failUrl:`${location.origin}${t.fail_url}`,work_modes:t.work_modes,host:[{value:"bepaid.by",title:tr("admin::settings::pay::services::bepaid::settings::host_by")},{value:"bepaid.tech",title:tr("admin::settings::pay::services::bepaid::settings::host_ru")}],...this.$state.meta},this.fields={mode:Md(this,"mode",{type:"radio"}),demoTerminalKey:Md(this,"DEMO_shopId"),demoSecretKey:Md(this,"DEMO_shopKey"),terminalKey:Md(this,"shopId"),secretKey:Md(this,"shopKey"),customUrlSuccess:Md(this,"custom_url_success"),customUrlFail:Md(this,"custom_url_fail"),isCustomUrl:Md(this,"is_custom_url"),host:Md(this,"host")},this.updateSecretKey=function(e){this.fields.secretKey.value=e.target.value,this.update()}.bind(this)})),riot3.tag2("pay-service-bepaid-tab-instruction",'<div class="content-block"> <ol> <li data-is="raw" content="{tr(\'admin::settings::pay::services::bepaid::instruction::step_1_title\', { href: \'https://bepaid.by/\' })}"></li> <li> {tr(\'admin::settings::pay::services::bepaid::instruction::step_2_title\')} <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/bepaid-help2.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> {tr(\'admin::settings::pay::services::bepaid::instruction::step_3_title\')} <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/bepaid-help3.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> {tr(\'admin::settings::pay::services::bepaid::instruction::step_4_title\')} <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/bepaid-help4.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> {tr(\'admin::settings::pay::services::bepaid::instruction::step_5_title\')} <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/bepaid-help5.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> {tr(\'admin::settings::pay::services::bepaid::instruction::step_6_title\')} </li> <li data-is="raw" content="{tr(\'admin::settings::pay::services::bepaid::instruction::step_7_title\', { href: this.meta.urlTestLanguage })}"></li> </ol> </div>',"",'class="pay-service-bepaid-tab-instruction {opts.class}"',(function(e){this.meta={get urlTestLanguage(){return"ru"===flexbe.vars.user.lang?"https://docs.bepaid.tech/ru/integration/testing/":"https://docs.bepaid.tech/en/integration/testing/"}}})),riot3.tag2("pay-service-bepaid-tab-desc",'<div class="content-block" data-is="raw" content="{state.desc}"></div>',"",'class="pay-service-bepaid-tab-desc {opts.class}"',(function(e){this.state={desc:this.$state.info.desc}}));const zd={tabs:[{type:"settings",title:tr("admin::apps::common::tab_settings"),contentTag:"pay-service-bepaid-tab-settings",show:"enabled"},{type:"instruction",title:tr("admin::apps::common::tab_instruction"),contentTag:"pay-service-bepaid-tab-instruction",show:"enabled"},{type:"desc",title:tr("admin::apps::common::tab_desc"),contentTag:"pay-service-bepaid-tab-desc",show:!0}]};riot3.tag2("pay-service-stripe-tab-settings",'<div class="content-block"> <div class="field-title">{tr(\'admin::settings::pay::services::stripe::settings::api_settings_title\')}</div> <div class="row"> <div class="col col-12"> <div class="label">{tr(\'admin::settings::pay::services::stripe::settings::public_key_label\')}</div> <div data-is="flexbe-input" placeholder="{tr(\'admin::settings::pay::services::stripe::settings::public_key_label\')}" riot-value="{fields.publicKey.value}" error="{!fields.publicKey.valid}" error-tip="{fields.publicKey.error}" onchange="{fields.publicKey.onchange}"> </div> </div> </div> <div class="row"> <div class="col col-12"> <div class="label">{tr(\'admin::settings::pay::services::stripe::settings::secret_key_label\')}</div> <div data-is="flexbe-input" placeholder="{tr(\'admin::settings::pay::services::stripe::settings::secret_key_label\')}" riot-value="{fields.secretKey.value}" error="{!fields.secretKey.valid}" error-tip="{fields.secretKey.error}" oninput="{updateSecretKey}" onchange="{fields.secretKey.onchange}"> </div> </div> </div> <div class="row"> <div class="col col-12"> <div class="label">{tr(\'admin::settings::pay::services::stripe::settings::webhook_secret_label\')}</div> <div data-is="flexbe-input" placeholder="{tr(\'admin::settings::pay::services::stripe::settings::webhook_secret_label\')}" riot-value="{fields.webhookSecret.value}" error="{!fields.webhookSecret.valid}" error-tip="{fields.webhookSecret.error}" onchange="{fields.webhookSecret.onchange}"> </div> </div> </div> </div> <div data-is="settings-block-pay-custom-url" success="{fields.customUrlSuccess}" fail="{fields.customUrlFail}" active="{fields.isCustomUrl}"></div> <div data-is="element-pay-service-save" class="content-block shade"></div>',"",'class="pay-service-stripe-tab-settings {opts.class}"',(function(e){this.fields={publicKey:Md(this,"public_key"),secretKey:Md(this,"secret_key"),webhookSecret:Md(this,"webhook_secret"),customUrlSuccess:Md(this,"custom_url_success"),customUrlFail:Md(this,"custom_url_fail"),isCustomUrl:Md(this,"is_custom_url")},this.updateSecretKey=function(e){this.fields.secretKey.value=e.target.value,this.update()}.bind(this)})),riot3.tag2("pay-service-stripe-tab-instruction",'<div class="content-block"> <ol> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::stripe::instruction::step_1_title\', { href: \'https://stripe.com/\' })}"></span> <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/stripe-help1.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::stripe::instruction::step_2_title\')}"></span> <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/stripe-help2.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::stripe::instruction::step_3_title\')}"></span> <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/stripe-help3.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::stripe::instruction::step_4_title\')}"></span> <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/stripe-help4.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::stripe::instruction::step_5_title\')}"></span> <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/stripe-help5.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> </ol> </div>',"",'class="pay-service-stripe-tab-instruction {opts.class}"',(function(e){})),riot3.tag2("pay-service-stripe-tab-desc",'<div class="content-block" data-is="raw" content="{state.desc}"></div>',"",'class="pay-service-stripe-tab-desc {opts.class}"',(function(e){this.state={desc:this.$state.info.desc}}));const qd={tabs:[{type:"settings",title:tr("admin::apps::common::tab_settings"),contentTag:"pay-service-stripe-tab-settings",show:"enabled"},{type:"instruction",title:tr("admin::apps::common::tab_instruction"),contentTag:"pay-service-stripe-tab-instruction",show:"enabled"},{type:"desc",title:tr("admin::apps::common::tab_desc"),contentTag:"pay-service-stripe-tab-desc",show:!0}]};riot3.tag2("pay-service-yookassa-tab-settings",'<div class="content-block"> <div class="field-title"></div> <div class="row"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::yandex::settings::work_mode_title\')}</div> <div data-is="flexbe-buttons-line" class="is-group" role="radio" list="{meta.work_modes}" riot-value="{fields.mode.value}" onchange="{fields.mode.onchange}"> </div> </div> </div> </div> <div class="content-block" if="{meta.methods && meta.methods.length}"> <div class="field-title">{tr(\'admin::settings::pay::services::yandex::settings::conn_method_title\')}</div> <div data-is="flexbe-group-radio" class="is-inline" input-class="large" riot-value="{fields.method.value}" onchange="{fields.method.onchange}" list="{meta.methods}"> </div> </div> <virtual class="content-wrap" if="{fields.method.value === \'api\'}"> <div class="content-block"> <div class="field-title">{tr(\'admin::settings::pay::services::yandex::settings::api_settings_title\')}</div> <div class="row"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::yandex::settings::shop_id_label\')}</div> <div data-is="flexbe-input" placeholder="56010" riot-value="{fields.shopId.value}" error="{!fields.shopId.valid}" error-tip="{fields.shopId.error}" onchange="{fields.shopId.onchange}" name="youkassa_shop_id"> </div> </div> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::yandex::settings::secret_key_label\')}</div> <div data-is="flexbe-input" placeholder="secret_password" riot-value="{fields.secretKey.value}" error="{!fields.secretKey.valid}" error-tip="{fields.secretKey.error}" onchange="{fields.secretKey.onchange}" name="youkassa_secret_key"> </div> </div> </div> </div> <div class="content-block"> <div class="field-title">{tr(\'admin::settings::pay::support_types::title\')}</div> <div data-is="flexbe-group-checkbox" type="toggle" input-class="large" riot-value="{fields.supportTypes.value}" list="{meta.support_types}" onchange="{fields.supportTypes.onchange}"> </div> </div> </virtual> <virtual class="content-wrap" if="{fields.method.value === \'http\'}"> <div class="content-block"> <div class="field-title">{tr(\'admin::settings::pay::services::yandex::settings::http_settings_title\')}</div> <div class="row"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::yandex::settings::shop_id_label\')}</div> <div data-is="flexbe-input" placeholder="56010" riot-value="{fields.shopIdHttp.value}" error="{!fields.shopIdHttp.valid}" error-tip="{fields.shopIdHttp.error}" onchange="{fields.shopIdHttp.onchange}"> </div> </div> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::yandex::settings::sc_id_label\')}</div> <div data-is="flexbe-input" placeholder="43459" riot-value="{fields.scIdHttp.value}" error="{!fields.scIdHttp.valid}" error-tip="{fields.scIdHttp.error}" onchange="{fields.scIdHttp.onchange}"> </div> </div> </div> <div class="row"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::yandex::settings::shop_pass_label\')}</div> <div data-is="flexbe-input" placeholder="shop_password" riot-value="{fields.shopPwdHttp.value}" error="{!fields.shopPwdHttp.valid}" error-tip="{fields.shopPwdHttp.error}" onchange="{fields.shopPwdHttp.onchange}"> </div> </div> </div> </div> <div class="content-block"> <div class="field-title">{tr(\'admin::settings::pay::support_types::title\')}</div> <div data-is="flexbe-group-checkbox" type="toggle" input-class="large" list="{meta.support_types_http}" riot-value="{fields.supportTypesHttp.value}" onchange="{fields.supportTypesHttp.onchange}"> </div> </div> </virtual> <div class="content-block" data-is="element-pay-service-ofd-setup"></div> <div data-is="settings-block-pay-custom-url" success="{fields.customUrlSuccess}" fail="{fields.customUrlFail}" active="{fields.isCustomUrl}"></div> <div class="content-block shade" data-is="element-pay-service-save"></div>',"",'class="pay-service-yookassa-tab-settings {opts.class}"',(function(e){this.meta={...this.$state.meta,...this.$state.info.meta},this.fields={mode:Md(this,"mode",{type:"radio"}),method:Md(this,"current_payment_method",{type:"radio"}),customUrlSuccess:Md(this,"custom_url_success"),customUrlFail:Md(this,"custom_url_fail"),isCustomUrl:Md(this,"is_custom_url"),shopId:Md(this,"payment_methods.api.shop_id"),secretKey:Md(this,"payment_methods.api.secret_password"),supportTypes:Md(this,"payment_methods.api.support_types",{type:"group_checkbox"}),shopIdHttp:Md(this,"payment_methods.http.shop_id"),scIdHttp:Md(this,"payment_methods.http.sc_id"),shopPwdHttp:Md(this,"payment_methods.http.shop_password"),supportTypesHttp:Md(this,"payment_methods.http.support_types",{type:"group_checkbox"})}})),riot3.tag2("pay-service-yookassa-testpayment",'<ol> <li> {tr(\'admin::settings::pay::services::yookassa::testing::step_1\')} </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::yookassa::testing::step_2\')}"></span> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::yookassa::testing::step_3\')}"></span> </li> <li> {tr(\'admin::settings::pay::services::yookassa::testing::step_4\')} </li> <li> {tr(\'admin::settings::pay::services::yookassa::testing::step_5\')} <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/yookassa-test_help1.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> {tr(\'admin::settings::pay::services::yookassa::testing::step_6\')} <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/yookassa-test_help2.png">{tr(\'admin::settings::apps::example_button\')}</a> <div class="p info-box my10"> <div class="note"><strong>{tr(\'admin::settings::pay::services::yandex::testing::card_type_title\')}:</strong> {type.cardType}</div> <div class="note"><strong>{tr(\'admin::settings::pay::services::yandex::testing::card_number_title\')}:</strong> {type.cardNumber}</div> <div class="note"><strong>{tr(\'admin::settings::pay::services::yandex::testing::card_ex_title\')}:</strong> {type.expDate}</div> <div class="note"><strong>{tr(\'admin::settings::pay::services::yandex::testing::card_cvv_title\')}:</strong> {type.cvv} </div> </div> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::yookassa::testing::step_7\')}"></span> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::yookassa::testing::step_8\')}"></span> </li> </ol>',"",'class="pay-service-yookassa-testpayment flexbe-modal-content {opts.class}"',(function(e){this.types={api:{cardType:"Visa",cardNumber:"1111 1111 1111 1026",expDate:tr("admin::settings::pay::services::yandex::testing::card_ex_value"),cvv:"000"},http:{cardType:"Visa",cardNumber:"4444 4444 4444 4448",expDate:tr("admin::settings::pay::services::yandex::testing::card_ex_value"),cvv:"000"}},this.type=this.types[e.method||"api"]})),riot3.tag2("pay-service-yookassa-tab-instruction",'<div class="content-block"> <ol> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::yookassa::instruction::step_1_title\', { href: \'https://yookassa.ru/joinups/\' })}"></span> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::yookassa::instruction::step_2_title\')}"></span> <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/yookassa-help1.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::yookassa::instruction::step_3_title\')}"></span> <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/yookassa-help2.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> {tr(\'admin::settings::pay::services::yookassa::instruction::step_4_title\')} <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/yookassa-help3.png">{tr(\'admin::settings::apps::example_button\')}</a> <div class="info-box my10"> <virtual if="{state.method === \'api\' || state.method === \'all\'}"> <div class="p"> <div class="note unselectable">API URL</div> <div class="text">{meta.api_url}</div> </div> </virtual> <virtual if="{state.method === \'http\' || state.method === \'all\'}"> <div class="p"> <div class="note unselectable">Check URL</div> <div class="text">{meta.check_url}</div> </div> <div class="p"> <div class="note unselectable">Aviso URL</div> <div class="text">{meta.aviso_url}</div> </div> </virtual> </div> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::yookassa::instruction::step_5_title\')}"></span> <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/yookassa-help4.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::yookassa::instruction::step_6_title\')}"></span> <a class="modal-img-link style-link" href="/_s/images/admin/settings/pay/help/yookassa-help5.png">{tr(\'admin::settings::apps::example_button\')}</a> </li> <li> <span class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::yookassa::instruction::step_7_title\')}"></span> </li> <li> {tr(\'admin::settings::pay::services::yookassa::instruction::step_8_title\')} <a onclick="{showTestPayment}">{tr(\'admin::settings::pay::services::yandex::instruction::step_6_help\')}</a> </li> </ol> </div>',"",'class="pay-service-yookassa--tab-instruction {opts.class}"',(function(e){const t=this;this.meta={...this.$state.info.meta},this.state={get method(){return t.$store.helpers.getField("current_payment_method")||"api"}},this.showTestPayment=function(e){e.preventDefault(),Zs.create({title:tr("admin::settings::pay::services::yandex::testing::title"),overlay:!0,shadow:!0,handle:!1,uiClass:"content-ui",width:540,riotTag:"pay-service-yookassa-testpayment",props:{method:this.state.method}})}.bind(this)})),riot3.tag2("pay-service-yookassa-tab-desc",'<div class="content-block" data-is="raw" content="{state.desc}"></div>',"",'class="pay-service-yookassa-tab-desc {opts.class}"',(function(e){this.state={desc:this.$state.info.desc}}));const Gd={tabs:[{type:"settings",title:tr("admin::apps::common::tab_settings"),contentTag:"pay-service-yookassa-tab-settings",show:"enabled"},{type:"instruction",title:tr("admin::apps::common::tab_instruction"),contentTag:"pay-service-yookassa-tab-instruction",show:"enabled"},{type:"desc",title:tr("admin::apps::common::tab_desc"),contentTag:"pay-service-yookassa-tab-desc",show:!0}]};riot3.tag2("pay-service-paypal-tab-settings",'<div class="content-block"> <div class="field-title">{tr(\'admin::settings::pay::services::paypal::settings::api_settings_title\')}</div> <div class="row"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::paypal::settings::work_mode_label\')}</div> <div data-is="flexbe-buttons-line" class="is-group" role="radio" list="{meta.work_modes}" riot-value="{fields.mode.value}" onchange="{fields.mode.onchange}"> </div> </div> </div> <div class="row" if="{fields.mode.value === \'debug\'}"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::paypal::settings::api_name_sandbox_label\')}</div> <div data-is="flexbe-input" riot-value="{fields.sandbox_api_name.value}" error="{!fields.sandbox_api_name.valid}" error-tip="{fields.sandbox_api_name.error}" onchange="{fields.sandbox_api_name.onchange}" name="paypal_api_username"> </div> </div> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::paypal::settings::api_pass_sandbox_label\')}</div> <div data-is="flexbe-input" riot-value="{fields.sandbox_api_pass.value}" error="{!fields.sandbox_api_pass.valid}" error-tip="{fields.sandbox_api_pass.error}" onchange="{fields.sandbox_api_pass.onchange}" name="paypal_api_password"> </div> </div> <div class="col col-6" style="margin-top:10px;"> <div class="label">{tr(\'admin::settings::pay::services::paypal::settings::api_sig_sandbox_label\')}</div> <div data-is="flexbe-input" riot-value="{fields.sandbox_api_sig.value}" error="{!fields.sandbox_api_sig.valid}" error-tip="{fields.sandbox_api_sig.error}" onchange="{fields.sandbox_api_sig.onchange}" name="paypal_api_signature"> </div> </div> </div> <div if="{fields.mode.value === \'work\'}" class="row"> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::paypal::settings::api_name_label\')}</div> <div data-is="flexbe-input" riot-value="{fields.api_name.value}" error="{!fields.api_name.valid}" error-tip="{fields.api_name.error}" onchange="{fields.api_name.onchange}"> </div> </div> <div class="col col-6"> <div class="label">{tr(\'admin::settings::pay::services::paypal::settings::api_pass_label\')}</div> <div data-is="flexbe-input" riot-value="{fields.api_pass.value}" error="{!fields.api_pass.valid}" error-tip="{fields.api_pass.error}" onchange="{fields.api_pass.onchange}"> </div> </div> <div class="col col-6 mt10"> <div class="label">{tr(\'admin::settings::pay::services::paypal::settings::api_sig_label\')}</div> <div data-is="flexbe-input" riot-value="{fields.api_sig.value}" error="{!fields.api_sig.valid}" error-tip="{fields.api_sig.error}" onchange="{fields.api_sig.onchange}"> </div> </div> </div> </div> <div class="content-block"> <div class="info-box info-box-text"> <span>{tr(\'admin::settings::pay::services::paypal::settings::currency\')} {fields.currency.value}</span> <span if="{projectIsRussian}"><br> {tr(\'admin::settings::pay::services::paypal::ofd\')}</span> </div> </div> <div data-is="settings-block-pay-custom-url" success="{fields.customUrlSuccess}" fail="{fields.customUrlFail}" active="{fields.isCustomUrl}"></div> <div data-is="element-pay-service-save" class="content-block shade"></div>',"",'class="pay-service-paypal-tab-settings {opts.class}"',(function(e){const t=this.$state.info?.meta||{},s=this.$state?.settings||{};this.projectIsRussian=s.projectIsRussian,this.meta={method:t.method,resultUrl:`${location.origin}${t.result_url}`,successUrl:`${location.origin}${t.success_url}`,failUrl:`${location.origin}${t.fail_url}`,work_modes:t.work_modes,...this.$state.meta},this.fields={mode:Md(this,"mode",{type:"radio"}),currency:Md(this,"currency"),api_name:Md(this,"api_name"),api_pass:Md(this,"api_pass"),api_sig:Md(this,"api_sig"),sandbox_api_name:Md(this,"sandbox_api_name"),sandbox_api_pass:Md(this,"sandbox_api_pass"),sandbox_api_sig:Md(this,"sandbox_api_sig"),customUrlSuccess:Md(this,"custom_url_success"),customUrlFail:Md(this,"custom_url_fail"),isCustomUrl:Md(this,"is_custom_url")},this.sprite=flexbe.lib.getSprite("settings","admin")})),riot3.tag2("pay-service-paypal-testpayment",'<p class="text mt0" data-is="raw" content="{tr(\'admin::settings::pay::services::paypal::testing::step_1\')}"></p> <p class="text" data-is="raw" content="{tr(\'admin::settings::pay::services::paypal::testing::step_2\')}"></p> <p class="text mb0" data-is="raw" content="{tr(\'admin::settings::pay::services::paypal::testing::step_3\')}"></p>',"",'class="pay-service-paypal-testpayment flexbe-modal-content {opts.class}"',(function(e){})),riot3.tag2("pay-service-paypal-tab-instruction","<div class=\"content-block\"> <div class=\"paypal-instuction\" data-is=\"raw\" content=\"{tr('admin::settings::pay::services::paypal::instruction::desc',             { href1: 'https://www.sandbox.paypal.com/bizsignup/',               href2: 'https://www.paypal.com/bizsignup/',               href3: 'https://www.sandbox.paypal.com/businessprofile/mytools/apiaccess/firstparty/signature',               href4: 'https://www.paypal.com/businessprofile/mytools/apiaccess/firstparty/signature'             })}\"> </div> </div>","",'class="pay-service-paypal-tab-instruction {opts.class}"',(function(e){const t=this.$state.info?.meta||{};this.meta={method:t.method,resultUrl:`${location.origin}${t.result_url}`,successUrl:`${location.origin}${t.success_url}`,failUrl:`${location.origin}${t.fail_url}`},this.showTestPayment=function(e){e.preventDefault(),Zs.create({title:tr("admin::settings::pay::services::paypal::testing::title"),overlay:!0,shadow:!0,handle:!1,width:500,uiClass:"editor-ui",riotTag:"pay-service-paypal-testpayment"})}.bind(this)})),riot3.tag2("pay-service-paypal-tab-desc",'<div class="content-block paypal-desc" data-is="raw" content="{state.desc}"></div>',"",'class="pay-service-paypal-tab-desc {opts.class}"',(function(e){this.state={desc:this.$state.info.desc}}));const Xd={tabs:[{type:"settings",title:tr("admin::apps::common::tab_settings"),contentTag:"pay-service-paypal-tab-settings",show:"enabled"},{type:"instruction",title:tr("admin::apps::common::tab_instruction"),contentTag:"pay-service-paypal-tab-instruction",show:"enabled"},{type:"desc",title:tr("admin::apps::common::tab_desc"),contentTag:"pay-service-paypal-tab-desc",show:!0}]};riot3.tag2("settings-section-pay-service",'<div data-is="element-store-app-header" class="group-content slide-down-animation" enabled="{state.enabled}" status="{state.status}" loading="{state.loading}" icon="{state.info.icon_small}" title="{state.info.title}" onenable="{enableService}" ondisable="{disableService}"></div> <div data-is="element-store-app-description" class="group-content flexbe-white-box shadow content-ui slide-down-animation" tabs="{state.tabs}" active="{state.activeTab}" select="{selectTab}"></div>',"",'class="settings-section-pay-service group-list pb60 {opts.class}"',(function(e){this.mixin("initMobx");const t={cash:Dd,robokassa:Vd,tinkoff:Od,yandexkassa:Gd,paypal:Xd,bepaid:zd,stripe:qd},s=this;this.state={loading:0,activeTab:flexbe.routing.hash,get enabled(){return s.$state.active},get status(){const e=this.enabled,t=s.$state.work_active_mode??1;return e&&t?"success":"inactive"},get info(){return s.$state.info||{}},get tabs(){const e=s.$state.name,i=t[e];return(i&&i.tabs||[]).filter((e=>"enabled"!==e.show||this.enabled))}},this.watch={"state.enabled":()=>{this.state.tabs[0]&&(this.state.activeTab=this.state.tabs[0].type)},"state.activeTab":()=>{history.replaceState(history.state,"",`#${s.state.activeTab}`)}},this.selectTab=function(e){this.state.activeTab=e.type}.bind(this),this.enableService=function(){return this.toggleService(1)}.bind(this),this.disableService=function(){return this.toggleService(0)}.bind(this),this.toggleService=async function(e){this.state.loading=!0;try{await this.$store.dispatch("toggleService",e)}catch(e){if("NetworkError"!==e.name)throw e;toast.error(e.message)}this.state.loading=!1,this.update()}.bind(this),this.onBeforeMount=function(){this.state.activeTab&&this.state.tabs.find((e=>e.type===this.state.activeTab))||(this.state.activeTab=this.state.tabs[0].type)}.bind(this)})),riot3.tag2("settings-block-pay-custom-url",'<div class="field-title">{tr(\'admin::settings::pay::service::custom_url::title\')}</div> <div class="row"> <div class="col"> <label class="large" data-is="flexbe-input" type="toggle" checked="{state.valueActive}" onchange="{changeActive}"> <span class="flexbe-text">{tr(\'admin::settings::pay::service::custom_url::user_page\')}</span> <q data-is="flexbe-tooltip">{tr(\'admin::settings::pay::service::custom_url::user_page_tips\')}</q> </label> </div> </div> <div if="{state.valueActive}" class="row"> <div if="{state.success}" class="col col-6"> <div class="label">{tr(\'admin::settings::pay::service::custom_url::pay_success\')}</div> <div data-is="flexbe-input" placeholder="my_domain.com/success/" riot-value="{state.success.value}" error="{!state.success.valid}" error-tip="{state.success.error}" onchange="{changeLink.bind(tag, state.success)}"></div> </div> <div if="{state.fail}" class="col col-6"> <div class="label">{tr(\'admin::settings::pay::service::custom_url::pay_error\')}</div> <div data-is="flexbe-input" placeholder="my_domain.com/fail/" riot-value="{state.fail.value}" error="{!state.fail.valid}" error-tip="{state.fail.error}" onchange="{changeLink.bind(tag, state.fail)}"></div> </div> </div>',"",'class="content-block {opts.class}"',(function(e){const t=this;this.tag=this,this.state={get active(){return t.opts.active},get valueActive(){return JSON.parse(this.active.value)||!1},get fail(){return t.opts?.fail||!1},get success(){return t.opts?.success||!1}},this.changeLink=function(e,t){let s=t.target.value;""!==s?(t.target.value=rr(s,{relativePathname:!0,leadingSlash:!0}),s=t.target.value,ir(s,{fullLink:!0})||"/"!==s[0]&&(t.target.value=`/${s}`),e.onChange(t)):e.onChange(t)}.bind(this),this.changeActive=function(e){this.state.active.setValue(e.target.checked,"change")}.bind(this)})),riot3.tag2("settings-section-fonts",'<div class="group-list slide-down-animation"> <div data-is="settings-block-fonts-sets" class="group-content"></div> <div data-is="settings-block-myfonts" class="group-content"></div> </div>',"",'class="settings-section-fonts pb60 {opts.class}"',(function(e){}));const Kd=(e,t)=>`${e}:${t=t.replace(/[\s+]/g,"_").toLowerCase()}`;let Wd=[];const Zd=new class{async saveProjectFontsSet(e){return ii(`/admin/api/project/${flexbe.vars.group.id}/settings/fonts/set/`,{asJson:!0,data:{set:e}})}async saveMyFontsList(e){return ii(`/admin/api/project/${flexbe.vars.group.id}/settings/fonts/set/`,{asJson:!0,data:{my_fonts:e}})}async loadLocalFonts(){return["Arial","Helvetica","Courier New","Georgia","Tahoma","Times New Roman","Verdana"].map((e=>({family:e,source:"system",fontId:Kd("system",e)})))}async loadMyFonts(e={}){const t=flexbe.vars.group.id;return(await ai(`/admin/api/project/${t}/settings/fonts/`,{data:e})).data.my_fonts.map((e=>({fontId:Kd("user",e.id),source:"user",family:e.name,variants:e.variants})))}async loadGoogleFonts(e={}){if(!Wd||!Wd.length){const t=await ai("/admin/api/fonts/",{data:{fields:"items(family,subsets)",subsets:"ru"===flexbe.vars.group.langTemplate?["cyrillic"]:["cyrillic","latin"],...e}});t.items&&(Wd=[...t.items].map((e=>({fontId:Kd("google",e.family),...e}))))}return Wd}getCssFontFaces(e){return e.filter((e=>e&&Array.isArray(e.variants))).flatMap((e=>{const t={};return e.variants.forEach((e=>{const{weight:s,style:i,fileName:a,format:n}=e,r=`${s}:${i}`;t[r]||(t[r]={weight:s,style:i,src:[]}),t[r].src.push(`url("/files/${a}") format("${n}")`)})),Object.values(t).map((t=>["@font-face {",`  font-family: "${e.family}";`,`  font-weight: ${t.weight};`,`  font-style: ${t.style};`,`  src: ${t.src.join(", ")};`,"  font-display: swap;","}"].join("\n")))})).join("\n")}getGoogleFontsLink(e,t=[]){const s=e.filter((e=>e&&"google"===e.source)).map((e=>e.family.replace(/\s/g,"+")));if(!s.length)return null;const i=t.length?`:ital,wght@${t.map((e=>`0,${e}`)).join(";")};${t.map((e=>`1,${e}`)).join(";")}`:"";return`https://fonts.googleapis.com/css2?display=swap&${s.map((e=>`family=${e}${i}`)).join("&")}`}getFontStylesCss(e){return e.map((e=>{let t=`.text-style-${e.type}`;return"content"===e.type&&(t+=", body"),`${t} { font-family: ${function(e){if(!e)return;return e=e.replace(/["']/g,"").split(",").map((e=>e.trim())).map((e=>e.includes(" ")?`"${e}"`:e)).join(",")}(e.family)}, Helvetica, Arial, sans-serif }`})).join("\n")}};const Yd={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={sprite:at("fonts","admin/settings"),get variant(){return e.props.variant},get selectedValue(){return`${this.weight}:${this.style}`},get name(){return this.variant.fileName},get weight(){return this.variant.weight},get style(){return this.variant.style},get icon(){const e=this.variant.format.replace("woff2","woff");return`${this.sprite}#format_${e}`}},this.meta={styles:[{value:"100:normal",weight:100,style:"normal",rexp:/(thin|extra[ -]?light|100|200)/i,title:"100 Thin"},{value:"100:italic",weight:100,style:"italic",rexp:/(thin|extra[ -]?light|100|200)/i,title:"100 Thin Italic"},{value:"300:normal",weight:300,style:"normal",rexp:/(light|300)/i,title:"300 Light"},{value:"300:italic",weight:300,style:"italic",rexp:/(light|300)/i,title:"300 Light Italic"},{value:"400:normal",weight:400,style:"normal",rexp:/(normal|regular|400)/i,title:"400 Regular"},{value:"400:italic",weight:400,style:"italic",rexp:/(normal|regular|400)/i,title:"400 Regular Italic"},{value:"500:normal",weight:500,style:"normal",rexp:/(medium|500)/i,title:"500 Medium"},{value:"500:italic",weight:500,style:"italic",rexp:/(medium|500)/i,title:"500 Medium Italic"},{value:"600:normal",weight:600,style:"normal",rexp:/(semi-?bold|demi-?bold|600)/i,title:"600 Semi-Bold"},{value:"600:italic",weight:600,style:"italic",rexp:/(semi-?bold|demi-?bold|600)/i,title:"600 Semi-Bold Italic"},{value:"700:normal",weight:700,style:"normal",rexp:/(bold|700)/i,title:"700 Bold"},{value:"700:italic",weight:700,style:"italic",rexp:/(bold|700)/i,title:"700 Bold Italic"},{value:"900:normal",weight:900,style:"normal",rexp:/(black|heavy|(extra|ultra)[ -]?bold|800|900)/i,title:"900 Black"},{value:"900:italic",weight:900,style:"italic",rexp:/(black|heavy|(extra|ultra)[ -]?bold|800|900)/i,title:"900 Black Italic"}]}}},template:(e,t,s,i)=>e('<div expr1359="expr1359" is="flexbe-input" class="font-face-item__name"></div><div expr1360="expr1360" is="proxy" data-is="flexbe-select" class="font-face-item__weight"></div><div class="flexbe-action-buttons"><div expr1361="expr1361" class="action-button"><svg class="flexbe-icon size-16"><use expr1362="expr1362"/></svg></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["font-face-item ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.name},{type:t.ATTRIBUTE,name:"readonly",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"prefixIcon",evaluate:e=>e.state.icon}],redundantAttribute:"expr1359",selector:"[expr1359]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.selectedValue},{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.styles},{type:t.EVENT,name:"onchange",evaluate:e=>e.props.setWeight}],redundantAttribute:"expr1360",selector:"[expr1360]"},{redundantAttribute:"expr1361",selector:"[expr1361]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.props.onRemove}]},{redundantAttribute:"expr1362",selector:"[expr1362]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#remove"].join("")}]}]),name:"font-face-item"};e(Yd.name,Yd);const Jd={css:null,exports:{components:{"font-face-item":Yd},setup(e,{initMobx:t,inject:s}){t({deep:!0});const i=h(e.props.variants)||[];this.modal=s("modal"),this.state={uploadings:new Set,sprite:at("fonts","admin/settings"),saving:!1,name:e.props.name||"",list:e.props.list||[],variants:i,hasUploadedFonts:i.length>0,get errorText(){return this.name?this.list.find((e=>e.name===this.name.trim()))?tr("admin::settings::fonts::edit::font_name_exist_error"):null:tr("admin::settings::fonts::edit::font_name_empty_error")}},this.meta={nameMaxLength:32,multiUpload:!0,uploadType:"file",acceptedExtensions:["ttf","otf","woff","woff2"]},this.watch={"state.name":()=>{this.update(),this.modal.unsaved()},"state.variants":[()=>{this.update(),this.modal.updatePosition(),this.modal.unsaved()},{deep:!0}]}},normalizeName:e=>e.replace(/[^\w +-]/gi,""),setName(e){this.state.name=e.target.value},removeVariant(e){const t=this.state.variants.indexOf(e);this.state.variants.splice(t,1)},changeVariant(e,t){e.style=t.style,e.weight=t.weight},uploadVariantStart(e){this.state.uploadings.add(e)},uploadVariantDone(e,t){const s=t.f_name,i=t.f_name_info.ext,a={ttf:"truetype",otf:"opentype"}[n=i]||n;var n;const{weight:o,style:l}=function(e){const t=/italic/i.test(e)?"italic":"normal",s=[{value:"100:normal",weight:100,style:"normal",rexp:/(thin|extra[ -]?light|100|200)/i,title:"100 Thin"},{value:"100:italic",weight:100,style:"italic",rexp:/(thin|extra[ -]?light|100|200)/i,title:"100 Thin Italic"},{value:"300:normal",weight:300,style:"normal",rexp:/(light|300)/i,title:"300 Light"},{value:"300:italic",weight:300,style:"italic",rexp:/(light|300)/i,title:"300 Light Italic"},{value:"400:normal",weight:400,style:"normal",rexp:/(normal|regular|400)/i,title:"400 Regular"},{value:"400:italic",weight:400,style:"italic",rexp:/(normal|regular|400)/i,title:"400 Regular Italic"},{value:"500:normal",weight:500,style:"normal",rexp:/(medium|500)/i,title:"500 Medium"},{value:"500:italic",weight:500,style:"italic",rexp:/(medium|500)/i,title:"500 Medium Italic"},{value:"600:normal",weight:600,style:"normal",rexp:/(semi-?bold|demi-?bold|600)/i,title:"600 Semi-Bold"},{value:"600:italic",weight:600,style:"italic",rexp:/(semi-?bold|demi-?bold|600)/i,title:"600 Semi-Bold Italic"},{value:"700:normal",weight:700,style:"normal",rexp:/(bold|700)/i,title:"700 Bold"},{value:"700:italic",weight:700,style:"italic",rexp:/(bold|700)/i,title:"700 Bold Italic"},{value:"900:normal",weight:900,style:"normal",rexp:/(black|heavy|(extra|ultra)[ -]?bold|800|900)/i,title:"900 Black"},{value:"900:italic",weight:900,style:"italic",rexp:/(black|heavy|(extra|ultra)[ -]?bold|800|900)/i,title:"900 Black Italic"}].filter((e=>e.style===t)).filter((t=>t.rexp.test(e))).sort((e=>[100,600,900].includes(e.weight)?-1:0))[0];return{weight:(null==s?void 0:s.weight)||400,style:(null==s?void 0:s.style)||t}}(s),d={fileExt:i,fileName:s,format:a,weight:o,style:l};r((()=>{this.state.uploadings.delete(e),this.state.variants.push(d),this.state.name||(this.state.name=function(e){return e.replace(/\.\w{3,5}$/i,"").replace(/[_-]/g," ").replace(/[^\s\w]/g,"").replace(/(font|fonts|update|light|heavy|extra|ultra|bold|normal|regular|thin|mono|italic|\d{3})/gi," ").replace(/\s+/g," ").trim().split(" ").filter((e=>e)).map((e=>{return(t=e)&&"string"==typeof t?t[0].toUpperCase()+t.slice(1,t.length):t;var t})).join(" ")}(s)),this.state.hasUploadedFonts||(this.state.variants=[...this.state.variants].sort(((e,t)=>e.weight<t.weight?-1:1))),0===this.state.uploadings.size&&(this.state.hasUploadedFonts=!!this.state.variants.length)}))},uploadVariantError(e,t){this.state.uploadings.delete(e),toast.error(tr("admin::settings::fonts::edit::upload_error_toast")),console.error("Upload error: ",e,t)},onCopy(){const e=Zd.getCssFontFaces([{source:"user",family:this.state.name,variants:this.state.variants}]);Hi.setData(e),toast.done(tr("main::toast::copied"))},async onSave(){const e=this.state.name.slice(0,this.meta.nameMaxLength).trim(),t=this.state.variants||[];if(this.state.saving||this.state.errorText||!t.length)this.modal.shake();else{this.state.saving=!0,this.update();try{await this.props.onSave({name:e,variants:t}),this.modal.close()}catch(e){console.error(e),this.state.saving=!1,this.update()}}}},template:(e,t,s,i)=>e('<div expr1118="expr1118" class="flexbe-field-group not-uploaded"></div><template expr1122="expr1122"></template>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"settings-myfonts-add_font flexbe-modal-content"}]},{type:s.IF,evaluate:e=>!e.state.hasUploadedFonts,redundantAttribute:"expr1118",selector:"[expr1118]",template:e('<svg class="flexbe-icon size-28"><use expr1119="expr1119"/></svg><span expr1120="expr1120" class="flexbe-text"> </span><div expr1121="expr1121" is="proxy" data-is="flexbe-button-upload" regular-class="is-primary" drop-zone=".settings-myfonts-add_font"></div>',[{redundantAttribute:"expr1119",selector:"[expr1119]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#empty_list"].join("")}]},{redundantAttribute:"expr1120",selector:"[expr1120]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::fonts::edit::upload_font_disclaimer")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"multi",evaluate:e=>e.meta.multiUpload},{type:t.ATTRIBUTE,name:"fileType",evaluate:e=>e.meta.uploadType},{type:t.ATTRIBUTE,name:"extensions",evaluate:e=>e.meta.acceptedExtensions},{type:t.ATTRIBUTE,name:"button-title",evaluate:e=>e.tr("admin::settings::fonts::edit::upload")},{type:t.EVENT,name:"onuploadstart",evaluate:e=>e.uploadVariantStart},{type:t.EVENT,name:"onupload",evaluate:e=>e.uploadVariantDone},{type:t.EVENT,name:"onerror",evaluate:e=>e.uploadVariantError}],redundantAttribute:"expr1121",selector:"[expr1121]"}])},{type:s.IF,evaluate:e=>e.state.hasUploadedFonts,redundantAttribute:"expr1122",selector:"[expr1122]",template:e('<div class="flexbe-field-group w50"><div expr1123="expr1123" class="flexbe-title"> <q expr1124="expr1124" is="flexbe-tooltip"></q></div><div expr1125="expr1125" is="flexbe-input"></div></div><hr class="flexbe-hr my20"/><div class="flexbe-field-group fonts-list"><div expr1126="expr1126" is="font-face-item"></div></div><div class="flexbe-buttons-line"><button expr1127="expr1127"><span expr1128="expr1128" class="flexbe-text"> </span></button><div expr1129="expr1129" is="proxy" data-is="flexbe-button-upload" regular-class="is-secondary" drop-zone=".settings-myfonts-add_font"></div><button expr1130="expr1130" is="flexbe-button" class="flexbe-button is-light filled ml-auto"></button></div><div expr1131="expr1131" class="flexbe-desc"> </div>',[{redundantAttribute:"expr1123",selector:"[expr1123]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::fonts::edit::font_name_label")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::settings::fonts::edit::font_name_tip")}],redundantAttribute:"expr1124",selector:"[expr1124]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.state.errorText},{type:t.ATTRIBUTE,name:"errorTip",evaluate:e=>e.state.errorText},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::settings::fonts::edit::font_name_placeholder")},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.name},{type:t.ATTRIBUTE,name:"maxLength",evaluate:e=>e.meta.nameMaxLength},{type:t.ATTRIBUTE,name:"normalize",evaluate:e=>e.normalizeName},{type:t.EVENT,name:"oninput",evaluate:e=>e.setName},{type:t.EVENT,name:"onchange",evaluate:e=>e.setName}],redundantAttribute:"expr1125",selector:"[expr1125]"},{type:s.EACH,getKey:null,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"font-face-item",slots:[],attributes:[{type:t.ATTRIBUTE,name:"variant",evaluate:e=>e.variant},{type:t.ATTRIBUTE,name:"setWeight",evaluate:e=>t=>e.changeVariant(e.variant,t)},{type:t.EVENT,name:"onRemove",evaluate:e=>()=>e.removeVariant(e.variant)}]}]),redundantAttribute:"expr1126",selector:"[expr1126]",itemName:"variant",indexName:null,evaluate:e=>e.state.variants},{redundantAttribute:"expr1127",selector:"[expr1127]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button is-primary filled ",e.state.saving?"loading":""].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.onSave}]},{redundantAttribute:"expr1128",selector:"[expr1128]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::save")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"multi",evaluate:e=>e.meta.multiUpload},{type:t.ATTRIBUTE,name:"fileType",evaluate:e=>e.meta.uploadType},{type:t.ATTRIBUTE,name:"extensions",evaluate:e=>e.meta.acceptedExtensions},{type:t.ATTRIBUTE,name:"button-title",evaluate:e=>e.tr("admin::settings::fonts::edit::upload_more")},{type:t.EVENT,name:"onuploadstart",evaluate:e=>e.uploadVariantStart},{type:t.EVENT,name:"onupload",evaluate:e=>e.uploadVariantDone},{type:t.EVENT,name:"onerror",evaluate:e=>e.uploadVariantError}],redundantAttribute:"expr1129",selector:"[expr1129]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"icon",evaluate:e=>[e.state.sprite,"#copy-css"].join("")},{type:t.ATTRIBUTE,name:"tip",evaluate:e=>e.tr("admin::settings::fonts::edit::copy_css_tip")},{type:t.EVENT,name:"onclick",evaluate:e=>e.onCopy}],redundantAttribute:"expr1130",selector:"[expr1130]"},{redundantAttribute:"expr1131",selector:"[expr1131]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::fonts::edit::upload_font_disclaimer")].join("")}]}])}]),name:"settings-myfonts-add_font"};e(Jd.name,Jd),riot3.tag2("settings-block-myfonts",'<div class="styles-container"></div> <div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::fonts::my_fonts_title\')}</span> <span data-is="admin-save-text" class="flexbe-desc" status="{state.status}"></span> </div> <div class="flexbe-white-box shadow collection"> <div class="collection-item collection-item--empty" if="{state.isEmpty}"> <svg class="flexbe-icon size-28"> <use riot-href="{state.sprite}#empty_list"></use> </svg> <span class="flexbe-text"> {tr(\'admin::settings::fonts::empty_list_text\')} </span> <div class="flexbe-button small filled is-primary" onclick="{addFontHandler}"> <span class="flexbe-text">{tr(\'admin::settings::fonts::add_font_button\')}</span> </div> </div> <div each="{font in state.list}" key="{font.id}" data-is="element-myfont-item" class="collection-item" font="{font}" onedit="{editFontHandler.bind(tag, font)}" onremove="{removeFontHandler.bind(tag, font)}"></div> <div class="collection-item shade"> <div if="{!state.isEmpty}" class="flexbe-button small filled is-primary" onclick="{addFontHandler}"> <span class="flexbe-text">{tr(\'admin::settings::fonts::add_font_button\')}</span> </div> <div class="flexbe-desc ml10"> {tr(\'admin::settings::fonts::fonts_use_warning_text\')} </div> </div> </div>',"",'class="settings-block-myfonts {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={status:"saved",sprite:at("fonts","admin/settings"),get isEmpty(){return!this.list.length},get list(){return t.$state.my_fonts||[]}},this.watch={"state.list":[()=>this.renderFontFaces()]},this.addFontHandler=function(){!function({onSave:e,list:t}){Zs.create({title:tr("admin::settings::fonts::edit::add_modal_title"),overlay:!0,shadow:!0,clickOut:!0,duplicate:!1,handle:null,width:520,component:Jd,props:{type:"create",list:t,onSave:e}})}({list:this.state.list,onSave:async({name:e,variants:t})=>this.$store.dispatch("addToMyFonts",{name:e,variants:t})})}.bind(this),this.editFontHandler=function(e){const t=this.state.list;!function({font:e,list:t,onSave:s}){Zs.create({title:tr("admin::settings::fonts::edit::edit_modal_title"),overlay:!0,shadow:!0,clickOut:!0,duplicate:!1,handle:null,width:520,component:Jd,props:{type:"edit",name:e.name,variants:e.variants,list:t,onSave:s}})}({font:e,list:t.filter((t=>t!==e)),onSave:async({name:s,variants:i})=>{const a=t.indexOf(e);return this.$store.dispatch("updateFontInMyFonts",a,{name:s,variants:i})}})}.bind(this),this.removeFontHandler=function(e,t){t.stopPropagation();As({clickOut:!0,props:{icon:`${this.state.sprite}#empty_list`,title:tr("admin::settings::fonts::remove_font_title",{name:e.name}),confirmButtonText:tr("main::button::delete"),confirmButtonClass:"is-danger bordered colored",cancelButton:!0,onConfirm:()=>{const t=this.state.list.indexOf(e);return this.$store.dispatch("removeFromMyFonts",t)}}})}.bind(this),this.renderFontFaces=function(){const e=this.state.list.map((e=>({source:"user",id:e.id,family:e.name||e.family,variants:e.variants||[]}))),t=Zd.getCssFontFaces(e);this.root.querySelector(".styles-container").innerHTML=`<style>${t}</style>`}.bind(this),this.onMounted=function(){this.renderFontFaces()}.bind(this)}));const Qd={desc_content:"editor::fonts::desc_content",desc_quote:"editor::fonts::desc_quote",desc_subtitle:"editor::fonts::desc_subtitle",desc_title:"editor::fonts::desc_title",name_content:"editor::fonts::name_content",name_quote:"editor::fonts::name_quote",name_subtitle:"editor::fonts::name_subtitle",name_title:"editor::fonts::name_title","name_title-main":"editor::fonts::name_title_main","desc_title-main":"editor::fonts::name_title_main"},ec={css:null,exports:{setup(e,{initMobx:t,inject:s}){t(),this.modal=s("modal"),this.state={sprite:at("fonts","admin/settings"),get isGlobalPage(){return 4===pageStore.pType},get showPageFontsToggle(){return!this.isGlobalPage&&4===pageStore.themeId},get styles(){return fontsStore.getStyles().map((t=>{const{type:s,source:i}=t;let a=t.family;return"user"===i&&e.meta.myFontsLoaded&&(t=e.meta.myFonts.find((e=>e.fontId===t.fontId)))&&(a=t.family),{type:s,font:t,family:a,source:i,title:tr(Qd[`name_${s}`])||s,description:tr(Qd[`desc_${s}`])||""}}))},get usePageFonts(){return fontsStore.usePageFonts},get updateOnChanges(){return this.styles.map((e=>e.family))}},this.meta={myFontsLoaded:!1,myFonts:[]},this.watch={"state.usePageFonts":()=>this.update(),"state.updateOnChanges":[()=>this.syncMyFonts(),{equals:f.structural}]}},onMounted(){this.syncMyFonts()},selectFontUI(e){const t=e.font,s=e.type;ac.showFontSelectModal({fromModal:this.modal,props:{getSelected:()=>{const e=fontsStore.getStyle(s);return null==e?void 0:e.fontId},selectFont:e=>this.selectFont(s,e),onCancel:()=>this.selectFont(s,t)}})},toggleUsePageFonts(e){fontsStore.toggleUsePageFonts(e.target.checked)},selectFont(e,t){fontsStore.selectFont(e,t)},async syncMyFonts(){const e=$(".styles-container",this.root);this.state.styles.find((e=>"user"===e.source))&&(this.meta.myFontsLoaded=!1,this.meta.myFonts=await Zd.loadMyFonts(),this.meta.myFontsLoaded=!0);const t=Zd.getGoogleFontsLink(this.state.styles.map((e=>e.font))),s=Zd.getCssFontFaces(this.state.styles.map((e=>e.font)));e.empty().append(t?`<link href="${t}" rel="stylesheet">`:"",`<style>${s}</style>`),this.update()}},template:(e,t,s,i)=>e('<div class="styles-container"></div><div expr1132="expr1132" class="use-page-fonts-container"></div><div expr1136="expr1136" class="project-fonts-container flexbe-modal-content"></div><div expr1142="expr1142" class="page-fonts-container"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"fonts-setup"}]},{type:s.IF,evaluate:e=>e.state.showPageFontsToggle,redundantAttribute:"expr1132",selector:"[expr1132]",template:e('<label expr1133="expr1133" is="flexbe-checkbox" type="toggle"></label>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr1134="expr1134" class="flexbe-text"> </span><q expr1135="expr1135" is="flexbe-tooltip"></q>',bindings:[{redundantAttribute:"expr1134",selector:"[expr1134]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("editor::fonts::modal::use_page_fonts_label")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("editor::fonts::modal::use_page_fonts_tip")}],redundantAttribute:"expr1135",selector:"[expr1135]"}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.usePageFonts},{type:t.EVENT,name:"onchange",evaluate:e=>e.toggleUsePageFonts}],redundantAttribute:"expr1133",selector:"[expr1133]"}])},{type:s.IF,evaluate:e=>!e.state.usePageFonts,redundantAttribute:"expr1136",selector:"[expr1136]",template:e('<div expr1137="expr1137" class="flexbe-text mb10"> </div><div class="flexbe-info-box high-contrast as-column"><div expr1138="expr1138" class="flexbe-title"> </div><div expr1139="expr1139" class="flexbe-desc mt10"></div><a class="style-link inline-box mt20" href="/admin/settings/fonts/" target="_blank"><svg class="flexbe-icon size-12"><use expr1140="expr1140"/></svg><span expr1141="expr1141" class="flexbe-text"> </span></a></div>',[{redundantAttribute:"expr1137",selector:"[expr1137]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.isGlobalPage?e.tr("editor::fonts::modal::global_section_fonts_info"):e.tr("editor::fonts::modal::project_fonts_info")].join("")}]},{redundantAttribute:"expr1138",selector:"[expr1138]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("editor::fonts::modal::project_fonts_list_title")}]},{type:s.EACH,getKey:null,condition:null,template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.item.title,"  ",e.item.family].join("")}]}]),redundantAttribute:"expr1139",selector:"[expr1139]",itemName:"item",indexName:null,evaluate:e=>e.state.styles},{redundantAttribute:"expr1140",selector:"[expr1140]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#href"].join("")}]},{redundantAttribute:"expr1141",selector:"[expr1141]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("editor::fonts::modal::fonts_control_link")}]}])},{type:s.IF,evaluate:e=>e.state.usePageFonts,redundantAttribute:"expr1142",selector:"[expr1142]",template:e('<div expr1143="expr1143" class="font-style-item"></div>',[{type:s.EACH,getKey:null,condition:null,template:e('<div expr1144="expr1144"><span expr1145="expr1145" class="flexbe-text"> </span><q expr1146="expr1146" is="flexbe-tooltip"></q><div class="edit-button"><svg class="flexbe-icon size-12"><use expr1147="expr1147"/></svg></div></div><div expr1148="expr1148"> </div>',[{expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.selectFontUI(e.item)}]},{redundantAttribute:"expr1144",selector:"[expr1144]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["font-title ",e.item.font?"":"error"].join("")}]},{redundantAttribute:"expr1145",selector:"[expr1145]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.item.title,"  ",e.item.family].join("")}]},{type:s.IF,evaluate:e=>!e.item.font,redundantAttribute:"expr1146",selector:"[expr1146]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("editor::fonts::modal::font_removed_tip")}]}])},{redundantAttribute:"expr1147",selector:"[expr1147]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#edit"].join("")}]},{redundantAttribute:"expr1148",selector:"[expr1148]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.item.description].join("")},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["font-preview ",e.item.type].join("")},{type:t.ATTRIBUTE,name:"style",evaluate:e=>["--font: '",e.item.family,"'"].join("")}]}]),redundantAttribute:"expr1143",selector:"[expr1143]",itemName:"item",indexName:null,evaluate:e=>e.state.styles}])}]),name:"fonts-setup"};e(ec.name,ec);const tc={css:null,exports:{setup(e,{initMobx:t}){t(),this.state={sprite:at("fonts","admin/settings"),get value(){return e.props.value},get list(){return e.props.list||[]},get active(){return this.list.find((e=>e.value===this.value))}}}},template:(e,t,s,i)=>e('<div expr1363="expr1363" tabindex="0"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["fonts-list ",e.props.class].join("")}]},{type:s.EACH,getKey:e=>e.item.value,condition:null,template:e('<div expr1364="expr1364" class="flexbe-text" is="raw"></div><svg expr1365="expr1365" class="flexbe-icon size-14"></svg>',[{expressions:[{type:t.ATTRIBUTE,name:"data-value",evaluate:e=>e.item.value},{type:t.ATTRIBUTE,name:"class",evaluate:e=>["font-list-item ",e.item===e.state.active?"active":""].join("")},{type:t.ATTRIBUTE,name:"style",evaluate:e=>["--font: '",e.item.family,"'"].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.props.selectFont(e.item)}]},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.item.title}],redundantAttribute:"expr1364",selector:"[expr1364]"},{type:s.IF,evaluate:e=>e.item.value===e.state.value,redundantAttribute:"expr1365",selector:"[expr1365]",template:e('<use expr1366="expr1366"/>',[{redundantAttribute:"expr1366",selector:"[expr1366]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#check"].join("")}]}])}]),redundantAttribute:"expr1363",selector:"[expr1363]",itemName:"item",indexName:null,evaluate:e=>e.state.list}]),name:"font-list"};e(tc.name,tc);const sc=(e,t)=>{let s=e.map((e=>({value:e.fontId,family:e.family,title:e.family})));return t&&(s=s.map((e=>{const s=e.title,i=s.toLowerCase().indexOf(t),a=i+t.length;if(-1===i)return null;const n=`<span>${s.slice(0,i)}</span><mark>${s.slice(i,a)}</mark><span>${s.slice(a,s.length)}</span>`.replace(/\s/g,"&nbsp;");return{...e,title:n}})).filter((e=>e))),s},ic={css:null,exports:{components:{"fonts-list":tc},setup(e,{initMobx:t,inject:s}){t(),this.modal=s("modal"),this.state={sprite:at("fonts","admin/settings"),search:"",loading:!0,myFonts:[],localFonts:[],googleFonts:[],showControlLink:!window.location.pathname.includes("/admin/settings/fonts"),get selected(){return e.props.getSelected()},get myFontsFormatted(){return sc(this.myFonts,this.search.toLowerCase())},get localFontsFormatted(){return sc(this.localFonts,this.search.toLowerCase())},get googleFontsFormatted(){return sc(this.googleFonts,this.search.toLowerCase())},get list(){return[...this.myFontsFormatted,...this.localFontsFormatted,...this.googleFontsFormatted]},get isEmpty(){return!this.loading&&0===this.list.length}},this.watch={"state.selected":()=>this.update()}},onMounted(){this.bindEvents(),setTimeout((async()=>{const[e,t,s]=await Promise.all([Zd.loadLocalFonts(),Zd.loadMyFonts(),Zd.loadGoogleFonts()]);this.state.localFonts=e,this.state.myFonts=t,this.state.googleFonts=s,this.state.loading=!1,this.insertFontsToPage(),this.update(),this.focusSearch()}),10)},onBeforeUnmount(){this._hotkeysDisposer&&this._hotkeysDisposer()},bindEvents(){const e={preventDefault:!0,stopPropagation:!0,throttle:100,allowRepeat:!0};this._hotkeysDisposer=fs.register([{options:e,hotkeys:["ArrowDown","ArrowUp","Tab","Shift_Tab"],handlerDown:(e,{key:t,shiftKey:s})=>{const i="ArrowDown"===t||"Tab"===t&&!s,a=De(0,this.state.list.findIndex((e=>e.value===this.state.selected))+(i?1:-1),this.state.list.length-1),n=this.state.list[a||0],r=this.root.querySelector(`[data-value="${n.value}"]`);r&&(r.focus(),r.scrollIntoViewIfNeeded()),n&&n!==this.state.active&&this.selectFont(n)}},{options:e,hotkeys:["cmd_f"],handlerDown:()=>this.focusSearch()},{options:e,hotkeys:["enter"],handlerDown:()=>this.doneHandler()}])},focusSearch(){this.root.querySelector('input[type="search"]').focus()},setSearch(e){this.state.search=e.target.value,this.update()},selectFont({value:e}){const t=this.state.localFonts.find((t=>t.fontId===e))||this.state.myFonts.find((t=>t.fontId===e))||this.state.googleFonts.find((t=>t.fontId===e));this.props.selectFont(t)},doneHandler(){this.props.onDone&&this.props.onDone(),this.modal.close()},cancelHandler(){this.props.onCancel&&this.props.onCancel(),this.modal.close()},insertFontsToPage(){const e=$(".styles-container",this.root),t=Zd.getCssFontFaces(this.state.myFonts),s=ue(this.state.googleFonts.map((e=>e.family.replace(/\s/g,"+").replace(/["',:;]/g,""))).map((e=>`family=${e}`)),10);e.html(`<style>${t}</style>`),s.forEach((t=>{e.append(`<link href="https://fonts.googleapis.com/css2?display=swap&${t.join("&")}" rel="stylesheet">`)}))}},template:(e,t,s,i)=>e('<div class="styles-container"></div><div class="flexbe-modal-content flexbe-modal-header"><div expr1149="expr1149" is="flexbe-input" type="search"></div></div><div expr1150="expr1150" class="fonts-list-wrap"></div><div expr1152="expr1152" class="fonts-list-wrap"></div><div expr1154="expr1154" class="fonts-list-wrap scrollable-content"></div><div class="flexbe-modal-content buttons-line"><div expr1172="expr1172" class="flexbe-button is-primary filled"><span expr1173="expr1173" class="flexbe-text"> </span></div><div expr1174="expr1174" class="flexbe-button is-secondary bordered"><span expr1175="expr1175" class="flexbe-text"> </span></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"fonts-select"}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("editor::fonts::modal::font_search_placeholder")},{type:t.ATTRIBUTE,name:"prefixIcon",evaluate:e=>[e.state.sprite,"#search"].join("")},{type:t.ATTRIBUTE,name:"prefixIconSize",evaluate:e=>14},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.search},{type:t.EVENT,name:"oninput",evaluate:e=>e.setSearch}],redundantAttribute:"expr1149",selector:"[expr1149]"},{type:s.IF,evaluate:e=>e.state.loading,redundantAttribute:"expr1150",selector:"[expr1150]",template:e('<div expr1151="expr1151" is="flexbe-loader"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-loader",slots:[],attributes:[],redundantAttribute:"expr1151",selector:"[expr1151]"}])},{type:s.IF,evaluate:e=>e.state.isEmpty,redundantAttribute:"expr1152",selector:"[expr1152]",template:e('<span expr1153="expr1153" class="empty-list flexbe-desc"> </span>',[{redundantAttribute:"expr1153",selector:"[expr1153]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::error::no_results")}]}])},{type:s.IF,evaluate:e=>!e.state.isEmpty&&!e.state.loading,redundantAttribute:"expr1154",selector:"[expr1154]",template:e('<template expr1155="expr1155"></template><template expr1163="expr1163"></template><template expr1167="expr1167"></template>',[{type:s.IF,evaluate:e=>!e.state.search||e.state.myFontsFormatted.length,redundantAttribute:"expr1155",selector:"[expr1155]",template:e('<div class="fonts-list-head"><svg class="flexbe-icon size-16"><use expr1156="expr1156"/></svg><span expr1157="expr1157" class="flexbe-text"> </span><a expr1158="expr1158" class="style-link flexbe-addon" href="/admin/settings/fonts/" target="_blank"></a></div><span expr1161="expr1161" class="flexbe-desc mt5 mb20"></span><div expr1162="expr1162" is="fonts-list"></div>',[{redundantAttribute:"expr1156",selector:"[expr1156]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#my_fonts"].join("")}]},{redundantAttribute:"expr1157",selector:"[expr1157]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::fonts::modal::my_fonts_heading")].join("")}]},{type:s.IF,evaluate:e=>e.state.showControlLink,redundantAttribute:"expr1158",selector:"[expr1158]",template:e('<svg class="flexbe-icon size-12"><use expr1159="expr1159"/></svg><span expr1160="expr1160" class="flexbe-text"> </span>',[{redundantAttribute:"expr1159",selector:"[expr1159]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#href"].join("")}]},{redundantAttribute:"expr1160",selector:"[expr1160]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("editor::fonts::modal::fonts_control_link")}]}])},{type:s.IF,evaluate:e=>!e.state.myFontsFormatted.length,redundantAttribute:"expr1161",selector:"[expr1161]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::fonts::modal::empty_myfonts_list")].join("")}]}])},{type:s.IF,evaluate:e=>e.state.myFontsFormatted.length,redundantAttribute:"expr1162",selector:"[expr1162]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"fonts-list",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.state.myFontsFormatted},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.selected},{type:t.ATTRIBUTE,name:"selectFont",evaluate:e=>e.selectFont}]}])}])},{type:s.IF,evaluate:e=>e.state.googleFontsFormatted.length,redundantAttribute:"expr1163",selector:"[expr1163]",template:e('<div class="fonts-list-head"><svg class="flexbe-icon size-16"><use expr1164="expr1164"/></svg><span expr1165="expr1165" class="flexbe-text"> </span></div><div expr1166="expr1166" is="fonts-list"></div>',[{redundantAttribute:"expr1164",selector:"[expr1164]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#google_fonts"].join("")}]},{redundantAttribute:"expr1165",selector:"[expr1165]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::fonts::modal::google_fonts_heading")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"fonts-list",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.state.googleFontsFormatted},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.selected},{type:t.ATTRIBUTE,name:"selectFont",evaluate:e=>e.selectFont}],redundantAttribute:"expr1166",selector:"[expr1166]"}])},{type:s.IF,evaluate:e=>e.state.localFontsFormatted.length,redundantAttribute:"expr1167",selector:"[expr1167]",template:e('<div class="fonts-list-head"><svg class="flexbe-icon size-16"><use expr1168="expr1168"/></svg><span expr1169="expr1169" class="flexbe-text"> </span><q expr1170="expr1170" is="flexbe-tooltip" class="flexbe-addon"></q></div><div expr1171="expr1171" is="fonts-list"></div>',[{redundantAttribute:"expr1168",selector:"[expr1168]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.state.sprite,"#local_fonts"].join("")}]},{redundantAttribute:"expr1169",selector:"[expr1169]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::fonts::modal::local_fonts_heading")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("editor::fonts::modal::local_fonts_tip")}],redundantAttribute:"expr1170",selector:"[expr1170]"},{type:s.TAG,getComponent:i,evaluate:e=>"fonts-list",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.state.localFontsFormatted},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.selected},{type:t.ATTRIBUTE,name:"selectFont",evaluate:e=>e.selectFont}],redundantAttribute:"expr1171",selector:"[expr1171]"}])}])},{redundantAttribute:"expr1172",selector:"[expr1172]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.doneHandler}]},{redundantAttribute:"expr1173",selector:"[expr1173]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::done")}]},{redundantAttribute:"expr1174",selector:"[expr1174]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.cancelHandler}]},{redundantAttribute:"expr1175",selector:"[expr1175]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::cancel")}]}]),name:"fonts-select"};e(ic.name,ic);class ac{constructor({target:e}){ac.showFontsSettingsModal({target:e})}static showFontsSettingsModal(e){const t=at("fonts","admin/settings"),s=Zs.create({id:"font_setup",width:400,overlay:!1,title:tr("editor::fonts::modal::title"),position:["center","end_around"],positionOffset:{y:20},component:ec,modalActions:[{icon:`${t}#save_set`,tip:tr("editor::fonts::modal::save_to_project_sets_confirm_title"),class:"filled is-secondary",get hide(){return!fontsStore.usePageFonts||4!==pageStore.themeId},action:async()=>{const{set:e}=fontsStore.getSave();this.showUpdateProjectFontsConfirmation(e,{shadow:!1,fromModal:s})}}],...e})}static showUpdateProjectFontsConfirmation(e,t={}){const s=at("fonts","admin/settings");As({width:360,clickOut:!0,props:{icon:`${s}#empty_list`,title:tr("editor::fonts::modal::save_to_project_sets_confirm_title"),text:tr("editor::fonts::modal::save_to_project_sets_confirm_desc"),confirmButtonText:tr("main::button::apply"),cancelButton:!0,onConfirm:async()=>{fontsStore.projectFonts=bt(fontsStore.pageFonts),await Zd.saveProjectFontsSet(e),await fontsStore.toggleUsePageFonts(!1),toast.success(tr("editor::fonts::modal::save_to_project_sets_confirm_done"))}},...t})}static showFontSelectModal(e){Zs.create({width:380,closeButton:!1,handle:".flexbe-modal-header",overlay:!0,shadow:!1,position:["center","center"],component:ic,...e})}}ac.is="fonts",riot3.tag2("settings-block-fonts-sets",'<div class="styles-container"></div> <div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::fonts::fonts_sets_title\')}</span> <span data-is="admin-save-text" class="flexbe-desc" status="{state.status}"></span> </div> <div class="flexbe-white-box shadow collection"> <div each="{style in state.list}" key="{style.type}" data-is="element-font-style-item" class="collection-item" item="{style}" onedit="{editStyleHandler.bind(tag, style)}"></div> </div>',"",'class="settings-block-fonts-sets {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.observer=At({}),this.state={sprite:at("fonts","admin/settings"),status:"saved",get list(){return t.$state.set||[]}},this.watch={"state.list":()=>this.renderFontFaces(),"state.status":()=>this.update()},this.onMounted=function(){this.renderFontFaces()}.bind(this),this.onSave=async function(){return await this.$store.dispatch("saveFontsSet")}.bind(this),this.editStyleHandler=function(e,t){const s=d({value:e,get id(){return this.value.fontId||`${this.value.source}:${this.value.id}`}});ac.showFontSelectModal({target:this.root,shadow:!0,props:{getSelected:()=>s.id,selectFont:e=>{s.value=e},onDone:()=>this.selectFont(e.type,s.value)}})}.bind(this),this.selectFont=async function(e,t){this.state.status="saving";try{await this.$store.dispatch("selectFont",e,t),this.state.status="success"}catch(e){this.state.status="error","NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this),this.renderFontFaces=async function(){const e=$(".styles-container",this.root),t=Zd.getGoogleFontsLink(this.state.list),s=Zd.getCssFontFaces(this.state.list);e.empty().append(t?`<link href="${t}" rel="stylesheet">`:"",`<style>${s}</style>`)}.bind(this)})),riot3.tag2("element-myfont-item",'<div class="font-face"> <div class="font-face__title flexbe-title" riot-style="font-family: \'{state.family}\'"> {state.family} </div> <div class="font-face__variants"> <div class="flexbe-desc" if="{state.isEmpty}"> {tr(\'admin::settings::fonts::empty_variants_list\')} </div> <div class="flexbe-desc" each="{item in state.summary}"> {item} </div> </div> </div> <div class="flexbe-action-buttons"> <div class="flexbe-button small" onclick="{opts.onedit}"> <span class="flexbe-text">{tr(\'admin::settings::fonts::edit_font_button\')}</span> </div> <div class="action-button ml15" onclick="{opts.onremove}"> <svg class="flexbe-icon size-16"> <use riot-href="{state.sprite}#remove"></use> </svg> </div> </div>',"",'class="element-myfont-item {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.state={sprite:at("fonts","admin/settings"),get font(){return t.props.font},get family(){return this.font.name},get isEmpty(){return!this.font.variants.length},get summary(){return function(e){const t=e.name,s=e.variants||[],i=[{value:"100:normal",weight:100,style:"normal",rexp:/(thin|extra[ -]?light|100|200)/i,title:"100 Thin"},{value:"100:italic",weight:100,style:"italic",rexp:/(thin|extra[ -]?light|100|200)/i,title:"100 Thin Italic"},{value:"300:normal",weight:300,style:"normal",rexp:/(light|300)/i,title:"300 Light"},{value:"300:italic",weight:300,style:"italic",rexp:/(light|300)/i,title:"300 Light Italic"},{value:"400:normal",weight:400,style:"normal",rexp:/(normal|regular|400)/i,title:"400 Regular"},{value:"400:italic",weight:400,style:"italic",rexp:/(normal|regular|400)/i,title:"400 Regular Italic"},{value:"500:normal",weight:500,style:"normal",rexp:/(medium|500)/i,title:"500 Medium"},{value:"500:italic",weight:500,style:"italic",rexp:/(medium|500)/i,title:"500 Medium Italic"},{value:"600:normal",weight:600,style:"normal",rexp:/(semi-?bold|demi-?bold|600)/i,title:"600 Semi-Bold"},{value:"600:italic",weight:600,style:"italic",rexp:/(semi-?bold|demi-?bold|600)/i,title:"600 Semi-Bold Italic"},{value:"700:normal",weight:700,style:"normal",rexp:/(bold|700)/i,title:"700 Bold"},{value:"700:italic",weight:700,style:"italic",rexp:/(bold|700)/i,title:"700 Bold Italic"},{value:"900:normal",weight:900,style:"normal",rexp:/(black|heavy|(extra|ultra)[ -]?bold|800|900)/i,title:"900 Black"},{value:"900:italic",weight:900,style:"italic",rexp:/(black|heavy|(extra|ultra)[ -]?bold|800|900)/i,title:"900 Black Italic"}],a={};return s.forEach((e=>{const s=e.weight||400,n=e.style||"normal",r=`${s}:${n}`;if(!a[r]){const{title:e}=i.find((e=>e.value===r))||{};a[r]={key:r,title:e,family:t,weight:s,style:n,src:[]}}a[r].src=[...a[r].src,{name:e.fileName,ext:e.fileExt,format:e.format}]})),Object.values(a)}(this.font).map((e=>{const t=e.title;let s=e.src.map((e=>e.ext));return s.length<=1?t:`${t} (${s.join(", ")})`}))}}})),riot3.tag2("element-font-style-item",'<div class="font-item"> <div class="font-summary {state.isBroken ? \'flexbe-error\' : \'flexbe-desc\'}"> <span>{state.summary}</span> <q if="{state.isBroken}" data-is="proxy" is="flexbe-tooltip" content="{tr(\'editor::fonts::modal::font_removed_tip\')}"></q> </div> <div class="font-description font-description--{state.type}" riot-style="font-family: \'{state.family}\'"> {state.description} </div> </div> <div class="flexbe-action-buttons"> <div class="flexbe-button small" onclick="{opts.onedit}"> <span class="flexbe-text">{tr(\'admin::settings::fonts::edit_font_button\')}</span> </div> </div>',"",'class="element-font-style-item {opts.class}"',(function(e){this.mixin("initMobx");const t={desc_content:"editor::fonts::desc_content",desc_quote:"editor::fonts::desc_quote",desc_subtitle:"editor::fonts::desc_subtitle",desc_title:"editor::fonts::desc_title","desc_title-main":"editor::fonts::name_title_main"},s=this;this.state={sprite:at("fonts","admin/settings"),get isBroken(){return this.item._removed},get item(){return s.props.item},get type(){return this.item.type},get family(){return this.item.family},get title(){return this.item.title||this.type},get summary(){return`${this.title||this.type}  ${this.family}`},get description(){return tr(t[`desc_${this.type}`])||tr("admin::settings::fonts::fonts_set_description")}}})),riot3.tag2("settings-section-robots",'<div class="group-list slide-down-animation"> <div data-is="settings-block-robots" class="group-content"></div> <div data-is="settings-block-canonical" class="group-content"></div> </div>',"",'class="settings-section-robots pb60 {opts.class}"',(function(e){})),riot3.tag2("settings-block-robots",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::robots::content_label\')}</span> <div data-is="proxy" is="save-button" show-edit="{false}" show-save="{state.hasChanges}" on-save="{onSave}" on-error="{onError}" observer="{observer}"></div> </div> <div class="flexbe-white-box shadow"> <div data-is="flexbe-input" type="textarea" class="large" riot-value="{state.content}" placeholder="User-agent: *" oninput="{setRobots}"></div> <div class="flexbe-buttons-line"> <a class="flexbe-button small is-secondary filled" target="_blank" href="/robots.txt"> <span class="flexbe-text">{tr(\'admin::settings::robots::open_button\')}</span> </a> <a if="{state.validate}" class="flexbe-button small is-secondary filled" target="_blank" href="{state.validate}" onclick="{checkErrors}"> <span class="flexbe-text">{tr(\'admin::settings::robots::check_button\')}</span> </a> </div> </div> <div class="flexbe-desc mt20" data-is="raw" content="{tr(\'admin::settings::robots::desc\')}"></div>',"",'class="settings-block-robots {opts.class}"',(function(e){let t;const s=this;this.observer=At({}),this.state={get content(){return null==t?s.$state.robots_txt:t},get hasChanges(){return null!=t&&t!==s.$state.robots_txt},get validate(){return s.$state.validate_url}},this.checkErrors=function(e){if(this.state.hasChanges){e.preventDefault();const t=this.root.querySelector(".save-button");$(t).removeClass("shake-animation"),$(t).outerWidth(),$(t).addClass("shake-animation"),toast.log(tr("admin::settings::robots::warn_save_notify"))}}.bind(this),this.setRobots=function(e){t=e.target.value}.bind(this),this.onSave=async function(){let e;try{e=await this.$store.dispatch("saveRobots",this.state.content)}catch(t){e=t}return e}.bind(this),this.onError=function(e){e.message?toast.error(e.message):console.error(e)}.bind(this)})),riot3.tag2("settings-block-canonical",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::robots::canonical_title\')}</span> <span data-is="admin-save-text" class="flexbe-desc" status="{status}"></span> </div> <div class="flexbe-white-box shadow inline-box px25 py25"> <label data-is="flexbe-input" checked="{state.canonical}" onchange="{toggleCanonical}" class="large" type="toggle"> <span>{tr(\'admin::settings::robots::canonical_toggle_label\')}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::settings::robots::canonical_desc\', {                     tag: \'&amp;lt;link rel=canonical href=https://site.com/page/&amp;gt;\'                 })}"></q> </label> </div>',"",'class="settings-block-canonical {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.status="saved",this.state={get canonical(){return t.$state.seo_canonical??0}},this.toggleCanonical=async function(e){const t=e.target.checked;this.update({status:"saving"});try{await this.$store.dispatch("toggleCanonical",t),this.update({status:"success"})}catch(e){this.update({status:"error"}),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this)})),riot3.tag2("settings-section-ai",'<div class="group-list slide-down-animation"> <div data-is="settings-block-ai-context-product" class="group-content"></div> <div data-is="settings-block-ai-context-audience" class="group-content"></div> <div data-is="settings-block-ai-context-goal" class="group-content"></div> </div>',"",'class="settings-section-ai pb60 {opts.class}"',(function(e){this.state={showModel:window.isDemo||window.isDev}})),riot3.tag2("settings-block-ai-context-product",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text"> {tr(\'admin::settings::ai::context::product_title\')} </span> <div data-is="proxy" is="save-button" show-edit="{false}" show-save="{state.hasChanges}" on-save="{onSave}" on-error="{onError}"></div> </div> <div data-is="proxy" is="flexbe-input" type="textarea" class="large shadow no-resize" riot-value="{state.content}" autosize="{true}" rows="{2}" max-length="{1500}" resize="{false}" placeholder="{tr(\'admin::settings::ai::context::product_placeholder\')}" oninput="{onChange}"></div>',"",'class="settings-block-ai-context {opts.class}"',(function(e){const t=this;this.state={_value:null,get content(){return this._value??t.$state.context.product},hasChanges:!1},this.onChange=function(e){this.state._value=e.target.value,this.state.hasChanges=!0}.bind(this),this.onSave=async function(){let e;try{e=await this.$store.dispatch("saveAiContextProduct",this.state.content),this.state.hasChanges=!1,this.update()}catch(t){e=t}return e}.bind(this),this.onError=function(e){e.message?toast.error(e.message):console.error(e)}.bind(this)})),riot3.tag2("settings-block-ai-context-audience",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text"> {tr(\'admin::settings::ai::context::audience_title\')} </span> <div data-is="proxy" is="save-button" show-edit="{false}" show-save="{state.hasChanges}" on-save="{onSave}" on-error="{onError}"></div> </div> <div data-is="proxy" is="flexbe-input" type="textarea" class="large shadow no-resize" riot-value="{state.content}" autosize="{true}" rows="{2}" max-length="{1000}" resize="{false}" placeholder="{tr(\'admin::settings::ai::context::audience_placeholder\')}" oninput="{onChange}"></div>',"",'class="settings-block-ai-context {opts.class}"',(function(e){const t=this;this.state={_value:null,get content(){return this._value??t.$state.context.audience},hasChanges:!1},this.onChange=function(e){this.state._value=e.target.value,this.state.hasChanges=!0}.bind(this),this.onSave=async function(){let e;try{e=await this.$store.dispatch("saveAiContextAudience",this.state.content),this.state.hasChanges=!1,this.update()}catch(t){e=t}return e}.bind(this),this.onError=function(e){e.message?toast.error(e.message):console.error(e)}.bind(this)})),riot3.tag2("settings-block-ai-context-goal",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text"> {tr(\'admin::settings::ai::context::goal_title\')} </span> <div data-is="proxy" is="save-button" show-edit="{false}" show-save="{state.hasChanges}" on-save="{onSave}" on-error="{onError}"></div> </div> <div data-is="proxy" is="flexbe-input" type="textarea" class="large shadow no-resize" riot-value="{state.content}" autosize="{true}" rows="{2}" max-length="{1000}" resize="{false}" placeholder="{tr(\'admin::settings::ai::context::goal_placeholder\')}" oninput="{onChange}"></div>',"",'class="settings-block-ai-context {opts.class}"',(function(e){const t=this;this.state={_value:null,get content(){return this._value??t.$state.context.goal},hasChanges:!1},this.onChange=function(e){this.state._value=e.target.value,this.state.hasChanges=!0}.bind(this),this.onSave=async function(){let e;try{e=await this.$store.dispatch("saveAiContextGoal",this.state.content),this.state.hasChanges=!1,this.update()}catch(t){e=t}return e}.bind(this),this.onError=function(e){e.message?toast.error(e.message):console.error(e)}.bind(this)})),riot3.tag2("settings-section-verify",'<div class="group-list slide-down-animation"> <div class="group-item" data-is="settings-block-verify-files" files="{state.files}"> </div> <div class="group-content meta-editor" data-is="settings-block-code" params="{params}" riot-value="{state.meta}" onsave="{saveCode}"></div> </div>',"",'class="settings-section-verify pb60 {opts.class}"',(function(e){const t=this;this.params={title:tr("admin::settings::verify::meta::title")},this.state={get files(){return t.$state.files||[]},get meta(){return t.$state.seo_meta||""}},this.saveCode=function(e){return this.$store.saveMetaCode(e)}.bind(this),this.onMounted=function(){this.root.removeAttribute("data-json")}.bind(this)})),riot3.tag2("settings-block-verify-files",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text">{tr(\'admin::settings::verify::file::title\')}</span> </div> <div class="collection flexbe-white-box shadow drop-zone-target"> <div class="collection-item text-shade" if="{state.isEmpty}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#api"></use> </svg> <span class="flexbe-text"> {tr(\'admin::settings::verify::file::upload_first_note\')} </span> </div> <div each="{file, index in state.files}" class="collection-item files-list {hide: file.hide}"> <a riot-href="/{file.p_uri}" target="_blank">{file.p_name}</a> <div class="flexbe-action-buttons to-right"> <div class="action-button" onclick="{onRemoveAttempt.bind(this, file, index)}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{sprite}#remove"></use> </svg> </div> </div> </div> <div class="collection-item file-upload"> <div data-is="flexbe-button-upload" class="size-small" url="{$store._uploadFilePath}" file-type="file" drop-zone=".drop-zone-target" onupload="{onUploadDone}" onerror="{onUploadError}" show-icon="0" regular-class="is-secondary" common-class="small filled"> </div> </div> </div>',"",'class="settings-block-verify-files"',(function(e){this.sprite=flexbe.lib.getSprite("settings","admin"),this.state={get files(){return e.files||[]},get isEmpty(){return!this.files.filter((e=>!e.hide)).length}},this.onRemoveAttempt=function(e,t){e.p_id?As({props:{title:tr("admin::settings::verify::file::delete_confirm_title"),text:tr("admin::settings::verify::file::delete_confirm_text"),onConfirm:()=>this.removeFile(e,t)}}):toast.error(tr("main::error::unknown"))}.bind(this),this.removeFile=async function(e,t){try{await this.$store.removeFileAction({id:e.p_id})}catch(e){"NetworkError"===e.name?toast.error(e.message):console.error(e)}this.update()}.bind(this),this.onUploadDone=function(e,t){t.data&&(this.$store.addFile(t.data),this.update())}.bind(this),this.onUploadError=function(){toast.error(tr("main::error::upload_file"))}.bind(this)})),riot3.tag2("settings-section-ecommerce",'<div class="group-list slide-down-animation"> <div data-is="settings-block-cart_settings" class="group-content"></div> </div>',"",'class="settings-section-ecommerce pb60 {opts.class}"',(function(e){})),riot3.tag2("settings-section-promo",'<div class="group-list slide-down-animation"> <div data-is="settings-block-discount" class="group-content"></div> <div data-is="settings-block-promo" class="group-content" id="promocode"></div> </div>',"",'class="settings-section-promo pb60 {opts.class}"',(function(e){this.onMounted=async function(){this.$store.mutations.sortByStatus(),this.update()}.bind(this)})),riot3.tag2("settings-section-delivery",'<div class="group-list slide-down-animation"> <div data-is="settings-block-delivery" class="group-content"></div> </div>',"",'class="settings-section-delivery pb60 {opts.class}"',(function(e){})),riot3.tag2("editor-form-field-mask",'<div class="flexbe-field-group"> <label data-is="flexbe-input" type="toggle" class="field-required" checked="{field.is_masked}" onchange="{changeMasked}"> <span class="flexbe-text"> {tr(\'editor::form::field_mask_toggle\')} </span> <q data-is="flexbe-tooltip" content="{tr(\'editor::form::field_text_mask_format_tip\')}"></q> </label> <virtual if="{field.is_masked}"> <label data-is="flexbe-input" type="toggle" class="field-required" checked="{field.is_placeholder}" onchange="{changePlaceholder}"> <span class="flexbe-text"> {tr(\'editor::form::field_mask_placeholder_toggle\')} </span> </label> <div data-is="flexbe-input" class="inputmask-custom mt10 w100" data-field="inputmask_custom" riot-value="{field.inputmask_custom}" error="{!/[\\*\\#\\@]/.test(field.inputmask_custom)}" error-tip="{tr(\'editor::form::field_mask_error_tip\')}" placeholder="##.##.####" oninput="{changeCustomMask}"></div> <div class="flexbe-bar flexbe-bar--info mt10"> <div class="flexbe-bar__content field-mask-note-text"> <div class="flexbe-title text-content text-xs text-bold">{tr(\'editor::form::field_mask_format_note_title\')}</div> <raw class="flexbe-text text-xs" content="{tr(\'editor::form::field_mask_format_note_text\')}"></raw> </div> <div class="flexbe-bar__help"> <a href="{meta.link}" target="_blank" class="flexbe-button small"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{sprite}#icon_more"></use> </svg> <span class="flexbe-text">{tr(\'editor::form::field_mask_format_note_button\')}</span> </a> </div> </div> </virtual> </div>',"",'class="editor-form-field-mask {opts.class}"',(function(e){this.sprite=at("fields"),this.field=this.opts.field,this.meta={get link(){return`https://help.flexbe.${"ru"===flexbe.vars.user.lang?"ru":"com"}/masks/`}},this.changeMasked=function(e){const t=!!e.target.checked&&"custom";this.commit({path:"is_masked",value:t})}.bind(this),this.changePlaceholder=function(e){const t=e.target.checked;this.commit({path:"is_placeholder",value:t})}.bind(this),this.changeCustomMask=function(e){const t=e.target.value;this.commit({path:"inputmask_custom",value:t}),/[\*\#\@]/.test(t)?this.changeCustomMaskError(!1):this.changeCustomMaskError(!0)}.bind(this),this.changeCustomMaskError=function(e){this.commit({path:"inputmask_custom_error",value:e})}.bind(this),this.commit=function(...t){e.commit?.(...t)}.bind(this)})),riot3.tag2("editor-form-field-phone",'<div class="flexbe-field-group"> <label data-is="flexbe-input" type="toggle" class="field-required" checked="{field.is_masked}" onchange="{changeMasked.bind(tag, \'default\')}"> <span class="flexbe-text"> {tr(\'editor::form::field_mask_toggle\')} </span> </label> <virtual if="{field.is_masked}"> <label if="{!tag.onlyCustom}" data-is="flexbe-input" type="toggle" class="field-required" checked="{(field.is_masked === \'custom\')}" onchange="{changeMasked.bind(tag, \'custom\')}"> <span class="flexbe-text">{tr(\'editor::form::field_mask_custom_toggle\')}</span> </label> <label data-is="flexbe-input" type="toggle" class="field-required" checked="{field.is_placeholder}" onchange="{changePlaceholder}"> <span class="flexbe-text"> {tr(\'editor::form::field_mask_placeholder_toggle\')} </span> </label> <div if="{(field.is_masked === \'custom\') || tag.onlyCustom}" data-is="flexbe-input" class="inputmask-custom mt10 w100" data-field="inputmask_custom" riot-value="{field.inputmask_custom}" error="{!/[\\*\\#]/.test(field.inputmask_custom)}" error-tip="{tr(\'editor::form::field_mask_error_tip\')}" placeholder="{tag.maskFormat}" pattern="[0-9 _+\\-\\*\\#\\(\\)\\|\\/\\[\\]]*" oninput="{changeCustomMask}"></div> <div class="flexbe-bar field-phone-default-mask-note has-line mt10" if="{tag.maskExample && (field.is_masked === true)}"> {tr(\'editor::form::field_mask_format_label\')}: <br if="{tag.maskExample.length > 35}"> {tag.maskExample} <q data-is="flexbe-tooltip" content="{tr(\'editor::form::field_mask_format_tip\')}" max-width="{210}" interactive="{true}"></q> </div> <div class="flexbe-bar field-phone-mask-note has-line mt10" if="{field.is_masked === \'custom\'}"> <div class="flexbe-title text-content text-xs text-bold">{tr(\'editor::form::field_mask_format_note_title\')}</div> <raw class="flexbe-text text-xs" content="{tr(\'editor::form::field_phone_format_note_text\')}"></raw> </div> </virtual> </div>',"",'class="editor-form-field-phone {opts.class}"',(function(e){const t=this,s={phone:{RU:["+7 (###) ###-##-##","8 (###) ###-##-##"],KZ:["+7 (###) ###-##-##","8 (###) ###-##-##"],UA:["+38 (###) ###-####"],BY:["+375 ## #######"],US:["+1 (###) ###-####"]}};this.field=this.opts.field,this.getDefaultMask=function(){const e=this.field.type,t=flexbe.vars.group.country;return s[e]&&s[e][t]}.bind(this),this.onBeforeMount=function(){this.onlyCustom=!1,this.maskFormat=this.getDefaultMask()||!1,this.maskExample=this.maskFormat||"+1 (###) ###-##-##",Array.isArray(this.maskFormat)&&(this.maskExample=this.maskExample.join(` ${tr("editor::conjunction::or")} `)),this.maskFormat||(this.onlyCustom=!0,this.maskFormat="+1 (###) ###-##-##",this.field.is_masked&&!this.field.inputmask_custom&&setTimeout((()=>{t.commit({path:"is_masked",value:!1})})))}.bind(this),this.changeMasked=function(e){let t;const s=this.field.is_masked;"custom"===e||this.onlyCustom?"custom"===s?t="custom"===e:(t="custom",this.field.inputmask_custom||this.commit({path:"inputmask_custom",value:this.maskFormat})):t=!s,this.commit({path:"is_masked",value:t})}.bind(this),this.changeCustomMask=function(e){const t=e.target.value;this.commit({path:"inputmask_custom",value:t}),/[\*\#]/.test(t)?this.changeCustomMaskError(!1):this.changeCustomMaskError(!0)}.bind(this),this.changeCustomMaskError=function(e){this.commit({path:"inputmask_custom_error",value:e})}.bind(this),this.changePlaceholder=function(e){const t=e.target.checked;this.commit({path:"is_placeholder",value:t})}.bind(this),this.commit=function(...t){e.commit?.(...t)}.bind(this)})),riot3.tag2("editor-form-field-date",'<div class="row" if="{state.showRange}"> <div class="col col-12"> <div class="flexbe-title">{tr(\'editor::form::date::diapason_label\')}</div> <div data-is="flexbe-buttons-line" class="flexbe-buttons-line is-group" riot-value="{state.dateRange}" list="{meta.dateRanges}" onchange="{setRange}"> </div> </div> </div> <div class="row" if="{state.showDays}"> <div class="col col-12"> <div class="flexbe-title"> {tr(\'editor::form::date::work_days_label\')} <q data-is="flexbe-tooltip" content="{tr(\'editor::form::date::work_days_tip\')}"></q> </div> <div class="flexbe-field-group work-days-list"> <div each="{item in meta.days}" class="work-days-item {selected: state.workDays.includes(item.day)}" onclick="{setWorkDay.bind(tag, item.day)}"> {tr(item.title)} </div> </div> </div> </div> <div class="row" if="{state.showTimes}"> <div class="col col-12"> <div class="row"> <div class="col col-6 range-start"> <div class="flexbe-title"> {tr(\'editor::form::date::start_work_time_label\')} <q data-is="flexbe-tooltip" content="{tr(\'editor::form::date::start_work_time_tip\')}"></q> </div> <label data-is="flexbe-select" class="short" list="{meta.timesStart}" riot-value="{state.timeStart}" onchange="{setWorkTimeStart}"> </label> </div> <div class="col col-6"> <div class="flexbe-title"> {tr(\'editor::form::date::end_work_time_label\')} <q data-is="flexbe-tooltip" content="{tr(\'editor::form::date::end_work_time_tip\')}"></q> </div> <label data-is="flexbe-select" list="{meta.timesFinish}" riot-value="{state.timeFinish}" onchange="{setWorkTimeFinish}"> </label> </div> </div> <div class="row"> <div class="col col-12 flexbe-field-group"> <div class="flexbe-title"> {tr(\'editor::form::date::interval_work_time_label\')} </div> <label data-is="flexbe-buttons-line" class="flexbe-buttons-line is-group" riot-value="{state.timeInterval}" list="{meta.timeIntervals}" onchange="{setWorkTimeInterval}"> </label> </div> </div> </div> </div>','editor-form-field-date .work-days-list,[data-is="editor-form-field-date"] .work-days-list{display:flex;justify-content:space-between;max-width:380px} editor-form-field-date .work-days-item,[data-is="editor-form-field-date"] .work-days-item{display:flex;width:38px;height:38px;border-radius:50%;justify-content:center;align-items:center;cursor:pointer;color:#aeaeae;border:1px solid #aeaeae;position:relative;user-select:none;transition:all .18s} editor-form-field-date .work-days-item:before,[data-is="editor-form-field-date"] .work-days-item:before{content:\'\';display:block;height:1px;position:absolute;left:0;width:100%;background:#aeaeae;transform:rotate(-45deg);top:50%;transition:all .18s} editor-form-field-date .work-days-item:hover,[data-is="editor-form-field-date"] .work-days-item:hover{color:#8f8f8f;border:1px solid #8f8f8f} editor-form-field-date .work-days-item:hover:before,[data-is="editor-form-field-date"] .work-days-item:hover:before{background:#8f8f8f} editor-form-field-date .work-days-item.selected,[data-is="editor-form-field-date"] .work-days-item.selected{background-color:#ebebeb;color:#343434;border:1px solid #ebebeb} editor-form-field-date .work-days-item.selected:before,[data-is="editor-form-field-date"] .work-days-item.selected:before{opacity:0} editor-form-field-date .work-days-item.selected:hover,[data-is="editor-form-field-date"] .work-days-item.selected:hover{border:1px solid #e1e1e1;color:#343434;background:#e1e1e1} editor-form-field-date .work-days-item.selected:hover:before,[data-is="editor-form-field-date"] .work-days-item.selected:hover:before{opacity:0}','class="editor-form-field-date {opts.class}"',(function(e){const t=this;this.field=this.opts.field,this.state={get showRange(){return"date"===t.field.type},get showDays(){return"future"===t.field.dateRange},get showTimes(){return"datetime"===t.field.type},get dateRange(){return t.field.dateRange||t.meta.dateRanges[0].value},get workDays(){return t.field.dateWorkdays||[]},get timeStart(){return t.field.dateWorktime?.start||"00:00"},get timeFinish(){return t.field.dateWorktime?.finish||"00:00"},get timeInterval(){return t.field.dateWorktime?.interval||t.meta.timeIntervals[0].value}},this.meta={timesStart:[],timesFinish:[],dateRanges:[{title:tr("editor::form::date::diapason_any_button"),value:"any"},{title:tr("editor::form::date::diapason_past_button"),value:"past"},{title:tr("editor::form::date::diapason_future_button"),value:"future"}],timeIntervals:[{title:tr("editor::form::date::interval_work_time_item",60),value:60},{title:tr("editor::form::date::interval_work_time_item",30),value:30},{title:tr("editor::form::date::interval_work_time_item",15),value:15},{title:tr("editor::form::date::interval_work_time_item",10),value:10}],days:(()=>{const e=[{day:1,title:"main::week_days::monday_short"},{day:2,title:"main::week_days::tuesday_short"},{day:3,title:"main::week_days::wednesday_short"},{day:4,title:"main::week_days::thursday_short"},{day:5,title:"main::week_days::friday_short"},{day:6,title:"main::week_days::saturday_short"}],t={day:0,title:"main::week_days::sunday_short"};return"object"==typeof flexbe_cli&&0===flexbe_cli.locale.date_format.firstDay?e.unshift(t):e.push(t),e})()},this.setRange=async function(e){const t=e.value;await this.commit({path:"dateRange",value:t})}.bind(this),this.setWorkTimeStart=async function(e){const t=e.value,s=Number(t.substring(0,2)),i=Number(t.substring(3,5)),a=this.state.timeFinish,n=Number(a.substring(0,2)),r=Number(a.substring(3,5)),o=0===n&&0===r;if(s>n&&!o||s===n&&i>=r&&!o){let e=s+1,t=i,a=24===e?"00:00":(e<10?`0${e}`:String(e))+":"+(t<10?`0${t}`:String(t));await this.commit({path:"dateWorktime.finish",value:a})}await this.commit({path:"dateWorktime.start",value:t})}.bind(this),this.setWorkTimeFinish=async function(e){e=e.value;const t=Number(e.substring(0,2)),s=Number(e.substring(3,5)),i=this.state.timeStart,a=Number(i.substring(0,2)),n=Number(i.substring(3,5));if(a>t&&0!==t||a===t&&n>=s){let e=t-1,i=s,a=e<0?"00:00":(e<10?`0${e}`:String(e))+":"+(i<10?`0${i}`:String(i));await this.commit({path:"dateWorktime.start",value:a})}await this.commit({path:"dateWorktime.finish",value:e})}.bind(this),this.setWorkTimeInterval=async function(e){const t=e.value,s=this.field.dateWorktime.finish,i=Number(s.substring(0,2));Number(s.substring(3,5));const a=this.field.dateWorktime.start,n=Number(a.substring(0,2));Number(a.substring(3,5)),await this.commit({path:"dateWorktime.interval",value:t}),this.initTimesMeta();const r=this.meta.timesStart.includes(a),o=this.meta.timesFinish.includes(s);if(!r){const e=(n<10?`0${n}`:String(n))+":"+(60===t?"00":String(t));this.setWorkTimeStart({value:e})}if(!o){const e=(i<10?`0${i}`:String(i))+":"+(60===t?"00":String(t));this.setWorkTimeFinish({value:e})}}.bind(this),this.setWorkDay=function(e){const t=[...this.state.workDays];if(t.includes(e)){const s=t.indexOf(e);t.splice(s,1)}else t.push(e);this.commit({path:"dateWorkdays",value:t})}.bind(this),this.serializeRequired=function(e){switch(typeof e){case"number":return Boolean(e);case"string":return"true"===e}return!1}.bind(this),this.initTimesMeta=function(){const e=t.state.timeInterval,s=[];if(this._lastInitedInterval===e)return;this._lastInitedInterval=e;let i=0;for(;i<24;){let t=0;for(;t<60;)0!==i||0!==t?(s.push(a(i,t)),t+=e):t+=e;i++}function a(e=0,t=0){const s={title:"",value:""},i=[e<10?`0${e}`:`${e}`,":",t<10?`0${t}`:`${t}`].join("");let a=!1;if(a="object"==typeof flexbe_cli?flexbe_cli.locale.date_format.hour12:"US"===flexbe.vars.group.country,a){24===e&&(e=0);const i=e>=12?"PM":"AM";s.title=[e%12||12,":",t<10?`0${t}`:`${t}`," ",i].join("")}else s.title=i;return s.value=i,s}this.meta.timesStart=[a(0,0),...s],this.meta.timesFinish=[...s,a(24,0)]}.bind(this),this.commit=function(...t){return e.commit?.(...t)}.bind(this),this.onBeforeMount=function(){this.initTimesMeta()}.bind(this),this.onBeforeUpdate=function(){this.initTimesMeta()}.bind(this)})),riot3.tag2("field-range-settings",'<div> <div class="col col-12"> <div class="row range-settings"> <div class="col col-4"> <div class="flexbe-title">{tr(\'editor::form::range::start_label\')}</div> <label data-is="flexbe-input" data-field="start" step="{state.data.step || 1}" class="flexbe-input" riot-value="{state.data.start}" oninput="{changeField}" type="{\'number\'}"></label> </div> <div class="col col-4"> <div class="flexbe-title">{tr(\'editor::form::range::end_label\')}</div> <label data-is="flexbe-input" data-field="end" step="{state.data.step || 1}" class="flexbe-input" riot-value="{state.data.end}" oninput="{changeField}" type="{\'number\'}"></label> </div> <div class="col col-4"> <div class="flexbe-title">{tr(\'editor::form::range::step_label\')}</div> <label data-is="flexbe-input" class="flexbe-input" data-field="step" default-value="1" min="0.000001" riot-value="{state.data.step}" oninput="{changeField}" type="{\'number\'}"></label> </div> </div> <div class="row"> <div class="col flexbe-field-group"> <label data-is="flexbe-input" type="toggle" class="field-required" data-name="units" checked="{state.data.units}" onchange="{changeChecked}"> <span>{tr(\'editor::form::range::units_label\')}</span> </label> <div class="row mt15 mb20" if="{state.data.units}"> <div class="col col-6"> <div class="flexbe-title">{tr(\'editor::form::range::prefix_label\')}</div> <label data-is="flexbe-input" type="text" placeholder="{tr(\'editor::form::range::prefix_placeholder\')}" riot-value="{state.data.prefix}" data-field="prefix" oninput="{changeField}"></label> </div> <div class="col col-6"> <div class="flexbe-title">{tr(\'editor::form::range::suffix_label\')}</div> <label data-is="flexbe-input" type="text" placeholder="{tr(\'editor::form::range::suffix_placeholder\')}" riot-value="{state.data.suffix}" data-field="suffix" oninput="{changeField}"></label> </div> </div> <label data-is="flexbe-input" type="toggle" class="field-required" data-name="double" checked="{state.data.double}" onchange="{changeChecked}"> <span>{tr(\'editor::form::range::double_label\')}</span> </label> </div> </div> <div class="row"> <div class="col col-12"> <div class="flexbe-title">{tr(\'editor::form::range::legend_label\')}</div> <label data-is="flexbe-buttons-line" class="flexbe-buttons-line is-group" riot-value="{state.data.legend.type}" list="{meta.rangeLegendOptions}" onchange="{changeLegendType}"></label> </div> </div> <div class="row" if="{state.data.legend.type === \'limits\'}"> <div class="col col-12"> <label data-is="flexbe-input" type="toggle" class="field-required" data-field="text" checked="{state.data.legend.text}" onchange="{toggleLegendText}"> <span>{tr(\'editor::form::range::options::text\')}</span> </label> </div> </div> <div class="row" if="{state.data.legend.type === \'limits\' && state.data.legend.text}"> <div class="col col-6"> <div class="flexbe-title">{tr(\'editor::form::range::legend_start_label\')}</div> <label data-is="flexbe-input" placeholder="{tr(\'editor::form::range::legend_start_placeholder\')}" data-field="start" class="flexbe-input" riot-value="{state.data.legend.start}" oninput="{changeLegendText}"></label> </div> <div class="col col-6"> <div class="flexbe-title">{tr(\'editor::form::range::legend_end_label\')}</div> <label data-is="flexbe-input" placeholder="{tr(\'editor::form::range::legend_end_placeholder\')}" data-field="end" class="flexbe-input" riot-value="{state.data.legend.end}" oninput="{changeLegendText}"></label> </div> </div> </div> </div>',"",'class="field-range-settings {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={get data(){return xt(t.props.data,e.path)}},this.meta={rangeLegendOptions:[{title:"editor::form::range::options::none",value:"none"},{title:"editor::form::range::options::limits",value:"limits"},{title:"editor::form::range::options::show",value:"show"}]},this.changeLegendText=function(e){const t=e.target.value,s=$(e.target).parents(".flexbe-input").attr("data-field");this.commit({path:["legend",s],value:t})}.bind(this),this.toggleLegendText=function(e){const t=e.target.checked?1:0;this.commit({path:["legend","text"],value:t})}.bind(this),this.changeLegendType=function(e){this.commit({path:["legend","type"],value:e.value})}.bind(this),this.changeChecked=function(e){const t=$(e.target).parents(".flexbe-input").attr("data-name"),s=Number(e.target.checked);this.commit({path:t,value:s})}.bind(this),this.changeField=function(e){const t=$(e.target).parents(".flexbe-input").attr("data-field");let s=e.target.value;this.commit({path:t,value:s,render:["template"]})}.bind(this),this.commit=function(t){if("object"!=typeof t)return!1;e.commit?.(t,e.path)}.bind(this)})),riot3.tag2("field-options-list",'<div if="{/select|radio/.test(state.data.type)}" data-is="flexbe-sort-list" class="field-list py10 mt-10 {no-remove: tag.state.vars.length <= 1}" handle-selector=".draggable" item-selector=".flexbe-field-item" sortend="{sortOptions}"> <div if="{tag.meta.showList}" class="flexbe-field-item flexbe-field-line" each="{option, index in tag.state.vars}" key="{index}"> <div class="draggable"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{tag.meta.sprite}#drag"></use> </svg> </div> <div class="field-name mr10"> <label data-is="flexbe-input" class="transparent w100" placeholder="{tr(\'editor::form::field_option_placeholder\')}" riot-value="{option}" oninput="{tag.changeOptionName.bind(tag, index, option)}"></label> </div> <div if="{tag.state.data.type === \'radio\'}" class="field-selected ml5 {index === tag.state.selected ? \'active\' : \'\'}" onclick="{tag.selectOption.bind(tag, index)}" title="{tr(\'editor::form::radio::set_as_default_tip\')}"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{tag.meta.sprite}#checked-field"></use> </svg> </div> <div if="{tag.state.vars.length > 1}" class="flexbe-icon field-remove ml5" onclick="{tag.deleteOption.bind(tag, index)}" title="{tr(\'editor::form::variants_remove_button\')}"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{tag.meta.sprite}#remove-field"></use> </svg> </div> </div> </div> <div class="flexbe-button is-primary colored add-field w100" onclick="{addNewOption}"> <svg class="flexbe-icon size-10"> <use riot-xlink:href="{tag.meta.sprite}#add-field"></use> </svg> <span class="flexbe-text">{tr(\'editor::form::variants_add_button\')}</span> </div>',"",'class="field-options-list {opts.class}"',(function(e){const t=this;this.tag=t,this.mixin("initMobx"),this.state={get data(){return xt(t.props.data,e.path)||{}},get vars(){return this.data.vars},get selected(){return this.data.selected}},this.meta={showList:!0,themeId:"undefined"!=typeof pageStore?pageStore.themeId:null,get options(){return t.props.options||{}},get sprite(){return at("editor_form")}},this.watch={"state.data":[()=>this.update(),{deep:!0}]},this.changeOptionName=function(e,t,s){const i=s.target.value;this.commit({path:["vars",e],value:i,render:["template"]})}.bind(this),this.addNewOption=function(){const e=[...this.state.vars];e.push(""),this.commit({path:"vars",value:e,render:["template"]}),this.focusVariant(e.length-1)}.bind(this),this.selectOption=function(e){this.commit({path:"selected",value:e,render:["template"]})}.bind(this),this.deleteOption=function(e){const t=[...this.state.vars];t.splice(e,1),this.commit({path:"vars",value:t,render:["template"]}),this.state.selected===e&&this.commit({path:"selected",value:0,render:["template"]})}.bind(this),this.focusVariant=function(e){e=Math.max(0,Math.min(this.state.vars.length-1,e)),setTimeout((()=>{$(this.root).find(".field-name input").eq(e).focus()}),30)}.bind(this),this.sortOptions=function({oldIndex:e,newIndex:t}){this.meta.showList=!1,this.update();const s=[...this.state.vars],i=s.splice(e,1),a=this.state.vars[this.state.selected];if(s.splice(t,0,i[0]),this.state.selected===e)this.commit({path:"selected",value:t,render:["template"]});else{const e=this.state.vars.findIndex((e=>e===a))||0;this.commit({path:"selected",value:e,render:["template"]})}this.commit({path:"vars",value:s,render:["template"]}),this.meta.showList=!0,this.update()}.bind(this),this.commit=function(t){if("object"!=typeof t)return!1;e.commit?.(t,e.path)}.bind(this),this.onMounted=function(){this.state.vars&&(null==this.state.selected?this.commit({path:"selected",value:0,render:[]}):this.update())}.bind(this)})),riot3.tag2("editor-form-field-edit",'<form action="" onsubmit="{submit}"> <div class="row"> <div class="col col-12"> <div class="flexbe-title"> {tr(\'editor::form::field_name_label\')} <q data-is="flexbe-tooltip">{tr(\'editor::form::field_name_tip\')}</q> </div> <div data-is="flexbe-input" data-field="name" riot-value="{state.data.name}" oninput="{changeField}"></div> </div> </div> <div class="row" if="{meta.showDesc}"> <div class="col col-12"> <div class="flexbe-title"> {tr(\'editor::form::field_desc_label\')} <q data-is="flexbe-tooltip">{tr(\'editor::form::field_desc_tip\')}</q> </div> <div data-is="flexbe-input" data-field="desc" riot-value="{state.data.desc}" oninput="{changeField}"></div> </div> </div> <div class="row" if="{meta.showValue}"> <div class="col col-12"> <div class="flexbe-title">{tr(\'editor::form::field_value_label\')}</div> <div data-is="flexbe-input" data-field="value" riot-value="{state.data.value}" oninput="{changeField}"></div> </div> </div> <div class="row" if="{meta.showLines}"> <div class="col col-12"> <div class="flexbe-title">{tr(\'editor::form::field_lines_label\')}</div> <div data-is="flexbe-buttons-line" class="is-group" role="radio" data-field="value" riot-value="{state.data.lines}" list="{meta.lines}" onchange="{changeLines}"></div> </div> </div> <div class="row" if="{/select|radio/.test(state.data.type)}"> <div class="col col-12"> <div class="flexbe-title">{tr(\'editor::form::field_options_label\')}</div> <div if="{/select|radio/.test(state.data.type)}" data-is="field-options-list" path="{opts.path}" data="{opts.data}" commit="{commit}"></div> </div> </div> <div class="row" if="{![\'range\', \'radio\', \'select\', \'hidden\', \'delivery\', \'promocode\'].includes(state.data.type)}"> <div class="col flexbe-field-group"> <virtual if="{/date|datetime|text|textarea|file|phone|email|name|checkbox/.test(state.data.type)}"> <label data-is="flexbe-input" class="field-required" type="toggle" data-name="is_required" checked="{serializeRequired(state.data.is_required)}" onchange="{changeChecked}"> <span>{tr(\'editor::form::field_required_toggle\')}</span> </label> </virtual> <virtual if="{state.data.type === \'checkbox\'}"> <label data-is="flexbe-input" type="toggle" class="field-required" data-name="is_checked" checked="{serializeRequired(state.data.is_checked)}" onchange="{changeChecked}"> <span>{tr(\'editor::form::field_default_toggle\')}</span> </label> </virtual> <div data-is="editor-form-field-mask" class="field-mask mt10" if="{meta.showMask}" field="{state.data}" commit="{commit}"></div> <div data-is="editor-form-field-phone" class="field-mask mt10" if="{meta.showPhoneMask}" field="{state.data}" commit="{commit}"></div> </div> </div> <div if="{state.data.type === \'range\'}" data-is="field-range-settings" class="row" data="{opts.data}" path="{opts.path}" commit="{commit}"></div> <div class="row" if="{state.data.type === \'date\' || state.data.type === \'datetime\'}"> <div data-is="editor-form-field-date" class="col col-12" field="{state.data}" commit="{commit}"></div> </div> <div if="{state.data.type === \'promocode\'}" data-is="editor-form-field-promocode" class="row" field="{state.data}" commit="{commit}"></div> <div class="row" if="{meta.fieldDesc}"> <div class="col col-12"> <div class="flexbe-bar has-line"> <span data-is="raw" content="{meta.fieldDesc}"></span> </div> </div> </div> <input type="submit" hide="{true}"> </form> <div class="flexbe-button is-primary filled block mt20" if="{meta.showClose}" onclick="{closeModal}"> <span>{tr(\'main::button::done\')}</span> </div>',"",'class="editor-form-field-edit {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={get data(){return xt(t.props.data,e.path)}},this.meta={optionsIteration:0,themeId:"undefined"!=typeof pageStore?pageStore.themeId:null,listInWhatch:!0,get options(){return t.props.options||{}},get sprite(){return at("editor_form")},get showValue(){return["hidden"].includes(t.state.data.type)},get showLines(){return this.options.allow_lines&&"textarea"===t.state.data.type},get showClose(){return!!t.props.modal},get showDesc(){return(e.showDesc??!0)&&this.options.allow_desc&&!["checkbox","hidden"].includes(t.state.data.type)},get showMask(){return 1!==this.themeId&&"text"===t.state.data.type},get showPhoneMask(){return 1!==this.themeId&&"phone"===t.state.data.type},get fieldDesc(){return"hidden"===t.state.data.type?tr("editor::form::type_hidden_desc"):"delivery"===t.state.data.type&&tr("editor::form::type_delivery_desc",{href:"/admin/settings/ecommerce/delivery/"})},lines:[1,2,3,5,10]},this.updateSortedOptions=function(){this.state.sortedOptions=[],this.meta.listInWhatch&&this.update(),this.state.sortedOptions=this.state.vars.map(((e,t)=>({name:e,id:t})))}.bind(this),this.watch={"state.data":[()=>this.update(),{delay:4,deep:!0}]},this.serializeRequired=function(e){switch(typeof e){case"number":return Boolean(e);case"string":return"true"===e}return!1}.bind(this),this.submit=function(e){e.preventDefault(),this.closeModal()}.bind(this),this.changeChecked=function(e){const t=$(e.target).parents(".flexbe-input").attr("data-name"),s=Number(e.target.checked);this.commit({path:t,value:s})}.bind(this),this.changeField=function(e){const t=$(e.target).parents(".flexbe-input"),s=t.attr("data-field"),i=t.attr("type");let a=e.target.value;"textarea"===i&&(a=a.split("\n")),this.commit({path:s,value:a,render:["template"]})}.bind(this),this.changeLines=function(e){this.commit({path:"lines",value:e.value})}.bind(this),this.commit=function(t){if("object"!=typeof t)return!1;e.commit?.(t,e.path)}.bind(this),this.closeModal=function(){e.modal&&e.modal.close()}.bind(this)}));const nc={name:{show:1,title:tr("editor::form::type_name_option"),icon:"name_large",type:"name",field:{type:"name",name:tr("editor::form::type_name_option"),desc:"",is_required:0}},email:{show:1,title:tr("editor::form::type_email_option"),icon:"email_large",type:"email",field:{type:"email",name:tr("editor::form::type_email_option"),desc:"",is_required:1}},phone:{show:1,title:tr("editor::form::type_phone_option"),icon:"phone_large",type:"phone",field:{type:"phone",name:tr("editor::form::type_phone_option"),desc:"",is_required:1}},text:{show:1,title:tr("editor::form::type_text_option"),icon:"text_large",type:"text",field:{type:"text",name:tr("editor::form::type_text_option"),desc:"",is_required:0}},date:{show:1,title:tr("editor::form::type_date_option"),icon:"date_large",type:"date",field:{type:"date",name:tr("editor::form::type_date_option"),desc:"",is_required:0,dateRange:"any",dateWorkdays:[0,1,2,3,4,5,6]}},datetime:{show:1,title:tr("editor::form::type_datetime_option"),icon:"datetime_large",type:"datetime",field:{type:"datetime",name:tr("editor::form::type_datetime_option"),desc:"",is_required:0,dateRange:"future",dateWorkdays:[1,2,3,4,5],dateWorktime:{start:"09:00",finish:"18:00",interval:30}}},textarea:{show:1,title:tr("editor::form::type_textarea_option"),icon:"textarea_large",type:"textarea",field:{type:"textarea",name:tr("editor::form::type_textarea_option"),desc:"",lines:2,is_required:0}},checkbox:{show:1,title:tr("editor::form::type_checkbox_option"),icon:"checkbox_large",type:"checkbox",field:{type:"checkbox",name:tr("editor::form::type_checkbox_option"),desc:"",is_checked:0}},select:{show:1,title:tr("editor::form::type_select_option"),icon:"select_large",type:"select",field:{type:"select",name:tr("editor::form::type_select_option"),desc:"",vars:[tr("editor::form::list_element1_placeholder"),tr("editor::form::list_element2_placeholder")]}},radio:{show:1,title:tr("editor::form::type_radio_option"),icon:"radio_large",type:"radio",field:{type:"radio",name:tr("editor::form::type_radio_option"),desc:"",vars:[tr("editor::form::list_element1_placeholder"),tr("editor::form::list_element2_placeholder")]}},file:{show:1,title:tr("editor::form::type_file_option"),icon:"file_large",type:"file",field:{type:"file",name:tr("editor::form::type_file_option"),desc:"",is_required:0}},range:{show:1,title:tr("editor::form::type_range_option"),icon:"range_large",type:"range",field:{type:"range",name:tr("editor::form::type_range_option"),double:0,start:0,end:100,step:10,prefix:"",suffix:"",desc:"",legend:{type:"limits",text:1,start:tr("editor::form::range::legend_start_placeholder"),end:tr("editor::form::range::legend_end_placeholder")}}},hidden:{show:1,type:"hidden",title:tr("editor::form::type_hidden_option"),icon:"hidden_large",field:{type:"hidden",name:tr("editor::form::type_hidden_option"),is_required:0}},delivery:{show:0,type:"delivery",title:tr("editor::form::type_delivery_option"),icon:"delivery_large",max:1,field:{type:"delivery",name:tr("editor::form::type_delivery_option")}}},rc=["template","style"];function oc(e){const t="sendAfterLeadCreated"===e?tr("admin::settings::notification_visitor::modal_edit::lead"):tr("admin::settings::notification_visitor::modal_edit::order"),s=[{value:"{order_id}",desc:tr("admin::settings::notification_visitor::modal_edit::oder_id",{leadOrder:t})},{value:"{create_date}",desc:tr("admin::settings::notification_visitor::modal_edit::create_date",{leadOrder:t})},{value:"{create_date_time}",desc:tr("admin::settings::notification_visitor::modal_edit::create_date_time",{leadOrder:t})}];return"sendAfterPaymentCreated"===e&&s.push({value:"{payment_date}",desc:tr("admin::settings::notification_visitor::modal_edit::payment_date",{leadOrder:t})},{value:"{payment_date_time}",desc:tr("admin::settings::notification_visitor::modal_edit::payment_date_time",{leadOrder:t})},{value:"{payment_method}",desc:tr("admin::settings::notification_visitor::modal_edit::payment_method")}),s.push({value:"{domain}",desc:tr("admin::settings::notification_visitor::modal_edit::domain")}),s}function lc(e){let t;switch(e){case"sendAfterLeadCreated":t={subjectLetter:tr("admin::settings::notification_visitor::modal_edit::default_lead_subject"),title:tr("admin::settings::notification_visitor::modal_edit::default_lead_title")};break;case"sendAfterOrderCreated":t={subjectLetter:tr("admin::settings::notification_visitor::modal_edit::default_order_subject"),title:tr("admin::settings::notification_visitor::modal_edit::default_order_title")};break;case"sendAfterPaymentCreated":t={subjectLetter:tr("admin::settings::notification_visitor::modal_edit::default_payment_subject"),title:tr("admin::settings::notification_visitor::modal_edit::default_payment_title")}}return t}riot3.tag2("editor-form-field-list",'<div class="flexbe-field-line empty-placeholder mb10" if="{state.list.length === 0}"> <svg class="flexbe-icon size-16"> <use riot-xlink:href="{meta.sprite}#fields-empty"></use> </svg> <span class="flexbe-text" if="{!meta.isExternal}"> {tr(\'editor::form::fields_empty\')} </span> <span class="flexbe-text" if="{meta.isExternal}"> {tr(\'editor::form::fields_additional_empty\')} </span> </div> <div if="{!destroyList && state.list.length}" data-is="flexbe-sort-list" class="field-list py10 mt-10" handle-selector=".draggable" item-selector=".flexbe-field-item" sortend="{sortField}"> <div class="flexbe-field-item flexbe-field-line" each="{field, index in tag.state.list}" key="{field.id}" data-id="{field.id}"> <div class="draggable"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{tag.meta.sprite}#drag"></use> </svg> </div> <svg class="field-type flexbe-icon size-14"> <use riot-xlink:href="{tag.meta.fieldsSprite}#{field.type}_thin"></use> </svg> <div class="field-name ml5 mr10"> <label data-is="flexbe-input" class="transparent w100" placeholder="{tr(\'editor::form::field_name_label\')}" riot-value="{field.name}" oninput="{tag.changeName.bind(tag, index)}"></label> </div> <div class="field-settings-button" onclick="{tag.showEditField.bind(tag, index)}"> {tr(\'editor::form::field_settings_button\')} </div> <div class="flexbe-icon field-remove ml5" if="{!tag.meta.isMin || field.type === \'hidden\'}" title="{tr(\'editor::form::field_delete_button\')}" onclick="{tag.deleteField.bind(tag, index)}"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{tag.meta.sprite}#remove-field"></use> </svg> </div> </div> </div> <div class="flexbe-button is-primary colored weight-medium block add-field" onclick="{showAddModal}" if="{!meta.isMax}"> <svg class="flexbe-icon size-10"> <use riot-xlink:href="{tag.meta.sprite}#add-field"></use> </svg> <span class="flexbe-text">{tr(\'editor::form::add_field_button\')}</span> </div> <div class="flexbe-bar has-line" if="{meta.isMax}"> {tr(\'editor::form::fields_limit_info\', { min: meta.options.min, max: meta.options.max })} </div> <div class="flexbe-bar has-line mt20" if="{meta.showDeliveryHelp}"> {tr(\'editor::form::fields_need_delivery_info\')} </div>',"",'class="editor-form-field-list {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={get list(){const e=t.props;return xt(e.data,e.path)}},this.meta={sprite:at("editor_form"),fieldsSprite:at("fields"),isExternal:e.isExternal,get options(){return t.props.options||{}},get isMin(){return t.state.list.filter((e=>"hidden"!==e.type)).length<=t.meta.options.min},get isMax(){return t.state.list.filter((e=>"hidden"!==e.type)).length>=t.meta.options.max},get showDeliveryHelp(){if(this.isMax)return!1;const e=this.options.show_delivery,s="object"==typeof flexbe_cli&&(flexbe_cli.vars._group.ecommerce.delivery||[]).filter((e=>e.enabled)).length>0,i=t.state.list.find((e=>"delivery"===e.type));return e&&s&&!i}},this.changeName=function(t,s){s.preventUpdate=!0;const i=[t,"name"],a=s.target.value;this.commit({path:i,value:a,render:["template"]},e.path)}.bind(this),this.sortField=function({oldIndex:t,newIndex:s}){if(t===s)return;const i=bt(this.state.list);i.splice(s,0,i.splice(t,1)[0]),this.commit({value:i,render:["template"]},e.path)}.bind(this),this.addField=function(t){if(!t)return!1;const s=bt({id:`${Ge(6,{exclude:this.state.list.map((e=>e.id))})}`,...t});this.meta.isExternal&&(s.id=`external_${s.id}`);const i=bt(this.state.list);let a=i.length;"delivery"===i[a-1]?.type&&(a-=1),i.splice(a,0,s),this.commit({value:i,render:rc},e.path)}.bind(this),this.deleteField=function(t,s){s.preventUpdate=!0;const i=bt(this.state.list);i.splice(t,1),this.commit({value:i,render:["template"]},e.path)}.bind(this),this.showAddModal=function(t){t.preventUpdate=!0;const s=e.modal,i=this.meta.options.types,a=Object.values(nc).filter((e=>{const t=e.type;if(!i.includes(t))return!1;if(e.max){if(this.state.list.filter((e=>e.type===t)).length>=e.max)return!1}return!0}));((e,t)=>{Zs.create({overlay:!1,width:500,clickOut:!0,duplicate:!1,...e,component:_s,props:{class:"flexbe-modal-content",filter:t,preventClose:()=>fs.shiftKey,...e.props}})})({width:470,title:tr("editor::form::field_add_title"),fromModal:s,item:t.target.closest(".flexbe-button"),props:{list:a,onselect:e=>this.addField(e.field)}})}.bind(this),this.showEditField=function(t,s){s.preventUpdate=!0;const i=e.modal,a=this.state.list[t],n=nc[a.type].title,r=this.state.list,o=[t];Zs.create({title:n,name:"quiz-field-add",width:420,fromModal:i,item:s.target.closest(".flexbe-field-item"),riotTag:"editor-form-field-edit",props:{class:"flexbe-modal-content",data:r,path:o,options:this.meta.options,commit:(t,s)=>{this.commit(t,[e.path,s])}}})}.bind(this),this.commit=function(...t){return e.commit?.(...t)}.bind(this)})),riot3.tag2("shipping-method-edit-modal",'<div class="flexbe-field-group"> <div class="flexbe-title"> {fields.title.label} </div> <div data-is="flexbe-input" type="{fields.title.type}" placeholder="{fields.title.placeholder}" riot-value="{fields.title.value}" error="{!fields.title.valid}" error-text="{fields.title.error}" oninput="{fields.title.onchange}" autofocus="{true}"></div> </div> <div class="flexbe-field-group"> <div class="flexbe-title"> {fields.desc.label} </div> <div data-is="flexbe-input" type="{fields.desc.type}" placeholder="{fields.desc.placeholder}" riot-value="{fields.desc.value}" error="{!fields.desc.valid}" error-text="{fields.desc.error}" oninput="{fields.desc.onchange}"></div> </div> <div class="flexbe-field-group row"> <div class="col col-6"> <div class="flexbe-title"> {fields.mainPrice.label} </div> <div data-is="flexbe-input" type="{fields.mainPrice.type}" placeholder="{fields.useNotFixTotal.value ? tr(\'admin::settings::ecommerce::shipping::edit::not_fix_price_placeholder\') : fields.mainPrice.placeholder}" riot-value="{fields.useNotFixTotal.value ? \'\' : fields.mainPrice.value}" error="{!fields.mainPrice.valid}" error-text="{fields.mainPrice.error}" oninput="{fields.mainPrice.onchange}" disabled="{fields.useNotFixTotal.value}" min="{0}"></div> </div> <div class="col col-6"> <div class="flexbe-title flexbe-tip-container"> {fields.freePrice.label} <q data-is="flexbe-tooltip" content="{fields.freePrice.tip}"></q> </div> <div data-is="flexbe-input" type="{fields.freePrice.type}" placeholder="{fields.freePrice.placeholder}" pattern="{fields.freePrice.pattern}" riot-value="{fields.freePrice.value}" error="{!fields.freePrice.valid}" error-text="{fields.freePrice.error}" oninput="{fields.freePrice.onchange}" min="{0}"></div> </div> </div> <div class="flexbe-field-group"> <div class="flexbe-field-item"> <label data-is="flexbe-input" type="{fields.useNotFixTotal.type}" checked="{fields.useNotFixTotal.value}" onchange="{fields.useNotFixTotal.onchange}"> <span class="flexbe-text">{tag.fields.useNotFixTotal.label}</span> <q data-is="flexbe-tooltip" content="{tag.fields.useNotFixTotal.tip}"></q> </label> </div> <div class="flexbe-field-item"> <label data-is="flexbe-input" type="{fields.useMinTotal.type}" checked="{fields.useMinTotal.value}" onchange="{fields.useMinTotal.onchange}"> <span class="flexbe-text">{tag.fields.useMinTotal.label}</span> <q data-is="flexbe-tooltip" content="{tag.fields.useMinTotal.tip}"></q> </label> </div> </div> <div if="{fields.useMinTotal.value}" class="flexbe-field-group total-input"> <div class="col col-6"> <div data-is="flexbe-input" type="{fields.minTotal.type}" placeholder="{fields.minTotal.placeholder}" riot-value="{fields.minTotal.value}" error="{!fields.minTotal.valid}" error-tip="{fields.minTotal.error}" oninput="{fields.minTotal.onchange}" onblur="{onBlur.bind(tag, fields.minTotal)}"></div> </div> </div> <div class="flexbe-field-group"> <div class="flexbe-title flexbe-tip-container"> {tr(\'admin::settings::ecommerce::shipping::edit::fields_title\')} <q data-is="flexbe-tooltip" content="{tr(\'admin::settings::ecommerce::shipping::edit::fields_tip\')}"></q> </div> <div data-is="editor-form-field-list" data="{state.method.fields}" commit="{commitFormFields}" options="{meta.formFieldsOptions}" modal="{opts.modal}" is-external="{true}"></div> </div> <hr class="flexbe-hr my20"> <div class="flexbe-field-group"> <label data-is="flexbe-input" type="{fields.enabled.type}" checked="{fields.enabled.value}" onchange="{fields.enabled.onchange}"> <span class="flexbe-text">{tag.fields.enabled.label}</span> </label> </div> <div class="flexbe-field-group"> <div class="flexbe-button filled is-primary {\'loading\': state.saving, \'shake-animation\': state.error}" onclick="{onSave}"> <span class="flexbe-text" if="{state.mode === \'add\'}"> {tr(\'admin::settings::ecommerce::shipping::edit::add_button\')} </span> <span class="flexbe-text" if="{state.mode !== \'add\'}"> {tr(\'admin::settings::ecommerce::save_button\')} </span> </div> </div>',"",'class="shipping-method-edit-modal flexbe-modal-content {opts.class}"',(function(e){this.mixin("initMobx");const t=this,s=(e,s)=>{const i=vt({get value(){return t.state.method[e]??""},set value(s){t.state.method[e]=s},afterSet:()=>{this.modalUnsaved()}},s);return new Hl(e,i)};this.state={saving:!1,error:!1,mode:e.mode??"edit",method:null,get minTotal(){return t.$state.cart?.use_total?t.$state.cart.total??0:0}},this.meta={currencyCode:flexbe.vars.group.currency.code,deliveryCurrency:{RUB:300,BYN:10,KZT:2e3,UAH:100,USD:10,EUR:10,GBP:10,CAD:15,AUD:15,PLN:40},formFieldsOptions:{min:0,allow_desc:!0,allow_lines:!0,types:Object.values(nc).filter((e=>e.show)).map((e=>e.type))}},this.fields=[],this.createFields=function(){const{meta:e}=this,i=s("enabled",{type:"toggle",label:tr("admin::settings::ecommerce::shipping::edit::enabled_label")}),a=s("title",{label:tr("admin::settings::ecommerce::shipping::edit::title_label"),placeholder:tr("admin::settings::ecommerce::shipping::edit::title_placeholder"),validators:[Ul.required]}),n=s("desc",{type:"textarea",label:tr("admin::settings::ecommerce::shipping::edit::desc_label"),placeholder:tr("admin::settings::ecommerce::shipping::edit::desc_placeholder")}),r=s("mainPrice",{type:"number",label:tr("admin::settings::ecommerce::shipping::edit::price_label"),placeholder:(()=>{const t=tr("admin::settings::ecommerce::shipping::edit::price_optional"),s=e.deliveryCurrency[e.currencyCode];return s?`${mt(s)} (${t})`.toLowerCase():t})(),get value(){const e=(t.state.method.prices||[])[0]?.price;return e??""},set value(e){t.state.method.prices[0].price=""===e?"":e}}),o=s("freePrice",{type:"text",pattern:"^[0-9]*$",label:tr("admin::settings::ecommerce::shipping::edit::free_price_label"),tip:tr("admin::settings::ecommerce::shipping::edit::free_price_tip"),placeholder:(()=>{const t=tr("admin::settings::ecommerce::shipping::edit::price_optional");let s=4*e.deliveryCurrency[e.currencyCode];return s?`${mt(s)} (${t})`.toLowerCase():t})(),get value(){const e=(t.state.method.prices||[])[1]?.from;return e??""},set value(e){const s=t.state.method.prices[1];s.price=0,s.from=""===e?"":e}}),l=s("useMinTotal",{type:"toggle",label:tr("admin::settings::ecommerce::shipping::edit::min_total_label"),tip:tr("admin::settings::ecommerce::shipping::edit::min_total_tip")}),d=s("minTotal",{type:"number",placeholder:(()=>{let t=2*e.deliveryCurrency[e.currencyCode];return t?`${mt(t)}`.toLowerCase():""})(),validators:[(e,s)=>{const i=(t.state.method.prices||[])[0]?.from,a=t.$state.cart?.total&&!(+i>+t.$state.cart.total),n=(!t.state.minTotal||!!a)&&this.fields.useMinTotal.value;if("input"===s||"submit"===s||!n)return;if(+e.value<=+t.state.minTotal)throw tr("admin::settings::ecommerce::shipping::edit::min_total_error")}],get value(){const e=(t.state.method.prices||[])[0]?.from;return e||""},set value(e){t.state.method.prices[0].from=e||0}}),c=s("useNotFixTotal",{type:"toggle",label:tr("admin::settings::ecommerce::shipping::edit::not_fix_price_label"),tip:tr("admin::settings::ecommerce::shipping::edit::not_fix_price_tip")});this.fields={title:a,desc:n,mainPrice:r,freePrice:o,enabled:i,useMinTotal:l,minTotal:d,useNotFixTotal:c}}.bind(this),this.checkErrors=function(e){return!Object.values(this.fields).every((t=>t.validate(e)))}.bind(this),this.onBlur=function(e){e.validate("blur"),this.update()}.bind(this),this.normalizeData=function(){const t=this.state;t.method={enabled:1,useMinTotal:0,useFixTotal:0,title:"",desc:"",prices:[],fields:[],...bt(e.data)},t.method.prices[0]={...t.method.prices[0]},t.method.prices[1]={...t.method.prices[1]},t.method.useMinTotal=+t.method.prices[0].from?t.method.useMinTotal:0}.bind(this),this.onSave=async function(t){t.preventUpdate=!0,this.state.error=!1;if(this.checkErrors("submit"))return this.update(),this.root.offsetHeight,this.state.error={code:"error_in_fields",message:tr("main::error:check_fields")},void this.update();const{mainPrice:s,freePrice:i,useNotFixTotal:a}=this.fields;s.price=+ht(s.price,flexbe.vars.group.currency.decimals,".",""),i.from=+ht(i.from,flexbe.vars.group.currency.decimals,".",""),a.value&&(s.value=""),this.state.saving=!0,this.update();const n=bt(this.state.method);try{"function"==typeof e.onSave&&await e.onSave(n),"add"===this.state.mode?toast.success(tr("admin::settings::ecommerce::shipping::created_notice")):toast.success(tr("admin::settings::ecommerce::saved_notice")),this.modalSaved(),this.modalClose()}catch(e){if("NetworkError"!==e.name)throw e;toast.error(e.message)}this.state.saving=!1,this.update()}.bind(this),this.commitFormFields=function(e,t){const s=[t,e.path],i=this.state.method.fields;_t(i,s,e.value),this.modalUnsaved(),this.update()}.bind(this),this.modalSaved=function(){e.modal?.saved()}.bind(this),this.modalUnsaved=function(){e.modal?.unsaved()}.bind(this),this.modalClose=function(){e.modal?.close()}.bind(this),this.onBeforeMount=function(){this.normalizeData(),this.createFields(),this.checkErrors()}.bind(this)})),riot3.tag2("discount-edit-modal",'<div class="flexbe-field-group"> <div class="flexbe-field-group {\'compact\': !state.dateToEnabled}" disabled="{!fields.active.value}"> <div class="flexbe-field-group row"> <div class="col"> <div class="flexbe-title"> {tr(\'admin::settings::ecommerce::promo::edit::type::discount_label\')} </div> <div class="flexbe-card-list"> <div class="flexbe-card-item" each="{type in meta.discountTypeList}" onclick="{setDiscountType.bind(this, type.value)}"> <div class="promo-type-item flexbe-white-card shadow rounded hoverable pointer {\'active\': (state.discount.discount_type === type.value)}"> <div class="promo-type-item--image"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{meta.sprite}#promo-{type.icon}"></use> </svg> </div> <div class="promo-type-item--title"> <span class="flexbe-text">{type.title}</span> </div> </div> </div> </div> </div> </div> <div class="flexbe-field-group row"> <div class="col col-6"> <div class="flexbe-title"> {fields.discountAmount.label} </div> <div data-is="proxy" is="flexbe-input" placeholder="{fields.discountAmount.placeholder}" riot-value="{fields.discountAmount.value}" oninput="{fields.discountAmount.onchange}" onenter="{onSave}" type="{fields.discountAmount.type}" error="{!fields.discountAmount.valid}" min="{fields.discountAmount.min}" max="{fields.discountAmount.max}" pattern="{/\\d/g}" max-length="{21}" allow-empty="{true}" autofocus="{fields.active.value}" suffix="{state.discount.discount_type === \'percent\' ? \'%\' : meta.currencySymbol}"></div> </div> </div> <div class="flexbe-field-group row"> <div class="col col-6"> <div class="flexbe-title"> {fields.activeFrom.label} </div> <div data-is="proxy" is="flexbe-input" placeholder="{fields.activeFrom.placeholder}" riot-value="{fields.activeFrom.value}" oninput="{fields.activeFrom.onchange}" onenter="{onSave}" type="{fields.activeFrom.type}" error="{!fields.activeFrom.valid}" error-tip="{meta.activeFromError}" min="{fields.activeFrom.min}" pattern="{/\\d/g}" max-length="{21}" allow-empty="{true}" suffix="{meta.currencySymbol}"></div> </div> </div> <div class="flexbe-field-group {\'compact\': !state.dateFromEnabled}"> <div class="flexbe-field-item"> <label data-is="proxy" is="flexbe-checkbox" type="{fields.dateFromEnabled.type}" checked="{fields.dateFromEnabled.value}" onchange="{fields.dateFromEnabled.onchange}"> <span class="flexbe-text">{tag.fields.dateFromEnabled.label}</span> </label> </div> </div> <div if="{state.dateFromEnabled}" class="flexbe-field-group row"> <div class="col col-6"> <div data-is="proxy" is="flexbe-date-input" placeholder="{fields.date_from.placeholder}" date-mask="{meta.dateFormat}" date-options="{meta.dateOptions}" riot-value="{fields.date_from.value}" error="{state.dateError || state.dateFromRequiredError}" error-tip="{meta.dateErrorText}" onchange="{fields.date_from.onchange}" onblur="{checkErrors}" onenter="{onSave}"></div> </div> <div class="col col-6"> <div data-is="flexbe-select" list="{fields.timeFrom.list}" riot-value="{fields.timeFrom.value}" error="{state.timeError}" error-tip="{meta.timeErrorText}" onchange="{fields.timeFrom.onchange}"></div> </div> </div> <div class="flexbe-field-group"> <div class="flexbe-field-item"> <label data-is="proxy" is="flexbe-checkbox" type="{fields.dateToEnabled.type}" checked="{fields.dateToEnabled.value}" onchange="{fields.dateToEnabled.onchange}"> <span class="flexbe-text">{tag.fields.dateToEnabled.label}</span> </label> </div> </div> <div if="{state.dateToEnabled}" class="flexbe-field-group row"> <div class="col col-6"> <div data-is="proxy" is="flexbe-date-input" placeholder="{fields.date_to.placeholder}" date-mask="{meta.dateFormat}" date-options="{meta.dateOptions}" riot-value="{fields.date_to.value}" error="{state.dateError || state.dateToError || state.dateToRequiredError}" error-tip="{meta.dateErrorText}" onchange="{fields.date_to.onchange}" onblur="{checkErrors}" onenter="{onSave}"></div> </div> <div class="col col-6"> <div data-is="flexbe-select" list="{fields.timeTo.list}" riot-value="{fields.timeTo.value}" error="{state.timeError || state.dateToError}" error-tip="{meta.timeErrorText}" onchange="{fields.timeTo.onchange}"></div> </div> </div> </div> <div class="flexbe-field-group"> <label data-is="proxy" is="flexbe-checkbox" type="{fields.active.type}" checked="{!fields.active.value}" onchange="{fields.active.onchange}"> <span class="flexbe-text">{tag.fields.active.label}</span> </label> </div> <div data-is="proxy" is="raw" class="flexbe-bar rounded has-line block flexbe-bar--info" if="{state.dateFromEnabled || state.dateToEnabled}" content="{tr(\'admin::settings::promocode::timezone_bar\') + \' (\' + state.timezone + \')\'}"> </div> </div> <div class="flexbe-field-group"> <div class="flexbe-button filled is-primary {\'loading\': state.saving, \'shake-animation\': state.error}" onclick="{onSave}"> <span class="flexbe-text" if="{state.mode === \'add\'}"> {tr(\'admin::settings::ecommerce::promo::add_discount_button\')} </span> <span class="flexbe-text" if="{state.mode !== \'add\'}"> {tr(\'admin::settings::ecommerce::save_button\')} </span> </div> </div>',"",'class="discount-edit-modal flexbe-modal-content {opts.class}"',(function(e){this.mixin("initMobx");const t=this,s=(e,s)=>{const i=vt({get value(){return t.state.discount[e]??""},set value(s){t.state.discount[e]=s},afterSet:()=>{this.modalUnsaved()}},s);return new Hl(e,i)},i=(e,t)=>{const s=this.state.discount;if(["date_from","date_to"].includes(e)&&t.date&&(this.state[`${e}_value`]=t.date.value||"",!t.date?.value))s[e]="";else{if(s[e]||(s[e]=new Date,t.time=t.time??this.meta.defaultTime[e]),t.time){const i=t.time.split(":");s[e].setHours(i[0]),s[e].setMinutes(i[1]),s[e].setSeconds(0)}if(t.date){const i=Ke(this.state[`${e}_value`],this.meta.dateFormat),a={date:t.date.date||i.date,month:t.date.month||i.month,year:t.date.year||i.year};a.date&&a.month&&a.year&&s[e].setFullYear(a.year,a.month-1,a.date)}["date_from","date_to"].includes(e)&&(t.date?this.state[`${e}_value`]=t.date.value||"":!this.state[`${e}_value`]&&t.time&&(this.state[`${e}_value`]=Xe(s[e]||new Date,this.meta.dateFormat))),this.update()}},a=(e,t)=>{"submit"===t&&Ul.required(e,t)},n=(e,s)=>{const i=t.state.discount.date_from,a=t.state.discount.date_to,n=Ze({date:Date.now(),timezone:this.state.timezone}),r=new Date(We(i)),o=new Date(We(a)),l=r-o,{dateFromEnabled:d,dateToEnabled:c}=t.state,p=d&&c,u="date_to"===e.name||"timeTo"===e.name,m="date_from"===e.name||"timeFrom"===e.name;if(this.state.dateToError=!1,this.state.dateError=!1,this.state.timeError=!1,this.state.dateFromRequiredError=!1,this.state.dateToRequiredError=!1,"submit"===s){if(!i&&d)throw this.state.dateFromRequiredError=!0,"dateFromRequired_error";if(!a&&c)throw this.state.dateToRequiredError=!0,"dateToRequired_error"}if(!(!d&&m||!c&&u)){if(u&&a&&o<n)throw this.state.dateToError=!0,"dateTo_error";if(i&&a&&Math.abs(l)<1e3)throw this.state.timeError=!0,"time_error";if(p&&i&&a&&r>o){throw l/36e5<24&&r.getDate()===o.getDate()?(this.state.timeError=!0,"time_error"):(this.state.dateError=!0,"date_error")}}},r=(e,s)=>{if("submit"===s){const s=e.value,i=t.state.discount.discount_amount,a="money"===t.state.discount.discount_type;if(""!==s&&i&&a&&s<i)throw this.state.activeFromError=!0,"active_from";this.state.activeFromError=!1}};this.state={saving:!1,error:!1,mode:e.mode??"edit",timezone:flexbe.vars.group.timezone||"Europe/Moscow",discount:{type:"discount",discount_type:"percent",note:"",discount_amount:"",date_from:null,date_to:null,active_from:"",active:!0,...e.data},lastDiscountAmount:{money:"",percent:""},dateFromEnabled:!1,dateToEnabled:!1,dateFromRequiredError:!1,dateToRequiredError:!1,dateToError:!1,dateError:!1,timeError:!1,activeFromError:!1,get isPercentDiscount(){return"percent"===this.discount.discount_type},get normalizedAciveFrom(){const e=+this.discount.discount_amount,t=+this.discount.active_from,s=this.isPercentDiscount||!e?0:e;return Math.max(s,t)}},this.meta={sprite:at("settings.ecommerce","admin"),currencyCode:flexbe.vars.group.currency.code,currencySymbol:flexbe.vars.group.currency.symbol,dateFormat:flexbe.vars.user.date_format.date,percentPlaceholder:20,discountCurrency:{RUB:200,BYN:10,KZT:2e3,UAH:100,USD:10,EUR:10,GBP:10,CAD:15,AUD:15,PLN:40},defaultTime:{date_from:"00:00:00",date_to:"23:59:00"},dateOptions:{year:{min:1990,max:2200}},get displayDateFormat(){let e=this.dateFormat;return e=e.replace(/d+/i,"DD"),e=e.replace(/m+/i,"MM"),e=e.replace(/y+/i,"YYYY"),e},get discountTypeList(){return[{title:tr("admin::settings::ecommerce::promo::edit::type_percent::title"),icon:"percent",value:"percent"},{title:tr("admin::settings::ecommerce::promo::edit::type_money::title",{currency:this.currencySymbol}),icon:"money",value:"money"}]},get listOfTimeValues(){const e=Array(24).fill(null).map(((e,t)=>({title:`${qe(t)}:00`,value:`${qe(t)}:00:00`})));return e.push({title:"23:59",value:"23:59:00"}),e},get dateErrorText(){return t.state.dateError?tr("admin::settings::ecommerce::promo::edit::date_error_tip"):t.state.dateToError?tr("admin::settings::ecommerce::promo::edit::date_to_error_tip"):""},get timeErrorText(){return t.state.timeError?tr("admin::settings::ecommerce::promo::edit::time_error_tip"):""},get activeFromError(){return tr("admin::settings::ecommerce::promo::edit::active_from_error_tip")}},this.fields=[],this.createFields=function(){const{meta:e}=this,o=s("discountAmount",{label:tr("admin::settings::ecommerce::promo::edit::amount::label"),type:"number",min:0,validators:[a],get max(){return"percent"===t.state.discount.discount_type?100:1/0},get placeholder(){const s=t.state.discount.discount_type;return"money"===s?e.discountCurrency[e.currencyCode]?e.discountCurrency[e.currencyCode]:"":"percent"===s?t.meta.percentPlaceholder:""},get value(){const e=t.state.discount?.discount_amount;return e?+e:""},set value(e){t.state.discount.discount_amount=""===e?"":e}}),l=s("activeFrom",{label:tr("admin::settings::ecommerce::promo::edit::active_from::label"),type:"number",min:0,validators:[r],get placeholder(){return t.state.normalizedAciveFrom},get value(){const e=t.state.discount?.active_from;return""!==e?+e:""},set value(e){t.state.discount.active_from=""===e?"":e}}),d=s("dateFromEnabled",{label:tr("admin::settings::ecommerce::promo::edit::date_from::label"),type:"toggle",get value(){return null!=t.state.discount.date_from},set value(e){t.state.dateFromEnabled=e,t.checkErrors()}}),c=s("dateToEnabled",{label:tr("admin::settings::ecommerce::promo::edit::date_to::label"),type:"toggle",get value(){return null!=t.state.discount.date_to},set value(e){t.state.dateToEnabled=e,t.checkErrors()}}),p=s("date_from",{validators:[n],get placeholder(){return t.meta.displayDateFormat},get show(){return t.state.dateFromEnabled},get value(){if(!t.state.discount.date_from)return"";const e=t.meta.dateFormat,s=t.state.date_from_value;return Ke(s,e)},onChange(e){"string"==typeof e.value&&i(this.name,{date:e}),t.modalUnsaved()}}),u=s("date_to",{validators:[n],get placeholder(){return t.meta.displayDateFormat},get show(){return t.state.dateToEnabled},get value(){if(!t.state.discount.date_to)return"";const e=t.meta.dateFormat,s=t.state.date_to_value;return Ke(s,e)},onChange(e){"string"==typeof e.value&&i(this.name,{date:e}),t.modalUnsaved()}}),m=s("timeFrom",{list:e.listOfTimeValues,validators:[n],get show(){return t.state.dateFromEnabled},get value(){return t.state.discount.date_from?Xe(t.state.discount.date_from,"h:i:s"):t.meta.defaultTime.date_from},set value(e){i("date_from",{time:e}),t.checkErrors()}}),h=s("timeTo",{list:e.listOfTimeValues,validators:[n],get show(){return t.state.dateToEnabled},get value(){return t.state.discount.date_to?Xe(t.state.discount.date_to,"h:i:s"):t.meta.defaultTime.date_to},set value(e){i("date_to",{time:e}),t.checkErrors()}}),g=s("active",{label:tr("admin::settings::ecommerce::promo::edit::active::discount_label"),type:"toggle",get value(){return t.state.discount.active},set value(e){t.state.discount.active=!e}});this.fields={discountAmount:o,activeFrom:l,dateFromEnabled:d,dateToEnabled:c,date_from:p,date_to:u,timeFrom:m,timeTo:h,active:g}}.bind(this),this.setDiscountType=function(e){const{discount:t}=this.state,s=t.discount_amount;this.state.activeFromError=!1,t.active_from="",t.discount_type!==e&&(t.discount_amount=this.state.lastDiscountAmount[e],this.state.lastDiscountAmount[t.discount_type]=s,t.discount_type=e,this.modalUnsaved(),this.update())}.bind(this),this.checkErrors=function(e){Object.values(this.fields).forEach((t=>t.validate(e))),this.update()}.bind(this),this.normalizeData=function(){const e=this.state.discount;this.state.discount_type=e.discount_type,this.state.dateFromEnabled=!!e.date_from,this.state.dateToEnabled=!!e.date_to,this.state.date_from_value=e.date_from?Xe(e.date_from,this.meta.dateFormat):"",this.state.date_to_value=e.date_to?Xe(e.date_to,this.meta.dateFormat):"",e.date_from=e.date_from?new Date(e.date_from):null,e.date_to=e.date_to?new Date(e.date_to):null}.bind(this),this.onSave=async function(t){t.preventUpdate=!0,this.state.error=!1,$(this.root).find("input").trigger("blur");const s=!!$(this.root).find(".flexbe-date-input .error").length;if(!Object.values(this.fields).every((e=>e.validate("submit")))||s)return this.update(),this.root.offsetHeight,this.state.error={code:"error_in_fields",message:tr("main::error:check_fields")},void this.update();this.state.saving=!0,this.update();const i=bt(this.state.discount);i.active_from=this.state.normalizedAciveFrom,i.date_from=this.state.dateFromEnabled&&this.state.discount.date_from?Xe(this.state.discount.date_from,"y-m-d h:i:s")||"":null,i.date_to=this.state.dateToEnabled&&this.state.discount.date_to?Xe(this.state.discount.date_to,"y-m-d h:i:s")||"":null,i.active=!!i.active;try{"function"==typeof e.onSave&&await e.onSave(i),"add"===this.state.mode?toast.success(tr("admin::settings::ecommerce::promo::discount::created_notice")):toast.success(tr("admin::settings::ecommerce::saved_notice")),this.modalSaved(),this.modalClose()}catch(e){if(toast.error(tr("admin::settings::ecommerce::failed_save_toast")),"NetworkError"!==e.name)throw e}this.state.saving=!1,this.update()}.bind(this),this.modalSaved=function(){e.modal?.saved()}.bind(this),this.modalUnsaved=function(){e.modal?.unsaved()}.bind(this),this.modalClose=function(){e.modal?.close()}.bind(this),this.onBeforeMount=function(){this.createFields(),this.normalizeData()}.bind(this),this.onMounted=function(){this._hotkeysSaveDisposer=fs.register([{hotkeys:["cmd_s"],handlerDown:this.onSave}])}.bind(this),this.onUnmounted=function(){this._hotkeysSaveDisposer?.()}.bind(this)})),riot3.tag2("promocode-edit-modal",'<div class="flexbe-field-group"> <div class="flexbe-field-group compact" disabled="{!fields.active.value}"> <div class="flexbe-field-group row"> <div class="col"> <div class="flexbe-title"> <span class="flexbe-text"> {fields.code.label} </span> <q data-is="flexbe-tooltip" content="{fields.code.tip}"></q> </div> <div class="promocode-wrap"> <div data-is="flexbe-input" class="promocode-input" placeholder="{fields.code.placeholder}" max-length="{fields.code.maxLength}" riot-value="{fields.code.value}" type="{fields.code.type}" error="{!fields.code.valid}" autofocus="{fields.active.value && state.mode === \'add\'}" pattern="{/[a-zA-Z--_.-\\d]/g}" onchange="{fields.code.onchange}" oninput="{checkCodeErrors}" onblur="{checkErrors}" onenter="{onSave}"> <div class="flexbe-input__addon generate-promocode-button" onclick="{tag.generatePromocode}"> {tr(\'admin::settings::ecommerce::promo::edit::promocode_generate\')} </div> </div> <div class="promocode-error"> <div class="flexbe-text" if="{!tag.fields.code.valid && tag.fields.code.error === \'repeating_promocode\'}"> {tr(\'admin::settings::ecommerce::promo::promocode_unique_error\')} </div> <div class="flexbe-text" if="{state.langError}"> {tr(\'admin::settings::ecommerce::promo::promocode_lang_error\')} </div> </div> </div> </div> </div> <div class="flexbe-field-group row"> <div class="col"> <div class="flexbe-title"> {tr(\'admin::settings::ecommerce::promo::edit::type::promocode_label\')} </div> <div class="flexbe-card-list"> <div class="flexbe-card-item" each="{type in meta.promocodeTypeList}" onclick="{setPromocodeType.bind(this, type.value)}"> <div class="promo-type-item flexbe-white-card shadow rounded hoverable pointer {\'active\': (state.promocode.discount_type === type.value)}"> <div class="promo-type-item--image"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{meta.sprite}#promo-{type.icon}"></use> </svg> </div> <div class="promo-type-item--title"> <span class="flexbe-text">{type.title}</span> </div> </div> </div> </div> </div> </div> <div class="flexbe-field-group row" if="{fields.promocodeAmount.show}"> <div class="col col-6"> <div class="flexbe-title"> {fields.promocodeAmount.label} </div> <div data-is="proxy" is="flexbe-input" placeholder="{fields.promocodeAmount.placeholder}" riot-value="{fields.promocodeAmount.value}" oninput="{fields.promocodeAmount.onchange}" onenter="{onSave}" type="{fields.promocodeAmount.type}" error="{!fields.promocodeAmount.valid}" min="{fields.promocodeAmount.min}" max="{fields.promocodeAmount.max}" autofocus="{fields.active.value && state.mode === \'edit\'}" pattern="{/\\d/g}" max-length="{21}" allow-empty="{true}" suffix="{state.promocode.discount_type === \'percent\' ? \'%\' : meta.currencySymbol}"></div> </div> </div> <div class="flexbe-field-group row"> <div class="col col-6"> <div class="flexbe-title"> {fields.activeFrom.label} </div> <div data-is="proxy" is="flexbe-input" placeholder="{fields.activeFrom.placeholder}" riot-value="{fields.activeFrom.value}" oninput="{fields.activeFrom.onchange}" onenter="{onSave}" type="{fields.activeFrom.type}" min="{fields.activeFrom.min}" pattern="{/\\d/g}" max-length="{21}" allow-empty="{true}" suffix="{meta.currencySymbol}"></div> </div> </div> <div class="flexbe-field-group {\'compact\': !state.dateFromEnabled}"> <div class="flexbe-field-item"> <label data-is="proxy" is="flexbe-checkbox" type="{fields.dateFromEnabled.type}" checked="{fields.dateFromEnabled.value}" onchange="{fields.dateFromEnabled.onchange}"> <span class="flexbe-text">{tag.fields.dateFromEnabled.label}</span> </label> </div> </div> <div if="{state.dateFromEnabled}" class="flexbe-field-group row"> <div class="col col-6"> <div data-is="proxy" is="flexbe-date-input" placeholder="{fields.date_from.placeholder}" date-mask="{meta.dateFormat}" date-options="{meta.dateOptions}" riot-value="{fields.date_from.value}" error="{state.dateError || state.dateFromRequiredError}" error-tip="{meta.dateErrorText}" onchange="{fields.date_from.onchange}" onblur="{checkErrors}" onenter="{onSave}"></div> </div> <div class="col col-6"> <div data-is="flexbe-select" list="{fields.timeFrom.list}" riot-value="{fields.timeFrom.value}" error="{state.timeError}" error-tip="{meta.timeErrorText}" onchange="{fields.timeFrom.onchange}"></div> </div> </div> <div class="flexbe-field-group {\'compact\': !state.dateToEnabled}"> <div class="flexbe-field-item"> <label data-is="proxy" is="flexbe-checkbox" type="{fields.dateToEnabled.type}" checked="{fields.dateToEnabled.value}" onchange="{fields.dateToEnabled.onchange}"> <span class="flexbe-text">{tag.fields.dateToEnabled.label}</span> </label> </div> </div> <div if="{state.dateToEnabled}" class="flexbe-field-group row"> <div class="col col-6"> <div data-is="proxy" is="flexbe-date-input" placeholder="{fields.date_to.placeholder}" date-mask="{meta.dateFormat}" date-options="{meta.dateOptions}" riot-value="{fields.date_to.value}" error="{state.dateError || state.dateToError || state.dateToRequiredError}" error-tip="{meta.dateErrorText}" onchange="{fields.date_to.onchange}" onblur="{checkErrors}" onenter="{onSave}"></div> </div> <div class="col col-6"> <div data-is="flexbe-select" list="{fields.timeTo.list}" riot-value="{fields.timeTo.value}" error="{state.timeError || state.dateToError}" error-tip="{meta.timeErrorText}" onchange="{fields.timeTo.onchange}"></div> </div> </div> <div class="flexbe-field-group {\'compact\': !state.limitEnabled}"> <div class="flexbe-field-item"> <label data-is="proxy" is="flexbe-checkbox" type="{fields.limitEnabled.type}" checked="{fields.limitEnabled.value}" onchange="{fields.limitEnabled.onchange}"> <span class="flexbe-text">{tag.fields.limitEnabled.label}</span> </label> </div> </div> <div if="{state.limitEnabled}" class="flexbe-field-group row"> <div class="col col-6"> <div data-is="proxy" is="flexbe-input" type="{fields.limit.type}" placeholder="{fields.limit.placeholder}" riot-value="{fields.limit.value}" onchange="{fields.limit.onchange}" onenter="{onSave}" min="{fields.limit.min}" suffix="{fields.limit.addon}"></div> </div> </div> <div class="flexbe-field-group compact" if="{meta.showDeliveryToggle}"> <label data-is="proxy" is="flexbe-checkbox" type="{fields.deliveryFree.type}" checked="{fields.deliveryFree.value}" onchange="{fields.deliveryFree.onchange}"> <span class="flexbe-text">{tag.fields.deliveryFree.label}</span> </label> </div> <div class="flexbe-field-group compact"> <label data-is="proxy" is="flexbe-checkbox" type="{fields.usageWithAnyDiscount.type}" checked="{fields.usageWithAnyDiscount.value}" onchange="{fields.usageWithAnyDiscount.onchange}"> <span class="flexbe-text">{tag.fields.usageWithAnyDiscount.label}</span> </label> </div> </div> <div class="flexbe-field-group"> <label data-is="proxy" is="flexbe-checkbox" type="{fields.active.type}" checked="{!fields.active.value}" onchange="{fields.active.onchange}"> <span class="flexbe-text">{tag.fields.active.label}</span> </label> </div> <div data-is="proxy" is="raw" class="flexbe-bar rounded has-line block flexbe-bar--info" if="{state.dateFromEnabled || state.dateToEnabled}" content="{tr(\'admin::settings::promocode::timezone_bar\') + \' (\' + state.timezone + \')\'}"> </div> </div> <div class="flexbe-field-group"> <div class="flexbe-button filled is-primary {\'loading\': state.saving, \'shake-animation\': state.error}" onclick="{onSave}"> <span class="flexbe-text" if="{state.mode === \'add\'}"> {tr(\'admin::settings::ecommerce::promo::add_promocode_button\')} </span> <span class="flexbe-text" if="{state.mode !== \'add\'}"> {tr(\'admin::settings::ecommerce::save_button\')} </span> </div> </div>',"",'class="promocode-edit-modal flexbe-modal-content {opts.class}"',(function(e){this.mixin("initMobx");const t=this,s=(e,s)=>{const i=vt({get value(){return t.state.promocode[e]??""},set value(s){t.state.promocode[e]=s},afterSet:()=>{this.modalUnsaved()}},s);return new Hl(e,i)},i=(e,t)=>{const s=this.state.promocode;if(["date_from","date_to"].includes(e)&&t.date&&(this.state[`${e}_value`]=t.date.value||"",!t.date?.value))s[e]="";else{if(s[e]||(s[e]=new Date,t.time=t.time??this.meta.defaultTime[e]),t.time){const i=t.time.split(":");s[e].setHours(i[0]),s[e].setMinutes(i[1]),s[e].setSeconds(0)}if(t.date){const i=Ke(this.state[`${e}_value`],this.meta.dateFormat),a={date:t.date.date||i.date,month:t.date.month||i.month,year:t.date.year||i.year};a.date&&a.month&&a.year&&s[e].setFullYear(a.year,a.month-1,a.date)}["date_from","date_to"].includes(e)&&(t.date?this.state[`${e}_value`]=t.date.value||"":!this.state[`${e}_value`]&&t.time&&(this.state[`${e}_value`]=Xe(s[e]||new Date,this.meta.dateFormat))),this.update()}},a=(e,s)=>{const i=t.state.promocode.date_from,a=t.state.promocode.date_to,n=Ze({date:Date.now(),timezone:this.state.timezone}),r=new Date(We(i)),o=new Date(We(a)),l=r-o,{dateFromEnabled:d,dateToEnabled:c}=t.state,p=d&&c,u="date_to"===e.name||"timeTo"===e.name,m="date_from"===e.name||"timeFrom"===e.name;if(this.state.dateToError=!1,this.state.dateError=!1,this.state.timeError=!1,this.state.dateFromRequiredError=!1,this.state.dateToRequiredError=!1,"submit"===s){if(!i&&d)throw this.state.dateFromRequiredError=!0,"dateFromRequired_error";if(!a&&c)throw this.state.dateToRequiredError=!0,"dateToRequired_error"}if(!(!d&&m||!c&&u)){if(u&&a&&o<n)throw this.state.dateToError=!0,"dateTo_error";if(i&&a&&Math.abs(l)<1e3)throw this.state.timeError=!0,"time_error";if(p&&i&&a&&r>o){throw l/36e5<24&&r.getDate()===o.getDate()?(this.state.timeError=!0,"time_error"):(this.state.dateError=!0,"date_error")}}},n=(e,t)=>("submit"===t&&Ul.required(e,t),!1),r=e=>{const s=e.value,i="edit"===this.state.mode&&s===this.state.lastCodeValue,a=t.$store.helpers.isUniquePromocode(s);if(this.state.langError=/[a-z]/gi.test(s)&&/[--]/g.test(s),s&&!i&&!a)throw"repeating_promocode"};this.state={saving:!1,error:!1,mode:e.mode??"edit",timezone:flexbe.vars.group.timezone||"Europe/Moscow",promocode:{code:"",type:"promocode",discount_type:"percent",note:"",discount_amount:"",date_from:null,date_to:null,active_from:"",available_count:"",usage_with_any_discount:!1,delivery_free:!1,active:!0,...e.data},lastCodeValue:e.data?.code,lastAmount:{money:"",percent:""},dateFromRequiredError:!1,dateToRequiredError:!1,dateError:!1,timeError:!1,dateToError:!1,langError:!1,activeFromError:!1,dateFromEnabled:!1,dateToEnabled:!1,limitEnabled:!1},this.meta={sprite:at("settings.ecommerce","admin"),currencyCode:flexbe.vars.group.currency.code,currencySymbol:flexbe.vars.group.currency.symbol,dateFormat:flexbe.vars.user.date_format.date,percentPlaceholder:20,promocodeCurrency:{RUB:200,BYN:10,KZT:2e3,UAH:100,USD:10,EUR:10,GBP:10,CAD:15,AUD:15,PLN:40},defaultTime:{date_from:"00:00:00",date_to:"23:59:00"},dateOptions:{year:{min:1990,max:2200}},get displayDateFormat(){let e=this.dateFormat;return e=e.replace(/d+/i,"DD"),e=e.replace(/m+/i,"MM"),e=e.replace(/y+/i,"YYYY"),e},get promocodeTypeList(){return[{title:tr("admin::settings::ecommerce::promo::edit::type_percent::title"),icon:"percent",value:"percent"},{title:tr("admin::settings::ecommerce::promo::edit::type_money::title",{currency:this.currencySymbol}),icon:"money",value:"money"}]},get listOfTimeValues(){const e=Array(24).fill(null).map(((e,t)=>({title:`${qe(t)}:00`,value:`${qe(t)}:00:00`})));return e.push({title:"23:59",value:"23:59:00"}),e},get dateErrorText(){return t.state.dateError?tr("admin::settings::ecommerce::promo::edit::date_error_tip"):t.state.dateToError?tr("admin::settings::ecommerce::promo::edit::date_to_error_tip"):""},get timeErrorText(){return t.state.timeError?tr("admin::settings::ecommerce::promo::edit::time_error_tip"):""},get showDeliveryToggle(){return!1}},this.fields=[],this.createFields=function(){const{meta:e}=this,o=s("code",{label:tr("admin::settings::ecommerce::promo::edit::promocode::label"),placeholder:tr("admin::settings::ecommerce::promo::edit::promocode::placeholder"),tip:tr("admin::settings::ecommerce::promo::edit::promocode::tip"),validators:[n,r],maxLength:30,get value(){return t.state.promocode.code},set value(e){t.state.promocode.code=e.toUpperCase()}}),l=s("discountAmount",{label:tr("admin::settings::ecommerce::promo::edit::amount::label"),type:"number",min:0,validators:[n],get max(){return"percent"===t.state.promocode.discount_type?100:1/0},get show(){return"delivery"!==t.state.promocode.discount_type},get placeholder(){const s=t.state.promocode.discount_type;return"money"===s?e.promocodeCurrency[e.currencyCode]?e.promocodeCurrency[e.currencyCode]:"":"percent"===s?t.meta.percentPlaceholder:""},get value(){const e=t.state.promocode?.discount_amount;return e?+e:""},set value(e){t.state.promocode.discount_amount=""===e?"":e}}),d=s("activeFrom",{label:tr("admin::settings::ecommerce::promo::edit::active_from::label"),type:"number",min:0,get placeholder(){return 0},get value(){const e=t.state.promocode?.active_from;return""!==e?+e:""},set value(e){t.state.promocode.active_from=""===e?"":e}}),c=s("dateFromEnabled",{label:tr("admin::settings::ecommerce::promo::edit::date_from::label"),type:"toggle",get value(){return null!=t.state.promocode.date_from},set value(e){t.state.dateFromEnabled=e,t.checkErrors()}}),p=s("dateToEnabled",{label:tr("admin::settings::ecommerce::promo::edit::date_to::label"),type:"toggle",get value(){return null!=t.state.promocode.date_to},set value(e){t.state.dateToEnabled=e,t.checkErrors()}}),u=s("date_from",{validators:[a],get placeholder(){return t.meta.displayDateFormat},get value(){if(!t.state.promocode.date_from)return"";const e=t.meta.dateFormat,s=t.state.date_from_value;return Ke(s,e)},onChange(e){"string"==typeof e.value&&i(this.name,{date:e}),t.modalUnsaved()}}),m=s("date_to",{validators:[a],get placeholder(){return t.meta.displayDateFormat},get value(){if(!t.state.promocode.date_to)return"";const e=t.meta.dateFormat,s=t.state.date_to_value;return Ke(s,e)},onChange(e){"string"==typeof e.value&&i(this.name,{date:e}),t.modalUnsaved()}}),h=s("timeFrom",{list:e.listOfTimeValues,validators:[a],get value(){return t.state.promocode.date_from?Xe(t.state.promocode.date_from,"h:i:s"):t.meta.defaultTime.date_from},set value(e){i("date_from",{time:e}),t.checkErrors()}}),g=s("timeTo",{list:e.listOfTimeValues,validators:[a],get value(){return t.state.promocode.date_to?Xe(t.state.promocode.date_to,"h:i:s"):t.meta.defaultTime.date_to},set value(e){i("date_to",{time:e}),t.checkErrors()}}),v=s("limitEnabled",{label:tr("admin::settings::ecommerce::promo::edit::limit::label"),type:"toggle",get value(){return!!t.state.promocode.available_count},set value(e){t.state.limitEnabled=e,t.checkErrors()}}),f=s("availableCount",{placeholder:50,addon:tr("admin::settings::ecommerce::promo::edit::limit::placeholder"),type:"number",min:1,get value(){return t.state.promocode?.available_count||""},set value(e){t.state.promocode.available_count=""===e?"":e}}),x=s("deliveryFree",{label:tr("admin::settings::ecommerce::promo::edit::delivery_free::label"),type:"toggle",get value(){return t.state.promocode.delivery_free},set value(e){t.state.promocode.delivery_free=e}}),b=s("usageWithAnyDiscount",{label:tr("admin::settings::ecommerce::promo::edit::usage_with_discount::label"),type:"toggle",get value(){return t.state.promocode.usage_with_any_discount},set value(e){t.state.promocode.usage_with_any_discount=e}}),y=s("active",{label:tr("admin::settings::ecommerce::promo::edit::active::promocode_label"),type:"toggle",get value(){return t.state.promocode.active},set value(e){t.state.promocode.active=!e}});this.fields={code:o,promocodeAmount:l,activeFrom:d,dateFromEnabled:c,dateToEnabled:p,date_from:u,date_to:m,timeFrom:h,timeTo:g,limitEnabled:v,limit:f,deliveryFree:x,usageWithAnyDiscount:b,active:y}}.bind(this),this.setPromocodeType=function(e){const{promocode:t}=this.state,s=t.discount_amount;t.discount_type!==e&&(t.discount_amount=this.state.lastAmount[e],this.state.lastAmount[t.discount_type]=s,t.discount_type=e,this.modalUnsaved(),this.update())}.bind(this),this.checkCodeErrors=function(e){try{r({value:e.target.value}),this.fields.code.error=!1}catch(e){this.fields.code.error=e}this.update()}.bind(this),this.checkErrors=function(e){Object.values(this.fields).forEach((t=>t.validate(e))),this.update()}.bind(this),this.normalizeData=function(){const e=this.state.promocode;this.state.promocodeType=e.discount_type,this.state.limitEnabled=!!e.available_count,this.state.dateFromEnabled=!!e.date_from,this.state.dateToEnabled=!!e.date_to,this.state.date_from_value=e.date_from?Xe(e.date_from,this.meta.dateFormat):"",this.state.date_to_value=e.date_to?Xe(e.date_to,this.meta.dateFormat):"",this.state.langError=e.code&&/[a-z]/gi.test(e.code)&&/[--]/g.test(e.code),e.date_from=e.date_from?new Date(e.date_from):null,e.date_to=e.date_to?new Date(e.date_to):null}.bind(this),this.generatePromocode=function(){this.fields.code.value=this.$store.helpers.generatePromocode(),this.fields.code.validate(),this.modalUnsaved(),this.update()}.bind(this),this.onSave=async function(t){t.preventUpdate=!0,this.state.error=!1,$(this.root).find("input").trigger("blur");const s=!!$(this.root).find(".flexbe-date-input .error").length;if(!Object.values(this.fields).every((e=>e.validate("submit")))||s)return this.update(),this.root.offsetHeight,this.state.error={code:"error_in_fields",message:tr("main::error:check_fields")},void this.update();this.state.saving=!0,this.update();let i=bt(this.state.promocode);i={...i,active_from:+i.active_from,date_from:this.state.dateFromEnabled&&this.state.promocode.date_from?Xe(this.state.promocode.date_from,"y-m-d h:i:s")||"":null,date_to:this.state.dateToEnabled&&this.state.promocode.date_to?Xe(this.state.promocode.date_to,"y-m-d h:i:s")||"":null,available_count:this.state.limitEnabled&&i.available_count?+i.available_count:null,active:!!i.active,discount_amount:i.discount_amount||"0"};try{"function"==typeof e.onSave&&await e.onSave(i),"add"===this.state.mode?toast.success(tr("admin::settings::ecommerce::promo::promocode::created_notice")):toast.success(tr("admin::settings::ecommerce::saved_notice")),this.modalSaved(),this.modalClose()}catch(e){if(toast.error(tr("admin::settings::ecommerce::failed_save_toast")),"NetworkError"!==e.name)throw e}this.state.saving=!1,this.update()}.bind(this),this.modalSaved=function(){e.modal?.saved()}.bind(this),this.modalUnsaved=function(){e.modal?.unsaved()}.bind(this),this.modalClose=function(){e.modal?.close()}.bind(this),this.onBeforeMount=function(){this.createFields(),this.normalizeData()}.bind(this),this.onMounted=function(){this._hotkeysSaveDisposer=fs.register([{hotkeys:["cmd_s"],handlerDown:this.onSave}])}.bind(this),this.onUnmounted=function(){this._hotkeysSaveDisposer?.()}.bind(this)})),riot3.tag2("shipping-method-type-modal",'<div class="flexbe-title text-subtitle"> {tr(\'admin::settings::ecommerce::shipping::select_type_label\')} </div> <div class="flexbe-card-list"> <div class="flexbe-card-item" each="{method in methods}"> <div class="method-item flexbe-white-card shadow rounded hoverable pointer" onclick="{onSelect}"> <div class="method-item--image"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{sprite}#large-method-{method.type}"></use> </svg> </div> <div class="method-item--title"> <span class="flexbe-text">{method.title}</span> </div> </div> </div> </div>',"",'class="shipping-method-type-modal flexbe-modal-content {opts.class}"',(function(e){const t=()=>`external_${Ge(6)}`;this.sprite=at("settings.ecommerce","admin"),this.methods=[{type:"pickup",enabled:1,title:tr("admin::settings::ecommerce::shipping::pickup_type_title"),desc:"",prices:[{from:0,price:""},{from:"",price:0}],fields:[]},{type:"courier",enabled:1,title:tr("admin::settings::ecommerce::shipping::courier_type_title"),desc:"",prices:[{from:0,price:""},{from:"",price:0}],fields:[{id:t(),type:"textarea",name:tr("admin::settings::ecommerce::shipping::courier_address_field"),desc:"",lines:1,is_required:1},{id:t(),type:"textarea",name:tr("admin::settings::ecommerce::shipping::courier_comment_field"),desc:"",lines:1,is_required:0}]},{type:"other",enabled:1,title:tr("admin::settings::ecommerce::shipping::other_type_title"),desc:"",prices:[{from:0,price:""},{from:"",price:0}]}],this.onSelect=function(t){const s=t.item.method;e.onSelect?.(s),e.modal.close()}.bind(this)})),riot3.tag2("element-shipping-item",'<div class="row"> <div class="col title"> <span class="draggable"> <svg class="flexbe-icon"><use riot-xlink:href="{meta.spriteSettings}#draggable"></use></svg> </span> <div class="method-label"> <div class="method-title"> <span class="flexbe-text"> {state.title} </span> <span class="flexbe-tag small is-light" if="{!state.enabled}" data-is="flexbe-tooltip" content="{tr(\'admin::settings::ecommerce::shipping::disabled_tip\')}"> {tr(\'admin::settings::ecommerce::shipping::disabled_label\')} </span> <span class="flexbe-tag small {meta.errorMinTotalDelivery ? \'is-danger\' : \'is-light\'}" if="{state.minTotalDeliveryEnabled}" data-is="flexbe-tooltip" content="{meta.errorMinTotalDelivery}"> {tr(\'admin::settings::ecommerce::shipping::min_total_label\', { min_total: tag.state.minTotalDelivery })} </span> </div> <div class="method-desc flexbe-desc" if="{state.desc}"> {state.desc} </div> </div> </div> <div class="col price"> <span class="flexbe-text"> {state.mainPrice} </span> <span class="flexbe-text text-shade text-nowrap" if="{state.freePrice}"> ({tr(\'admin::settings::ecommerce::shipping::free_from_price\', { price: state.freePrice })}) </span> </div> <div class="col misc"> <div class="flexbe-action-buttons"> <div class="action-button" data-is="flexbe-tooltip" content="{tr(\'admin::settings::ecommerce::shipping::edit_method_button\')}" onclick="{editMethod}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.meta.spriteSettings}#settings"></use></svg> </div> <div class="action-button" data-is="flexbe-tooltip" content="{tr(\'admin::settings::ecommerce::shipping::remove_method_button\')}" onclick="{removeMethod}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.meta.spriteSettings}#remove"></use></svg> </div> </div> </div> </div>',"",'class="element-shipping-item {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.state={get method(){return t.props.method},get id(){return this.method.id},get enabled(){return this.method.enabled},get title(){return this.method.title||""},get desc(){return this.method.desc||""},get prices(){const e=h(this.method.prices)||[];return[e[0]||{price:0},e[1]||{from:0}]},get mainPrice(){const e=this.method.useNotFixTotal,t=this.prices,s=t[0],i=t[1];return(""===s.price||0==+s.price||i.from&&0===i.from)&&!e?tr("admin::settings::ecommerce::shipping::free_price_label"):e?tr("admin::settings::ecommerce::shipping::not_fix_price_label"):mt(s.price)},get freePrice(){const e=this.prices,t=this.method.useNotFixTotal,s=e[0],i=e[1];if((s.price||t)&&""!==i.from)return mt(i.from)},get minTotalDeliveryEnabled(){const e=this.prices,t=this.method.useMinTotal;return!!+e[0].from&&t},get minTotalDelivery(){return mt(this.prices[0].from)},get minTotal(){return t.$state.cart?.use_total?t.$state.cart.total??0:0}},this.meta={spriteSettings:at("settings","admin"),spriteEcommerce:at("settings.ecommerce","admin"),get errorMinTotalDelivery(){let e="";return t.state.prices[0].from<=+t.state.minTotal&&(e=tr("admin::settings::ecommerce::shipping::min_total_error_tip")),e}},this.editMethod=function(){!function(e,t){Zs.create({overlay:!0,shadow:!0,handle:!1,title:tr("admin::settings::ecommerce::shipping::edit_modal_title"),width:400,...t,riotTag:"shipping-method-edit-modal",props:{mode:"edit",...e}})}({data:h(this.state.method),onSave:async e=>{await this.$store.dispatch("updateMethod",e.id,e)}})}.bind(this),this.removeMethod=function(){As({props:{icon:`${this.meta.spriteEcommerce}#remove_modal`,title:tr("admin::settings::ecommerce::shipping::remove_confirm_title",{name:this.state.title}),confirmButtonClass:"is-danger bordered colored",confirmButtonText:tr("main::button::delete"),cancelButton:!0,onConfirm:async()=>{await this.$store.dispatch("removeMethod",this.state.id),toast.success(tr("admin::settings::ecommerce::shipping::remove_notice"))},onError:e=>{if("NetworkError"!==e.name)throw e;toast.error(e.message)}},clickOut:!0})}.bind(this)})),riot3.tag2("settings-block-delivery",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text"> {tr(\'admin::settings::ecommerce::shipping::title\')} </span> <span data-is="admin-save-text" class="flexbe-desc" status="{state.status}"></span> </div> <div class="flexbe-white-box shadow is-card" if="{!tag.state.list.length}"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{meta.sprite}#empty_methods"></use> </svg> <div class="flexbe-text my20"> {tr(\'admin::settings::ecommerce::shipping::empty_list_text\')} </div> <div class="flexbe-button filled rounded large is-primary" onclick="{showAddMethod}"> <span class="flexbe-text">{tr(\'admin::settings::ecommerce::shipping::add_method_button\')}</span> </div> </div> <div if="{!destroyList && tag.state.list.length}" class="flexbe-white-box shadow collection" data-is="flexbe-sort-list" item-selector=".element-shipping-item" handle-selector=".draggable" sortend="{sortEnd}"> <div class="collection-item collection-header font-ui"> <div class="row gap-50"> <div class="col title"> {tr(\'admin::settings::ecommerce::shipping::header_title\')} </div> <div class="col price"> {tr(\'admin::settings::ecommerce::shipping::header_price\')} </div> </div> </div> <div data-is="element-shipping-item" class="collection-item" each="{method, key in tag.state.list}" key="id" method="{method}"></div> <div class="collection-item shade"> <div class="flexbe-button small is-primary filled" onclick="{tag.showAddMethod}"> <span class="flexbe-text"> {tr(\'admin::settings::ecommerce::shipping::add_method_button\')} </span> </div> </div> </div> <div class="flexbe-desc mt20" if="{tag.state.list.length}"> {tr(\'admin::settings::ecommerce::shipping::desc\')} </div>',"",'class="settings-block-delivery {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.state={get status(){return t.$state.status??"saved"},get list(){return t.$store.getters.list}},this.meta={sprite:at("settings.ecommerce","admin")},this.sortEnd=async function({oldIndex:e,newIndex:t}){if(e===t)return;const s=bt(this.state.list);s.splice(t,0,s.splice(e,1)[0]),this.$store.commit("setStatus","saving");try{await this.$store.dispatch("updateList",s),this.$store.commit("setStatus","success")}catch(e){if(this.$store.commit("setStatus","error"),"NetworkError"!==e.name)throw e;toast.error(e.message)}}.bind(this),this.showAddMethod=function(){!function(e){Zs.create({overlay:!0,shadow:!0,handle:!1,width:500,riotTag:"shipping-method-type-modal",props:{...e}})}({onSelect:e=>{!function(e,t){Zs.create({overlay:!0,shadow:!0,handle:!1,title:tr("admin::settings::ecommerce::shipping::add_modal_title"),width:400,...t,riotTag:"shipping-method-edit-modal",props:{mode:"add",...e}})}({data:e,onSave:this.addMethod},{animate:!1})}})}.bind(this),this.addMethod=async function(e){e.id=Ge(5,{suffix:Date.now()}),await this.$store.dispatch("createMethod",e)}.bind(this)})),riot3.tag2("settings-block-promo",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text"> {tr(\'admin::settings::ecommerce::promocode::title\')} </span> <span data-is="admin-save-text" class="flexbe-desc" status="{state.status}"></span> </div> <div class="flexbe-white-box shadow is-card" if="{!tag.state.list.length}"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{meta.sprite}#empty_promocodes"></use> </svg> <div class="flexbe-text my20"> {tr(\'admin::settings::ecommerce::promocode::empty_list_text\')} </div> <div class="flexbe-button filled rounded large is-primary" onclick="{promocodeAddingModal}"> <span class="flexbe-text">{tr(\'admin::settings::ecommerce::promo::add_promocode_button\')}</span> </div> </div> <div if="{tag.state.list.length}" class="flexbe-white-box shadow collection"> <div class="collection-item collection-header font-ui"> <div class="row gap-50"> <div class="col col-3"> {tr(\'admin::settings::ecommerce::promo::edit::promocode::label\')} </div> <div class="col col-3"> {tr(\'admin::settings::ecommerce::promo::edit::amount::title\')} </div> <div class="col col-6"> {tr(\'admin::settings::ecommerce::promo::status::title\')} </div> </div> </div> <div data-is="element-promocode-item" each="{promocode in tag.state.list}" class="collection-item" key="id" promocode="{promocode}"></div> <div class="collection-item shade"> <div class="flexbe-button small is-primary filled {\'promotion-limit-exceeded\': state.limitExceeded}" onclick="{promocodeAddingModal}" data-tip="{meta.buttonTipContent}"> <span class="flexbe-text"> {tr(\'admin::settings::ecommerce::promo::add_promocode_button\')} </span> </div> </div> </div>',"",'class="settings-block-promo {opts.class}"',(function(e){const t=this;this.state={get status(){return t.$state.status??"saved"},get list(){return t.$store.getters.promoCodesList},get promotionsLimit(){return t.$store.getters.promotionsLimit},get limitExceeded(){return t.$store.getters.limitExceeded}},this.meta={sprite:at("settings.ecommerce","admin"),get buttonTipContent(){return t.state.limitExceeded?tr("admin::settings::ecommerce::promo::limit_exceeded_messege",{count:t.state.promotionsLimit}):null}},this.promocodeAddingModal=function(){this.state.limitExceeded||function(e,t){Zs.create({animate:!0,overlay:!0,shadow:!0,handle:!1,title:tr("admin::settings::ecommerce::promo::edit::promocode_title"),width:500,...t,riotTag:"promocode-edit-modal",props:{mode:"add",...e}})}({onSave:this.addPromocode})}.bind(this),this.addPromocode=async function(e){await this.$store.dispatch("createPromotion",e)}.bind(this),this.onMounted=function(){flexbe.tip.initArea(this.root)}.bind(this),this.onUpdated=function(){flexbe.tip.initArea(this.root)}.bind(this)})),riot3.tag2("settings-block-discount",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text"> {tr(\'admin::settings::ecommerce::discounts::title\')} </span> <span data-is="admin-save-text" class="flexbe-desc" status="{state.status}"></span> </div> <div class="flexbe-white-box shadow is-card" if="{!tag.state.list.length}"> <svg class="flexbe-icon size-28"> <use riot-xlink:href="{meta.sprite}#empty_discounts"></use> </svg> <div class="flexbe-text my20"> {tr(\'admin::settings::ecommerce::discounts::empty_list_text\')} </div> <div class="flexbe-button filled rounded large is-primary" onclick="{discountAddingModal}"> <span class="flexbe-text">{tr(\'admin::settings::ecommerce::promo::add_discount_button\')}</span> </div> </div> <div if="{tag.state.list.length}" class="flexbe-white-box shadow collection"> <div class="collection-item collection-header font-ui"> <div class="row gap-50"> <div class="col col-3"> {tr(\'admin::settings::ecommerce::promo::edit::active_from::title\')} </div> <div class="col col-3"> {tr(\'admin::settings::ecommerce::promo::edit::amount::title\')} </div> <div class="col col-6"> {tr(\'admin::settings::ecommerce::promo::status::title\')} </div> </div> </div> <div data-is="element-discount-item" each="{discount in tag.state.list}" class="collection-item" key="id" discount="{discount}"></div> <div class="collection-item shade"> <div class="flexbe-button small is-primary filled {\'promotion-limit-exceeded\': state.limitExceeded}" onclick="{discountAddingModal}" data-tip="{meta.buttonTipContent}"> <span class="flexbe-text"> {tr(\'admin::settings::ecommerce::promo::add_discount_button\')} </span> </div> </div> </div>',"",'class="settings-block-discount {opts.class}"',(function(e){const t=this;this.state={get status(){return t.$state.status??"saved"},get list(){return t.$store.getters.discountsList},get promotionsLimit(){return t.$store.getters.promotionsLimit},get limitExceeded(){return t.$store.getters.limitExceeded}},this.meta={sprite:at("settings.ecommerce","admin"),get buttonTipContent(){return t.state.limitExceeded?tr("admin::settings::ecommerce::promo::limit_exceeded_messege",{count:t.state.promotionsLimit}):null}},this.discountAddingModal=function(){this.state.limitExceeded||function(e,t){Zs.create({animate:!0,overlay:!0,shadow:!0,handle:!1,title:tr("admin::settings::ecommerce::promo::edit::discount_title"),width:400,...t,riotTag:"discount-edit-modal",props:{mode:"add",...e}})}({onSave:this.addDiscount})}.bind(this),this.addDiscount=async function(e){await this.$store.dispatch("createPromotion",e)}.bind(this),this.onMounted=function(){flexbe.tip.initArea(this.root)}.bind(this),this.onUpdated=function(){flexbe.tip.initArea(this.root)}.bind(this)})),riot3.tag2("settings-block-cart_settings",'<div data-is="proxy" is="save-button" show-edit="{false}" show-save="{state.hasChanges}" on-save="{onSave}" on-done="{onDone}" on-error="{onError}" observer="{observer}"></div> <div class="flexbe-white-box shadow p0 pb20"> <div class="flexbe-field-group"> <div class="flexbe-text text-uppercase mb10 subtitle"> {tr(\'admin::settings::ecommerce::cart::subtitle\')} </div> <div class="flexbe-field-item"> <label data-is="flexbe-input" class="large" type="toggle" checked="{state.autoOpen}" onchange="{toggleSetting}"> <span>{tr(\'admin::settings::ecommerce::cart::auto_open_label\')}</span> </label> </div> <div class="flexbe-field-item"> <label data-is="flexbe-input" class="large" type="toggle" checked="{state.useTotal}" onchange="{toggleTotal}"> <span>{tr(\'admin::settings::ecommerce::cart::min_total_label\')}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::settings::ecommerce::cart::min_total_tip\')}"></q> </label> </div> <div class="flexbe-field-item mt15" if="{state.useTotal}"> <div class="total-input"> <div class="flexbe-desc text-s">{tr(\'admin::settings::ecommerce::cart::min_total_input_label\')} </div> <div data-is="flexbe-input" riot-value="{state.total}" replace="{/[^0-9]/gi}" min="{0}" placeholder="{meta.placeholder}" oninput="{setTotal}" type="{\'number\'}"></div> </div> </div> </div> <virtual> <div class="flexbe-field-group"> <div class="flexbe-text text-uppercase mb10 subtitle"> {tr(\'admin::settings::ecommerce::reserve::subtitle\')} </div> <div class="flexbe-field-item"> <label data-is="flexbe-input" class="large" type="toggle" checked="{state.reserveEnabled}" onchange="{toggleReserveEnable}"> <span>{tr(\'admin::settings::ecommerce::enable_reserve::title\')}</span> <q data-is="flexbe-tooltip" content="{tr(\'admin::settings::ecommerce::enable_reserve::tip\')}"></q> </label> </div> <div if="{state.reserveEnabled}" class="mt20"> <div class="flexbe-text text-uppercase mb10 subtitle"> {tr(\'admin::settings::ecommerce::auto_reserve::subtitle\')} </div> <div class="flexbe-field-item"> <label each="{action in meta.autoReserveActions}" data-is="flexbe-input" type="radio" name="{action.value}" checked="{action.value === tag.state.autoReserveAction}" onclick="{setAutoReserveAction.bind(tag, action.value)}"> <span class="flexbe-text">{action.title}</span> <q data-is="flexbe-tooltip" if="{action.tip}" content="{action.tip}"></q> </label> </div> </div> </div> <div class="flexbe-field-group"> <div class="flexbe-text text-uppercase mb10 subtitle"> {tr(\'admin::settings::ecommerce::out_of_stock::subtitle\')} </div> <div class="flexbe-field-item"> <label each="{action in meta.outOfStockActions}" data-is="flexbe-input" type="radio" name="{action.value}" checked="{action.value === tag.state.outOfStockAction}" onclick="{setOutOfStockAction.bind(tag, action.value)}"> <span class="flexbe-text">{action.title}</span> </label> </div> </div> <div class="flexbe-field-group"> <div class="flexbe-text text-uppercase mb10 subtitle"> {tr(\'admin::settings::ecommerce::statuses::subtitle\')} </div> <div class="flexbe-field-item"> <div class="flexbe-text text-sm text-shade-60 mb5"> {tr(\'admin::settings::ecommerce::statuses::in_stock::title\')} </div> <div data-is="flexbe-select" riot-value="{state.inStockStatus}" list="{meta.inStockStatuses}" onchange="{setInStockStatus}"></div> </div> <div class="flexbe-field-item" if="{state.outOfStockAction !== \'hide\'}"> <div class="flexbe-text text-sm text-shade-60 mb5"> {tr(\'admin::settings::ecommerce::statuses::out_of_stock::title\')} </div> <div data-is="flexbe-select" riot-value="{state.outOfStockStatus}" list="{meta.outOfStockStatuses}" disabled="{state.outOfStockAction === \'forbid_preorder\'}" onchange="{setOutOfStockStatus}"></div> </div> <div class="flexbe-field-item"> <div class="flexbe-text text-sm text-shade-60 mb5"> {tr(\'admin::settings::ecommerce::statuses::zero_price::title\')} </div> <div data-is="flexbe-select" riot-value="{state.zeroPrice}" list="{meta.zeroPrices}" onchange="{setZeroPrice}"></div> </div> </div> </virtual> </div>',"",'class="settings-block-cart_settings {opts.class}"',(function(e){this.mixin("initMobx");const t=this;this.getCookie=function(e){const t=document.cookie.match(new RegExp(`(?:^|; )${e.replace(/([$()*+./?[\\\]^{|}])/g,"\\$1")}=([^;]*)`));return t?decodeURIComponent(t[1]):void 0}.bind(this),this.observer=At({}),this.state={_lastValue:null,get ecommerceAndDelivery(){return bt(t.$state)??{}},get commonSettings(){const e=bt(t.$state)??{};return delete e.delivery,e.cart||(e.cart={}),e.reserve||(e.reserve={}),e},get cartSettings(){const e=this.commonSettings.cart;return delete e.allow_order_out_of_stock,delete e.auto_reserve,delete e.auto_reserve_action,delete e.cart,delete e.consider_quantity,delete e.in_stock_status,delete e.inventory_enabled,delete e.out_of_stock_action,delete e.out_of_stock_status,delete e.reserve,delete e.reserve_enabled,delete e.show_available_state,delete e.show_changed_price_notifications,e},get reserveSettings(){return this.commonSettings.reserve},get hasChanges(){return JSON.stringify(this._lastValue)!==JSON.stringify(this.commonSettings)},get autoOpen(){return null==this._lastValue.cart.auto_open?this.cartSettings.auto_open??0:this._lastValue.cart.auto_open},get total(){return this._lastValue.cart.total},get useTotal(){return null==this._lastValue.cart.use_total?this.cartSettings.use_total??0:this._lastValue.cart.use_total},get reserveEnabled(){return null==this._lastValue.reserve.enabled?this.reserveSettings.enabled??1:this._lastValue.reserve.enabled},get autoReserveAction(){return null==this._lastValue.reserve.auto_action?this.reserveSettings.auto_action??"on_create":this._lastValue.reserve.auto_action},get outOfStockAction(){return null==this._lastValue.out_of_stock_action?this.commonSettings.out_of_stock_action??"forbid_preorder":this._lastValue.out_of_stock_action},get inStockStatus(){return null==this._lastValue.in_stock_status?this.commonSettings?.in_stock_status??"in_stock":this._lastValue.in_stock_status},get outOfStockStatus(){return null==this._lastValue.out_of_stock_status?this.commonSettings?.out_of_stock_status??"out_of_stock":this._lastValue.out_of_stock_status},get zeroPrice(){return null==this._lastValue.zero_price?this.commonSettings?.zero_price??"free":this._lastValue.zero_price}},this.meta={currencyCode:flexbe.vars.group.currency.code,deliveryCurrency:{RUB:300,BYN:10,KZT:2e3,UAH:100,USD:10,EUR:10,GBP:10,CAD:15,AUD:15,PLN:40},get placeholder(){return`${mt(this.deliveryCurrency[this.currencyCode])}`.toLowerCase()},get autoReserveActions(){return[{value:"never",title:tr("admin::settings::ecommerce::auto_reserve::actions::never")},{value:"on_create",title:tr("admin::settings::ecommerce::auto_reserve::actions::on_create"),tip:tr("admin::settings::ecommerce::auto_reserve::actions::on_create_tip")},{value:"on_done",title:tr("admin::settings::ecommerce::auto_reserve::actions::on_done"),tip:tr("admin::settings::ecommerce::auto_reserve::actions::on_done_tip")}]},get outOfStockActions(){return[{value:"allow_preorder",title:tr("admin::settings::ecommerce::out_of_stock::actions::allow_preorder")},{value:"forbid_preorder",title:tr("admin::settings::ecommerce::out_of_stock::actions::forbid_preorder")},{value:"hide",title:tr("admin::settings::ecommerce::out_of_stock::actions::hide")}]},get inStockStatuses(){return[{value:"none",title:tr("admin::settings::ecommerce::statuses::in_stock::none")},{value:"in_stock",title:tr("admin::settings::ecommerce::statuses::in_stock::in_stock")},{value:"items_in_stock",title:tr("admin::settings::ecommerce::statuses::in_stock::items_in_stock")}]},get outOfStockStatuses(){return"allow_preorder"===t.state.outOfStockAction?"none"===t.state.inStockStatus?[{value:"none",title:tr("admin::settings::ecommerce::statuses::out_of_stock::none")},{value:"preorder",title:tr("admin::settings::ecommerce::statuses::out_of_stock::preorder")}]:[{value:"in_stock",title:tr("admin::settings::ecommerce::statuses::out_of_stock::in_stock")},{value:"preorder",title:tr("admin::settings::ecommerce::statuses::out_of_stock::preorder")}]:[{value:"out_of_stock",title:tr("admin::settings::ecommerce::statuses::out_of_stock::out_of_stock")}]},get zeroPrices(){return[{value:"free",title:tr("admin::settings::ecommerce::statuses::zero_price::free")},{value:"zero",title:tr("admin::settings::ecommerce::statuses::zero_price::zero")}]}},this.setTotal=function(e){this.state._lastValue.cart.total=+String(e.target.value).replace(",",".")}.bind(this),this.toggleTotal=function(e){this.state._lastValue.cart.use_total=e.target.checked?1:0}.bind(this),this.toggleSetting=function(e){this.state._lastValue.cart.auto_open=e.target.checked?1:0}.bind(this),this.toggleReserveEnable=function(e){this.state._lastValue.reserve.enabled=e.target.checked?1:0}.bind(this),this.setAutoReserveAction=function(e){this.state._lastValue.reserve.auto_action=e,this.update()}.bind(this),this.setOutOfStockAction=function(e){this.state._lastValue.out_of_stock_action=e,this.setOutOfStockStatus(this.meta.outOfStockStatuses[0])}.bind(this),this.setInStockStatus=function(e){this.state._lastValue.in_stock_status=e.value,this.update()}.bind(this),this.setOutOfStockStatus=function(e){this.state._lastValue.out_of_stock_status=e.value,this.update()}.bind(this),this.setZeroPrice=function(e){this.state._lastValue.zero_price=e.value,this.update()}.bind(this),this.setLastValue=function(){this.state._lastValue=bt(this.state.commonSettings),delete this.state._lastValue.delivery}.bind(this),this.onSave=async function(){this.update(),this.state._lastValue.use_total&&!+this.state._lastValue.total&&(this.state._lastValue.use_total=0),this.state._lastValue.zero_price||(this.state._lastValue.zero_price="free");try{const e=await this.$store.dispatch("updateEcommerceStoreSettings",{...this.state.ecommerceAndDelivery,...this.state._lastValue});return this.setLastValue(),e}catch(e){return e}}.bind(this),this.onDone=function(){this.update()}.bind(this),this.onError=function(e){e.message?toast.error(e.message):console.error(e)}.bind(this),this.onBeforeMount=function(){this.setLastValue()}.bind(this)})),riot3.tag2("element-discount-item",'<div class="row align-items-center element-promotion-item__row"> <div class="col col-3"> <span class="flexbe-text"> {tr(\'admin::settings::ecommerce::shipping::min_total_label\', { min_total: state.activeFrom })} </span> </div> <div class="col col-3 gap-40"> <span class="flexbe-text"> {state.discountAmount} </span> </div> <span class="flexbe-text colored-status {state.status}"> {meta.statusText} </span> <div class="item-controls"> <div class="flexbe-action-buttons"> <div class="action-button" data-is="flexbe-tooltip" content="{tr(\'admin::settings::ecommerce::promo::edit_button\')}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.meta.spriteSettings}#settings"></use></svg> </div> <div class="action-button" data-is="flexbe-tooltip" content="{tr(\'admin::settings::ecommerce::promo::remove_button\')}" onclick="{removeDiscount}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.meta.spriteSettings}#remove"></use></svg> </div> </div> </div> </div>',"","class=\"element-discount-item {opts.class} {'disabled': (state.status === 'disabled')}\" onclick=\"{editDiscount}\"",(function(e){this.mixin("initMobx");const t=this,s=e=>{const t=new Date(e),s=t.getHours(),i=t.getMinutes();return 0===s&&0===i?this.meta.dateFormat:`${this.meta.dateFormat} h:i`};this.state={get discount(){return t.props.discount},get discountAmount(){switch(this.discount.discount_type){case"money":return mt(this.discount.discount_amount);case"percent":return+this.discount.discount_amount+" %";default:return null}},get activeFrom(){return mt(this.discount.active_from)},get status(){return t.$store.helpers.getStatus(this.discount)}},this.meta={spriteSettings:at("settings","admin"),spriteEcommerce:at("settings.ecommerce","admin"),currencySymbol:flexbe.vars.group.currency.symbol,dateFormat:flexbe.vars.user.date_format?.date??"d.m.y",get statusText(){const e=t.state.discount.date_from,i=t.state.discount.date_to;switch(t.state.status){case"disabled":return tr("admin::settings::ecommerce::promo::status::discount_disabled");case"expired":return tr("admin::settings::ecommerce::promo::status::expired::text");case"planed":return tr("admin::settings::ecommerce::promo::status::planed",{date:Xe(e,s(e))});case"active":return t.state.discount.date_to?tr("admin::settings::ecommerce::promo::status::active::discount_date",{date:Xe(i,s(i))}):tr("admin::settings::ecommerce::promo::status::active::discount_text")}}},this.editDiscount=function(e){e.stopPropagation(),function(e,t){Zs.create({animate:!0,overlay:!0,shadow:!0,handle:!1,title:tr("admin::settings::ecommerce::promo::edit::discount_title"),width:400,...t,riotTag:"discount-edit-modal",props:{mode:"edit",...e}})}({data:h(this.state.discount),onSave:async e=>{await this.$store.dispatch("updatePromotion",e.id,e)}})}.bind(this),this.removeDiscount=function(e){e.stopPropagation(),As({props:{icon:`${this.meta.spriteEcommerce}#remove_modal`,title:tr("admin::settings::ecommerce::promo::discount::remove_confirm_title",{amount:this.state.discountAmount}),confirmButtonClass:"is-danger bordered colored",confirmButtonText:tr("main::button::delete"),cancelButton:!0,onConfirm:async()=>{await this.$store.dispatch("removePromotion",this.state.discount.id),toast.success(tr("admin::settings::ecommerce::promo::discount::remove_notice"))},onError:e=>{if("NetworkError"!==e.name)throw e;toast.error(e.message)}},clickOut:!0})}.bind(this)})),riot3.tag2("element-promocode-item",'<div class="row align-items-center element-promotion-item__row"> <div class="col col-3 promocode-value"> <span class="flexbe-text" onclick="{eventStopPropogation}"> {meta.codeDisplayValue} </span> </div> <div class="promocode-amount col col-3 gap-40"> <div class="flexbe-text" if="{state.promocodeAmount}"> {state.promocodeAmount} </div> <div each="{infoIcon in meta.infoIcons}" class="info-icon {\'has-plus\': !infoIcon.hidePlus} {infoIcon.class ?? \'\'}"> <svg class="flexbe-icon size-18" data-tip="{infoIcon.tip}" data-width="{infoIcon.tipWidth || 330}"> <use riot-xlink:href="{infoIcon.sprite || meta.spriteEcommerce}#{infoIcon.icon}"></use> </svg> </div> </div> <span class="flexbe-text colored-status {state.status}"> {meta.statusText} </span> <div class="item-controls"> <div class="flexbe-action-buttons"> <div class="action-button" data-is="flexbe-tooltip" content="{tr(\'admin::settings::ecommerce::promo::edit_button\')}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.meta.spriteSettings}#settings"></use></svg> </div> <div class="action-button" data-is="flexbe-tooltip" content="{tr(\'admin::settings::ecommerce::promo::remove_button\')}" onclick="{removePromocode}"> <svg class="flexbe-icon size-16"><use riot-xlink:href="{tag.meta.spriteSettings}#remove"></use></svg> </div> </div> </div> </div>',"","class=\"element-promocode-item {opts.class} {'disabled': (state.status === 'disabled')}\" onclick=\"{editPromocode}\"",(function(e){this.mixin("initMobx");const t=this,s=e=>{const t=new Date(e),s=t.getHours(),i=t.getMinutes();return 0===s&&0===i?this.meta.dateFormat:`${this.meta.dateFormat} h:i`};this.state={get promocode(){return t.props.promocode},get availableCount(){return this.promocode.available_count},get isDeliveryPromocode(){return"delivery"===this.promocode.discount_type},get usageWithAnyDiscount(){return this.promocode.usage_with_any_discount},get deliveryFree(){return this.isDeliveryPromocode||this.promocode.delivery_free},get promocodeAmount(){switch(this.promocode.discount_type){case"money":return mt(this.promocode.discount_amount);case"percent":return+this.promocode.discount_amount+" %";default:return null}},get status(){return t.$store.helpers.getStatus(this.promocode)}},this.meta={spriteSettings:at("settings","admin"),spriteEcommerce:at("settings.ecommerce","admin"),currencySymbol:flexbe.vars.group.currency.symbol,dateFormat:flexbe.vars.user.date_format?.date??"d.m.y",get infoIcons(){const e=[];return t.state.deliveryFree&&e.push({icon:"delivery",tip:tr("admin::settings::ecommerce::promo::edit::type_delivery::title"),hidePlus:!!t.state.isDeliveryPromocode}),t.state.usageWithAnyDiscount&&e.push({class:"discount-icon",icon:"percent",tip:tr("admin::settings::ecommerce::promo::usage_with_disocunts_tip"),tipWidth:400,hidePlus:!0}),e},get codeDisplayValue(){const e=t.state.promocode.code??"",s=e.slice(0,16);return`${s}${s.length<e.length?"...":""}`},get statusText(){const e=t.state.availableCount,i=t.state.promocode.date_from,a=t.state.promocode.date_to,n="number"==typeof e&&e<=0,r="number"==typeof e&&e>0;switch(t.state.status){case"disabled":return tr("admin::settings::ecommerce::promo::status::promocode_disabled");case"expired":return n?tr("admin::settings::ecommerce::promo::status::expired::number"):tr("admin::settings::ecommerce::promo::status::expired::text");case"planed":return tr("admin::settings::ecommerce::promo::status::planed",{date:Xe(i,s(i))});case"active":return r&&a?tr("admin::settings::ecommerce::promo::status::active::promocode_number_date",{number:e,date:Xe(a,s(a))}):r?tr("admin::settings::ecommerce::promo::status::active::number",{number:e}):a?tr("admin::settings::ecommerce::promo::status::active::promocode_date",{date:Xe(a,s(a))}):tr("admin::settings::ecommerce::promo::status::active::promocode_text")}}},this.editPromocode=function(e){e.stopPropagation(),function(e,t){Zs.create({animate:!0,overlay:!0,shadow:!0,handle:!1,title:tr("admin::settings::ecommerce::promo::edit::promocode_title"),width:500,...t,riotTag:"promocode-edit-modal",props:{mode:"edit",...e}})}({data:h(this.state.promocode),onSave:async e=>{await this.$store.dispatch("updatePromotion",e.id,e)}})}.bind(this),this.removePromocode=function(e){e.stopPropagation(),As({props:{icon:`${this.meta.spriteEcommerce}#remove_modal`,title:tr("admin::settings::ecommerce::promo::promocode::remove_confirm_title",{name:this.state.promocode.code}),confirmButtonClass:"is-danger bordered colored",confirmButtonText:tr("main::button::delete"),cancelButton:!0,onConfirm:async()=>{await this.$store.dispatch("removePromotion",this.state.promocode.id),toast.success(tr("admin::settings::ecommerce::promo::promocode::remove_notice"))},onError:e=>{if("NetworkError"!==e.name)throw e;toast.error(e.message)}},clickOut:!0})}.bind(this),this.onMounted=function(){flexbe.tip.initArea(this.root)}.bind(this),this.onUpdated=function(){flexbe.tip.initArea(this.root)}.bind(this),this.eventStopPropogation=function(e){e.stopPropagation()}.bind(this)})),riot3.tag2("settings-section-optimization",'<div class="group-list slide-down-animation"> <div data-is="settings-block-image" class="group-content"></div> <div data-is="settings-block-optimization" class="group-content"></div> </div>',"",'class="settings-section-optimization pb60 {opts.class}"',(function(e){})),riot3.tag2("settings-block-image",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text"> {tr(\'admin::settings::image::title\')} </span> <span data-is="admin-save-text" class="flexbe-desc" status="{state.status}"> </span> </div> <div class="flexbe-white-box shadow collection"> <div class="lazy-mode collection-item block"> <div class="lazy-mode__item"> <label data-is="flexbe-input" class="large" type="toggle" checked="{state.lazyEnabled}" onchange="{toggleValue.bind(this, \'lazy\')}"> <span> {tr(\'admin::settings::image::loading::lazy_toggle\')} </span> <div data-is="flexbe-tooltip" class="fade-in-animation block-image error-tooltip" if="{!tag.state.lazyEnabled}" content="{tr(\'admin::settings::image::loading::lazy_low_speed_tip\')}"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{tag.meta.sprite}#error"></use> </svg> </div> </label> <p class="flexbe-desc" data-is="raw" content="{tr(\'admin::settings::image::loading::lazy_desc\')}"> </p> </div> <div class="lazy-mode__item priority fade-in-animation" if="{state.lazyEnabled}"> <label data-is="flexbe-input" class="large" type="toggle" checked="{state.lazyPriorityEnabled}" onchange="{toggleValue.bind(this, \'lazy_priority\')}"> <span> {tr(\'admin::settings::image::loading::lazy_priority_toggle\')} </span> </label> <p class="flexbe-desc" data-is="raw" content="{tr(\'admin::settings::image::loading::lazy_priority_desc\')}"> </p> </div> </div> <div class="placeholder collection-item block fade-in-animation" if="{state.lazyEnabled}"> <span class="collection-item__title"> {tr(\'admin::settings::image::placeholder::title\')} </span> <div class="media-select font-ui"> <div each="{effect in meta.lazyEffects}" key="{effect.value}" class="media-select__item {check: state.loadingEffect === effect.value}" onmouseenter="{togglePlay}" onmouseleave="{togglePlay}" onclick="{selectLoadingEffect}"> <div class="media-select__preview {played: effect.played}"> <img class="poster" riot-src="{effect.poster}" alt="poster"> <video class="video" if="{effect.played}" autoplay="autoplay" muted="muted" pip="false" disablepictureinpicture disableremoteplayback> <source riot-src="{effect.video}" type="video/mp4"> </video> </div> <div class="media-select__text-wrap"> <svg class="flexbe-icon size-16 media-select__svg"> <use riot-xlink:href="{meta.sprite}1#icon-check"></use> </svg> <span class="flexbe-text text-note font-ui media-select__text"> {effect.description} </span> <q data-is="flexbe-tooltip" if="{effect.tip}" content="{effect.tip}"></q> </div> </div> </div> </div> <div class="quality collection-item block"> <span class="collection-item__title"> {tr(\'admin::settings::image::quality::title\')} <div data-is="flexbe-tooltip" class="fade-in-animation block-image error-tooltip" if="{tag.state.imageQuality === \'ultra\'}" content="{tr(\'admin::settings::image::quality::low_speed_tip\')}"> <svg class="flexbe-icon size-14"><use riot-xlink:href="{tag.meta.sprite}#error"></use></svg> </div> </span> <div data-is="flexbe-buttons-line" class="is-group" role="radio" list="{meta.qualityImages}" riot-value="{state.imageQuality}" onchange="{selectImageQuality}"></div> <p class="flexbe-desc quality__desc" data-is="raw" content="{tr(\'admin::settings::image::quality::desc\')}"> </p> <virtual if="{state.lazyEnabled}"> <label data-is="flexbe-input" class="large quality__slow-net" type="toggle" checked="{state.slowNetwork}" onchange="{toggleValue.bind(this, \'slow_network\')}"> <span> {tr(\'admin::settings::image::quality::network_toggle\')} </span> </label> <p class="flexbe-desc quality__slow-desc" data-is="raw" content="{tr(\'admin::settings::image::quality::network_desc\')}"> </p> </virtual> <div class="image-size"> <span class="image-size__value"> {getImageSize(\'jpg\')} </span> <q data-is="flexbe-tooltip" content="{tag.getImageCompression(\'jpg\')}"></q> </div> </div> <div class="conversion collection-item block"> <span class="collection-item__title"> {tr(\'admin::settings::image::conversion::title\')} <div data-is="flexbe-tooltip" class="fade-in-animation block-image error-tooltip" if="{!tag.state.webpEnabled || !tag.state.avifEnabled}" content="{tr(\'admin::settings::image::conversion::low_speed_tip\')}"> <svg class="flexbe-icon size-14"><use riot-xlink:href="{tag.meta.sprite}#error"></use></svg> </div> </span> <div class="conversion__item"> <label data-is="flexbe-input" class="large" type="toggle" checked="{state.webpEnabled}" onchange="{toggleValue.bind(this, \'webp\')}"> <span> {tr(\'admin::settings::image::conversion::extension_toggle\', { extension: WEBP })} </span> </label> <q data-is="flexbe-tooltip" content="{tr(\'admin::settings::image::conversion::webp_tip\')}"></q> <span class="conversion__speed"> {getConversionSpeed(\'webp\')} </span> <div class="image-size"> <span class="image-size__value"> {getImageSize(\'webp\')} </span> <q data-is="flexbe-tooltip" content="{tag.getImageCompression(\'webp\')}"></q> </div> </div> <div class="conversion__item"> <label data-is="flexbe-input" class="large" type="toggle" checked="{state.avifEnabled}" onchange="{toggleValue.bind(this, \'avif\')}"> <span> {tr(\'admin::settings::image::conversion::extension_toggle\', { extension: \'AVIF\' })} </span> </label> <q data-is="flexbe-tooltip" content="{tr(\'admin::settings::image::conversion::avif_tip\')}"></q> <span class="conversion__speed"> {getConversionSpeed(\'avif\')} </span> <div class="image-size"> <span class="image-size__value"> {getImageSize(\'avif\')} </span> <q data-is="flexbe-tooltip" content="{tag.getImageCompression(\'avif\')}"></q> </div> </div> </div> <div class="collection-footer collection-item shade"> <div data-is="raw" class="flexbe-desc" content="{tr(\'admin::settings::image::desc\')}"></div> </div> </div>',"",'class="settings-block-image {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={status:"saved",get data(){return t.$state.images},get lazyEnabled(){return this.data.lazy},get lazyPriorityEnabled(){return this.data.lazy_priority},get loadingEffect(){return this.data.effect},get imageQuality(){return this.data.quality},get slowNetwork(){return this.data.slow_network},get webpEnabled(){return this.data.webp},get avifEnabled(){return this.data.avif}},this.meta={sprite:at("settings","admin"),lazyEffects:[{poster:"/_s/images/admin/settings/general/image/lazy-none.png",video:"/_s/images/admin/settings/general/image/lazy-none-video.mp4",description:tr("admin::settings::image::placeholder::effect_none_label"),value:"none"},{poster:"/_s/images/admin/settings/general/image/lazy-color.png",video:"/_s/images/admin/settings/general/image/lazy-color-video.mp4",description:tr("admin::settings::image::placeholder::effect_color_label"),value:"color",tip:tr("admin::settings::image::placeholder::effect_color_tip")},{poster:"/_s/images/admin/settings/general/image/lazy-blur.png",video:"/_s/images/admin/settings/general/image/lazy-blur-video.mp4",description:tr("admin::settings::image::placeholder::effect_blur_label"),value:"blur",tip:tr("admin::settings::image::placeholder::effect_blur_tip")}],qualityImages:[{title:tr("admin::settings::image::quality::low_button"),value:"low"},{title:tr("admin::settings::image::quality::medium_button"),value:"medium"},{title:tr("admin::settings::image::quality::high_button"),value:"high"},{title:tr("admin::settings::image::quality::highest_button"),value:"highest"},{title:tr("admin::settings::image::quality::ultra_button"),value:"ultra"}],extension:{jpg:"JPEG",webp:"WEBP",avif:"AVIF"},imageConfig:{low:{compression:{jpg:50,webp:50,avif:45},size:{jpg:118,webp:90,avif:58},percent:{webp:24,avif:51}},medium:{compression:{jpg:60,webp:60,avif:50},size:{jpg:137,webp:102,avif:69},percent:{webp:25,avif:50}},high:{compression:{jpg:70,webp:70,avif:55},size:{jpg:165,webp:116,avif:88},percent:{webp:30,avif:47}},highest:{compression:{jpg:80,webp:80,avif:65},size:{jpg:221,webp:152,avif:123},percent:{webp:31,avif:44}},ultra:{compression:{jpg:90,webp:90,avif:75},size:{jpg:340,webp:286,avif:162},percent:{webp:16,avif:53}}}},this.togglePlay=function(e){e.item.effect.played="mouseenter"===e.type,this.update()}.bind(this),this.getConversionSpeed=function(e){const t=this.meta.imageConfig[this.state.imageQuality].percent[e];return tr("admin::settings::image::conversion::extension_speed_desc",{percent:t})}.bind(this),this.getImageSize=function(e){const t=this.meta.imageConfig[this.state.imageQuality].size[e];return`${e=this.meta.extension[e]} ~ ${t} kb`}.bind(this),this.getImageCompression=function(e){const t=this.meta.imageConfig[this.state.imageQuality].compression[e];return e=this.meta.extension[e],tr("admin::settings::image::conversion::extension_tip",{value:`${e} ${t}`})}.bind(this),this.toggleValue=async function(e,t){let s=t.target.checked;s=s?1:0;const i={};i[e]=s,this.state.status="saving",this.update(),await this.setImageOptions(i)}.bind(this),this.selectLoadingEffect=async function(e){const t=e.item.effect.value;this.state.status="saving",this.update(),await this.setImageOptions({effect:t})}.bind(this),this.selectImageQuality=async function(e){const t=e.value;this.state.status="saving",this.update(),await this.setImageOptions({quality:t})}.bind(this),this.setImageOptions=async function(e){try{await this.$store.dispatch("setImageOptions",{...this.state.data,...e}),this.state.status="success",this.update()}catch(e){this.state.status="error",this.update(),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this)})),riot3.tag2("settings-block-optimization",'<div class="flexbe-title text-subtitle inline-box"> <span class="flexbe-text"> {tr(\'admin::settings::optimization::other::title\')} </span> <span data-is="admin-save-text" class="flexbe-desc" status="{state.status}"> </span> </div> <div class="flexbe-white-box shadow collection"> <div class="optimization collection-item" if="{window.isDev || window.isDemo}"> <div class="optimization__item"> <label data-is="flexbe-input" class="large" type="toggle" checked="{state.critical_css}" onchange="{toggleValue.bind(this, \'critical_css\')}"> <span> {tr(\'admin::settings::optimization::other::critical_css::label\')} </span> </label> <p class="flexbe-desc" data-is="raw" content="{tr(\'admin::settings::optimization::other::critical_css::label_desc\')}"> </p> </div> </div> <div class="optimization collection-item block"> <span class="collection-item__title"> {tr(\'admin::settings::optimization::other::lazy_counters::title\')} </span> <div class="flexbe-field-item"> <div class="flexbe-text text-sm text-shade-60 mb5"> {tr(\'admin::settings::optimization::other::lazy_widgets::label\')} </div> <div data-is="flexbe-select" riot-value="{state.delayed_widgets_ms}" list="{getLazyDelays(1000)}" onchange="{setDelayedTime.bind(this, \'delayed_widgets_ms\')}"></div> </div> <div class="flexbe-field-item mt20"> <div class="flexbe-text text-sm text-shade-60 mb5"> {tr(\'admin::settings::optimization::other::lazy_counters::label\')} </div> <div data-is="flexbe-select" riot-value="{state.delayed_counters_ms}" list="{getLazyDelays(3000)}" onchange="{setDelayedTime.bind(this, \'delayed_counters_ms\')}"></div> </div> </div> <div class="collection-footer collection-item shade"> <div data-is="raw" class="flexbe-desc" content="{tr(\'admin::settings::optimization::other::desc\')}"></div> </div> </div>',"",'class="settings-block-optimization {opts.class}"',(function(e){const t=this;this.mixin("initMobx"),this.state={status:"saved",get data(){return t.$state.optimization},get critical_css(){return this.data.critical_css},get delayed_widgets_ms(){return this.data.delayed_widgets_ms},get delayed_counters_ms(){return this.data.delayed_counters_ms}},this.getLazyDelays=function(e){return[{value:0,title:tr("admin::settings::optimization::other::lazy_delayed::none")},{value:500,title:tr("admin::settings::optimization::other::lazy_delayed::second",{second:"0.5"})},{value:1e3,title:tr("admin::settings::optimization::other::lazy_delayed::second",{second:"1.0"})},{value:1500,title:tr("admin::settings::optimization::other::lazy_delayed::second",{second:"1.5"})},{value:2e3,title:tr("admin::settings::optimization::other::lazy_delayed::second",{second:"2.0"})},{value:2500,title:tr("admin::settings::optimization::other::lazy_delayed::second",{second:"2.5"})},{value:3e3,title:tr("admin::settings::optimization::other::lazy_delayed::second",{second:"3.0"})},{value:3500,title:tr("admin::settings::optimization::other::lazy_delayed::second",{second:"3.5"})},{value:4e3,title:tr("admin::settings::optimization::other::lazy_delayed::second",{second:"4.0"})}].map((t=>(t.value===e&&(t.recommend=!0),t)))}.bind(this),this.setDelayedTime=async function(e,{value:t}){const s={};s[e]=t,this.state.status="saving",this.update(),await this.setOptimizationOptions(s)}.bind(this),this.toggleValue=async function(e,t){const s=t.target.checked?1:0,i={};i[e]=s,this.state.status="saving",this.update(),await this.setOptimizationOptions(i)}.bind(this),this.setOptimizationOptions=async function(e){try{await this.$store.dispatch("setOptimizationOptions",{...this.state.data,...e}),this.state.status="success",this.update()}catch(e){this.state.status="error",this.update(),"NetworkError"===e.name?toast.error(e.message):console.error(e)}}.bind(this)}));const dc={css:null,exports:{setup(e,{provide:t}){t("store",this.$store),this.state={serviceDisabled:!flexbe.bill.isPaid||flexbe.bill.isLocked}},onMounted(){const e=this.$state,t=["sendAfterLeadCreated","sendAfterOrderCreated","sendAfterPaymentCreated"];let s;Object.keys(e).forEach((i=>{if(t.includes(i)&&null===e[i].title&&null===e[i].subjectLetter){const t=lc(i);e[i].title=t.title,e[i].subjectLetter=t.subjectLetter,s=!0}})),s&&this.$store.api.updateSettings(e)}},template:(e,t,s,i)=>e('<div class="group-list slide-down-animation"><div expr831="expr831" class="group-content flexbe-info-box"></div><div expr833="expr833" is="settings-block-notification-settings" class="group-content"></div><div expr834="expr834" is="settings-block-notification-letter" class="group-content"></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-section-notification ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.state.serviceDisabled,redundantAttribute:"expr831",selector:"[expr831]",template:e('<img class="box-icon" width="36" src="/_s/images/emoji/rolling_eyes.png"/><div expr832="expr832" is="raw" class="box-content"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::settings::notification_visitor::not_paid_message")}],redundantAttribute:"expr832",selector:"[expr832]"}])},{type:s.TAG,getComponent:i,evaluate:e=>"settings-block-notification-settings",slots:[],attributes:[],redundantAttribute:"expr833",selector:"[expr833]"},{type:s.TAG,getComponent:i,evaluate:e=>"settings-block-notification-letter",slots:[],attributes:[],redundantAttribute:"expr834",selector:"[expr834]"}]),name:"settings-section-notification"};e(dc.name,dc);const cc={css:null,exports:{setup(e,{initMobx:t,inject:s}){t(),this.$store=s("store"),this.$state=e.$store.state,this.state={get email(){var t;return null!=(t=e.$state.email)?t:""},get senderName(){var t;return null!=(t=e.$state.senderName)?t:""},get linkToImg(){return`img/${this.imageName}`},get image(){var t;return null!=(t=e.$state.image)?t:{}},get imageName(){var e;return null!=(e=this.image.name)?e:""},get uploadFilePath(){var t;return null!=(t=e.$store._uploadFilePath)?t:""},get showButtonUpload(){return $.isEmptyObject(this.image)}},this.meta={spriteSettings:at("settings","admin"),hasChanges:!1},this.watch={"meta.hasChanges":[()=>this.update()]}},setField(e,t){this.meta.hasChanges=!0,this.$store.commit("setSettings",e,t.target.value),this.update()},onUploadDone(e,t){this.$store.commit("updateImage",t),toast.success(tr("admin::settings::notification_visitor::modal_edit::settings_save"))},onUploadError(e,t){null!=t&&t.message?toast.error(t.message):console.error(t)},async onSave(){try{if(!ar(this.state.email)&&""!==this.state.email)throw new Error(tr("main::error::invalid_email"));await this.$store.dispatch("saveState"),this.meta.hasChanges=!1}catch(e){return e}},onError(e){e.message?toast.error(e.message):console.error(e)},onRemoveAttempt(){As({props:{title:tr("admin::settings::notification_visitor::settings::confirm_modal::delete_title"),text:tr("admin::settings::notification_visitor::settings::confirm_modal::delete_text"),onConfirm:()=>this.removeImage()}})},async removeImage(){try{await this.$store.api.deleteFile(),this.$store.commit("updateImage",{})}catch(e){"NetworkError"===e.name?toast.error(e.message):console.error(e)}this.update()}},template:(e,t,s,i)=>e('<div class="flexbe-title text-subtitle inline-box"><span expr835="expr835" class="flexbe-text"> </span><div expr836="expr836" is="save-button"></div></div><div class="flexbe-white-box shadow flexbe-table notification-table"><div class="tbody"><div class="tr"><div class="th"><span expr837="expr837" class="flexbe-text"> </span><q expr838="expr838" is="flexbe-tooltip" data-width="360"></q></div><div class="td"><div expr839="expr839" is="flexbe-input" class="transparent" type="text"></div></div></div><div class="tr"><div class="th"><span expr840="expr840" class="flexbe-text"> </span><q expr841="expr841" is="flexbe-tooltip" data-width="380"></q></div><div class="td"><div expr842="expr842" is="flexbe-input" class="transparent" type="text"></div></div></div><div class="tr"><div class="th"><span expr843="expr843" class="flexbe-text"> </span><q expr844="expr844" is="flexbe-tooltip" data-width="380"></q></div><div class="td notification-logo"><template expr845="expr845"></template><template expr849="expr849"></template></div></div></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-block-notification-settings ",e.props.class].join("")}]},{redundantAttribute:"expr835",selector:"[expr835]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::settings::title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"save-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"show-save",evaluate:e=>e.meta.hasChanges},{type:t.EVENT,name:"on-save",evaluate:e=>e.onSave},{type:t.EVENT,name:"on-error",evaluate:e=>e.onError}],redundantAttribute:"expr836",selector:"[expr836]"},{redundantAttribute:"expr837",selector:"[expr837]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::settings::email_answer")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::settings::notification_visitor::settings::email_answer_tip")}],redundantAttribute:"expr838",selector:"[expr838]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::settings::notification_visitor::settings::email_answer")},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.email},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.setField("email",t)}],redundantAttribute:"expr839",selector:"[expr839]"},{redundantAttribute:"expr840",selector:"[expr840]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::settings::sender_name")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::settings::notification_visitor::settings::sender_name_tip")}],redundantAttribute:"expr841",selector:"[expr841]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.tr("admin::settings::notification_visitor::settings::sender_name")},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.senderName},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.setField("senderName",t)}],redundantAttribute:"expr842",selector:"[expr842]"},{redundantAttribute:"expr843",selector:"[expr843]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::settings::logo")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::settings::notification_visitor::settings::logo_tip")}],redundantAttribute:"expr844",selector:"[expr844]"},{type:s.IF,evaluate:e=>!e.state.showButtonUpload,redundantAttribute:"expr845",selector:"[expr845]",template:e('<a expr846="expr846" class="notification-left" target="_blank"> </a><div class="flexbe-action-buttons to-right"><div expr847="expr847" class="action-button"><svg class="flexbe-icon size-16"><use expr848="expr848"/></svg></div></div>',[{redundantAttribute:"expr846",selector:"[expr846]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.state.imageName].join("")},{type:t.ATTRIBUTE,name:"href",evaluate:e=>["/",e.state.linkToImg].join("")}]},{redundantAttribute:"expr847",selector:"[expr847]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.onRemoveAttempt}]},{redundantAttribute:"expr848",selector:"[expr848]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.spriteSettings,"#remove"].join("")}]}])},{type:s.IF,evaluate:e=>e.state.showButtonUpload,redundantAttribute:"expr849",selector:"[expr849]",template:e('<div expr850="expr850" is="proxy" data-is="flexbe-button-upload" class="notification-left" file-type="image" regular-class="is-secondary" common-class="small filled"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"extensions",evaluate:e=>["jpeg","jpg","png"]},{type:t.ATTRIBUTE,name:"url",evaluate:e=>e.state.uploadFilePath},{type:t.EVENT,name:"onupload",evaluate:e=>e.onUploadDone},{type:t.EVENT,name:"onerror",evaluate:e=>e.onUploadError},{type:t.ATTRIBUTE,name:"show-icon",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"show-loader",evaluate:e=>!0}],redundantAttribute:"expr850",selector:"[expr850]"}])}]),name:"settings-block-notification-settings"};e(cc.name,cc);const pc={css:null,exports:{setup(e,{initMobx:t,inject:s}){t(),this.modal=s("modal"),this.fields=[];const i=e.$state[e.props.id]||{};this.state={errorSubjectLetter:!1,positionModalRight:"right",hasChanges:!1,letter:{active:!1,alignment:"center",alignmentLogo:"center",logoSize:200,...i},get id(){var t;return null!=(t=e.props.id)?t:""},get status(){var t;return null!=(t=e.$store.statusSaved)?t:"saved"}},this.meta={sprite:at("notification","admin/settings"),spriteButton:at("core"),listButton:[{icon:"button-justify-start",value:"start"},{icon:"button-justify-center",value:"center"}],list:oc(e.props.id)},this.watch={"state.status":[()=>this.update()],"state.errorSubjectLetter":[()=>this.update()]},this.createField=(e,t)=>{const s=vt({get value(){var t;return null!=(t=this.state.letter[e])?t:""},set value(t){this.state.letter[e]=t},afterSet:e=>{this.state.hasChanges=!0,this.modalUnsaved()}},t);return new Hl(e,s)}},createFields(){const e=this.state.letter,t=this.createField("title",{label:tr("admin::settings::notification_visitor::modal_edit::title_letter"),placeholder:tr("admin::settings::notification_visitor::modal_edit::title_letter_placeholder"),maxLength:100,get value(){return e.title},set value(t){e.title=t}}),s=this.createField("textAtBeginning",{label:tr("admin::settings::notification_visitor::modal_edit::extra_text_title"),get value(){return e.textAtBeginning},set value(t){e.textAtBeginning=t}}),i=this.createField("textAtEnd",{get value(){return e.textAtEnd},set value(t){e.textAtEnd=t}}),a=this.createField("subjectLetter",{label:tr("admin::settings::notification_visitor::modal_edit::subject_letter"),placeholder:tr("admin::settings::notification_visitor::modal_edit::theme_letter_placeholder"),get value(){return e.subjectLetter},set value(t){e.subjectLetter=t}}),n=this.createField("alignment",{label:tr("admin::settings::notification_visitor::modal_edit::alignment"),get value(){return e.alignment},set value(t){e.alignment=t}}),r=this.createField("alignmentLogo",{label:tr("admin::settings::notification_visitor::modal_edit::alignment_logo"),get value(){return e.alignmentLogo},set value(t){e.alignmentLogo=t}}),o=this.createField("logoSize",{label:tr("admin::settings::notification_visitor::modal_edit::size_logo"),get value(){return e.logoSize},set value(t){e.logoSize=t}});this.fields={title:t,textAtBeginning:s,textAtEnd:i,subjectLetter:a,alignment:n,alignmentLogo:r,logoSize:o}},async onSave(){try{if(!this.state.letter.subjectLetter||!this.state.letter.subjectLetter.trim()){const e=$(this.root).find(".flexbe-button.is-primary");return e.removeClass("shake-animation"),e[0].offsetWidth,e.addClass("shake-animation"),this.state.errorSubjectLetter=!0,void toast.error(tr("admin::settings::notification_visitor::modal_edit::required_validate"))}await this.$store.dispatch("changeNotificationItem",this.state.id,this.state.letter),toast.success(tr("admin::settings::notification_visitor::modal_edit::settings_save")),this.onClose()}catch(e){if(e.message)return void toast.error(e.message);console.error(e)}finally{setTimeout((()=>{this.state.errorSubjectLetter=!1}),3e3)}},async setValueText(e,t){this.fields[e].setValue(t),await this.updateContentLetter()},onInput(e,t){this.state.letter[e]=t.target.value,this.update(),clearTimeout(this.timer),this.timer=setTimeout((async()=>{await this.updateContentLetter()}),1e3)},async setLetterSettings(e,t){this.fields[e].setValue(t.value),await this.updateContentLetter()},async updateContentLetter(){const e=this.state.letter,t={type:this.state.id,title:e.title,textAtBeginning:e.textAtBeginning,textAtEnd:e.textAtEnd,alignment:e.alignment,alignmentLogo:e.alignmentLogo,logoSize:e.logoSize};await mc(this.$store,t,this.state.positionModalRight)},async resetSettings(){const e=this.state.id,t=lc(e)||{},s={active:!1,alignment:"center",alignmentLogo:"center",logoSize:200,subjectLetter:t.subjectLetter,textAtBeginning:"",textAtEnd:"",title:t.title};this.$store.commit("setSettings",e,s),this.setFields(Object.keys(this.fields),s),await this.updateContentLetter()},setFields(e,t){e.forEach((e=>{this.fields[e].setValue(t[e])}))},modalUnsaved(){var e;null==(e=this.modal)||e.unsaved(),this.update()},onClose(){var e;this.modalUnsaved(),null==(e=this.modal)||e.close()},async onMounted(){await this.updateContentLetter()},onBeforeMount(){this.createFields(),this._hotkeysDisposer=fs.register([{hotkeys:["cmd_s"],handlerDown:()=>this.onSave()}])},onBeforeUnmount(){this._hotkeysDisposer()}},template:(e,t,s,i)=>e('<div class="flexbe-field-group"><div class="col"><span expr1176="expr1176" class="flexbe-title"> <q expr1177="expr1177" is="flexbe-tooltip" data-width="380"></q></span><div expr1178="expr1178" is="flexbe-input-dropdown" type="input"></div></div></div><div class="flexbe-field-group"><div class="col"><span expr1179="expr1179" class="flexbe-title"> <span expr1180="expr1180" class="flexbe-desc"> </span></span><div expr1181="expr1181" is="flexbe-input-dropdown" type="input"></div></div></div><div class="flexbe-field-group"><span expr1182="expr1182" class="flexbe-title"> <span expr1183="expr1183" class="flexbe-desc"> </span></span><div expr1184="expr1184" is="flexbe-input-dropdown" type="textarea"></div></div><span expr1185="expr1185" class="flexbe-title"> <span expr1186="expr1186" class="flexbe-desc"> </span></span><div class="flexbe-field-group"><div expr1187="expr1187" is="flexbe-input-dropdown" type="textarea"></div></div><div class="row flexbe-field-group"><div class="col col-6"><div expr1188="expr1188" class="flexbe-title"> </div><div expr1189="expr1189" class="is-group button-size-line" is="flexbe-buttons-line" role="radio"></div></div></div><div class="row flexbe-field-group"><div class="col col-6"><div expr1190="expr1190" class="flexbe-title"> </div><div expr1191="expr1191" class="is-group button-size-line" is="flexbe-buttons-line" role="radio"></div></div><div class="col col-6"><div expr1192="expr1192" class="flexbe-title"> </div><div expr1193="expr1193" is="proxy" data-is="flexbe-input-range" suffix="px"></div></div></div><div class="notification-edit-button"><div expr1194="expr1194"><span expr1195="expr1195" class="flexbe-text"> </span></div><div expr1196="expr1196" class="flexbe-button is-secondary noshrink"><span expr1197="expr1197" class="flexbe-text"> </span></div><div expr1198="expr1198" class="reset"><svg class="flexbe-icon size-16"><use expr1199="expr1199"/></svg><span expr1200="expr1200" class="flexbe-text"> </span></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-modal-notification-edit flexbe-modal-content ",e.props.class].join("")}]},{redundantAttribute:"expr1176",selector:"[expr1176]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.fields.subjectLetter.label].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-tooltip",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::settings::notification_visitor::modal_edit::theme_tips")}],redundantAttribute:"expr1177",selector:"[expr1177]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input-dropdown",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.list},{type:t.ATTRIBUTE,name:"title",evaluate:e=>e.tr("admin::settings::notification_visitor::modal_edit::dropdown_title")},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.fields.subjectLetter.placeholder},{type:t.EVENT,name:"oninput",evaluate:e=>e.fields.subjectLetter.onchange},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.fields.subjectLetter.value},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.state.errorSubjectLetter},{type:t.ATTRIBUTE,name:"commit",evaluate:e=>t=>e.setValueText("subjectLetter",t)}],redundantAttribute:"expr1178",selector:"[expr1178]"},{redundantAttribute:"expr1179",selector:"[expr1179]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.fields.title.label].join("")}]},{redundantAttribute:"expr1180",selector:"[expr1180]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::notification_visitor::modal_edit::optional")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input-dropdown",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.list},{type:t.ATTRIBUTE,name:"title",evaluate:e=>e.tr("admin::settings::notification_visitor::modal_edit::dropdown_title")},{type:t.ATTRIBUTE,name:"placeholder",evaluate:e=>e.fields.title.placeholder},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.onInput("title",t)},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.fields.title.value},{type:t.ATTRIBUTE,name:"commit",evaluate:e=>t=>e.setValueText("title",t)}],redundantAttribute:"expr1181",selector:"[expr1181]"},{redundantAttribute:"expr1182",selector:"[expr1182]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::modal_edit::text_at_beginning")].join("")}]},{redundantAttribute:"expr1183",selector:"[expr1183]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::notification_visitor::modal_edit::optional")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input-dropdown",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.list},{type:t.ATTRIBUTE,name:"title",evaluate:e=>e.tr("admin::settings::notification_visitor::modal_edit::dropdown_title")},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.onInput("textAtBeginning",t)},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.fields.textAtBeginning.value},{type:t.ATTRIBUTE,name:"commit",evaluate:e=>t=>e.setValueText("textAtBeginning",t)}],redundantAttribute:"expr1184",selector:"[expr1184]"},{redundantAttribute:"expr1185",selector:"[expr1185]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::modal_edit::text_at_end")].join("")}]},{redundantAttribute:"expr1186",selector:"[expr1186]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::notification_visitor::modal_edit::optional")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input-dropdown",slots:[],attributes:[{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.list},{type:t.ATTRIBUTE,name:"title",evaluate:e=>e.tr("admin::settings::notification_visitor::modal_edit::dropdown_title")},{type:t.EVENT,name:"oninput",evaluate:e=>t=>e.onInput("textAtEnd",t)},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.fields.textAtEnd.value},{type:t.ATTRIBUTE,name:"commit",evaluate:e=>t=>e.setValueText("textAtEnd",t)}],redundantAttribute:"expr1187",selector:"[expr1187]"},{redundantAttribute:"expr1188",selector:"[expr1188]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.fields.alignment.label].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-buttons-line",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.spriteButton},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.fields.alignment.value},{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.listButton},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.setLetterSettings("alignment",t)}],redundantAttribute:"expr1189",selector:"[expr1189]"},{redundantAttribute:"expr1190",selector:"[expr1190]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.fields.alignmentLogo.label].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-buttons-line",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.spriteButton},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.fields.alignmentLogo.value},{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.listButton},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.setLetterSettings("alignmentLogo",t)}],redundantAttribute:"expr1191",selector:"[expr1191]"},{redundantAttribute:"expr1192",selector:"[expr1192]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.fields.logoSize.label].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"step",evaluate:e=>1},{type:t.ATTRIBUTE,name:"min",evaluate:e=>20},{type:t.ATTRIBUTE,name:"max",evaluate:e=>400},{type:t.ATTRIBUTE,name:"max-length",evaluate:e=>3},{type:t.ATTRIBUTE,name:"commit-on-move",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"show-tips",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.fields.logoSize.value},{type:t.ATTRIBUTE,name:"commit",evaluate:e=>t=>e.setLetterSettings("logoSize",t)}],redundantAttribute:"expr1193",selector:"[expr1193]"},{redundantAttribute:"expr1194",selector:"[expr1194]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button filled is-primary mr10 ",e.classNames({loading:"saving"===e.state.status,"shake-animation":"error"===e.state.status})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.onSave}]},{redundantAttribute:"expr1195",selector:"[expr1195]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::modal_edit::save_button")].join("")}]},{redundantAttribute:"expr1196",selector:"[expr1196]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.onClose}]},{redundantAttribute:"expr1197",selector:"[expr1197]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::modal_edit::cancel_button")].join("")}]},{redundantAttribute:"expr1198",selector:"[expr1198]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.resetSettings}]},{redundantAttribute:"expr1199",selector:"[expr1199]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#reset"].join("")}]},{redundantAttribute:"expr1200",selector:"[expr1200]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::notification_visitor::modal_edit::reset")}]}]),name:"settings-modal-notification-edit"};e(pc.name,pc);const uc={css:null,exports:{setup(e,{initMobx:t,inject:s}){t({autoUpdate:!0}),this.modal=s("modal"),this.$store=adminStore.getModule("settings/notification"),this.$state=this.$store.state,this.state={saving:!1,error:!1,email:flexbe.vars.user.mail,emailLocked:!flexbe.bill.isPaid||flexbe.bill.isLocked}},onInput(e){this.state.email=e.target.value},async sendTestNotification(){if(!ar(this.state.email))return this.state.error=!0,void toast.error(tr("main::error::invalid_email"));const e=this.props.id;this.state.saving=!0;try{await this.$store.api.sendTestNotification({type:e,email:this.state.email,title:this.$state[e].title,textAtBeginning:this.$state[e].textAtBeginning,textAtEnd:this.$state[e].textAtEnd,alignment:this.$state[e].alignment,alignmentLogo:this.$state[e].alignmentLogo,logoSize:this.$state[e].logoSize,senderName:this.$state.senderName,subjectLetter:this.$state[e].subjectLetter}),toast.success(tr("admin::settings::notification_visitor::letter::test_letter::done")),this.state.saving=!1,this.onClose()}catch(e){if(this.state.saving=!1,e.message)return void toast.error(e.message);console.error(e)}},onClose(){var e;null==(e=this.modal)||e.close()}},template:(e,t,s,i)=>e('<div class="flexbe-field-group"><div expr1201="expr1201" class="flexbe-title"> </div><div expr1202="expr1202" is="flexbe-input" class="title"></div><div expr1203="expr1203" class="flexbe-bar has-line mt10"></div></div><div expr1204="expr1204"><span expr1205="expr1205" class="flexbe-text"> </span></div><div expr1206="expr1206" class="flexbe-button is-secondary noshrink"><span expr1207="expr1207" class="flexbe-text"> </span></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-modal-notification-test flexbe-modal-content ",e.props.class].join("")}]},{redundantAttribute:"expr1201",selector:"[expr1201]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::modal_test::email")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.EVENT,name:"onenter",evaluate:e=>e.sendTestNotification},{type:t.ATTRIBUTE,name:"autofocus",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.email},{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.emailLocked},{type:t.EVENT,name:"oninput",evaluate:e=>e.onInput},{type:t.ATTRIBUTE,name:"htmlspecialchars",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"required",evaluate:e=>!0}],redundantAttribute:"expr1202",selector:"[expr1202]"},{type:s.IF,evaluate:e=>e.state.emailLocked,redundantAttribute:"expr1203",selector:"[expr1203]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::modal_test::email_tip")].join("")}]}])},{redundantAttribute:"expr1204",selector:"[expr1204]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button filled is-primary mr10 ",e.classNames({loading:e.state.saving,"shake-animation":e.state.error})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.sendTestNotification}]},{redundantAttribute:"expr1205",selector:"[expr1205]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::modal_test::send")].join("")}]},{redundantAttribute:"expr1206",selector:"[expr1206]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.onClose}]},{redundantAttribute:"expr1207",selector:"[expr1207]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::modal_edit::cancel_button")].join("")}]}]),name:"settings-modal-notification-test"};e(uc.name,uc);async function mc(e,t,s){const i=$(".inner-notification-preview-item");i.addClass(`loading-${s}`);const a=await e.api.getNotificationTemplate(t);i.html(`${a}`),i.removeClass(`loading-${s}`)}function hc(e){const t=$("body"),s="center"===e?'<div class="flexbe-modal-close"></div>':"";t.addClass("overflow"),t.append(`<div class="notification-preview-wrapper overlay-area shadow">\n                                        <div class="notification-preview-item scrollable-content ${e}">\n                                            ${s}\n                                            <div class="inner-notification-preview-item"></div>\n                                        </div>\n                              <div>`),"center"===e&&$("body").on("click keydown",(e=>{var t;const s=null!=(t=$(e.target).attr("class"))?t:"";(["flexbe-modal-close","notification-preview-wrapper"].some((e=>s.includes(e)))||"keydown"===e.type&&"Escape"===e.key)&&gc()}))}function gc(){const e=$("body");$(".notification-preview-wrapper").remove(),e.removeClass("overflow"),e.off("click keydown")}const vc={css:null,exports:{setup(e,{initMobx:t,inject:s}){t(),this.$store=s("store"),this.$state=e.$store.state,this.observer=At({}),this.state={positionModalCenter:"center",positionModalRight:"right",get item(){var t;return null!=(t=e.props.item)?t:{}},get active(){var e;return null!=(e=this.item.active)&&e},get id(){return e.props.id},get name(){return e.props.name}},this.meta={sprite:at("settings","admin"),spriteNotification:at("notification","admin/settings")}},toggleActive(){this.$store.dispatch("changeNotificationItem",this.state.id,{active:!this.state.active})},modalEditLetter(){hc(this.state.positionModalRight);const e=$(".notification-preview-item").width(),t=(window.innerWidth-e-440)/2;var s;s={title:this.state.name,limit:{top:15,left:t,right:15,bottom:15},props:{id:this.state.id},onClose:()=>{gc()}},Zs.create({animate:!0,overlay:!1,shadow:!1,position:["start","center"],closeOnEscape:!0,clickOut:!1,width:440,...s,component:"settings-modal-notification-edit"})},async modalPreviewLetter(){this.observer.trigger("closeDropdown"),hc(this.state.positionModalCenter);try{const e=this.state.id,t={type:e,title:this.$state[e].title,textAtBeginning:this.$state[e].textAtBeginning,textAtEnd:this.$state[e].textAtEnd,alignment:this.$state[e].alignment,logoSize:this.$state[e].logoSize};await mc(this.$store,t,this.state.positionModalCenter)}catch(e){if(e.message)return void toast.error(e.message);console.error(e)}},modalSendTestLetter(){return e={props:{id:this.props.id}},Zs.create({animate:!0,title:tr("admin::settings::notification_visitor::test_modal::title"),overlay:!0,shadow:!0,width:380,...e,component:"settings-modal-notification-test"});var e}},template:(e,t,s,i)=>e('<div class="notification-letter-item-toggle"><label expr851="expr851" is="flexbe-checkbox" class="large" type="toggle"></label></div><div class="item-controls"><div class="flexbe-action-buttons"><div expr853="expr853" class="action-button"><svg class="flexbe-icon size-16"><use expr854="expr854"/></svg></div><div class="action-button"><svg class="flexbe-icon size-16"><use expr855="expr855"/></svg><div expr856="expr856" is="proxy" data-is="dropdown" balloon-class="letter-item-dropdown" direction="bottom" trigger="click"></div></div></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-block-notification-letter-item ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[{id:"default",html:'<span expr852="expr852" class="flexbe-text notification-letter-item-name"> </span>',bindings:[{redundantAttribute:"expr852",selector:"[expr852]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.name}]}]}],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.active},{type:t.EVENT,name:"onchange",evaluate:e=>e.toggleActive}],redundantAttribute:"expr851",selector:"[expr851]"},{redundantAttribute:"expr853",selector:"[expr853]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.modalEditLetter}]},{redundantAttribute:"expr854",selector:"[expr854]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#settings"].join("")}]},{redundantAttribute:"expr855",selector:"[expr855]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.sprite,"#dots"].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="status-list flexbe-list borderless hoverable hoverable-background round-corners"><label expr857="expr857" class="flexbe-list-item"><svg class="flexbe-icon size-16"><use expr858="expr858"/></svg><span expr859="expr859" class="flexbe-text"> </span></label><label expr860="expr860" class="flexbe-list-item"><svg class="flexbe-icon size-16"><use expr861="expr861"/></svg><span expr862="expr862" class="flexbe-text"> </span></label></div>',bindings:[{redundantAttribute:"expr857",selector:"[expr857]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.modalPreviewLetter}]},{redundantAttribute:"expr858",selector:"[expr858]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.spriteNotification,"#preview-letter"].join("")}]},{redundantAttribute:"expr859",selector:"[expr859]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::letter::preview")].join("")}]},{redundantAttribute:"expr860",selector:"[expr860]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.modalSendTestLetter}]},{redundantAttribute:"expr861",selector:"[expr861]",expressions:[{type:t.ATTRIBUTE,name:"href",evaluate:e=>[e.meta.spriteNotification,"#test-letter"].join("")}]},{redundantAttribute:"expr862",selector:"[expr862]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::letter::test_letter::send")].join("")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"autohide",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"observer",evaluate:e=>e.observer}],redundantAttribute:"expr856",selector:"[expr856]"}]),name:"settings-block-notification-letter-item"};e(vc.name,vc);const fc={css:null,exports:{setup(e,{initMobx:t,inject:s}){t(),this.$store=s("store"),this.$state=e.$store.state,this.state={get status(){var t;return null!=(t=e.$store.statusSaved)?t:"saved"}},this.meta={get list(){return[{id:"sendAfterLeadCreated",name:tr("admin::settings::notification_visitor::letter::lead"),value:e.$state.sendAfterLeadCreated},{id:"sendAfterOrderCreated",name:tr("admin::settings::notification_visitor::letter::order"),value:e.$state.sendAfterOrderCreated},{id:"sendAfterPaymentCreated",name:tr("admin::settings::notification_visitor::letter::payment"),value:e.$state.sendAfterPaymentCreated}]}},this.watch={"state.status":[()=>this.update()]}}},template:(e,t,s,i)=>e('<div class="flexbe-title text-subtitle inline-box"><span expr863="expr863" class="flexbe-text"> </span><span expr864="expr864" is="proxy" data-is="admin-save-text" class="flexbe-desc"></span></div><div class="flexbe-white-box shadow collection"><div expr865="expr865" is="settings-block-notification-letter-item" class="collection-item"></div></div><div expr866="expr866" class="flexbe-desc mt20"> </div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-block-notification-letter ",e.props.class].join("")}]},{redundantAttribute:"expr863",selector:"[expr863]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::letter::title")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[],attributes:[{type:t.ATTRIBUTE,name:"status",evaluate:e=>e.state.status}],redundantAttribute:"expr864",selector:"[expr864]"},{type:s.EACH,getKey:null,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"settings-block-notification-letter-item",slots:[],attributes:[{type:t.ATTRIBUTE,name:"id",evaluate:e=>e.item.id},{type:t.ATTRIBUTE,name:"name",evaluate:e=>e.item.name},{type:t.ATTRIBUTE,name:"item",evaluate:e=>e.item.value}]}]),redundantAttribute:"expr865",selector:"[expr865]",itemName:"item",indexName:null,evaluate:e=>e.meta.list},{redundantAttribute:"expr866",selector:"[expr866]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::settings::notification_visitor::desc")].join("")}]}]),name:"settings-block-notification-letter"};e(fc.name,fc);const xc={css:null,exports:null,template:(e,t,s,i)=>e('<div expr867="expr867" is="settings-block-redirects"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-section-redirects group-list slide-down-animation ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"settings-block-redirects",slots:[],attributes:[],redundantAttribute:"expr867",selector:"[expr867]"}]),name:"settings-section-redirects"};e(xc.name,xc);const bc={css:null,exports:{setup(e,{initMobx:t}){t(),this.store=e.$store,this.observer=At({}),this.state={errorToPage:"",errorFromPage:"",toPageValue:e.props.item.to_page||"",fromPageValue:e.props.item.from_page||"",get item(){return e.props.item},get id(){return this.item.id},get redirectType(){return this.item.redirect_type},get saveQuery(){return this.item.save_query},get fromPage(){return this.item.from_page},get toPage(){return this.item.to_page},get disabled(){return!this.item.enabled},get hasError(){return e.store.hasError}},this.meta={sprite:at("settings","admin"),spriteSettings:at("redirects","admin/settings"),dropdownList:[{color:"rgba(71, 115, 255, 0.15)",value:301,text:tr("admin::settings::redirects::standard::type::permanent"),textColor:"rgba(71, 115, 255, 1)"},{color:"rgba(86, 177, 87, 0.15)",value:302,text:tr("admin::settings::redirects::standard::type::temporary"),textColor:"rgba(86, 177, 87, 1)"},{color:"rgba(255, 145, 34, 0.15)",value:200,text:tr("admin::settings::redirects::standard::type::transparent"),textColor:"rgba(245, 165, 34, 1)",tipContent:tr("admin::settings::redirects::standard::type::transparent_tip")}]},this.watch={"state.statusTagEl":[()=>this.update()],"state.errorToPage":[()=>this.update()],"state.errorFromPage":[()=>this.update()],"state.hasError":[()=>this.update()]}},changeStatusTag(e){const{id:t,item:s}=this.state;e!==this.state.redirectType&&(this.store.commit("updateItem",t,{...s,redirect_type:e}),this.checkEqualError(),this.checkTransparentError(this.state.toPageValue))},changeQuery(e){const{id:t,item:s}=this.state;this.store.commit("updateItem",t,{...s,save_query:e.target.checked})},changeInputValue(e,t,s=!1){const{id:i,item:a,fromPage:n,toPage:r}=this.state,o="from_page"===t,l=o?n:r,d=this.normalizeValue(e.target.value);var c;(this.state[o?"fromPageValue":"toPageValue"]=d,this.checkEqualError(),this.checkTransparentError(o?r:d),l!==d&&this.store.commit("updateItem",i,{...a,[t]:d}),s)&&(null==(c=document.activeElement)||c.blur())},async changeActiveStatus(){const{id:e,item:t,disabled:s}=this.state;this.store.commit("updateItem",e,{...t,enabled:s})},normalizeValue(e){const t=e=>e.endsWith("/")?e:`${e}/`;if(!e)return e;if(e=rr(e),ir(e,{fullLink:!0})||(e=e.startsWith("/")?e:`/${e}`),e.includes("?")){const[s,i]=e.split("?");e=`${t(s)}?${i}`}else e=t(e);return e},checkTransparentError(e){const{redirectType:t}=this.state,s=sr(e)&&200===t;this.state.errorToPage=s?tr("admin::settings::redirects::standard::error_transparent"):""},checkEqualError(){const{toPageValue:e,fromPageValue:t}=this.state;e===t&&(e||t)?(this.state.errorToPage=tr("admin::settings::redirects::standard::error_equal"),this.state.errorFromPage=tr("admin::settings::redirects::standard::error_equal")):(this.state.errorToPage="",this.state.errorFromPage="")},onInputToPage(e){const t=e.target.value;this.checkTransparentError(t),this.state.toPageValue=t,this.store.isChanged=!0},onInputFromPage(e){this.state.fromPageValue=e.target.value,this.store.isChanged=!0,this.checkTransparentError(this.state.toPageValue)},deleteRedirect(e){this.props.deleteRedirect(e)}},template:(e,t,s,i)=>e('<div class="row align-items-center w100"><div class="col draggable flexbe-button style-text"><svg expr868="expr868" is="flexbe-icon" size="14" icon="draggable"></svg></div><div class="col redirect-col-from-page"><div expr869="expr869" is="flexbe-input" placeholder="/old_page/" class="transparent"></div></div><div class="col redirect-col-to-page"><div expr870="expr870" is="flexbe-input" placeholder="/new_page/" class="transparent"></div></div><div class="col redirect-col-type"><div expr871="expr871" is="status-tag" class="medium"></div></div><div class="col redirect-col-last flexbe-button style-text"><svg expr872="expr872" is="flexbe-icon" icon="dots"></svg><div expr873="expr873" is="proxy" data-is="dropdown" min-width="280" trigger="click"></div></div></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-block-redirects-item ",e.props.class," ",e.classNames({disabled:e.state.disabled})].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr868",selector:"[expr868]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.disabled},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.fromPageValue},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.state.errorFromPage||!e.state.fromPage&&e.state.hasError},{type:t.ATTRIBUTE,name:"error-tip",evaluate:e=>e.state.errorFromPage},{type:t.EVENT,name:"oninput",evaluate:e=>e.onInputFromPage},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.changeInputValue(t,"from_page")},{type:t.EVENT,name:"onenter",evaluate:e=>t=>e.changeInputValue(t,"from_page",!0)}],redundantAttribute:"expr869",selector:"[expr869]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-input",slots:[],attributes:[{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.disabled},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.toPageValue},{type:t.ATTRIBUTE,name:"error",evaluate:e=>e.state.errorToPage||!e.state.toPageValue&&e.state.hasError},{type:t.ATTRIBUTE,name:"error-tip",evaluate:e=>e.state.errorToPage},{type:t.EVENT,name:"oninput",evaluate:e=>e.onInputToPage},{type:t.EVENT,name:"onchange",evaluate:e=>t=>e.changeInputValue(t,"to_page")},{type:t.EVENT,name:"onenter",evaluate:e=>t=>e.changeInputValue(t,"to_page",!0)}],redundantAttribute:"expr870",selector:"[expr870]"},{type:s.TAG,getComponent:i,evaluate:e=>"status-tag",slots:[],attributes:[{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>e.state.disabled},{type:t.ATTRIBUTE,name:"disabled-text",evaluate:e=>e.tr("admin::settings::redirects::standard::disabled_text")},{type:t.ATTRIBUTE,name:"value",evaluate:e=>e.state.redirectType},{type:t.ATTRIBUTE,name:"list",evaluate:e=>e.meta.dropdownList},{type:t.ATTRIBUTE,name:"action",evaluate:e=>e.changeStatusTag}],redundantAttribute:"expr871",selector:"[expr871]"},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr872",selector:"[expr872]"},{type:s.TAG,getComponent:i,evaluate:e=>"proxy",slots:[{id:"default",html:'<div class="flexbe-list borderless hoverable opacify hoverable-background py5"><label class="flexbe-list-item"><svg expr874="expr874" is="flexbe-icon" icon="off-redirects"></svg><span expr875="expr875" class="text-s ml10"> </span><label expr876="expr876" is="flexbe-checkbox" class="ml-auto" type="toggle"></label></label><label expr877="expr877" class="flexbe-list-item"><svg expr878="expr878" is="flexbe-icon" icon="params"></svg><span expr879="expr879" class="text-s ml10"> </span><label expr880="expr880" is="flexbe-checkbox" class="ml-auto" type="toggle"></label></label><div class="flexbe-hr my5"></div><label expr881="expr881" class="flexbe-list-item"><svg expr882="expr882" is="flexbe-icon" icon="remove"></svg><span expr883="expr883" class="text-s ml10"> </span></label></div>',bindings:[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.spriteSettings}],redundantAttribute:"expr874",selector:"[expr874]"},{redundantAttribute:"expr875",selector:"[expr875]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::redirects::standard::disabled")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.disabled},{type:t.EVENT,name:"onchange",evaluate:e=>e.changeActiveStatus}],redundantAttribute:"expr876",selector:"[expr876]"},{redundantAttribute:"expr877",selector:"[expr877]",expressions:[{type:t.ATTRIBUTE,name:"disabled",evaluate:e=>200===e.state.redirectType}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr878",selector:"[expr878]"},{redundantAttribute:"expr879",selector:"[expr879]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::redirects::standard::save_query")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-checkbox",slots:[],attributes:[{type:t.ATTRIBUTE,name:"checked",evaluate:e=>e.state.saveQuery},{type:t.EVENT,name:"onchange",evaluate:e=>e.changeQuery}],redundantAttribute:"expr880",selector:"[expr880]"},{redundantAttribute:"expr881",selector:"[expr881]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.deleteRedirect(e.state.id)}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite}],redundantAttribute:"expr882",selector:"[expr882]"},{redundantAttribute:"expr883",selector:"[expr883]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::redirects::standard::remove")}]}]}],attributes:[{type:t.ATTRIBUTE,name:"autohide",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"append-to-body",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"observer",evaluate:e=>e.observer}],redundantAttribute:"expr873",selector:"[expr873]"}]),name:"settings-block-redirects-item"};e(bc.name,bc);const yc={css:null,exports:{setup(e,{initMobx:t}){t(),this.store=e.$store,this.state={get list(){return e.store.getters.redirectList},get showList(){return this.list.length>0},get isChanged(){return e.store.isChanged}},this.meta={sprite:at("settings","admin"),spriteRedirects:at("redirects","admin/settings"),helpLinkRedirects:"https://help.flexbe.ru/redirect/"},this.watch={"state.isChanged":[()=>this.update()]}},addRedirect(){const e=`${this.store.prefixId}${Ge()}`;this.store.commit("addItem","standard",{enabled:!0,regular_from_page:!1,from_page:"",to_page:"",redirect_type:301,save_query:!0,from_all_pages:!1,id:e})},deleteRedirect(e){this.store.commit("removeItem",e),flexbe.trigger("closeDropdown"),this.state.list<1&&this.saveList()},async sortedRedirects({oldIndex:e,newIndex:t}){e!==t&&(this.store.commit("sortStandardList",e,t),this.meta.destroyList=!0,this.update(),this.meta.destroyList=!1,this.update())},async saveList(){var e;null==(e=document.activeElement)||e.blur();if(this.state.list.some((e=>!e.from_page||!e.to_page||sr(e.to_page)&&200===e.redirect_type||e.from_page===e.to_page)))return this.store.hasError=!0,new Error(tr("admin::settings::redirects::standard::error_empty"));return await this.store.dispatch("saveStandardList")},saveError(e){toast.error(e.message)}},template:(e,t,s,i)=>e('<div expr884="expr884" is="save-button" class="save-redirect-btn"></div><div expr885="expr885" class="flexbe-white-box shadow is-card"></div><div expr890="expr890" class="flexbe-white-box shadow collection"></div><div class="flexbe-bar rounded redirects-info"><div class="redirects-info-img"><img src="/_s/images/emoji/progger_girl.png" alt/></div><span expr898="expr898" is="raw" class="flexbe-desc"></span></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["settings-block-redirects ",e.props.class].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"save-button",slots:[],attributes:[{type:t.ATTRIBUTE,name:"show-save",evaluate:e=>e.state.isChanged&&e.state.showList},{type:t.EVENT,name:"on-save",evaluate:e=>e.saveList},{type:t.EVENT,name:"on-error",evaluate:e=>e.saveError}],redundantAttribute:"expr884",selector:"[expr884]"},{type:s.IF,evaluate:e=>!e.state.showList,redundantAttribute:"expr885",selector:"[expr885]",template:e('<svg expr886="expr886" is="flexbe-icon" icon="empty-redirects" size="28"></svg><div expr887="expr887" class="flexbe-text my20"> </div><div expr888="expr888" is="flexbe-button" class="flexbe-button filled rounded large is-primary add-redirect-btn"></div>',[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.spriteRedirects}],redundantAttribute:"expr886",selector:"[expr886]"},{redundantAttribute:"expr887",selector:"[expr887]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::redirects::standard::empty")}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-button",slots:[{id:"default",html:'<span expr889="expr889" class="flexbe-text"> </span>',bindings:[{redundantAttribute:"expr889",selector:"[expr889]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::redirects::standard::add")}]}]}],attributes:[{type:t.EVENT,name:"onclick",evaluate:e=>e.addRedirect}],redundantAttribute:"expr888",selector:"[expr888]"}])},{type:s.IF,evaluate:e=>e.state.showList,redundantAttribute:"expr890",selector:"[expr890]",template:e('<div class="collection-item collection-header"><div expr891="expr891" class="col flexbe-desc"> </div><div expr892="expr892" class="col flexbe-desc"> </div><div expr893="expr893" class="col flexbe-desc"> </div></div><div expr894="expr894" is="flexbe-sort-list" item-selector=".settings-block-redirects-item" handle-selector=".draggable"></div><div class="collection-item"><div expr896="expr896" is="flexbe-button" class="flexbe-button small filled is-primary add-redirect-btn"></div></div>',[{redundantAttribute:"expr891",selector:"[expr891]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::redirects::standard::from_page")}]},{redundantAttribute:"expr892",selector:"[expr892]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::redirects::standard::to_page")}]},{redundantAttribute:"expr893",selector:"[expr893]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::redirects::standard::type::title")}]},{type:s.IF,evaluate:e=>!e.meta.destroyList,redundantAttribute:"expr894",selector:"[expr894]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-sort-list",slots:[{id:"default",html:'<div expr895="expr895" is="settings-block-redirects-item" class="collection-item"></div>',bindings:[{type:s.EACH,getKey:e=>e.redirect.id,condition:null,template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"settings-block-redirects-item",slots:[],attributes:[{type:t.ATTRIBUTE,name:"item",evaluate:e=>e.redirect},{type:t.ATTRIBUTE,name:"delete-redirect",evaluate:e=>e.deleteRedirect}]}]),redundantAttribute:"expr895",selector:"[expr895]",itemName:"redirect",indexName:null,evaluate:e=>e.state.list}]}],attributes:[{type:t.ATTRIBUTE,name:"sort-end",evaluate:e=>e.sortedRedirects}]}])},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-button",slots:[{id:"default",html:'<span expr897="expr897" class="flexbe-text"> </span>',bindings:[{redundantAttribute:"expr897",selector:"[expr897]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::settings::redirects::standard::add")}]}]}],attributes:[{type:t.EVENT,name:"onclick",evaluate:e=>e.addRedirect}],redundantAttribute:"expr896",selector:"[expr896]"}])},{type:s.TAG,getComponent:i,evaluate:e=>"raw",slots:[],attributes:[{type:t.ATTRIBUTE,name:"content",evaluate:e=>e.tr("admin::settings::redirects::standard::desc",{href:e.meta.helpLinkRedirects})}],redundantAttribute:"expr898",selector:"[expr898]"}]),name:"settings-block-redirects"};e(yc.name,yc),riot3.tag2("password-page",'<img src="/_s/images/admin/png/img-password_retina.png"> <div class="text-h1 password-page-title"> {tr(\'admin::auth::password::title\')} </div> <div class="font-ui text-shade-65 text-sm password-page-subtext"> <raw content="{tr(\'admin::auth::password::text\')}"> </div> <div class="password-page-container {block-animate: showInput} {has-error: passwordError}" if="{password}"> <div class="password-page-text-container"> <div class="mb10 password-page-text">{tr(\'admin::auth::password::label\')}:</div> <div class="text-h2 display-flex justify-content-center align-items-center "> <span class="flexbe-text password-page-block ml25">{password || \'********\'}</span> <div class="password-page-icon" onclick="{changePassword}" data-tip="{tr(\'main::change_password_tip\')}"> <svg class="flexbe-icon size-16"> <mask id="aa" maskunits="userSpaceOnUse" x="0" y="0" width="16" height="16"> <path fill="#C4C4C4" d="M0 0h16v16H0z"></path> </mask> <g fill="#B3B3B7" mask="url(#aa)"> <path d="M.01 15c-.12-1.52.796-4.377 2.093-5.844L6.758 3.75l3.36 3.188-4.655 5.406C4.166 13.81 1.725 15 .01 15zM13.247 2.203c.36.34.402.848.096 1.187l-2.52 2.86-3.428-3.22 2.61-2.776c.305-.34.806-.34 1.167 0l2.075 1.95zM16 14H7l-1 1h10v-1z"></path> </g> </svg> </div> </div> </div> <div class="set-item shake-wrapper"> <div class="flexbe-input flexbe-input--text shadow large {error: passwordError} w100"> <input ref="password" class="flexbe-input-styled flexbe-input__text password-page-input password-page-change-input {error: passwordError}" type="text" riot-value="{password}" oninput="{changeInput}" onfocus="this.select()"> <div onclick="{savePassword}" class="password-page-change font-ui text-shade-65 text-sm"> <span class="text-s">{tr(\'main::button::apply\')}</span> </div> </div> <div class="field-help"> <div class="ico e"> <i></i><i></i><i></i> </div> <span>{tr(\'main::error::password_5chars_minimum\')}</span> </div> </div> </div> <div class="segmentation-button-wrap"> <div onclick="{clickButtonNext}" class="flexbe-button is-primary filled rounded large {loading: loading}"> <span class="flexbe-text">{tr(\'main::button::next\')}</span> </div> </div>',"",'class="password-page {opts.class}"',(function(e){const t=this;this.oldPassword=flexbe.vars.user.password,this.password=this.oldPassword,this.passwordError=!1,this.showInput=!1,this.clickNext=!1,this.loading=!1,this.clickButtonNext=function(){this.showInput?(this.loading=!0,this.clickNext=!0,this.savePassword()):document.location=document.location.origin+"/admin/segmentation/"}.bind(this),this.changePassword=function(){setTimeout((()=>{t.refs.password.focus()}),100),this.showInput=!0,this.update()}.bind(this),this.savePassword=function(){const e=t.refs.password.value.trim();if(t.refs.password.value=e,this.update(),e.length<5)this.passwordError=!0,this.loading=!1,this.update();else if(e!=this.oldPassword){const t=$.ajax({url:"/admin/api/profile/change_password/",type:"POST",data:{old_password:this.oldPassword,new_password:e}});this.passwordError=!1,this.showInput=!1,this.password=e,this.update(),t.done((t=>{t.status?(this.oldPassword=e,this.loading=!1,this.update(),this.clickNext&&(this.clickNext=!1,setTimeout((()=>{this.main.update({showPassword:!1,isSegmentation:!0})}),500)),toast.success(tr("admin::auth::password::changed_notify"))):(this.showInput=!0,this.loading=!1,toast.error(t.message),this.update())})),t.fail((()=>{this.loading=!1,toast.error(tr("main::error::network"))}))}else this.passwordError=!1,this.showInput=!1,this.loading=!1,this.update(),this.clickNext&&(this.clickNext=!1,document.location=document.location.origin+"/admin/segmentation/"),toast.success(tr("admin::auth::password::changed_notify"))}.bind(this),this.changeInput=function(){this.update({passwordError:!1})}.bind(this),this.on("mount",(()=>{$(".password-page-input").keypress((e=>{13==e.keyCode&&this.savePassword()})),flexbe.tip.init($(this.root).find(".password-page-icon")[0])}))})),riot3.tag2("segmentation-page",'<div class="icon display-flex justify-content-center align-items-center w100"> <svg viewbox="0 0 82 28"> <path d="M8.5 3C7.11929 3 6 4.11929 6 5.5V8H10V11H6H3H0V8H3V5.5C3 2.46243 5.46243 0 8.5 0H10V3H8.5ZM6 11V22H3V14L6 11ZM54 0H51V22H54V19.5988C55.2705 21.0806 57.0413 22 59 22C62.866 22 66 18.4183 66 14C66 9.58172 62.866 6 59 6C57.0413 6 55.2705 6.91939 54 8.40116V0ZM58.5 19C55.873 19 54 16.627 54 14C54 11.373 55.873 9 58.5 9C61.127 9 63 11.373 63 14C63 16.627 61.127 19 58.5 19ZM48.9463 6H45.4463L41.4463 11.5652L39.6963 14L33.9463 22H37.4463L41.4463 16.4348L45.4463 22H48.9463L43.1963 14L48.9463 6ZM37.4463 6L40.5805 10.3606L38.8213 12.7826L33.9463 6H37.4463ZM12 0V18.5C12 20.433 13.567 22 15.5 22H17V19H15.5C15.2239 19 15 18.7761 15 18.5V0H12ZM21.9375 7.22434C22.9879 6.46054 24.334 6 26 6C27.666 6 29.012 6.46054 30.0623 7.22445C31.0965 7.97669 31.756 8.95827 32.1761 9.87541C32.595 10.7898 32.7967 11.6844 32.8961 12.3366C32.9464 12.6664 32.972 12.9442 32.985 13.1448C32.9916 13.2454 32.995 13.3273 32.9969 13.3875C32.9978 13.4176 32.9983 13.4423 32.9985 13.4613L32.9988 13.4854L32.9988 13.4942L32.9989 13.4977V13.4993C32.9989 13.5 32.9989 13.5007 31.4989 13.5001C31.4989 15.0001 31.4988 15.0001 31.4988 15.0001H31.4984H31.4979H31.4971H31.4962H31.495H31.4936H31.492H31.4902H31.4881H31.4859H31.4834H31.4808H31.4779H31.4748H31.4716H31.4681H31.4644H31.4605H31.4564H31.4521H31.4476H31.4429H31.438H31.433H31.4277H31.4222H31.4165H31.4106H31.4045H31.3983H31.3918H31.3852H31.3783H31.3713H31.3641H31.3566H31.349H31.3412H31.3333H31.3251H31.3168H31.3082H31.2995H31.2906H31.2815H31.2723H31.2628H31.2532H31.2434H31.2334H31.2232H31.2129H31.2024H31.1917H31.1808H31.1698H31.1586H31.1472H31.1357H31.1239H31.1121H31.1H31.0878H31.0754H31.0628H31.0501H31.0372H31.0241H31.0109H30.9975H30.984H30.9703H30.9564H30.9424H30.9282H30.9138H30.8993H30.8847H30.8699H30.8549H30.8398H30.8245H30.8091H30.7935H30.7778H30.7619H30.7459H30.7297H30.7134H30.6969H30.6803H30.6635H30.6466H30.6295H30.6123H30.595H30.5775H30.5599H30.5421H30.5242H30.5062H30.488H30.4697H30.4513H30.4327H30.414H30.3951H30.3761H30.357H30.3377H30.3184H30.2989H30.2792H30.2595H30.2396H30.2195H30.1994H30.1791H30.1587H30.1382H30.1176H30.0968H30.0759H30.0549H30.0338H30.0125H29.9912H29.9697H29.9481H29.9264H29.9046H29.8826H29.8606H29.8384H29.8161H29.7937H29.7712H29.7486H29.7259H29.7031H29.6801H29.6571H29.6339H29.6107H29.5873H29.5639H29.5403H29.5167H29.4929H29.469H29.4451H29.421H29.3968H29.3726H29.3482H29.3238H29.2993H29.2746H29.2499H29.2251H29.2002H29.1752H29.1501H29.1249H29.0996H29.0742H29.0488H29.0233H28.9977H28.972H28.9462H28.9203H28.8944H28.8683H28.8422H28.816H28.7898H28.7634H28.737H28.7105H28.6839H28.6572H28.6305H28.6037H28.5769H28.5499H28.5229H28.4958H28.4686H28.4414H28.4141H28.3868H28.3593H28.3318H28.3043H28.2767H28.249H28.2212H28.1934H28.1656H28.1376H28.1096H28.0816H28.0535H28.0253H27.9971H27.9688H27.9405H27.9121H27.8837H27.8552H27.8266H27.7981H27.7694H27.7407H27.712H27.6832H27.6544H27.6255H27.5966H27.5676H27.5386H27.5095H27.4804H27.4513H27.4221H27.3929H27.3636H27.3343H27.305H27.2756H27.2462H27.2168H27.1873H27.1578H27.1282H27.0986H27.069H27.0394H27.0097H26.98H26.9503H26.9206H26.8908H26.861H26.8311H26.8013H26.7714H26.7415H26.7116H26.6817H26.6517H26.6217H26.5917H26.5617H26.5316H26.5016H26.4715H26.4414H26.4113H26.3812H26.3511H26.321H26.2908H26.2607H26.2305H26.2003H26.1702H26.14H26.1098H26.0796H26.0494H26.0192H25.9889H25.9587H25.9285H25.8983H25.8681H25.8379H25.8077H25.7774H25.7472H25.717H25.6868H25.6566H25.6264H25.5963H25.5661H25.5359H25.5058H25.4756H25.4455H25.4154H25.3853H25.3552H25.3251H25.295H25.265H25.2349H25.2049H25.1749H25.1449H25.115H25.085H25.0551H25.0252H24.9953H24.9655H24.9357H24.9059H24.8761H24.8463H24.8166H24.7869H24.7572H24.7276H24.698H24.6684H24.6389H24.6094H24.5799H24.5505H24.5211H24.4917H24.4624H24.4331H24.4038H24.3746H24.3454H24.3163H24.2872H24.2581H24.2291H24.2001H24.1712H24.1423H24.1135H24.0847H24.056H24.0273H23.9987H23.9701H23.9416H23.9131H23.8846H23.8563H23.8279H23.7997H23.7714H23.7433H23.7152H23.6871H23.6592H23.6312H23.6034H23.5756H23.5478H23.5201H23.4925H23.465H23.4375H23.4101H23.3827H23.3554H23.3282H23.3011H23.274H23.247H23.22H23.1932H23.1664H23.1396H23.113H23.0864H23.0599H23.0335H23.0072H22.9809H22.9547H22.9286H22.9026H22.8766H22.8508H22.825H22.7993H22.7737H22.7482H22.7227H22.6974H22.6721H22.647H22.6219H22.5969H22.572H22.5472H22.5224H22.4978H22.4733H22.4488H22.4245H22.4002H22.3761H22.352H22.3281H22.3042H22.2805H22.2568H22.2333H22.2098H22.1865H22.1632H22.1401H22.1171H22.0941H22.0713H22.0486H22.0424C22.2973 16.4755 23.2021 17.6118 24.4204 18.221C25.9855 19.0036 28.2643 18.998 30.6165 17.2871L32.3812 19.7132C29.2341 22.0023 25.7635 22.2467 23.0787 20.9043C20.4158 19.5728 18.7195 16.7607 18.9999 13.4225L19.0009 13.3869C19.0027 13.3267 19.0062 13.2448 19.0128 13.1443C19.0259 12.9436 19.0516 12.6659 19.102 12.336C19.2017 11.6839 19.4038 10.7894 19.8229 9.87498C20.2433 8.95791 20.9031 7.97647 21.9375 7.22434ZM31.4989 13.5001L32.9989 13.5007L32.9983 15.0001H31.4989V13.5001ZM22.2351 12.0001H22.2568H22.2805H22.3042H22.3281H22.352H22.3761H22.4002H22.4245H22.4488H22.4733H22.4978H22.5224H22.5472H22.572H22.5969H22.6219H22.647H22.6721H22.6974H22.7227H22.7482H22.7737H22.7993H22.825H22.8508H22.8766H22.9026H22.9286H22.9547H22.9809H23.0072H23.0335H23.0599H23.0864H23.113H23.1396H23.1664H23.1932H23.22H23.247H23.274H23.3011H23.3282H23.3554H23.3827H23.4101H23.4375H23.465H23.4925H23.5201H23.5478H23.5756H23.6034H23.6312H23.6592H23.6871H23.7152H23.7433H23.7714H23.7997H23.8279H23.8563H23.8846H23.9131H23.9416H23.9701H23.9987H24.0273H24.056H24.0847H24.1135H24.1423H24.1712H24.2001H24.2291H24.2581H24.2872H24.3163H24.3454H24.3746H24.4038H24.4331H24.4624H24.4917H24.5211H24.5505H24.5799H24.6094H24.6389H24.6684H24.698H24.7276H24.7572H24.7869H24.8166H24.8463H24.8761H24.9059H24.9357H24.9655H24.9953H25.0252H25.0551H25.085H25.115H25.1449H25.1749H25.2049H25.2349H25.265H25.295H25.3251H25.3552H25.3853H25.4154H25.4455H25.4756H25.5058H25.5359H25.5661H25.5963H25.6264H25.6566H25.6868H25.717H25.7472H25.7774H25.8077H25.8379H25.8681H25.8983H25.9285H25.9587H25.9889H26.0192H26.0494H26.0796H26.1098H26.14H26.1702H26.2003H26.2305H26.2607H26.2908H26.321H26.3511H26.3812H26.4113H26.4414H26.4715H26.5016H26.5316H26.5617H26.5917H26.6217H26.6517H26.6817H26.7116H26.7415H26.7714H26.8013H26.8311H26.861H26.8908H26.9206H26.9503H26.98H27.0097H27.0394H27.069H27.0986H27.1282H27.1578H27.1873H27.2168H27.2462H27.2756H27.305H27.3343H27.3636H27.3929H27.4221H27.4513H27.4804H27.5095H27.5386H27.5676H27.5966H27.6255H27.6544H27.6832H27.712H27.7407H27.7694H27.7981H27.8266H27.8552H27.8837H27.9121H27.9405H27.9688H27.9971H28.0253H28.0535H28.0816H28.1096H28.1376H28.1656H28.1934H28.2212H28.249H28.2767H28.3043H28.3318H28.3593H28.3868H28.4141H28.4414H28.4686H28.4958H28.5229H28.5499H28.5769H28.6037H28.6305H28.6572H28.6839H28.7105H28.737H28.7634H28.7898H28.816H28.8422H28.8683H28.8944H28.9203H28.9462H28.972H28.9977H29.0233H29.0488H29.0742H29.0996H29.1249H29.1501H29.1752H29.2002H29.2251H29.2499H29.2746H29.2993H29.3238H29.3482H29.3726H29.3968H29.421H29.4451H29.469H29.4929H29.5167H29.5403H29.5639H29.5873H29.6107H29.6339H29.6571H29.6801H29.7031H29.7259H29.7486H29.7634C29.6854 11.7161 29.5829 11.4179 29.4486 11.1247C29.1816 10.5418 28.8102 10.0234 28.2977 9.65059C27.8012 9.28948 27.0846 9 26 9C24.9154 9 24.1986 9.28948 23.7018 9.6507C23.189 10.0236 22.8173 10.5422 22.5501 11.1251C22.4157 11.4182 22.3131 11.7162 22.2351 12.0001ZM75 6C73.334 6 71.9879 6.46054 70.9375 7.22434C69.9031 7.97647 69.2433 8.95791 68.8229 9.87498C68.4038 10.7894 68.2017 11.6839 68.102 12.336C68.0516 12.6659 68.0259 12.9436 68.0128 13.1443C68.0062 13.2448 68.0027 13.3267 68.0009 13.3869L67.9999 13.4225C67.7195 16.7607 69.4158 19.5728 72.0787 20.9043C74.7635 22.2467 78.2341 22.0023 81.3812 19.7132L79.6165 17.2871C77.2643 18.998 74.9855 19.0036 73.4204 18.221C72.2021 17.6118 71.2973 16.4755 71.0424 15.0001H71.0486H71.0713H71.0941H71.1171H71.1401H71.1632H71.1865H71.2098H71.2333H71.2568H71.2805H71.3042H71.3281H71.352H71.3761H71.4002H71.4245H71.4488H71.4733H71.4978H71.5224H71.5472H71.572H71.5969H71.6219H71.647H71.6721H71.6974H71.7227H71.7482H71.7737H71.7993H71.825H71.8508H71.8766H71.9026H71.9286H71.9547H71.9809H72.0072H72.0335H72.0599H72.0864H72.113H72.1396H72.1664H72.1932H72.22H72.247H72.274H72.301H72.3282H72.3554H72.3827H72.4101H72.4375H72.465H72.4925H72.5201H72.5478H72.5756H72.6034H72.6312H72.6592H72.6871H72.7152H72.7433H72.7714H72.7997H72.8279H72.8563H72.8846H72.9131H72.9416H72.9701H72.9987H73.0273H73.056H73.0847H73.1135H73.1423H73.1712H73.2001H73.2291H73.2581H73.2872H73.3163H73.3454H73.3746H73.4038H73.4331H73.4624H73.4917H73.5211H73.5505H73.5799H73.6094H73.6389H73.6684H73.698H73.7276H73.7572H73.7869H73.8166H73.8463H73.8761H73.9059H73.9357H73.9655H73.9953H74.0252H74.0551H74.085H74.115H74.1449H74.1749H74.2049H74.2349H74.265H74.295H74.3251H74.3552H74.3853H74.4154H74.4455H74.4756H74.5058H74.5359H74.5661H74.5963H74.6264H74.6566H74.6868H74.717H74.7472H74.7774H74.8077H74.8379H74.8681H74.8983H74.9285H74.9587H74.9889H75.0192H75.0494H75.0796H75.1098H75.14H75.1702H75.2003H75.2305H75.2607H75.2908H75.321H75.3511H75.3812H75.4113H75.4414H75.4715H75.5016H75.5316H75.5617H75.5917H75.6217H75.6517H75.6816H75.7116H75.7415H75.7714H75.8013H75.8311H75.861H75.8908H75.9206H75.9503H75.98H76.0097H76.0394H76.069H76.0986H76.1282H76.1578H76.1873H76.2168H76.2462H76.2756H76.305H76.3343H76.3636H76.3929H76.4221H76.4513H76.4804H76.5095H76.5386H76.5676H76.5966H76.6255H76.6544H76.6832H76.712H76.7407H76.7694H76.798H76.8266H76.8552H76.8837H76.9121H76.9405H76.9688H76.9971H77.0253H77.0535H77.0816H77.1096H77.1376H77.1656H77.1934H77.2212H77.249H77.2767H77.3043H77.3318H77.3593H77.3868H77.4141H77.4414H77.4686H77.4958H77.5229H77.5499H77.5769H77.6037H77.6305H77.6572H77.6839H77.7105H77.737H77.7634H77.7898H77.816H77.8422H77.8683H77.8944H77.9203H77.9462H77.972H77.9977H78.0233H78.0488H78.0742H78.0996H78.1249H78.1501H78.1752H78.2002H78.2251H78.2499H78.2746H78.2993H78.3238H78.3482H78.3726H78.3969H78.421H78.4451H78.469H78.4929H78.5167H78.5403H78.5639H78.5873H78.6107H78.6339H78.6571H78.6801H78.7031H78.7259H78.7486H78.7712H78.7937H78.8161H78.8384H78.8606H78.8826H78.9046H78.9264H78.9481H78.9697H78.9912H79.0125H79.0338H79.0549H79.0759H79.0968H79.1176H79.1382H79.1587H79.1791H79.1994H79.2195H79.2396H79.2595H79.2792H79.2989H79.3184H79.3378H79.357H79.3761H79.3951H79.414H79.4327H79.4513H79.4697H79.488H79.5062H79.5242H79.5421H79.5599H79.5775H79.595H79.6123H79.6295H79.6466H79.6635H79.6803H79.6969H79.7134H79.7297H79.7459H79.7619H79.7778H79.7935H79.8091H79.8245H79.8398H79.8549H79.8699H79.8847H79.8993H79.9138H79.9282H79.9424H79.9564H79.9703H79.984H79.9975H80.0109H80.0241H80.0372H80.0501H80.0628H80.0754H80.0878H80.1H80.1121H80.1239H80.1357H80.1472H80.1586H80.1698H80.1808H80.1917H80.2024H80.2129H80.2232H80.2334H80.2434H80.2532H80.2628H80.2723H80.2815H80.2906H80.2995H80.3082H80.3168H80.3251H80.3333H80.3412H80.349H80.3566H80.3641H80.3713H80.3783H80.3852H80.3918H80.3983H80.4045H80.4106H80.4165H80.4222H80.4277H80.433H80.438H80.4429H80.4476H80.4521H80.4564H80.4605H80.4644H80.4681H80.4716H80.4748H80.4779H80.4808H80.4834H80.4859H80.4881H80.4902H80.492H80.4936H80.495H80.4962H80.4971H80.4979H80.4984H80.4987C80.4988 15.0001 80.4989 15.0001 80.4989 13.5001V15.0001H81.9983L81.9989 13.5007L80.4989 13.5001C81.9989 13.5007 81.9989 13.5 81.9989 13.4993L81.9989 13.4977L81.9988 13.4942L81.9988 13.4854L81.9985 13.4613C81.9983 13.4423 81.9978 13.4176 81.9969 13.3875C81.995 13.3273 81.9916 13.2454 81.985 13.1448C81.972 12.9442 81.9464 12.6664 81.8961 12.3366C81.7967 11.6844 81.595 10.7898 81.1761 9.87541C80.756 8.95827 80.0965 7.97669 79.0623 7.22445C78.012 6.46054 76.666 6 75 6ZM71.2568 12.0001H71.2351C71.3131 11.7162 71.4157 11.4182 71.5501 11.1251C71.8173 10.5422 72.189 10.0236 72.7018 9.6507C73.1986 9.28948 73.9154 9 75 9C76.0846 9 76.8012 9.28948 77.2977 9.65059C77.8102 10.0234 78.1816 10.5418 78.4486 11.1247C78.5829 11.4179 78.6854 11.7161 78.7634 12.0001H78.7486H78.7259H78.7031H78.6801H78.6571H78.6339H78.6107H78.5873H78.5639H78.5403H78.5167H78.4929H78.469H78.4451H78.421H78.3969H78.3726H78.3482H78.3238H78.2993H78.2746H78.2499H78.2251H78.2002H78.1752H78.1501H78.1249H78.0996H78.0742H78.0488H78.0233H77.9977H77.972H77.9462H77.9203H77.8944H77.8683H77.8422H77.816H77.7898H77.7634H77.737H77.7105H77.6839H77.6572H77.6305H77.6037H77.5769H77.5499H77.5229H77.4958H77.4686H77.4414H77.4141H77.3868H77.3593H77.3318H77.3043H77.2767H77.249H77.2212H77.1934H77.1656H77.1376H77.1096H77.0816H77.0535H77.0253H76.9971H76.9688H76.9405H76.9121H76.8837H76.8552H76.8266H76.798H76.7694H76.7407H76.712H76.6832H76.6544H76.6255H76.5966H76.5676H76.5386H76.5095H76.4804H76.4513H76.4221H76.3929H76.3636H76.3343H76.305H76.2756H76.2462H76.2168H76.1873H76.1578H76.1282H76.0986H76.069H76.0394H76.0097H75.98H75.9503H75.9206H75.8908H75.861H75.8311H75.8013H75.7714H75.7415H75.7116H75.6816H75.6517H75.6217H75.5917H75.5617H75.5316H75.5016H75.4715H75.4414H75.4113H75.3812H75.3511H75.321H75.2908H75.2607H75.2305H75.2003H75.1702H75.14H75.1098H75.0796H75.0494H75.0192H74.9889H74.9587H74.9285H74.8983H74.8681H74.8379H74.8077H74.7774H74.7472H74.717H74.6868H74.6566H74.6264H74.5963H74.5661H74.5359H74.5058H74.4756H74.4455H74.4154H74.3853H74.3552H74.3251H74.295H74.265H74.2349H74.2049H74.1749H74.1449H74.115H74.085H74.0551H74.0252H73.9953H73.9655H73.9357H73.9059H73.8761H73.8463H73.8166H73.7869H73.7572H73.7276H73.698H73.6684H73.6389H73.6094H73.5799H73.5505H73.5211H73.4917H73.4624H73.4331H73.4038H73.3746H73.3454H73.3163H73.2872H73.2581H73.2291H73.2001H73.1712H73.1423H73.1135H73.0847H73.056H73.0273H72.9987H72.9701H72.9416H72.9131H72.8846H72.8563H72.8279H72.7997H72.7714H72.7433H72.7152H72.6871H72.6592H72.6312H72.6034H72.5756H72.5478H72.5201H72.4925H72.465H72.4375H72.4101H72.3827H72.3554H72.3282H72.301H72.274H72.247H72.22H72.1932H72.1664H72.1396H72.113H72.0864H72.0599H72.0335H72.0072H71.9809H71.9547H71.9286H71.9026H71.8766H71.8508H71.825H71.7993H71.7737H71.7482H71.7227H71.6974H71.6721H71.647H71.6219H71.5969H71.572H71.5472H71.5224H71.4978H71.4733H71.4488H71.4245H71.4002H71.3761H71.352H71.3281H71.3042H71.2805H71.2568Z" fill="black"></path> </svg> </div> <div class="flexbe-title text-h1">{tr(\'admin::auth::segmentation::title\')}</div> <div class="flexbe-desc text-m">{tr(\'admin::auth::segmentation::text\')}</div> <div class="segmentation-wrap"> <div each="{item, index in segmentationBlock}" class="segmentation-block flexbe-white-card shadow hoverable pointer {selected: (index === segmentIndex)}" data-id="{item.template_id}" onclick="{segmentClick.bind(this, item, index)}"> <div class="display-flex mt0 mb20"> <img riot-src="/_s/images/admin/segmentation/{item.type}.png" riot-srcset="/_s/images/admin/segmentation/{item.type}_retina.png 2x"> </div> <div class="display-flex justify-content-center align-items-center card-title"> <svg class="icon-selected"> <g fill="none"><path d="M1 5l4 4 8-8" stroke="currentColor" stroke-width="2"></path></g> </svg> <span class="segmentation-text text-m text-center">{item.title}</span> <q data-is="flexbe-tooltip" if="{item.tip}" content="{item.tip}"></q> </div> </div> <div data-is="proxy" is="flexbe-loader" class="segmentation-loader-wrap" if="{!segmentationBlock.length}"></div> </div> <div onclick="{nextSegmentation}" class="segmentation-button-wrap {hidden: !segmentationBlock.length}"> <div class="flexbe-button is-primary filled rounded large {loading: loading}"> <span class="flexbe-text">{tr(\'main::button::next\')}</span> </div> </div>',"",'class="segmentation-page"',(function(e){this.sprite=flexbe.lib.getSprite("segmentation","admin"),this.p_type=parseInt(localStorage.getItem("p_type"),10)||parseInt(this.opts.pageType,10)||0,this.segmentationBlock=[],this.selectItem={},this.segmentIndex=0,this.loading=!1,this.getSegmentationData=function(e){if(this.segmentationBlock.length)return void e(null,this.segmentationBlock);const t=$.ajax({url:"/admin/api/segment/data/",type:"GET"});t.done((t=>{this.segmentationBlock=t.data,this.selectItem=this.segmentationBlock[0],e(null,this.segmentationBlock)})),t.fail((t=>{e(new Error(t))}))}.bind(this),this.segmentClick=function(e,t){this.segmentIndex=t,this.selectItem=e}.bind(this),this.nextSegmentation=function(){if(!this.loading){this.loading=!0;let e={title:tr("admin::pages::add::homepage"),group_id:flexbe.vars.group.id,type:this.p_type,uri:"/",is_first_page:1,src_p_id:this.selectItem.template_id,folder_id:0};flexbe.page.createPage(e).then((e=>{e.domain&&e.uri&&(document.location=document.location.protocol+"//"+e.domain+e.uri)}))}}.bind(this),this.on("mount",(()=>{this.getSegmentationData(((e,t)=>{this.update({segmentationBlock:t})}))}))})),riot3.tag2("admin-error-page",'<svg class="flexbe-icon size-32"> <use riot-xlink:href="{sprite}#ghost"></use> </svg> <div class="flexbe-text text-title">{tr(\'admin::service::something_wrong_title\')}</div> <hr class="flexbe-hr"> <div class="flexbe-desc font-ui" data-is="raw" content="{tr(\'admin::service::something_wrong_desc\')}"></div>',"",'class="admin-error-page {opts.class}"',(function(e){this.sprite=flexbe.lib.getSprite("service","admin")})),riot3.tag2("admin-notfound-page",'<svg class="flexbe-icon size-32"> <use riot-xlink:href="{sprite}#ufo"></use> </svg> <div class="flexbe-text text-title"> {tr(\'admin::service::not_found_title\')} </div> <hr class="flexbe-hr"> <div class="flexbe-desc font-ui" data-is="raw" content="{tr(\'admin::service::not_found_desc\')}" onclick="{clickHandler}"></div>',"",'class="admin-notfound-page {opts.class}"',(function(e){this.sprite=flexbe.lib.getSprite("service","admin"),this.clickHandler=function(e){e.target.closest('[data-command="support"]')&&flexbe.support.toggleChat(!0)}.bind(this)})),function(){let e=history.state&&history.state.index||0,t=e;const s=[];history.state&&"index"in history.state||history.replaceState({index:e,state:history.state},document.title);const i=Object.getOwnPropertyDescriptor(History.prototype,"state").get,{pushState:a,replaceState:n}=history;function r(i,a){return(n,...r)=>{i.call(history,{index:e+a,state:n},...r),t=e,e+=a,s[e]=n}}function o(i){const{get:a}=Object.getOwnPropertyDescriptor(i.prototype,"state");Object.defineProperty(i.prototype,"state",{configurable:!0,enumerable:!0,get(){return a.call(this).state},set:void 0}),Object.defineProperty(i.prototype,"oldState",{configurable:!0,enumerable:!0,get:()=>s[t],set:void 0}),Object.defineProperty(i.prototype,"direction",{configurable:!0,enumerable:!0,get:()=>e!==t&&(e>t?"forward":"backward"),set:void 0})}o(History),o(PopStateEvent),history.pushState=r(a,1),history.replaceState=r(n,0),window.addEventListener("popstate",(function(){const s=i.call(history);s||n.call(history,{index:e+1},document.title);const a=s?s.index:e+1,r=a>e?"forward":"backward";window.dispatchEvent(new Event(r)),t=e,e=a}))}();const _c={css:'toast-message,[is="toast-message"]{ display: flex; align-items: center; height: 100%; } toast-message .flexbe-icon,[is="toast-message"] .flexbe-icon{ width: 16px; height: 16px; } toast-message .flexbe-icon + .flexbe-text,[is="toast-message"] .flexbe-icon + .flexbe-text{ margin-left: 10px; }',exports:{setup(e){this.state={get type(){var t;return null!=(t=e.props.type)?t:"log"},get message(){return e.props.message},get icon(){if(e.props.icon)return e.props.icon;if(e.props.showEmoji){const t=e.meta.images[this.type],s=t[Math.floor(Math.random()*t.length)];return`${e.meta.emojiDir}/${s}.png`}return!1},get showIcon(){return e.props.icon||e.props.showEmoji||!1}},this.meta={emojiDir:"/_s/images/emoji",images:{error:["frowning_face","neutral_face","rolling_eyes"],success:["hand_hello","clapping_hands","smiling_face","thumbs_up"],done:["done"]}}}},template:(e,t,s,i)=>e('<img expr1="expr1" class="flexbe-icon size-16" loading="eager" alt/><span expr2="expr2" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["toast-message editor-ui ",e.props.class].join("")}]},{type:s.IF,evaluate:e=>e.state.showIcon,redundantAttribute:"expr1",selector:"[expr1]",template:e(null,[{expressions:[{type:t.ATTRIBUTE,name:"src",evaluate:e=>e.state.icon}]}])},{redundantAttribute:"expr2",selector:"[expr2]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.state.message}]}]),name:"toast-message"};e(_c.name,_c),function(){function e(e,t,s,i,a={}){let r,o="";if(s instanceof Node)o=s;else{var l;const e=function(e,t,s){const i="component"===e;return n(i?t:_c)(document.createElement("div"),{id:Ge("3"),showEmoji:!i,type:e,message:t,...s})}(t,s,a),d=null==(l=i)?void 0:l.onHide;o=e.root,r={...e,...a},i={...i,closeOnIteract:"component"===t,onShow:({toast:e})=>{e.setAttribute("data-layers-events","ignore")},onHide:()=>{e.unmount(),d&&d()}}}return e(t,o,i,r)}"undefined"!=typeof toast&&(toast.success=toast.extend("success",e),toast.error=toast.extend("error",e),toast.done=toast.extend("done",e),toast.component=toast.extend("component",e))}();const Tc={lead:{statuses:{0:{value:0,title:tr("admin::lead::status::new")},1:{value:1,title:tr("admin::lead::status::in_progress")},2:{value:2,title:tr("admin::lead::status::completed")},10:{value:10,title:tr("admin::lead::status::canceled")},11:{value:11,title:tr("admin::lead::status::removed")}},loadList:(e={})=>ai(`/admin/api/project/${flexbe.vars.group.id}/lead/list/`,{data:e,hash:"loadList"}),loadLead:(e={})=>ii("/admin/lead/view/",{data:e,hash:`loadLead_${e.id}`}),editLeads(e,t={}){if(e&&!Array.isArray(e)&&(e=[e]),!e||!e.length||!Object.keys(t).length)return Promise.reject(new Error("Wrong arguments list"));const s=`edit${JSON.stringify(e)+JSON.stringify(Object.keys(t))}`;return ii(`/admin/api/project/${flexbe.vars.group.id}/lead/edit_bulk/`,{data:{ids:e,...t},hash:s})},editPromotion:(e,t)=>ii(`/admin/api/project/${flexbe.vars.group.id}/lead/${e}/promotions/`,{asJson:!0,data:t}),removePromotion:(e,t)=>ni(`/admin/api/project/${flexbe.vars.group.id}/lead/${e}/promotions/${t}/`)},user:{members:{revoke:({id:e})=>ni(`/admin/api/member/${e}/revoke/`),save:({id:e,role:t,email:s,projects:i}={})=>ii(e?`/admin/api/member/${e}/`:"/admin/api/member/",{data:{role:t,email:s,projects:i}})}}};class wc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/general/`,this.mutations={setAnimateBlockData:e=>{this.state.block_animation=e},setSmoothingScroll:e=>{this.state.smoothing_scroll=e},setFavicon:e=>{this.state.favicon=e},setAdaptive:e=>{this.state.is_adaptive=e},setRestricted:e=>{this.state.is_restricted=e},setLocale:({language:e,country:t,timezone:s})=>{e&&(flexbe.vars.group.lang=e),t&&(flexbe.vars.group.country=t),s&&(flexbe.vars.group.timezone=s)},setCurrency:({code:e,symbol:t})=>{flexbe.vars.group.currency.code=e,flexbe.vars.group.currency.symbol=t},setAntispam:e=>{this.state.flood=e},setCaptchaPolicyData:e=>{this.state.flood.captcha.policy=e}},this.actions={deleteFavicon:async()=>{const e=h(this.state.seo_favicon||"");this.commit("setFavicon","");try{return await ni(`/admin/api/project/${flexbe.vars.group.id}/settings/favicon/`)}catch(t){throw this.commit("setFavicon",e),t}},updateAnimateBlockData:async e=>{const t=h(this.state.block_animation||{});this.commit("setAnimateBlockData",e);try{var s,i,a;return await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{block_animation:{show:(null!=(s=e.show)?s:t.show)?1:0,style:null!=(i=null!=(a=e.style)?a:t.style)?i:"default"}}}})}catch(e){throw this.commit("setAnimateBlockData",t),e}},updateSmoothingScroll:async e=>{const t=h(this.state.smoothing_scroll||{});this.commit("setSmoothingScroll",e);try{return await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{smoothing_scroll:e}}})}catch(e){throw this.commit("setSmoothingScroll",t),e}},toggleAdaptive:async e=>{const t=h(this.state.adaptive_view);e=e?1:0,this.commit("setAdaptive",e);try{return await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{adaptive_view:e}}})}catch(e){throw this.commit("setAdaptive",t),e}},toggleSiteLock:async e=>{const t=h(this.state.restricted_access);e=e?1:0,this.commit("setRestricted",e);try{return await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{restricted_access:e}}})}catch(e){throw this.commit("setRestricted",t),e}},setLocale:async({language:e,country:t,timezone:s})=>{const i=await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{locale:{language:e,country:t,timezone:s}}}});return this.commit("setLocale",{language:e,country:t,timezone:s}),i},setCurrency:async({code:e,symbol:t})=>{const{code:s,symbol:i}=flexbe.vars.group.currency;null==e&&(e=s),null==t&&(t=i),this.commit("setCurrency",{code:e,symbol:t});return await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{currency:{code:e,symbol:t}}}})},setAntispam:async e=>(e.enabled=e.enabled?1:0,e={captcha:e},this.commit("setAntispam",e),ii(`/admin/api/project/${flexbe.vars.group.id}/settings/captcha/`,{asJson:!0,data:e})),updateCaptchaPolicyData:async e=>{const t=h(this.state.flood),s=t;this.commit("setCaptchaPolicyData",e),t.captcha.policy=e;try{return await ii(`/admin/api/project/${flexbe.vars.group.id}/settings/captcha/`,{asJson:!0,data:t})}catch(e){throw this.commit("setCaptchaPolicyData",s),e}}}}}class kc extends oo{constructor(...e){super(...e),this.mutations={setSearch:(e,t)=>{this.extendState({search:e,searchLoading:t})},setRecommends:(e,t)=>{this.extendState({recommends:e,recommendsLoading:t})},resetState:()=>{this.extendState({search:{},recommends:[],searchLoading:!1,recommendsLoading:!1})}},this.actions={loadSearch:async e=>{let t;this.commit("setSearch",{},!0);try{t=await this.api.getDomainData(e)}catch(e){throw this.commit("setSearch",{},!1),e}return this.commit("setSearch",t,!1),t},loadRecommends:async e=>{let t;this.commit("setRecommends",null,!0);try{t=await this.api.getRecommendsList(e)}catch(e){throw this.commit("setRecommends",null,!1),e}return this.commit("setRecommends",t,!1),t}},this.api={getDomainData:e=>ii(`/admin/api/project/${flexbe.vars.group.id}/settings/domains/check_alias/`,{data:{domain_name:e}}).then((e=>e.data)),getRecommendsList:e=>ii(`/admin/api/project/${flexbe.vars.group.id}/settings/domains/get_list_of_recommended_domains/`,{data:{domain_name:e}}).then((e=>e.data)),transferDomain:e=>ii(`/admin/api/project/${flexbe.vars.group.id}/settings/domains/transfer_alias/`,{data:{domain_name:e}}),transferDomainInternal:e=>ii(`/admin/api/project/${flexbe.vars.group.id}/settings/domain/${e}/transfer/flexbe_internal/`),checkRegAllowed:e=>ii(`/admin/api/project/${flexbe.vars.group.id}/settings/domains/is_reg_allowed/`,{data:{domain_name:e}})}}normalizeState(e){return{search:{},recommends:[],searchLoading:!1,recommendsLoading:!1,...e}}}class Ac extends oo{constructor(...e){super(...e),this.expirePeriod=3e5,this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/domains/reg/`,this.helpers={getField:e=>{const t=!this.getters.isPaid,s=sessionStorage.getItem(`domain_reg.${e}`),i=st(this.state.user[e],!0);return t&&null!=s?s:i||""}},this.mutations={setField:(e,t)=>{this.state.user[e]=t,sessionStorage.setItem(`domain_reg.${e}`,t)}},this.getters={isPaid:()=>!!this.state.is_reg_id_paid,user:()=>{const e={};return Object.keys(this.state.user).forEach((t=>{e[t]=this.helpers.getField(t)})),e},errorsInField:()=>(this.state.errors||[]).filter((e=>e.field)),errorsNotInField:()=>(this.state.errors||[]).filter((e=>!e.field)),errors:()=>{const e={};return this.getters.errorsInField.forEach((t=>{e[t.field]=h(t)})),e}},this.api={registerDomain:async()=>ii(`/admin/api/project/${flexbe.vars.group.id}/settings/domains/save_reg_form/`,{data:{reg_id:this.state.reg_id,domain_name:this.state.domain.full_name,data:this.getters.user}})}}}class Ec extends oo{constructor(...e){super(...e),this.expirePeriod=3e5,this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/domains/get_domain/`}}class Ic extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/domains/`,this._modules={add:kc,reg:Ac,domain:Ec},this.helpers={getDomain:e=>this.state.main_domain.domain_id==e?this.state.main_domain:this.state.domain_list.concat(this.state.domain_reg_list).find((t=>t.domain_id==e))},this.mutations={setDomainSsl:(e,t)=>{const s=this.helpers.getDomain(e);s&&(s.ssl=t)},setDomainRedirect:(e,t)=>{const s=this.helpers.getDomain(e);s&&(s.is_redirect_to_main=t)},updateState:(e={})=>{this.extendState({...e})}},this.actions={toggleDomainSsl:async(e,t)=>{const s=flexbe.vars.group.id,i=await ii(`/admin/api/project/${s}/settings/domain/${e}/toggle_ssl/`,{data:{is_enable_ssl:t?1:0}});return this.commit("setDomainSsl",e,i.data.domain.ssl),i},toggleDomainRedirect:async(e,t)=>{const s=flexbe.vars.group.id,i=await ii(`/admin/api/project/${s}/settings/domain/${e}/redirect_to_main/`,{data:{enable:t?1:0}});return this.commit("setDomainRedirect",e,i.data.domain.is_redirect_to_main),i},setDomainAsMain:async e=>{const t=flexbe.vars.group.id,s=await ii(`/admin/api/project/${t}/settings/domain/${e}/make_main/`);return this.commit("updateState",s.data),s},removeDomain:async e=>{const t=flexbe.vars.group.id,s=await ni(`/admin/api/project/${t}/settings/domain/${e}/remove/`);return this.commit("updateState",s.data),s},cancelDomainReg:async e=>{const t=flexbe.vars.group.id,s=await ni(`/admin/api/project/${t}/settings/domains/reg/${e}/cancel/`);return this.commit("updateState",s.data),s}}}}class Cc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/notify/`}addEmail(e){const t=this.state.notify_emails;return t.push(e),t}addPhone(e){const t=this.state.phones;return t.push(e),t}updatePhone(e,t){const s=this.state.phones;s[e]=Object.assign(s[e],t)}updateTelegram(e,t){const s=this.state.phones;s[e]=Object.assign(s[e],t)}async saveEmail(e){const t=flexbe.vars.group.id,s=e.id,i=this.state.notify_emails,a=s?i.find((e=>e.id===s)):e,n=s?`/admin/api/project/${t}/settings/notify/email/${s}/`:`/admin/api/project/${t}/settings/notify/email/`,r=await ii(n,{data:{email:e.email}});return r&&r.data&&(a.id=r.data.id),r}async removeEmail(e){const t=flexbe.vars.group.id,s=e.id,i=this.state.notify_emails,a=i.findIndex((t=>t.id==e.id)),n=i.splice(a,1)[0];if(n.id)try{return await ni(`/admin/api/project/${t}/settings/notify/email/${s}/`),!0}catch(e){throw i.splice(a,0,n),e}return!0}async setEmailUTM(e){e=e?1:0;const t=flexbe.vars.group.id,s=await ii(`/admin/api/project/${t}/settings/notify/email_send_utm/`,{data:{notify_email_send_utm:e}});return this.state.notify_email_send_utm=e,s}async setTelegramUTM(e){e=e?1:0;const t=await ii(`/admin/api/project/${flexbe.vars.group.id}/settings/notify/telegram_send_utm/`,{data:{notify_telegram_send_utm:e}});return this.state.notify_telegram_send_utm=e,t}async setSiplified(e){e=e?1:0;const t=flexbe.vars.group.id,s=await ii(`/admin/api/project/${t}/settings/notify/sms_save/`,{data:{notify_sms_light:e}});return this.state.notify_sms_light=e,s}async removePhone(e){const t=this.state.phones,s=t.splice(e,1)[0],i=flexbe.vars.group.id,a=s.id;if(s.id)try{return await ni(`/admin/api/project/${i}/settings/notify/phone/${a}/`)}catch(i){throw t.splice(e,0,s),i}}async savePhone({index:e,id:t,phone:s}){const i=flexbe.vars.group.id,a=t?`/admin/api/project/${i}/settings/notify/phone/${t}/`:`/admin/api/project/${i}/settings/notify/phone/`,n=await ii(a,{data:{phone:s}});return n&&n.data&&this.updatePhone(e,{id:n.data.id,phone:s,changed:!1}),n}async disconnectTelegram(e){const t=flexbe.vars.group.id,s=await ni(`/admin/api/project/${t}/settings/notify/telegram/${e}/`);return s.is_success&&delete this.state.telegram.accounts[e],s}}class Sc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/optimization/`,this.mutations={setImageOptions:e=>{this.state.images=e},setOptimizationOptions:e=>{this.state.optimization=e}},this.actions={setImageOptions:async e=>{const t=h(this.state.images);this.commit("setImageOptions",e);try{return await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{images:e}}})}catch(e){throw this.commit("setImageOptions",t),e}},setOptimizationOptions:async e=>{const t=h(this.state.optimization);this.commit("setOptimizationOptions",e);try{return await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{optimization:e}}})}catch(e){throw this.commit("setOptimizationOptions",t),e}}}}}class $c extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/verify/`,this._uploadFilePath=`/admin/api/project/${flexbe.vars.group.id}/settings/verify/upload/`}addFile(e){this.state.files.find((t=>t.p_name===e.file))||this.state.files.push({p_id:e.p_id,p_uri:e.file,p_name:e.file})}removeFile(e){this.state.files=this.state.files.filter((t=>t.p_id!=e))}async removeFileAction({id:e}){const t=`/admin/api/project/${flexbe.vars.group.id}/settings/verify/remove/${e}/`,s=await ni(t);return this.removeFile(e),s}async saveMetaCode(e){const t=await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{seo_meta:e}}});return this.state.seo_meta=e,t}}class Bc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/robots/`,this.mutations={setCanonical:e=>{this.state.seo_canonical=e},setRobots:e=>{this.state.robots_txt=e}},this.actions={toggleCanonical:async e=>{const t=this.state.seo_canonical||0;e=e?1:0,this.commit("setCanonical",e);try{return await ii(`/admin/api/project/${flexbe.vars.group.id}/settings/seo_canonical/`,{data:{value:e}})}catch(e){throw this.commit("setCanonical",t),e}},saveRobots:async e=>{const t=await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{seo_robots_txt:e}}});return this.commit("setRobots",e),t}}}}class Uc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/ai/`,this.mutations={saveAiContextProduct:e=>{this.state.context.product=e},saveAiContextAudience:e=>{this.state.context.audience=e},saveAiContextGoal:e=>{this.state.context.goal=e},saveAiModel:e=>{this.state.context.model=e}},this.actions={saveAiModel:async e=>{const t=await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{abortPrev:!1,data:{set_data:{ai:{model:e}}}});return this.commit("saveAiModel",e),t},saveAiContextProduct:async e=>{const t=await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{abortPrev:!1,data:{set_data:{ai:{context:{product:e}}}}});return this.commit("saveAiContextProduct",e),t},saveAiContextAudience:async e=>{const t=await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{abortPrev:!1,data:{set_data:{ai:{context:{audience:e}}}}});return this.commit("saveAiContextAudience",e),t},saveAiContextGoal:async e=>{const t=await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{abortPrev:!1,data:{set_data:{ai:{context:{goal:e}}}}});return this.commit("saveAiContextGoal",e),t}}}}class Rc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/access/`}updateUser(e,t){this.state.members=this.state.members.map((s=>s.id==e&&s?Object.assign(s,t):s))}async toggleAccess({user:e,groupId:t,state:s}){s=s?1:0;const i=await ii(`/admin/api/project/${flexbe.vars.group.id}/member/toggle_access/${e.id}/`,{data:{state:s,group_id:t,role:e.role}});return this.updateUser(e.id,{has_access:s}),i}}class Pc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/legal/`,this.mutations={setPersonalData:e=>{this.state.policy_personal_data=e},setCookiesData:e=>{this.state.cookies_warning=e}},this.actions={updatePersonalData:async e=>{const t=h(this.state.policy_personal_data);this.commit("setPersonalData",e);try{return await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{policy_personal_data:e}}})}catch(e){throw this.commit("setPersonalData",t),e}},removePolicyFile:async e=>{const t=h(this.state.policy_personal_data);this.commit("setPersonalData",e);try{return await ni(`/admin/api/project/${flexbe.vars.group.id}/settings/policy/`)}catch(e){throw this.commit("setPersonalData",t),e}},updateCookiesData:async e=>{const t=h(this.state.cookies_warning);try{var s;const t=await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_set/`,{data:{set_data:{cookies_warning:{show:e.show?1:0,style:null!=(s=e.style)?s:"right_bottom",use_policy:e.use_policy?1:0,dont_set_if_not_agree:e.dont_set_if_not_agree?1:0,use_custom_warning_text:e.use_custom_warning_text?1:0,policy_uri:e.show&&e.use_policy?e.policy_uri:"",link_text:e.show&&e.use_policy?e.link_text:"",custom_warning_text:e.show&&e.use_custom_warning_text?e.custom_warning_text:"",button_text:e.show&&e.use_custom_warning_text&&"center_compact"!==e.style?e.button_text:""}}}});return this.commit("setCookiesData",e),t}catch(e){throw this.commit("setCookiesData",t),e}}}}}const Hc={content:"editor::fonts::name_content",quote:"editor::fonts::name_quote",subtitle:"editor::fonts::name_subtitle",title:"editor::fonts::name_title","title-main":"editor::fonts::name_title_main"};class jc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/fonts/`,this.normalizeState=e=>{const t={...e,set:e.set||[],my_fonts:e.my_fonts||[]},s=t.set.findIndex((e=>"content"===e.type));return s>0&&t.set.splice(0,0,t.set.splice(s,1)[0]),t.set=t.set.map((t=>{const{source:s}=t;if(delete t._removed,"user"===s){const s=e.my_fonts.find((e=>`user:${e.id}`===t.fontId||e.id===t.id));s?t.family=s.name:t._removed=!0}return t.title||(t.title=tr(Hc[t.type])),t})),t},this.mutations={setFontsSet:e=>{this.extendState({set:e})},setMyFontsList:e=>{this.extendState({my_fonts:e})},setFontForType:(e,t)=>{const s=h(this.state.set),i=s.find((t=>t.type===e));return i||console.warn("Target font not found"),i.fontId=t.fontId,i.family=t.family,i.source=t.source,i.variants=t.variants,i.fallback=t.fallback,delete i.subsets,this.commit("setFontsSet",s),s}},this.actions={saveFontsSet:async(e=this.state.set)=>{await Zd.saveProjectFontsSet(e),this.commit("setFontsSet",e)},selectFont:async(e,t)=>{const s=h(this.state.set),i=this.commit("setFontForType",e,t);try{this.dispatch("saveFontsSet",i)}catch(e){throw this.commit("setFontsSet",s),e}},updateMyFontsList:async e=>(e=e.map((e=>(e.variants=(e.variants||[]).slice().sort(((e,t)=>e.weight<t.weight?-1:1)),e))),await Zd.saveMyFontsList(e),this.commit("setMyFontsList",e),e),updateFontInMyFonts:async(e,t)=>{const s=[...this.state.my_fonts],i=s[e];return i.name=t.name,i.variants=t.variants,this.dispatch("updateMyFontsList",s)},addToMyFonts:async e=>{const t=[...this.state.my_fonts];let s=e.id||e.name.replace(/\s/g,"_").toLowerCase();return t.find((e=>e.id===s))&&(s=`${s}:${Math.ceil(100*Math.random())}`),t.push({id:s,name:e.name,variants:e.variants}),this.dispatch("updateMyFontsList",t)},removeFromMyFonts:async e=>{const t=[...this.state.my_fonts];return t.splice(e,1),this.dispatch("updateMyFontsList",t)}}}}class Fc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings_api/injectcode/`}setCode(e,t){this.state[e]=t}async saveCode(e,t){const s=await ii(`/admin/api/project/${flexbe.vars.group.id}/settings_api/injectcode/${e}/`,{abortPrev:!1,data:JSON.stringify(t)});return this.setCode(e,t),s}}class Lc extends oo{constructor(...e){super(...e),this.errors=new Ys,this.loadStateRoute=({routeArgs:e})=>{const t=e&&e.params||flexbe.routing.params;return`/admin/api/project/${flexbe.vars.group.id}/settings/pay/service/${t.service_name}/`},this.helpers={getField:e=>{var t;if(null!=(t=this.state)&&t.settings)return xt(this.state.settings,e)},setField:(e,t)=>{_t(this.state.settings,e,t),this.errors.reset(e)}},this.mutations={toggleService:e=>{this.state.active=e?1:0},setField:(e,t)=>{this.helpers.setField(e,t)},formSaved:()=>{},updateService:e=>{this.loadState({state:e})},formErrors:e=>{"object"==typeof e&&(e=Object.keys(e).map((t=>e[t]))),this.errors.update(e)},resetErrors:()=>{this.errors.resetAll()}},this.actions={toggleService:async e=>{e=e?1:0;const t=await this.api[e?"enable":"disable"]({data:{active:e}});return this.commit("updateService",t),this.commit("toggleService",e),t},saveSettings:async()=>{const e=this.state.settings;let t;this.commit("resetErrors");try{t=await this.api.update({data:{settings:e}}),this.commit("formSaved"),this.commit("updateService",t)}catch(e){throw"FormError"===e.name&&this.commit("formErrors",e.data.violations),e}return t}},this.api={get:async({service:e=this.activeService}={})=>ii(`/admin/api/project/${flexbe.vars.group.id}/settings/pay/service/${e}/`),update:async({data:e,service:t=this.activeService}={})=>ii(`/admin/api/project/${flexbe.vars.group.id}/settings/pay/service/${t}/update/`,{data:e}),enable:async({service:e=this.activeService}={})=>ii(`/admin/api/project/${flexbe.vars.group.id}/settings/pay/service/${e}/status/`,{data:{active:1}}),disable:async({service:e=this.activeService}={})=>ii(`/admin/api/project/${flexbe.vars.group.id}/settings/pay/service/${e}/status/`,{data:{active:0}})}}get activeService(){return flexbe.routing.params.service_name}}class Nc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/pay/`,this._modules={service:Lc},this.helpers={findService:e=>(this.state.list||[]).find((t=>t.name===e))},this.getters={list:()=>{const e=(this.state.list||[]).filter((e=>e.active));return h(e)},services:()=>{const e=(this.state.list||[]).filter((e=>!e.active)).map((e=>({...e.info,name:e.name})));return h(e)}},this.mutations={toggleServiceActive:({service:e,active:t})=>{const s=this.helpers.findService(e);if(!s)return!1;s.active=t?1:0}},this.actions={disableService:async e=>{const t=this.getModule("service"),s=await t.api.disable({service:e});return this.commit("toggleServiceActive",{service:e,active:0}),s}}}}class Mc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/api/`}getHook(e){return(this.state.hooks||[])[e]}setHook(e,t){const s=this.getHook(e);return null==s.saved&&(s.saved=s.url),Object.entries(t).forEach((([e,t])=>{s[e]=t})),s.changed=s.url!==s.saved,s}addHook(e){const t=Object.assign({url:""},e);return this.state.hooks.push(t),t}async resetApiKey(){const e=await ii(`/admin/api/project/${flexbe.vars.group.id}/settings/api/reset/`);return this.state.api_key=e.data.api_key,e}async saveHook(e,t){const s=flexbe.vars.group.id,i=t.id?`/admin/api/project/${s}/settings/api/hook/${t.id}/`:`/admin/api/project/${s}/settings/api/hook/`,a=await ii(i,{data:{webhook:t.url}});return this.setHook(e,{id:a.data.id,url:a.data.url,saved:a.data.url}),a}async removeHook(e){const t=flexbe.vars.group.id,s=this.state.hooks.splice(e,1)[0];if(s&&s.id)try{await ni(`/admin/api/project/${t}/settings/api/hook/${s.id}/`)}catch(t){throw this.state.hooks.splice(e,0,s),t}return s}}class Dc extends oo{constructor(...e){super(...e),this.loadStateRoute=({routeArgs:e})=>{const t=(e&&e.params||flexbe.routing.params).category;return`/admin/api/project/${flexbe.vars.group.id}/integration/category/${t}/`},this.normalizeState=e=>({stage:null,...e}),this.getters={connected:()=>he(this.state.connected,(e=>e.instance_id))},this.mutations={extendStage:(e={})=>{if(!e||!Object.keys(e).length)return;const t={...this.state.stage,...e},s=ft(this.state,{stage:t});this.extendState(s)},setStagePart:(e,t)=>{this.mutations.extendStage({[e]:t})},setField:({integrationId:e,name:t,value:s},i=!1)=>{const a=this.getters.connected[e];a&&(i?ft(a.settings,{[t]:s}):_t(a.settings,t,s),this.mutations.setChanged({integrationId:e,state:!0}))},setError:({integrationId:e,name:t,error:s,errorLevel:i})=>{const a=this.getters.connected[e];a&&("object"!=typeof a.errors&&(a.errors={}),a.errors[t]={error:s,errorLevel:i})},setChanged:({integrationId:e,state:t})=>{const s=this.getters.connected[e];s&&(s.is_changed=t?1:0)},setPending:({integrationId:e,state:t})=>{const s=this.getters.connected[e];s&&(s.is_pending=t?1:0)},setEnabled:({integrationId:e,state:t})=>{const s=this.getters.connected[e];s&&(s.is_enabled=t?1:0)},setInstanceErrors:({integrationId:e,errors:t=[]})=>{const s=this.getters.connected[e];s&&(s.data.errors=[...t])},removeInstance:e=>{const t=this.state.connected.findIndex((t=>e===t.instance_id));this.state.connected.splice(t,1)},updateData:(e,t)=>{this.extendState({connected:e.connected,available:e.available}),this.extendMeta({...t})}},this.actions={connect:async(e,t)=>{const s=await this.api.connect(e,t);return this.commit("updateData",s.data,s.meta),this.skipNextUpdate=!0,setImmediate((()=>{this.skipNextUpdate=!1})),s.data},disconnect:async e=>{const t=await this.api.disconnect(e);return this.commit("removeInstance",e),this.state.connected.length?this.commit("updateData",t.data,t.meta):this.commit("updateData",{available:t.data.available},t.meta),t.data},updateInstance:async(e,t,s=!1)=>{this.commit("setPending",{integrationId:e,state:!0}),this.commit("setChanged",{integrationId:e,state:!1});try{const i=await this.api.updateInstance(e,t);return s&&this.commit("updateData",i.data,i.meta),i}catch(t){throw this.commit("setChanged",{integrationId:e,state:!0}),t}finally{this.commit("setPending",{integrationId:e,state:!1})}},setEnabled:async(e,t)=>{const s=this.getters.connected[e],i=null==s?void 0:s.is_enabled;this.commit("setEnabled",{integrationId:e,state:t}),this.commit("setInstanceErrors",{integrationId:e,errors:[]});try{return await this.api.setEnabled(e,t)}catch(t){throw this.commit("setEnabled",{integrationId:e,state:i}),t}},addInstanceError:async(e,t={})=>{var s;const i=this.getters.connected[e],a=null==i||null==(s=i.data)?void 0:s.errors;this.commit("setInstanceErrors",{integrationId:e,errors:[t]});try{return await this.api.addInstanceError(e,t)}catch(t){throw this.commit("setInstanceErrors",{integrationId:e,errors:a}),t}}},this.api={get:(e=flexbe.routing.params.category)=>{if(!e)return Promise.reject(new Error("Specify category name"));return ai(`/admin/api/project/${flexbe.vars.group.id}/integration/category/${e}/`)},connect:(e,t={})=>ii(`/admin/api/project/${flexbe.vars.group.id}/integration/${e}/connect/`,{data:{settings:t}}),disconnect:e=>ii(`/admin/api/integration/${e}/disconnect/`),updateInstance:(e,t={})=>ii(`/admin/api/integration/${e}/`,{data:t}),setEnabled:(e,t)=>ii(`/admin/api/integration/${e}/toggle/`,{data:{is_enabled:t?1:0}}),addInstanceError:(e,t={})=>ii(`/admin/api/integration/${e}/addError/`,{data:t})}}}class Vc extends Dc{constructor(...e){super(...e),this.mutations={...this.mutations,setField:({domainId:e,name:t,value:s})=>{const i=this.getters.domainsById[e];i&&(_t(i,["mail_settings",t],s),this.mutations.setChanged({domainId:e,state:!0}))},updateData:(e,t)=>{this.extendState({connected:e.connected,available:e.available}),this.extendMeta({...t})},setChanged:({domainId:e,state:t})=>{const s=this.getters.integrationByDomainId[e];s&&(s.is_changed=t?1:0)},setError:({domainId:e,name:t,error:s})=>{const i=this.getters.integrationByDomainId[e];i&&("object"!=typeof i.errors&&(i.errors={}),i.errors[t]=s)},resetErrors:({domainId:e})=>{const t=this.getters.integrationByDomainId[e];t&&(t.errors={})}},this.getters={...this.getters,domains:()=>{const e=bt(this.meta.domains||[]),t=bt(this.state.connected||[]);return e.map((e=>{const s=t.find((t=>String(t.settings.domain_id)===String(e.domain_id)));return s&&(s.settings={...s.settings,...e.mail_settings}),e.integration=s,delete e.mail_service,delete e.mail_settings,e}))},domainsById:()=>he(this.meta.domains,(e=>e.domain_id)),integrationByDomainId:()=>{const e=this.state.connected||[];return this.meta.domains.reduce(((t,s)=>{const i=s.domain_id,a=e.find((e=>String(e.settings.domain_id)===String(i)));return{...t,[i]:a}}),{})}},this.actions={...this.actions,updateInstance:async(e,t,s)=>{this.commit("setPending",{integrationId:t,state:!0}),this.commit("setChanged",{domainId:e,state:!1});try{return await this.api.updateInstance(t,s)}catch(t){throw this.commit("setChanged",{domainId:e,state:!0}),t}finally{this.commit("setPending",{integrationId:t,state:!1})}}}}}class Oc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings_api/ecommerce/`,this.getters={},this.helpers={},this.mutations={updateEcommerceStoreSettings:e=>{this.state={...this.state,...e}}},this.actions={updateEcommerceStoreSettings:async e=>{const t=h(this.state);this.commit("updateEcommerceStoreSettings",e);try{return await this.api.updateSettings(e)}catch(e){throw this.commit("updateEcommerceStoreSettings",t),e}}},this.api={async updateSettings(e){const t=`/admin/api/project/${flexbe.vars.group.id}/settings_api/ecommerce/`;return await ii(t,{asJson:!0,data:e})}}}}class zc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings_api/ecommerce/`,this.getters={list:()=>this.state.delivery||[]},this.helpers={findIndex:e=>this.getters.list.findIndex((t=>t.id===e))},this.mutations={setStatus:e=>{this.state.status=e},updateList:e=>{if(!Array.isArray(e))throw new Error("updateList: newList is not if type Array!");this.state.delivery=e},addItem:e=>{Array.isArray(this.state.delivery)||this.mutations.updateList([]),this.state.delivery.push(e)},updateItem:(e,t)=>{const s=this.helpers.findIndex(e);return s>=0&&(this.state.delivery.splice(s,1,t),!0)}},this.actions={createMethod:async e=>{this.commit("addItem",e),await this.api.update(this.getters.list)},updateMethod:async(e,t)=>{this.commit("updateItem",e,t),await this.api.update(this.getters.list)},removeMethod:async e=>{const t=this.getters.list||[],s=this.helpers.findIndex(e);s>=0&&t.splice(s,1),this.commit("updateList",t),await this.api.update(t)},updateList:async e=>{this.commit("updateList",e),await this.api.update(e)}},this.api={async update(e={}){const t=`/admin/api/project/${flexbe.vars.group.id}/settings_api/ecommerce/delivery/`;return await ii(t,{asJson:!0,data:e})}}}}class qc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/promotion/`,this.getters={promotionList:()=>this.state.promotion||[],discountsList:()=>this.state.promotion.map((e=>"discount"===e.type?this.helpers.normalizeData({...e}):null)).filter((e=>e)),promoCodesList:()=>this.state.promotion.map((e=>"promocode"===e.type?this.helpers.normalizeData({...e}):null)).filter((e=>e)),codeList:()=>this.state.promotion.filter((e=>e.code)).map((e=>e.code))||[],promotionsLimit:()=>200,limitExceeded:()=>this.state.promotion.length>=200},this.helpers={normalizeData:e=>(["date_from","date_to"].forEach((t=>{e[t]&&(e[t]=e[t].slice(0,19))})),e),findIndex:e=>this.getters.promotionList.findIndex((t=>t.id===e)),getStatus(e){const t=flexbe.vars.group.timezone,s=Ze({format:"milliseconds",date:Date.now(),timezone:t}),i=new Date(We(e.date_from)),a=new Date(We(e.date_to));return e.active?e.date_to&&a<s||0===e.available_count?"expired":e.date_from&&i>s?"planed":"active":"disabled"},isUniquePromocode:e=>{const t=this.getters.codeList||[];return(e=e.toUpperCase())&&t&&-1===t.indexOf(e)},generatePromocode(e=6){const t="QAZXSWEDCVFRTGBNHYUJMKIOLP",s="1234567890";return new Array(e).fill(null).map(((i,a)=>a<e/3?t[Math.floor(Math.random()*t.length)]:s[Math.floor(Math.random()*s.length)])).join("")}},this.mutations={updateList:e=>{this.state.promotion=e},addItem:e=>{this.state.promotion.push(e),this.mutations.sortByStatus()},updateItem:(e,t)=>{const s=this.helpers.findIndex(e);return s>=0&&(this.state.promotion.splice(s,1,t),this.mutations.sortByStatus(),!0)},sortByStatus:()=>{const e={discounts:bt(this.getters.discountsList),promoCodes:bt(this.getters.promoCodesList)};Object.keys(e).forEach((t=>{const s=e[t],i={active:[],active_from:[],active_count:[],active_count_from:[],planed:[],expired:[],expired_count:[],disabled:[]};s.forEach((e=>{switch(this.helpers.getStatus(e)){case"active":e.date_to?e.applies?i.active_count_from.push(e):i.active_from.push(e):e.applies?i.active_count.push(e):i.active.push(e);break;case"planed":i.planed.push(e);break;case"expired":0===e.applies?i.expired_count.push(e):i.expired.push(e);break;case"disabled":i.disabled.push(e)}})),"discounts"===t&&Object.keys(i).forEach((e=>{i[e].sort(((e,t)=>e.active_from-t.active_from))})),e[t]=[...i.active,...i.active_count,...i.active_from,...i.active_count_from,...i.planed,...i.expired,...i.expired_count,...i.disabled]})),this.state.promotion=Object.values(e).flat()}},this.actions={createPromotion:async e=>{const t=await this.api.createPromotion(e);this.commit("addItem",this.helpers.normalizeData(t),"promotion")},updatePromotion:async(e,t)=>{await this.api.updatePromotion(e,t),this.commit("updateItem",e,t,"promotion")},removePromotion:async e=>{const t=this.getters.promotionList||[];await this.api.removePromotion(e);const s=this.helpers.findIndex(e);s>=0&&t.splice(s,1),this.commit("updateList",t)}},this.api={async createPromotion(e={}){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/promotion/`;return(await ii(t,{asJson:!0,data:e})).data},async updatePromotion(e,t={}){const s=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/promotion/${e}/`;return(await oi(s,{asJson:!0,data:t})).data},async removePromotion(e){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/promotion/${e}/`;return(await ni(t)).data}}}}var Gc,Xc;let Kc=(Xc=Vt((Gc=class extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/settings/notification/visitor/`,this._uploadFilePath=`/admin/api/project/${flexbe.vars.group.id}/settings/notification/visitor/image/`,Dt(this,"statusSaved",Xc,this),this.helpers={getNewItem:(e,t)=>({...bt(this.state[e]),...t})},this.mutations={updateImage:e=>{this.state.image=e},setSettings:(e,t)=>{this.state[e]=t}},this.actions={saveState:async()=>{await this.api.updateSettings(this.state)},changeNotificationItem:async(e,t)=>{const s=bt(this.state[e]);this.commit("setSettings",e,this.helpers.getNewItem(e,t)),this.statusSaved="saving";try{await this.api.updateSettings(this.state),this.statusSaved="success"}catch(t){throw this.commit("setSettings",e,s),this.statusSaved="error",t}}},this.api={async updateSettings(e={}){const t=`/admin/api/project/${flexbe.vars.group.id}/settings/notification/visitor/`;return(await ii(t,{asJson:!0,data:e})).data},async deleteFile(){const e=`/admin/api/project/${flexbe.vars.group.id}/settings/notification/visitor/image/`;return await ni(e)},async sendTestNotification(e){const t=`/admin/api/project/${flexbe.vars.group.id}/settings/notification/test_sending/`;return await ii(t,{asJson:!0,data:e})},async getNotificationTemplate(e){const t=`/admin/api/project/${flexbe.vars.group.id}/settings/notification/template/`;return await ii(t,{asJson:!0,data:e,contentType:"text/html",dataType:"text"})}}}}).prototype,"statusSaved",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"saved"}}),Gc);class Wc extends oo{constructor(...e){super(...e),this._modules={general:wc,domains:Ic,notify:Cc,optimization:Sc,verify:$c,robots:Bc,ai:Uc,access:Rc,legal:Pc,code:Fc,pay:Nc,api:Mc,integrations:Dc,domainMailing:Vc,ecommerce:Oc,delivery:zc,promo:qc,fonts:jc,notification:Kc,redirect:ho}}}class Zc extends oo{constructor(...e){super(...e),this.getters={categoryList:()=>{var e;return null!=(e=this.state.items)?e:[]},allProducts:()=>{var e;return null!=(e=this.state.allProductsCount)?e:0}},this.helpers={findCategoryIndex:e=>this.getters.categoryList.findIndex((t=>t.id===e)),categoryListFilter:e=>this.getters.categoryList.filter((t=>t.name.toLowerCase().includes(e.toLowerCase())))},this.mutations={updateCategoryList:e=>{if(!Array.isArray(e))throw new Error("updateList: newList is not if type Array!");this.state.items=e},addCategoryItem:e=>{Array.isArray(this.state.items)||this.mutations.updateCategoryList([]),this.state.items.push(e)},allProductsCount:e=>{this.state.allProductsCount=e},updateCategoryItem:(e,t)=>{const s=this.helpers.findCategoryIndex(e);return s>=0&&(this.state.items.splice(s,1,t),!0)}},this.actions={getCategoryList:async()=>{try{const e=await this.api.getCategory();this.commit("updateCategoryList",e.data.items),this.commit("allProductsCount",e.meta.countProducts)}catch(e){toast.error(e.message)}},createCategory:async e=>{const t=h(this.state.items);try{const t=await this.api.createCategory(e);return this.commit("addCategoryItem",t),toast.success(tr("admin::ecommerce::category::create_toast")),t}catch(e){this.commit("updateCategoryList",t),toast.error(e.message)}},updateCategory:async(e,t)=>{const s=h(this.state.items);try{const s=await this.api.updateCategory(e,t);this.commit("updateCategoryItem",e,s),toast.success(tr("admin::ecommerce::category::edited_toast"))}catch(e){this.commit("updateCategoryList",s),toast.error(e.message)}},hideCategory:async e=>{const t=h(this.state.items);try{const t=this.getters.categoryList||[];e.visible=0,await this.api.updateCategory(e.id,e),t.forEach((t=>{e.id===t.id&&(t.visible=0)})),this.commit("updateCategoryList",t),toast.success(tr("admin::ecommerce::category::hide_toast",{name:e.name}))}catch(e){this.commit("updateCategoryList",t),toast.error(e.message)}},showCategory:async e=>{const t=h(this.state.items);try{const t=this.getters.categoryList||[];e.visible=1,await this.api.updateCategory(e.id,e),t.forEach((t=>{e.id===t.id&&(t.visible=1)})),this.commit("updateCategoryList",t),toast.success(tr("admin::ecommerce::category::show_toast",{name:e.name}))}catch(e){this.commit("updateCategoryList",t),toast.error(e.message)}},removeCategory:async e=>{const t=h(this.state.items),s=this.getters.categoryList||[],i=this.helpers.findCategoryIndex(e.id);i>=0&&s.splice(i,1);try{await this.api.removeCategory(e.id,e.deleteProducts),this.commit("updateCategoryList",s),toast.success(tr("admin::ecommerce::category::delete_toast",{name:e.name}))}catch(e){this.commit("updateCategoryList",t),toast.error(e.message)}},sortCategory:async(e,t,s)=>{const i=h(this.state.items);try{await this.api.sortCategory(e,t),this.commit("updateCategoryList",s)}catch(e){this.commit("updateCategoryList",i),toast.error(e.message)}}},this.api={async getCategory(){const e=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/category/list/?showHidden=1`;return await ai(e)},async createCategory(e={}){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/category/add/`;return(await ii(t,{asJson:!0,data:e})).data},async updateCategory(e,t={}){const s=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/category/${e}/`;return(await ii(s,{asJson:!0,data:t})).data},async removeCategory(e,t={}){const s=t.deleteProducts?1:0,i=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/category/${e}/?deleteProducts=${s}`;return(await ni(i)).data},async sortCategory(e,t){const s=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/category/sort/`;return(await ii(s,{asJson:!0,data:{category_id:e,category_id_after:t}})).data}}}}class Yc extends oo{constructor(...e){super(...e),this._state={loading:!1,params:{page:1,countOnPage:25}},this.getters={productList:()=>{var e;return null!=(e=this.state.items)?e:[]},totalCount:()=>{var e;return null!=(e=this.state.totalCount)?e:0},currentPage:()=>{var e;return null!=(e=this.state.currentPage)?e:1}},this.mutations={updateProductList:e=>{if(!Array.isArray(e))throw new Error("updateList: newList is not if type Array!");this.state.items=e},updateTotalCount:e=>{if(!Number.isInteger(+e))throw new Error("updateTotalCount: newCount is not if type integer!");this.state.totalCount=+e,this.state.totalPages=Math.ceil(e/this.state.perPage)},setLoading:e=>{this.extendState({loading:e})},setSearchLoading:e=>{this.extendState({searchLoading:e})},setSearch:e=>{this.extendState({search:e})},resetState:()=>{this.extendState({loading:!1,params:{page:1,countOnPage:25}})}},this.actions={toggleLoader:e=>{this.commit("setLoading",e)},setSearch:e=>{this.commit("setSearch",e)},setParams:(e,t,s="replace")=>{if(this.state.params={...t?{}:this.state.params,...e},this.state.params.product||delete this.state.params.product,this.state.params.page||(this.state.params.page=1),this.state.params.countOnPage||(this.state.params.countOnPage=25),this.state.urlParams=ye(this.state.params,!0),this.state.perPage=this.state.params.countOnPage,this.state.currentPage=this.state.params.page,this.state.totalPages=Math.ceil(this.state.totalCount/this.state.perPage),s){const e=`${location.pathname}?${this.state.urlParams}`;"push"===s?history.pushState(null,"",e):history.replaceState(null,"",e)}},sortProducts:async(e,t,s,i)=>{const a=h(this.state.items);try{await this.api.sortProducts({productIds:e,categoryId:t,position:s}),this.commit("updateProductList",i)}catch(e){this.commit("updateProductList",a),toast.error(e.message)}},updateProducts:async()=>{this.commit("setLoading",!0);try{const e=await this.api.getProductList(`?${this.state.urlParams}`);this.commit("updateProductList",e.items),this.commit("updateTotalCount",e.totalCount)}catch(e){toast.error(e.message)}this.commit("setLoading",!1)},hideProducts:async e=>{const t=h(this.state.items);try{const t=this.getters.productList||[],s=(null==e?void 0:e.products)||[];await this.api.hideProducts(e),t.filter((e=>s.includes(e.id))).forEach((e=>e.visible=0)),this.commit("updateProductList",t),toast.success(1===s.length?tr("admin::ecommerce::product::hide_toast"):tr("admin::ecommerce::products::hide_toast"))}catch(e){this.commit("updateProductList",t),toast.error(e.message)}},showProducts:async e=>{const t=h(this.state.items);try{const t=this.getters.productList||[],s=(null==e?void 0:e.products)||[];await this.api.showProducts(e),t.filter((e=>s.includes(e.id))).forEach((e=>e.visible=1)),this.commit("updateProductList",t),toast.success(1===s.length?tr("admin::ecommerce::product::show_toast_copy"):tr("admin::ecommerce::products::show_toast_copy"))}catch(e){this.commit("updateProductList",t),toast.error(e.message)}},changeCurrentPage:()=>{!this.state.items.length&&this.state.totalPages>1&&(this.dispatch("setParams",{page:this.state.totalPages}),this.dispatch("updateProducts"))},deleteProducts:async e=>{try{const t=(null==e?void 0:e.id)||[];await this.api.deleteProducts(e);const s=await this.api.getProductList(`?${this.state.urlParams}`);this.commit("updateTotalCount",s.totalCount),this.commit("updateProductList",s.items),this.dispatch("changeCurrentPage"),toast.success(1===t.length?tr("admin::ecommerce::product::delete_toast"):tr("admin::ecommerce::products::delete_toast"))}catch(e){toast.error(e.message)}},restoreProducts:async e=>{try{await this.api.restoreProducts(e);const t=await this.api.getProductList(`?${this.state.urlParams}`);this.commit("updateTotalCount",t.totalCount),this.commit("updateProductList",t.items),this.dispatch("changeCurrentPage"),toast.success("Restored")}catch(e){toast.error(e.message)}},removeProductsFromCategory:async(e,t)=>{const s=h(this.state.items);try{await this.api.removeProductsFromCategory({ids:e,categoryId:t});const s=this.state.items.filter((t=>!e.includes(t.id))),i=e.length;this.commit("updateProductList",s),toast.success(tr("admin::ecommerce::product_from_category::delete_toast",{count:i}))}catch(e){this.commit("updateProductList",s),toast.error(e.message)}},addProductsFromCategory:async(e,t)=>{try{await this.api.addProductsFromCategory({ids:e,categoriesId:t});const s=e.length;return toast.success(tr("admin::ecommerce::product_from_category::add_toast",{count:s})),!0}catch(e){return toast.error(e.message),!1}}},this.api={async getProductList(e){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/list/${e}`;return(await ai(t)).data},async hideProducts(e){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/bulk/hide/`;return(await ii(t,{asJson:!0,data:e})).data},async showProducts(e){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/bulk/show/`;return(await ii(t,{asJson:!0,data:e})).data},async deleteProducts(e){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/bulk/remove/`;return(await ni(t,{asJson:!0,data:e})).data},async restoreProducts(e){const t=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/bulk/restore/`;return(await ii(t,{asJson:!0,data:e})).data},async sortProducts({productIds:e,categoryId:t,position:s}){const i=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/${e[0]}/${s}/${e[1]}/`;return(await ri(i,{asJson:!0,data:{categoryId:t}})).data},async removeProductsFromCategory({ids:e,categoryId:t}){const s=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/category/unbind/`;return(await ii(s,{asJson:!0,data:{products:e,categories:[t]}})).data},async addProductsFromCategory({ids:e,categoriesId:t}){const s=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/product/category/bind/`;return(await ii(s,{asJson:!0,data:{products:e,categories:t}})).data}}}}class Jc extends oo{constructor(...e){super(...e),this.loadStateRoute=`/admin/api/project/${flexbe.vars.group.id}/ecommerce/`,this._modules={categories:Zc,products:Yc}}}class Qc extends oo{constructor(...e){super(...e),this.loadStateRoute="/admin/api/user/",this.mutations={updateData:(e={})=>{const t=ft(this.state,e);this.extendState(t)}},this.actions={saveData:async(e={})=>{const t=h(this.state);this.commit("updateData",e);try{return(await this.api.save(e)).data}catch(e){throw this.commit("updateData",t),e}},saveSubscriptions:async({unsubscribe:e})=>{const t=h(this.state);this.commit("updateData",{unsubscribed:[...e]});try{return(await this.api.save({unsubscribe:e})).data}catch(e){throw this.commit("updateData",t),e}}},this.api={save:(e={})=>ii("/admin/api/user/",{data:e})}}}class ep extends oo{constructor(...e){super(...e),this._modules={profile:Qc}}}class tp extends oo{constructor(...e){super(...e),this.onAfterInit=()=>{const e=Mn.get("admin-view-mode"),t=Mn.get("admin-project-filters");this.state.view=e||"grid",this.mutations.setFilters({...t,..._e(window.location.search)})},this.normalizeState=e=>{const{shared:t,list:s,...i}=e;return{loading:!1,accessConfig:{owner:["create","draft","rename"],admin:["create","draft","rename"],editor:["rename"],manager:[]},initialProjects:{},projects:{},filters:{type:"all",sort:{name:"domain",value:"asc"}},view:"grid",...i}},this.getters={filteredProjectsList:()=>{if(!this.state.projects)return{personal:[],share:[],old:[],transfer_request:[]};const e={},t=this.state.filters;return Object.entries(this.state.projects).forEach((([s,i])=>{["shared","list"].includes(s)||(i=bt(i),"share"===s?i.forEach((e=>{e.projects=this.helpers.applyFilters(e.projects,t)})):i=this.helpers.applyFilters(i,t),e[s]=i)})),e},publishedPersonalProjects:()=>{var e,t;return(null==(e=this.state.projects)||null==(t=e.personal)?void 0:t.filter((e=>!e.is_draft)))||[]},draftPersonalProjects:()=>{var e,t;return(null==(e=this.state.projects)||null==(t=e.personal)?void 0:t.filter((e=>e.is_draft)))||[]},filteredPublishedPersonalProjects:()=>{var e;return(null==(e=this.getters.filteredProjectsList.personal)?void 0:e.filter((e=>!e.is_draft)))||[]},filteredDraftPersonalProjects:()=>{var e;return(null==(e=this.getters.filteredProjectsList.personal)?void 0:e.filter((e=>e.is_draft)))||[]},fullList:()=>[...this.state.projects.personal,...this.state.projects.transfer_request,...this.state.projects.share.map((({projects:e})=>e)).flat(),...this.state.projects.old],filteredFullList:()=>[...this.getters.filteredProjectsList.personal,...this.getters.filteredProjectsList.transfer_request,...this.getters.filteredProjectsList.share.map((({projects:e})=>e)).flat(),...this.getters.filteredProjectsList.old],limitExceeded:()=>this.getters.publishedPersonalProjects.length>=+flexbe.bill.domainLimit,draftLimitExceeded:()=>this.getters.draftPersonalProjects.length>=+(flexbe.bill.draftLimit||100),visibleCount:()=>this.getters.filteredFullList.length},this.helpers={hasSubstring:(e,t)=>-1!==e.toLowerCase().indexOf(t.toLowerCase()),applyFilters:(e,t)=>{const{search:s,sort:i,type:a}=t,n="domain"===i.name,r="name"===i.name,o=!!s,l=["drafts","published"].includes(a),d=n||r,c=(e,t=!1)=>{const s=e.sort(((e,t)=>("desc"===i.value&&([e,t]=[t,e]),"domain"===i.name?e.domain_title.localeCompare(t.domain_title):"name"===i.name?(e.name=e.name||"",t.name=t.name||"",e.name.localeCompare(t.name)):"create"===i.name?e.created_at-t.created_at:"update"===i.name?e.updated_at-t.updated_at:0))),a=[],o=[],l=[],d=[];return s.forEach((e=>{e.waiting_transfer?d.push(e):t?e.domain_is_reg||!n||r?e.name||!r||n?a.push(e):o.push(e):l.push(e):a.push(e)})),[...d,...a,...l,...o]};if((o||l)&&(e=e.filter((e=>(()=>!o||(e.domain_title&&this.helpers.hasSubstring(e.domain_title,s)||e.name&&this.helpers.hasSubstring(e.name,s)))()&&(!l||"drafts"===a&&e.is_draft||"published"===a&&!e.is_draft)))),i)if(d){const t=[],s=[];e.forEach((e=>(e.is_draft?s:t).push(e))),e=[...c(t,!0),...c(s,!0)]}else e=c(e);return e}},this.mutations={toggleDraft:({projectId:e,isDraft:t})=>{const s=this.getters.fullList.find((t=>t.project_id===e));s&&(s.is_draft=null!=t?t:!s.is_draft)},setFilters:e=>{e={...this.state.filters,...e},this.extendState({filters:e}),Mn.set("admin-project-filters",e)}},this.actions={toggleDraft:async({projectId:e,isDraft:t})=>{try{await this.api.toggleDraft({projectId:e,isDraft:t}),this.mutations.toggleDraft({projectId:e,isDraft:t})}catch(e){if(e&&e.response&&409===e.response.status){var s;const t=null==(s=e.response.responseJSON)?void 0:s.type_error;"draft_limit"===t?toast.error(tr("admin::bill::draft_limit::toast")):toast.error(tr("admin::bill::projects_limit::toast"))}throw e}},updateBulkIsDraft:async e=>{try{await this.api.updateBulkIsDraft(e),await this.loadProjects()}catch(e){if(e&&e.response&&409===e.response.status){var t;const s=null==(t=e.response.responseJSON)?void 0:t.type_error;"draft_limit"===s?toast.error(tr("admin::bill::draft_limit::toast")):"project_limit"===s&&toast.error(tr("admin::bill::projects_limit::toast"))}throw e}},setFilters:e=>{this.mutations.setFilters(e),window.history.pushState(null,"",`${window.location.pathname}?${ye(this.state.filters,!0)}`)},setView:({value:e})=>{this.extendState({view:e}),Mn.set("admin-view-mode",e)},addProject:async e=>{let t=null;try{t=await this.api.addProject(e),await this.loadProjects()}catch(e){if(e&&e.response&&409===e.response.status){var s;const t=null==(s=e.response.responseJSON)?void 0:s.type_error;throw"draft_limit"===t?toast.error(tr("admin::bill::draft_limit::toast")):"project_limit"===t&&toast.error(tr("admin::bill::projects_limit::toast")),e}toast.error(tr("main::error::unknown"))}return t},transferAcceptance:async({projectId:e,transferId:t})=>{if(this.getters.limitExceeded){const s=flexbe.modals.bill.resolveProjectsRestrictions({limit:flexbe.bill.domainLimit,projectData:this.state.projects.transfer_request.find((t=>t.project_id===e)),onChange:async(i,a)=>{if(!i){var n;if("replace"===a.action)await this.actions.toggleDraft({projectId:null==a||null==(n=a.data)?void 0:n.replaceProjectId,isDraft:!0});if(a){try{await this.api.transferAcceptance({projectId:e,transferId:t,changeDraft:"draft"===a.action}),await this.loadProjects()}catch(e){if(e&&e.response&&409===e.response.status){var r;const t=null==(r=e.response.responseJSON)?void 0:r.type_error;"draft_limit"===t?toast.error(tr("admin::bill::draft_limit::toast")):"project_limit"===t&&toast.error(tr("admin::bill::projects_limit::toast"))}throw e}s.close(),await this.loadProjects()}}}})}else await this.api.transferAcceptance({projectId:e,transferId:t}),await this.loadProjects()},refuseAccess:async({projectId:e})=>{await this.api.refuseAccess({projectId:e}),await this.loadProjects()},removeProject:async({projectId:e})=>{await this.api.removeProject({projectId:e}),await this.loadProjects()},transferProject:async e=>{await this.api.transferProject(e),await this.loadProjects()},cancelTransferProject:async({projectId:e})=>{await this.api.cancelTransferProject({projectId:e}),await this.loadProjects()},setProjectName:async({projectId:e,name:t})=>{this.getters.fullList.find((t=>t.project_id===e)).name=t,this.api.changeName({projectId:e,name:t})}},this.api={addProject:e=>ii("/admin/api/project/create/",{asJson:!0,data:{...e,type:e.type||"landing"}}),removeProject:({projectId:e})=>ni(`/admin/api/project/${e}/remove/`),transferAcceptance:({projectId:e,transferId:t,changeDraft:s})=>ii(`/admin/api/project/${e}/transfer/${t}/approve/`,{data:{change_draft:s}}),cancelTransferProject:({projectId:e})=>ii(`/admin/api/project/${e}/transfer/cancel/`),refuseAccess:({projectId:e})=>ii(`/admin/api/project/${e}/access/refuse/`,{data:{state:0}}),transferProject:({email:e,projectId:t})=>ii(`/admin/api/project/${t}/transfer/request/`,{data:{email:e}}),updateBulkIsDraft:e=>ii("/admin/api/project/draft/",{asJson:!0,data:e}),toggleDraft:({projectId:e,isDraft:t})=>oi(`/admin/api/project/${e}/draft/`,{asJson:!0,data:{is_draft:t}}),changeName:({projectId:e,name:t})=>oi(`/admin/api/project/${e}/name/`,{asJson:!0,data:{name:t}})}}async loadProjects(){this.state.loading=!0;const e=await ai("/admin/api/projects/");this.state.loading=!1,this.extendState(e)}}const sp=new class extends oo{constructor(...e){super(...e),this._modules={settings:Wc,user:ep,ecommerce:Jc,projects:tp}}};sp.init();const ip={css:null,exports:{setup(e,{inject:t}){this.sprite=at("modal","common"),this.modal=t("modal")},showDocs(){const e="ru"===flexbe.vars.user.lang?"https://help.flexbe.ru/browsers/":"https://help.flexbe.com/supported-browsers/";window.open(e,"_blank").focus()},closeModal(e=!1){this.modal.close(),e&&Mn.set("browseralert","1",6048e5)}},template:(e,t,s,i)=>e('<img class="legacy-browsers__img mb20" src="/_s/images/modals/browsers/legacy-browsers.svg" alt/><h2 expr612="expr612" class="legacy-browsers__title text-l"> </h2><p expr613="expr613" class="legacy-browsers__description text-gray mt10 mb20 px20"> </p><div class="legacy-browsers__buttons mb35"><div expr614="expr614" class="flexbe-button filled is-secondary mr10"> </div><div expr615="expr615" class="flexbe-button filled"> </div></div><hr class="flexbe-hr m0"/><div expr616="expr616" class="legacy-browsers__not-show text-gray text-xs"><svg expr617="expr617" is="flexbe-icon" class="mr5" icon="not-show"></svg><span expr618="expr618" class="flexbe-text"> </span></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"legacy-browsers"}]},{redundantAttribute:"expr612",selector:"[expr612]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::system_modal::legacy_browsers::title")].join("")}]},{redundantAttribute:"expr613",selector:"[expr613]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::system_modal::legacy_browsers::description")].join("")}]},{redundantAttribute:"expr614",selector:"[expr614]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::system_modal::legacy_browsers::more_button")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.showDocs}]},{redundantAttribute:"expr615",selector:"[expr615]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::button::close")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.closeModal(!1)}]},{redundantAttribute:"expr616",selector:"[expr616]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.closeModal(!0)}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.sprite}],redundantAttribute:"expr617",selector:"[expr617]"},{redundantAttribute:"expr618",selector:"[expr618]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("editor::system_modal::legacy_browsers::not_show")].join("")}]}]),name:"legacy-browsers"};e(ip.name,ip),riot3.tag2("unsupported-mobile",'<div class="flexbe-text">{tr(\'editor::system_modal::mobile_warn::text\')}</div> <a href="/admin/lead/" onclick="{clickClose}" class="flexbe-button large is-primary filled text-normal mt20 unsupported-browsers-button">{tr(\'editor::system_modal::mobile_warn::leads_link\')}</a> <div onclick="{clickClose}" class="unsupported-browsers-link mt15">{tr(\'editor::system_modal::mobile_warn::continue_button\')}</div>',"",'class="unsupported-browsers unsupported-mobile flexbe-modal-content text-s text-normal text-center"',(function(e){this.scope=e.scope,this.clickClose=function(){e.modal.close()}.bind(this)})),riot3.tag2("onboarding-modal",'<div class="onboarding-modal-step-background {active-step3: step.three}"></div> <div class="onboarding-modal step-{step.number}"> <div if="{step.three}" class="onboarding-modal-close no-title"> <a onclick="{closeModal}" class="flexbe-modal-close"></a> </div> <div class="onboarding-header"> <div class="onboarding-title flexbe-text text-h1">{tr(\'editor::onboarding::title\')}</div> <div class="breadcrumbs"> <div onclick="{nextStep1}" class="breadcrumb-container {active: step.one}"> <span></span> </div> <div onclick="{nextStep2}" class="breadcrumb-container {active: step.two}"> <span></span> </div> <div onclick="{nextStep3}" class="breadcrumb-container {active: step.three}"> <span></span> </div> </div> </div> <div class="onboarding-modal-step-content"> <div class="content-step-1"> <div class="content-text mr30"> <div class="flexbe-title text-h2">{tr(\'editor::onboarding::step_1::title\')}</div> <div class="font-ui text-shade-65 text-sm">{tr(\'editor::onboarding::step_1::text\')}</div> </div> <div class="onboarding-img-container"> <img src="/_s/images/modals/onboarding/animation_step1_production.gif"> </div> </div> <div class="content-step-2"> <div class="content-text mr40"> <div class="flexbe-title text-h2 justify-content-center">{tr(\'editor::onboarding::step_2::title\')}</div> <div class="font-ui text-shade-65 text-sm">{tr(\'editor::onboarding::step_2::text\')}</div> </div> <div class="onboarding-img-container"> <img src="/_s/images/modals/onboarding/animation_step2_production.gif"> </div> </div> <div class="content-step-3"> <div class="onboarding-img-container"> <img src="/_s/images/modals/onboarding/animation_step3_production.gif"> </div> <div class="onboarding-text-content mb20"> <div class="flexbe-title text-content text-h3 text-center">{tr(\'editor::onboarding::step_3::title\')}</div> <div class="font-ui text-shade-65 text-sm">{tr(\'editor::onboarding::step_3::text\')}</div> </div> </div> </div> <div class="flexbe-buttons-line justify-content-center"> <div onclick="{skipOnboarding}" class="flexbe-button style-text"> <span class="flexbe-text">{tr(\'editor::onboarding::button::skip\')}</span> </div> <div onclick="{nextStep}" class="flexbe-button filled large rounded is-primary"> <span class="flexbe-text">{tr(\'main::button::next\')}</span> </div> </div> <div class="flexbe-buttons-line button-step-3 justify-content-center editor-ui"> <div onclick="{closeModal}" class="flexbe-button filled large is-primary"> <span class="flexbe-text">{tr(\'editor::onboarding::button::edit\')}</span> </div> </div> </div>',"",'class="onboarding-modal-step {editor-ui: step.three}"',(function(e){this.tag=this,this.main=this,this.step={number:1,one:!0,two:!1,three:!1},this.nextStep=function(){1===this.step.number?this.nextStep2():this.nextStep3()}.bind(this),this.nextStep1=function(){this.step={number:1,one:!0,two:!1,three:!1},$(".content-step-1").css("transform","translateX(0)"),$(".content-step-2").css("transform","translateX(50px)"),$(".onboarding-modal-step-content").css("height",this.stepContent1),this.update()}.bind(this),this.nextStep2=function(){this.step={number:2,one:!1,two:!0,three:!1},$(".content-step-1").css("transform","translateX(-50px)"),$(".content-step-2").css("transform","translateX(0)"),$(".onboarding-modal-step-content").css("height",this.stepContent2),this.update()}.bind(this),this.nextStep3=function(){this.step={number:3,one:!1,two:!1,three:!0},$(".onboarding-modal-step-content").css("height",this.stepContent3),this.update()}.bind(this),this.skipOnboarding=function(){e.modal.close(),window.history&&history.replaceState({},"","/")}.bind(this),this.closeModal=function(){e.modal.close(),window.history&&history.replaceState({},"","/")}.bind(this),this.on("mount",(()=>{setTimeout((()=>{this.stepContent1=$(".content-step-1").outerHeight(!0),this.stepContent2=$(".content-step-2").outerHeight(!0),this.stepContent3=$(".content-step-3").outerHeight(!0),$(".onboarding-modal-step-content").css("height",this.stepContent1)}),10)}))}));const ap={css:null,exports:{setup(e,{inject:t}){this.modal=t("modal"),this.state={limit:flexbe.bill.domainLimit,role:flexbe.vars.user.role}},clickShowPlanChange(){flexbe.modals.bill.showPlanChange(this.triggerChange,{fromModal:this.modal})},triggerChange(e,t){(e||t)&&this.props.onChange(e,t)},makeAsDraft(){this.triggerChange(null,"make_as_draft")},closeModal(){this.modal.close()}},template:(e,t,s,i)=>e('<svg class="admin-bill-limit__icon" width="116" height="60" viewBox="0 0 116 60" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M38.8583 8.94C39.2237 8.35524 39.8647 8 40.5542 8H75.4458C76.1353 8 76.7763 8.35524 77.1418 8.94L81.848 16.47L82 16.7132V17V51C82 52.1046 81.1046 53 80 53H36C34.8954 53 34 52.1046 34 51V17V16.7132L34.152 16.47L38.8583 8.94ZM75.4458 10H40.5542L36.8042 16H79.1958L75.4458 10ZM36 51V18H80V51H36ZM66 22H50V24H66V22Z" fill="#30343B"/></svg><div class="admin-bill-limit__content"><div expr619="expr619" class="flexbe-title"> </div><div expr620="expr620" class="flexbe-text"> </div></div><div class="flexbe-buttons-line centered"><div expr621="expr621" class="flexbe-button filled is-primary"> </div><div expr622="expr622" class="flexbe-button is-secondary"> </div></div><div expr623="expr623" class="flexbe-bar has-line"></div><div expr624="expr624" class="flexbe-button style-text style-link-text"></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>"admin-bill-limit flexbe-modal-content"}]},{redundantAttribute:"expr619",selector:"[expr619]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::bill::projects_limit::title")}]},{redundantAttribute:"expr620",selector:"[expr620]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::bill::projects_limit::desc",{count:e.state.limit})}]},{redundantAttribute:"expr621",selector:"[expr621]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("admin::bill::projects_limit::confirm_button")},{type:t.EVENT,name:"onclick",evaluate:e=>e.makeAsDraft}]},{redundantAttribute:"expr622",selector:"[expr622]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::cancel")},{type:t.EVENT,name:"onclick",evaluate:e=>e.closeModal}]},{type:s.IF,evaluate:e=>"owner"!==e.state.role,redundantAttribute:"expr623",selector:"[expr623]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::user::pay::upgrade::projects::not_owner_warning")].join("")}]}])},{type:s.IF,evaluate:e=>"owner"===e.state.role,redundantAttribute:"expr624",selector:"[expr624]",template:e(" ",[{expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::bill::projects_limit::tariff_button")].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.clickShowPlanChange}]}])}]),name:"admin-bill-limit"};e(ap.name,ap);const np={css:null,exports:{setup(e,{initMobx:t,inject:s}){var i;t(),this.modal=s("modal"),this.state={loading:!1,userProjectsIds:null!=(i=e.props.selectedProjectIds)&&i.length?[...e.props.selectedProjectIds].filter((e=>e)):[],fullProjectIdsList:[],projectsStore:e.props.projectsStore||adminStore.getModule("projects"),tariffName:e.props.tariffName||tr(flexbe.bill.name),get projectsStoreLoading(){return this.projectsStore.state.loading},get limit(){var t;return null!=(t=e.props.limit)?t:flexbe.bill.domainLimit},get limitExceeded(){return this.userProjectsIds.length>this.limit}},this.meta={},this.watch={"state.loading":()=>this.update(),"state.userProjectsIds":()=>this.update()}},onSelectProjects(e,t){this.state.userProjectsIds=e||[],this.state.fullProjectIdsList=t||[]},async onBeforeMount(){this.props.projectsStore||await this.state.projectsStore.loadProjects(),this.props.selectAllPublised&&(this.state.userProjectsIds=[...new Set([...this.state.userProjectsIds,...this.state.projectsStore.getters.publishedPersonalProjects.map((e=>e.project_id))])])},async onSave(){var e,t;const s=this.state.fullProjectIdsList.map((e=>({projectId:e,isDraft:!this.state.userProjectsIds.includes(e)})));this.state.loading=!0,await this.state.projectsStore.dispatch("updateBulkIsDraft",s),this.state.loading=!1,null==(e=(t=this.props).onChange)||e.call(t,this.state.userProjectsIds),this.modal.close()}},template:(e,t,s,i)=>e('<div class="flexbe-bar flexbe-field-group flexbe-bar--large-info block flexbe-field-group"><div expr625="expr625" class="flexbe-title"> </div><div expr626="expr626" class="flexbe-desc"> </div></div><div expr627="expr627" is="select-projects" class="flexbe-field-group"></div><div class="flexbe-field-group"><button expr628="expr628"></button></div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["bill-select-public-projects flexbe-modal-content ",e.props.class].join("")}]},{redundantAttribute:"expr625",selector:"[expr625]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::bill::select_published_projects::title",{count:e.state.limit,tariff:e.state.tariffName})].join("")}]},{redundantAttribute:"expr626",selector:"[expr626]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::bill::select_published_projects::desc")].join("")}]},{type:s.TAG,getComponent:i,evaluate:e=>"select-projects",slots:[],attributes:[{type:t.ATTRIBUTE,name:"limit",evaluate:e=>e.state.limit},{type:t.ATTRIBUTE,name:"projects-store",evaluate:e=>e.state.projectsStore},{type:t.ATTRIBUTE,name:"selected-projects",evaluate:e=>e.state.userProjectsIds},{type:t.ATTRIBUTE,name:"show-toggle",evaluate:e=>!0},{type:t.EVENT,name:"on-change",evaluate:e=>e.onSelectProjects}],redundantAttribute:"expr627",selector:"[expr627]"},{type:s.IF,evaluate:e=>e.state.limit,redundantAttribute:"expr628",selector:"[expr628]",template:e('<span expr629="expr629" class="flexbe-text"> </span>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button is-primary filled ",e.classNames({disabled:e.state.limitExceeded||e.state.projectsStoreLoading,loading:e.state.loading})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>e.onSave}]},{redundantAttribute:"expr629",selector:"[expr629]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>e.tr("main::button::confirm")}]}])}]),name:"bill-select-public-projects"};e(np.name,np);const rp={css:null,exports:{setup(e,{initMobx:t,inject:s}){t(),this.modal=s("modal"),this.state={inSave:!1,action:"upgrade",replaceProjectId:null,projectStore:adminStore.getModule("projects"),loading:!1,limit:flexbe.bill.domainLimit,tariffName:tr(flexbe.bill.name),get projectData(){return e.props.projectData},get domainTitle(){var e;return(null==(e=this.projectData)?void 0:e.domain_title)||""},get inSharedAccess(){return"owner"!==flexbe.vars.user.role}},this.meta={sprite:at("projects","admin"),actions:[{value:"upgrade",icon:"upgrade",title:tr("admin::projects::bill::upgrade::title"),desc:tr("admin::projects::bill::upgrade::desc"),show:!e.state.inSharedAccess},{value:"draft",icon:"draft",title:tr("admin::projects::bill::draft::title"),desc:tr("admin::projects::bill::draft::desc"),show:!0},{value:"replace",icon:"replace-project",title:tr("admin::projects::bill::replace::title"),desc:tr("admin::projects::bill::replace::desc",{domain:e.state.domainTitle}),show:!0}]},this.watch={"state.inSave":[()=>this.update()],"state.action":[()=>this.update()],"state.replaceProjectId":[()=>this.update()]}},onSelectProjects(e){this.state.replaceProjectId=e[0]},setAction(e){this.state.action!==e.value&&(this.state.action=e.value,"replace"===this.state.action&&this.loadProjects(),this._setWidth())},async loadProjects(){var e;(await this.state.projectStore.loadProjects(),this.state.replaceProjectId)||(this.state.replaceProjectId=(null==(e=this.state.projectStore.getters.filteredPublishedPersonalProjects[0])?void 0:e.project_id)||null)},_setWidth(){const e="replace"===this.state.action?820:410;this.state.currentWidth!==e&&(anime({targets:this.root,width:e,duration:350,easing:"easeOutExpo"}),this.state.currentWidth=e)},onCancel(){this.modal.close()},async onConfim(e){e.preventDefault();let t=!1;const s={action:this.state.action,data:{}};if(this.state.loading=!0,"upgrade"!==this.state.action)"replace"===this.state.action&&this.state.replaceProjectId&&(s.data={replaceProjectId:this.state.replaceProjectId}),this.props.onChange(t,s),this.modal.close();else{const e=flexbe.bill.domainLimit,i=flexbe.modals.bill.showPlanChange(((a,n)=>{n&&n.bill_plan?e>=n.bill_plan.domainLimit&&(toast.error(tr("admin::projects::transfer::error::limit")),t=!0):a&&(t=!0),this.props.onChange(t,s),i.closed||i.close(),this.modal.close()}))}},async onBeforeMount(){this.modal.setLoader(),await this.state.projectStore.loadProjects(),this.state.inSharedAccess&&(this.state.action="draft"),this.modal.removeLoader()}},template:(e,t,s,i)=>e('<form expr630="expr630" class="row gap-40"><div class="col left-col"><div class="flexbe-bar flexbe-field-group flexbe-bar--large-info block flexbe-field-group"><div expr631="expr631" class="flexbe-title"> </div><div expr632="expr632" class="flexbe-desc"> </div></div><div class="flexbe-field-group actions-list"><div expr633="expr633"></div></div><div class="flexbe-hr"></div><div class="flexbe-buttons-line"><button expr637="expr637" type="submit"><span expr638="expr638" class="flexbe-text"> </span></button><button expr639="expr639" class="flexbe-button is-default filled"><span expr640="expr640" class="flexbe-text"> </span></button></div></div><div expr641="expr641" is="select-projects" class="col"></div></form>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["bill-resolve-projects-restrictions flexbe-modal-content ",e.props.class].join("")}]},{redundantAttribute:"expr630",selector:"[expr630]",expressions:[{type:t.EVENT,name:"onsubmit",evaluate:e=>e.onConfim}]},{redundantAttribute:"expr631",selector:"[expr631]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::transfer::method::title",{count:e.state.limit,tariff:e.state.tariffName})].join("")}]},{redundantAttribute:"expr632",selector:"[expr632]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("admin::projects::transfer::method::desc")].join("")}]},{type:s.EACH,getKey:null,condition:e=>e.action.show,template:e('<div class="inline-box"><div expr634="expr634" is="flexbe-icon" class="action-icon"></div><span expr635="expr635" class="flexbe-text flexbe-title action-name"> </span><div class="flexbe-check"></div></div><div expr636="expr636" class="flexbe-desc"> </div>',[{expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["action-item ",e.classNames({active:e.action.value===e.state.action})].join("")},{type:t.EVENT,name:"onclick",evaluate:e=>()=>e.setAction(e.action)}]},{type:s.TAG,getComponent:i,evaluate:e=>"flexbe-icon",slots:[],attributes:[{type:t.ATTRIBUTE,name:"sprite",evaluate:e=>e.meta.sprite},{type:t.ATTRIBUTE,name:"icon",evaluate:e=>e.action.icon}],redundantAttribute:"expr634",selector:"[expr634]"},{redundantAttribute:"expr635",selector:"[expr635]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.action.title].join("")}]},{redundantAttribute:"expr636",selector:"[expr636]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.action.desc].join("")}]}]),redundantAttribute:"expr633",selector:"[expr633]",itemName:"action",indexName:null,evaluate:e=>e.meta.actions},{redundantAttribute:"expr637",selector:"[expr637]",expressions:[{type:t.ATTRIBUTE,name:"class",evaluate:e=>["flexbe-button filled is-primary ",e.classNames({loading:e.state.inSave})].join("")}]},{redundantAttribute:"expr638",selector:"[expr638]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::button::confirm")].join("")}]},{redundantAttribute:"expr639",selector:"[expr639]",expressions:[{type:t.EVENT,name:"onclick",evaluate:e=>e.onCancel}]},{redundantAttribute:"expr640",selector:"[expr640]",expressions:[{type:t.TEXT,childNodeIndex:0,evaluate:e=>[e.tr("main::button::cancel")].join("")}]},{type:s.IF,evaluate:e=>"replace"===e.state.action,redundantAttribute:"expr641",selector:"[expr641]",template:e(null,[{type:s.TAG,getComponent:i,evaluate:e=>"select-projects",slots:[],attributes:[{type:t.ATTRIBUTE,name:"selected-projects",evaluate:e=>[e.state.replaceProjectId]},{type:t.ATTRIBUTE,name:"projects-store",evaluate:e=>e.state.projectStore},{type:t.ATTRIBUTE,name:"show-toggle",evaluate:e=>!0},{type:t.ATTRIBUTE,name:"show-drafts",evaluate:e=>!1},{type:t.ATTRIBUTE,name:"multiple",evaluate:e=>!1},{type:t.EVENT,name:"on-change",evaluate:e=>e.onSelectProjects}]}])}]),name:"bill-resolve-projects-restrictions"};e(rp.name,rp),riot3.tag2("bill-feature",'<div class="bill-limit-img"> <img riot-src="{featureData.img}"> </div> <div class="bill-limit-text"> <div class="flexbe-title"> {featureData.title} </div> <div class="flexbe-desc"> {featureData.desc} </div> <div onclick="{clickShowPlanChange}" class="filled flexbe-button is-primary"> <span class="flexbe-text">{tr(\'main::button::change_plan\')}</span> </div> </div>',"",'class="flexbe-modal-content"',(function(e){const t=e.onChange;this.tag=this,this.main=this,this.featureData=e.featureData,this.clickShowPlanChange=function(){flexbe.modals.bill.showPlanChange(t),e.modal.close()}.bind(this)})),riot3.tag2("bill-pay-auto-period",'<div data-is="admin-user-pay-view-period" modal="{opts.modal}" period="{period}" plan="{plan}" select="{onSelect}"></div> <div class="button-holder"> <div onclick="{confirmChange}" class="bill-btn flexbe-button large rounded filled is-primary {loading: inChange}"> <span class="flexbe-text">{tr(\'main::button::apply\')}</span> </div> </div>',"",'class="flexbe-modal-content"',(function(e){this.inChange=!1,this.period=e.period,this.plan=e.plan,this.onSelect=function(e){this.update({period:e})}.bind(this),this.confirmChange=function(){this.update({inChange:!0}),flexbe.bill.periodChange(this.period,((t,s)=>{this.update({inChange:!0}),t?toast.error(t.message):e.modal&&e.modal.close()}))}.bind(this)})),riot3.tag2("bill-pay-mycard-select",'<div class="flexbe-card-list gap-20"> <div class="flexbe-card-item grow" each="{card in list}"> <label class="card-item"> <div class="card-type"> <svg class="flexbe-icon icon-method"> <use riot-xlink:href="{getIcon(card)}"></use> </svg> </div> <div data-is="flexbe-input" class="contrast" type="radio" name="method" checked="{activeCard == card}" onchange="{changeCard}"></div> <div class="card-id"> <span class="flexbe-text"> {card.end}</span> </div> </label> </div> </div> <div class="flexbe-button is-primary filled {loading: loading}" onclick="{selectCard}"> <span class="flexbe-text">{tr(\'admin::user::pay::mycard_select::select_button\')}</span> </div>',"",'class="bill-pay-mycard-select flexbe-modal-content"',(function(e){this.tag=this,this.main=this,this.list=e.list||[],this.sprite="/_s/images/modals/bill/bill.sprite.svg",this.activeCard=this.list[0],this.loading=!1,this.getIcon=function(e){let t="mycard";return["mastercard","visa","mir"].includes(e.type)&&(t=e.type),`${this.sprite}#method-${t}`}.bind(this),this.changeCard=function(e){const t=e.item.card;this.update({activeCard:t})}.bind(this),this.selectCard=function(){if("function"!=typeof e.onSelect)return;this.update({loading:!0});const t=e.onSelect(this.activeCard);Promise.resolve(t).then((()=>{this.update({loading:!1}),e.modal&&e.modal.close()})).catch((()=>{this.update({loading:!1})}))}.bind(this)})),riot3.tag2("bill-plan-change",'<div if="{!plans.length}" class="bill-loader-wrap"> <div data-is="proxy" is="flexbe-loader" class="bill-loader"></div> </div> <virtual if="{plans.length}"> <div data-is="proxy" is="admin-user-pay-plan-list" on-change="{opts.onChange}" modal="{opts.modal}" currency="{currency}" plans="{plans}" ref="plans"> </div> <div class="flexbe-bar has-line mt20"> {tr(\'admin::user::pay::plan::change_note\')} </div> </virtual>',"",'class="flexbe-modal-content"',(function(e){this.tag=this,this.main=this,this.oldPlan=!1,this.currencies=[],this.plans=[],this.currency=flexbe.bill.planCurrency,this.onMounted=function(){flexbe.bill.getPlansList(((e,t)=>{this.update({plans:t.plans,oldPlan:t.archived_plan,currencies:t.currency_list})}))}.bind(this)})),riot3.tag2("bill-plan-confirm",'<div class="bill-confirm-list"> <div class="bill-confirm-item flexbe-white-card shadow price-item"> <div class="text-xs mb5">{tr(\'admin::user::pay::plan::recalc::current_date\')}</div> <div class="text-h1 text-medium"> {data.old.exp_date} </div> </div> <div class="bill-confirm-item flexbe-white-card shadow price-item"> <div class="text-xs mb5">{tr(\'admin::user::pay::plan::recalc::new_date\')}</div> <div class="text-h1 text-medium"> {data.new.exp_date} </div> </div> </div> <div class="flexbe-buttons-line centered"> <div onclick="{confirmChange}" class="bill-btn flexbe-button large rounded filled is-primary {loading: inChange}"> <span class="flexbe-text">{tr(\'main::button::confirm\')}</span> </div> </div>',"",'class="flexbe-modal-content"',(function(e){const t=e.onChange||function(){};this.tag=this,this.main=this,this.data=e.data,this.inChange=!1,this.confirmChange=function(){const s=e.data&&e.data.new&&e.data.new.plan_id;this.inChange||(this.update({inChange:!0}),flexbe.bill.planChangeConfirmed(s,((s,i)=>{this.update({inChange:!1}),i&&e.modal&&e.modal.close(),t(s,i)})))}.bind(this)})),riot3.tag2("bill-promo-activate",'<div class="flexbe-title"> <span class="flexbe-text">{tr(\'admin::user::pay::promocode::label\')}</span> </div> <form class="flexbe-field-group is-inline" onsubmit="{activatePromocode}"> <div data-is="flexbe-input" class="flexbe-input grow" autofocus="{true}" riot-value="{code}" error="{showError}" error-text="{errorText}" oninput="{changePromocode}"></div> <button type="submit" class="flexbe-button filled is-primary noshrink {loading: loading}"> <span class="flexbe-text">{tr(\'main::button::apply\')}</span> </button> </form>',"",'class="flexbe-modal-content"',(function(e){this.showError=!1,this.errorText="",this.loading=!1,this.code=e.code,this.changePromocode=function(e){this.showError=!1,this.code=String(e.target.value||"").trim()}.bind(this),this.activatePromocode=async function(t){if(t.preventDefault(),t.stopPropagation(),this.code){this.update({loading:!0});try{const t=await flexbe.bill.activatePromocode(this.code);t.isInstant&&flexbe.modals.bill.showInstantCoupon(t),e.modal&&e.modal.close()}catch(e){"NetworkError"===e.name?(this.showError=!0,this.errorText=e.message):(toast.error(e.message),console.error(e))}this.update({loading:!1})}else this.update({showError:!0,errorText:tr("main::error::fill_field")})}.bind(this)})),riot3.tag2("bill-invoice-info",'<div class="flexbe-white-box"> <div class="row gap-40"> <div class="col col-4 text-shade"> {tr(\'admin::user::pay::checkout::invoice_recipient_label\')} </div> <div class="col col-8"> <div class="flexbe-text invoice-recipient" each="{item in state.recipient}">{item}</div> </div> </div> </div> <div class="flexbe-white-box"> <div class="row gap-40"> <div class="col col-4 text-shade"> {tr(\'admin::user::pay::checkout::invoice_destination_label\')} </div> <div class="col col-8"> <div class="flexbe-text invoice-dest" each="{item in state.destination}">{item}</div> </div> </div> </div> <div class="flexbe-white-box mb20"> <div class="row gap-40"> <div class="col col-4 text-shade"> {tr(\'admin::user::pay::checkout::invoice_sum_label\')} </div> <div class="col col-8"> <div class="flexbe-text invoice-sum"> {state.sum} </div> </div> </div> </div> <div class="flexbe-buttons-line"> <a class="flexbe-button filled is-primary" riot-href="{state.pdf}&download=1" riot-download="{state.pdf}"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{sprite}#download_invoice"></use> </svg> <span class="flexbe-text"> {tr(\'admin::user::pay::checkout::invoice_download_pdf_button\')} </span> </a> <a class="flexbe-button filled default" target="_blank" riot-href="{state.pdf}"> <svg class="flexbe-icon size-14"> <use riot-xlink:href="{sprite}#open_invoice"></use> </svg> <span class="flexbe-text"> {tr(\'admin::user::pay::checkout::invoice_open_pdf_button\')} </span> </a> </div>',"",'class="bill-invoice-info flexbe-modal-content {opts.class}"',(function(e){this.tag=this,this.sprite=at("pay","admin"),this.state={recipient:e.recipient,destination:e.destination,sum:e.sum,pdf:`/admin/user/pay/print.pdf/?id=${e.invoice}&stamp=1`}})),riot3.tag2("bill-promo-instant",'<div class="flexbe-title"> <div class="flexbe-text">{tr(\'admin::user::pay::promocode::activated_promocode_title\')}:</div> <div class="flexbe-text">{code}</div> </div> <div class="promocode-block"> <span class="flexbe-text"> {text} </span> <svg class="flexbe-icon size-auto" viewbox="0 0 250 100" fill="none"> <path d="M248 10C248 5.58172 244.418 2 240 2H230V7H228V2H10C5.58173 2 2 5.58172 2 10V33.1164C10.4463 34.1063 17 41.2878 17 50C17 58.7122 10.4463 65.8937 2 66.8836V90C2 94.4183 5.58173 98 10 98H228V95H230V98H240C244.418 98 248 94.4183 248 90V10ZM10 100H228H230H240C245.523 100 250 95.5229 250 90V10C250 4.47716 245.523 0 240 0H10C4.47716 0 0 4.47715 0 10V33V35C8.28427 35 15 41.7157 15 50C15 58.2843 8.28427 65 0 65V67V90C0 95.5228 4.47716 100 10 100ZM228 11H230V21H228V11ZM230 25H228V35H230V25ZM228 39H230V49H228V39ZM230 53H228V63H230V53ZM228 67H230V77H228V67ZM230 81H228V91H230V81ZM125.897 17.5574L125 15.7407L124.103 17.5574L121.246 23.3465L114.855 24.2805L112.852 24.5734L114.302 25.9864L118.925 30.4894L117.834 36.851L117.492 38.8483L119.285 37.9051L125 34.8998L130.715 37.9051L132.508 38.8483L132.166 36.851L131.075 30.4894L135.698 25.9864L137.148 24.5734L135.145 24.2805L128.754 23.3465L125.897 17.5574ZM122.807 24.7026L125 20.2593L127.193 24.7026L127.426 25.1735L127.945 25.2495L132.852 25.9666L129.302 29.4236L128.925 29.7906L129.014 30.309L129.852 35.1917L125.465 32.8849L125 32.6402L124.535 32.8849L120.148 35.1917L120.986 30.309L121.075 29.7906L120.698 29.4236L117.148 25.9666L122.055 25.2495L122.574 25.1735L122.807 24.7026Z"></path> </svg> </div> <div class="flexbe-button filled rounded is-primary large {loading: loading}" onclick="{onClick}"> <span class="flexbe-text mx15">{tr(\'main::button::thanks\')}</span> </div>',"",'class="bill-promo-instant {opts.class}"',(function(e){this.code=e.code||"",this.text=e.text||"",this.onClick=function(){this.loading=!0,location.reload()}.bind(this)}));const op={init(){(()=>{const e=Ut(),t="Firefox"===e.name&&!Rt(e.version,"64"),s="Chrome"===e.name&&!Rt(e.version,"85"),i="Safari"===e.name&&!Rt(e.version,"14.2"),a=/(iPhone|iPad|iPod|BlackBerry|Android)/.test(navigator.userAgent),n=Mn.get("browseralert"),r="flexbe.com"===window.location.host||"/admin/password/"===window.location.pathname||"/admin/segmentation/"===window.location.pathname||"?onboarding=1"===window.location.search;if((t||s||i)&&!n&&Zs.create({width:380,overlay:!0,shadow:!0,component:"legacy-browsers"}),a&&!localStorage.getItem("mobilealert")&&!r){const e=$('head meta[name="viewport"]'),t=()=>{localStorage.setItem("mobilealert","1"),a&&window.screen.width<1024&&($('head meta[name="viewport"]').detach(),$("body iframe").show(),$("body").css("min-width",""),$("head").append(e))};window.screen.width<1024&&($("body iframe").hide(),$("body").css("min-width","auto"),e.detach(),$("head").append('<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">')),Zs.create({title:tr("editor::system_modal::mobile_warn::title"),width:360,overlay:!0,shadow:!0,riotTag:"unsupported-mobile",onClose:t})}})(),(()=>{if(!flexbe.bill.isLockedMsg)return;const e=flexbe.bill.lockedMsgDate,t=at("site_will_be_delete");As({props:{icon:`${t}#pay_period_over`,title:tr("admin::expired_modal::pay_end_title"),text:tr("admin::expired_modal::pay_end_text",{data:e}),confirmButtonText:tr("admin::expired_modal::pay_button"),onConfirm:()=>{document.location=`${document.location.origin}/admin/user/pay/`}},clickOut:!0})})(),flexbe.editor&&(()=>{let e=!1;"undefined"!=typeof URLSearchParams&&(e=!!new URLSearchParams(window.location.search).get("onboarding"));e&&Zs.create({riotTag:"onboarding-modal",type:"overlay",scrollable:!1})})()},pages:Cl,bill:{showPeriodChange:e=>Zs.create({title:tr("admin::user::pay::period::title"),width:450,overlay:!0,shadow:!0,riotTag:"bill-pay-auto-period",props:e}),showPlanChange:e=>Zs.create({title:tr("admin::user::pay::plan::modal::title"),width:850,overlay:!0,shadow:!0,scrollable:!0,limit:{overflow:!1},riotTag:"bill-plan-change",props:{onChange:e},onClose:()=>{"function"==typeof e&&e(null,!1)}}),showLimit:e=>Zs.create({title:tr("admin::user::pay::upgrade::projects::title"),width:420,overlay:!0,shadow:!0,component:"admin-bill-limit",props:{onChange:e},onClose:()=>{"function"==typeof e&&e(null,!1)}}),showFeature:(e,t)=>Zs.create({title:tr("admin::user::pay::upgrade::title"),width:500,overlay:!0,shadow:!0,riotTag:"bill-feature",props:{featureData:e,onChange:t}}),planChangeConfirm:(e,t)=>Zs.create({title:tr("admin::user::pay::plan::recalc::title"),width:500,overlay:!0,shadow:!0,riotTag:"bill-plan-confirm",props:{data:e,onChange:t},onClose:()=>{"function"==typeof t&&t(null,!1)}}),resolveProjectsRestrictions:({onChange:e})=>Zs.create({title:tr("admin::user::bill::limitation::title"),height:550,overlay:!0,shadow:!0,component:"bill-resolve-projects-restrictions",scrollable:!1,props:{onChange:null!=e?e:()=>{}}}),selectPublicSites:e=>Zs.create({title:tr("admin::user::bill::limitation::title"),width:440,height:680,overlay:!0,shadow:!0,component:"bill-select-public-projects",scrollable:!1,props:e}),showMycardSelect:e=>Zs.create({title:tr("admin::user::pay::mycard_select::title"),width:440,overlay:!0,shadow:!0,riotTag:"bill-pay-mycard-select",props:e}),showInvoiceInfo:e=>Zs.create({title:tr("admin::user::pay::checkout::invoice_modal_title",{count:e.invoice}),name:"bill-invoice-info",width:450,overlay:!0,riotTag:"bill-invoice-info",props:e}),showCouponEnter:e=>Zs.create({title:tr("admin::user::pay::promocode::title"),width:450,overlay:!0,shadow:!0,riotTag:"bill-promo-activate",props:e}),showInstantCoupon:({code:e,text:t})=>Zs.create({width:330,overlay:!0,shadow:!0,clickOut:!1,closeButton:!1,closeOnEscape:!1,riotTag:"bill-promo-instant",props:{code:e,text:t}})},confirm:As,gallery:vl},lp={planID:0,planCurrency:"RUB",domainLimit:0,smsLimit:0,smsGroups:[],getPlansList(e=(()=>{})){const t=$.ajax({url:"/admin/api/account/pay/plan/get_plans/",type:"GET"});t.done((t=>{e(null,t.data)})),t.fail((t=>{e(new Error(t))}))},planChangeSelect(e,t=((e,t)=>{})){const s=$.ajax({url:"/admin/user/pay/plan/change/",type:"POST",dataType:"json",data:{act:"calc",plan_id:e}});s.done((e=>{const s=e.data;s.change_data&&s.change_data.new.exp<1?this.planChangeConfirmed(s.change_data.new.plan_id,t):flexbe.modals.bill.planChangeConfirm(s.change_data,t)})),s.fail((async s=>{var i,a,n,r;const o=null!=(i=null==(a=s.responseJSON)?void 0:a.message)?i:tr("main::error::network"),l=null!=(n=null==(r=s.responseJSON)?void 0:r.type_error)?n:"project_limit";409!==s.status||"project_limit"!==l?t(new Error(o),null):this.getPlansList(((s,i)=>{if(i){const s=i.plans.find((t=>t.planID===e));flexbe.modals.bill.selectPublicSites({tariffName:s.title,limit:s.data.domain_limit,selectAllPublised:!0,onChange:()=>{this.planChangeSelect(e,t)}})}t(null,null)}))}))},planChangeConfirmed(e,t=(()=>{})){const s=$.ajax({url:"/admin/user/pay/plan/change/",type:"POST",dataType:"json",data:{act:"change",plan_id:e}});s.done((e=>{var s;const i={bill_plan:e.data.plan_data,bill_exp:e.data.bill_exp};flexbe.bill.planID=+i.bill_plan.planID,flexbe.bill.planCurrency=i.bill_plan.currency,flexbe.bill.usersLimit=+i.bill_plan.data.users_limit,flexbe.bill.abtest=+i.bill_plan.data.abtest,flexbe.bill.multilanding=+i.bill_plan.data.multilanding,flexbe.bill.domainLimit=+i.bill_plan.data.domain_limit,flexbe.bill.smsLimit=+i.bill_plan.data.sms_limit,flexbe.bill.can_hide_copyright=null!=(s=+i.bill_plan.data.can_hide_copyright)?s:1,flexbe.trigger("bill-plan-changed",i),t(null,i)})),s.fail((e=>{var s,i;const a=null!=(s=null==(i=e.responseJSON)?void 0:i.message)?s:tr("main::error::network");t(new Error(a))}))},periodChange(e,t=(()=>{})){const s=$.ajax({url:"/admin/api/account/pay/mycard_auto_period/",type:"POST",dataType:"json",data:{auto_period:e}});s.done((()=>{t(null,e),flexbe.trigger("bill-period-changed",e)})),s.fail((()=>{t(new Error(tr("main::error::network")))}))},async activatePromocode(e){const t=await ii("/admin/api/account/pay/enter_promo_code/",{data:{coupon:e}}),s={code:t.data.code||t.data.promo_code,text:t.data.text||t.data.bonus_text,isInstant:!!t.data.is_instant_activation_on};return flexbe.trigger("bill-promocode-changed",s),s},removePromocode(e,t=(()=>{})){const s=$.ajax({url:"/admin/api/account/pay/remove_promo_code/",type:"POST",dataType:"json",data:{coupon:e}});s.done((e=>{const s=e.data;t(null,s),flexbe.trigger("bill-promocode-changed",!1)})),s.fail((()=>{t(new Error(tr("main::error::network")))}))},mycardRemove(e,t=(()=>{})){const s=$.ajax({url:"/admin/api/account/pay/mycard_remove/",type:"POST",dataType:"json",data:{card_id:e}});s.done((e=>{const s=e.data;t(null,s)})),s.fail((()=>{t(new Error(tr("main::error::network")))}))},mycardAutoToggle(e={},t=(()=>{})){const s=$.ajax({url:"/admin/api/account/pay/mycard_auto_toggle/",type:"POST",dataType:"json",data:{card_id:e.cardId,auto_period:e.autoPeriod,auto_payment:e.autoPayment,pay_service_id:e.payServiceId}});s.done((e=>{const s=e.data;t(null,s)})),s.fail((()=>{t(new Error(tr("main::error::network")))}))},updatePayer(e={},t=(()=>{})){const s=$.ajax({url:"/admin/api/account/pay/update_payer_info/",type:"POST",dataType:"json",data:e});s.done((e=>{const s=e.data;t(null,s)})),s.fail((()=>{t(new Error(tr("main::error::network")))}))},getInvoiceInfo:async({service:e,serviceId:t=0,payExtra:s,sum:i=0})=>ii("/admin/api/account/bankpay/",{data:{pay_service:e,pay_service_id:t,pay_sum:i,pay_method:"bank_company",pay_extra_info:s}})};window.route=function(){var e,t,s,i,a=function(e){e=e||{};var t={},s=Array.prototype.slice;return Object.defineProperties(e,{on:{value:function(s,i){return"function"==typeof i&&(t[s]=t[s]||[]).push(i),e},enumerable:!1,writable:!1,configurable:!1},off:{value:function(s,i){if("*"!=s||i)if(i)for(var a,n=t[s],r=0;a=n&&n[r];++r)a==i&&n.splice(r--,1);else delete t[s];else t={};return e},enumerable:!1,writable:!1,configurable:!1},one:{value:function(t,s){return e.on(t,(function i(){e.off(t,i),s.apply(e,arguments)}))},enumerable:!1,writable:!1,configurable:!1},trigger:{value:function(i){var a,n,r,o=arguments,l=arguments.length-1,d=new Array(l);for(r=0;r<l;r++)d[r]=o[r+1];for(a=s.call(t[i]||[],0),r=0;n=a[r];++r)n.apply(e,d);return t["*"]&&"*"!=i&&e.trigger.apply(e,["*",i].concat(d)),e},enumerable:!1,writable:!1,configurable:!1}}),e},n=/^.+?\/\/+[^/]+/,r=/(:)(\w+)/g,o=/\*/g,l="popstate",d="hashchange",c="undefined"!=typeof window&&window,p="undefined"!=typeof document&&document,u=c&&history,m=c&&(u.location||c.location),h=k.prototype,g=p&&p.ontouchstart?"touchstart":"click",v=a(),f=!1,x=[],b=0;function y(e=""){const t={};let s=A(e);return s.match(n)||(s=`${location.origin}/${s}`),s=new URL(s),t.protocol=s.protocol,t.host=s.hostname,t.path="/"+A(s.pathname),t.hash=s.hash.replace(/^#/,""),t.query=s.search.replace(/^\?/,""),t}function _(e){const t=$._.base,s=y(e),i=s.hash;return{path:t+e,query:$.query(s.query),hash:i}}function T(e,t){const s=$._.base,i=function(e){var t=[];return{regexp:e instanceof RegExp?e:new RegExp(e.replace(r,(function(e,s,i){return t.push(i),"([^/]+)"})).replace(o,"(?:.*)")+"(?:/$|$)",""),paramNames:t}}(t),a=i.regexp,n=i.paramNames,l=y(e),d=A(l.path).match(a);if(d){const t=l.hash,i=$.query(l.query);return{path:s+e,params:d.slice(1).map(((e,t)=>[n[t],e])).reduce(((e,[t,s])=>Object.assign(e,{[t]:s})),{}),query:i,hash:t}}}function w(t){var s,i,a;s=C,i=1,e=function(){clearTimeout(a),a=setTimeout(s,i)},c.addEventListener(l,e),c.addEventListener(d,e),p.addEventListener(g,S),t&&C(!0)}function k(){this.$=[],a(this),v.on("stop",this.s.bind(this)),v.on("emit",this.e.bind(this))}function A(e){return e.replace(/^\/|\/$/g,"")}function E(e){return(e||m.href).replace(n,"")}function I(e){var t=$._.base;return"#"===t[0]?(e||m.href||"").split(t)[1]||"":(m?E(e):e||"").replace(new RegExp("^"+t),"")}function C(e=true){var s=0===b;if(!(3<=b)&&(b++,x.push((function(){var s=I();(e||s!==t)&&(v.trigger("emit",s),t=s)})),s)){for(var i;i=x.shift();)i();b=0}}function S(e){if(!(1!==e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){for(var t=e.target;t&&"A"!==t.nodeName;)t=t.parentNode;if(t&&"A"===t.nodeName&&!t.hasAttribute("download")&&t.hasAttribute("href")&&(!t.target||"_self"===t.target)&&-1!==t.href.indexOf(m.href.match(n)[0])){var s=$._.base;t.href!==m.href&&t.href.split("#")[0]===m.href.split("#")[0]||"#"!==s[0]&&0!==E(t.href).indexOf(s)||"#"===s[0]&&t.href.split(s)[0]!==m.href.split(s)[0]||!h.go(t.href,t.title||p.title,!1)||e.preventDefault()}}}h.go=function(e,t,s){if(!u)return v.trigger("emit",I(e));if(n.test(e)&&!e.includes(m.href.match(n)[0]))return m.href=e,!1;t=t||p.title;const i=y($._.base+I(e));let a=i.path||"/";return/\/$/.test(a)||(a+="/"),i.query&&(a+=`?${i.query}`),i.hash&&(a+=`#${i.hash}`),s?u.replaceState(null,t,a):u.pushState(null,t,a),p.title=t,f=!1,C(),f},h.add=function(e,t){"function"==typeof t?this.r(e,t):"function"==typeof e&&this.r("@",e)},h.s=function(){this.off("*"),this.$=[]},h.e=function(e){this.$.some((function(t){var a=("@"===t?s:i)(A(e),A(t));if(a)return this.trigger.apply(null,[t,a]),f=!0}),this)},h.r=function(e,t){"@"!==e&&(e="/"+A(e)),this.$.push(e),this.on(e,t)};var $=new k;return $._={base:null,getPathFromBase:I},$.create=function(){var e=new k;return e.stop=e.s.bind(e),e},$.base=function(e){$._.base=e||"#",t=I()},$.exec=function(){C(!0)},$.parser=function(e,t){e||t||(s=_,i=T),e&&(s=e),t&&(i=t)},$.query=function(e){var t=decodeURIComponent(e||m.search),s={};return t.replace(/[?&]?(.+?)=([^&]*)/g,(function(e,t,i){s[t]=i})),s},$.stop=function(){$.started&&(c&&(c.removeEventListener(l,e),c.removeEventListener(d,e),p.removeEventListener(g,S)),v.trigger("stop"),$.started=!1)},$.start=function(e){$.started||c&&("interactive"===document.readyState||"complete"===document.readyState?(w(e),$.started=!0):document.onreadystatechange=function(){"interactive"===document.readyState&&setTimeout((function(){w(e),$.started=!0}),1)})},$.base(),$.parser(),$}();const dp=e=>sp.getModule(e),cp={base:"/",list:[{path:"/admin/sites/",components:{header:"admin-project-header",view:"admin-project-content"},classes:{header:"fluid",section:"projects-section fluid"},get store(){return dp("projects")}},{path:"/admin/pages/",title:tr("admin::pages::title"),views:{app:"admin-pages-list"}},{path:"/admin/ecommerce/",title:tr("menu::ecommerce"),breadcrumbsHide:!0,warning:{path:"ecommerce"},views:{app:"app-common",menu:"admin-ecommerce-menu",view:"admin-ecommerce-list"},classes:{header:"p0",section:"fluid p0",warning:"p40 m0 display-flex w100"},get store(){return dp("ecommerce")}},{path:"/admin/settings/",views:{app:"app-common",menu:"settings-side-menu"},classes:{header:"narrow",section:"narrow"},get store(){return dp("settings")},onBeforeRoute:()=>(flexbe.routing.go("/admin/settings/general/",{shouldReplace:!0}),!1),children:[{path:"general/",title:tr("admin::settings::general::title"),get store(){return dp("settings/general")},components:{view:"settings-section-general"}},{warning:{path:"client_letters"},path:"notification/visitor/",title:tr("admin::settings::menu::notification_visitor"),get store(){return dp("settings/notification")},components:{view:"settings-section-notification"}},{path:"redirects/",title:tr("admin::settings::redirects::title"),get store(){return dp("settings/redirect")},components:{view:"settings-section-redirects"}},{path:"notify/",title:tr("admin::settings::notify::page_title"),get store(){return dp("settings/notify")},views:{view:"settings-section-notify"}},{path:"optimization/",title:tr("admin::settings::optimization::title"),get store(){return dp("settings/optimization")},views:{view:"settings-section-optimization"}},{path:"verify/",title:tr("admin::settings::verify::title"),get store(){return dp("settings/verify")},views:{view:"settings-section-verify"}},{path:"robots/",title:tr("admin::settings::robots::title"),get store(){return dp("settings/robots")},views:{view:"settings-section-robots"}},{path:"ai/",title:tr("admin::settings::ai::title"),warning:{path:"ai_copywriter"},get store(){return dp("settings/ai")},views:{view:"settings-section-ai"}},{path:"access/",title:tr("admin::settings::access::title"),get store(){return dp("settings/access")},views:{header:"element-members-control-button",view:"settings-section-access"}},{path:"fonts/",title:tr("admin::settings::fonts::title"),get store(){return dp("settings/fonts")},views:{view:"settings-section-fonts"}},{path:"legal/",title:tr("admin::settings::legal::title"),get store(){return dp("settings/legal")},views:{view:"settings-section-legal"}},{path:"code/",title:tr("admin::settings::code::title"),get store(){return dp("settings/code")},views:{view:"settings-section-code"}},{path:"api/",title:"API",warning:{path:"api"},get store(){return dp("settings/api")},views:{view:"settings-section-api"}},{path:"domains/",title:tr("admin::domains::main::title"),get store(){return dp("settings/domains")},views:{header:"element-domains-add-alias-button",view:"settings-section-domains"},children:[{path:"add",title:tr("admin::domains::add::title"),get store(){return dp("settings/domains/add")},views:{header:!1,view:"settings-section-domains-add"}},{path:"reg",title:(e,t)=>{const s=t.state,i=s&&s.domain&&s.domain.full_name||"";return tr("admin::domains::reg::form::title",{d_name:i})},get store(){return dp("settings/domains/reg")},views:{view:"settings-section-domains-reg",header:!1}},{path:"reg_done",title:(e,t)=>{const s=t.state,i=s&&s.domain&&s.domain.full_name||"";return tr("admin::domains::reg::done_title",{domain:i})},get store(){return dp("settings/domains/domain")},views:{view:"settings-section-domains-reg-done",header:!1}},{path:"transfer_done",title:(e,t)=>{const s=t.state,i=s&&s.domain&&s.domain.full_name||"";return tr("admin::domains::transfer_done::title",{domain:i})},get store(){return dp("settings/domains/domain")},views:{view:"settings-section-domains-transfer-done",header:!1}}]},{path:"pay/",title:tr("admin::settings::pay::title"),warning:{path:"payment"},get store(){return dp("settings/pay")},views:{view:"settings-section-pay"},classes:{section:"narrow"},children:[{path:"connect/",title:tr("admin::settings::pay::connect_service_title"),views:{view:"settings-section-pay-connect"}},{path:"service/:service_name",title:(e,{state:t})=>{let s;try{s=t.info.title}catch(e){s=""}return s},get store(){return dp("settings/pay/service")},onRouteError:e=>{if("NetworkError"!==e.name||!e.data||404!==e.data.status)throw e;return flexbe.routing.go("/admin/settings/pay/"),!1},views:{view:"settings-section-pay-service"}}]},{path:"integration/domain_mailing",params:{category:"domain_mailing"},title:(e,{route:t,store:s})=>{var i,a;const n=1===(null==(i=s.meta)||null==(a=i.domains)?void 0:a.length),r=e.path===t.path,o=s.meta.domains;if(!r&&!n&&flexbe.routing.query.domain_id){const e=o.filter((e=>+e.domain_id==+flexbe.routing.query.domain_id)),t=null==e?void 0:e[0].domain_name;return tr("admin::integrations::domain_mailing::domain_title",{domain:t})}if(n){const e=o[0].domain_name;return tr("admin::integrations::domain_mailing::domain_title",{domain:e})}return tr("admin::integrations::domain_mailing::title")},get store(){return dp("settings/domainMailing")},views:{view:"settings-section-domain_mailing"},classes:{section:"narrow"},children:[{path:"connect",title:tr("admin::integrations::domain_mailing::connect_service_title"),views:{header:!1,view:"settings-section-integrations-connect"}}]},{path:"integration/:category",title:(e,{params:t})=>tr({widgets:"admin::integrations::widgets::title",counters:"admin::integrations::counters::title",mailing:"admin::integrations::mailing::title",crm:"admin::integrations::export_applications::title"}[t.category]),get store(){return dp("settings/integrations")},views:{header:"element-integrations-add-button",view:"settings-section-integrations"},classes:{section:"narrow"},children:[{path:"connect",title:(e,{params:t})=>tr({widgets:"admin::integrations::widgets::connect_service_title",counters:"admin::integrations::counters::connect_service_title",mailing:"admin::integrations::mailing::connect_service_title",crm:"admin::integrations::crm::connect_service_title"}[t.category]),views:{header:!1,view:"settings-section-integrations-connect"}}]},{path:"ecommerce/",children:[{path:"common/",warning:{path:"ecommerce"},title:tr("admin::settings::ecommerce::title"),get store(){return dp("settings/ecommerce")},views:{view:"settings-section-ecommerce"},classes:{section:"narrow ecommerce-section"}},{path:"delivery/",warning:{path:"ecommerce"},title:tr("admin::settings::delivery::title"),get store(){return dp("settings/delivery")},views:{view:"settings-section-delivery"},classes:{section:"narrow"}},{path:"promotion/",warning:{path:"ecommerce"},title:tr("admin::settings::promocode::title"),get store(){return dp("settings/promo")},views:{view:"settings-section-promo"},classes:{section:"narrow"}}]}]},{path:"/admin/user/",views:{app:"app-common",menu:"user-side-menu"},classes:{header:"narrow",section:"narrow"},onBeforeRoute:()=>(flexbe.routing.go("/admin/user/profile/",{shouldReplace:!0}),!1),children:[{path:"profile/",title:tr("admin::user::profile::title"),get store(){return dp("user/profile")},views:{view:"user-section-profile"}}]}]};let pp;const up=window.route,mp=At({go:function(e,{title:t,shouldReplace:s}={}){return up.go(e,t,s)},params:d({}),query:d({}),views:{},classes:{},path:null,found:!1,routed:!1});function hp(e,t){Array.isArray(e)&&e.forEach((e=>{!function({route:e,parent:t={}}){const s=vt({},e);s.title=e.title,s.views=vt({},t.views,e.views),s.components=vt({},t.components,e.components),s.classes=vt({},t.classes,e.classes),s.params=e.params||{},!s.hasOwnProperty("store")&&t.hasOwnProperty("store")&&Object.defineProperty(s,"store",Object.getOwnPropertyDescriptor(t,"store"));t.path&&(s.parent=t);"string"==typeof e.path&&(s.path=`${t.path||""}/${e.path}`.replace(/^\/+|\/+$/g,""),s.path=`/${s.path}`);s.onBeforeRoute=(...t)=>{if("function"==typeof e.onBeforeRoute){if(!1===e.onBeforeRoute(...t))return}mp.trigger("before-route",...t)},s.onRoute=(...t)=>{if("function"==typeof e.onRoute){if(!1===e.onRoute(...t))return}mp.trigger("route",...t)},s.onRouteError=(t,s)=>{if("function"==typeof e.onRouteError){if(!1===e.onRouteError(t,s))return}if(!s.oldRoute||"NetworkError"!==t.name)throw mp.trigger("route-error",t,s),t;window.location.reload()},Object.freeze(s),up.add(s.path,gp.bind(null,s)),e.children&&hp(e.children,s)}({route:e,parent:t})}))}async function gp(e,{path:t,params:s,query:i,hash:a}){var n;if(mp&&mp.routed&&(!mp.route||mp.views.app!==e.views.app||!document.querySelector(`[data-is="${e.views.app}"]`)))return window.location.reload(),!1;pp=e,s={...null==(n=e.parent)?void 0:n.params,...e.params,...s};const r=mp.route,o={path:t,params:s,query:i,hash:a,oldRoute:r,route:e};if(t===mp.path)return;e.onBeforeRoute(o),mp.found=!0,mp.routed=!0,mp.loading=!0,mp.path=t,mp.hash=a,yt(mp.query,i),yt(mp.params,s);let l=null,d=null;if(e.store){l=it(e.store,[e,o],e);try{d=await l.getState({routeArgs:o})}catch(t){e.onRouteError(t,o)}}if(mp.store=l,mp.state=d,pp!==e)return;o.store=mp.store,o.state=mp.state,mp.match=[e];let c=e;for(;c.parent;)mp.match.unshift(c.parent),c=c.parent;mp.match=mp.match.map((e=>{const t={...e},i={...o};return t.title=it(t.title,[t,i],t),t.store=it(t.store,[t,i],t),t.views=it(t.views,[t,i],t),t.classes=it(t.classes,[t,i],t),t.params={...s,...it(t.params,[t,i],t)},t.path=((e,t={},{prefix:s=":",suffix:i=""}={})=>(Object.entries(t).forEach((([t,a])=>{e=e.replace(new RegExp(s+t+i,"g"),a)})),e))(t.path,t.params,{prefix:":",suffix:""}),delete t.parent,delete t.children,t}));const p=mp.match[mp.match.length-1];mp.route=p,mp.views=p.views,mp.classes=p.classes,mp.loading=!1,p.title&&(document.title=p.title),e.onRoute(o)}window.$document=$(document),window.$window=$(window);window.isAdmin=!0,window.flexbe=At({init:()=>{we("editor_lang",flexbe.vars.user.lang),((e,t="/")=>{document.cookie=`${e}=; path=${t}; expires=${new Date(0)}`})("mode"),we("mode","editor"),async function(){var e,t;nt.avif=null!=(e=nt.avif)?e:await ot("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),nt.webp=null!=(t=nt.webp)?t:await ot("data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA")}(),gn(),function(){const e=e=>{const t=e.props||e.opts;Tt(e,"$store",(()=>{var e;return null!=(e=t.store)?e:flexbe.routing.store})),Tt(e,"$state",(()=>{var t,s;return null!=(t=null==(s=e.$store)?void 0:s.state)?t:{}})),Tt(e,"$meta",(()=>{var t,s;return null!=(t=null==(s=e.$store)?void 0:s.meta)?t:{}})),Tt(e,"$getters",(()=>{var t,s;return null!=(t=null==(s=e.$store)?void 0:s.getters)?t:{}})),Tt(e,"$helpers",(()=>{var t,s;return null!=(t=null==(s=e.$store)?void 0:s.helpers)?t:{}}))};riot3.mixin({init(){e(this)}}),a((t=>(e(t),t)))}(),fs.init(),ji.init(),op.init(),Sr.init(),function(){riot3.mount("*");const e=Array.from(document.querySelectorAll("[is]")).filter((e=>!e[t.globals.DOM_COMPONENT_INSTANCE_PROPERTY]));s(e)}(),mp.inited||(mp.inited=!0,mp.routed=!1,up.base(cp.base),up.stop(),hp(cp.list),up.add((({path:e,query:t,hash:s})=>{up.started&&window.location.reload(),mp.found=!0,mp.routed=!0,mp.loading=!1,mp.path=e,mp.hash=s,yt(mp.query,t),mp.trigger("route-default",{path:e,query:t,hash:s})})),up.start(!0)),$(document.body).on("click",".modal-img-link",(e=>{e.preventDefault(),e.stopPropagation(),ks({src:$(e.currentTarget).attr("href")})}))},api:di,admin:Tc,modals:op,routing:mp,hotkeys:fs,lib:{getSprite:at},support:Sr,modal:Zs,bill:lp,tip:Yt,page:ao}),window.adminStore=sp;
